import{r as i,b as sa,N as Cs,u as me,L as xe,d as Ss,e as Ye,B as aa,f as ra,h as te}from"./react-vendor-Cz1Q9NVz.js";import{c as na}from"./supabase-vendor-B81xZs_p.js";import{f as Zt,a as $,s as dt,b as hs,e as ps,c as la,i as Yt,d as X,g as Ds,h as oa,j as ia}from"./date-vendor-Y3GY3t4o.js";import{R as ge,L as Mt,C as Te,X as Le,Y as $e,T as je,a as ut,b as qe,P as Pt,c as Et,d as At,e as da,A as ca,B as It,f as ct}from"./chart-vendor-D5s4rsdd.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const p of r)if(p.type==="childList")for(const u of p.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&g(u)}).observe(document,{childList:!0,subtree:!0});function c(r){const p={};return r.integrity&&(p.integrity=r.integrity),r.referrerPolicy&&(p.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?p.credentials="include":r.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function g(r){if(r.ep)return;r.ep=!0;const p=c(r);fetch(r.href,p)}})();var Ms={exports:{}},Ft={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xa=i,ma=Symbol.for("react.element"),ha=Symbol.for("react.fragment"),pa=Object.prototype.hasOwnProperty,ba=xa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ua={key:!0,ref:!0,__self:!0,__source:!0};function Ps(s,l,c){var g,r={},p=null,u=null;c!==void 0&&(p=""+c),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(u=l.ref);for(g in l)pa.call(l,g)&&!ua.hasOwnProperty(g)&&(r[g]=l[g]);if(s&&s.defaultProps)for(g in l=s.defaultProps,l)r[g]===void 0&&(r[g]=l[g]);return{$$typeof:ma,type:s,key:p,ref:u,props:r,_owner:ba.current}}Ft.Fragment=ha;Ft.jsx=Ps;Ft.jsxs=Ps;Ms.exports=Ft;var e=Ms.exports,Es,bs=sa;Es=bs.createRoot,bs.hydrateRoot;const ga="https://zvrkldiptatwsnflmvbp.supabase.co",fa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2cmtsZGlwdGF0d3NuZmxtdmJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTU4MDMsImV4cCI6MjA4MTI3MTgwM30.cPJdSpxdkQxD6TfgJ4qsnNRTJWPwQvjTlhZPVcHR17A",C=na(ga,fa),As=i.createContext(void 0);function ja({children:s}){const[l,c]=i.useState(null),[g,r]=i.useState(null),[p,u]=i.useState(!0);i.useEffect(()=>{C.auth.getSession().then(({data:{session:N}})=>{r(N),N?.user?m(N.user.id):u(!1)});const{data:{subscription:a}}=C.auth.onAuthStateChange((N,h)=>{r(h),h?.user?m(h.user.id):(c(null),u(!1))});return()=>a.unsubscribe()},[]);const m=async a=>{try{const{data:N,error:h}=await C.from("users").select("*").eq("id",a).maybeSingle();if(h)throw h;N&&c(N)}catch(N){console.error("Error loading user profile:",N)}finally{u(!1)}},n={session:g,user:l,loading:p,signIn:async(a,N)=>{if(!a||!N)return{error:new Error("Please enter email and password")};try{const{data:h,error:k}=await C.auth.signInWithPassword({email:a,password:N});if(k)throw k;if(h.user){const{data:_,error:y}=await C.from("users").select("approval_status, rejection_reason").eq("id",h.user.id).maybeSingle();if(y)throw y;if(_?.approval_status==="pending")return await C.auth.signOut(),{error:new Error("Your account is pending approval. Please wait for admin to approve your registration.")};if(_?.approval_status==="rejected"){await C.auth.signOut();const j=_.rejection_reason?`
Reason: ${_.rejection_reason}`:"";return{error:new Error(`Your registration was not approved.${j}

Please contact admin for more information.`)}}await m(h.user.id)}return{error:null}}catch(h){return{error:new Error(h.message||"Invalid login credentials")}}},signUp:async(a,N,h,k,_="partner")=>{if(!a||!N||!h)return{error:new Error("Please fill all required fields")};try{const{data:y,error:j}=await C.auth.signUp({email:a,password:N});if(j)throw j;if(!y.user)throw new Error("Failed to create user");const d=_==="admin"?"approved":"pending",x=_==="admin"?new Date().toISOString():null,{error:o}=await C.from("users").insert({id:y.user.id,email:a,name:h,phone:k||null,role:_,approval_status:d,approved_at:x});if(o)throw o;return _==="admin"?await m(y.user.id):await C.auth.signOut(),{error:null}}catch(y){return{error:new Error(y.message||"Failed to create account")}}},signOut:async()=>{await C.auth.signOut(),c(null),r(null)}};return e.jsx(As.Provider,{value:n,children:s})}function G(){const s=i.useContext(As);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ya={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),F=(s,l)=>{const c=i.forwardRef(({color:g="currentColor",size:r=24,strokeWidth:p=2,absoluteStrokeWidth:u,className:m="",children:b,...f},t)=>i.createElement("svg",{ref:t,...ya,width:r,height:r,stroke:g,strokeWidth:u?Number(p)*24/Number(r):p,className:["lucide",`lucide-${wa(s)}`,m].join(" "),...f},[...l.map(([n,a])=>i.createElement(n,a)),...Array.isArray(b)?b:[b]]));return c.displayName=`${s}`,c};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=F("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=F("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=F("AlertOctagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=F("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=F("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=F("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=F("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=F("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=F("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=F("Beaker",[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=F("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=F("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=F("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=F("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=F("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=F("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=F("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=F("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=F("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=F("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=F("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=F("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=F("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=F("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=F("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=F("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=F("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=F("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=F("FileSearch",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"1vg67v"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=F("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=F("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=F("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=F("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=F("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=F("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=F("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=F("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=F("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=F("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=F("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=F("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=F("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=F("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=F("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=F("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=F("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=F("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=F("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=F("MessagesSquare",[["path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4c0-1.1.9-2 2-2h8a2 2 0 0 1 2 2v5Z",key:"16vlm8"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1",key:"1cx29u"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=F("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=F("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=F("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=F("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=F("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=F("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=F("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=F("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=F("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=F("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=F("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=F("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=F("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=F("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=F("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=F("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=F("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=F("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=F("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=F("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=F("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=F("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=F("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=F("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=F("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=F("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=F("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=F("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=F("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=F("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=F("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=F("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=F("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=F("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=F("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=F("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=F("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=F("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=F("Wheat",[["path",{d:"M2 22 16 8",key:"60hf96"}],["path",{d:"M3.47 12.53 5 11l1.53 1.53a3.5 3.5 0 0 1 0 4.94L5 19l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1rdhi6"}],["path",{d:"M7.47 8.53 9 7l1.53 1.53a3.5 3.5 0 0 1 0 4.94L9 15l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1sdzmb"}],["path",{d:"M11.47 4.53 13 3l1.53 1.53a3.5 3.5 0 0 1 0 4.94L13 11l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"eoatbi"}],["path",{d:"M20 2h2v2a4 4 0 0 1-4 4h-2V6a4 4 0 0 1 4-4Z",key:"19rau1"}],["path",{d:"M11.47 17.47 13 19l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L5 19l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"tc8ph9"}],["path",{d:"M15.47 13.47 17 15l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L9 15l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"2m8kc5"}],["path",{d:"M19.47 9.47 21 11l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L13 11l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"vex3ng"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=F("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=F("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=F("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=F("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=F("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=F("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function ne({children:s,adminOnly:l=!1}){const{user:c,loading:g}=G();return g?e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(as,{className:"w-12 h-12 text-primary animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading..."})]})}):c?l&&c.role!=="admin"?e.jsx("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card p-10 text-center max-w-md",children:[e.jsx(Wa,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-primary mb-3",children:"Access Denied"}),e.jsx("p",{className:"text-primary/70 mb-6",children:"You don't have permission to access this page. This area is restricted to administrators only."}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-6 py-3 bg-gradient-primary text-white font-bold rounded-button hover:shadow-lg",children:"Go Back"})]})}):e.jsx(e.Fragment,{children:s}):e.jsx(Cs,{to:"/login",replace:!0})}function sr(){const[s,l]=i.useState(!1),[c,g]=i.useState(!1),[r,p]=i.useState(null);return i.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&g(!0);const m=f=>{f.preventDefault(),p(f),l(!0)},b=()=>{g(!0),l(!1),p(null)};return window.addEventListener("beforeinstallprompt",m),window.addEventListener("appinstalled",b),()=>{window.removeEventListener("beforeinstallprompt",m),window.removeEventListener("appinstalled",b)}},[]),{isInstallable:s,isInstalled:c,installApp:async()=>{if(!r)return!1;try{await r.prompt();const{outcome:m}=await r.userChoice;return m==="accepted"?(p(null),l(!1),!0):!1}catch(m){return console.error("Error installing app:",m),!1}}}}function ar(){const[s,l]=i.useState(navigator.onLine);return i.useEffect(()=>{const c=()=>l(!0),g=()=>l(!1);return window.addEventListener("online",c),window.addEventListener("offline",g),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",g)}},[]),s}function rr(){const[s,l]=i.useState(!1),[c,g]=i.useState(null);return i.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(p=>{g(p),p.addEventListener("updatefound",()=>{const u=p.installing;u&&u.addEventListener("statechange",()=>{u.state==="installed"&&navigator.serviceWorker.controller&&l(!0)})})})},[]),{isUpdateAvailable:s,updateServiceWorker:()=>{c?.waiting&&(c.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())}}}function nr(){const{isInstallable:s,installApp:l}=sr(),[c,g]=i.useState(!1),[r,p]=i.useState(!1);i.useEffect(()=>{localStorage.getItem("pwa-install-dismissed")&&p(!0)},[]),i.useEffect(()=>{if(s&&!r){const b=setTimeout(()=>{g(!0)},3e3);return()=>clearTimeout(b)}},[s,r]);const u=async()=>{await l()&&g(!1)},m=()=>{g(!1),p(!0),localStorage.setItem("pwa-install-dismissed","true")};return!c||!s?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-primary/10 p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:"ðŸŒ¿"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Install Organitto"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"Install our app for quick access, offline support, and a native experience!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:u,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(ke,{className:"w-4 h-4"}),"Install"]}),e.jsx("button",{onClick:m,className:"px-4 py-2.5 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Not Now"})]})]}),e.jsx("button",{onClick:m,className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-dark-brown/40"})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"âš¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Fast"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“±"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Native"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Offline"})]})]})})]})})}function lr(){const s=ar(),[l,c]=i.useState(!1),[g,r]=i.useState(!1);return i.useEffect(()=>{s?l&&s&&(r(!0),setTimeout(()=>{c(!1),r(!1)},3e3)):(c(!0),r(!1))},[s,l]),l?e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${g?"bg-gradient-to-r from-sage to-primary":"bg-gradient-to-r from-accent to-soft-red"}`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-center gap-3 text-white",children:g?e.jsxs(e.Fragment,{children:[e.jsx(Xa,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"Back online! Data syncing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ja,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"You're offline"}),e.jsx("span",{className:"hidden sm:inline text-sm opacity-90",children:"- Changes will sync when you reconnect"})]})})})}):null}function or(){const{isUpdateAvailable:s,updateServiceWorker:l}=rr(),[c,g]=i.useState(!1);return!s||c?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-accent/20 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(gs,{className:"w-6 h-6 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Update Available"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"A new version of Organitto is ready. Update now to get the latest features!"}),e.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(gs,{className:"w-4 h-4"}),"Update Now"]})]}),e.jsx("button",{onClick:()=>g(!0),className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-dark-brown/40"})})]})})})}const ir=[{icon:Dt,label:"Add Expense",path:"/expenses/new",color:"from-secondary to-accent"},{icon:oe,label:"Add Product",path:"/products",color:"from-primary to-sage"},{icon:Rs,label:"Add Batch",path:"/batches",color:"from-sage to-primary"},{icon:De,label:"Record Sale",path:"/expenses/new",color:"from-accent to-secondary"},{icon:ae,label:"Quick Note",path:"/chat",color:"from-primary to-accent"}];function dr(){const[s,l]=i.useState(!1),c=me(),g=r=>{l(!1),c(r)};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-dark-brown/20 backdrop-blur-sm",onClick:()=>l(!1)}),e.jsx("div",{className:"relative z-10 flex flex-col-reverse gap-4 mb-4",children:ir.map((r,p)=>{const u=r.icon;return e.jsxs("button",{onClick:()=>g(r.path),className:"group flex items-center gap-4 animate-scale-in",style:{animationDelay:`${p*50}ms`},children:[e.jsx("span",{className:"glass-card px-4 py-2 font-bold text-primary opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap shadow-glow hidden md:block",children:r.label}),e.jsx("div",{className:`w-14 h-14 md:w-12 md:h-12 bg-gradient-to-br ${r.color} rounded-full flex items-center justify-center shadow-glow hover:shadow-glow-lg transition-all duration-300 hover:scale-110 cursor-pointer`,children:e.jsx(u,{className:"w-6 h-6 md:w-5 md:h-5 text-white",strokeWidth:2.5})})]},r.label)})})]}),e.jsxs("button",{onClick:()=>l(!s),className:`relative z-10 w-16 h-16 md:w-14 md:h-14 bg-gradient-primary rounded-full flex items-center justify-center shadow-glow hover:shadow-glow-lg transition-all duration-300 hover:scale-110 active:scale-95 ${s?"rotate-45":"rotate-0"}`,"aria-label":s?"Close quick actions":"Open quick actions",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold opacity-0 hover:opacity-20 rounded-full transition-opacity duration-300"}),s?e.jsx(ce,{className:"w-7 h-7 md:w-6 md:h-6 text-white relative z-10",strokeWidth:3}):e.jsx(Q,{className:"w-7 h-7 md:w-6 md:h-6 text-white relative z-10",strokeWidth:3})]}),!s&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-accent rounded-full animate-pulse"})]})}const Ne=()=>e.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0",children:[...Array(6)].map((s,l)=>e.jsx("div",{className:"leaf absolute",style:{left:`${10+l*16}%`,animationDelay:`${l*2}s`},children:e.jsx(Ke,{className:"text-[#2D5016]",size:24+Math.random()*12,style:{transform:`rotate(${Math.random()*360}deg)`,opacity:.06}})},l))}),J=({children:s,className:l="",hover:c=!0,tilt:g=!1,onClick:r})=>{const p="glass-card p-6",u=c?"hover:shadow-xl":"",m=g?"card-3d":"",b=r?"cursor-pointer":"";return e.jsx("div",{className:`${p} ${u} ${m} ${b} ${l}`,onClick:r,children:s})},pe=({children:s,variant:l="primary",size:c="md",className:g="",onClick:r,disabled:p=!1,type:u="button",icon:m})=>{const b="inline-flex items-center justify-center gap-2 font-semibold transition-all duration-300",f={primary:"btn-premium",gold:"btn-gold",neu:"btn-neu text-primary",outline:"border-2 border-primary text-primary hover:bg-primary hover:text-white bg-transparent"},t={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg"},n=p?"opacity-50 cursor-not-allowed":"";return e.jsxs("button",{type:u,onClick:r,disabled:p,className:`${b} ${f[l]} ${t[c]} ${n} ${g}`,children:[m&&e.jsx("span",{children:m}),s]})};function cr(){const s=me();return e.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Ne,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-20",children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:e.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-12 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-30 group-hover:opacity-50 transition-opacity duration-700"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-32 md:h-40 w-auto object-contain relative z-10 drop-shadow-2xl transform group-hover:scale-110 transition-transform duration-500"})]})}),e.jsxs("div",{className:"mb-6 inline-flex items-center gap-2 px-4 py-2 glass-card",children:[e.jsx(Qa,{className:"w-4 h-4 text-gold"}),e.jsx("span",{className:"text-sm font-bold text-gradient",children:"Premium Ayurvedic Management"})]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-heading font-bold text-primary mb-6 leading-tight animate-fade-in",children:["Elevate Your"," ",e.jsx("span",{className:"text-gradient-gold",children:"Ayurvedic"}),e.jsx("br",{}),"Business"]}),e.jsx("p",{className:"text-xl md:text-2xl text-primary/70 mb-12 max-w-2xl mx-auto leading-relaxed font-medium",children:"The most sophisticated platform for managing your Ayurvedic practice with elegance and precision"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center items-center mb-20",children:[e.jsx(pe,{variant:"primary",size:"lg",onClick:()=>s("/register"),className:"min-w-[220px] text-lg shadow-colored",children:"Start Your Journey"}),e.jsx(pe,{variant:"gold",size:"lg",onClick:()=>s("/login"),className:"min-w-[220px] text-lg",children:"Sign In"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mt-24",children:[e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(Ke,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Natural Flow"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Manage your practice with intuitive tools that respect the natural rhythm of Ayurvedic care"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float-delayed",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-gold rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-glow transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(se,{className:"w-8 h-8 text-primary-dark"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Premium Analytics"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Gain comprehensive insights into your business health with sophisticated reporting tools"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(pt,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Secure & Reliable"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Enterprise-grade security ensuring your data is protected with the highest standards"})]})]})]})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-48 bg-gradient-to-t from-primary/10 via-gold/5 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 text-center z-20",children:e.jsx("p",{className:"text-sm text-primary/50 font-medium",children:"Trusted by leading Ayurvedic practitioners worldwide"})})]})}function xr(){const s=me(),{signIn:l,user:c,loading:g}=G(),[r,p]=i.useState(""),[u,m]=i.useState(""),[b,f]=i.useState(""),[t,n]=i.useState(!1);i.useEffect(()=>{c&&!g&&s("/dashboard")},[c,g,s]);const a=async N=>{N.preventDefault(),f(""),n(!0);try{const{error:h}=await l(r,u);h&&(f(h.message||"Failed to sign in. Please check your credentials."),n(!1))}catch{f("An unexpected error occurred. Please try again."),n(!1)}};return e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Ne,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(Ue,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-lg",children:[e.jsxs("div",{className:"glass-card p-10 md:p-12 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-10 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-500"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-20 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-300"})]})}),e.jsx("h1",{className:"font-heading text-5xl font-bold text-gradient text-center mb-3",children:"Welcome Back"}),e.jsx("p",{className:"text-primary/60 text-center mb-10 text-lg font-medium",children:"Sign in to continue your journey"}),b&&e.jsxs("div",{className:"mb-8 p-5 bg-gradient-to-r from-red-50/90 to-red-100/90 backdrop-blur-sm border border-red-200 rounded-button flex items-start gap-3 animate-slide-down",children:[e.jsx(fe,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-700 font-medium",children:b})]}),e.jsxs("form",{onSubmit:a,className:"space-y-7",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"email",type:"email",value:r,onChange:N=>p(N.target.value),className:"input-float w-full pl-12",placeholder:"you@example.com",required:!0,disabled:t})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"password",type:"password",value:u,onChange:N=>m(N.target.value),className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:t})]})]}),e.jsx(pe,{type:"submit",variant:"primary",size:"lg",disabled:t,className:"w-full text-lg mt-8",children:t?"Signing in...":"Sign In"})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-primary/70 font-medium",children:["Don't have an account?"," ",e.jsx(xe,{to:"/register",className:"text-gradient-gold font-bold hover:underline transition-all",children:"Create Account"})]})})]}),e.jsx("div",{className:"text-center mt-8 glass-card inline-block px-6 py-3 mx-auto",children:e.jsxs("p",{className:"text-primary/50 text-sm font-medium flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function mr(){const s=me(),{signUp:l,user:c,loading:g}=G(),[r,p]=i.useState({name:"",email:"",phone:"",password:"",confirmPassword:""}),[u,m]=i.useState(""),[b,f]=i.useState(!1),[t,n]=i.useState(!1),[a,N]=i.useState(!1);i.useEffect(()=>{if(c&&!g){b&&f(!1);const _=setTimeout(()=>{s("/dashboard")},t?2e3:0);return()=>clearTimeout(_)}},[c,g,b,t,s]);const h=async _=>{if(_.preventDefault(),m(""),r.password.length<8){m("Password must be at least 8 characters long");return}if(r.password!==r.confirmPassword){m("Passwords do not match");return}f(!0);try{const{count:y,error:j}=await C.from("users").select("*",{count:"exact",head:!0});if(j)throw new Error("Failed to check existing users");const d=y===0,x=d?"admin":"partner";d&&n(!0);const{error:o}=await l(r.email,r.password,r.name,r.phone,x);o?(m(o.message||"Failed to create account. Please try again."),f(!1),n(!1)):d||(N(!0),f(!1))}catch(y){m(y.message||"An unexpected error occurred. Please try again."),f(!1),n(!1)}},k=_=>{p({...r,[_.target.name]:_.target.value})};return t?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Ne,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-sage to-primary p-6 rounded-full shadow-glow",children:e.jsx(Y,{className:"w-12 h-12 text-cream",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Welcome, Founder!"}),e.jsx("p",{className:"text-primary/70 mb-4 text-lg font-medium",children:"Your account has been created successfully. You have full access to all features."}),e.jsx("p",{className:"text-primary/50 text-sm font-medium animate-pulse",children:"Redirecting to dashboard..."})]})})]}):a?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Ne,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-blue-500 to-cyan-600 p-6 rounded-full shadow-glow",children:e.jsx(Y,{className:"w-12 h-12 text-white",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Registration Successful!"}),e.jsx("p",{className:"text-primary/70 mb-6 text-lg font-medium",children:"Your account has been created and is pending admin approval."}),e.jsx("div",{className:"glass-card bg-blue-50/50 p-4 mb-6",children:e.jsx("p",{className:"text-primary/60 text-sm font-medium",children:"You will receive a notification once your account is approved. Please check back later or wait for an email confirmation."})}),e.jsx(xe,{to:"/login",children:e.jsx(pe,{variant:"primary",size:"lg",className:"w-full",children:"Go to Login"})})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Ne,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(Ue,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-lg",children:[e.jsxs("div",{className:"glass-card p-10 md:p-12 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-10 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-500"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-20 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-300"})]})}),e.jsx("h1",{className:"font-heading text-5xl font-bold text-gradient text-center mb-3",children:"Create Account"}),e.jsx("p",{className:"text-primary/60 text-center mb-10 text-lg font-medium",children:"Join Organitto and start managing your business"}),u&&e.jsxs("div",{className:"mb-8 p-5 bg-gradient-to-r from-red-50/90 to-red-100/90 backdrop-blur-sm border border-red-200 rounded-button flex items-start gap-3 animate-slide-down",children:[e.jsx(fe,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-700 font-medium",children:u})]}),e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"name",name:"name",type:"text",value:r.name,onChange:k,className:"input-float w-full pl-12",placeholder:"John Doe",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"email",name:"email",type:"email",value:r.email,onChange:k,className:"input-float w-full pl-12",placeholder:"you@example.com",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"phone",name:"phone",type:"tel",value:r.phone,onChange:k,className:"input-float w-full pl-12",placeholder:"+1 (555) 000-0000",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"password",name:"password",type:"password",value:r.password,onChange:k,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:b,minLength:8})]}),e.jsx("p",{className:"text-xs text-primary/50 mt-2 ml-1 font-medium",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",value:r.confirmPassword,onChange:k,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:b})]})]}),e.jsx(pe,{type:"submit",variant:"primary",size:"lg",disabled:b,className:"w-full text-lg mt-8",children:b?"Creating Account...":"Create Account"})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-primary/70 font-medium",children:["Already have an account?"," ",e.jsx(xe,{to:"/login",className:"text-gradient-gold font-bold hover:underline transition-all",children:"Sign in here"})]})})]}),e.jsx("div",{className:"text-center mt-8 glass-card inline-block px-6 py-3 mx-auto",children:e.jsxs("p",{className:"text-primary/50 text-sm font-medium flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function H(){const{user:s,signOut:l}=G(),c=me(),g=Ss(),[r,p]=i.useState(!1),[u,m]=i.useState(!1),[b,f]=i.useState(!1),[t,n]=i.useState(!1),[a,N]=i.useState(!1),[h,k]=i.useState([]),[_,y]=i.useState(0),j=h.filter(S=>!S.is_read).length;i.useEffect(()=>{const A=localStorage.getItem("organitto-theme")==="dark";N(A),A?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),document.documentElement.style.transition="background-color 0.3s ease-in-out, color 0.3s ease-in-out"},[]),i.useEffect(()=>{if(s?.id){d(),s.role==="admin"&&x();const S=C.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${s.id}`},()=>{d()}).subscribe(),A=C.channel("users_changes").on("postgres_changes",{event:"*",schema:"public",table:"users"},()=>{s.role==="admin"&&x()}).subscribe();return()=>{C.removeChannel(S),C.removeChannel(A)}}},[s?.id,s?.role]);const d=async()=>{if(s?.id)try{const{data:S,error:A}=await C.from("notifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(5);if(A)throw A;k(S||[])}catch(S){console.error("Error fetching notifications:",S)}},x=async()=>{try{const{count:S,error:A}=await C.from("users").select("*",{count:"exact",head:!0}).eq("approval_status","pending");if(A)throw A;y(S||0)}catch(S){console.error("Error fetching pending users count:",S)}},o=()=>{const S=!a;N(S),S?(document.documentElement.classList.add("dark"),localStorage.setItem("organitto-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("organitto-theme","light"))},v=async()=>{await l(),c("/")},w=[{name:"Dashboard",path:"/dashboard",icon:Aa},{name:"Finance",path:"/finance",icon:De,submenu:[{name:"Add Expense",path:"/expenses/add"},{name:"Expense List",path:"/expenses"},{name:"Reports",path:"/expenses/reports"},{name:"Investments",path:"/investments"}]},{name:"Products",path:"/products",icon:oe},{name:"Calculator",path:"/calculator",icon:Is},{name:"Vendors",path:"/vendors",icon:ve},{name:"Batches",path:"/batches",icon:Rs},{name:"Ingredients",path:"/ingredients",icon:Za},{name:"Compliance",path:"/compliance",icon:Da},{name:"Chat",path:"/chat",icon:La}];s?.role==="admin"&&w.push({name:"User Approvals",path:"/admin/user-approvals",icon:pt,badge:_>0?_:void 0});const P=S=>g.pathname===S,T=()=>g.pathname.startsWith("/expenses")||g.pathname.startsWith("/investments")||g.pathname==="/finance";return e.jsx("header",{className:"sticky top-0 z-50 backdrop-blur-[20px] bg-[rgba(255,255,255,0.95)] border-b border-[rgba(45,80,22,0.08)]",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs(xe,{to:"/dashboard",className:"flex items-center gap-3 group",children:[e.jsx("div",{className:"text-3xl",children:"ðŸŒ¿"}),e.jsx("span",{className:"text-2xl font-bold text-[#2D5016] heading-serif",children:"Organitto"})]}),e.jsx("nav",{className:"hidden lg:flex items-center gap-1",children:w.map(S=>{const A=S.icon;return e.jsx("div",{className:"relative",children:S.submenu?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),className:`px-4 py-2 rounded-[10px] font-medium transition-all duration-200 flex items-center gap-2 text-[0.9375rem] ${T()?"bg-[#E8F5E9] text-[#2D5016] font-semibold":"text-[#4A4A4A] hover:text-[#2D5016] hover:bg-[rgba(45,80,22,0.05)]"}`,children:[A&&e.jsx(A,{className:`w-4 h-4 transition-transform duration-300 ${T()?"":"group-hover:scale-110"}`}),e.jsx("span",{children:S.name}),e.jsx(Fs,{className:`w-4 h-4 transition-transform duration-300 ${b?"rotate-180":""}`})]}),b&&e.jsx("div",{onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),className:"absolute top-full left-0 mt-2 w-56 glass-card border border-white/20 overflow-hidden z-50 animate-slide-down shadow-soft-lg",children:S.submenu.map(U=>e.jsx(xe,{to:U.path,className:`block px-5 py-3.5 text-sm font-semibold transition-all duration-300 hover:translate-x-1 ${P(U.path)?"bg-gradient-primary/15 text-primary border-l-4 border-primary shadow-sm":"text-dark-brown hover:bg-gradient-primary/10 hover:text-primary hover:border-l-4 hover:border-primary/30"}`,children:U.name},U.path))})]}):e.jsxs(xe,{to:S.path,className:`px-4 py-2 rounded-[10px] font-medium transition-all duration-200 flex items-center gap-2 text-[0.9375rem] relative ${P(S.path)?"bg-[#E8F5E9] text-[#2D5016] font-semibold":"text-[#4A4A4A] hover:text-[#2D5016] hover:bg-[rgba(45,80,22,0.05)]"}`,children:[A&&e.jsx(A,{className:`w-4 h-4 relative z-10 transition-transform duration-300 ${P(S.path)?"":"group-hover:scale-110 group-hover:rotate-3"}`}),e.jsx("span",{className:"relative z-10",children:S.name}),S.badge&&e.jsx("span",{className:"relative z-10 ml-1 px-2 py-0.5 bg-gradient-gold text-primary-dark text-xs font-bold rounded-full shadow-sm animate-pulse",children:S.badge}),!P(S.path)&&e.jsx("span",{className:"absolute inset-0 bg-gradient-primary opacity-0 group-hover:opacity-10 transition-opacity duration-300"})]})},S.path)})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>n(!t),className:"relative w-10 h-10 flex items-center justify-center rounded-[10px] bg-white border border-[rgba(45,80,22,0.08)] text-[#4A4A4A] hover:bg-[#F5F7F5] hover:text-[#2D5016] hover:border-[rgba(45,80,22,0.12)] transition-all duration-200",children:[e.jsx(Ge,{className:"w-5 h-5"}),j>0&&e.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-[#EF4444] rounded-full border-2 border-white"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>n(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-96 glass-card border border-white/20 overflow-hidden z-20 animate-slide-down",children:[e.jsx("div",{className:"p-4 bg-gradient-mesh border-b border-primary/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-primary text-lg",children:"Notifications"}),j>0&&e.jsxs("span",{className:"px-2.5 py-1 bg-gradient-gold text-primary-dark text-xs font-bold rounded-full",children:[j," new"]})]})}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:h.length>0?h.map(S=>e.jsx("div",{className:`p-4 border-b border-primary/5 hover:bg-primary/5 transition-colors cursor-pointer ${S.is_read?"":"bg-gold/5"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 flex-shrink-0 ${S.is_read?"bg-gray-300":"bg-gold"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-primary text-sm",children:S.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:S.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:Zt(new Date(S.created_at),{addSuffix:!0})})]})]})},S.id)):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Ge,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No notifications"})]})}),e.jsx("div",{className:"p-3 bg-gray-50 border-t border-primary/10",children:e.jsx("button",{onClick:()=>{n(!1),c("/notifications")},className:"w-full text-center text-sm font-semibold text-primary hover:text-primary-dark transition-colors",children:"View All Notifications"})})]})]})]}),e.jsx("button",{onClick:o,className:"w-10 h-10 flex items-center justify-center rounded-[10px] bg-white border border-[rgba(45,80,22,0.08)] text-[#4A4A4A] hover:bg-[#2D5016] hover:text-white hover:border-[#2D5016] transition-all duration-200",title:"Toggle theme",children:a?e.jsx(Ga,{className:"w-5 h-5"}):e.jsx($a,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>p(!r),className:"flex items-center gap-3 px-2 py-2 rounded-[10px] hover:bg-[rgba(45,80,22,0.05)] transition-all duration-200",children:[e.jsx("div",{className:"w-10 h-10 rounded-[10px] bg-gradient-to-br from-[#2D5016] to-[#4A7C3B] flex items-center justify-center text-white font-semibold text-sm",children:s?.name?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{className:"hidden md:block text-left",children:[e.jsx("p",{className:"text-sm font-semibold text-[#1A1A1A]",children:s?.name}),e.jsx("p",{className:"text-xs text-[#757575] capitalize",children:s?.role})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>p(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-72 glass-card border border-white/20 overflow-hidden z-20 animate-slide-down",children:[e.jsxs("div",{className:"p-5 bg-gradient-mesh border-b border-primary/10",children:[e.jsx("p",{className:"font-bold text-primary text-lg",children:s?.name}),e.jsx("p",{className:"text-sm text-primary/70 font-medium",children:s?.email}),e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-gold rounded-full shadow-sm",children:[e.jsx(pt,{className:"w-4 h-4 text-primary-dark"}),e.jsx("span",{className:"text-xs font-bold text-primary-dark capitalize",children:s?.role})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{p(!1),c("/settings")},className:"w-full flex items-center gap-3 px-4 py-3 text-primary hover:bg-primary/5 rounded-button transition-all duration-300 font-semibold group",children:[e.jsx(Va,{className:"w-5 h-5 transform group-hover:rotate-90 transition-transform duration-300"}),e.jsx("span",{children:"Settings"})]}),e.jsxs("button",{onClick:v,className:"w-full flex items-center gap-3 px-4 py-3 text-secondary hover:bg-secondary/10 rounded-button transition-all duration-300 font-semibold group",children:[e.jsx(Fa,{className:"w-5 h-5 transform group-hover:translate-x-1 transition-transform duration-300"}),e.jsx("span",{children:"Sign Out"})]})]})]})]})]}),e.jsx("button",{onClick:()=>m(!u),className:"lg:hidden p-2 text-dark-brown hover:bg-primary/10 rounded-lg transition-all duration-300",children:u?e.jsx(ce,{className:"w-6 h-6"}):e.jsx(Ta,{className:"w-6 h-6"})})]})]}),u&&e.jsx("nav",{className:"lg:hidden py-4 border-t-2 border-primary/10 animate-slide-down",children:e.jsx("div",{className:"flex flex-col gap-2",children:w.map(S=>{const A=S.icon;return e.jsxs("div",{children:[e.jsxs(xe,{to:S.path,onClick:()=>!S.submenu&&m(!1),className:`flex items-center gap-3 px-4 py-3.5 rounded-xl font-semibold transition-all duration-300 group ${P(S.path)||S.name==="Finance"&&T()?"bg-gradient-primary text-white shadow-colored scale-105":"text-primary hover:bg-gradient-primary/10 hover:shadow-soft hover:scale-105 hover:translate-x-1"}`,children:[A&&e.jsx(A,{className:`w-5 h-5 transition-transform duration-300 ${P(S.path)||S.name==="Finance"&&T()?"":"group-hover:scale-110 group-hover:rotate-3"}`}),e.jsx("span",{children:S.name}),S.badge&&e.jsx("span",{className:"ml-auto px-2 py-0.5 bg-gradient-gold text-primary-dark text-xs font-bold rounded-full shadow-sm animate-pulse",children:S.badge})]}),S.submenu&&e.jsx("div",{className:"ml-4 mt-2 flex flex-col gap-2 pl-4 border-l-2 border-primary/20",children:S.submenu.map(U=>e.jsx(xe,{to:U.path,onClick:()=>m(!1),className:`block px-4 py-3 rounded-lg text-sm font-semibold transition-all duration-300 hover:translate-x-1 ${P(U.path)?"bg-gradient-primary/15 text-primary border-l-4 border-primary shadow-sm":"text-dark-brown/80 hover:bg-gradient-primary/10 hover:text-primary hover:border-l-4 hover:border-primary/30"}`,children:U.name},U.path))})]},S.path)})})})]})})}function Qs({data:s}){const l=({active:c,payload:g,label:r})=>c&&g&&g.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-2",children:r}),g.map((p,u)=>e.jsxs("p",{className:"text-sm",style:{color:p.color},children:[p.name,": â‚¹",p.value.toLocaleString("en-IN")]},u))]}):null;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Investment vs Expense Trend"}),e.jsx(ge,{width:"100%",height:300,children:e.jsxs(Mt,{data:s,children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"month",stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"}}),e.jsx($e,{stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"},tickFormatter:c=>`â‚¹${(c/1e3).toFixed(0)}k`}),e.jsx(je,{content:e.jsx(l,{})}),e.jsx(ut,{wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}}),e.jsx(qe,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,dot:{fill:"#2D5016",r:5},activeDot:{r:7},name:"Investments"}),e.jsx(qe,{type:"monotone",dataKey:"expenses",stroke:"#C85A3E",strokeWidth:3,dot:{fill:"#C85A3E",r:5},activeDot:{r:7},name:"Expenses"})]})})]})}const fs=["#2D5016","#C85A3E","#D4AF37","#87A96B","#3E2723","#D84315"];function Gs({data:s}){const l=({active:g,payload:r})=>g&&r&&r.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:r[0].name}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["â‚¹",r[0].value.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[(r[0].value/s.reduce((p,u)=>p+u.value,0)*100).toFixed(1),"% of total"]})]}):null,c=g=>`${g.name}`;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Category-wise Expenses"}),e.jsx(ge,{width:"100%",height:300,children:e.jsxs(Pt,{children:[e.jsx(Et,{data:s,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",label:c,children:s.map((g,r)=>e.jsx(At,{fill:fs[r%fs.length]},`cell-${r}`))}),e.jsx(je,{content:e.jsx(l,{})}),e.jsx(ut,{verticalAlign:"bottom",height:36,wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}})]})})]})}const hr=s=>{switch(s){case"expense":return{icon:we,color:"text-secondary",bg:"bg-secondary/20"};case"investment":return{icon:se,color:"text-primary",bg:"bg-primary/20"};case"product":return{icon:oe,color:"text-accent",bg:"bg-accent/20"};default:return{icon:ae,color:"text-dark-brown",bg:"bg-dark-brown/20"}}};function pr({activities:s}){return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Recent Activity"}),e.jsxs("button",{className:"text-sm font-semibold text-primary hover:text-sage transition-colors duration-300 flex items-center gap-1",children:["View All",e.jsx(Jt,{className:"w-4 h-4"})]})]}),s.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-dark-brown/50",children:"No recent activity"})}):e.jsx("div",{className:"space-y-4",children:s.map(l=>{const{icon:c,color:g,bg:r}=hr(l.activity_type),p=Zt(new Date(l.created_at),{addSuffix:!0});return e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-cream/30 rounded-xl hover:bg-cream/50 transition-all duration-300",children:[e.jsx("div",{className:`w-10 h-10 ${r} rounded-full flex items-center justify-center flex-shrink-0`,children:e.jsx(c,{className:`w-5 h-5 ${g}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-dark-brown leading-relaxed mb-1",children:l.description}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:p})]})]},l.id)})})]})}function br(){const{user:s}=G(),[l,c]=i.useState({totalInvestments:0,totalExpenses:0,activeProducts:0}),[g,r]=i.useState([]),[p,u]=i.useState(!0),m=$(new Date,"EEEE, MMMM d, yyyy"),b=[{month:"Jul",investments:85e3,expenses:52e3},{month:"Aug",investments:92e3,expenses:61e3},{month:"Sep",investments:78e3,expenses:48e3},{month:"Oct",investments:105e3,expenses:72e3},{month:"Nov",investments:118e3,expenses:68e3},{month:"Dec",investments:125e3,expenses:75e3}],f=[{name:"Raw Materials",value:125e3},{name:"Labor",value:85e3},{name:"Marketing",value:42e3},{name:"Packaging",value:38e3},{name:"Utilities",value:28e3},{name:"Other",value:22e3}];i.useEffect(()=>{t()},[s]);const t=async()=>{if(s)try{const[a,N,h,k]=await Promise.all([C.from("investments").select("amount").eq("user_id",s.id),C.from("expenses").select("amount").eq("user_id",s.id),C.from("products").select("id, status").eq("user_id",s.id).in("status",["planning","testing","production"]),C.from("activity_log").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(10)]),_=a.data?.reduce((j,d)=>j+parseFloat(d.amount.toString()),0)||0,y=N.data?.reduce((j,d)=>j+parseFloat(d.amount.toString()),0)||0;c({totalInvestments:_,totalExpenses:y,activeProducts:h.data?.length||0}),r(k.data||[])}catch(a){console.error("Error fetching dashboard data:",a)}finally{u(!1)}},n=l.totalInvestments-l.totalExpenses;return e.jsxs("div",{className:"min-h-screen bg-[#F5F7F5] relative overflow-hidden",children:[e.jsx(Ne,{}),e.jsx(H,{}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 md:px-8 py-8 page-transition",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"dashboard-hero",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"greeting",children:["Namaste, ",e.jsx("span",{className:"greeting-accent",children:s?.name||"User"})]}),e.jsx("p",{className:"date-time mt-2",children:m}),s?.role==="admin"&&e.jsxs("div",{className:"role-badge",children:[e.jsx(Ke,{className:"w-3 h-3"}),e.jsx("span",{children:"Admin"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[#757575] text-sm uppercase tracking-wider font-medium mb-1",children:"Net Balance"}),e.jsxs("p",{className:`text-3xl md:text-4xl font-bold ${n>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",n.toLocaleString("en-IN")]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-8 stagger-container",children:[e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Investments"}),e.jsxs("div",{className:"number",children:["â‚¹",(l.totalInvestments/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend positive mt-2",children:[e.jsx("span",{children:"â†‘"}),e.jsx("span",{children:"12%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"this month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Expenses"}),e.jsxs("div",{className:"number",children:["â‚¹",(l.totalExpenses/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend negative mt-2",children:[e.jsx("span",{children:"â†“"}),e.jsx("span",{children:"8%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"vs last month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Net Balance"}),e.jsxs("div",{className:`number ${n>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",(Math.abs(n)/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:`trend mt-2 ${n>=0?"positive":"negative"}`,children:[e.jsx("span",{children:n>=0?"â†‘":"â†“"}),e.jsx("span",{children:n>=0?"Positive":"Negative"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Active Products"}),e.jsx("div",{className:"number",children:l.activeProducts}),e.jsxs("div",{className:"trend mt-2 text-[#2D5016]",children:[e.jsx("span",{children:"â—"}),e.jsx("span",{children:"In Pipeline"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(Qs,{data:b}),e.jsx(Gs,{data:f})]}),e.jsx(pr,{activities:g})]})})]})}function _t({title:s,value:l,trend:c,icon:g,iconBgColor:r,iconColor:p,valueColor:u="text-dark-brown"}){const m=c&&c.value>=0;return e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 hover:scale-[1.02] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-0 group-hover:opacity-5 transition-opacity duration-300"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 ${r} rounded-full flex items-center justify-center`,children:e.jsx(g,{className:`w-6 h-6 ${p}`})}),c&&e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full ${m?"bg-sage/20":"bg-soft-red/20"}`,children:[m?e.jsx(se,{className:"w-3 h-3 text-sage"}):e.jsx(we,{className:"w-3 h-3 text-soft-red"}),e.jsxs("span",{className:`text-xs font-semibold ${m?"text-sage":"text-soft-red"}`,children:[Math.abs(c.value),"%"]})]})]}),e.jsx("h3",{className:"text-sm font-medium text-dark-brown/60 mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold ${u} mb-1`,children:l}),c&&e.jsx("p",{className:"text-xs text-dark-brown/50",children:c.label})]})]})}function ur(){const{user:s}=G(),[l,c]=i.useState({total:0,thisMonth:0,lastMonth:0,byCategory:[]}),[g,r]=i.useState({total:0,thisMonth:0,count:0}),[p,u]=i.useState(!0);i.useEffect(()=>{m()},[s?.id]);const m=async()=>{if(s?.id)try{const f=new Date,t=new Date(f.getFullYear(),f.getMonth(),1),n=new Date(f.getFullYear(),f.getMonth()-1,1),a=new Date(f.getFullYear(),f.getMonth(),0),{data:N,error:h}=await C.from("expenses").select("*").eq("user_id",s.id).eq("status","approved").order("expense_date",{ascending:!1});if(h)throw h;const k=N?.filter(o=>new Date(o.expense_date)>=t)||[],_=N?.filter(o=>new Date(o.expense_date)>=n&&new Date(o.expense_date)<=a)||[],y=N?.reduce((o,v)=>(o[v.category]=(o[v.category]||0)+parseFloat(v.amount),o),{})||{};c({total:N?.reduce((o,v)=>o+parseFloat(v.amount),0)||0,thisMonth:k.reduce((o,v)=>o+parseFloat(v.amount),0),lastMonth:_.reduce((o,v)=>o+parseFloat(v.amount),0),byCategory:Object.entries(y).map(([o,v])=>({category:o,total:v}))});const{data:j,error:d}=await C.from("investments").select("*").order("investment_date",{ascending:!1});d&&console.error("Error fetching investments:",d);const x=j?.filter(o=>new Date(o.investment_date)>=t)||[];r({total:j?.reduce((o,v)=>o+parseFloat(v.amount),0)||0,thisMonth:x.reduce((o,v)=>o+parseFloat(v.amount),0),count:j?.length||0})}catch(f){console.error("Error fetching financial data:",f)}finally{u(!1)}},b=l.lastMonth>0?(l.thisMonth-l.lastMonth)/l.lastMonth*100:0;return p?e.jsxs("div",{className:"min-h-screen bg-gradient-mesh",children:[e.jsx(H,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-mesh",children:[e.jsx(H,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx(De,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"Finance Overview"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Expense and investment analytics"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(_t,{title:"Total Expenses",value:`â‚¹${l.total.toLocaleString()}`,icon:Dt,trend:b>0?"up":b<0?"down":void 0,trendValue:b!==0?`${Math.abs(b).toFixed(1)}% vs last month`:void 0,iconColor:"bg-gradient-to-br from-red-500 to-pink-600"}),e.jsx(_t,{title:"This Month",value:`â‚¹${l.thisMonth.toLocaleString()}`,icon:Ce,iconColor:"bg-gradient-to-br from-blue-500 to-cyan-600"}),e.jsx(_t,{title:"Investments",value:`â‚¹${g.total.toLocaleString()}`,icon:Ra,trendValue:g.count>0?`${g.count} total`:void 0,iconColor:"bg-gradient-to-br from-green-500 to-emerald-600"}),e.jsx(_t,{title:"Net Balance",value:`â‚¹${(g.total-l.total).toLocaleString()}`,icon:se,trend:g.total>l.total?"up":"down",iconColor:"bg-gradient-gold"})]}),l.byCategory.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(Dt,{className:"w-5 h-5"}),"Expense by Category"]}),e.jsx(Gs,{data:l.byCategory.map(f=>({name:f.category,value:f.total}))})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Expenses vs Investments"]}),e.jsx(Qs,{data:[{month:"Last Month",investments:g.total-g.thisMonth,expenses:l.lastMonth},{month:"This Month",investments:g.thisMonth,expenses:l.thisMonth}]})]})]})]})]})}const js=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],gr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function fr(){const{user:s}=G(),l=me(),[c,g]=i.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[r,p]=i.useState(null),[u,m]=i.useState(""),[b,f]=i.useState([]),[t,n]=i.useState([]),[a,N]=i.useState(!1),[h,k]=i.useState({}),[_,y]=i.useState(!1),[j,d]=i.useState(0);i.useEffect(()=>{x(),o()},[]);const x=async()=>{try{const{data:S,error:A}=await C.from("vendors").select("id, name").order("name");if(A)throw A;f(S||[])}catch(S){console.error("Error fetching vendors:",S)}},o=async()=>{try{const{data:S,error:A}=await C.from("users").select("id, name").order("name");if(A)throw A;n(S||[])}catch(S){console.error("Error fetching partners:",S)}},v=S=>{const A=S.target.files?.[0];if(A){if(A.size>5*1024*1024){k({...h,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes(A.type)){k({...h,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(p(A),k({...h,bill:""}),A.type.startsWith("image/")){const U=new FileReader;U.onloadend=()=>{m(U.result)},U.readAsDataURL(A)}else m("")}},w=()=>{const S={};return c.category||(S.category="Category is required"),(!c.amount||parseFloat(c.amount)<=0)&&(S.amount="Amount must be greater than 0"),c.date||(S.date="Date is required"),c.paymentMode||(S.paymentMode="Payment mode is required"),c.paidBy||(S.paidBy="Please select who paid"),k(S),Object.keys(S).length===0},P=async()=>{if(!r||!s)return null;try{const S=r.name.split(".").pop(),A=`${s.id}/${Date.now()}.${S}`,{error:U}=await C.storage.from("expense-bills").upload(A,r);if(U)throw U;const{data:z}=C.storage.from("expense-bills").getPublicUrl(A);return z.publicUrl}catch(S){return console.error("Error uploading bill:",S),null}},T=async(S="pending")=>{if(!(S==="pending"&&!w())){N(!0);try{let A=null;r&&(A=await P());const U={user_id:s?.id,category:c.category,subcategory:c.subcategory||null,amount:parseFloat(c.amount),expense_date:c.date,payment_mode:c.paymentMode,paid_by:c.paidBy,vendor_id:c.vendorId||null,bill_url:A,purpose:c.purpose||null,status:S==="draft"?"draft":"pending",submitted_by:s?.id,submitted_at:new Date().toISOString()},{error:z}=await C.from("expenses").insert(U);if(z)throw z;if(S!=="draft"){const W=js.find(ee=>ee.value===c.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense",description:`${s?.name} added expense: â‚¹${parseFloat(c.amount).toLocaleString("en-IN")} for ${W?.label||c.category}`})}y(!0),setTimeout(()=>{l("/expenses")},2e3)}catch(A){console.error("Error submitting expense:",A),k({submit:"Failed to submit expense. Please try again."})}finally{N(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(H,{}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Add New Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Submit an expense for approval"})]}),_&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx(ts,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense submitted for approval!"})]}),h.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:h.submit})]}),e.jsx("form",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:c.category,onChange:S=>g({...c,category:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${h.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),js.map(S=>e.jsxs("option",{value:S.value,children:[S.icon," ",S.label]},S.value))]}),h.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:c.subcategory,onChange:S=>g({...c,subcategory:S.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:c.amount,onChange:S=>g({...c,amount:S.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${h.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),h.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:c.date,onChange:S=>g({...c,date:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${h.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),h.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:c.paidBy,onChange:S=>g({...c,paidBy:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${h.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),t.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]}),h.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:gr.map(S=>e.jsxs("button",{type:"button",onClick:()=>g({...c,paymentMode:S.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${c.paymentMode===S.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:S.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:S.label})]},S.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:c.vendorId,onChange:S=>g({...c,vendorId:S.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),b.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:v,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:r?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[u&&e.jsx("img",{src:u,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:r.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(r.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:S=>{S.preventDefault(),p(null),m("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(ce,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),h.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[j,"/500"]})]}),e.jsx("textarea",{value:c.purpose,onChange:S=>{S.target.value.length<=500&&(g({...c,purpose:S.target.value}),d(S.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>T("pending"),disabled:a,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-5 h-5 animate-spin"}),"Submitting..."]}):"Submit for Approval"}),e.jsx("button",{type:"button",onClick:()=>T("draft"),disabled:a,className:"px-8 py-4 bg-transparent text-primary font-semibold rounded-xl border-2 border-primary hover:bg-primary hover:text-cream transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save as Draft"}),e.jsx("button",{type:"button",onClick:()=>l("/expenses"),disabled:a,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]})}const ys=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],jr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function yr(){const{user:s}=G(),l=me(),{id:c}=Ye(),g=s?.role==="admin",[r,p]=i.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[u,m]=i.useState(null),[b,f]=i.useState(""),[t,n]=i.useState(""),[a,N]=i.useState([]),[h,k]=i.useState([]),[_,y]=i.useState(!1),[j,d]=i.useState(!0),[x,o]=i.useState({}),[v,w]=i.useState(!1),[P,T]=i.useState(0);i.useEffect(()=>{if(!g){l("/expenses");return}S(),A(),U()},[c,g]);const S=async()=>{if(c)try{const{data:D,error:L}=await C.from("expenses").select("*").eq("id",c).maybeSingle();if(L)throw L;D&&(p({category:D.category,subcategory:D.subcategory||"",amount:D.amount.toString(),date:D.expense_date,paymentMode:D.payment_mode,paidBy:D.paid_by,vendorId:D.vendor_id||"",purpose:D.purpose||""}),T(D.purpose?.length||0),n(D.bill_url||""))}catch(D){console.error("Error fetching expense:",D),alert("Failed to load expense. Redirecting to expense list."),l("/expenses")}finally{d(!1)}},A=async()=>{try{const{data:D,error:L}=await C.from("vendors").select("id, name").order("name");if(L)throw L;N(D||[])}catch(D){console.error("Error fetching vendors:",D)}},U=async()=>{try{const{data:D,error:L}=await C.from("users").select("id, name").order("name");if(L)throw L;k(D||[])}catch(D){console.error("Error fetching partners:",D)}},z=D=>{const L=D.target.files?.[0];if(L){if(L.size>5*1024*1024){o({...x,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes(L.type)){o({...x,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(m(L),o({...x,bill:""}),L.type.startsWith("image/")){const I=new FileReader;I.onloadend=()=>{f(I.result)},I.readAsDataURL(L)}else f("")}},W=()=>{const D={};return r.category||(D.category="Category is required"),(!r.amount||parseFloat(r.amount)<=0)&&(D.amount="Amount must be greater than 0"),r.date||(D.date="Date is required"),r.paymentMode||(D.paymentMode="Payment mode is required"),r.paidBy||(D.paidBy="Please select who paid"),o(D),Object.keys(D).length===0},ee=async()=>{if(!u||!s)return null;try{const D=u.name.split(".").pop(),L=`${s.id}/${Date.now()}.${D}`,{error:I}=await C.storage.from("expense-bills").upload(L,u);if(I)throw I;const{data:q}=C.storage.from("expense-bills").getPublicUrl(L);return q.publicUrl}catch(D){return console.error("Error uploading bill:",D),null}},le=async D=>{if(D.preventDefault(),!!W()){y(!0);try{let L=t;if(u){const K=await ee();K&&(L=K)}const I={category:r.category,subcategory:r.subcategory||null,amount:parseFloat(r.amount),expense_date:r.date,payment_mode:r.paymentMode,paid_by:r.paidBy,vendor_id:r.vendorId||null,bill_url:L,purpose:r.purpose||null},{error:q}=await C.from("expenses").update(I).eq("id",c);if(q)throw q;const O=ys.find(K=>K.value===r.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense_updated",description:`${s?.name} updated expense: â‚¹${parseFloat(r.amount).toLocaleString("en-IN")} for ${O?.label||r.category}`}),w(!0),setTimeout(()=>{l("/expenses")},2e3)}catch(L){console.error("Error updating expense:",L),o({submit:"Failed to update expense. Please try again."})}finally{y(!1)}}};return g?j?e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-73px)]",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})]}):e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(H,{}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>l("/expenses"),className:"flex items-center gap-2 text-primary hover:text-primary/80 font-medium mb-4 transition-colors",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Back to Expenses"]}),e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Edit Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Update expense details"})]}),v&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx(ts,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense updated successfully!"})]}),x.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:x.submit})]}),e.jsx("form",{onSubmit:le,className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:r.category,onChange:D=>p({...r,category:D.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${x.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),ys.map(D=>e.jsxs("option",{value:D.value,children:[D.icon," ",D.label]},D.value))]}),x.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:x.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:r.subcategory,onChange:D=>p({...r,subcategory:D.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:r.amount,onChange:D=>p({...r,amount:D.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${x.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),x.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:x.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:r.date,onChange:D=>p({...r,date:D.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${x.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),x.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:x.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:r.paidBy,onChange:D=>p({...r,paidBy:D.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${x.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),h.map(D=>e.jsx("option",{value:D.id,children:D.name},D.id))]}),x.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:x.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:jr.map(D=>e.jsxs("button",{type:"button",onClick:()=>p({...r,paymentMode:D.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${r.paymentMode===D.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:D.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:D.label})]},D.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:r.vendorId,onChange:D=>p({...r,vendorId:D.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),a.map(D=>e.jsx("option",{value:D.id,children:D.name},D.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload"}),t&&!u&&e.jsx("div",{className:"mb-4 p-4 bg-sage/5 border-2 border-sage/20 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:"ðŸ“„"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"Current Bill"}),e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline",children:"View existing bill"})]})]}),e.jsx("button",{type:"button",onClick:()=>n(""),className:"text-xs text-soft-red hover:underline",children:"Remove"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:z,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:u?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[b&&e.jsx("img",{src:b,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:u.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(u.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:D=>{D.preventDefault(),m(null),f("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(ce,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:t?"Upload new bill to replace existing":"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),x.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:x.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[P,"/500"]})]}),e.jsx("textarea",{value:r.purpose,onChange:D=>{D.target.value.length<=500&&(p({...r,purpose:D.target.value}),T(D.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"submit",disabled:_,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-5 h-5 animate-spin"}),"Updating..."]}):"Update Expense"}),e.jsx("button",{type:"button",onClick:()=>l("/expenses"),disabled:_,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]}):null}const wr=["Duplicate entry","Insufficient proof","Incorrect amount","Wrong category","Not a business expense","Missing receipt","Other (specify below)"];function Ys({isOpen:s,onClose:l,onConfirm:c,type:g,expense:r,loading:p=!1}){const[u,m]=i.useState(""),[b,f]=i.useState(""),[t,n]=i.useState("");if(!s)return null;const a=()=>{if(g==="reject"){const h=b==="Other (specify below)"?t:b;if(!h.trim()){alert("Please provide a reason for rejection");return}c(void 0,h)}else c(u)},N=h=>h.split("_").map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:`p-6 border-b-2 ${g==="approve"?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g==="approve"?e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-green-600"})}):e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-gray-900",children:g==="approve"?"Approve Expense":"Reject Expense"}),e.jsx("p",{className:"text-sm text-gray-600",children:g==="approve"?"Confirm approval of this expense":"Please provide a reason"})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-5 h-5 text-gray-600"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"Expense Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[N(r.category),r.subcategory&&` - ${r.subcategory}`]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-orange-600 text-xl",children:["â‚¹",r.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Date(r.expense_date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment:"}),e.jsx("span",{className:"font-semibold text-gray-900 uppercase",children:r.payment_mode.replace("_"," ")})]})]})]}),g==="reject"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Reason for Rejection ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:b,onChange:h=>f(h.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select a reason"}),wr.map(h=>e.jsx("option",{value:h,children:h},h))]})]}),b==="Other (specify below)"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Specify Reason"}),e.jsx("textarea",{value:t,onChange:h=>n(h.target.value),placeholder:"Please provide detailed reason...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(fe,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:"The submitter will be notified of this rejection and the reason provided."})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Comments (Optional)"}),e.jsx("textarea",{value:u,onChange:h=>m(h.target.value),placeholder:"Add any comments or notes...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:l,disabled:p,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 font-bold rounded-xl hover:bg-gray-50 transition-all duration-300 disabled:opacity-50 shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:p,className:`flex-1 px-6 py-3 font-bold rounded-xl shadow-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${g==="approve"?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white":"bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white"}`,children:p?"Processing...":g==="approve"?"Confirm Approval":"Confirm Rejection"})]})]})]})]})}function Nr({isOpen:s,onClose:l,billUrl:c,expenseDetails:g}){const[r,p]=i.useState(100),[u,m]=i.useState(0);if(!s)return null;const b=c.toLowerCase().endsWith(".pdf"),f=()=>{window.open(c,"_blank")},t=()=>{p(h=>Math.min(h+25,200))},n=()=>{p(h=>Math.max(h-25,50))},a=()=>{m(h=>(h+90)%360)},N=h=>h.split("_").map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-dark-brown/90 backdrop-blur-md",children:[e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between",children:[e.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-xl px-4 py-3 shadow-soft",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:N(g.category)})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"font-bold text-secondary",children:["â‚¹",g.amount.toLocaleString("en-IN")]})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:new Date(g.date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!b&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,disabled:r<=50,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(tr,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"px-4 py-3 bg-white/90 backdrop-blur-sm rounded-lg shadow-soft",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[r,"%"]})}),e.jsx("button",{onClick:t,disabled:r>=200,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(er,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("button",{onClick:a,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 shadow-soft",children:e.jsx(Oa,{className:"w-5 h-5 text-dark-brown"})})]}),e.jsx("button",{onClick:f,className:"p-3 bg-primary/90 backdrop-blur-sm rounded-lg hover:bg-primary transition-all duration-300 shadow-soft",children:e.jsx(ke,{className:"w-5 h-5 text-cream"})}),e.jsx("button",{onClick:l,className:"p-3 bg-soft-red/90 backdrop-blur-sm rounded-lg hover:bg-soft-red transition-all duration-300 shadow-soft",children:e.jsx(ce,{className:"w-5 h-5 text-white"})})]})]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-24 overflow-auto",children:b?e.jsx("iframe",{src:c,className:"w-full h-full bg-white rounded-xl shadow-soft-lg",title:"Bill PDF"}):e.jsx("img",{src:c,alt:"Bill",className:"max-w-full max-h-full object-contain rounded-xl shadow-soft-lg transition-transform duration-300",style:{transform:`scale(${r/100}) rotate(${u}deg)`}})})]})}const lt=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20 text-sage"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-accent/20 text-accent"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-dark-brown/20 text-dark-brown"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš",color:"bg-primary/20 text-primary"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢",color:"bg-secondary/20 text-secondary"},{value:"lab_testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-sage/30 text-sage"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ",color:"bg-accent/30 text-accent"},{value:"utilities",label:"Utilities",icon:"âš¡",color:"bg-primary/30 text-primary"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢",color:"bg-dark-brown/30 text-dark-brown"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥",color:"bg-secondary/30 text-secondary"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§",color:"bg-sage/40 text-sage"},{value:"other",label:"Other",icon:"ðŸ“±",color:"bg-dark-brown/40 text-dark-brown"}];function vr(){const{user:s}=G(),l=me(),[c,g]=i.useState([]),[r,p]=i.useState(!0),[u,m]=i.useState(""),[b,f]=i.useState("all"),[t,n]=i.useState(null),[a,N]=i.useState(!1),[h,k]=i.useState("approve"),[_,y]=i.useState(!1),[j,d]=i.useState(null),[x,o]=i.useState(1),[v,w]=i.useState(20),[P,T]=i.useState(null),[S,A]=i.useState(!1),[U,z]=i.useState(""),[W,ee]=i.useState(""),[le,D]=i.useState([]),[L,I]=i.useState([]),[q,O]=i.useState("expense_date"),[K,be]=i.useState("desc"),Me=s?.role==="admin";i.useEffect(()=>{Pe();const M=C.channel("expenses-changes").on("postgres_changes",{event:"*",schema:"public",table:"expenses"},()=>{Pe()}).subscribe();return()=>{C.removeChannel(M)}},[]);const Pe=async()=>{if(s)try{let M=C.from("expenses").select(`
          *,
          users_paid_by:users!expenses_paid_by_fkey(name),
          users_submitted_by:users!expenses_submitted_by_fkey(name),
          users_approved_by:users!expenses_approved_by_fkey(name),
          vendors(name)
        `);Me||(M=M.eq("submitted_by",s.id));const{data:B,error:V}=await M.order(q,{ascending:K==="asc"});if(V)throw V;g(B||[])}catch(M){console.error("Error fetching expenses:",M)}finally{p(!1)}},jt=M=>{n(M),k("approve"),N(!0)},_e=M=>{n(M),k("reject"),N(!0)},Oe=async(M,B)=>{if(!(!t||!s)){T(t.id);try{const V={status:h==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};h==="approve"&&M?V.approval_comments=M:h==="reject"&&B&&(V.rejection_reason=B);const{error:Nt}=await C.from("expenses").update(V).eq("id",t.id);if(Nt)throw Nt;const Ut=lt.find(He=>He.value===t.category);await C.from("activity_log").insert({user_id:s.id,activity_type:h==="approve"?"expense_approved":"expense_rejected",description:`${s.name} ${h==="approve"?"approved":"rejected"} expense: â‚¹${t.amount.toLocaleString("en-IN")} for ${Ut?.label||t.category}`}),await Pe(),N(!1),n(null)}catch(V){console.error("Error processing approval:",V),alert("Failed to process approval. Please try again.")}finally{T(null)}}},Ze=async M=>{if(confirm("Are you sure you want to delete this expense? This action cannot be undone."))try{const{error:B}=await C.from("expenses").delete().eq("id",M);if(B)throw B;await Pe()}catch(B){console.error("Error deleting expense:",B),alert("Failed to delete expense. Please try again.")}},yt=M=>{M.bill_url&&(n(M),y(!0),C.from("expenses").update({viewed_bill:!0}).eq("id",M.id).then())},Je=M=>{switch(M){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},Ee=M=>lt.find(B=>B.value===M)||lt[lt.length-1],Ae=c.filter(M=>{if(b==="pending"&&M.status!=="pending"||b==="approved"&&M.status!=="approved"||b==="rejected"&&M.status!=="rejected"||b==="my_expenses"&&M.submitted_by!==s?.id)return!1;if(u){const B=u.toLowerCase();if(!M.category.toLowerCase().includes(B)&&!M.subcategory?.toLowerCase().includes(B)&&!M.purpose?.toLowerCase().includes(B)&&!M.vendors?.name.toLowerCase().includes(B))return!1}return!(U&&M.expense_date<U||W&&M.expense_date>W||le.length>0&&!le.includes(M.category)||L.length>0&&!L.includes(M.payment_mode))}),wt=Ae.slice((x-1)*v,x*v),Ie=Math.ceil(Ae.length/v),Lt=M=>M==="all"?c.length:M==="pending"?c.filter(B=>B.status==="pending").length:M==="approved"?c.filter(B=>B.status==="approved").length:M==="rejected"?c.filter(B=>B.status==="rejected").length:M==="my_expenses"?c.filter(B=>B.submitted_by===s?.id).length:0,$t=c.filter(M=>{const B=new Date(M.expense_date),V=new Date;return B.getMonth()===V.getMonth()&&B.getFullYear()===V.getFullYear()}).reduce((M,B)=>M+B.amount,0),qt=M=>{D(B=>B.includes(M)?B.filter(V=>V!==M):[...B,M])},Rt=M=>{I(B=>B.includes(M)?B.filter(V=>V!==M):[...B,M])},Xe=()=>{m(""),z(""),ee(""),D([]),I([]),f("all")},Ve=M=>{q===M?be(B=>B==="asc"?"desc":"asc"):(O(M),be("desc"))};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(H,{}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Expense Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Manage and approve all expenses"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",$t.toLocaleString("en-IN")]})]}),e.jsxs("button",{onClick:()=>l("/expenses/add"),className:"flex items-center gap-2 px-6 py-3 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Expense"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 mb-6",children:[e.jsx("div",{className:"flex items-center gap-2 mb-4 overflow-x-auto pb-2",children:["all","pending","approved","rejected","my_expenses"].map(M=>e.jsxs("button",{onClick:()=>f(M),className:`px-4 py-2 rounded-lg font-medium whitespace-nowrap transition-all duration-300 flex items-center gap-2 ${b===M?"bg-primary text-cream shadow-soft":"bg-cream/50 text-dark-brown hover:bg-primary/10"}`,children:[M==="all"&&"All",M==="pending"&&"â³ Pending",M==="approved"&&"âœ… Approved",M==="rejected"&&"âŒ Rejected",M==="my_expenses"&&"My Expenses",e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${b===M?"bg-cream/20 text-cream":"bg-dark-brown/10 text-dark-brown"}`,children:Lt(M)})]},M))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ft,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search by category, vendor, or purpose...",value:u,onChange:M=>m(M.target.value),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsxs("button",{onClick:()=>A(!S),className:`flex items-center gap-2 px-6 py-3 border-2 font-semibold rounded-xl transition-all duration-300 ${S||le.length>0||L.length>0||U||W?"border-primary bg-primary text-cream":"border-primary text-primary hover:bg-primary hover:text-cream"}`,children:[e.jsx(Ls,{className:"w-5 h-5"}),"Filters",le.length+L.length+(U?1:0)+(W?1:0)>0&&e.jsx("span",{className:"px-2 py-0.5 bg-cream/20 rounded-full text-xs font-bold",children:le.length+L.length+(U?1:0)+(W?1:0)})]}),e.jsxs("button",{onClick:()=>alert("Export feature coming soon"),className:"flex items-center gap-2 px-6 py-3 border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export"]})]}),S&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:U,onChange:M=>z(M.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:W,onChange:M=>ee(M.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:lt.map(M=>e.jsxs("button",{onClick:()=>qt(M.value),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${le.includes(M.value)?M.color:"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:[M.icon," ",M.label]},M.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Mode"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["cash","upi","bank_transfer","card"].map(M=>e.jsx("button",{onClick:()=>Rt(M),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${L.includes(M)?"bg-primary text-cream":"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:M.toUpperCase().replace("_"," ")},M))})]}),e.jsx("button",{onClick:Xe,className:"w-full py-2 text-soft-red font-semibold hover:bg-soft-red/10 rounded-lg transition-all",children:"Reset All Filters"})]})]})]}),r?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading expenses..."})}):Ae.length===0?e.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No expenses found"}),e.jsxs("button",{onClick:()=>l("/expenses/add"),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-white font-semibold rounded-xl hover:scale-105 transition-all duration-300",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Your First Expense"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-primary/10",children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>Ve("expense_date"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Date ",q==="expense_date"&&(K==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsxs("th",{onClick:()=>Ve("amount"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Amount ",q==="amount"&&(K==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Payment"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Bill"}),e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:wt.map((M,B)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{onClick:()=>d(j===M.id?null:M.id),className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors cursor-pointer ${B%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:$(new Date(M.expense_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Ee(M.category).color}`,children:[Ee(M.category).icon," ",Ee(M.category).label]})}),M.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1",children:M.subcategory})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",M.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:M.users_paid_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-xs font-semibold text-dark-brown uppercase",children:M.payment_mode.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-4",children:Je(M.status)}),e.jsx("td",{className:"px-4 py-4",children:M.bill_url?e.jsx("button",{onClick:V=>{V.stopPropagation(),yt(M)},className:"p-2 hover:bg-primary/10 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No bill"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[Me&&M.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:V=>{V.stopPropagation(),jt(M)},disabled:P===M.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(Y,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:V=>{V.stopPropagation(),_e(M)},disabled:P===M.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Se,{className:"w-4 h-4 text-soft-red"})})]}),Me&&e.jsx("button",{onClick:V=>{V.stopPropagation(),l(`/expenses/edit/${M.id}`)},className:"p-2 hover:bg-accent/10 rounded-lg transition-colors",title:"Edit",children:e.jsx(us,{className:"w-4 h-4 text-accent"})}),Me&&e.jsx("button",{onClick:V=>{V.stopPropagation(),Ze(M.id)},className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(de,{className:"w-4 h-4 text-soft-red"})})]})})]},M.id),j===M.id&&e.jsx("tr",{className:"bg-primary/5",children:e.jsx("td",{colSpan:8,className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-3",children:[M.purpose&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Purpose/Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.purpose})]}),M.vendors&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Vendor"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.vendors.name})]}),M.approval_comments&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-sage mb-1",children:"Approval Comments"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.approval_comments})]}),M.rejection_reason&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-soft-red mb-1",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.rejection_reason})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-dark-brown/50",children:[e.jsxs("span",{children:["Submitted by: ",M.users_submitted_by?.name]}),M.users_approved_by&&e.jsxs("span",{children:["Approved by: ",M.users_approved_by.name]})]})]})})})]}))})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:wt.map(M=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 hover:shadow-soft-lg transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Ee(M.category).color}`,children:[Ee(M.category).icon," ",Ee(M.category).label]}),Je(M.status)]}),M.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mb-2",children:M.subcategory})]}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",M.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Date:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:$(new Date(M.expense_date),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Paid by:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:M.users_paid_by?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Payment:"}),e.jsx("span",{className:"font-medium text-dark-brown uppercase",children:M.payment_mode.replace("_"," ")})]})]}),M.purpose&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Purpose"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.purpose})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4 pt-3 border-t border-dark-brown/10",children:[M.bill_url&&e.jsxs("button",{onClick:()=>yt(M),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-primary/10 text-primary font-semibold rounded-lg hover:bg-primary/20 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"View Bill"]}),Me&&M.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>jt(M),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-sage/10 text-sage font-semibold rounded-lg hover:bg-sage/20 transition-colors",children:[e.jsx(Y,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>_e(M),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red font-semibold rounded-lg hover:bg-soft-red/20 transition-colors",children:[e.jsx(Se,{className:"w-4 h-4"}),"Reject"]})]}),Me&&e.jsxs("button",{onClick:()=>l(`/expenses/edit/${M.id}`),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-accent/10 text-accent font-semibold rounded-lg hover:bg-accent/20 transition-colors",children:[e.jsx(us,{className:"w-4 h-4"}),"Edit"]})]})]},M.id))}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 mt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Items per page:"}),e.jsxs("select",{value:v,onChange:M=>{w(Number(M.target.value)),o(1)},className:"px-3 py-1 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsxs("span",{className:"text-sm text-dark-brown/70",children:["Showing ",(x-1)*v+1," - ",Math.min(x*v,Ae.length)," of ",Ae.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(M=>Math.max(1,M-1)),disabled:x===1,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(_a,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,Ie)},(M,B)=>{let V;return Ie<=5||x<=3?V=B+1:x>=Ie-2?V=Ie-4+B:V=x-2+B,e.jsx("button",{onClick:()=>o(V),className:`w-10 h-10 rounded-lg font-semibold transition-all ${x===V?"bg-primary text-cream":"border-2 border-dark-brown/10 text-dark-brown hover:bg-primary/10"}`,children:V},V)})}),e.jsx("button",{onClick:()=>o(M=>Math.min(Ie,M+1)),disabled:x===Ie,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ca,{className:"w-5 h-5 text-dark-brown"})})]})]})})]})]})}),a&&t&&e.jsx(Ys,{isOpen:a,onClose:()=>{N(!1),n(null)},onConfirm:Oe,type:h,expense:t,loading:P===t.id}),_&&t&&t.bill_url&&e.jsx(Nr,{isOpen:_,onClose:()=>{y(!1),n(null)},billUrl:t.bill_url,expenseDetails:{category:t.category,amount:t.amount,date:t.expense_date}})]})}function kr({expenses:s,investments:l,vendors:c}){const g=s.filter(v=>v.status==="approved"),r=l.filter(v=>v.status==="approved"),p=g.reduce((v,w)=>v+w.amount,0),u=r.reduce((v,w)=>v+w.amount,0),m=u-p,b=u>0?m/u*100:0,f={};for(let v=11;v>=0;v--){const w=dt(new Date,v),P=$(w,"yyyy-MM"),T=$(w,"MMM yyyy");f[P]={month:T,investments:0,expenses:0,net:0}}r.forEach(v=>{const w=$(new Date(v.investment_date),"yyyy-MM");f[w]&&(f[w].investments+=v.amount)}),g.forEach(v=>{const w=$(new Date(v.expense_date),"yyyy-MM");f[w]&&(f[w].expenses+=v.amount)});const t=Object.values(f).map(v=>({...v,net:v.investments-v.expenses})),n=g.length>0?p/Object.keys(f).length:0,a=g.reduce((v,w)=>(v[w.category]||(v[w.category]=0),v[w.category]+=w.amount,v),{}),N=Object.entries(a).sort((v,w)=>w[1]-v[1])[0],h=g.reduce((v,w)=>{const P=w.paid_by||w.user_id;return v[P]||(v[P]={name:w.users_paid_by?.name||w.users?.name||"Unknown",total:0}),v[P].total+=w.amount,v},{}),k=Object.values(h).sort((v,w)=>w.total-v.total)[0],_=g.length>0?p/g.length:0,y=s.filter(v=>v.status==="pending").length,j=g.reduce((v,w)=>{const P=w.payment_mode||"unknown";return v[P]=(v[P]||0)+1,v},{}),d=Object.entries(j).sort((v,w)=>w[1]-v[1])[0],x=t.reduce((v,w)=>w.expenses>v.expenses?w:v,t[0]||{month:"N/A",expenses:0}),o=v=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[v]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/30 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Investments"})]}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-1",children:["â‚¹",u.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/20 to-secondary/10 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/30 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Expenses"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",p.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Spent"})]}),e.jsxs("div",{className:`bg-gradient-to-br rounded-xl p-6 border-2 shadow-soft ${m>=0?"from-accent/20 to-accent/10 border-accent/30":"from-soft-red/20 to-soft-red/10 border-soft-red/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${m>=0?"bg-accent/30":"bg-soft-red/30"}`,children:m>=0?e.jsx(se,{className:"w-6 h-6 text-accent"}):e.jsx(we,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:`text-xs font-semibold uppercase tracking-wide ${m>=0?"text-accent":"text-soft-red"}`,children:"Net Balance"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${m>=0?"text-accent":"text-soft-red"}`,children:["â‚¹",Math.abs(m).toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[b.toFixed(1),"% margin"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/30 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Burn Rate"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary mb-1",children:["â‚¹",n.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Month Avg"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-3xl",children:N?o(N[0]):"ðŸ“Š"}),e.jsx(ns,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Category"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1",children:N?N[0]:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",N?N[1].toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:k?k.name.charAt(0):"?"}),e.jsx(ve,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Spender"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1 truncate",children:k?k.name:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",k?k.total.toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(mt,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Avg Expense"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",_.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending Approvals"}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:y})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment vs Expense Trend (12 Months)"}),e.jsx(ge,{width:"100%",height:400,children:e.jsxs(da,{data:t,children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx($e,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(je,{formatter:v=>`â‚¹${v.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ut,{}),e.jsx(ca,{type:"monotone",dataKey:"net",fill:"#B8860B",fillOpacity:.1,stroke:"none",name:"Net Balance"}),e.jsx(qe,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,name:"Investments",dot:{fill:"#2D5016",r:5}}),e.jsx(qe,{type:"monotone",dataKey:"expenses",stroke:"#C17817",strokeWidth:3,name:"Expenses",dot:{fill:"#C17817",r:5}})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-accent/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent",children:"Quick Insight"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Highest spending month:"})}),e.jsx("p",{className:"text-lg font-bold text-secondary",children:x.month}),e.jsxs("p",{className:"text-xl font-bold text-accent",children:["â‚¹",x.expenses.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-sage/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(mt,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage",children:"Payment Mode"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Most used:"})}),e.jsx("p",{className:"text-xl font-bold text-secondary uppercase",children:d?d[0]:"N/A"}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[d?d[1]:0," transactions"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-primary/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-sm font-semibold text-primary",children:"Efficiency"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Approval rate:"})}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[s.length>0?(g.length/s.length*100).toFixed(0):0,"%"]})]})]})]})}const Ct=["#C17817","#2D5016","#B8860B","#8B4513","#D4AF37","#CD853F","#DAA520","#A0522D"];function _r({expenses:s}){const[l,c]=i.useState(null),[g,r]=i.useState("all"),p=s.filter(y=>y.status==="approved"),b=(y=>{if(g==="all")return y;const j=parseInt(g),d=dt(new Date,j);return y.filter(x=>new Date(x.expense_date)>=d)})(p).reduce((y,j)=>{const d=j.category;return y[d]||(y[d]={category:d,total:0,count:0,expenses:[]}),y[d].total+=j.amount,y[d].count+=1,y[d].expenses.push(j),y},{}),f=Object.values(b).sort((y,j)=>j.total-y.total),t=f.reduce((y,j)=>y+j.total,0),n=f.map(y=>({name:y.category,value:y.total})),a=f.map(y=>({category:y.category,amount:y.total})),N=y=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[y]||"ðŸ’°",h=y=>{const j={};for(let x=5;x>=0;x--){const o=dt(new Date,x),v=$(o,"MMM");j[v]=0}return p.filter(x=>x.category===y).forEach(x=>{const o=$(new Date(x.expense_date),"MMM");j[o]!==void 0&&(j[o]+=x.amount)}),Object.entries(j).map(([x,o])=>({month:x,value:o}))},k=y=>{const j=new Date().getMonth(),d=new Date(new Date().setMonth(j-1)).getMonth(),x=p.filter(w=>w.category===y&&new Date(w.expense_date).getMonth()===j).reduce((w,P)=>w+P.amount,0),o=p.filter(w=>w.category===y&&new Date(w.expense_date).getMonth()===d).reduce((w,P)=>w+P.amount,0);if(o===0)return{direction:"neutral",percent:0};const v=(x-o)/o*100;return{direction:v>0?"up":v<0?"down":"neutral",percent:Math.abs(v)}},_=l?b[l]:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4 items-center mb-6",children:e.jsxs("select",{value:g,onChange:y=>r(y.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"1",children:"Last Month"}),e.jsx("option",{value:"3",children:"Last 3 Months"}),e.jsx("option",{value:"6",children:"Last 6 Months"}),e.jsx("option",{value:"12",children:"Last Year"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map((y,j)=>{const d=t>0?y.total/t*100:0,x=y.count>0?y.total/y.count:0,o=k(y.category),v=h(y.category);return e.jsxs("div",{onClick:()=>c(y.category),className:`bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 shadow-soft cursor-pointer transition-all duration-300 hover:shadow-soft-lg hover:scale-[1.02] ${l===y.category?"border-accent ring-2 ring-accent/20":"border-dark-brown/10"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:N(y.category)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary",children:y.category}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[y.count," transactions"]})]})]}),e.jsxs("div",{className:"text-right",children:[o.direction==="up"&&e.jsxs("div",{className:"flex items-center gap-1 text-soft-red text-xs",children:[e.jsx(se,{className:"w-3 h-3"}),o.percent.toFixed(0),"%"]}),o.direction==="down"&&e.jsxs("div",{className:"flex items-center gap-1 text-sage text-xs",children:[e.jsx(we,{className:"w-3 h-3"}),o.percent.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",y.total.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[d.toFixed(1),"% of total expenses"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Average per transaction"}),e.jsxs("p",{className:"text-lg font-semibold text-accent",children:["â‚¹",x.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsx("div",{className:"h-16",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsx(Mt,{data:v,children:e.jsx(qe,{type:"monotone",dataKey:"value",stroke:Ct[j%Ct.length],strokeWidth:2,dot:!1})})})})]},y.category)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Distribution"}),n.length>0?e.jsx(ge,{width:"100%",height:350,children:e.jsxs(Pt,{children:[e.jsx(Et,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:({name:y,percent:j})=>`${y} (${(j*100).toFixed(0)}%)`,outerRadius:120,fill:"#8884d8",dataKey:"value",onClick:y=>c(y.name),children:n.map((y,j)=>e.jsx(At,{fill:Ct[j%Ct.length],className:"cursor-pointer hover:opacity-80 transition-opacity"},`cell-${j}`))}),e.jsx(je,{formatter:y=>`â‚¹${y.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Comparison"}),a.length>0?e.jsx(ge,{width:"100%",height:350,children:e.jsxs(It,{data:a,layout:"vertical",children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx($e,{dataKey:"category",type:"category",width:120,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(je,{formatter:y=>`â‚¹${y.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ct,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0],onClick:y=>c(y.category),className:"cursor-pointer"})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]})]}),_&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-heading text-2xl font-bold text-primary flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:N(_.category)}),_.category," Details"]}),e.jsx("button",{onClick:()=>c(null),className:"px-4 py-2 text-sm font-semibold text-dark-brown hover:bg-dark-brown/5 rounded-lg transition-colors",children:"Clear Selection"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Subcategory"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"})]})}),e.jsx("tbody",{children:_.expenses.sort((y,j)=>new Date(j.expense_date).getTime()-new Date(y.expense_date).getTime()).map((y,j)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${j%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:$(new Date(y.expense_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:y.subcategory||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-lg font-bold text-secondary",children:["â‚¹",y.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:y.users_paid_by?.name||y.users?.name||"Unknown"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:y.vendors?.name||"-"})]},y.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Subtotal:"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-2xl font-bold text-accent",children:["â‚¹",_.total.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:2})]})})]})})]})]})}function Cr({expenses:s,investments:l}){const c=s.filter(h=>h.status==="approved"),g=l.filter(h=>h.status==="approved"),r=c.reduce((h,k)=>{const _=k.paid_by||k.user_id,y=k.users_paid_by?.name||k.users?.name||"Unknown";h[_]||(h[_]={id:_,name:y,totalExpenses:0,totalInvestments:0,expenseCount:0,approvedCount:0,submittedCount:0,paymentModes:{},categories:{}}),h[_].totalExpenses+=k.amount,h[_].expenseCount+=1,k.status==="approved"&&(h[_].approvedCount+=1);const j=k.payment_mode||"unknown";h[_].paymentModes[j]=(h[_].paymentModes[j]||0)+1;const d=k.category;return h[_].categories[d]=(h[_].categories[d]||0)+k.amount,h},{});s.forEach(h=>{const k=h.submitted_by,_=h.users_submitted_by?.name;k&&_&&(r[k]||(r[k]={id:k,name:_,totalExpenses:0,totalInvestments:0,expenseCount:0,approvedCount:0,submittedCount:0,paymentModes:{},categories:{}}),r[k].submittedCount+=1)}),g.forEach(h=>{const k=h.partner_id,_=h.users?.name;r[k]||(r[k]={id:k,name:_||"Unknown",totalExpenses:0,totalInvestments:0,expenseCount:0,approvedCount:0,submittedCount:0,paymentModes:{},categories:{}}),r[k].totalInvestments+=h.amount});const p=Object.values(r).sort((h,k)=>k.totalInvestments-h.totalInvestments),u=p.map(h=>({name:h.name,Investment:h.totalInvestments,Expense:h.totalExpenses})),m=[...p].sort((h,k)=>k.totalInvestments-h.totalInvestments).slice(0,5),b=[...p].sort((h,k)=>k.totalExpenses-h.totalExpenses).slice(0,5),f=[...p].filter(h=>h.submittedCount>0).sort((h,k)=>k.approvedCount/k.submittedCount-h.approvedCount/h.submittedCount).slice(0,5),t=h=>h.split(" ").map(k=>k[0]).join("").toUpperCase().slice(0,2),n=h=>{const k=Object.entries(h);return k.length===0?"N/A":k.sort((_,y)=>y[1]-_[1])[0][0].toUpperCase()},a=h=>{const k=Object.entries(h);return k.length===0?"N/A":k.sort((_,y)=>y[1]-_[1])[0][0]},N=h=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[h]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(h=>{const k=h.totalInvestments-h.totalExpenses,_=h.submittedCount>0?h.approvedCount/h.submittedCount*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-lg",children:t(h.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:h.name}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[h.expenseCount," expenses â€¢ ",h.submittedCount," submitted"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-sage/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",h.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",h.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]}),e.jsxs("div",{className:`rounded-lg p-3 mb-4 ${k>=0?"bg-accent/10":"bg-soft-red/10"}`,children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Net Contribution"}),e.jsxs("p",{className:`text-xl font-bold ${k>=0?"text-accent":"text-soft-red"}`,children:[k>=0?"+":"","â‚¹",k.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Approval Rate"]}),e.jsxs("span",{className:"font-semibold text-sage",children:[_.toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),"Payment Mode"]}),e.jsx("span",{className:"font-semibold text-primary",children:n(h.paymentModes)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Top Category"]}),e.jsxs("span",{className:"font-semibold text-accent",children:[N(a(h.categories))," ",a(h.categories)]})]})]})]},h.id)})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Investment vs Expense Comparison"}),u.length>0?e.jsx(ge,{width:"100%",height:400,children:e.jsxs(It,{data:u,children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx($e,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(je,{formatter:h=>`â‚¹${h.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ut,{}),e.jsx(ct,{dataKey:"Investment",fill:"#2D5016",radius:[8,8,0,0]}),e.jsx(ct,{dataKey:"Expense",fill:"#C17817",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[400px] flex items-center justify-center text-dark-brown/50",children:"No data available"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Qe,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Top Investors"})]}),e.jsx("div",{className:"space-y-3",children:m.map((h,k)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-accent/40",children:["#",k+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:t(h.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:h.name}),e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",h.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},h.id))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Active Spenders"})]}),e.jsx("div",{className:"space-y-3",children:b.map((h,k)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-secondary/40",children:["#",k+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-secondary to-accent rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:t(h.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:h.name}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",h.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},h.id))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Best Approval Rate"})]}),e.jsx("div",{className:"space-y-3",children:f.map((h,k)=>{const _=h.approvedCount/h.submittedCount*100;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-sage/40",children:["#",k+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-sage to-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:t(h.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:h.name}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:[_.toFixed(0),"%"]})]})]},h.id)})})]})]})]})}function Sr({expenses:s,investments:l}){const[c,g]=i.useState($(new Date,"yyyy-MM")),[r,p]=i.useState(!0),u=new Date(c+"-01"),m=hs(u),b=ps(u),f=dt(u,1),t=hs(f),n=ps(f),a=s.filter(D=>{const L=new Date(D.expense_date);return L>=m&&L<=b&&D.status==="approved"}),N=l.filter(D=>{const L=new Date(D.investment_date);return L>=m&&L<=b&&D.status==="approved"}),h=s.filter(D=>{const L=new Date(D.expense_date);return L>=t&&L<=n&&D.status==="approved"}),k=l.filter(D=>{const L=new Date(D.investment_date);return L>=t&&L<=n&&D.status==="approved"}),_=a.reduce((D,L)=>D+L.amount,0),y=N.reduce((D,L)=>D+L.amount,0),j=y-_,d=h.reduce((D,L)=>D+L.amount,0),x=k.reduce((D,L)=>D+L.amount,0),o=x-d,v=d>0?(_-d)/d*100:0,w=x>0?(y-x)/x*100:0,P=o!==0?(j-o)/Math.abs(o)*100:0,T=a.reduce((D,L)=>(D[L.category]||(D[L.category]={thisMonth:0,lastMonth:0}),D[L.category].thisMonth+=L.amount,D),{});h.forEach(D=>{T[D.category]||(T[D.category]={thisMonth:0,lastMonth:0}),T[D.category].lastMonth+=D.amount});const S=Object.entries(T).map(([D,L])=>{const I=L.lastMonth>0?(L.thisMonth-L.lastMonth)/L.lastMonth*100:0;return{category:D,thisMonth:L.thisMonth,lastMonth:L.lastMonth,change:I,changeAmount:L.thisMonth-L.lastMonth}}).sort((D,L)=>L.thisMonth-D.thisMonth),U=la({start:m,end:b}).map(D=>{const L=a.filter(K=>Yt(new Date(K.expense_date),D)),I=N.filter(K=>Yt(new Date(K.investment_date),D)),q=L.reduce((K,be)=>K+be.amount,0),O=I.reduce((K,be)=>K+be.amount,0);return{date:D,expenses:L,investments:I,expenseTotal:q,investmentTotal:O}}),z=[];for(let D=0;D<12;D++){const L=dt(new Date,D);z.push({value:$(L,"yyyy-MM"),label:$(L,"MMMM yyyy")})}const W=()=>{alert("PDF generation feature coming soon!")},ee=()=>{alert("Excel export feature coming soon!")},le=()=>{alert("Email report feature coming soon!")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("select",{value:c,onChange:D=>g(D.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 font-semibold",children:z.map(D=>e.jsx("option",{value:D.value,children:D.label},D.value))}),e.jsx("button",{onClick:()=>g($(new Date,"yyyy-MM")),className:"px-4 py-2 bg-primary/10 text-primary font-semibold rounded-xl hover:bg-primary/20 transition-colors",children:"Current Month"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:D=>p(D.target.checked),className:"w-4 h-4 rounded border-2 border-accent text-accent focus:ring-accent"}),e.jsx("span",{className:"text-sm font-medium text-dark-brown",children:"Compare with last month"})]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-2xl shadow-soft-lg p-8 border-2 border-accent/30",children:[e.jsx("h3",{className:"font-heading text-4xl font-bold text-primary mb-6",children:$(u,"MMMM yyyy")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Investments"}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-2",children:["â‚¹",y.toLocaleString("en-IN")]}),r&&e.jsxs("div",{className:`flex items-center gap-2 ${w>=0?"text-sage":"text-soft-red"}`,children:[w>=0?e.jsx(se,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[w>=0?"+":"",w.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",_.toLocaleString("en-IN")]}),r&&e.jsxs("div",{className:`flex items-center gap-2 ${v<=0?"text-sage":"text-soft-red"}`,children:[v>=0?e.jsx(se,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[v>=0?"+":"",v.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-xl p-6 ${j>=0?"ring-2 ring-accent":"ring-2 ring-soft-red"}`,children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Net Change"}),e.jsxs("p",{className:`text-3xl font-bold mb-2 ${j>=0?"text-accent":"text-soft-red"}`,children:[j>=0?"+":"","â‚¹",j.toLocaleString("en-IN")]}),r&&e.jsxs("div",{className:`flex items-center gap-2 ${P>=0?"text-sage":"text-soft-red"}`,children:[P>=0?e.jsx(se,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[P>=0?"+":"",P.toFixed(1),"% vs last month"]})]})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"This Month"}),r&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Last Month"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Change"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-dark-brown",children:"Trend"})]})]})}),e.jsx("tbody",{children:S.map((D,L)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${L%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:D.category}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-secondary",children:["â‚¹",D.thisMonth.toLocaleString("en-IN")]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right text-dark-brown",children:["â‚¹",D.lastMonth.toLocaleString("en-IN")]}),e.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${D.changeAmount>=0?"text-soft-red":"text-sage"}`,children:[D.changeAmount>=0?"+":"","â‚¹",D.changeAmount.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${D.change>0?"bg-soft-red/20 text-soft-red":D.change<0?"bg-sage/20 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:[D.change>0&&e.jsx(se,{className:"w-3 h-3"}),D.change<0&&e.jsx(we,{className:"w-3 h-3"}),D.change.toFixed(0),"%"]})})]})]},D.category))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-bold text-dark-brown",children:"Total"}),e.jsxs("td",{className:"px-4 py-3 text-right text-xl font-bold text-accent",children:["â‚¹",_.toLocaleString("en-IN")]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-dark-brown",children:["â‚¹",d.toLocaleString("en-IN")]}),e.jsx("td",{colSpan:2})]})]})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Detailed Daily Breakdown"}),e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Investments"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Expenses"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Net"})]})}),e.jsx("tbody",{children:U.map((D,L)=>{const I=D.investmentTotal-D.expenseTotal;return D.expenses.length>0||D.investments.length>0?e.jsxs("tr",{className:`border-b border-dark-brown/5 ${L%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:$(D.date,"EEE, MMM d")}),e.jsx("td",{className:"px-4 py-3 text-right text-sage font-semibold",children:D.investmentTotal>0?`â‚¹${D.investmentTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-secondary font-semibold",children:D.expenseTotal>0?`â‚¹${D.expenseTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:`px-4 py-3 text-right font-bold ${I>0?"text-accent":I<0?"text-soft-red":"text-dark-brown"}`,children:I!==0?`${I>0?"+":""}â‚¹${I.toLocaleString("en-IN")}`:"-"})]},D.date.toString()):null})})]})})]}),e.jsxs("div",{className:"bg-cream/50 rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Export Options"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(ae,{className:"w-5 h-5"}),"Download PDF Report"]}),e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export to Excel"]}),e.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-primary text-primary font-semibold rounded-xl hover:bg-primary hover:text-white transition-all duration-300",children:[e.jsx(ze,{className:"w-5 h-5"}),"Email Report"]})]})]})]})}function Dr({expenses:s,vendors:l}){const g=s.filter(n=>n.status==="approved"&&n.vendor_id).reduce((n,a)=>{const N=a.vendor_id,h=a.vendors;if(!h)return n;n[N]||(n[N]={id:N,name:h.name,category:h.category,totalSpent:0,transactionCount:0,lastTransactionDate:a.expense_date,transactions:[],categories:{}}),n[N].totalSpent+=a.amount,n[N].transactionCount+=1,n[N].transactions.push(a),new Date(a.expense_date)>new Date(n[N].lastTransactionDate)&&(n[N].lastTransactionDate=a.expense_date);const k=a.category;return n[N].categories[k]=(n[N].categories[k]||0)+a.amount,n},{}),r=Object.values(g).sort((n,a)=>a.totalSpent-n.totalSpent),u=r.slice(0,10).map(n=>({name:n.name,amount:n.totalSpent})),m=n=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[n]||"ðŸ’°",b=n=>n&&{supplier:"ðŸ­",service:"ðŸ”§",contractor:"ðŸ‘·",transport:"ðŸšš",retail:"ðŸª"}[n.toLowerCase()]||"ðŸª",f=n=>X(new Date,new Date(n)),t=r.reduce((n,a)=>n+a.totalSpent,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(n=>{const a=n.transactionCount>0?n.totalSpent/n.transactionCount:0,N=f(n.lastTransactionDate),h=t>0?n.totalSpent/t*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary to-sage rounded-lg flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-3xl",children:b(n.category)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:n.name}),e.jsx("p",{className:"text-xs text-dark-brown/60 capitalize",children:n.category||"General Vendor"})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",n.totalSpent.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[h.toFixed(1),"% of all vendor spending"]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:n.transactionCount})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Avg Transaction"}),e.jsxs("span",{className:"font-bold text-accent",children:["â‚¹",a.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),"Last Transaction"]}),e.jsxs("span",{className:`font-semibold ${N>60?"text-soft-red":"text-sage"}`,children:[N," days ago"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-2",children:"Primary Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(n.categories).sort((k,_)=>_[1]-k[1]).slice(0,3).map(([k,_])=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-accent/10 rounded-full text-xs font-semibold text-dark-brown",children:[m(k)," ",k]},k))})]})]},n.id)})}),u.length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Top 10 Vendors by Spending"}),e.jsx(ge,{width:"100%",height:400,children:e.jsxs(It,{data:u,layout:"vertical",children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx($e,{dataKey:"name",type:"category",width:150,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(je,{formatter:n=>`â‚¹${n.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ct,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Hs,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Vendors"})]}),e.jsx("p",{className:"text-5xl font-bold text-accent mb-2",children:r.length}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Active vendors with transactions"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Spent"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-2",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Across all vendors"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Avg Transaction"})]}),e.jsxs("p",{className:"text-4xl font-bold text-sage mb-2",children:["â‚¹",r.length>0?(t/r.reduce((n,a)=>n+a.transactionCount,0)).toLocaleString("en-IN",{maximumFractionDigits:0}):"0"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per vendor transaction"})]})]}),r.filter(n=>f(n.lastTransactionDate)>90).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-2xl shadow-soft p-6 border-2 border-soft-red/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-soft-red/20 rounded-lg flex items-center justify-center",children:e.jsx(he,{className:"w-6 h-6 text-soft-red"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Inactive Vendors"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-4",children:"The following vendors haven't been used in over 90 days. Consider reviewing your vendor relationships."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:r.filter(n=>f(n.lastTransactionDate)>90).map(n=>{const a=f(n.lastTransactionDate);return e.jsxs("div",{className:"bg-white/60 rounded-lg p-4 border border-soft-red/20",children:[e.jsx("p",{className:"font-semibold text-primary mb-1",children:n.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Last used: ",$(new Date(n.lastTransactionDate),"MMM d, yyyy")]}),e.jsxs("p",{className:"text-xs text-soft-red font-semibold mt-1",children:[a," days ago"]})]},n.id)})})]})]})}function Mr(){const[s,l]=i.useState("overview"),[c,g]=i.useState([]),[r,p]=i.useState([]),[u,m]=i.useState([]),[b,f]=i.useState(!0);i.useEffect(()=>{t()},[]);const t=async()=>{try{const[a,N,h]=await Promise.all([C.from("expenses").select(`
            *,
            users:user_id(name, email),
            users_paid_by:users!expenses_paid_by_fkey(name, email),
            users_submitted_by:users!expenses_submitted_by_fkey(name),
            users_approved_by:users!expenses_approved_by_fkey(name),
            vendors(id, name, category)
          `).order("expense_date",{ascending:!1}),C.from("investments").select(`
            *,
            users:partner_id(name, email),
            users_submitted_by:users!investments_submitted_by_fkey(name)
          `).order("investment_date",{ascending:!1}),C.from("vendors").select("*").order("name")]);if(a.error)throw a.error;if(N.error)throw N.error;if(h.error)throw h.error;g(a.data||[]),p(N.data||[]),m(h.data||[])}catch(a){console.error("Error fetching data:",a)}finally{f(!1)}},n=[{id:"overview",name:"Overview",icon:se},{id:"category",name:"Category Analysis",icon:qa},{id:"partner",name:"Partner Analysis",icon:ve},{id:"monthly",name:"Monthly Reports",icon:Ce},{id:"vendor",name:"Vendor Analysis",icon:Hs}];return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(H,{}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Financial Reports"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Comprehensive analysis of investments, expenses, and financial trends"})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-8 inline-flex gap-2 flex-wrap",children:n.map(a=>{const N=a.icon;return e.jsxs("button",{onClick:()=>l(a.id),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${s===a.id?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(N,{className:"w-5 h-5"}),a.name]},a.id)})}),b?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading reports..."})}):e.jsxs(e.Fragment,{children:[s==="overview"&&e.jsx(kr,{expenses:c,investments:r,vendors:u}),s==="category"&&e.jsx(_r,{expenses:c}),s==="partner"&&e.jsx(Cr,{expenses:c,investments:r}),s==="monthly"&&e.jsx(Sr,{expenses:c,investments:r}),s==="vendor"&&e.jsx(Dr,{expenses:c,vendors:u})]})]})})]})}const Pr=["Initial Capital","Product Development","Raw Material Purchase","Equipment Purchase","Marketing Budget","Working Capital","Infrastructure","Other"];function Er({isOpen:s,onClose:l,onSuccess:c,preselectedPartnerId:g}){const{user:r}=G(),[p,u]=i.useState(!1),[m,b]=i.useState([]),[f,t]=i.useState(""),[n,a]=i.useState(!1),[N,h]=i.useState({partnerId:g||"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null,requireApproval:!1}),k=r?.role==="admin";i.useEffect(()=>{s&&_()},[s]),i.useEffect(()=>{g&&h(w=>({...w,partnerId:g}))},[g]);const _=async()=>{try{const{data:w,error:P}=await C.from("users").select("id, name, email").order("name");if(P)throw P;b(w||[])}catch(w){console.error("Error fetching partners:",w)}},y=w=>{const P=w.target.files?.[0];if(P){if(P.size>10*1024*1024){alert("File size must be less than 10MB");return}h({...N,paymentProofFile:P})}},j=async w=>{try{const P=w.name.split(".").pop(),S=`payment-proofs/${`${Math.random()}.${P}`}`,{error:A}=await C.storage.from("investment-docs").upload(S,w);if(A)throw A;const{data:U}=C.storage.from("investment-docs").getPublicUrl(S);return U.publicUrl}catch(P){return console.error("Error uploading file:",P),null}},d=async w=>{if(w.preventDefault(),!N.partnerId||!N.amount||!N.purpose){alert("Please fill in all required fields");return}const P=parseFloat(N.amount);if(isNaN(P)||P<=0){alert("Please enter a valid positive amount");return}u(!0);try{let T=null;N.paymentProofFile&&(T=await j(N.paymentProofFile));const S=k&&!N.requireApproval?"approved":"pending",A={partner_id:N.partnerId,amount:P,investment_date:N.investmentDate,purpose:N.purpose,notes:N.notes||null,payment_proof_url:T,status:S,submitted_by:r?.id};S==="approved"&&(A.approved_by=r?.id,A.approved_at=new Date().toISOString());const{error:U}=await C.from("investments").insert([A]);if(U)throw U;const z=m.find(W=>W.id===N.partnerId);await C.from("activity_log").insert({user_id:r?.id,activity_type:"investment_added",description:`${r?.name} recorded investment of â‚¹${P.toLocaleString("en-IN")} for ${z?.name}`}),c(),l(),x()}catch(T){console.error("Error adding investment:",T),alert("Failed to add investment. Please try again.")}finally{u(!1)}},x=()=>{h({partnerId:"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null,requireApproval:!1}),t("")},o=m.filter(w=>w.name.toLowerCase().includes(f.toLowerCase())||w.email.toLowerCase().includes(f.toLowerCase())),v=m.find(w=>w.id===N.partnerId);return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-3xl font-bold text-white",children:"Record Investment"}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Add a new partner investment to the records"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]})}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Partner ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:v?v.name:f,onChange:w=>{t(w.target.value),a(!0),h({...N,partnerId:""})},onFocus:()=>a(!0),placeholder:"Search for a partner...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),n&&!v&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border-2 border-dark-brown/10 rounded-xl shadow-soft-lg max-h-60 overflow-y-auto",children:o.length>0?o.map(w=>e.jsxs("button",{type:"button",onClick:()=>{h({...N,partnerId:w.id}),t(""),a(!1)},className:"w-full px-4 py-3 text-left hover:bg-accent/10 transition-colors border-b border-dark-brown/5 last:border-0",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:w.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:w.email})]},w.id)):e.jsx("p",{className:"px-4 py-3 text-dark-brown/50",children:"No partners found"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"number",value:N.amount,onChange:w=>h({...N,amount:w.target.value}),placeholder:"0",step:"0.01",min:"0",required:!0,className:"w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-dark-brown/40 text-sm",children:"INR"})]}),N.amount&&!isNaN(parseFloat(N.amount))&&e.jsxs("p",{className:"mt-2 text-sm text-dark-brown/60",children:["â‚¹",parseFloat(N.amount).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"date",value:N.investmentDate,onChange:w=>h({...N,investmentDate:w.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purpose / Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsxs("select",{value:N.purpose,onChange:w=>h({...N,purpose:w.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 appearance-none",children:[e.jsx("option",{value:"",children:"Select a purpose"}),Pr.map(w=>e.jsx("option",{value:w,children:w},w))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Proof (Optional)"}),e.jsxs("div",{className:"border-2 border-dashed border-dark-brown/20 rounded-xl p-6 hover:border-accent transition-colors",children:[e.jsx("input",{type:"file",id:"payment-proof",accept:"image/*,.pdf",onChange:y,className:"hidden"}),e.jsxs("label",{htmlFor:"payment-proof",className:"flex flex-col items-center cursor-pointer",children:[e.jsx(Be,{className:"w-12 h-12 text-accent mb-3"}),N.paymentProofFile?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-sage",children:N.paymentProofFile.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(N.paymentProofFile.size/1024/1024).toFixed(2)," MB"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Upload Receipt or Bank Statement"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"PNG, JPG or PDF (max 10MB)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-4 top-4 w-5 h-5 text-accent"}),e.jsx("textarea",{value:N.notes,onChange:w=>h({...N,notes:w.target.value}),placeholder:"Add any additional details...",maxLength:500,rows:3,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 resize-none"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[N.notes.length,"/500 characters"]})]}),k&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-accent/5 rounded-xl",children:[e.jsx("input",{type:"checkbox",id:"require-approval",checked:N.requireApproval,onChange:w=>h({...N,requireApproval:w.target.checked}),className:"w-5 h-5 rounded border-2 border-accent text-accent focus:ring-accent"}),e.jsx("label",{htmlFor:"require-approval",className:"text-sm text-dark-brown cursor-pointer",children:"Require approval (otherwise auto-approve as admin)"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-dark-brown/10",children:[e.jsx("button",{type:"button",onClick:l,disabled:p,className:"flex-1 px-6 py-3 border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:p?"Recording...":e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-5 h-5"}),"Record Investment"]})})]})]})]})]}):null}function Ar({partner:s,investments:l,totalInvestment:c,percentageOfTotal:g,isTopInvestor:r,onViewAll:p,onAddInvestment:u}){const m=t=>t.split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2),b=l.sort((t,n)=>new Date(n.investment_date).getTime()-new Date(t.investment_date).getTime()).slice(0,3),f=t=>({"Initial Capital":"ðŸ’°","Product Development":"ðŸ§ª","Raw Material Purchase":"ðŸŒ¿","Equipment Purchase":"ðŸ”§","Marketing Budget":"ðŸ“¢","Working Capital":"ðŸ’¼",Infrastructure:"ðŸ¢",Other:"ðŸ“Š"})[t]||"ðŸ’°";return e.jsxs("div",{className:`relative bg-gradient-to-br from-cream via-white to-sage/10 rounded-2xl shadow-soft hover:shadow-soft-lg transition-all duration-300 overflow-hidden ${r?"border-4 border-accent":"border-2 border-dark-brown/10"}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),r&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsxs("div",{className:"bg-accent text-white px-3 py-1.5 rounded-full flex items-center gap-2 shadow-soft",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold",children:"Top Investor"})]})}),e.jsxs("div",{className:"relative p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-xl",children:m(s.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary truncate",children:s.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 truncate",children:s.email})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-2",children:["â‚¹",c.toLocaleString("en-IN")]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-brown/70",children:[l.length," ",l.length===1?"investment":"investments"]}),e.jsxs("span",{className:"font-semibold text-secondary",children:[g.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-accent/10 to-secondary/10 rounded-xl p-1",children:e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary h-3 rounded-lg transition-all duration-500 shadow-soft",style:{width:`${Math.min(g,100)}%`}})}),b.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 uppercase tracking-wide",children:"Recent Investments"}),b.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 backdrop-blur-sm rounded-lg border border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsx("span",{className:"text-2xl",children:f(t.purpose)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown truncate",children:t.purpose}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:$(new Date(t.investment_date),"MMM d, yyyy")})]}),e.jsxs("p",{className:"text-sm font-bold text-secondary",children:["â‚¹",t.amount.toLocaleString("en-IN")]})]},t.id))]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs("button",{onClick:p,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300",children:[e.jsx(Re,{className:"w-4 h-4"}),"View All"]}),e.jsx("button",{onClick:u,className:"flex items-center justify-center px-4 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:e.jsx(Q,{className:"w-5 h-5"})})]})]})]})}function Ir({isOpen:s,onClose:l,partner:c,investments:g}){if(!s)return null;const r=g.reduce((m,b)=>m+b.amount,0),p=m=>{switch(m){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},u=()=>{alert("PDF generation feature coming soon!")};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"font-heading text-3xl font-bold text-white",children:[c.name,"'s Investment History"]}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Complete record of all investments"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"p-6 bg-cream/50 border-b border-dark-brown/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-4xl font-bold text-accent",children:["â‚¹",r.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 mt-1",children:["Across ",g.length," ",g.length===1?"investment":"investments"]})]}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300 shadow-soft",children:[e.jsx(ke,{className:"w-5 h-5"}),"Download Statement"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:g.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-dark-brown/50",children:"No investments recorded yet"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),e.jsx("th",{className:"px-4 py-4 text-center text-sm font-semibold text-dark-brown",children:"Proof"})]})}),e.jsx("tbody",{children:g.sort((m,b)=>new Date(b.investment_date).getTime()-new Date(m.investment_date).getTime()).map((m,b)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${b%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:$(new Date(m.investment_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:m.purpose}),m.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1 line-clamp-2",children:m.notes})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",m.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:p(m.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm text-dark-brown",children:m.users_submitted_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:m.payment_proof_url?e.jsx("a",{href:m.payment_proof_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex p-2 hover:bg-primary/10 rounded-lg transition-colors",title:"View proof",children:e.jsx(Re,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No proof"})})]},m.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-4 text-right font-bold text-dark-brown",children:"Total:"}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",r.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:3})]})})]})})}),e.jsx("div",{className:"p-4 bg-cream/50 border-t border-dark-brown/10 flex justify-end",children:e.jsx("button",{onClick:l,className:"px-6 py-3 bg-white border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300",children:"Close"})})]})]})}const ws=["#B8860B","#2D5016","#C17817","#8B4513","#D4AF37","#CD853F","#DAA520"];function Fr({investments:s}){const l=s.filter(o=>o.status==="approved"),c=l.reduce((o,v)=>{const w=v.users?.name||"Unknown";return o[w]||(o[w]=0),o[w]+=v.amount,o},{}),g=Object.entries(c).map(([o,v])=>({name:o,value:Number(v)})),r=l.reduce((o,v)=>(o[v.purpose]||(o[v.purpose]=0),o[v.purpose]+=v.amount,o),{}),p=Object.entries(r).map(([o,v])=>({name:o,value:Number(v)})).sort((o,v)=>v.value-o.value),u=l.reduce((o,v)=>{const w=new Date(v.investment_date),P=`${w.getFullYear()}-${String(w.getMonth()+1).padStart(2,"0")}`;return o[P]||(o[P]=0),o[P]+=v.amount,o},{}),m=Object.keys(u).sort();let b=0;const f=m.map(o=>{b+=u[o];const[v,w]=o.split("-");return{month:new Date(parseInt(v),parseInt(w)-1).toLocaleDateString("en-US",{month:"short",year:"2-digit"}),monthly:u[o],cumulative:b}}),t=l.reduce((o,v)=>o+v.amount,0),n=new Set(l.map(o=>o.partner_id)).size,a=n>0?t/n:0,N=new Date().getMonth(),h=new Date().getFullYear(),k=new Date(h,N-1),_=l.filter(o=>{const v=new Date(o.investment_date);return v.getMonth()===N&&v.getFullYear()===h}),y=l.filter(o=>{const v=new Date(o.investment_date);return v.getMonth()===k.getMonth()&&v.getFullYear()===k.getFullYear()}),j=_.reduce((o,v)=>o+v.amount,0),d=y.reduce((o,v)=>o+v.amount,0),x=d>0?(j-d)/d*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(De,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-xs font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-1",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Investment"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(ve,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-3xl font-bold text-sage mb-1",children:n}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Partners Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(Ya,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",a.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-6 border-2 border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Growth"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${x>=0?"text-sage":"text-soft-red"}`,children:[x>=0?"+":"",x.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"This Month"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Contributions"}),g.length>0?e.jsx(ge,{width:"100%",height:300,children:e.jsxs(Pt,{children:[e.jsx(Et,{data:g,cx:"50%",cy:"50%",labelLine:!1,label:({name:o,percent:v})=>`${o} (${(v*100).toFixed(0)}%)`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:g.map((o,v)=>e.jsx(At,{fill:ws[v%ws.length]},`cell-${v}`))}),e.jsx(je,{formatter:o=>`â‚¹${o.toLocaleString("en-IN")}`})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment by Purpose"}),p.length>0?e.jsx(ge,{width:"100%",height:300,children:e.jsxs(It,{data:p,children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx($e,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(je,{formatter:o=>`â‚¹${o.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(ct,{dataKey:"value",fill:"#B8860B",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment Timeline"}),f.length>0?e.jsx(ge,{width:"100%",height:350,children:e.jsxs(Mt,{data:f,children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx($e,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(je,{formatter:o=>`â‚¹${o.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(ut,{}),e.jsx(qe,{type:"monotone",dataKey:"monthly",stroke:"#C17817",strokeWidth:2,name:"Monthly Investment",dot:{fill:"#C17817",r:4}}),e.jsx(qe,{type:"monotone",dataKey:"cumulative",stroke:"#2D5016",strokeWidth:3,name:"Cumulative Investment",dot:{fill:"#2D5016",r:5}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),t>=1e5&&e.jsxs("div",{className:"bg-gradient-to-r from-accent to-secondary rounded-2xl shadow-soft-lg p-8 text-center",children:[e.jsx("p",{className:"text-5xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"font-heading text-3xl font-bold text-white mb-2",children:"Milestone Achieved!"}),e.jsxs("p",{className:"text-white/90 text-lg",children:["Total investments have crossed â‚¹",(Math.floor(t/1e5)*1e5/1e3).toFixed(0),"K! Amazing progress toward building Organitto together."]})]})]})}function Tr(){const{user:s}=G(),[l,c]=i.useState([]),[g,r]=i.useState(!0),[p,u]=i.useState("by_partner"),[m,b]=i.useState(!1),[f,t]=i.useState(),[n,a]=i.useState(!1),[N,h]=i.useState(null),[k,_]=i.useState(!1),[y,j]=i.useState("approve"),[d,x]=i.useState(null),[o,v]=i.useState(null),w=s?.role==="admin";i.useEffect(()=>{P();const I=C.channel("investments-changes").on("postgres_changes",{event:"*",schema:"public",table:"investments"},()=>{P()}).subscribe();return()=>{C.removeChannel(I)}},[]);const P=async()=>{try{const{data:I,error:q}=await C.from("investments").select(`
          *,
          users:partner_id(name, email),
          users_submitted_by:users!investments_submitted_by_fkey(name),
          users_approved_by:users!investments_approved_by_fkey(name)
        `).order("investment_date",{ascending:!1});if(q)throw q;c(I||[])}catch(I){console.error("Error fetching investments:",I)}finally{r(!1)}},T=I=>{x(I),j("approve"),_(!0)},S=I=>{x(I),j("reject"),_(!0)},A=async(I,q)=>{if(!(!d||!s)){v(d.id);try{const O={status:y==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};y==="reject"&&q&&(O.rejection_reason=q);const{error:K}=await C.from("investments").update(O).eq("id",d.id);if(K)throw K;await C.from("activity_log").insert({user_id:s.id,activity_type:y==="approve"?"investment_approved":"investment_rejected",description:`${s.name} ${y==="approve"?"approved":"rejected"} investment: â‚¹${d.amount.toLocaleString("en-IN")} from ${d.users?.name}`}),await P(),_(!1),x(null)}catch(O){console.error("Error processing approval:",O),alert("Failed to process approval. Please try again.")}finally{v(null)}}},U=async I=>{if(confirm("Are you sure you want to delete this investment? This action cannot be undone."))try{const{error:q}=await C.from("investments").delete().eq("id",I);if(q)throw q;await P()}catch(q){console.error("Error deleting investment:",q),alert("Failed to delete investment. Please try again.")}},z=l.reduce((I,q)=>{const O=q.partner_id,K=I.find(be=>be.partner.id===O);return K?(K.investments.push(q),K.total+=q.amount):q.users&&I.push({partner:{id:O,name:q.users.name,email:q.users.email},investments:[q],total:q.amount}),I},[]);z.sort((I,q)=>q.total-I.total);const W=l.filter(I=>I.status==="approved").reduce((I,q)=>I+q.amount,0),ee=new Set(l.filter(I=>I.status==="approved").map(I=>I.partner_id)).size,le=ee>0?W/ee:0,D=z.length>0?z[0].partner.id:null,L=I=>{switch(I){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(H,{}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Investment Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track partner investments and grow together"})]}),e.jsxs("button",{onClick:()=>{t(void 0),b(!0)},className:"flex items-center gap-2 px-6 py-4 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Investment"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-4xl font-bold text-accent mb-1",children:["â‚¹",W.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Amount Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(ve,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage mb-1",children:ee}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Partners Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(xt,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-sm font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-1",children:["â‚¹",le.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-6 inline-flex gap-2",children:[e.jsxs("button",{onClick:()=>u("by_partner"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${p==="by_partner"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(ve,{className:"w-5 h-5"}),"By Partner"]}),e.jsxs("button",{onClick:()=>u("all_investments"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${p==="all_investments"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"All Investments"]}),e.jsxs("button",{onClick:()=>u("statistics"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${p==="statistics"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(xt,{className:"w-5 h-5"}),"Statistics"]})]}),g?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading investments..."})}):p==="by_partner"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:z.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No investments recorded yet"}),e.jsxs("button",{onClick:()=>b(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:scale-105 transition-all duration-300",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add First Investment"]})]}):z.map(I=>e.jsx(Ar,{partner:I.partner,investments:I.investments,totalInvestment:I.total,percentageOfTotal:I.total/W*100,isTopInvestor:I.partner.id===D,onViewAll:()=>{h(I),a(!0)},onAddInvestment:()=>{t(I.partner.id),b(!0)}},I.partner.id))}):p==="all_investments"?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Partner"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),w&&e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:l.map((I,q)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${q%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:$(new Date(I.investment_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:I.users?.name}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:I.users?.email})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",I.amount.toLocaleString("en-IN")]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:I.purpose}),I.notes&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1 line-clamp-1",children:I.notes})]}),e.jsx("td",{className:"px-4 py-4",children:L(I.status)}),e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:I.users_submitted_by?.name||"Unknown"}),w&&e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[I.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>T(I),disabled:o===I.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(Y,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:()=>S(I),disabled:o===I.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Se,{className:"w-4 h-4 text-soft-red"})})]}),e.jsx("button",{onClick:()=>U(I.id),className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(de,{className:"w-4 h-4 text-soft-red"})})]})})]},I.id))})]})})}):e.jsx(Fr,{investments:l})]})}),m&&e.jsx(Er,{isOpen:m,onClose:()=>{b(!1),t(void 0)},onSuccess:P,preselectedPartnerId:f}),n&&N&&e.jsx(Ir,{isOpen:n,onClose:()=>{a(!1),h(null)},partner:N.partner,investments:N.investments}),k&&d&&e.jsx(Ys,{isOpen:k,onClose:()=>{_(!1),x(null)},onConfirm:A,type:y,expense:{category:d.purpose,subcategory:d.notes,amount:d.amount,expense_date:d.investment_date,payment_mode:"Investment"},loading:o===d.id})]})}function Lr({product:s,users:l,onDragStart:c,onEdit:g,onMoveNext:r}){const p=me(),u=X(new Date,new Date(s.stage_entered_at)),m=()=>{const a={high:{color:"bg-soft-red",dot:"ðŸ”´"},medium:{color:"bg-accent",dot:"ðŸŸ¡"},low:{color:"bg-sage",dot:"ðŸŸ¢"}};return a[s.priority]||a.medium},b=a=>({Skincare:"âœ¨","Hair Care":"ðŸ’†","Wellness & Supplements":"ðŸŒ¿","Oral Care":"ðŸ¦·","Personal Care":"ðŸ§´","Home Care":"ðŸ ",Other:"ðŸ“¦"})[a]||"ðŸ“¦",f=l.filter(a=>s.assigned_partners.includes(a.id)),t=a=>a.split(" ").map(N=>N[0]).join("").toUpperCase().slice(0,2),n=m();return e.jsxs("div",{draggable:!0,onDragStart:()=>c(s),className:"bg-white rounded-xl shadow-soft p-4 mb-3 cursor-move hover:shadow-soft-lg transition-all duration-300 border-2 border-transparent hover:border-accent/30 relative group",children:[e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${n.color} text-white`,children:[n.dot," ",s.priority.toUpperCase()]})}),s.image_url?e.jsx("div",{className:"w-full h-32 bg-cream/50 rounded-lg mb-3 overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-32 bg-gradient-to-br from-sage/20 to-accent/20 rounded-lg mb-3 flex items-center justify-center",children:e.jsx("span",{className:"text-5xl",children:b(s.category)})}),e.jsx("h4",{className:"font-heading text-lg font-bold text-primary mb-2 pr-16",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:s.category}),s.product_type&&e.jsx("span",{className:"text-xs px-2 py-1 bg-secondary/10 text-secondary rounded-full",children:s.product_type})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-dark-brown/60 font-semibold",children:"Stage Progress"}),e.jsxs("span",{className:"text-xs font-bold text-accent",children:[s.progress,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60 mb-3",children:[e.jsx(ie,{className:"w-3 h-3"}),e.jsxs("span",{className:u>30?"text-soft-red font-semibold":"",children:[u," days in stage",u>30&&" âš ï¸"]})]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-3",children:[f.slice(0,3).map((a,N)=>e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent to-secondary flex items-center justify-center text-white text-xs font-bold border-2 border-white shadow-sm",style:{marginLeft:N>0?"-8px":"0",zIndex:3-N},title:a.name,children:t(a.name)},a.id)),f.length>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-dark-brown/20 flex items-center justify-center text-xs font-bold text-dark-brown ml-1",children:["+",f.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-dark-brown/60 mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(es,{className:"w-3 h-3"}),"0/0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Tt,{className:"w-3 h-3"}),"0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3"}),"0"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>p(`/products/${s.id}`),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(Re,{className:"w-4 h-4"}),"View"]}),e.jsxs("button",{onClick:()=>g(s),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),e.jsx("button",{onClick:()=>r(s),className:"flex items-center justify-center gap-1 px-3 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg transition-colors text-xs font-semibold",children:e.jsx(Jt,{className:"w-4 h-4"})})]})]})}const $r=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],qr=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Rr=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function Ur({isOpen:s,onClose:l,onSubmit:c,users:g}){const[r,p]=i.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),[u,m]=i.useState(!1);if(!s)return null;const b=async t=>{t.preventDefault(),m(!0);try{await c(r),p({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),l()}catch(n){console.error("Error creating product:",n)}finally{m(!1)}},f=t=>{p(n=>({...n,assigned_partners:n.assigned_partners.includes(t)?n.assigned_partners.filter(a=>a!==t):[...n.assigned_partners,t]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Add New Product"}),e.jsx("button",{onClick:l,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:t=>p({...r,name:t.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:r.category,onChange:t=>p({...r,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),$r.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:r.product_type,onChange:t=>p({...r,product_type:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),qr.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Initial Stage"}),e.jsx("select",{value:r.current_stage,onChange:t=>p({...r,current_stage:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Rr.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:r.target_launch_date,onChange:t=>p({...r,target_launch_date:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",bgColor:"bg-red-500",hoverColor:"hover:bg-red-600",borderColor:"border-red-500"},{value:"medium",label:"Medium",bgColor:"bg-orange-500",hoverColor:"hover:bg-orange-600",borderColor:"border-orange-500"},{value:"low",label:"Low",bgColor:"bg-green-500",hoverColor:"hover:bg-green-600",borderColor:"border-green-500"}].map(t=>e.jsxs("label",{className:`flex-1 cursor-pointer px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 border-2 ${r.priority===t.value?`${t.bgColor} ${t.borderColor} text-white shadow-md`:`bg-white ${t.borderColor} border-opacity-30 text-dark-brown hover:border-opacity-100 hover:shadow-sm`}`,children:[e.jsx("input",{type:"radio",name:"priority",value:t.value,checked:r.priority===t.value,onChange:n=>p({...r,priority:n.target.value}),className:"sr-only"}),t.label]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:t=>p({...r,description:t.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:g.map(t=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${r.assigned_partners.includes(t.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:r.assigned_partners.includes(t.id),onChange:()=>f(t.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:t.name})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:r.image_url,onChange:t=>p({...r,image_url:t.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Be,{className:"w-5 h-5"}),"Upload"]})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Or enter a direct image URL"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition-colors border-2 border-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"flex-1 px-6 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold rounded-xl hover:from-emerald-700 hover:to-teal-700 shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-lg",children:u?"Creating...":"Create Product"})]})]})]})})}const Br=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],zr=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Or=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function Ks({isOpen:s,onClose:l,onSubmit:c,product:g,users:r}){const[p,u]=i.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:"",progress:0}),[m,b]=i.useState(!1);if(i.useEffect(()=>{g&&u({name:g.name||"",category:g.category||"",product_type:g.product_type||"",current_stage:g.current_stage||"idea",priority:g.priority||"medium",target_launch_date:g.target_launch_date||"",description:g.description||"",assigned_partners:g.assigned_partners||[],image_url:g.image_url||"",progress:g.progress||0})},[g]),!s)return null;const f=async n=>{n.preventDefault(),b(!0);try{await c(g.id,p),l()}catch(a){console.error("Error updating product:",a)}finally{b(!1)}},t=n=>{u(a=>({...a,assigned_partners:a.assigned_partners.includes(n)?a.assigned_partners.filter(N=>N!==n):[...a.assigned_partners,n]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Edit Product"}),e.jsx("button",{onClick:l,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:p.name,onChange:n=>u({...p,name:n.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:p.category,onChange:n=>u({...p,category:n.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),Br.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:p.product_type,onChange:n=>u({...p,product_type:n.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),zr.map(n=>e.jsx("option",{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Stage"}),e.jsx("select",{value:p.current_stage,onChange:n=>u({...p,current_stage:n.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Or.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:p.target_launch_date,onChange:n=>u({...p,target_launch_date:n.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Progress"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:p.progress,onChange:n=>u({...p,progress:parseInt(n.target.value)}),className:"flex-1"}),e.jsxs("span",{className:"text-2xl font-bold text-accent min-w-[60px]",children:[p.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${p.progress}%`}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",color:"bg-soft-red"},{value:"medium",label:"Medium",color:"bg-accent"},{value:"low",label:"Low",color:"bg-sage"}].map(n=>e.jsxs("label",{className:`flex-1 cursor-pointer ${p.priority===n.value?`${n.color} text-white`:"bg-dark-brown/5 text-dark-brown"} px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 hover:scale-105`,children:[e.jsx("input",{type:"radio",name:"priority",value:n.value,checked:p.priority===n.value,onChange:a=>u({...p,priority:a.target.value}),className:"sr-only"}),n.label]},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:p.description,onChange:n=>u({...p,description:n.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:r.map(n=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${p.assigned_partners.includes(n.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:p.assigned_partners.includes(n.id),onChange:()=>t(n.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:n.name})]},n.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:p.image_url,onChange:n=>u({...p,image_url:n.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Be,{className:"w-5 h-5"}),"Upload"]})]}),p.image_url&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:p.image_url,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg border-2 border-dark-brown/10"})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Updating...":"Update Product"})]})]})]})})}const ot=[{id:"idea",name:"Idea",icon:"ðŸŒ±",gradient:"from-sage/30 to-sage/10"},{id:"research",name:"Research",icon:"ðŸ”",gradient:"from-sage/25 to-sage/10"},{id:"formula",name:"Formula Creation",icon:"âš—ï¸",gradient:"from-sage/20 to-accent/10"},{id:"testing",name:"Testing",icon:"ðŸ§ª",gradient:"from-accent/30 to-accent/10"},{id:"packaging",name:"Packaging Design",icon:"ðŸ“¦",gradient:"from-accent/25 to-accent/10"},{id:"printing",name:"Printing",icon:"ðŸ–¨ï¸",gradient:"from-accent/20 to-secondary/10"},{id:"production",name:"Production",icon:"ðŸ­",gradient:"from-secondary/30 to-secondary/10"},{id:"ready",name:"Ready to Launch",icon:"ðŸš€",gradient:"from-secondary/25 to-secondary/10"},{id:"launched",name:"Launched",icon:"âœ…",gradient:"from-primary/40 to-primary/20"}];function Vr(){const{user:s}=G(),l=me(),[c,g]=i.useState("board"),[r,p]=i.useState(!1),[u,m]=i.useState(!1),[b,f]=i.useState(null),[t,n]=i.useState([]),[a,N]=i.useState([]),[h,k]=i.useState(!0),[_,y]=i.useState(null),[j,d]=i.useState("all"),[x,o]=i.useState("");i.useEffect(()=>{v()},[]);const v=async()=>{try{const[I,q]=await Promise.all([C.from("products").select("*").order("created_at",{ascending:!1}),C.from("users").select("id, name, email").order("name")]);if(I.error)throw I.error;if(q.error)throw q.error;n(I.data||[]),N(q.data||[])}catch(I){console.error("Error fetching data:",I)}finally{k(!1)}},w=async I=>{try{const{data:q,error:O}=await C.from("products").insert([{...I,created_by:s?.id,stage_entered_at:new Date().toISOString()}]).select().single();if(O)throw O;await C.from("product_stage_history").insert([{product_id:q.id,stage:I.current_stage,moved_by:s?.id,notes:"Product created"}]),await v()}catch(q){throw console.error("Error creating product:",q),q}},P=I=>{y(I)},T=I=>{I.preventDefault()},S=async(I,q)=>{if(I.preventDefault(),!_||_.current_stage===q){y(null);return}if(q==="launched"&&!window.confirm(`Are you sure you want to launch "${_.name}"? This marks it as complete.`)){y(null);return}try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",_.id).is("exited_at",null),await C.from("products").update({current_stage:q,stage_entered_at:new Date().toISOString(),progress:q==="launched"?100:_.progress}).eq("id",_.id),await C.from("product_stage_history").insert([{product_id:_.id,stage:q,moved_by:s?.id}]),await v()}catch(O){console.error("Error moving product:",O)}finally{y(null)}},A=async I=>{const q=ot.findIndex(K=>K.id===I.current_stage);if(q===-1||q===ot.length-1)return;const O=ot[q+1].id;await S({preventDefault:()=>{}},O)},U=I=>{f(I),m(!0)},z=async(I,q)=>{try{const{error:O}=await C.from("products").update({...q,updated_at:new Date().toISOString()}).eq("id",I);if(O)throw O;await C.from("activity_log").insert({user_id:s?.id,activity_type:"product_updated",description:`${s?.name} updated product: ${q.name}`}),await v()}catch(O){throw console.error("Error updating product:",O),O}},W=t.filter(I=>!(j!=="all"&&I.priority!==j||x&&!I.name.toLowerCase().includes(x.toLowerCase()))),ee=t.length,le=t.filter(I=>I.current_stage!=="launched").length,D=t.filter(I=>I.current_stage==="launched").length,L=t.filter(I=>I.priority==="high").length;return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(H,{}),e.jsx("button",{onClick:()=>p(!0),className:"fixed bottom-8 right-8 w-16 h-16 bg-gradient-to-r from-secondary to-accent text-white rounded-full shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-110 flex items-center justify-center z-40 group",children:e.jsx(Q,{className:"w-8 h-8 group-hover:rotate-90 transition-transform duration-300"})}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Product Development Pipeline"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track your Ayurvedic products from concept to launch"})]}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-3 px-6 py-4 bg-accent text-white rounded-xl font-bold text-lg shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-105 hover:bg-accent/90",children:[e.jsx(Q,{className:"w-6 h-6"}),"Add New Product"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(oe,{className:"w-6 h-6 text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Products"})]}),e.jsx("p",{className:"text-4xl font-bold text-primary",children:ee})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(he,{className:"w-6 h-6 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"In Development"})]}),e.jsx("p",{className:"text-4xl font-bold text-accent",children:le})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(za,{className:"w-6 h-6 text-sage"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Launched"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage",children:D})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/20 to-soft-red/10 rounded-xl p-6 border-2 border-soft-red/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Y,{className:"w-6 h-6 text-soft-red"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"High Priority"})]}),e.jsx("p",{className:"text-4xl font-bold text-soft-red",children:L})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-4 mb-8 flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g("board"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${c==="board"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(Ia,{className:"w-5 h-5"}),"Board View"]}),e.jsxs("button",{onClick:()=>g("list"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${c==="list"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"List View"]})]}),e.jsxs("div",{className:"flex gap-3 flex-1 max-w-md",children:[e.jsx("input",{type:"text",placeholder:"Search products...",value:x,onChange:I=>o(I.target.value),className:"flex-1 px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("select",{value:j,onChange:I=>d(I.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"low",children:"Low Priority"})]})]})]}),h?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading products..."})}):c==="board"?e.jsx("div",{className:"overflow-x-auto pb-4",children:e.jsx("div",{className:"flex gap-4 min-w-max",children:ot.map(I=>{const q=W.filter(O=>O.current_stage===I.id);return e.jsxs("div",{onDragOver:T,onDrop:O=>S(O,I.id),className:`w-80 flex-shrink-0 bg-gradient-to-b ${I.gradient} rounded-2xl p-4 border-2 border-dark-brown/10 shadow-soft`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-heading text-lg font-bold text-primary flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:I.icon}),I.name]}),e.jsx("span",{className:"bg-white px-3 py-1 rounded-full text-sm font-bold text-primary shadow-sm",children:q.length})]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-400px)] overflow-y-auto pr-2",children:q.length===0?e.jsx("div",{className:"text-center py-8 text-dark-brown/40 text-sm",children:"No products in this stage"}):q.map(O=>e.jsx(Lr,{product:O,users:a,onDragStart:P,onEdit:U,onMoveNext:A},O.id))})]},I.id)})})}):e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Priority"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Progress"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Days in Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Target Launch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:W.map((I,q)=>{const O=ot.find(be=>be.id===I.current_stage),K=Math.floor((new Date().getTime()-new Date(I.stage_entered_at).getTime())/(1e3*60*60*24));return e.jsxs("tr",{className:`border-b border-dark-brown/5 ${q%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center text-2xl",children:O?.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-primary",children:I.name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:I.product_type})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:I.category})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-sm px-3 py-1 bg-gradient-to-r ${O?.gradient} rounded-full font-semibold text-dark-brown`,children:O?.name})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold text-white ${I.priority==="high"?"bg-soft-red":I.priority==="medium"?"bg-accent":"bg-sage"}`,children:I.priority.toUpperCase()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent",style:{width:`${I.progress}%`}})}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[I.progress,"%"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-sm ${K>30?"text-soft-red font-semibold":"text-dark-brown/70"}`,children:[K," days"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:I.target_launch_date||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(`/products/${I.id}`),className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",title:"View Details",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U(I),className:"p-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors",title:"Edit Product",children:e.jsx(ye,{className:"w-4 h-4"})})]})})]},I.id)})})]})})}),W.length===0&&!h&&e.jsxs("div",{className:"text-center py-16 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ±"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"No products yet!"}),e.jsx("p",{className:"text-dark-brown/60 mb-6",children:"Create your first Ayurvedic product to get started"}),e.jsx("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300",children:"Create Product"})]})]})}),e.jsx(Ur,{isOpen:r,onClose:()=>p(!1),onSubmit:w,users:a}),b&&e.jsx(Ks,{isOpen:u,onClose:()=>{m(!1),f(null)},onSubmit:z,product:b,users:a})]})}function Hr({product:s,onRefresh:l}){G();const[c,g]=i.useState([]),[r,p]=i.useState([]),[u,m]=i.useState(null),[b,f]=i.useState(!1),[t,n]=i.useState(s.description||"");i.useEffect(()=>{a()},[s.id]);const a=async()=>{try{const[d,x]=await Promise.all([C.from("product_stage_history").select("*, moved_by").eq("product_id",s.id).order("entered_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(d.error)throw d.error;if(x.error)throw x.error;if(g(d.data||[]),p(x.data||[]),s.created_by){const o=x.data?.find(v=>v.id===s.created_by);m(o)}}catch(d){console.error("Error fetching data:",d)}},N=async()=>{try{const{error:d}=await C.from("products").update({description:t}).eq("id",s.id);if(d)throw d;f(!1),l()}catch(d){console.error("Error updating description:",d)}},h=r.filter(d=>s.assigned_partners?.includes(d.id)),k=X(new Date,new Date(s.created_at)),_=d=>d.split(" ").map(x=>x[0]).join("").toUpperCase().slice(0,2),y=d=>r.find(o=>o.id===d)?.name||"Unknown",j={idea:"ðŸŒ± Idea",research:"ðŸ” Research",formula:"âš—ï¸ Formula Creation",testing:"ðŸ§ª Testing",packaging:"ðŸ“¦ Packaging Design",printing:"ðŸ–¨ï¸ Printing",production:"ðŸ­ Production",ready:"ðŸš€ Ready to Launch",launched:"âœ… Launched"};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Product Information"}),!b&&e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"Edit Description"})]}),s.image_url&&e.jsx("div",{className:"mb-4 rounded-xl overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-64 object-cover"})}),b?e.jsxs("div",{children:[e.jsx("textarea",{value:t,onChange:d=>n(d.target.value),placeholder:"Enter product description...",rows:6,className:"w-full px-4 py-3 border-2 border-accent/30 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none mb-3"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-lg font-semibold hover:shadow-soft transition-all",children:"Save"}),e.jsx("button",{onClick:()=>{n(s.description||""),f(!1)},className:"px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:"Cancel"})]})]}):e.jsx("p",{className:"text-dark-brown/70 leading-relaxed",children:s.description||"No description provided yet."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Category"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Product Type"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.product_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created Date"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:$(new Date(s.created_at),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created By"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:u?.name||"Unknown"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Stage History"}),e.jsx("div",{className:"space-y-3",children:c.map((d,x)=>{const o=d.exited_at?X(new Date(d.exited_at),new Date(d.entered_at)):X(new Date,new Date(d.entered_at));return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white rounded-lg border-2 border-dark-brown/5",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-2xl ${x===0?"bg-accent/20":"bg-dark-brown/5"}`,children:j[d.stage]?.split(" ")[0]||"ðŸ“¦"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:j[d.stage]||d.stage}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Entered ",$(new Date(d.entered_at),"MMM dd, yyyy")," by ",y(d.moved_by)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-accent",children:[o," days"]}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:d.exited_at?"Completed":"Current"})]})]},d.id)})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-white rounded-xl p-6 border-2 border-accent/20",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Total Development"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[k," days"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Progress"}),e.jsxs("p",{className:"text-xl font-bold text-sage",children:[s.progress,"%"]})]})]}),s.target_launch_date&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"w-6 h-6 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Target Launch"}),e.jsx("p",{className:"text-xl font-bold text-secondary",children:$(new Date(s.target_launch_date),"MMM dd, yyyy")})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Assigned Team"}),h.length>0?e.jsx("div",{className:"space-y-3",children:h.map(d=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:_(d.name)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:d.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 capitalize",children:d.role})]})]},d.id))}):e.jsx("p",{className:"text-dark-brown/50 text-sm",children:"No team members assigned yet."}),e.jsx("button",{className:"w-full mt-4 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"+ Add Team Member"})]})]})]})})}const Wr=["Herb","Oil","Powder","Extract","Base","Preservative","Fragrance","Active","Other"],Qr=["g","ml","kg","L","%","drops"],Gr=["Cooling","Heating","Vata-balancing","Pitta-balancing","Kapha-balancing","Anti-inflammatory","Antimicrobial","Moisturizing","Detoxifying","Rejuvenating"];function Yr({productId:s}){G();const[l,c]=i.useState([]),[g,r]=i.useState([]),[p,u]=i.useState(null),[m,b]=i.useState(!1),[f,t]=i.useState(null),[n,a]=i.useState({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""});i.useEffect(()=>{N()},[s]);const N=async()=>{try{const[x,o]=await Promise.all([C.from("product_ingredients").select("*").eq("product_id",s).order("created_at",{ascending:!0}),C.from("formula_versions").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(x.error)throw x.error;if(o.error)throw o.error;c(x.data||[]),r(o.data||[]);const v=o.data?.find(w=>w.is_current);u(v)}catch(x){console.error("Error fetching data:",x)}},h=async x=>{x.preventDefault();try{if(f){const{error:o}=await C.from("product_ingredients").update({...n,quantity:parseFloat(n.quantity)||0,cost_per_unit:parseFloat(n.cost_per_unit)||0}).eq("id",f);if(o)throw o}else{const{error:o}=await C.from("product_ingredients").insert([{product_id:s,...n,quantity:parseFloat(n.quantity)||0,cost_per_unit:parseFloat(n.cost_per_unit)||0}]);if(o)throw o}y(),N()}catch(o){console.error("Error saving ingredient:",o)}},k=x=>{a({ingredient_name:x.ingredient_name,botanical_name:x.botanical_name||"",type:x.type||"",quantity:x.quantity?.toString()||"",unit:x.unit||"g",vendor:x.vendor||"",cost_per_unit:x.cost_per_unit?.toString()||"",ayurvedic_properties:x.ayurvedic_properties||[],notes:x.notes||""}),t(x.id),b(!0)},_=async x=>{if(confirm("Are you sure you want to delete this ingredient?"))try{const{error:o}=await C.from("product_ingredients").delete().eq("id",x);if(o)throw o;N()}catch(o){console.error("Error deleting ingredient:",o)}},y=()=>{a({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""}),t(null),b(!1)},j=x=>{a(o=>({...o,ayurvedic_properties:o.ayurvedic_properties.includes(x)?o.ayurvedic_properties.filter(v=>v!==x):[...o.ayurvedic_properties,x]}))},d=l.reduce((x,o)=>x+(o.quantity||0)*(o.cost_per_unit||0),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Ingredients List"}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Ingredient"]})]}),e.jsx("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Cost/Unit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Properties"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:l.map((x,o)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${o%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:x.ingredient_name}),x.botanical_name&&e.jsx("p",{className:"text-sm text-dark-brown/60 italic",children:x.botanical_name})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:x.type||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[x.quantity||0," ",x.unit]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:x.vendor||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-dark-brown",children:["â‚¹",x.cost_per_unit?.toFixed(2)||"0.00"]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-bold text-accent",children:["â‚¹",((x.quantity||0)*(x.cost_per_unit||0)).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(x.ayurvedic_properties||[]).slice(0,2).map(v=>e.jsx("span",{className:"px-2 py-0.5 bg-sage/10 text-sage rounded text-xs font-semibold",children:v},v)),(x.ayurvedic_properties||[]).length>2&&e.jsxs("span",{className:"text-xs text-dark-brown/60",children:["+",(x.ayurvedic_properties||[]).length-2]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(x),className:"p-2 text-accent hover:bg-accent/10 rounded-lg transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(x.id),className:"p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]})})]},x.id))}),e.jsx("tfoot",{className:"bg-accent/5 border-t-2 border-accent/20",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Total Raw Material Cost:"}),e.jsxs("td",{className:"px-4 py-3 font-bold text-xl text-accent",children:["â‚¹",d.toFixed(2)]}),e.jsx("td",{colSpan:2})]})})]})})}),l.length===0&&e.jsxs("div",{className:"text-center py-12 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ¿"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No ingredients added yet"}),e.jsx("button",{onClick:()=>b(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Add Your First Ingredient"})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:f?"Edit Ingredient":"Add New Ingredient"}),e.jsx("button",{onClick:y,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Ingredient Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:n.ingredient_name,onChange:x=>a({...n,ingredient_name:x.target.value}),placeholder:"e.g., Neem Extract",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical Name"}),e.jsx("input",{type:"text",value:n.botanical_name,onChange:x=>a({...n,botanical_name:x.target.value}),placeholder:"e.g., Azadirachta indica",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Type"}),e.jsxs("select",{value:n.type,onChange:x=>a({...n,type:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Wr.map(x=>e.jsx("option",{value:x,children:x},x))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",value:n.quantity,onChange:x=>a({...n,quantity:x.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("select",{value:n.unit,onChange:x=>a({...n,unit:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Qr.map(x=>e.jsx("option",{value:x,children:x},x))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor/Source"}),e.jsx("input",{type:"text",value:n.vendor,onChange:x=>a({...n,vendor:x.target.value}),placeholder:"Supplier name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:n.cost_per_unit,onChange:x=>a({...n,cost_per_unit:x.target.value}),placeholder:"0.00",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Ayurvedic Properties"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Gr.map(x=>e.jsxs("label",{className:`cursor-pointer px-3 py-2 rounded-lg border-2 transition-all ${n.ayurvedic_properties.includes(x)?"border-sage bg-sage/10 text-sage font-semibold":"border-dark-brown/10 hover:border-sage/50 text-dark-brown"}`,children:[e.jsx("input",{type:"checkbox",checked:n.ayurvedic_properties.includes(x),onChange:()=>j(x),className:"sr-only"}),e.jsx("span",{className:"text-sm",children:x})]},x))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:n.notes,onChange:x=>a({...n,notes:x.target.value}),placeholder:"Additional notes about this ingredient...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:y,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:f?"Update Ingredient":"Add Ingredient"})]})]})]})})]})}const Ns={stability:["pH Test","Viscosity Test","Color Consistency","Fragrance Stability","Separation Test"],safety:["Patch Test Results","Microbial Testing","Heavy Metals Testing","Allergen Testing"],performance:["Efficacy Test","Shelf Life Study","Consumer Testing"]};function Kr({productId:s}){const{user:l}=G(),[c,g]=i.useState([]),[r,p]=i.useState([]),[u,m]=i.useState(!1),[b,f]=i.useState(!1),[t,n]=i.useState({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),[a,N]=i.useState({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5});i.useEffect(()=>{h()},[s]);const h=async()=>{try{const[j,d]=await Promise.all([C.from("product_tests").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("sample_batches").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(j.error)throw j.error;if(d.error)throw d.error;g(j.data||[]),p(d.data||[])}catch(j){console.error("Error fetching data:",j)}},k=async j=>{j.preventDefault();try{const{error:d}=await C.from("product_tests").insert([{product_id:s,...t,tested_by:l?.id}]);if(d)throw d;n({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),m(!1),h()}catch(d){console.error("Error adding test:",d)}},_=async j=>{j.preventDefault();try{const{error:d}=await C.from("sample_batches").insert([{product_id:s,...a,quantity:parseFloat(a.quantity)||0,rating:parseInt(a.rating.toString())||5,created_by:l?.id}]);if(d)throw d;N({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5}),f(!1),h()}catch(d){console.error("Error adding batch:",d)}},y=j=>{const d={pass:{icon:e.jsx(Y,{className:"w-4 h-4"}),color:"bg-sage text-white"},fail:{icon:e.jsx(Se,{className:"w-4 h-4"}),color:"bg-soft-red text-white"},pending:{icon:e.jsx(ie,{className:"w-4 h-4"}),color:"bg-accent text-white"}};return d[j]||d.pending};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Testing & Quality Control"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Test"]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Sample Batch"]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(Ns).map(([j,d])=>{const x=c.filter(o=>o.test_category===j);return e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-xl font-bold text-primary mb-4 capitalize",children:[j," Testing"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:d.map(o=>{const v=x.find(P=>P.test_type===o),w=v?y(v.result):null;return e.jsxs("div",{className:`p-4 rounded-xl border-2 ${v?v.result==="pass"?"border-sage/30 bg-sage/5":v.result==="fail"?"border-soft-red/30 bg-soft-red/5":"border-accent/30 bg-accent/5":"border-dark-brown/10 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!v,readOnly:!0,className:"w-5 h-5 rounded border-2 border-dark-brown/20"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:o})]}),w&&e.jsxs("span",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${w.color}`,children:[w.icon,v.result.toUpperCase()]})]}),v&&e.jsxs("div",{className:"ml-7 space-y-1 text-sm",children:[v.target_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Target:"})," ",v.target_value]}),v.actual_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Actual:"})," ",v.actual_value]}),e.jsxs("p",{className:"text-dark-brown/60",children:["Tested on ",$(new Date(v.test_date),"MMM dd, yyyy")]}),v.notes&&e.jsx("p",{className:"text-dark-brown/70 italic",children:v.notes})]})]},o)})})]},j)})}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h4",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Sample Batches"}),r.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(j=>e.jsxs("div",{className:"p-4 bg-white rounded-xl border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-dark-brown text-lg",children:j.batch_number}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[j.quantity," ",j.unit," â€¢ ",j.purpose]})]}),j.rating&&e.jsx("div",{className:"flex gap-0.5",children:[...Array(5)].map((d,x)=>e.jsx("span",{className:x<j.rating?"text-accent":"text-dark-brown/20",children:"â˜…"},x))})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Date:"})," ",$(new Date(j.batch_date),"MMM dd, yyyy")]}),j.given_to&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Given to:"})," ",j.given_to]}),j.feedback&&e.jsxs("p",{className:"text-dark-brown/70 italic",children:['"',j.feedback,'"']})]})]},j.id))}):e.jsx("p",{className:"text-center py-8 text-dark-brown/50",children:"No sample batches recorded yet"})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Test Result"})}),e.jsxs("form",{onSubmit:k,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Category"}),e.jsxs("select",{required:!0,value:t.test_category,onChange:j=>n({...t,test_category:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"stability",children:"Stability Testing"}),e.jsx("option",{value:"safety",children:"Safety Testing"}),e.jsx("option",{value:"performance",children:"Performance Testing"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Test Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:t.test_type,onChange:j=>n({...t,test_type:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select test type"}),Ns[t.test_category]?.map(j=>e.jsx("option",{value:j,children:j},j))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Value"}),e.jsx("input",{type:"text",value:t.target_value,onChange:j=>n({...t,target_value:j.target.value}),placeholder:"e.g., pH 5.5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Actual Value"}),e.jsx("input",{type:"text",value:t.actual_value,onChange:j=>n({...t,actual_value:j.target.value}),placeholder:"e.g., pH 5.6",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Result"}),e.jsxs("select",{value:t.result,onChange:j=>n({...t,result:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"pass",children:"Pass"}),e.jsx("option",{value:"fail",children:"Fail"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Date"}),e.jsx("input",{type:"date",value:t.test_date,onChange:j=>n({...t,test_date:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:t.notes,onChange:j=>n({...t,notes:j.target.value}),rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Test"})]})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Sample Batch"})}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:a.batch_number,onChange:j=>N({...a,batch_number:j.target.value}),placeholder:"e.g., BATCH-001",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Date"}),e.jsx("input",{type:"date",value:a.batch_date,onChange:j=>N({...a,batch_date:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:a.quantity,onChange:j=>N({...a,quantity:j.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("input",{type:"text",value:a.unit,onChange:j=>N({...a,unit:j.target.value}),placeholder:"units/ml/g",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Purpose"}),e.jsxs("select",{value:a.purpose,onChange:j=>N({...a,purpose:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"testing",children:"Testing"}),e.jsx("option",{value:"sampling",children:"Sampling"}),e.jsx("option",{value:"gifting",children:"Gifting"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Given To"}),e.jsx("input",{type:"text",value:a.given_to,onChange:j=>N({...a,given_to:j.target.value}),placeholder:"Names of recipients",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Feedback"}),e.jsx("textarea",{value:a.feedback,onChange:j=>N({...a,feedback:j.target.value}),placeholder:"User feedback...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(j=>e.jsx("button",{type:"button",onClick:()=>N({...a,rating:j}),className:`text-3xl ${j<=a.rating?"text-accent":"text-dark-brown/20"}`,children:"â˜…"},j))})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Batch"})]})]})]})})]})}function Zr({productId:s}){const{user:l}=G(),[c,g]=i.useState([]),[r,p]=i.useState(!1),[u,m]=i.useState({version_name:"",image_url:"",specifications:{}});i.useEffect(()=>{b()},[s]);const b=async()=>{try{const{data:a,error:N}=await C.from("packaging_designs").select("*").eq("product_id",s).order("created_at",{ascending:!1});if(N)throw N;g(a||[])}catch(a){console.error("Error fetching designs:",a)}},f=async a=>{a.preventDefault();try{const{error:N}=await C.from("packaging_designs").insert([{product_id:s,...u,uploaded_by:l?.id}]);if(N)throw N;m({version_name:"",image_url:"",specifications:{}}),p(!1),b()}catch(N){console.error("Error adding design:",N)}},t=async a=>{const N=c.find(y=>y.id===a);if(!N)return;const h=N.votes||[],_=h.includes(l?.id)?h.filter(y=>y!==l?.id):[...h,l?.id];try{const{error:y}=await C.from("packaging_designs").update({votes:_}).eq("id",a);if(y)throw y;b()}catch(y){console.error("Error voting:",y)}},n=a=>{const N={under_review:{color:"bg-accent",text:"Under Review"},approved:{color:"bg-sage",text:"Approved"},rejected:{color:"bg-soft-red",text:"Rejected"}};return N[a]||N.under_review};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Packaging Designs"}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Upload Design"]})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(a=>{const N=n(a.status),h=a.votes||[];return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all",children:[a.image_url?e.jsx("div",{className:"aspect-square bg-cream/30",children:e.jsx("img",{src:a.image_url,alt:a.version_name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-cream/50 to-accent/10 flex items-center justify-center",children:e.jsx("span",{className:"text-6xl",children:"ðŸ“¦"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-bold text-dark-brown",children:a.version_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold text-white ${N.color}`,children:N.text})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>t(a.id),className:`flex items-center gap-1 px-3 py-2 rounded-lg font-semibold transition-all ${h.includes(l?.id)?"bg-accent text-white":"bg-accent/10 text-accent hover:bg-accent/20"}`,children:[e.jsx(Ka,{className:"w-4 h-4"}),h.length]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"View"]}),e.jsx("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]})]})]},a.id)})}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“¦"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No packaging designs uploaded yet"}),e.jsx("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload First Design"})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-secondary to-accent p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload Design"})}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Design Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:u.version_name,onChange:a=>m({...u,version_name:a.target.value}),placeholder:"e.g., Design A",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Image URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:u.image_url,onChange:a=>m({...u,image_url:a.target.value}),placeholder:"https://example.com/design.jpg",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload Design"})]})]})]})})]})}const Ot=["Research","Formula","Packaging","Production","Marketing","Other"],Jr=["high","medium","low"],Xr=["todo","in_progress","completed","blocked"];function en({productId:s}){const{user:l}=G(),[c,g]=i.useState([]),[r,p]=i.useState([]),[u,m]=i.useState(!1),[b,f]=i.useState({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"});i.useEffect(()=>{t()},[s]);const t=async()=>{try{const[j,d]=await Promise.all([C.from("product_tasks").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(j.error)throw j.error;if(d.error)throw d.error;g(j.data||[]),p(d.data||[])}catch(j){console.error("Error fetching data:",j)}},n=async j=>{j.preventDefault();try{const{error:d}=await C.from("product_tasks").insert([{product_id:s,...b,created_by:l?.id}]);if(d)throw d;f({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"}),m(!1),t()}catch(d){console.error("Error adding task:",d)}},a=async(j,d)=>{try{const x={status:d};d==="completed"&&(x.completed_at=new Date().toISOString());const{error:o}=await C.from("product_tasks").update(x).eq("id",j);if(o)throw o;t()}catch(x){console.error("Error updating task:",x)}},N=j=>{const d={todo:{color:"bg-dark-brown/20 text-dark-brown",text:"To Do"},in_progress:{color:"bg-accent text-white",text:"In Progress"},completed:{color:"bg-sage text-white",text:"Completed"},blocked:{color:"bg-soft-red text-white",text:"Blocked"}};return d[j]||d.todo},h=j=>{const d={high:"border-l-soft-red",medium:"border-l-accent",low:"border-l-sage"};return d[j]||d.medium},k=j=>r.find(x=>x.id===j)?.name||"Unassigned",_=Ot.reduce((j,d)=>(j[d]=c.filter(x=>x.category===d),j),{}),y={total:c.length,completed:c.filter(j=>j.status==="completed").length,inProgress:c.filter(j=>j.status==="in_progress").length,overdue:c.filter(j=>j.due_date&&new Date(j.due_date)<new Date&&j.status!=="completed").length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Tasks & Checklist"}),e.jsxs("p",{className:"text-dark-brown/60 text-sm mt-1",children:[y.completed,"/",y.total," tasks completed"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Task"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-4 border-2 border-primary/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Total Tasks"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:y.total})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:y.inProgress})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-4 border-2 border-sage/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:y.completed})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-xl p-4 border-2 border-soft-red/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Overdue"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:y.overdue})]})]}),e.jsx("div",{className:"space-y-6",children:Ot.map(j=>{const d=_[j]||[];return d.length===0?null:e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary mb-4 flex items-center gap-2",children:[j," Tasks",e.jsx("span",{className:"px-2 py-1 bg-primary/10 rounded-full text-sm",children:d.length})]}),e.jsx("div",{className:"space-y-3",children:d.map(x=>{const o=N(x.status),v=h(x.priority),w=x.due_date&&new Date(x.due_date)<new Date&&x.status!=="completed";return e.jsx("div",{className:`bg-white p-4 rounded-xl border-l-4 ${v} shadow-sm hover:shadow-soft transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("input",{type:"checkbox",checked:x.status==="completed",onChange:()=>a(x.id,x.status==="completed"?"todo":"completed"),className:"w-5 h-5 mt-0.5 rounded border-2 border-dark-brown/20 cursor-pointer"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:`font-semibold text-dark-brown mb-1 ${x.status==="completed"?"line-through opacity-60":""}`,children:x.title}),x.description&&e.jsx("p",{className:"text-sm text-dark-brown/70 mb-2",children:x.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-dark-brown/60",children:[x.assigned_to&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"w-3 h-3"}),k(x.assigned_to)]}),x.due_date&&e.jsxs("span",{className:`flex items-center gap-1 ${w?"text-soft-red font-semibold":""}`,children:[e.jsx(Ce,{className:"w-3 h-3"}),$(new Date(x.due_date),"MMM dd"),w&&" (Overdue)"]})]})]})]}),e.jsx("select",{value:x.status,onChange:P=>a(x.id,P.target.value),className:`px-3 py-1 rounded-full text-xs font-semibold ${o.color} cursor-pointer`,children:Xr.map(P=>e.jsx("option",{value:P,children:N(P).text},P))})]})},x.id)})})]},j)})}),c.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"âœ…"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No tasks created yet"}),e.jsx("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Create First Task"})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-sage p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add New Task"})}),e.jsxs("form",{onSubmit:n,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Task Title ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:b.title,onChange:j=>f({...b,title:j.target.value}),placeholder:"e.g., Complete pH testing",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:b.description,onChange:j=>f({...b,description:j.target.value}),placeholder:"Task description...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:b.category,onChange:j=>f({...b,category:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Ot.map(j=>e.jsx("option",{value:j,children:j},j))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("select",{value:b.priority,onChange:j=>f({...b,priority:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Jr.map(j=>e.jsx("option",{value:j,children:j.charAt(0).toUpperCase()+j.slice(1)},j))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign To"}),e.jsxs("select",{value:b.assigned_to,onChange:j=>f({...b,assigned_to:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Unassigned"}),r.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:b.due_date,onChange:j=>f({...b,due_date:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Task"})]})]})]})})]})}function tn({productId:s}){const{user:l}=G(),[c,g]=i.useState([]),[r,p]=i.useState([]),[u,m]=i.useState("");i.useEffect(()=>{b();const k=f();return()=>{k.unsubscribe()}},[s]);const b=async()=>{try{const[k,_]=await Promise.all([C.from("product_comments").select("*").eq("product_id",s).is("parent_comment_id",null).order("created_at",{ascending:!0}),C.from("users").select("*")]);if(k.error)throw k.error;if(_.error)throw _.error;g(k.data||[]),p(_.data||[])}catch(k){console.error("Error fetching data:",k)}},f=()=>C.channel(`product_comments:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"product_comments",filter:`product_id=eq.${s}`},()=>{b()}).subscribe(),t=async k=>{if(k.preventDefault(),!!u.trim())try{const{error:_}=await C.from("product_comments").insert([{product_id:s,user_id:l?.id,text:u}]);if(_)throw _;m("")}catch(_){console.error("Error adding comment:",_)}},n=async(k,_)=>{const y=c.find(o=>o.id===k);if(!y)return;const j=y.reactions||[],d=j.find(o=>o.userId===l?.id&&o.emoji===_);let x;d?x=j.filter(o=>!(o.userId===l?.id&&o.emoji===_)):x=[...j,{userId:l?.id,emoji:_}];try{const{error:o}=await C.from("product_comments").update({reactions:x}).eq("id",k);if(o)throw o}catch(o){console.error("Error updating reaction:",o)}},a=k=>r.find(_=>_.id===k),N=k=>k.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),h=k=>{const _={};return k.forEach(y=>{_[y.emoji]||(_[y.emoji]=[]),_[y.emoji].push(y.userId)}),_};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Team Discussion"}),e.jsx("form",{onSubmit:t,className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:l?.name?N(l.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:u,onChange:k=>m(k.target.value),placeholder:"Share your thoughts, ask questions, or provide updates...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Add emoji",children:e.jsx(Vs,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Attach file",children:e.jsx(rs,{className:"w-5 h-5"})})]}),e.jsxs("button",{type:"submit",disabled:!u.trim(),className:"flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Os,{className:"w-5 h-5"}),"Send"]})]})]})]})}),e.jsx("div",{className:"space-y-4",children:c.map(k=>{const _=a(k.user_id),y=h(k.reactions||[]);return e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-dark-brown/5 hover:border-accent/20 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:_?N(_.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:_?.name||"Unknown"}),e.jsx("span",{className:"text-sm text-dark-brown/50",children:$(new Date(k.created_at),"MMM dd, yyyy HH:mm")})]}),e.jsx("p",{className:"text-dark-brown/80 leading-relaxed mb-3",children:k.text}),Object.keys(y).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(y).map(([j,d])=>e.jsxs("button",{onClick:()=>n(k.id,j),className:`flex items-center gap-1 px-3 py-1 rounded-full text-sm transition-all ${d.includes(l?.id||"")?"bg-accent/20 border-2 border-accent":"bg-dark-brown/5 border-2 border-transparent hover:border-accent/30"}`,children:[e.jsx("span",{children:j}),e.jsx("span",{className:"font-semibold text-dark-brown",children:d.length})]},j))}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("button",{className:"hover:text-accent transition-colors",children:[e.jsx(Ba,{className:"w-4 h-4 inline mr-1"}),"Reply"]}),e.jsx("button",{onClick:()=>n(k.id,"ðŸ‘"),className:"hover:text-accent transition-colors",children:"ðŸ‘ Like"}),e.jsx("button",{onClick:()=>n(k.id,"â¤ï¸"),className:"hover:text-accent transition-colors",children:"â¤ï¸ Love"}),e.jsx("button",{onClick:()=>n(k.id,"ðŸŽ‰"),className:"hover:text-accent transition-colors",children:"ðŸŽ‰ Celebrate"})]})]})]})},k.id)})}),c.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ’¬"}),e.jsx("p",{className:"text-dark-brown/60",children:"No comments yet. Start the discussion!"})]})]})}const Vt=[{name:"Formulas",icon:"âš—ï¸"},{name:"Test Reports",icon:"ðŸ§ª"},{name:"Packaging Designs",icon:"ðŸ“¦"},{name:"Certificates",icon:"ðŸ†"},{name:"Marketing Materials",icon:"ðŸ“¢"},{name:"Legal Documents",icon:"ðŸ“‹"},{name:"Research Papers",icon:"ðŸ“š"},{name:"Photos",icon:"ðŸ“¸"}];function sn({productId:s}){const{user:l}=G(),[c,g]=i.useState([]),[r,p]=i.useState([]),[u,m]=i.useState(null),[b,f]=i.useState(!1),[t,n]=i.useState({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"});i.useEffect(()=>{a()},[s]);const a=async()=>{try{const[x,o]=await Promise.all([C.from("product_files").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*")]);if(x.error)throw x.error;if(o.error)throw o.error;g(x.data||[]),p(o.data||[])}catch(x){console.error("Error fetching data:",x)}},N=async x=>{x.preventDefault();try{const{error:o}=await C.from("product_files").insert([{product_id:s,...t,file_size:0,uploaded_by:l?.id}]);if(o)throw o;n({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"}),f(!1),a()}catch(o){console.error("Error uploading file:",o)}},h=async x=>{if(confirm("Are you sure you want to delete this file?"))try{const{error:o}=await C.from("product_files").delete().eq("id",x);if(o)throw o;a()}catch(o){console.error("Error deleting file:",o)}},k=x=>r.find(v=>v.id===x)?.name||"Unknown",_=x=>x.startsWith("image/")?e.jsx(ss,{className:"w-6 h-6"}):x==="application/pdf"?e.jsx(ae,{className:"w-6 h-6"}):e.jsx(Ts,{className:"w-6 h-6"}),y=u?c.filter(x=>x.category===u):c,j=Vt.reduce((x,o)=>(x[o.name]=c.filter(v=>v.category===o.name).length,x),{}),d=x=>{if(x===0)return"0 KB";const o=1024,v=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(x)/Math.log(o));return Math.round(x/Math.pow(o,w)*100)/100+" "+v[w]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Files & Documents"}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Be,{className:"w-5 h-5"}),"Upload File"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Vt.map(x=>e.jsxs("button",{onClick:()=>m(u===x.name?null:x.name),className:`p-4 rounded-xl border-2 transition-all ${u===x.name?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:x.icon}),e.jsx("span",{className:"font-semibold text-dark-brown text-sm",children:x.name})]}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:j[x.name]||0})]},x.name))}),u&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($s,{className:"w-4 h-4 text-accent"}),e.jsxs("span",{className:"text-dark-brown",children:["Showing files in: ",e.jsx("strong",{children:u})]}),e.jsx("button",{onClick:()=>m(null),className:"text-accent hover:underline",children:"Clear filter"})]}),y.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map(x=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border-2 border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center text-accent flex-shrink-0",children:_(x.file_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",title:x.file_name,children:x.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:x.category})]})]}),e.jsxs("div",{className:"text-xs text-dark-brown/60 space-y-1 mb-3",children:[e.jsxs("p",{children:["Uploaded by ",k(x.uploaded_by)]}),e.jsx("p",{children:$(new Date(x.created_at),"MMM dd, yyyy")}),x.file_size>0&&e.jsx("p",{children:d(x.file_size)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:x.file_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{onClick:()=>h(x.id),className:"px-3 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]})]},x.id))}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:u?`No files in ${u} yet`:"No files uploaded yet"}),e.jsx("button",{onClick:()=>f(!0),className:"px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload Your First File"})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload File"})}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{required:!0,value:t.category,onChange:x=>n({...t,category:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Vt.map(x=>e.jsxs("option",{value:x.name,children:[x.icon," ",x.name]},x.name))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:t.file_name,onChange:x=>n({...t,file_name:x.target.value}),placeholder:"e.g., Formula v1.0.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:t.file_url,onChange:x=>n({...t,file_url:x.target.value}),placeholder:"https://example.com/file.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Enter the direct URL to your file"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"File Type"}),e.jsxs("select",{value:t.file_type,onChange:x=>n({...t,file_type:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"application/pdf",children:"PDF Document"}),e.jsx("option",{value:"image/jpeg",children:"JPEG Image"}),e.jsx("option",{value:"image/png",children:"PNG Image"}),e.jsx("option",{value:"application/msword",children:"Word Document"}),e.jsx("option",{value:"application/vnd.ms-excel",children:"Excel Spreadsheet"}),e.jsx("option",{value:"text/plain",children:"Text File"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload File"})]})]})]})})]})}const an=[{id:"overview",name:"Overview",icon:ae},{id:"ingredients",name:"Ingredients & Formula",icon:Ke},{id:"testing",name:"Testing & Quality",icon:Ws},{id:"packaging",name:"Packaging",icon:oe},{id:"tasks",name:"Tasks & Checklist",icon:es},{id:"discussion",name:"Team Discussion",icon:Tt},{id:"files",name:"Files & Documents",icon:$s}],St=[{id:"idea",name:"Idea",color:"bg-sage"},{id:"research",name:"Research",color:"bg-sage"},{id:"formula",name:"Formula Creation",color:"bg-accent"},{id:"testing",name:"Testing",color:"bg-accent"},{id:"packaging",name:"Packaging Design",color:"bg-secondary"},{id:"printing",name:"Printing",color:"bg-secondary"},{id:"production",name:"Production",color:"bg-secondary"},{id:"ready",name:"Ready to Launch",color:"bg-primary"},{id:"launched",name:"Launched",color:"bg-primary"}];function rn(){const{id:s}=Ye(),l=me(),{user:c}=G(),[g,r]=i.useState("overview"),[p,u]=i.useState(null),[m,b]=i.useState([]),[f,t]=i.useState(!0),[n,a]=i.useState(!1);i.useEffect(()=>{s&&N()},[s]);const N=async()=>{try{const[x,o]=await Promise.all([C.from("products").select("*").eq("id",s).single(),C.from("users").select("id, name, email").order("name")]);if(x.error)throw x.error;if(o.error)throw o.error;u(x.data),b(o.data||[])}catch(x){console.error("Error fetching data:",x)}finally{t(!1)}},h=N,k=async()=>{if(!p)return;const x=St.findIndex(v=>v.id===p.current_stage);if(x===-1||x===St.length-1)return;const o=St[x+1];if(!(o.id==="launched"&&!window.confirm(`Are you sure you want to launch "${p.name}"? This marks it as complete.`)))try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",p.id).is("exited_at",null),await C.from("products").update({current_stage:o.id,stage_entered_at:new Date().toISOString(),progress:o.id==="launched"?100:p.progress}).eq("id",p.id),await C.from("product_stage_history").insert([{product_id:p.id,stage:o.id,moved_by:c?.id}]),await h()}catch(v){console.error("Error moving product:",v)}},_=async(x,o)=>{try{const{error:v}=await C.from("products").update({...o,updated_at:new Date().toISOString()}).eq("id",x);if(v)throw v;await C.from("activity_log").insert({user_id:c?.id,activity_type:"product_updated",description:`${c?.name} updated product: ${o.name}`}),await h()}catch(v){throw console.error("Error updating product:",v),v}},y=x=>{const o={high:{color:"bg-soft-red",text:"HIGH"},medium:{color:"bg-accent",text:"MEDIUM"},low:{color:"bg-sage",text:"LOW"}};return o[x]||o.medium};if(f)return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Loading product..."})})]});if(!p)return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Product not found"})})]});const j=St.find(x=>x.id===p.current_stage),d=y(p.priority);return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/products"),className:"flex items-center gap-2 text-dark-brown/70 hover:text-primary mb-6 transition-colors",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Back to Pipeline"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-3",children:p.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-semibold",children:p.category}),e.jsx("span",{className:`px-3 py-1 ${d.color} text-white rounded-full text-sm font-semibold`,children:d.text}),j&&e.jsx("span",{className:`px-4 py-1 ${j.color} text-white rounded-full text-sm font-semibold`,children:j.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Stage Progress"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[p.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${p.progress}%`}})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(ye,{className:"w-5 h-5"}),"Edit"]}),e.jsxs("button",{onClick:k,disabled:p.current_stage==="launched",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Jt,{className:"w-5 h-5"}),"Move to Next Stage"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(Ha,{className:"w-5 h-5"}),"Share"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-xl font-semibold transition-colors",children:[e.jsx(va,{className:"w-5 h-5"}),"Archive"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex min-w-max",children:an.map(x=>{const o=x.icon;return e.jsxs("button",{onClick:()=>r(x.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all duration-300 border-b-4 ${g===x.id?"border-accent text-accent bg-accent/5":"border-transparent text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:x.name})]},x.id)})})})}),e.jsxs("div",{className:"p-6",children:[g==="overview"&&e.jsx(Hr,{product:p,onRefresh:h}),g==="ingredients"&&e.jsx(Yr,{productId:p.id}),g==="testing"&&e.jsx(Kr,{productId:p.id}),g==="packaging"&&e.jsx(Zr,{productId:p.id}),g==="tasks"&&e.jsx(en,{productId:p.id}),g==="discussion"&&e.jsx(tn,{productId:p.id}),g==="files"&&e.jsx(sn,{productId:p.id})]})]})]}),p&&e.jsx(Ks,{isOpen:n,onClose:()=>a(!1),onSubmit:_,product:p,users:m})]})}function nn(){const{user:s}=G(),[l,c]=i.useState([]),[g,r]=i.useState(""),[p,u]=i.useState(""),[m,b]=i.useState(100),[f,t]=i.useState([]),[n,a]=i.useState([{id:"1",name:"Primary Container (Bottle/Jar)",quantity:1,costPerPiece:0,total:0},{id:"2",name:"Label/Sticker",quantity:1,costPerPiece:0,total:0},{id:"3",name:"Secondary Packaging (Box)",quantity:1,costPerPiece:0,total:0}]),[N,h]=i.useState([]),[k,_]=i.useState(0),[y,j]=i.useState(0),[d,x]=i.useState(0),[o,v]=i.useState(0),[w,P]=i.useState(0),[T,S]=i.useState(0),[A,U]=i.useState(0),[z,W]=i.useState(0),[ee,le]=i.useState(10),[D,L]=i.useState(1),[I,q]=i.useState(0),[O,K]=i.useState(10),[be,Me]=i.useState(0),[Pe,jt]=i.useState(12),[_e,Oe]=i.useState([]),[Ze,yt]=i.useState(0),[Je,Ee]=i.useState(0),[Ae,wt]=i.useState(0),[Ie,Lt]=i.useState(0),[$t,qt]=i.useState([]),[Rt,Xe]=i.useState(!1),[Ve,M]=i.useState("");i.useEffect(()=>{B(),V()},[]),i.useEffect(()=>{g&&Nt()},[g]);const B=async()=>{try{const{data:E,error:R}=await C.from("products").select("*").order("name");if(R)throw R;c(E||[])}catch(E){console.error("Error fetching products:",E)}},V=async()=>{try{const{data:E,error:R}=await C.from("product_cost_calculations").select("*").eq("is_draft",!1).order("created_at",{ascending:!1});if(R)throw R;qt(E||[])}catch(E){console.error("Error fetching calculations:",E)}},Nt=async()=>{const E=l.find(R=>R.id===g);if(E){u(E.name);try{const{data:R}=await C.from("product_ingredients").select("*").eq("product_id",g);if(R&&R.length>0){const Z=R.map(re=>({id:re.id,name:re.ingredient_name,quantity:re.quantity||0,unit:re.unit||"g",costPerUnit:re.cost_per_unit||0,total:(re.quantity||0)*(re.cost_per_unit||0)}));t(Z)}}catch(R){console.error("Error loading product data:",R)}}},Ut=()=>{t([...f,{id:Date.now().toString(),name:"",quantity:0,unit:"g",costPerUnit:0,total:0}])},He=(E,R,Z)=>{t(f.map(re=>{if(re.id===E){const ue={...re,[R]:Z};return ue.total=ue.quantity*ue.costPerUnit,ue}return re}))},Zs=E=>{t(f.filter(R=>R.id!==E))},ls=(E,R,Z)=>{a(n.map(re=>{if(re.id===E){const ue={...re,[R]:Z};return ue.total=ue.quantity*ue.costPerPiece,ue}return re}))},Js=()=>{h([...N,{id:Date.now().toString(),description:"",amount:0}])},Xs=()=>{Oe([..._e,{id:Date.now().toString(),description:"",amount:0}])},et=f.reduce((E,R)=>E+R.total,0),tt=[...n.map(E=>E.total),...N.map(E=>E.amount)].reduce((E,R)=>E+R,0),Bt=k*y,os=d+o+w+T,st=Bt+os+A,zt=D>0?z*ee/100/D:0,is=D>0?I*O/100/D:0,ds=Pe>0?be/Pe:0,ea=_e.reduce((E,R)=>E+R.amount,0),at=zt+is+ds+ea,cs=Je+Ae,rt=(Ze+cs)*m,vt=et+tt+st+at+rt,nt=m>0?vt/m:0,kt=[{name:"Raw Materials",value:et,color:"#8B4513"},{name:"Packaging",value:tt,color:"#D2691E"},{name:"Manufacturing",value:st,color:"#CD853F"},{name:"Overheads",value:at,color:"#DEB887"},{name:"Marketing",value:rt,color:"#F4A460"}].filter(E=>E.value>0),xs=E=>{const R=nt/(1-E/100),Z=R*.18,re=R+Z,ue=R-nt;return{sellingPrice:R,gst:Z,mrp:re,profit:ue,marginPercent:E}},ms=[30,40,50,60].map(E=>xs(E)),ta=async()=>{if(!Ve.trim()){alert("Please enter a calculation name");return}try{const E={product_id:g||null,calculation_name:Ve,batch_size:m,raw_material_costs:{ingredients:f,subtotal:et},packaging_costs:{components:n,other:N,subtotal:tt},manufacturing_costs:{labour:Bt,utilities:os,qc:A,subtotal:st},overhead_costs:{rent:zt,salaries:is,compliance:ds,other:_e,subtotal:at},marketing_costs:{marketing:Ze*m,fulfillment:cs*m,subtotal:rt},total_cost:vt,cost_per_unit:nt,margin_scenarios:ms,saved_by:s?.id,is_draft:!1},{error:R}=await C.from("product_cost_calculations").insert([E]);if(R)throw R;Xe(!1),M(""),V(),alert("Calculation saved successfully!")}catch(E){console.error("Error saving calculation:",E),alert("Error saving calculation")}};return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Product Cost Calculator"}),e.jsx("p",{className:"text-dark-brown/70",children:"Calculate unit economics and pricing strategy"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>Xe(!0),className:"flex items-center gap-2 px-6 py-3 bg-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all hover:bg-accent/90",children:[e.jsx(zs,{className:"w-5 h-5"}),"Save Calculation"]}),e.jsxs("button",{className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export PDF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Select Product (Optional)"}),e.jsxs("select",{value:g,onChange:E=>r(E.target.value),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Calculate for new product"}),l.map(E=>e.jsx("option",{value:E.id,children:E.name},E.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Load Saved Calculation"}),e.jsxs("select",{className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select saved calculation..."}),$t.map(E=>e.jsxs("option",{value:E.id,children:[E.calculation_name," - ",new Date(E.created_at).toLocaleDateString()]},E.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Batch Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Name"}),e.jsx("input",{type:"text",value:p,onChange:E=>u(E.target.value),placeholder:"Enter product name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Size (Units)"}),e.jsx("input",{type:"number",value:m,onChange:E=>b(parseInt(E.target.value)||0),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Raw Materials"}),e.jsxs("button",{onClick:Ut,className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Ingredient"]})]}),e.jsx("div",{className:"space-y-3",children:f.map(E=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:E.name,onChange:R=>He(E.id,"name",R.target.value),placeholder:"Ingredient name",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:E.quantity,onChange:R=>He(E.id,"quantity",parseFloat(R.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:E.unit,onChange:R=>He(E.id,"unit",R.target.value),className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"ml",children:"ml"}),e.jsx("option",{value:"L",children:"L"})]}),e.jsx("input",{type:"number",value:E.costPerUnit,onChange:R=>He(E.id,"costPerUnit",parseFloat(R.target.value)||0),placeholder:"â‚¹/unit",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-2 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",E.total.toFixed(2)]}),e.jsx("button",{onClick:()=>Zs(E.id),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]},E.id))}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Raw Material Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",et.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(et/m).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Packaging Costs"}),e.jsx("div",{className:"space-y-3 mb-4",children:n.map(E=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("span",{className:"col-span-4 text-sm font-semibold text-dark-brown",children:E.name}),e.jsx("input",{type:"number",value:E.quantity,onChange:R=>ls(E.id,"quantity",parseFloat(R.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:E.costPerPiece,onChange:R=>ls(E.id,"costPerPiece",parseFloat(R.target.value)||0),placeholder:"â‚¹/piece",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-3 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",(E.total*m).toFixed(2)]})]},E.id))}),e.jsx("button",{onClick:Js,className:"text-sm text-accent hover:underline mb-3",children:"+ Add other packaging material"}),N.map(E=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center mb-2",children:[e.jsx("input",{type:"text",value:E.description,onChange:R=>h(N.map(Z=>Z.id===E.id?{...Z,description:R.target.value}:Z)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:E.amount,onChange:R=>h(N.map(Z=>Z.id===E.id?{...Z,amount:parseFloat(R.target.value)||0}:Z)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>h(N.filter(R=>R.id!==E.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]},E.id)),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Packaging Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",tt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(tt/m).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Manufacturing Costs"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Labour Hours"}),e.jsx("input",{type:"number",value:k,onChange:E=>_(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Hour (â‚¹)"}),e.jsx("input",{type:"number",value:y,onChange:E=>j(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Labour: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",Bt.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Electricity (â‚¹)"}),e.jsx("input",{type:"number",value:d,onChange:E=>x(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Water (â‚¹)"}),e.jsx("input",{type:"number",value:o,onChange:E=>v(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Equipment Depreciation (â‚¹)"}),e.jsx("input",{type:"number",value:w,onChange:E=>P(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Other Utilities (â‚¹)"}),e.jsx("input",{type:"number",value:T,onChange:E=>S(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC/Testing Cost (â‚¹)"}),e.jsx("input",{type:"number",value:A,onChange:E=>U(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Manufacturing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",st.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(st/m).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Overhead Allocation"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Rent (â‚¹)"}),e.jsx("input",{type:"number",value:z,onChange:E=>W(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation to this product: ",ee,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:ee,onChange:E=>le(parseInt(E.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batches per Month"}),e.jsx("input",{type:"number",value:D,onChange:E=>L(parseInt(E.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Rent per batch: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",zt.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Salaries (â‚¹)"}),e.jsx("input",{type:"number",value:I,onChange:E=>q(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation: ",O,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:O,onChange:E=>K(parseInt(E.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Compliance (â‚¹)"}),e.jsx("input",{type:"number",value:be,onChange:E=>Me(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Batches"}),e.jsx("input",{type:"number",value:Pe,onChange:E=>jt(parseInt(E.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsx("button",{onClick:Xs,className:"text-sm text-accent hover:underline",children:"+ Add other overhead"}),_e.map(E=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:E.description,onChange:R=>Oe(_e.map(Z=>Z.id===E.id?{...Z,description:R.target.value}:Z)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:E.amount,onChange:R=>Oe(_e.map(Z=>Z.id===E.id?{...Z,amount:parseFloat(R.target.value)||0}:Z)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>Oe(_e.filter(R=>R.id!==E.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]},E.id))]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Overhead Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",at.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(at/m).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Marketing & Distribution"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Marketing per Unit (â‚¹)"}),e.jsx("input",{type:"number",value:Ze,onChange:E=>yt(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Ads, samples, packaging inserts, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Shipping Material (â‚¹)"}),e.jsx("input",{type:"number",value:Je,onChange:E=>Ee(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Courier Charges (â‚¹)"}),e.jsx("input",{type:"number",value:Ae,onChange:E=>wt(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Platform Fees (%)"}),e.jsx("input",{type:"number",value:Ie,onChange:E=>Lt(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Marketing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",rt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(rt/m).toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-2xl shadow-soft-lg p-6 text-white sticky top-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Is,{className:"w-8 h-8"}),e.jsx("h3",{className:"font-heading text-2xl font-bold",children:"Cost Summary"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Total Batch Cost"}),e.jsxs("p",{className:"text-4xl font-bold",children:["â‚¹",vt.toFixed(2)]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-white/20 rounded-xl backdrop-blur-sm",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Cost Per Unit"}),e.jsxs("p",{className:"text-5xl font-bold",children:["â‚¹",nt.toFixed(2)]})]}),kt.length>0&&e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 backdrop-blur-sm",children:[e.jsx("p",{className:"text-sm font-semibold mb-3",children:"Cost Breakdown"}),e.jsx(ge,{width:"100%",height:200,children:e.jsxs(Pt,{children:[e.jsx(Et,{data:kt,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:kt.map((E,R)=>e.jsx(At,{fill:E.color},`cell-${R}`))}),e.jsx(je,{formatter:E=>`â‚¹${E.toFixed(2)}`,contentStyle:{background:"#fff",border:"none",borderRadius:"8px"}})]})}),e.jsx("div",{className:"space-y-2 mt-3",children:kt.map((E,R)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:E.color}}),e.jsx("span",{children:E.name})]}),e.jsxs("span",{className:"font-semibold",children:[(E.value/vt*100).toFixed(1),"%"]})]},R))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Pricing Strategy"}),e.jsx("div",{className:"space-y-4",children:ms.map((E,R)=>e.jsxs("div",{className:"p-4 bg-gradient-to-br from-cream/50 to-white rounded-xl border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-bold text-lg text-primary",children:[E.marginPercent,"% Margin"]}),e.jsxs("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-sm font-semibold",children:["Profit: â‚¹",E.profit.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Selling Price (ex-GST):"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",E.sellingPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"GST @ 18%:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",E.gst.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"font-bold text-dark-brown",children:"MRP (incl. GST):"}),e.jsxs("span",{className:"font-bold text-xl text-sage",children:["â‚¹",E.mrp.toFixed(2)]})]})]})]},R))})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Profitability Scenarios"}),e.jsx("div",{className:"space-y-3",children:[100,500,1e3,5e3].map(E=>{const R=E*xs(40).mrp,Z=E*nt,re=R-Z,ue=Z>0?re/R*100:0;return e.jsxs("div",{className:"p-3 bg-cream/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-dark-brown",children:[E," units"]}),e.jsxs("span",{className:`text-sm font-bold ${re>0?"text-sage":"text-soft-red"}`,children:[re>0?"+":"","â‚¹",re.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60",children:[e.jsxs("span",{children:["Revenue: â‚¹",R.toFixed(0)]}),e.jsxs("span",{children:["Margin: ",ue.toFixed(1),"%"]})]})]},E)})})]})]})]})]}),Rt&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Save Calculation"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Calculation Name"}),e.jsx("input",{type:"text",value:Ve,onChange:E=>M(E.target.value),placeholder:"e.g., Neem Face Wash v1.0 - 100 unit batch",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Xe(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:ta,className:"flex-1 px-6 py-3 bg-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all hover:bg-accent/90",children:"Save"})]})]})})]})}const ln=["Raw Materials","Packaging","Printing","Logistics","Lab Testing","Equipment","Other"],on=["Immediate","7 days","15 days","30 days","45 days","60 days","Custom"];function dn({onClose:s,onSuccess:l}){const{user:c}=G(),[g,r]=i.useState(!1),[p,u]=i.useState({name:"",category:"Raw Materials",products:"",contactPerson:"",phone:"",email:"",alternatePhone:"",address:"",gstNumber:"",website:"",paymentTerms:"30 days",bankName:"",accountNumber:"",ifscCode:"",initialRating:3,notes:""}),[m,b]=i.useState({iso:!1,organic:!1,fssai:!1,gmp:!1,other:""}),f=async t=>{if(t.preventDefault(),!p.name||!p.phone){alert("Please fill in required fields (Name and Phone)");return}r(!0);try{const n=p.bankName?{bankName:p.bankName,accountNumber:p.accountNumber,ifscCode:p.ifscCode}:{},a=[];m.iso&&a.push("ISO Certified"),m.organic&&a.push("Organic Certified"),m.fssai&&a.push("FSSAI Approved"),m.gmp&&a.push("GMP Certified"),m.other&&a.push(m.other);const{error:N}=await C.from("vendors").insert([{name:p.name,category:p.category,products:p.products,contact_person:p.contactPerson,phone:p.phone,email:p.email,alternate_phone:p.alternatePhone,address:p.address,gst_number:p.gstNumber,website:p.website,payment_terms:p.paymentTerms,bank_details:n,certifications:a,initial_rating:p.initialRating,current_rating:p.initialRating,notes:p.notes,created_by:c?.id}]);if(N)throw N;l()}catch(n){console.error("Error adding vendor:",n),alert("Error adding vendor. Please try again.")}finally{r(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add New Vendor"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:p.name,onChange:t=>u({...p,name:t.target.value}),placeholder:"e.g., Green Valley Herbs",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:p.category,onChange:t=>u({...p,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:ln.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:p.contactPerson,onChange:t=>u({...p,contactPerson:t.target.value}),placeholder:"Contact person name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Products/Services"}),e.jsx("textarea",{value:p.products,onChange:t=>u({...p,products:t.target.value}),placeholder:"What does this vendor supply? e.g., Organic herbs, essential oils",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Contact Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Phone Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"tel",value:p.phone,onChange:t=>u({...p,phone:t.target.value}),placeholder:"+91-XXXXXXXXXX",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email"}),e.jsx("input",{type:"email",value:p.email,onChange:t=>u({...p,email:t.target.value}),placeholder:"vendor@example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Alternative Phone"}),e.jsx("input",{type:"tel",value:p.alternatePhone,onChange:t=>u({...p,alternatePhone:t.target.value}),placeholder:"Optional second number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Website"}),e.jsx("input",{type:"url",value:p.website,onChange:t=>u({...p,website:t.target.value}),placeholder:"https://example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Address"}),e.jsx("textarea",{value:p.address,onChange:t=>u({...p,address:t.target.value}),placeholder:"Street, city, state, pincode",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Business Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"GST Number"}),e.jsx("input",{type:"text",value:p.gstNumber,onChange:t=>u({...p,gstNumber:t.target.value}),placeholder:"22AAAAA0000A1Z5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Terms"}),e.jsx("select",{value:p.paymentTerms,onChange:t=>u({...p,paymentTerms:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:on.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bank Name"}),e.jsx("input",{type:"text",value:p.bankName,onChange:t=>u({...p,bankName:t.target.value}),placeholder:"e.g., HDFC Bank",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:p.accountNumber,onChange:t=>u({...p,accountNumber:t.target.value}),placeholder:"Account number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"IFSC Code"}),e.jsx("input",{type:"text",value:p.ifscCode,onChange:t=>u({...p,ifscCode:t.target.value}),placeholder:"e.g., HDFC0001234",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality & Rating"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Initial Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>u({...p,initialRating:t}),className:"focus:outline-none",children:e.jsx(bt,{className:`w-8 h-8 transition-colors ${t<=p.initialRating?"fill-amber-400 text-amber-400":"text-dark-brown/20 hover:text-amber-400"}`})},t)),e.jsxs("span",{className:"ml-2 text-sm font-semibold text-dark-brown",children:[p.initialRating," / 5"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Quality Certifications"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.iso,onChange:t=>b({...m,iso:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"ISO Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.organic,onChange:t=>b({...m,organic:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Organic Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.fssai,onChange:t=>b({...m,fssai:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"FSSAI Approved"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.gmp,onChange:t=>b({...m,gmp:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"GMP Certified"})]}),e.jsx("input",{type:"text",value:m.other,onChange:t=>b({...m,other:t.target.value}),placeholder:"Other certifications (comma separated)",className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Internal Notes"}),e.jsx("textarea",{value:p.notes,onChange:t=>u({...p,notes:t.target.value}),placeholder:"Any internal notes about this vendor (not visible to vendor)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:g,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:g?"Adding...":"Add Vendor"})]})]})})}const Ht=[{id:"all",label:"All Vendors",icon:"ðŸ¢",color:"bg-dark-brown/10"},{id:"Raw Materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20"},{id:"Packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-secondary/20"},{id:"Printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-blue-500/20"},{id:"Logistics",label:"Logistics",icon:"ðŸšš",color:"bg-accent/20"},{id:"Lab Testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-purple-500/20"},{id:"Other",label:"Other",icon:"ðŸ”§",color:"bg-dark-brown/20"}];function cn(){const[s,l]=i.useState([]),[c,g]=i.useState([]),[r,p]=i.useState("grid"),[u,m]=i.useState("all"),[b,f]=i.useState(""),[t,n]=i.useState(!1),[a,N]=i.useState({total:0,active:0,pendingPayments:0,avgRating:0});i.useEffect(()=>{h()},[]),i.useEffect(()=>{k()},[s,u,b]);const h=async()=>{try{const{data:d,error:x}=await C.from("vendors").select("*").order("name");if(x)throw x;const{data:o}=await C.from("vendor_transactions").select("vendor_id, amount, status"),v=(d||[]).map(A=>{const U=o?.filter(ee=>ee.vendor_id===A.id)||[],z=U.reduce((ee,le)=>ee+(parseFloat(le.amount)||0),0),W=U.filter(ee=>ee.status==="pending").reduce((ee,le)=>ee+(parseFloat(le.amount)||0),0);return{...A,totalSpent:z,pendingAmount:W}});l(v);const w=v.length,P=v.filter(A=>A.totalSpent>0).length,T=v.reduce((A,U)=>A+U.pendingAmount,0),S=v.reduce((A,U)=>A+(U.current_rating||0),0)/(w||1);N({total:w,active:P,pendingPayments:T,avgRating:S})}catch(d){console.error("Error fetching vendors:",d)}},k=()=>{let d=s;if(u!=="all"&&(d=d.filter(x=>x.category===u)),b){const x=b.toLowerCase();d=d.filter(o=>o.name?.toLowerCase().includes(x)||o.contact_person?.toLowerCase().includes(x)||o.email?.toLowerCase().includes(x)||o.phone?.includes(x))}g(d)},_=d=>Ht.find(o=>o.id===d)?.color||"bg-dark-brown/10",y=d=>Ht.find(o=>o.id===d)?.icon||"ðŸ¢",j=d=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(x=>e.jsx(bt,{className:`w-4 h-4 ${x<=d?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},x))});return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Vendor & Supplier Directory"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your business relationships"})]}),e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ve,{className:"w-8 h-8 text-primary"}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:a.total})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(se,{className:"w-8 h-8 text-sage"}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:a.active})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Active Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fe,{className:"w-8 h-8 text-soft-red"}),e.jsxs("span",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",a.pendingPayments.toFixed(0)]})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Qe,{className:"w-8 h-8 text-amber-500"}),e.jsx("span",{className:"text-3xl font-bold text-amber-500",children:a.avgRating.toFixed(1)})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Average Rating"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-soft p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto w-full lg:w-auto",children:Ht.map(d=>{const x=d.id==="all"?s.length:s.filter(o=>o.category===d.id).length;return e.jsxs("button",{onClick:()=>m(d.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u===d.id?"bg-primary text-white shadow-soft":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:d.icon}),e.jsx("span",{children:d.label}),e.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded-full text-xs",children:x})]},d.id)})}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",value:b,onChange:d=>f(d.target.value),placeholder:"Search vendors...",className:"w-full pl-10 pr-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex items-center gap-1 p-1 bg-dark-brown/5 rounded-lg",children:[e.jsx("button",{onClick:()=>p("grid"),className:`p-2 rounded-lg transition-all ${r==="grid"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(qs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>p("list"),className:`p-2 rounded-lg transition-all ${r==="list"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})})]})]})]})}),r==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(d=>e.jsxs(xe,{to:`/vendors/${d.id}`,className:"bg-white rounded-xl shadow-soft hover:shadow-soft-lg transition-all overflow-hidden border-l-4 border-transparent hover:border-primary group",children:[e.jsx("div",{className:`h-2 ${_(d.category)}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary group-hover:text-accent transition-colors mb-1",children:d.name}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(d.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:y(d.category)}),d.category]})]})}),e.jsxs("div",{className:"flex items-center gap-1 mb-4",children:[j(d.current_rating||3),e.jsxs("span",{className:"text-sm text-dark-brown/60 ml-2",children:["(",d.current_rating?.toFixed(1)||"3.0",")"]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[d.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsx("span",{children:d.phone})]}),d.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:d.email})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Total Spent"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",d.totalSpent?.toFixed(0)||"0"]})]}),d.pendingAmount>0&&e.jsxs("div",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",d.pendingAmount.toFixed(0)," due"]})]})]})]},d.id))}):e.jsx("div",{className:"bg-white rounded-xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Vendor Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Contact"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Rating"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Total Spent"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Pending"})]})}),e.jsx("tbody",{children:c.map((d,x)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${x%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx(xe,{to:`/vendors/${d.id}`,className:"font-semibold text-primary hover:text-accent transition-colors",children:d.name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(d.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:y(d.category)}),d.category]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[d.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(ht,{className:"w-3 h-3"}),d.phone]}),d.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(ze,{className:"w-3 h-3"}),d.email]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[j(d.current_rating||3),e.jsx("span",{className:"text-sm text-dark-brown/60",children:d.current_rating?.toFixed(1)||"3.0"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",d.totalSpent?.toFixed(0)||"0"]})}),e.jsx("td",{className:"px-6 py-4",children:d.pendingAmount>0?e.jsxs("span",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",d.pendingAmount.toFixed(0)]}):e.jsx("span",{className:"text-sm text-dark-brown/40",children:"-"})})]},d.id))})]})})}),c.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:b?"Try adjusting your search":"Add your first vendor to get started"}),!b&&e.jsx("button",{onClick:()=>n(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Vendor"})]})]}),t&&e.jsx(dn,{onClose:()=>n(!1),onSuccess:()=>{n(!1),h()}})]})}function xn({vendor:s}){const[l,c]=i.useState({totalSpent:0,thisMonth:0,thisYear:0,avgTransaction:0,pendingPayment:0,totalTransactions:0}),[g,r]=i.useState([]);i.useEffect(()=>{p(),u()},[s.id]);const p=async()=>{try{const{data:m}=await C.from("vendor_transactions").select("*").eq("vendor_id",s.id);if(!m)return;const b=new Date,f=m.filter(k=>{const _=new Date(k.date);return _.getMonth()===b.getMonth()&&_.getFullYear()===b.getFullYear()}),t=m.filter(k=>new Date(k.date).getFullYear()===b.getFullYear()),n=m.reduce((k,_)=>k+parseFloat(_.amount),0),a=f.reduce((k,_)=>k+parseFloat(_.amount),0),N=t.reduce((k,_)=>k+parseFloat(_.amount),0),h=m.filter(k=>k.status==="pending").reduce((k,_)=>k+parseFloat(_.amount),0);c({totalSpent:n,thisMonth:a,thisYear:N,avgTransaction:m.length>0?n/m.length:0,pendingPayment:h,totalTransactions:m.length})}catch(m){console.error("Error fetching stats:",m)}},u=async()=>{try{const{data:m}=await C.from("vendor_transactions").select("date, amount").eq("vendor_id",s.id).order("date");if(!m)return;const b={};m.forEach(t=>{const n=new Date(t.date),a=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;b[a]||(b[a]=0),b[a]+=parseFloat(t.amount)});const f=Object.entries(b).map(([t,n])=>({month:t,amount:n}));r(f.slice(-12))}catch(m){console.error("Error fetching spending trend:",m)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Vendor Information"}),e.jsxs("div",{className:"space-y-3",children:[s.contact_person&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Contact Person"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.contact_person})]})]}),s.phone&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ht,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Phone"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.phone}),s.alternate_phone&&e.jsx("p",{className:"text-sm text-dark-brown/60",children:s.alternate_phone})]})]}),s.email&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ze,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Email"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.email})]})]}),s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Us,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Address"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.address})]})]}),s.website&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ea,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Website"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-accent hover:underline",children:s.website})]})]}),s.gst_number&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(mt,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"GST Number"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.gst_number})]})]}),s.payment_terms&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ’³"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Payment Terms"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.payment_terms})]})]}),s.certifications&&Array.isArray(s.certifications)&&s.certifications.length>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Qe,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Certifications"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:s.certifications.map((m,b)=>e.jsx("span",{className:"px-2 py-1 bg-sage/20 text-sage text-xs font-semibold rounded-full",children:m},b))})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",l.totalSpent.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",l.thisMonth.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Year"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",l.thisYear.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Avg Transaction"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",l.avgTransaction.toFixed(0)]})]})]}),l.pendingPayment>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Pending Payment"}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",l.pendingPayment.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Total Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:l.totalTransactions})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Category"}),e.jsx("span",{className:"font-bold text-primary",children:s.category})]}),s.products&&e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Products/Services"}),e.jsx("span",{className:"font-semibold text-primary text-right",children:s.products})]})]})]})]})]}),g.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(se,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Spending Trend (Last 12 Months)"})]}),e.jsx(ge,{width:"100%",height:300,children:e.jsxs(Mt,{data:g,children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Le,{dataKey:"month",stroke:"#6B5A4C",style:{fontSize:"12px"}}),e.jsx($e,{stroke:"#6B5A4C",style:{fontSize:"12px"},tickFormatter:m=>`â‚¹${m}`}),e.jsx(je,{contentStyle:{backgroundColor:"#fff",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},formatter:m=>[`â‚¹${m.toFixed(0)}`,"Spending"]}),e.jsx(qe,{type:"monotone",dataKey:"amount",stroke:"#8B9A7E",strokeWidth:3,dot:{fill:"#8B9A7E",r:4},activeDot:{r:6}})]})})]})]})}function mn({vendorId:s}){const[l,c]=i.useState([]),[g,r]=i.useState([]),[p,u]=i.useState("all");i.useEffect(()=>{m()},[s]),i.useEffect(()=>{b()},[l,p]);const m=async()=>{try{const{data:a,error:N}=await C.from("vendor_transactions").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(N)throw N;c(a||[])}catch(a){console.error("Error fetching transactions:",a)}},b=()=>{r(p==="all"?l:l.filter(a=>a.status===p))},f=g.reduce((a,N)=>a+parseFloat(N.amount),0),t=g.filter(a=>a.status==="paid").reduce((a,N)=>a+parseFloat(N.amount),0),n=g.filter(a=>a.status==="pending").reduce((a,N)=>a+parseFloat(N.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ls,{className:"w-5 h-5 text-dark-brown/60"}),e.jsxs("select",{value:p,onChange:a=>u(a.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Transactions"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Transaction"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Transactions"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",f.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[g.length," transactions"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",t.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[g.filter(a=>a.status==="paid").length," transactions"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",n.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[g.filter(a=>a.status==="pending").length," transactions"]})]})]}),e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:g.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Payment Mode"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Invoice #"})]})}),e.jsx("tbody",{children:g.map((a,N)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${N%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:new Date(a.date).toLocaleDateString()})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${a.transaction_type==="expense"?"bg-accent/10 text-accent":"bg-sage/10 text-sage"}`,children:a.transaction_type})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:a.description||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4 text-sage"}),e.jsxs("span",{className:"text-sm font-bold text-sage",children:["â‚¹",parseFloat(a.amount).toFixed(2)]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:a.payment_mode||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${a.status==="paid"?"bg-sage/10 text-sage":"bg-soft-red/10 text-soft-red"}`,children:a.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:a.invoice_number||"-"})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(De,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No transactions found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Start by adding your first transaction"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Transaction"})]})})]})}function hn({vendorId:s}){const[l,c]=i.useState([]);i.useEffect(()=>{g()},[s]);const g=async()=>{try{const{data:t,error:n}=await C.from("vendor_invoices").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(n)throw n;c(t||[])}catch(t){console.error("Error fetching invoices:",t)}},r=t=>{switch(t){case"paid":return e.jsx(Y,{className:"w-5 h-5 text-sage"});case"overdue":return e.jsx(fe,{className:"w-5 h-5 text-soft-red"});default:return e.jsx(ie,{className:"w-5 h-5 text-accent"})}},p=t=>{switch(t){case"paid":return"bg-sage/10 text-sage";case"overdue":return"bg-soft-red/10 text-soft-red";default:return"bg-accent/10 text-accent"}},u=l.reduce((t,n)=>t+parseFloat(n.amount),0),m=l.filter(t=>t.status==="paid").reduce((t,n)=>t+parseFloat(n.amount),0),b=l.filter(t=>t.status==="pending").reduce((t,n)=>t+parseFloat(n.amount),0),f=l.filter(t=>t.status==="overdue").reduce((t,n)=>t+parseFloat(n.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Invoice Management"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Upload Invoice"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Invoices"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",u.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[l.length," invoices"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",m.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[l.filter(t=>t.status==="paid").length," invoices"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",b.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[l.filter(t=>t.status==="pending").length," invoices"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Overdue"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",f.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[l.filter(t=>t.status==="overdue").length," invoices"]})]})]}),e.jsx("div",{className:"space-y-4",children:l.length>0?l.map(t=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ae,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary",children:["Invoice #",t.invoice_number]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Date: ",new Date(t.date).toLocaleDateString()," | Due: ",new Date(t.due_date).toLocaleDateString()]})]})]}),t.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2",children:t.notes})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",parseFloat(t.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r(t.status),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${p(t.status)}`,children:t.status})]}),t.status!=="paid"&&e.jsx("button",{className:"px-4 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg font-semibold transition-colors",children:"Mark as Paid"})]})]}),t.paid_date&&e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Paid on: ",new Date(t.paid_date).toLocaleDateString()," | Amount: â‚¹",parseFloat(t.paid_amount).toFixed(2)]})})]},t.id)):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No invoices found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Upload your first invoice to get started"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Invoice"})]})})]})}function pn({vendorId:s}){const[l,c]=i.useState([]);i.useEffect(()=>{g()},[s]);const g=async()=>{try{const{data:r,error:p}=await C.from("vendor_prices").select("*").eq("vendor_id",s).order("product_name");if(p)throw p;c(r||[])}catch(r){console.error("Error fetching prices:",r)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Price List"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Price Item"]})]}),l.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Product/Service"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Unit"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Price"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"MOQ"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Lead Time"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Last Updated"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:l.map((r,p)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${p%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:r.product_name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-semibold",children:r.category||"General"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:r.unit})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-lg font-bold text-sage",children:["â‚¹",parseFloat(r.price).toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:r.moq||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:r.lead_time?`${r.lead_time} days`:"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/60",children:new Date(r.updated_at).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-primary/10 text-primary rounded-lg transition-colors",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-accent/10 text-accent rounded-lg transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]})})]},r.id))})]})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(oe,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No price items found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add price items to track vendor pricing"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Price Item"})]})]})}const vs=[{id:"contracts",label:"Contracts & Agreements",icon:"ðŸ“„"},{id:"gst",label:"GST Certificate",icon:"ðŸ“œ"},{id:"certifications",label:"Quality Certifications",icon:"ðŸ†"},{id:"catalogs",label:"Product Catalogs",icon:"ðŸ“‹"},{id:"reports",label:"Test Reports",icon:"ðŸ“Š"},{id:"other",label:"Other Documents",icon:"ðŸ’¼"}];function bn({vendorId:s}){const[l,c]=i.useState([]),[g,r]=i.useState("all");i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:f,error:t}=await C.from("vendor_documents").select("*").eq("vendor_id",s).order("uploaded_at",{ascending:!1});if(t)throw t;c(f||[])}catch(f){console.error("Error fetching documents:",f)}},u=g==="all"?l:l.filter(f=>f.category===g),m=f=>vs.find(t=>t.id===f)||{icon:"ðŸ“„",label:f},b=f=>f<1024?f+" B":f<1024*1024?(f/1024).toFixed(1)+" KB":(f/(1024*1024)).toFixed(1)+" MB";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Documents"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Upload Document"]})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>r("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",l.length,")"]}),vs.map(f=>{const t=l.filter(n=>n.category===f.id).length;return e.jsxs("button",{onClick:()=>r(f.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g===f.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:f.icon}),f.label," (",t,")"]},f.id)})]}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(f=>{const t=m(f.category);return e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl flex-shrink-0",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:f.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:t.label})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60 mb-3",children:[e.jsx("span",{children:b(f.file_size||0)}),e.jsx("span",{children:new Date(f.uploaded_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]})]},f.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:g==="all"?"Upload documents to keep vendor information organized":`No ${m(g).label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Document"})]})]})}const Wt=[{id:"quality",label:"Product Quality"},{id:"delivery",label:"Delivery Time"},{id:"pricing",label:"Pricing"},{id:"service",label:"Customer Service"},{id:"reliability",label:"Reliability"}];function un({vendorId:s,vendorRating:l}){const{user:c}=G(),[g,r]=i.useState([]),[p,u]=i.useState([]),[m,b]=i.useState(""),[f,t]=i.useState(!1),[n,a]=i.useState({category:"quality",rating:5,text:""});i.useEffect(()=>{N(),h()},[s]);const N=async()=>{try{const{data:d,error:x}=await C.from("vendor_notes").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(x)throw x;r(d||[])}catch(d){console.error("Error fetching notes:",d)}},h=async()=>{try{const{data:d,error:x}=await C.from("vendor_reviews").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(x)throw x;u(d||[])}catch(d){console.error("Error fetching reviews:",d)}},k=async()=>{if(m.trim())try{const{error:d}=await C.from("vendor_notes").insert([{vendor_id:s,note_text:m,written_by:c?.id}]);if(d)throw d;b(""),N()}catch(d){console.error("Error adding note:",d),alert("Error adding note")}},_=async()=>{if(!n.text.trim()){alert("Please write a review");return}try{const{error:d}=await C.from("vendor_reviews").insert([{vendor_id:s,category:n.category,rating:n.rating,review_text:n.text,reviewed_by:c?.id}]);if(d)throw d;a({category:"quality",rating:5,text:""}),t(!1),h()}catch(d){console.error("Error adding review:",d),alert("Error adding review")}},y=(d,x=!1,o)=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(v=>e.jsx("button",{type:"button",onClick:()=>x&&o&&o(v),disabled:!x,className:x?"cursor-pointer":"",children:e.jsx(bt,{className:`w-5 h-5 ${v<=d?"fill-amber-400 text-amber-400":"text-dark-brown/20"} ${x?"hover:fill-amber-400 hover:text-amber-400":""}`})},v))}),j=d=>{const x=p.filter(o=>o.category===d);return x.length===0?0:x.reduce((o,v)=>o+v.rating,0)/x.length};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Internal Notes"})}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:[e.jsx("textarea",{value:m,onChange:d=>b(d.target.value),placeholder:"Add a note about this vendor...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none mb-3"}),e.jsxs("button",{onClick:k,disabled:!m.trim(),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all disabled:opacity-50",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Note"]})]}),e.jsx("div",{className:"space-y-3",children:g.length>0?g.map(d=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(We,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"User"}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[new Date(d.created_at).toLocaleDateString()," at"," ",new Date(d.created_at).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1 hover:bg-primary/10 text-primary rounded transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:d.note_text})]},d.id)):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Tt,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No notes yet"})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Ratings & Reviews"}),e.jsxs("button",{onClick:()=>t(!f),className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Review"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-amber-600/10 rounded-xl p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-5xl font-bold text-amber-600 mb-2",children:l?.toFixed(1)||"0.0"}),y(l||0),e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-2",children:["Based on ",p.length," reviews"]})]}),e.jsx("div",{className:"space-y-2",children:Wt.map(d=>{const x=j(d.id);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:d.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[y(x),e.jsx("span",{className:"text-sm text-dark-brown/60 w-8",children:x>0?x.toFixed(1):"-"})]})]},d.id)})})]}),f&&e.jsx("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:n.category,onChange:d=>a({...n,category:d.target.value}),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:Wt.map(d=>e.jsx("option",{value:d.id,children:d.label},d.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),y(n.rating,!0,d=>a({...n,rating:d}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Review"}),e.jsx("textarea",{value:n.text,onChange:d=>a({...n,text:d.target.value}),placeholder:"Write your review...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(!1),className:"flex-1 px-4 py-2 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:_,className:"flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-amber-600 text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Submit Review"})]})]})}),e.jsx("div",{className:"space-y-3",children:p.length>0?p.map(d=>{const x=Wt.find(o=>o.id===d.category);return e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:x?.label}),y(d.rating)]}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(d.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:d.review_text})]},d.id)}):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(bt,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No reviews yet"})]})})]})]})})}const gn=[{id:"overview",label:"Overview",icon:xt},{id:"transactions",label:"Transactions",icon:mt},{id:"invoices",label:"Invoices",icon:Dt},{id:"prices",label:"Price List",icon:gt},{id:"documents",label:"Documents",icon:ae},{id:"notes",label:"Notes & Reviews",icon:Tt}],fn=s=>({"Raw Materials":"bg-sage/20",Packaging:"bg-secondary/20",Printing:"bg-blue-500/20",Logistics:"bg-accent/20","Lab Testing":"bg-purple-500/20",Other:"bg-dark-brown/20"})[s]||"bg-dark-brown/10";function jn(){const{id:s}=Ye(),l=me(),[c,g]=i.useState(null),[r,p]=i.useState("overview"),[u,m]=i.useState(!0);i.useEffect(()=>{s&&b()},[s]);const b=async()=>{try{const{data:n,error:a}=await C.from("vendors").select("*").eq("id",s).maybeSingle();if(a)throw a;g(n)}catch(n){console.error("Error fetching vendor:",n)}finally{m(!1)}},f=async()=>{if(confirm("Are you sure you want to delete this vendor? This action cannot be undone."))try{const{error:n}=await C.from("vendors").delete().eq("id",s);if(n)throw n;l("/vendors")}catch(n){console.error("Error deleting vendor:",n),alert("Error deleting vendor")}},t=n=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(a=>e.jsx(bt,{className:`w-5 h-5 ${a<=n?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},a))});return u?e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading vendor details..."})]})})]}):c?e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/vendors"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Back to Vendors"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start gap-4 mb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-2",children:c.name}),e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${fn(c.category)} rounded-full text-sm font-semibold`,children:c.category})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[t(c.current_rating||3),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown/60",children:[c.current_rating?.toFixed(1)||"3.0"," / 5.0"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{},className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(de,{className:"w-4 h-4"}),"Delete"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:gn.map(n=>{const a=n.icon;return e.jsxs("button",{onClick:()=>p(n.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${r===n.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(a,{className:"w-5 h-5"}),n.label]},n.id)})})}),e.jsxs("div",{className:"p-6",children:[r==="overview"&&e.jsx(xn,{vendor:c,onUpdate:b}),r==="transactions"&&e.jsx(mn,{vendorId:c.id}),r==="invoices"&&e.jsx(hn,{vendorId:c.id}),r==="prices"&&e.jsx(pn,{vendorId:c.id}),r==="documents"&&e.jsx(bn,{vendorId:c.id}),r==="notes"&&e.jsx(un,{vendorId:c.id,vendorRating:c.current_rating})]})]})]})]}):e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Vendor not found"}),e.jsx("button",{onClick:()=>l("/vendors"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Vendors"})]})})]})}function yn({products:s,onClose:l,onSuccess:c}){const{user:g}=G(),[r,p]=i.useState(!1),[u,m]=i.useState(null),[b,f]=i.useState({batchNumber:"",manufacturingDate:$(new Date,"yyyy-MM-dd"),batchSize:"",expiryDate:"",storageLocation:"",qcNotes:""}),[t,n]=i.useState([]),[a,N]=i.useState({ingredientsVerified:!1,formulaFollowed:!1,phTestPassed:!1,visualInspectionPassed:!1,packagingChecked:!1,labelsApplied:!1,batchApproved:!1});i.useEffect(()=>{u&&(h(),k(),_())},[u]);const h=()=>{const o=$(new Date,"yyyyMMdd"),v=u?.name?.substring(0,3).toUpperCase()||"PRD",w="001";f(P=>({...P,batchNumber:`BT-${v}-${o}-${w}`}))},k=()=>{const o=u?.shelf_life||24,v=Ds(new Date(b.manufacturingDate),o);f(w=>({...w,expiryDate:$(v,"yyyy-MM-dd")}))},_=async()=>{if(u?.id)try{const{data:o,error:v}=await C.from("product_ingredients").select("*").eq("product_id",u.id);if(v)throw v;o&&o.length>0?n(o.map(w=>({name:w.ingredient_name,lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:w.quantity||"",unit:w.unit||"kg"}))):n([])}catch(o){console.error("Error loading ingredients:",o)}},y=()=>{n([...t,{name:"",lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:"",unit:"kg"}])},j=o=>{n(t.filter((v,w)=>w!==o))},d=(o,v,w)=>{const P=[...t];P[o]={...P[o],[v]:w},n(P)},x=async o=>{if(o.preventDefault(),!u||!b.batchNumber||!b.batchSize){alert("Please fill in all required fields");return}p(!0);try{const{data:v,error:w}=await C.from("batches").insert([{batch_number:b.batchNumber,product_id:u.id,manufacturing_date:b.manufacturingDate,expiry_date:b.expiryDate,batch_size:parseInt(b.batchSize),units_in_stock:parseInt(b.batchSize),storage_location:b.storageLocation,qc_checklist:a,qc_notes:b.qcNotes,qc_approved:a.batchApproved,status:"active",created_by:g?.id}]).select().single();if(w)throw w;if(t.length>0&&v){const P=t.filter(T=>T.name).map(T=>({batch_id:v.id,ingredient_name:T.name,lot_number:T.lotNumber,supplier_batch_number:T.supplierBatchNumber,vendor_id:T.vendorId,ingredient_expiry_date:T.ingredientExpiryDate||null,quantity_used:T.quantityUsed?parseFloat(T.quantityUsed):null,unit:T.unit}));if(P.length>0){const{error:T}=await C.from("batch_ingredients").insert(P);if(T)throw T}}c()}catch(v){console.error("Error creating batch:",v),alert("Error creating batch. Please try again.")}finally{p(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Create New Batch"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:x,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:u?.id||"",onChange:o=>{const v=s.find(w=>w.id===o.target.value);m(v)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select a product"}),s.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:b.batchNumber,onChange:o=>f({...b,batchNumber:o.target.value}),placeholder:"BT-PRD-20241215-001",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Size (units) ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"number",value:b.batchSize,onChange:o=>f({...b,batchSize:o.target.value}),placeholder:"500",required:!0,min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Manufacturing Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:b.manufacturingDate,onChange:o=>{f({...b,manufacturingDate:o.target.value}),u&&k()},max:$(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:b.expiryDate,onChange:o=>f({...b,expiryDate:o.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:b.storageLocation,onChange:o=>f({...b,storageLocation:o.target.value}),placeholder:"e.g., Section A, Shelf 3",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Ingredients Used (Lot Tracking)"}),e.jsxs("button",{type:"button",onClick:y,className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Ingredient"]})]}),t.length>0?e.jsx("div",{className:"space-y-4",children:t.map((o,v)=>e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Ingredient #",v+1]}),e.jsx("button",{type:"button",onClick:()=>j(v),className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Name"}),e.jsx("input",{type:"text",value:o.name,onChange:w=>d(v,"name",w.target.value),placeholder:"e.g., Ashwagandha Powder",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Lot Number"}),e.jsx("input",{type:"text",value:o.lotNumber,onChange:w=>d(v,"lotNumber",w.target.value),placeholder:"Internal lot number",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Supplier Batch Number"}),e.jsx("input",{type:"text",value:o.supplierBatchNumber,onChange:w=>d(v,"supplierBatchNumber",w.target.value),placeholder:"Supplier's batch",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Quantity Used"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:o.quantityUsed,onChange:w=>d(v,"quantityUsed",w.target.value),placeholder:"Amount",step:"0.01",className:"flex-1 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:o.unit,onChange:w=>d(v,"unit",w.target.value),className:"px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"l",children:"l"}),e.jsx("option",{value:"ml",children:"ml"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Expiry Date"}),e.jsx("input",{type:"date",value:o.ingredientExpiryDate,onChange:w=>d(v,"ingredientExpiryDate",w.target.value),className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]},v))}):e.jsx("p",{className:"text-sm text-dark-brown/60 text-center py-4",children:"No ingredients added yet. Add ingredients to enable full traceability."})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality Control"}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.ingredientsVerified,onChange:o=>N({...a,ingredientsVerified:o.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"All ingredients verified"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.formulaFollowed,onChange:o=>N({...a,formulaFollowed:o.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Formula followed correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.phTestPassed,onChange:o=>N({...a,phTestPassed:o.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"pH test passed (if applicable)"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.visualInspectionPassed,onChange:o=>N({...a,visualInspectionPassed:o.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Visual inspection passed"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.packagingChecked,onChange:o=>N({...a,packagingChecked:o.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Packaging quality checked"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.labelsApplied,onChange:o=>N({...a,labelsApplied:o.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Labels applied correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.batchApproved,onChange:o=>N({...a,batchApproved:o.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Batch approved for distribution"})]}),e.jsxs("div",{className:"pt-3 border-t border-dark-brown/10",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC Notes"}),e.jsx("textarea",{value:b.qcNotes,onChange:o=>f({...b,qcNotes:o.target.value}),placeholder:"Any additional quality control notes...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:x,disabled:r,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:r?"Creating...":"Create Batch"})]})]})})}function wn(){const[s,l]=i.useState([]),[c,g]=i.useState([]),[r,p]=i.useState([]),[u,m]=i.useState(""),[b,f]=i.useState("all"),[t,n]=i.useState(!1),[a,N]=i.useState({activeBatches:0,totalUnits:0,expiringSoon:0,productsWithBatches:0});i.useEffect(()=>{h(),k()},[]),i.useEffect(()=>{_(),y()},[s,u,b]);const h=async()=>{try{const{data:o,error:v}=await C.from("batches").select("*, products(name, images)").order("created_at",{ascending:!1});if(v)throw v;l(o||[])}catch(o){console.error("Error fetching batches:",o)}},k=async()=>{try{const{data:o,error:v}=await C.from("products").select("id, name, images").order("name");if(v)throw v;p(o||[])}catch(o){console.error("Error fetching products:",o)}},_=()=>{let o=s;if(b!=="all"&&(o=o.filter(v=>v.status===b)),u){const v=u.toLowerCase();o=o.filter(w=>w.batch_number?.toLowerCase().includes(v)||w.products?.name?.toLowerCase().includes(v))}g(o)},y=()=>{const o=new Date,v=s.filter(S=>S.status==="active").length,w=s.reduce((S,A)=>S+(A.units_in_stock||0),0),P=s.filter(S=>{const A=X(new Date(S.expiry_date),o);return A<=30&&A>=0}).length,T=new Set(s.map(S=>S.product_id)).size;N({activeBatches:v,totalUnits:w,expiringSoon:P,productsWithBatches:T})},j=o=>{const v=X(new Date(o),new Date);return v<0||v<=15?"text-soft-red":v<=30?"text-accent":v<=60?"text-amber-500":"text-sage"},d=o=>{const v=X(new Date(o.expiry_date),new Date);return o.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:v<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:o.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:v<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:o.units_in_stock<o.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:o.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}},x=o=>o.units_in_stock/o.batch_size*100;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Ne,{}),e.jsx(H,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(J,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Batch & Lot Tracking"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Complete traceability for manufacturing"})]}),e.jsxs(pe,{onClick:()=>n(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"New Batch"]})]})]}),e.jsxs(pe,{onClick:()=>n(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"New Batch"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(Y,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:a.activeBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active Batches"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(oe,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:a.totalUnits})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Units in Stock"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(he,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:`text-3xl font-bold ${a.expiringSoon>0?"text-accent":"text-primary/40"}`,children:a.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring Soon (30d)"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-blue-500/20 rounded-button",children:e.jsx(ie,{className:"w-6 h-6 text-blue-500"})}),e.jsx("span",{className:"text-3xl font-bold text-blue-500",children:a.productsWithBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Products with Batches"})]})]}),e.jsx(J,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:()=>f("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${b==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All Batches (",s.length,")"]}),e.jsxs("button",{onClick:()=>f("active"),className:`px-4 py-2 rounded-button font-bold transition-all ${b==="active"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Active (",s.filter(o=>o.status==="active").length,")"]}),e.jsxs("button",{onClick:()=>f("sold_out"),className:`px-4 py-2 rounded-button font-bold transition-all ${b==="sold_out"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Sold Out (",s.filter(o=>o.status==="sold_out").length,")"]})]}),e.jsxs("div",{className:"relative w-full lg:w-64",children:[e.jsx(ft,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:u,onChange:o=>m(o.target.value),placeholder:"Search batches...",className:"input-float w-full pl-12"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(o=>{const v=d(o),w=x(o),P=X(new Date(o.expiry_date),new Date);return e.jsx(xe,{to:`/batches/${o.id}`,className:"block",children:e.jsx(J,{className:"hover:shadow-glow transition-all duration-300 group h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${v.color}`,children:[e.jsx("span",{className:"mr-1",children:v.icon}),v.label]})}),e.jsx("h3",{className:"font-mono text-lg font-bold text-primary group-hover:text-accent transition-colors mb-1",children:o.batch_number}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:o.products?.name||"Unknown Product"})]}),e.jsx(Bs,{className:"w-8 h-8 text-dark-brown/20 group-hover:text-primary transition-colors"})]}),o.products?.images&&o.products.images[0]&&e.jsx("div",{className:"w-full h-32 mb-4 rounded-lg overflow-hidden bg-cream",children:e.jsx("img",{src:o.products.images[0],alt:o.products.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Manufacturing"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(new Date(o.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Expiry"}),e.jsxs("span",{className:`font-semibold ${j(o.expiry_date)}`,children:[$(new Date(o.expiry_date),"MMM dd, yyyy"),e.jsxs("span",{className:"text-xs ml-1",children:["(",P>=0?`${P}d left`:"Expired",")"]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Stock Status"}),e.jsxs("span",{className:"font-bold text-primary",children:[o.units_in_stock," / ",o.batch_size," units"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${w>50?"bg-sage":w>20?"bg-amber-500":"bg-soft-red"}`,style:{width:`${w}%`}})})]}),o.qc_approved&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-sage",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold",children:"QC Approved"})]})]})})},o.id)})}),c.length===0&&e.jsxs(J,{className:"text-center py-16",children:[e.jsx(oe,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No batches found"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:u?"Try adjusting your search":"Create your first batch to start tracking"}),!u&&e.jsx(pe,{onClick:()=>n(!0),variant:"primary",size:"lg",children:"Create Batch"})]})]}),t&&e.jsx(yn,{products:r,onClose:()=>n(!1),onSuccess:()=>{n(!1),h()}})]})}function Nn({batch:s}){const[l,c]=i.useState([]);i.useEffect(()=>{g()},[s.id]);const g=async()=>{try{const{data:u,error:m}=await C.from("batch_ingredients").select("*, vendors(name)").eq("batch_id",s.id);if(m)throw m;c(u||[])}catch(u){console.error("Error fetching ingredients:",u)}},r=X(new Date(s.expiry_date),new Date),p=s.units_in_stock/s.batch_size*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(oe,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Batch Number"}),e.jsx("p",{className:"font-mono font-bold text-dark-brown",children:s.batch_number})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ“…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(s.manufacturing_date),"MMMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"â°"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(s.expiry_date),"MMMM dd, yyyy")}),e.jsx("p",{className:`text-xs mt-1 font-semibold ${r<0?"text-soft-red":r<=30?"text-accent":r<=60?"text-amber-500":"text-sage"}`,children:r>=0?`${r} days remaining`:"Expired"})]})]}),s.storage_location&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Us,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Storage Location"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.storage_location})]})]}),s.qc_approved&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-sage/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Y,{className:"w-5 h-5 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Quality Control"}),e.jsx("p",{className:"font-semibold text-sage",children:"Approved"}),s.qc_approved_date&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["on ",$(new Date(s.qc_approved_date),"MMM dd, yyyy")]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Produced"}),e.jsx("p",{className:"text-3xl font-bold",children:s.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_in_stock})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Sold"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_sold||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_damaged||0})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Remaining"}),e.jsxs("span",{className:"font-bold",children:[p.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all",style:{width:`${p}%`}})})]})]}),s.products&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Product Details"}),e.jsxs("div",{className:"flex items-start gap-4",children:[s.products.images&&s.products.images[0]&&e.jsx("img",{src:s.products.images[0],alt:s.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:s.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",s.batch_number]})]})]})]})]})]}),l.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Ingredient Traceability"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"Complete ingredient lot tracking for full traceability"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Supplier Batch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity Used"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry"})]})}),e.jsx("tbody",{children:l.map((u,m)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${m%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:u.ingredient_name}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:u.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:u.supplier_batch_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:u.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:u.quantity_used?`${u.quantity_used} ${u.unit}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:u.ingredient_expiry_date?$(new Date(u.ingredient_expiry_date),"MMM dd, yyyy"):"-"})]},u.id))})]})})]})]})}function vn({batchId:s,batch:l}){const[c,g]=i.useState([]);i.useEffect(()=>{r()},[s]);const r=async()=>{try{const{data:m,error:b}=await C.from("batch_tests").select("*").eq("batch_id",s).order("test_date",{ascending:!1});if(b)throw b;g(m||[])}catch(m){console.error("Error fetching tests:",m)}},p=l.qc_checklist||{},u=[{key:"ingredientsVerified",label:"All ingredients verified"},{key:"formulaFollowed",label:"Formula followed correctly"},{key:"phTestPassed",label:"pH test passed"},{key:"visualInspectionPassed",label:"Visual inspection passed"},{key:"packagingChecked",label:"Packaging quality checked"},{key:"labelsApplied",label:"Labels applied correctly"},{key:"batchApproved",label:"Batch approved for distribution"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"QC Checklist"}),l.qc_approved&&e.jsxs("span",{className:"flex items-center gap-2 px-3 py-1 bg-sage/10 text-sage rounded-full text-sm font-bold",children:[e.jsx(Y,{className:"w-4 h-4"}),"Approved"]})]}),e.jsx("div",{className:"space-y-3",children:u.map(m=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[p[m.key]?e.jsx(Y,{className:"w-5 h-5 text-sage flex-shrink-0"}):e.jsx(Se,{className:"w-5 h-5 text-dark-brown/20 flex-shrink-0"}),e.jsx("span",{className:`text-sm font-semibold ${p[m.key]?"text-dark-brown":"text-dark-brown/40"}`,children:m.label})]},m.key))}),l.qc_notes&&e.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-2",children:"QC Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:l.qc_notes})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Test Results"}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Test"]})]}),c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(m=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:m.test_type}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${m.result.toLowerCase().includes("pass")?"bg-sage/10 text-sage":m.result.toLowerCase().includes("fail")?"bg-soft-red/10 text-soft-red":"bg-accent/10 text-accent"}`,children:m.result})]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Tested on: ",new Date(m.test_date).toLocaleDateString()]}),m.notes&&e.jsx("p",{className:"text-sm text-dark-brown mt-2",children:m.notes})]},m.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No test results recorded"})]})]})})]})})}function kn({batchId:s,batch:l,onUpdate:c}){const[g,r]=i.useState([]),[p,u]=i.useState([]);i.useEffect(()=>{m(),b()},[s]);const m=async()=>{try{const{data:f,error:t}=await C.from("batch_dispatches").select("*").eq("batch_id",s).order("dispatch_date",{ascending:!1});if(t)throw t;r(f||[])}catch(f){console.error("Error fetching dispatches:",f)}},b=async()=>{try{const{data:f,error:t}=await C.from("batch_stock_adjustments").select("*").eq("batch_id",s).order("adjustment_date",{ascending:!1});if(t)throw t;u(f||[])}catch(f){console.error("Error fetching adjustments:",f)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Units"}),e.jsx("p",{className:"text-3xl font-bold",children:l.batch_size})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:l.units_in_stock})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Sold/Dispatched"}),e.jsx("p",{className:"text-3xl font-bold text-blue-500",children:l.units_sold||0})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:l.units_damaged||0})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Dispatch History"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-4 h-4"}),"Record Dispatch"]})]}),g.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Dispatch To"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Invoice #"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"})]})}),e.jsx("tbody",{children:g.map((f,t)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${t%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:$(new Date(f.dispatch_date),"MMM dd, yyyy")})]})}),e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:f.dispatch_to}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[f.quantity," units"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70 font-mono",children:f.invoice_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:f.dispatch_method||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f.status==="delivered"?"bg-sage/10 text-sage":"bg-accent/10 text-accent"}`,children:f.status})})]},f.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(oe,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"No dispatches recorded"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Record First Dispatch"})]})]}),p.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Adjustments"}),e.jsx("div",{className:"space-y-3",children:p.map(f=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-soft-red/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(we,{className:"w-5 h-5 text-soft-red"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown capitalize",children:f.adjustment_type}),e.jsxs("span",{className:"font-bold text-soft-red",children:["-",f.quantity," units"]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-1",children:f.reason}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:$(new Date(f.adjustment_date),"MMM dd, yyyy")}),f.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2 italic",children:f.notes})]})]},f.id))})]})]})}const Qt=[{id:"product",label:"Product Photos",icon:"ðŸ“¦"},{id:"packaging",label:"Packaging Photos",icon:"ðŸ“¦"},{id:"label",label:"Label Photos",icon:"ðŸ·ï¸"},{id:"qc",label:"QC Photos",icon:"âœ…"},{id:"process",label:"Process Photos",icon:"âš™ï¸"}];function _n({batchId:s}){const[l,c]=i.useState([]),[g,r]=i.useState("all");i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:m,error:b}=await C.from("batch_photos").select("*").eq("batch_id",s).order("uploaded_at",{ascending:!1});if(b)throw b;c(m||[])}catch(m){console.error("Error fetching photos:",m)}},u=g==="all"?l:l.filter(m=>m.category===g);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>r("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Photos (",l.length,")"]}),Qt.map(m=>{const b=l.filter(f=>f.category===m.id).length;return e.jsxs("button",{onClick:()=>r(m.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g===m.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:m.icon}),m.label," (",b,")"]},m.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-4 h-4"}),"Upload Photos"]})]}),u.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:u.map(m=>{const b=Qt.find(f=>f.id===m.category);return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all group",children:[e.jsxs("div",{className:"aspect-square bg-cream relative",children:[e.jsx("img",{src:m.photo_url,alt:b?.label||"Batch photo",className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}),e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 bg-white/90 backdrop-blur-sm rounded-lg text-xs font-semibold",children:[b?.icon," ",b?.label]})]}),e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(m.uploaded_at).toLocaleDateString()})})]},m.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ss,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No photos uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:g==="all"?"Upload photos to document this batch":`No ${Qt.find(m=>m.id===g)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Photo"})]})]})}const Cn={batch_created:"ðŸŽ‰",status_changed:"ðŸ”„",dispatch:"ðŸ“¤",stock_adjustment:"ðŸ“Š",qc_approved:"âœ…",test_added:"ðŸ§ª",photo_uploaded:"ðŸ“¸",ingredient_added:"ðŸŒ¿"},Sn={batch_created:"bg-sage/10 text-sage",status_changed:"bg-blue-500/10 text-blue-500",dispatch:"bg-accent/10 text-accent",stock_adjustment:"bg-soft-red/10 text-soft-red",qc_approved:"bg-sage/10 text-sage",test_added:"bg-purple-500/10 text-purple-500",photo_uploaded:"bg-blue-500/10 text-blue-500",ingredient_added:"bg-primary/10 text-primary"};function Dn({batchId:s}){const[l,c]=i.useState([]),[g,r]=i.useState(!0);i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:u,error:m}=await C.from("batch_activity_log").select("*").eq("batch_id",s).order("created_at",{ascending:!1});if(m)throw m;c(u||[])}catch(u){console.error("Error fetching activities:",u)}finally{r(!1)}};return g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading activity log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-sage/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Kt,{className:"w-6 h-6 text-primary"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Complete Traceability Log"})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"Full audit trail of all activities and changes for this batch. Every action is logged for compliance and quality assurance."})]}),l.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-dark-brown/10"}),e.jsx("div",{className:"space-y-6",children:l.map((u,m)=>{const b=Cn[u.activity_type]||"ðŸ“",f=Sn[u.activity_type]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:`absolute left-4 w-8 h-8 rounded-full ${f} flex items-center justify-center text-lg z-10`,children:b}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-1",children:u.activity_description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60",children:[e.jsx(ie,{className:"w-3 h-3"}),e.jsxs("span",{children:[$(new Date(u.created_at),"MMM dd, yyyy")," at"," ",$(new Date(u.created_at),"HH:mm")]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f}`,children:u.activity_type.replace("_"," ")})]}),u.details&&Object.keys(u.details).length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/5",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(u.details).map(([t,n])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1 capitalize",children:t.replace(/_/g," ")}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:typeof n=="object"?JSON.stringify(n):String(n)})]},t))})})]})]},u.id)})})]}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Kt,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity will be logged automatically as actions are performed on this batch"})]})]})}const Mn=[{id:"overview",label:"Overview",icon:xt},{id:"quality",label:"Quality & Testing",icon:Ws},{id:"inventory",label:"Inventory & Distribution",icon:oe},{id:"photos",label:"Photos & Documents",icon:Ma},{id:"traceability",label:"Traceability Log",icon:Kt}];function Pn(){const{id:s}=Ye(),l=me(),[c,g]=i.useState(null),[r,p]=i.useState("overview"),[u,m]=i.useState(!0);i.useEffect(()=>{s&&b()},[s]);const b=async()=>{try{const{data:a,error:N}=await C.from("batches").select("*, products(name, images)").eq("id",s).maybeSingle();if(N)throw N;g(a)}catch(a){console.error("Error fetching batch:",a)}finally{m(!1)}},f=async()=>{if(confirm("Are you sure you want to delete this batch? This action cannot be undone."))try{const{error:a}=await C.from("batches").delete().eq("id",s);if(a)throw a;l("/batches")}catch(a){console.error("Error deleting batch:",a),alert("Error deleting batch")}},t=()=>{if(!c)return null;const a=X(new Date(c.expiry_date),new Date);return c.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:a<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:c.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:a<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:c.units_in_stock<c.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:c.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}};if(u)return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading batch details..."})]})})]});if(!c)return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Batch not found"}),e.jsx("button",{onClick:()=>l("/batches"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Batches"})]})})]});const n=t();return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/batches"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Back to Batches"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[c.products?.images&&c.products.images[0]&&e.jsx("img",{src:c.products.images[0],alt:c.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-mono text-3xl font-bold text-primary mb-2",children:c.batch_number}),e.jsx("p",{className:"text-lg font-semibold text-dark-brown",children:c.products?.name||"Unknown Product"}),n&&e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 mt-2 ${n.color} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:n.icon}),n.label]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Bs,{className:"w-4 h-4"}),"QR Code"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Ua,{className:"w-4 h-4"}),"Print Labels"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),c.status!=="recalled"&&e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(Na,{className:"w-4 h-4"}),"Recall"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(de,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(c.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(c.expiry_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Units"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:c.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"In Stock"}),e.jsx("p",{className:"font-semibold text-sage",children:c.units_in_stock})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:Mn.map(a=>{const N=a.icon;return e.jsxs("button",{onClick:()=>p(a.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${r===a.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(N,{className:"w-5 h-5"}),a.label]},a.id)})})}),e.jsxs("div",{className:"p-6",children:[r==="overview"&&e.jsx(Nn,{batch:c,onUpdate:b}),r==="quality"&&e.jsx(vn,{batchId:c.id,batch:c}),r==="inventory"&&e.jsx(kn,{batchId:c.id,batch:c,onUpdate:b}),r==="photos"&&e.jsx(_n,{batchId:c.id}),r==="traceability"&&e.jsx(Dn,{batchId:c.id})]})]})]})]})}function En({vendors:s,onClose:l,onSuccess:c}){const{user:g}=G(),[r,p]=i.useState(!1),[u,m]=i.useState([]),[b,f]=i.useState(!1),[t,n]=i.useState(null),[a,N]=i.useState({ingredientId:"",purchaseDate:$(new Date,"yyyy-MM-dd"),quantity:"",expiryDate:"",lotNumber:"",vendorId:"",costPerUnit:"",invoiceNumber:"",storageLocation:"",notes:""}),[h,k]=i.useState({commonName:"",botanicalName:"",type:"herb",category:"raw_material",defaultUnit:"kg",typicalShelfLifeMonths:"24",reorderLevel:"",preferredVendorId:"",storageConditions:""});i.useEffect(()=>{_()},[]),i.useEffect(()=>{if(t){const d=t.typical_shelf_life_months||24,x=Ds(new Date(a.purchaseDate),d);N(o=>({...o,expiryDate:$(x,"yyyy-MM-dd")}))}},[t,a.purchaseDate]);const _=async()=>{try{const{data:d,error:x}=await C.from("ingredients").select("*").order("common_name");if(x)throw x;m(d||[])}catch(d){console.error("Error fetching ingredients:",d)}},y=async()=>{if(!h.commonName)return alert("Please enter ingredient name"),null;try{const{data:d,error:x}=await C.from("ingredients").insert([{common_name:h.commonName,botanical_name:h.botanicalName,type:h.type,category:h.category,default_unit:h.defaultUnit,typical_shelf_life_months:parseInt(h.typicalShelfLifeMonths),reorder_level:h.reorderLevel?parseFloat(h.reorderLevel):0,preferred_vendor_id:h.preferredVendorId||null,storage_conditions:h.storageConditions}]).select().single();if(x)throw x;return d}catch(d){return console.error("Error creating ingredient:",d),alert("Error creating ingredient"),null}},j=async d=>{d.preventDefault();let x=a.ingredientId;if(b){const o=await y();if(!o)return;x=o.id}if(!x||!a.quantity||!a.purchaseDate||!a.expiryDate){alert("Please fill in all required fields");return}p(!0);try{const o=parseFloat(a.quantity),v=t?.default_unit||h.defaultUnit,{error:w}=await C.from("ingredient_stock").insert([{ingredient_id:x,purchase_date:a.purchaseDate,expiry_date:a.expiryDate,quantity:o,original_quantity:o,unit:v,lot_number:a.lotNumber,vendor_id:a.vendorId||null,cost_per_unit:a.costPerUnit?parseFloat(a.costPerUnit):null,invoice_number:a.invoiceNumber,storage_location:a.storageLocation,status:"active",notes:a.notes,purchased_by:g?.id}]);if(w)throw w;c()}catch(o){console.error("Error adding stock:",o),alert("Error adding stock. Please try again.")}finally{p(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:b?"Add New Ingredient & Stock":"Add Ingredient Stock"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[b?e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"New Ingredient Details"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"text-sm text-dark-brown/60 hover:text-dark-brown",children:"Cancel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Common Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:h.commonName,onChange:d=>k({...h,commonName:d.target.value}),placeholder:"e.g., Ashwagandha Powder",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical/Scientific Name"}),e.jsx("input",{type:"text",value:h.botanicalName,onChange:d=>k({...h,botanicalName:d.target.value}),placeholder:"e.g., Withania somnifera",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:h.type,onChange:d=>k({...h,type:d.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"herb",children:"Herb"}),e.jsx("option",{value:"oil",children:"Oil"}),e.jsx("option",{value:"powder",children:"Powder"}),e.jsx("option",{value:"extract",children:"Extract"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"fragrance",children:"Fragrance"}),e.jsx("option",{value:"active",children:"Active Ingredient"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:h.category,onChange:d=>k({...h,category:d.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"raw_material",children:"Raw Material"}),e.jsx("option",{value:"active_ingredient",children:"Active Ingredient"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"packaging",children:"Packaging"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Default Unit ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:h.defaultUnit,onChange:d=>k({...h,defaultUnit:d.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"kg",children:"kg (Kilograms)"}),e.jsx("option",{value:"g",children:"g (Grams)"}),e.jsx("option",{value:"L",children:"L (Liters)"}),e.jsx("option",{value:"ml",children:"ml (Milliliters)"}),e.jsx("option",{value:"pieces",children:"Pieces"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Typical Shelf Life (months)"}),e.jsx("input",{type:"number",value:h.typicalShelfLifeMonths,onChange:d=>k({...h,typicalShelfLifeMonths:d.target.value}),min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Reorder Level"}),e.jsx("input",{type:"number",value:h.reorderLevel,onChange:d=>k({...h,reorderLevel:d.target.value}),placeholder:"Minimum stock threshold",step:"0.01",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Preferred Vendor"}),e.jsxs("select",{value:h.preferredVendorId,onChange:d=>k({...h,preferredVendorId:d.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("textarea",{value:h.storageConditions,onChange:d=>k({...h,storageConditions:d.target.value}),placeholder:"e.g., Store in cool, dry place away from direct sunlight",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Select Ingredient ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("button",{type:"button",onClick:()=>f(!0),className:"text-sm text-primary font-semibold hover:underline",children:"+ Or add new ingredient"})]}),e.jsxs("select",{value:a.ingredientId,onChange:d=>{N({...a,ingredientId:d.target.value});const x=u.find(o=>o.id===d.target.value);n(x)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select an ingredient"}),u.map(d=>e.jsxs("option",{value:d.id,children:[d.common_name," ",d.botanical_name&&`(${d.botanical_name})`]},d.id))]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Purchase Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purchase Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.purchaseDate,onChange:d=>N({...a,purchaseDate:d.target.value}),max:$(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Quantity Purchased ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:a.quantity,onChange:d=>N({...a,quantity:d.target.value}),placeholder:"Amount",step:"0.01",min:"0",required:!0,className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("div",{className:"px-4 py-3 bg-dark-brown/5 rounded-xl font-semibold text-dark-brown flex items-center",children:t?.default_unit||h.defaultUnit})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.expiryDate,onChange:d=>N({...a,expiryDate:d.target.value}),min:a.purchaseDate,required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Lot/Batch Number"}),e.jsx("input",{type:"text",value:a.lotNumber,onChange:d=>N({...a,lotNumber:d.target.value}),placeholder:"Supplier's lot number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:a.vendorId,onChange:d=>N({...a,vendorId:d.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit"}),e.jsx("input",{type:"number",value:a.costPerUnit,onChange:d=>N({...a,costPerUnit:d.target.value}),placeholder:"â‚¹ per unit",step:"0.01",min:"0",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Invoice Number"}),e.jsx("input",{type:"text",value:a.invoiceNumber,onChange:d=>N({...a,invoiceNumber:d.target.value}),placeholder:"Purchase invoice number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:a.storageLocation,onChange:d=>N({...a,storageLocation:d.target.value}),placeholder:"e.g., Section B, Shelf 5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:d=>N({...a,notes:d.target.value}),placeholder:"Quality observations, storage instructions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:j,disabled:r,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:r?"Adding...":"Add to Inventory"})]})]})})}function An(){const[s,l]=i.useState([]),[c,g]=i.useState([]),[r,p]=i.useState([]),[u,m]=i.useState(""),[b,f]=i.useState("list"),[t,n]=i.useState("all"),[a,N]=i.useState(!1),[h,k]=i.useState({expired:0,expiring15d:0,expiring30d:0,lowStock:0,reorderNeeded:0});i.useEffect(()=>{_(),y()},[]),i.useEffect(()=>{j(),d()},[s,u,t]);const _=async()=>{try{const{data:w,error:P}=await C.from("ingredient_inventory_summary").select("*").order("common_name");if(P)throw P;l(w||[])}catch(w){console.error("Error fetching ingredients:",w)}},y=async()=>{try{const{data:w,error:P}=await C.from("vendors").select("id, name").order("name");if(P)throw P;p(w||[])}catch(w){console.error("Error fetching vendors:",w)}},j=()=>{let w=s;if(t!=="all"&&(w=w.filter(P=>P.inventory_status===t)),u){const P=u.toLowerCase();w=w.filter(T=>T.common_name?.toLowerCase().includes(P)||T.botanical_name?.toLowerCase().includes(P)||T.type?.toLowerCase().includes(P))}g(w)},d=()=>{const w=new Date,P=s.filter(z=>z.earliest_expiry?X(new Date(z.earliest_expiry),w)<0:!1).length,T=s.filter(z=>{if(!z.earliest_expiry)return!1;const W=X(new Date(z.earliest_expiry),w);return W>=0&&W<15}).length,S=s.filter(z=>{if(!z.earliest_expiry)return!1;const W=X(new Date(z.earliest_expiry),w);return W>=15&&W<30}).length,A=s.filter(z=>z.inventory_status==="low_stock").length,U=s.filter(z=>z.total_stock<z.reorder_level&&z.reorder_level>0).length;k({expired:P,expiring15d:T,expiring30d:S,lowStock:A,reorderNeeded:U})},x=w=>{if(!w)return"text-dark-brown/40";const P=X(new Date(w),new Date);return P<0||P<=15?"text-soft-red":P<=30?"text-accent":P<=60?"text-amber-500":"text-sage"},o=w=>{const P={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return P[w]||P.good_stock},v=w=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[w.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Ne,{}),e.jsx(H,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(J,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Ingredient Inventory"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Track stock levels, expiry dates, and reorder alerts"})]}),e.jsxs(pe,{onClick:()=>N(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Stock"]})]})]}),e.jsxs(pe,{onClick:()=>N(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Ingredient Stock"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx("button",{onClick:()=>n("expired"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="expired"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”´"}),e.jsx("span",{className:`text-3xl font-bold ${h.expired>0?"text-soft-red":"text-primary/20"}`,children:h.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})}),e.jsx("button",{onClick:()=>n("expiring_soon"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_soon"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ "}),e.jsx("span",{className:`text-3xl font-bold ${h.expiring15d>0?"text-soft-red":"text-primary/20"}`,children:h.expiring15d})]}),e.jsxs("p",{className:"text-sm font-bold text-primary/70",children:["Expiring ","<","15 days"]})]})}),e.jsx("button",{onClick:()=>n("expiring_30d"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_30d"?"ring-2 ring-amber-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¡"}),e.jsx("span",{className:`text-3xl font-bold ${h.expiring30d>0?"text-amber-500":"text-primary/20"}`,children:h.expiring30d})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring 15-30 days"})]})}),e.jsx("button",{onClick:()=>n("low_stock"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="low_stock"?"ring-2 ring-blue-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”µ"}),e.jsx("span",{className:`text-3xl font-bold ${h.lowStock>0?"text-blue-500":"text-primary/20"}`,children:h.lowStock})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Low Stock"})]})}),e.jsx("button",{onClick:()=>n(h.reorderNeeded>0?"low_stock":"all"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${h.reorderNeeded>0?"ring-2 ring-sage shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¢"}),e.jsx("span",{className:`text-3xl font-bold ${h.reorderNeeded>0?"text-sage":"text-primary/20"}`,children:h.reorderNeeded})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Reorder Needed"})]})})]}),e.jsx(J,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>n("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All (",s.length,")"]}),e.jsx("button",{onClick:()=>n("good_stock"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="good_stock"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:"Good Stock"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(ft,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:u,onChange:w=>m(w.target.value),placeholder:"Search ingredients...",className:"input-float w-full pl-12"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-primary/5 rounded-button p-1",children:[e.jsx("button",{onClick:()=>f("list"),className:`p-2 rounded-button transition-all ${b==="list"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>f("grid"),className:`p-2 rounded-button transition-all ${b==="grid"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(qs,{className:"w-5 h-5"})})]})]})]})}),b==="list"?e.jsxs(J,{className:"overflow-hidden p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Current Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Reorder Level"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Days Left"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:c.map((w,P)=>{const T=o(w.inventory_status),S=w.earliest_expiry?X(new Date(w.earliest_expiry),new Date):null;return e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${w.inventory_status==="expired"?"bg-soft-red/5":w.inventory_status==="expiring_soon"?"bg-accent/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[w.image_url?e.jsx("img",{src:w.image_url,alt:w.common_name,className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:w.common_name}),w.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:w.botanical_name})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${v(w.type)}`,children:w.type})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg text-primary",children:[w.total_stock||0," ",w.default_unit]}),w.active_lots>0&&e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[w.active_lots," active lots"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[w.reorder_level||0," ",w.default_unit]})}),e.jsx("td",{className:"px-4 py-3",children:w.earliest_expiry?e.jsx("p",{className:`font-semibold ${x(w.earliest_expiry)}`,children:$(new Date(w.earliest_expiry),"MMM dd, yyyy")}):e.jsx("p",{className:"text-dark-brown/40",children:"No stock"})}),e.jsx("td",{className:"px-4 py-3",children:S!==null?e.jsx("span",{className:`font-bold ${x(w.earliest_expiry)}`,children:S>=0?`${S}d`:"Expired"}):e.jsx("span",{className:"text-dark-brown/40",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${T.color}`,children:[e.jsx("span",{className:"mr-1",children:T.icon}),T.label]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(xe,{to:`/ingredients/${w.ingredient_id}`,className:"px-4 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:"View Details"})})]},w.ingredient_id)})})]})}),c.length===0&&e.jsxs("div",{className:"text-center py-12 px-6",children:[e.jsx(oe,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No ingredients found"}),e.jsx("p",{className:"text-primary/60 mb-4 text-lg font-medium",children:u?"Try adjusting your search":"Add your first ingredient to start tracking"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(w=>{const P=o(w.inventory_status),T=w.earliest_expiry?X(new Date(w.earliest_expiry),new Date):null;return e.jsx(xe,{to:`/ingredients/${w.ingredient_id}`,className:"block",children:e.jsx(J,{className:"hover:shadow-glow transition-all duration-300 h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[w.image_url?e.jsx("img",{src:w.image_url,alt:w.common_name,className:"w-16 h-16 rounded-lg object-cover"}):e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:w.common_name}),w.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:w.botanical_name})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Stock"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[w.total_stock||0," ",w.default_unit]})]}),w.earliest_expiry&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry"}),e.jsxs("p",{className:`font-semibold ${x(w.earliest_expiry)}`,children:[$(new Date(w.earliest_expiry),"MMM dd, yyyy"),T!==null&&e.jsxs("span",{className:"text-xs ml-2",children:["(",T>=0?`${T}d left`:"Expired",")"]})]})]}),e.jsx("div",{children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${P.color}`,children:[e.jsx("span",{className:"mr-1",children:P.icon}),P.label]})})]})]})})},w.ingredient_id)})})]}),a&&e.jsx(En,{vendors:r,onClose:()=>N(!1),onSuccess:()=>{N(!1),_()}})]})}function In({ingredientId:s,ingredient:l,summary:c}){const[g,r]=i.useState([]);i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:b,error:f}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).eq("status","active").order("expiry_date",{ascending:!0});if(f)throw f;r(b||[])}catch(b){console.error("Error fetching lots:",b)}},u=b=>{const f=X(new Date(b),new Date);return f<0||f<=15?"text-soft-red":f<=30?"text-accent":f<=60?"text-amber-500":"text-sage"},m=l.reorder_level>0?(c?.total_stock||0)/l.reorder_level*100:100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white/80 text-sm mb-2",children:"Total Quantity"}),e.jsx("p",{className:"text-5xl font-bold mb-1",children:c?.total_stock||0}),e.jsx("p",{className:"text-xl text-white/90",children:l.default_unit})]}),l.reorder_level>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Level"}),e.jsx("span",{className:"font-bold",children:m>=100?"Good":m>=50?"Low":"Critical"})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${m>=100?"bg-white":m>=50?"bg-amber-300":"bg-red-300"}`,style:{width:`${Math.min(m,100)}%`}})}),e.jsxs("p",{className:"text-white/70 text-xs mt-2",children:["Reorder level: ",l.reorder_level," ",l.default_unit]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Ingredient Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Type"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:l.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:l.category?.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Default Unit"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:l.default_unit})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Shelf Life"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[l.typical_shelf_life_months," months"]})]}),l.preferred_vendor_id&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Preferred Vendor"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:l.vendors?.name})]})]})]}),l.storage_conditions&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:l.storage_conditions})]})]})]}),c?.earliest_expiry&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Expiry Alert"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["Earliest lot expires on ",$(new Date(c.earliest_expiry),"MMMM dd, yyyy")," ","(",X(new Date(c.earliest_expiry),new Date)," days remaining)"]})]})]})}),g.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock by Lot/Batch"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Purchase Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Storage"})]})}),e.jsx("tbody",{children:g.map((b,f)=>{const t=X(new Date(b.expiry_date),new Date);return e.jsxs("tr",{className:`border-t border-dark-brown/5 ${f%2===0?"bg-white":"bg-cream/20"} ${t<15?"bg-soft-red/5":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown",children:b.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:$(new Date(b.purchase_date),"MMM dd, yyyy")}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:`font-semibold ${u(b.expiry_date)}`,children:$(new Date(b.expiry_date),"MMM dd, yyyy")}),e.jsx("p",{className:`text-xs ${u(b.expiry_date)}`,children:t>=0?`${t}d left`:"Expired"})]}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[b.quantity," ",b.unit]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:b.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:b.storage_location||"-"})]},b.id)})})]})})]})]})}function Fn({ingredientId:s,ingredient:l}){const[c,g]=i.useState([]),[r,p]=i.useState({totalPurchases:0,totalQuantity:0,totalSpent:0,avgCostPerUnit:0});i.useEffect(()=>{u()},[s]);const u=async()=>{try{const{data:b,error:f}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).order("purchase_date",{ascending:!1});if(f)throw f;g(b||[]);const t=b.length,n=b.reduce((h,k)=>h+(k.original_quantity||0),0),a=b.reduce((h,k)=>h+(k.cost_per_unit||0)*(k.original_quantity||0),0),N=a/(n||1);p({totalPurchases:t,totalQuantity:n,totalSpent:a,avgCostPerUnit:N})}catch(b){console.error("Error fetching purchases:",b)}},m=b=>({active:"bg-sage/10 text-sage",used:"bg-dark-brown/10 text-dark-brown",expired:"bg-soft-red/10 text-soft-red"})[b]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Purchases"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:r.totalPurchases})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Quantity"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[r.totalQuantity.toFixed(2)," ",l.default_unit]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",r.totalSpent.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Avg Cost/Unit"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",r.avgCostPerUnit.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Purchase Timeline"}),c.length>0?e.jsx("div",{className:"space-y-4",children:c.map(b=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-primary"}),e.jsx("h4",{className:"font-semibold text-dark-brown",children:$(new Date(b.purchase_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:b.vendors?.name||"Unknown Vendor"}),b.invoice_number&&e.jsxs("span",{className:"ml-2 text-dark-brown/60",children:["â€¢ Invoice: ",b.invoice_number]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${m(b.status)}`,children:b.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Quantity"}),e.jsxs("p",{className:"font-bold text-primary",children:[b.original_quantity," ",b.unit]}),b.status==="active"&&b.quantity<b.original_quantity&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[b.quantity," ",b.unit," remaining"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Cost/Unit"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:b.cost_per_unit?`â‚¹${b.cost_per_unit}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Cost"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:b.cost_per_unit?`â‚¹${(b.cost_per_unit*b.original_quantity).toFixed(2)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"text-sm text-dark-brown",children:$(new Date(b.expiry_date),"MMM dd, yyyy")})]})]}),b.lot_number&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-xs text-dark-brown/60",children:["Lot: ",e.jsx("span",{className:"font-mono text-dark-brown",children:b.lot_number})]})}),b.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:b.notes})})]},b.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No purchase history recorded"})]})]})]})}function Tn({ingredientId:s,ingredient:l}){const[c,g]=i.useState([]),[r,p]=i.useState([]),[u,m]=i.useState(0);i.useEffect(()=>{b(),f()},[s]);const b=async()=>{try{const{data:t,error:n}=await C.from("ingredient_usage").select("*, batches(batch_number), products(name)").eq("ingredient_id",s).order("usage_date",{ascending:!1});if(n)throw n;g(t||[]);const a=t.reduce((N,h)=>N+(h.quantity||0),0);m(a)}catch(t){console.error("Error fetching usage:",t)}},f=async()=>{try{const{data:t,error:n}=await C.from("product_ingredients").select("*, products(id, name, images)").eq("ingredient_name",l.common_name);if(n)throw n;p(t||[])}catch(t){console.error("Error fetching products:",t)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Used (Lifetime)"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[u.toFixed(2)," ",l.default_unit]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Usage Instances"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:c.length})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Used in Products"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:r.length})]})]}),r.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Products Using This Ingredient"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(t=>e.jsx(xe,{to:`/products/${t.products.id}`,className:"p-4 bg-cream/50 rounded-lg hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.products.images&&t.products.images[0]?e.jsx("img",{src:t.products.images[0],alt:t.products.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(Xt,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:t.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[t.quantity," ",t.unit," per batch"]})]})]})},t.id))})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage History"}),c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ce,{className:"w-4 h-4 text-dark-brown/60"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(new Date(t.usage_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 capitalize",children:["Used for: ",t.used_for?.replace("_"," ")]})]}),e.jsxs("span",{className:"font-bold text-primary text-lg",children:[t.quantity," ",l.default_unit]})]}),t.batches&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",e.jsx(xe,{to:`/batches/${t.batch_id}`,className:"font-mono text-primary hover:underline",children:t.batches.batch_number})]})}),t.products&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Product: ",e.jsx("span",{className:"font-semibold text-dark-brown",children:t.products.name})]})}),t.notes&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70 italic",children:t.notes})})]},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No usage recorded yet"})]})]})]})}function Ln({ingredientId:s,ingredient:l}){const[c,g]=i.useState({turnoverRate:0,wasteQuantity:0,wasteCost:0,minPrice:0,maxPrice:0,avgPrice:0,currentPrice:0,totalUsed:0,totalPurchased:0});i.useEffect(()=>{r()},[s]);const r=async()=>{try{const[m,b]=await Promise.all([C.from("ingredient_stock").select("*").eq("ingredient_id",s),C.from("ingredient_usage").select("quantity").eq("ingredient_id",s)]);if(m.error)throw m.error;if(b.error)throw b.error;const f=m.data||[],t=b.data||[],n=f.filter(v=>v.status==="expired"),a=n.reduce((v,w)=>v+(w.quantity||0),0),N=n.reduce((v,w)=>v+(w.cost_per_unit||0)*(w.quantity||0),0),h=f.map(v=>v.cost_per_unit).filter(v=>v>0),k=h.length>0?Math.min(...h):0,_=h.length>0?Math.max(...h):0,y=h.length>0?h.reduce((v,w)=>v+w,0)/h.length:0,j=f.filter(v=>v.cost_per_unit>0).sort((v,w)=>new Date(w.purchase_date).getTime()-new Date(v.purchase_date).getTime()),d=j.length>0?j[0].cost_per_unit:0,x=t.reduce((v,w)=>v+(w.quantity||0),0),o=f.reduce((v,w)=>v+(w.original_quantity||0),0);g({turnoverRate:o>0?x/o*100:0,wasteQuantity:a,wasteCost:N,minPrice:k,maxPrice:_,avgPrice:y,currentPrice:d,totalUsed:x,totalPurchased:o})}catch(m){console.error("Error fetching analytics:",m)}},p=c.totalPurchased>0?c.wasteQuantity/c.totalPurchased*100:0,u=c.avgPrice>0?(c.currentPrice-c.avgPrice)/c.avgPrice*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Turnover Rate"}),e.jsx(se,{className:"w-5 h-5 text-primary"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[c.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Usage efficiency"})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Quantity"}),e.jsx(fe,{className:"w-5 h-5 text-soft-red"})]}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:[c.wasteQuantity.toFixed(2)," ",l.default_unit]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[p.toFixed(1),"% of total purchased"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Cost"}),e.jsx(De,{className:"w-5 h-5 text-accent"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",c.wasteCost.toFixed(0)]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Lost value from expiry"})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Minimum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",c.minPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Maximum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",c.maxPrice.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Average Price"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",c.avgPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Price vs Average"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-2xl font-bold ${u>0?"text-soft-red":"text-sage"}`,children:[u>0?"+":"",u.toFixed(1),"%"]}),u>0?e.jsx(se,{className:"w-5 h-5 text-soft-red"}):e.jsx(we,{className:"w-5 h-5 text-sage"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["â‚¹",c.currentPrice.toFixed(2)," per unit"]})]})]})]})]}),p>10&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Waste Reduction Recommendations"}),e.jsxs("ul",{className:"space-y-2 text-sm text-dark-brown/70",children:[e.jsx("li",{children:"â€¢ Consider reducing purchase quantities to match usage rate"}),e.jsx("li",{children:"â€¢ Implement FIFO (First In, First Out) more strictly"}),e.jsx("li",{children:"â€¢ Review storage conditions to extend shelf life"}),e.jsxs("li",{children:["â€¢ Adjust reorder level to: ",(c.totalUsed/6).toFixed(2)," ",l.default_unit," (based on 6-month usage)"]})]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Purchased"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:c.totalPurchased.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:l.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Used"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:c.totalUsed.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:l.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Utilization Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:[c.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:"Used vs Purchased"})]})]})]})]})}const it=[{id:"coa",label:"Quality Certificates (COA)",icon:Qe},{id:"organic_cert",label:"Organic Certifications",icon:Qe},{id:"test_report",label:"Test Reports",icon:Xt},{id:"msds",label:"MSDS (Safety Data Sheets)",icon:he},{id:"specification",label:"Vendor Specifications",icon:ae},{id:"photo",label:"Ingredient Photos",icon:Ts}];function $n({ingredientId:s}){const[l,c]=i.useState([]),[g,r]=i.useState("all");i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:t,error:n}=await C.from("ingredient_documents").select("*").eq("ingredient_id",s).order("uploaded_at",{ascending:!1});if(n)throw n;c(t||[])}catch(t){console.error("Error fetching documents:",t)}},u=g==="all"?l:l.filter(t=>t.category===g),m=t=>{const n=it.find(a=>a.id===t);return n?n.icon:ae},b=t=>t?X(new Date(t),new Date)<=30:!1,f=t=>t?X(new Date(t),new Date)<0:!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>r("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",l.length,")"]}),it.map(t=>{const n=l.filter(a=>a.category===t.id).length;return e.jsxs("button",{onClick:()=>r(t.id),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g===t.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[t.label.split(" ")[0]," (",n,")"]},t.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(Q,{className:"w-4 h-4"}),"Upload Document"]})]}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:u.map(t=>{const n=m(t.category),a=it.find(N=>N.id===t.category);return e.jsx("div",{className:`bg-white border-2 rounded-xl p-4 hover:shadow-soft transition-all ${f(t.expiry_date)?"border-soft-red/20 bg-soft-red/5":b(t.expiry_date)?"border-accent/20 bg-accent/5":"border-dark-brown/5"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(n,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:t.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:a?.label})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("span",{children:["Uploaded: ",$(new Date(t.uploaded_at),"MMM dd, yyyy")]}),t.expiry_date&&e.jsx("span",{className:`font-semibold ${f(t.expiry_date)?"text-soft-red":b(t.expiry_date)?"text-accent":"text-dark-brown"}`,children:f(t.expiry_date)?e.jsxs(e.Fragment,{children:["Expired: ",$(new Date(t.expiry_date),"MMM dd, yyyy")]}):e.jsxs(e.Fragment,{children:["Expires: ",$(new Date(t.expiry_date),"MMM dd, yyyy")]})})]}),(f(t.expiry_date)||b(t.expiry_date))&&e.jsxs("div",{className:`mt-2 flex items-center gap-2 text-sm font-semibold ${f(t.expiry_date)?"text-soft-red":"text-accent"}`,children:[e.jsx(he,{className:"w-4 h-4"}),f(t.expiry_date)?e.jsx("span",{children:"Certificate expired - renewal required"}):e.jsxs("span",{children:["Expiring in ",X(new Date(t.expiry_date),new Date)," days"]})]})]})]})},t.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:g==="all"?"Upload quality certificates, test reports, and other documents":`No ${it.find(t=>t.id===g)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),l.some(t=>f(t.expiry_date)||b(t.expiry_date))&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Certificate Expiry Alerts"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-3",children:"Some certificates are expired or expiring soon. Ensure you have updated certifications."}),e.jsx("ul",{className:"space-y-1 text-sm text-dark-brown/70",children:l.filter(t=>f(t.expiry_date)||b(t.expiry_date)).map(t=>e.jsxs("li",{children:["â€¢ ",t.file_name," - ",f(t.expiry_date)?"Expired":"Expiring soon"]},t.id))})]})]})}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:it.map(t=>{const n=t.icon,a=l.filter(N=>N.category===t.id).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(n,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:t.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[a," document",a!==1?"s":""]})]})]},t.id)})})]})]})}const qn=[{id:"overview",label:"Overview & Stock",icon:xt},{id:"purchase",label:"Purchase History",icon:oe},{id:"usage",label:"Usage in Products",icon:Xt},{id:"analytics",label:"Analytics",icon:se},{id:"documents",label:"Documents",icon:ae}];function Rn(){const{id:s}=Ye(),l=me(),[c,g]=i.useState(null),[r,p]=i.useState(null),[u,m]=i.useState("overview"),[b,f]=i.useState(!0);i.useEffect(()=>{s&&(t(),n())},[s]);const t=async()=>{try{const{data:y,error:j}=await C.from("ingredients").select("*, vendors(name)").eq("id",s).maybeSingle();if(j)throw j;g(y)}catch(y){console.error("Error fetching ingredient:",y)}finally{f(!1)}},n=async()=>{try{const{data:y,error:j}=await C.from("ingredient_inventory_summary").select("*").eq("ingredient_id",s).maybeSingle();if(j)throw j;p(y)}catch(y){console.error("Error fetching summary:",y)}},a=async()=>{if(confirm("Are you sure you want to delete this ingredient? This action cannot be undone."))try{const{error:y}=await C.from("ingredients").delete().eq("id",s);if(y)throw y;l("/ingredients")}catch(y){console.error("Error deleting ingredient:",y),alert("Error deleting ingredient")}},N=()=>{if(!r)return null;const y={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return y[r.inventory_status]||y.good_stock},h=y=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[y?.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";if(b)return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading ingredient details..."})]})})]});if(!c)return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Ingredient not found"}),e.jsx("button",{onClick:()=>l("/ingredients"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Ingredients"})]})})]});const k=N(),_=r?.earliest_expiry?X(new Date(r.earliest_expiry),new Date):null;return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/ingredients"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Back to Ingredients"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[c.image_url?e.jsx("img",{src:c.image_url,alt:c.common_name,className:"w-20 h-20 rounded-lg object-cover"}):e.jsx("div",{className:"w-20 h-20 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-10 h-10 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:c.common_name}),c.botanical_name&&e.jsx("p",{className:"text-lg italic text-dark-brown/70 mb-2",children:c.botanical_name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${h(c.type)}`,children:c.type}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-dark-brown/5 text-dark-brown capitalize",children:c.category?.replace("_"," ")}),k&&e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${k.color}`,children:[e.jsx("span",{className:"mr-1",children:k.icon}),k.label]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Stock"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(de,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Stock"}),e.jsxs("p",{className:"font-bold text-2xl text-sage",children:[r?.total_stock||0," ",c.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Reorder Level"}),e.jsxs("p",{className:"font-semibold text-dark-brown",children:[c.reorder_level||0," ",c.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Active Lots"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:r?.active_lots||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold ${_===null?"text-dark-brown/40":_<0||_<=15?"text-soft-red":_<=30?"text-accent":"text-sage"}`,children:_!==null?_>=0?`${_} days`:"Expired":"No stock"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:qn.map(y=>{const j=y.icon;return e.jsxs("button",{onClick:()=>m(y.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${u===y.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(j,{className:"w-5 h-5"}),y.label]},y.id)})})}),e.jsxs("div",{className:"p-6",children:[u==="overview"&&e.jsx(In,{ingredientId:s,ingredient:c,summary:r,onUpdate:()=>{t(),n()}}),u==="purchase"&&e.jsx(Fn,{ingredientId:s,ingredient:c}),u==="usage"&&e.jsx(Tn,{ingredientId:s,ingredient:c}),u==="analytics"&&e.jsx(Ln,{ingredientId:s,ingredient:c}),u==="documents"&&e.jsx($n,{ingredientId:s})]})]})]})]})}const Un=[{value:"fssai",label:"FSSAI License"},{value:"ayush",label:"Ayush License"},{value:"gmp",label:"GMP Certification"},{value:"trade",label:"Trade License"},{value:"gst",label:"GST Registration"},{value:"organic",label:"Organic Certification"},{value:"pollution",label:"Pollution Control"},{value:"fire",label:"Fire Safety Certificate"},{value:"drug",label:"Drug License"},{value:"other",label:"Other"}];function Bn({onClose:s,onSuccess:l}){const{user:c}=G(),[g,r]=i.useState(!1),[p,u]=i.useState(!1),[m,b]=i.useState({licenseType:"fssai",licenseNumber:"",issuedTo:"",issuingAuthority:"",issueDate:"",expiryDate:"",renewalReminderDays:"30",scope:"",status:"active",notes:"",reminderEmail:!0,reminderPush:!0}),f=async t=>{if(t.preventDefault(),!m.licenseNumber||!m.issuedTo||!m.issuingAuthority||!m.issueDate){alert("Please fill in all required fields");return}if(!p&&!m.expiryDate){alert('Please provide an expiry date or check "No Expiry"');return}r(!0);try{const{error:n}=await C.from("licenses").insert([{license_type:m.licenseType,license_number:m.licenseNumber,issued_to:m.issuedTo,issuing_authority:m.issuingAuthority,issue_date:m.issueDate,expiry_date:p?null:m.expiryDate,renewal_reminder_days:parseInt(m.renewalReminderDays),scope:m.scope,status:m.status,notes:m.notes,reminder_email:m.reminderEmail,reminder_push:m.reminderPush,created_by:c?.id}]);if(n)throw n;l()}catch(n){console.error("Error adding license:",n),alert("Error adding license. Please try again.")}finally{r(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add License/Certificate"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:f,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:m.licenseType,onChange:t=>b({...m,licenseType:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Un.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License/Certificate Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:m.licenseNumber,onChange:t=>b({...m,licenseNumber:t.target.value}),placeholder:"e.g., 12345678901234",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issued To ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:m.issuedTo,onChange:t=>b({...m,issuedTo:t.target.value}),placeholder:"Business name",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issuing Authority ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:m.issuingAuthority,onChange:t=>b({...m,issuingAuthority:t.target.value}),placeholder:"e.g., FSSAI, State Ayush Department",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issue Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:m.issueDate,onChange:t=>b({...m,issueDate:t.target.value}),max:$(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Expiry Date ",!p&&e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:t=>{u(t.target.checked),t.target.checked&&b({...m,expiryDate:""})},className:"w-4 h-4 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-xs text-dark-brown/70",children:"No Expiry"})]})]}),e.jsx("input",{type:"date",value:m.expiryDate,onChange:t=>b({...m,expiryDate:t.target.value}),min:m.issueDate,required:!p,disabled:p,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none disabled:bg-dark-brown/5 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Renewal Reminder (days before expiry)"}),e.jsx("input",{type:"number",value:m.renewalReminderDays,onChange:t=>b({...m,renewalReminderDays:t.target.value}),min:"1",max:"365",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Status ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:m.status,onChange:t=>b({...m,status:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending Application"}),e.jsx("option",{value:"renewal_in_process",children:"Renewal In Process"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Scope/Coverage"}),e.jsx("textarea",{value:m.scope,onChange:t=>b({...m,scope:t.target.value}),placeholder:"What this license covers (e.g., Manufacturing of Ayurvedic products)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:m.notes,onChange:t=>b({...m,notes:t.target.value}),placeholder:"Important information, conditions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2 bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.reminderEmail,onChange:t=>b({...m,reminderEmail:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email reminder"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.reminderPush,onChange:t=>b({...m,reminderPush:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push notification"})]})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:g,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:g?"Adding...":"Add License"})]})]})})}const ks={fssai:{label:"FSSAI License",icon:"ðŸ´",color:"from-blue-500 to-blue-600"},ayush:{label:"Ayush License",icon:"ðŸŒ¿",color:"from-sage to-primary"},gmp:{label:"GMP Certification",icon:"âœ“",color:"from-primary to-accent"},trade:{label:"Trade License",icon:"ðŸª",color:"from-amber-500 to-amber-600"},gst:{label:"GST Registration",icon:"ðŸ’¼",color:"from-purple-500 to-purple-600"},organic:{label:"Organic Certification",icon:"ðŸŒ±",color:"from-green-500 to-green-600"},pollution:{label:"Pollution Control",icon:"ðŸ­",color:"from-teal-500 to-teal-600"},fire:{label:"Fire Safety",icon:"ðŸ”¥",color:"from-red-500 to-red-600"},drug:{label:"Drug License",icon:"ðŸ’Š",color:"from-pink-500 to-pink-600"},other:{label:"Other License",icon:"ðŸ“„",color:"from-dark-brown to-primary"}};function zn(){const[s,l]=i.useState([]),[c,g]=i.useState(!1),[r,p]=i.useState({total:0,active:0,expiringSoon:0,expired:0,complianceScore:100});i.useEffect(()=>{u()},[]),i.useEffect(()=>{m()},[s]);const u=async()=>{try{const{data:a,error:N}=await C.from("license_summary").select("*").order("expiry_date",{ascending:!0,nullsFirst:!1});if(N)throw N;l(a||[])}catch(a){console.error("Error fetching licenses:",a)}},m=()=>{const a=s.length,N=s.filter(y=>y.expiry_status==="active"||y.expiry_status==="no_expiry").length,h=s.filter(y=>y.expiry_status==="expiring_soon"||y.expiry_status==="renewal_due"||y.expiry_status==="critical").length,k=s.filter(y=>y.expiry_status==="expired").length,_=a>0?Math.round((N+h)/a*100):100;p({total:a,active:N,expiringSoon:h,expired:k,complianceScore:_})},b=(a,N)=>{const h={active:{label:"Active",color:"bg-sage/10 text-sage",icon:Y},renewal_due:{label:"Renewal Due",color:"bg-amber-500/10 text-amber-500",icon:ie},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:he},critical:{label:"Critical",color:"bg-soft-red/10 text-soft-red",icon:he},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:he},no_expiry:{label:"No Expiry",color:"bg-blue-500/10 text-blue-500",icon:Y}};return h[a]||h.active},f=()=>r.complianceScore===100?"text-sage":r.complianceScore>=80?"text-amber-500":"text-soft-red",t=()=>r.complianceScore===100?{label:"All Compliant",icon:"ðŸŸ¢"}:r.complianceScore>=80?{label:"Needs Attention",icon:"ðŸŸ¡"}:{label:"Critical Issues",icon:"ðŸ”´"},n=a=>ks[a]||ks.other;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Ne,{}),e.jsx(H,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(J,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Compliance & Certifications"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 md:gap-4",children:[e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Manage licenses and certifications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-primary/60 font-medium",children:"Status:"}),e.jsxs("span",{className:`font-bold text-lg ${f()}`,children:[t().icon," ",t().label," (",r.complianceScore,"%)"]})]})]})]}),e.jsxs(pe,{onClick:()=>g(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add License"]})]})]}),e.jsxs(pe,{onClick:()=>g(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add License/Certificate"]}),r.expiringSoon>0&&e.jsx(J,{className:"bg-accent/10 border-2 border-accent/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-primary",children:[r.expiringSoon," license",r.expiringSoon!==1?"s":""," expiring in next 90 days - Review required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Initiate renewal process to maintain compliance"})]})]})}),r.expired>0&&e.jsx(J,{className:"bg-soft-red/10 border-2 border-soft-red/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-soft-red flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-soft-red",children:[r.expired," license",r.expired!==1?"s have":" has"," expired - Immediate action required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Operating without valid licenses may result in penalties and business disruption"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(pt,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:r.total})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Licenses"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(Y,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:r.active})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active & Valid"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(ie,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-3xl font-bold text-accent",children:r.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Renewal Due Soon"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-soft-red/20 rounded-button",children:e.jsx(he,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:"text-3xl font-bold text-soft-red",children:r.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})]}),s.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(a=>{const N=n(a.license_type),h=b(a.expiry_status,a.days_until_expiry),k=h.icon,_=a.total_checklist_items>0?Math.round(a.completed_checklist_items/a.total_checklist_items*100):100;return e.jsx(xe,{to:`/compliance/${a.id}`,className:"block",children:e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 overflow-hidden p-0",children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${N.color}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-4xl",children:N.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:N.label}),e.jsx("p",{className:"text-xs text-dark-brown/60 font-mono",children:a.license_number})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Issued by:"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:a.issuing_authority})]}),a.expiry_date&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Expiry:"}),e.jsx("span",{className:`text-sm font-semibold ${a.expiry_status==="expired"||a.expiry_status==="critical"?"text-soft-red":a.expiry_status==="expiring_soon"?"text-accent":a.expiry_status==="renewal_due"?"text-amber-500":"text-sage"}`,children:$(new Date(a.expiry_date),"MMM dd, yyyy")})]}),a.days_until_expiry!==null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Days remaining:"}),e.jsx("span",{className:`text-lg font-bold ${a.days_until_expiry<0||a.days_until_expiry<=7?"text-soft-red":a.days_until_expiry<=30?"text-accent":a.days_until_expiry<=90?"text-amber-500":"text-sage"}`,children:a.days_until_expiry>=0?a.days_until_expiry:"Expired"})]})]}),a.total_checklist_items>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Compliance:"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[_,"%"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${_===100?"bg-sage":_>=80?"bg-amber-500":"bg-soft-red"}`,style:{width:`${_}%`}})})]})]}),e.jsx("div",{className:"pt-3 border-t border-dark-brown/10",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${h.color}`,children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-bold",children:h.label})]})})]})]})},a.id)})}):e.jsxs(J,{className:"p-16 text-center",children:[e.jsx(ae,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No licenses recorded yet"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:"Add your business licenses and certifications to track compliance"}),e.jsx(pe,{onClick:()=>g(!0),variant:"primary",size:"lg",children:"Add First License"})]})]}),c&&e.jsx(Bn,{onClose:()=>g(!1),onSuccess:()=>{g(!1),u()}})]})}function On({license:s}){const l=s.expiry_date?X(new Date(s.expiry_date),new Date):null,c=s.expiry_date?new Date(new Date(s.expiry_date).getTime()-s.renewal_reminder_days*24*60*60*1e3):null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"License Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issued To"}),e.jsx("p",{className:"font-semibold text-lg",children:s.issued_to})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"License Number"}),e.jsx("p",{className:"font-semibold text-lg font-mono",children:s.license_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold",children:s.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold",children:$(new Date(s.issue_date),"MMMM dd, yyyy")})]})]})]}),s.expiry_date&&e.jsx("div",{className:`rounded-xl p-6 ${l&&l<0?"bg-soft-red/10 border-2 border-soft-red/20":l&&l<=30?"bg-accent/10 border-2 border-accent/20":l&&l<=90?"bg-amber-500/10 border-2 border-amber-500/20":"bg-sage/10 border-2 border-sage/20"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${l&&l<0?"bg-soft-red/20":l&&l<=30?"bg-accent/20":l&&l<=90?"bg-amber-500/20":"bg-sage/20"}`,children:e.jsx(Ce,{className:`w-8 h-8 ${l&&l<0?"text-soft-red":l&&l<=30?"text-accent":l&&l<=90?"text-amber-500":"text-sage"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:l&&l<0?"License Expired":l&&l<=7?"License Expiring This Week":l&&l<=30?"License Expiring This Month":"License Renewal Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Expiry Date:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(new Date(s.expiry_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Days Until Expiry:"}),e.jsx("span",{className:`font-bold text-2xl ${l&&l<0?"text-soft-red":l&&l<=30?"text-accent":l&&l<=90?"text-amber-500":"text-sage"}`,children:l&&l>=0?l:"Expired"})]}),c&&l&&l>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Renewal Due By:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(c,"MMMM dd, yyyy")})]})]})]})]})}),s.scope&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Scope & Coverage"}),e.jsx("p",{className:"text-dark-brown/70",children:s.scope})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-4",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email Reminders"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_email?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_email?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push Notifications"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_push?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_push?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Reminder Period"})]}),e.jsxs("span",{className:"font-semibold text-dark-brown",children:[s.renewal_reminder_days," days before expiry"]})]})]})]}),s.notes&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("p",{className:"text-dark-brown/70 whitespace-pre-wrap",children:s.notes})]})]})}),s.last_inspection_date&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Inspection Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Last Inspection:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(new Date(s.last_inspection_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Inspections:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:s.inspection_count})]})]})]})]})}const Gt=[{value:"original",label:"Original License/Certificate"},{value:"renewal",label:"Renewal Documents"},{value:"application",label:"Application Forms"},{value:"receipt",label:"Payment Receipts"},{value:"correspondence",label:"Correspondence"},{value:"inspection",label:"Inspection Reports"},{value:"compliance",label:"Compliance Certificates"}];function Vn({licenseId:s}){const[l,c]=i.useState([]),[g,r]=i.useState("all");i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:f,error:t}=await C.from("license_documents").select("*").eq("license_id",s).order("uploaded_at",{ascending:!1});if(t)throw t;c(f||[])}catch(f){console.error("Error fetching documents:",f)}},u=g==="all"?l:l.filter(f=>f.category===g),m=f=>{const t=Gt.find(n=>n.value===f);return t?t.label:f},b=f=>e.jsx(ae,{className:"w-6 h-6 text-primary"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>r("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All (",l.length,")"]}),Gt.map(f=>{const t=l.filter(n=>n.category===f.value).length;return t===0?null:e.jsxs("button",{onClick:()=>r(f.value),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g===f.value?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[f.label.split(" ")[0]," (",t,")"]},f.value)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(Q,{className:"w-4 h-4"}),"Upload Document"]})]}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:u.map(f=>e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:b(f.category)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:f.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:m(f.category)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:e.jsxs("span",{children:["Uploaded: ",$(new Date(f.uploaded_at),"MMM dd, yyyy")]})})]})]})},f.id))}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:g==="all"?"Upload license documents, receipts, and correspondence":`No ${m(g).toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Gt.map(f=>{const t=l.filter(n=>n.category===f.value).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(ae,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:f.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[t," document",t!==1?"s":""]})]})]},f.value)})})]})]})}const Hn={fssai:["Display license at prominent location","Maintain hygiene standards","Source ingredients from licensed suppliers","Label products correctly (FSSAI logo, license number)","Maintain manufacturing records","Annual returns filed"],ayush:["Follow GMP guidelines","Use only approved ingredients","Maintain batch records","Quality control testing","Proper labeling (Ayush logo)"],gmp:["Maintain clean facility","Follow SOP (Standard Operating Procedures)","Staff training records","Equipment calibration","Documented processes"]};function Wn({licenseId:s,license:l,onUpdate:c}){const{user:g}=G(),[r,p]=i.useState([]),[u,m]=i.useState(!1),[b,f]=i.useState("");i.useEffect(()=>{t()},[s]);const t=async()=>{try{const{data:y,error:j}=await C.from("compliance_checklist").select("*").eq("license_id",s).order("created_at",{ascending:!0});if(j)throw j;if(!y||y.length===0){const d=Hn[l.license_type]||[];d.length>0&&await n(d)}else p(y)}catch(y){console.error("Error fetching checklist:",y)}},n=async y=>{try{const j=y.map(o=>({license_id:s,checklist_item:o,completed:!1})),{data:d,error:x}=await C.from("compliance_checklist").insert(j).select();if(x)throw x;p(d||[])}catch(j){console.error("Error initializing checklist:",j)}},a=async(y,j)=>{try{const{error:d}=await C.from("compliance_checklist").update({completed:!j,last_verified_date:j?null:new Date().toISOString().split("T")[0],verified_by:j?null:g?.id}).eq("id",y);if(d)throw d;await t(),c()}catch(d){console.error("Error updating checklist:",d)}},N=async()=>{if(b.trim())try{const{error:y}=await C.from("compliance_checklist").insert([{license_id:s,checklist_item:b,completed:!1}]);if(y)throw y;f(""),m(!1),await t(),c()}catch(y){console.error("Error adding checklist item:",y)}},h=r.filter(y=>y.completed).length,k=r.length,_=k>0?Math.round(h/k*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Compliance Score"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-5xl font-bold mb-2",children:[_,"%"]}),e.jsxs("p",{className:"text-white/80",children:[h," of ",k," items completed"]})]}),e.jsxs("div",{className:"w-32 h-32 relative",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"rgba(255,255,255,0.2)",strokeWidth:"12",fill:"none"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"white",strokeWidth:"12",fill:"none",strokeDasharray:`${_/100*351.86} 351.86`,strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(Y,{className:"w-12 h-12 text-white"})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Compliance Requirements"}),e.jsxs("button",{onClick:()=>m(!u),className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-lg font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Item"]})]}),u&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("input",{type:"text",value:b,onChange:y=>f(y.target.value),placeholder:"Enter new compliance requirement...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none mb-3",onKeyDown:y=>{y.key==="Enter"&&N()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 bg-primary text-white rounded-lg font-semibold hover:bg-primary/90 transition-colors",children:"Add"}),e.jsx("button",{onClick:()=>{m(!1),f("")},className:"px-4 py-2 bg-dark-brown/10 text-dark-brown rounded-lg font-semibold hover:bg-dark-brown/20 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-3",children:r.map(y=>e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${y.completed?"bg-sage/5 border-sage/20":"bg-white border-dark-brown/10"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>a(y.id,y.completed),className:"flex-shrink-0 mt-1",children:y.completed?e.jsx(Y,{className:"w-6 h-6 text-sage"}):e.jsx(Sa,{className:"w-6 h-6 text-dark-brown/30 hover:text-primary transition-colors"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold ${y.completed?"text-sage line-through":"text-dark-brown"}`,children:y.checklist_item}),y.completed&&y.last_verified_date&&e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-1",children:["Verified on ",$(new Date(y.last_verified_date),"MMM dd, yyyy")]}),y.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2 italic",children:y.notes}),y.proof_url&&e.jsxs("button",{className:"flex items-center gap-2 mt-2 text-sm text-primary hover:underline",children:[e.jsx(Be,{className:"w-4 h-4"}),"View proof"]})]})]})},y.id))}),r.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Y,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No compliance requirements added"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add compliance requirements specific to this license"}),e.jsx("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add First Requirement"})]}),_<100&&r.length>0&&e.jsxs("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Pending Items"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[k-h," compliance requirement",k-h!==1?"s":""," still need",k-h===1?"s":""," to be completed to achieve 100% compliance."]})]}),_===100&&r.length>0&&e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-8 h-8 text-sage"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sage text-lg",children:"100% Compliant"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"All compliance requirements have been met"})]})]})})]})}function Qn({licenseId:s}){const[l,c]=i.useState([]),[g,r]=i.useState({totalRenewals:0,totalCost:0,avgCost:0,lastRenewalCost:0});i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:u,error:m}=await C.from("license_renewals").select("*").eq("license_id",s).order("renewal_date",{ascending:!1});if(m)throw m;if(c(u||[]),u&&u.length>0){const b=u.length,f=u.reduce((a,N)=>a+(N.cost||0),0),t=f/b,n=u[0].cost||0;r({totalRenewals:b,totalCost:f,avgCost:t,lastRenewalCost:n})}}catch(u){console.error("Error fetching renewals:",u)}};return e.jsxs("div",{className:"space-y-6",children:[l.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Renewals"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:g.totalRenewals})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:["â‚¹",g.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Average Cost"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",g.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Last Renewal"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",g.lastRenewalCost.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Renewal Timeline"}),l.length>0?e.jsx("div",{className:"space-y-4",children:l.map((u,m)=>e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:"absolute -left-2 top-0 w-4 h-4 rounded-full bg-primary border-4 border-white"}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ie,{className:"w-5 h-5 text-primary"}),e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Renewal ",l.length-m]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:$(new Date(u.renewal_date),"MMMM dd, yyyy")})]}),u.cost&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",u.cost]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Previous Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:$(new Date(u.previous_expiry),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"New Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-sage",children:$(new Date(u.new_expiry),"MMM dd, yyyy")})]})]}),u.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:u.notes})}),u.certificate_url&&e.jsxs("button",{className:"mt-3 flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(ae,{className:"w-4 h-4"}),"View renewed certificate"]})]})]},u.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h4",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No renewal history"}),e.jsx("p",{className:"text-dark-brown/40",children:"Renewal records will appear here when the license is renewed"})]})]}),l.length>1&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Total Spent on Renewals"})]}),e.jsxs("span",{className:"font-bold text-lg text-primary",children:["â‚¹",g.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-sage"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Average Renewal Cost"})]}),e.jsxs("span",{className:"font-bold text-lg text-sage",children:["â‚¹",g.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Last Renewal Cost"})]}),e.jsxs("span",{className:`font-bold text-lg ${g.lastRenewalCost>g.avgCost?"text-soft-red":"text-sage"}`,children:["â‚¹",g.lastRenewalCost.toFixed(0),g.lastRenewalCost>g.avgCost&&e.jsxs("span",{className:"text-xs ml-2",children:["(+",((g.lastRenewalCost-g.avgCost)/g.avgCost*100).toFixed(0),"%)"]})]})]})]})]})]})}function Gn({licenseId:s}){const[l,c]=i.useState([]),[g,r]=i.useState(!0);i.useEffect(()=>{p()},[s]);const p=async()=>{try{const u=[],[m,b,f,t,n]=await Promise.all([C.from("licenses").select("created_at, updated_at").eq("id",s).maybeSingle(),C.from("license_documents").select("file_name, uploaded_at, category").eq("license_id",s),C.from("license_renewals").select("renewal_date, new_expiry").eq("license_id",s),C.from("compliance_checklist").select("checklist_item, completed, last_verified_date").eq("license_id",s),C.from("inspections").select("inspection_date, compliance_status, authority").eq("license_id",s)]);m.data&&(u.push({type:"license_added",timestamp:m.data.created_at,description:"License added to system",icon:ae,color:"text-primary"}),m.data.updated_at!==m.data.created_at&&u.push({type:"license_updated",timestamp:m.data.updated_at,description:"License details updated",icon:ye,color:"text-blue-500"})),b.data&&b.data.forEach(a=>{u.push({type:"document_uploaded",timestamp:a.uploaded_at,description:`Document uploaded: ${a.file_name}`,details:`Category: ${a.category}`,icon:Be,color:"text-sage"})}),f.data&&f.data.forEach(a=>{u.push({type:"renewal_processed",timestamp:a.renewal_date,description:"License renewed",details:`New expiry: ${$(new Date(a.new_expiry),"MMM dd, yyyy")}`,icon:ie,color:"text-accent"})}),t.data&&t.data.filter(a=>a.completed&&a.last_verified_date).forEach(a=>{u.push({type:"compliance_verified",timestamp:a.last_verified_date,description:"Compliance item verified",details:a.checklist_item,icon:Y,color:"text-sage"})}),n.data&&n.data.forEach(a=>{u.push({type:"inspection",timestamp:a.inspection_date,description:`Inspection by ${a.authority}`,details:`Result: ${a.compliance_status}`,icon:Re,color:a.compliance_status==="pass"?"text-sage":"text-accent"})}),u.sort((a,N)=>new Date(N.timestamp).getTime()-new Date(a.timestamp).getTime()),c(u)}catch(u){console.error("Error fetching audit log:",u)}finally{r(!1)}};return g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading audit log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-2",children:"Activity History"}),e.jsx("p",{className:"text-dark-brown/70",children:"Complete audit trail of all activities related to this license"})]}),l.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:e.jsx("div",{className:"space-y-4",children:l.map((u,m)=>{const b=u.icon;return e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:`absolute -left-3 top-0 w-6 h-6 rounded-full bg-white border-2 border-dark-brown/10 flex items-center justify-center ${u.color}`,children:e.jsx(b,{className:"w-3 h-3"})}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:u.description}),e.jsx("span",{className:"text-sm text-dark-brown/60",children:$(new Date(u.timestamp),"MMM dd, yyyy")})]}),u.details&&e.jsx("p",{className:"text-sm text-dark-brown/70",children:u.details}),e.jsx("p",{className:"text-xs text-dark-brown/50 mt-2",children:$(new Date(u.timestamp),"h:mm a")})]})]},m)})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity history will appear here as actions are performed"})]}),e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-sage flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Full Transparency"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"This audit log provides a complete history of all activities related to this license. All actions are timestamped and recorded for compliance and regulatory purposes."})]})]})})]})}const Yn=[{id:"details",label:"Details",icon:ae},{id:"documents",label:"Documents",icon:Pa},{id:"compliance",label:"Compliance Checklist",icon:es},{id:"renewal",label:"Renewal History",icon:ie},{id:"audit",label:"Audit Log",icon:ae}],_s={fssai:{label:"FSSAI License",icon:"ðŸ´"},ayush:{label:"Ayush License",icon:"ðŸŒ¿"},gmp:{label:"GMP Certification",icon:"âœ“"},trade:{label:"Trade License",icon:"ðŸª"},gst:{label:"GST Registration",icon:"ðŸ’¼"},organic:{label:"Organic Certification",icon:"ðŸŒ±"},pollution:{label:"Pollution Control",icon:"ðŸ­"},fire:{label:"Fire Safety",icon:"ðŸ”¥"},drug:{label:"Drug License",icon:"ðŸ’Š"},other:{label:"Other License",icon:"ðŸ“„"}};function Kn(){const{id:s}=Ye(),l=me(),[c,g]=i.useState(null),[r,p]=i.useState("details"),[u,m]=i.useState(!0);i.useEffect(()=>{s&&b()},[s]);const b=async()=>{try{const{data:k,error:_}=await C.from("license_summary").select("*").eq("id",s).maybeSingle();if(_)throw _;g(k)}catch(k){console.error("Error fetching license:",k)}finally{m(!1)}},f=async()=>{if(confirm("Are you sure you want to delete this license? This action cannot be undone."))try{const{error:k}=await C.from("licenses").delete().eq("id",s);if(k)throw k;l("/compliance")}catch(k){console.error("Error deleting license:",k),alert("Error deleting license")}},t=()=>{if(!c)return null;const k={active:{label:"Active",color:"bg-sage/10 text-sage"},pending:{label:"Pending Application",color:"bg-amber-500/10 text-amber-500"},renewal_in_process:{label:"Renewal In Process",color:"bg-blue-500/10 text-blue-500"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red"}};return k[c.status]||k.active},n=()=>{if(!c||!c.expiry_date)return"text-dark-brown";const k=X(new Date(c.expiry_date),new Date);return k<0||k<=7?"text-soft-red":k<=30?"text-accent":k<=90?"text-amber-500":"text-sage"};if(u)return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading license details..."})]})})]});if(!c)return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"License not found"}),e.jsx("button",{onClick:()=>l("/compliance"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Compliance"})]})})]});const a=_s[c.license_type]||_s.other,N=t(),h=c.expiry_date?X(new Date(c.expiry_date),new Date):null;return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/compliance"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Back to Compliance"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsx("div",{className:"text-5xl",children:a.icon}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:a.label}),e.jsx("p",{className:"text-lg font-mono text-dark-brown/70 mb-2",children:c.license_number}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:N&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${N.color}`,children:N.label})})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(de,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:c.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(c.issue_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:`font-semibold ${n()}`,children:c.expiry_date?$(new Date(c.expiry_date),"MMM dd, yyyy"):"No Expiry"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold text-xl ${n()}`,children:h!==null?h>=0?`${h} days`:"Expired":"N/A"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:Yn.map(k=>{const _=k.icon;return e.jsxs("button",{onClick:()=>p(k.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${r===k.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(_,{className:"w-5 h-5"}),k.label]},k.id)})})}),e.jsxs("div",{className:"p-6",children:[r==="details"&&e.jsx(On,{licenseId:s,license:c,onUpdate:b}),r==="documents"&&e.jsx(Vn,{licenseId:s}),r==="compliance"&&e.jsx(Wn,{licenseId:s,license:c,onUpdate:b}),r==="renewal"&&e.jsx(Qn,{licenseId:s,license:c}),r==="audit"&&e.jsx(Gn,{licenseId:s})]})]})]})]})}const Zn=["ðŸ˜Š","ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥","âœ…","ðŸ‘","ðŸ’¡","ðŸŒŸ","ðŸ™","ðŸ’¯"];function Jn({roomId:s,onMessageSent:l}){const{user:c}=G(),[g,r]=i.useState(""),[p,u]=i.useState(!1),[m,b]=i.useState(!1),f=i.useRef(null),t=i.useRef();i.useEffect(()=>{n()},[g]),i.useEffect(()=>()=>{t.current&&clearTimeout(t.current),a(!1)},[s]);const n=()=>{if(f.current){f.current.style.height="auto";const j=Math.min(f.current.scrollHeight,200);f.current.style.height=`${j}px`}},a=async j=>{if(c)try{j?await C.from("chat_typing_status").upsert({room_id:s,user_id:c.id,is_typing:!0,last_typing_time:new Date().toISOString()},{onConflict:"room_id,user_id"}):await C.from("chat_typing_status").delete().eq("room_id",s).eq("user_id",c.id)}catch(d){console.error("Error updating typing status:",d)}},N=j=>{r(j.target.value),t.current&&clearTimeout(t.current),j.target.value.trim()?(a(!0),t.current=setTimeout(()=>{a(!1)},3e3)):a(!1)},h=async j=>{if(j?.preventDefault(),!g.trim()||!c||p)return;const d=g.trim();r(""),u(!0),a(!1),t.current&&clearTimeout(t.current);try{const x=k(d),{error:o}=await C.from("chat_messages").insert([{room_id:s,sender_id:c.id,message_text:d,message_type:"text",mentions:x}]);if(o)throw o;l()}catch(x){console.error("Error sending message:",x),r(d)}finally{u(!1)}},k=j=>{const d=/@(\w+)/g,x=[];let o;for(;(o=d.exec(j))!==null;)x.push(o[1]);return x},_=j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),h())},y=j=>{const d=f.current;if(!d)return;const x=d.selectionStart,o=d.selectionEnd,v=g.substring(0,x)+j+g.substring(o);r(v),setTimeout(()=>{d.focus();const w=x+j.length;d.setSelectionRange(w,w)},0),b(!1)};return e.jsx("div",{className:"border-t-2 border-dark-brown/5 bg-white p-4",children:e.jsxs("form",{onSubmit:h,className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1 bg-cream/50 border-2 border-dark-brown/10 rounded-xl focus-within:border-primary transition-colors",children:[e.jsx("textarea",{ref:f,value:g,onChange:N,onKeyDown:_,placeholder:"Type a message... (Shift+Enter for new line)",rows:1,className:"w-full px-4 py-3 bg-transparent resize-none focus:outline-none",style:{maxHeight:"200px"}}),e.jsxs("div",{className:"flex items-center gap-2 px-4 pb-3",children:[e.jsx("button",{type:"button",className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors text-dark-brown/60 hover:text-primary",title:"Attach file",children:e.jsx(rs,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors text-dark-brown/60 hover:text-primary",title:"Attach image",children:e.jsx(ss,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>b(!m),className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors text-dark-brown/60 hover:text-primary",title:"Add emoji",children:e.jsx(Vs,{className:"w-5 h-5"})}),m&&e.jsx("div",{className:"absolute bottom-full left-0 mb-2 bg-white rounded-xl shadow-soft-lg border-2 border-dark-brown/5 p-3 grid grid-cols-6 gap-2",children:Zn.map(j=>e.jsx("button",{type:"button",onClick:()=>y(j),className:"text-2xl hover:bg-cream/50 rounded-lg p-2 transition-colors",children:j},j))})]}),e.jsx("div",{className:"flex-1"}),e.jsx("span",{className:"text-xs text-dark-brown/40",children:g.length>0&&`${g.length} characters`})]})]}),e.jsx("button",{type:"submit",disabled:!g.trim()||p,className:"p-4 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:e.jsx(Os,{className:"w-5 h-5"})})]}),e.jsxs("p",{className:"text-xs text-dark-brown/40 px-1",children:["Use ",e.jsx("span",{className:"font-mono bg-dark-brown/5 px-1 rounded",children:"@username"})," to mention someone â€¢"," ",e.jsx("span",{className:"font-mono bg-dark-brown/5 px-1 rounded",children:"**bold**"})," for bold text"]})]})})}const Xn=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥"];function el({message:s,isOwnMessage:l,onDelete:c,onEdit:g}){const{user:r}=G(),[p,u]=i.useState(!1),[m,b]=i.useState(!1),[f,t]=i.useState(s.message_text),n=async()=>{if(confirm("Delete this message?"))try{const{error:y}=await C.from("chat_messages").update({is_deleted:!0,deleted_at:new Date().toISOString()}).eq("id",s.id);if(y)throw y;c()}catch(y){console.error("Error deleting message:",y)}},a=async()=>{if(f.trim())try{const{error:y}=await C.from("chat_messages").update({message_text:f.trim(),is_edited:!0,edited_at:new Date().toISOString()}).eq("id",s.id);if(y)throw y;b(!1),g()}catch(y){console.error("Error editing message:",y)}},N=async y=>{if(r)try{const j=s.reactions||{},d=j[y]||[],x={...j};d.includes(r.id)?(x[y]=d.filter(v=>v!==r.id),x[y].length===0&&delete x[y]):x[y]=[...d,r.id];const{error:o}=await C.from("chat_messages").update({reactions:x}).eq("id",s.id);if(o)throw o}catch(j){console.error("Error adding reaction:",j)}},h=y=>{let j=y;return j=j.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),j=j.replace(/\*(.*?)\*/g,"<em>$1</em>"),j=j.replace(/`(.*?)`/g,'<code class="bg-dark-brown/10 px-1 rounded">$1</code>'),j=j.replace(/@(\w+)/g,'<span class="bg-accent/20 text-accent font-semibold px-1 rounded">@$1</span>'),j},k=s.reactions||{},_=Object.entries(k).filter(([y,j])=>j.length>0);return e.jsxs("div",{className:`flex gap-3 ${l?"flex-row-reverse":"flex-row"}`,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-sage flex items-center justify-center text-white font-bold flex-shrink-0",children:s.sender_id?.substring(0,2).toUpperCase()||"U"}),e.jsxs("div",{className:`flex-1 max-w-2xl ${l?"items-end":"items-start"} flex flex-col`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:l?"You":"Team Member"}),e.jsx("span",{className:"text-xs text-dark-brown/40",children:$(new Date(s.created_at),"h:mm a")}),s.is_edited&&e.jsx("span",{className:"text-xs text-dark-brown/40 italic",children:"(edited)"})]}),e.jsx("div",{className:"relative group",children:m?e.jsxs("div",{className:"bg-white border-2 border-primary rounded-xl p-3",children:[e.jsx("textarea",{value:f,onChange:y=>t(y.target.value),className:"w-full p-2 bg-cream/30 border border-dark-brown/10 rounded-lg focus:outline-none focus:border-primary resize-none",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:a,className:"px-3 py-1 bg-primary text-white rounded-lg text-sm font-semibold hover:bg-primary/90 transition-colors",children:"Save"}),e.jsx("button",{onClick:()=>{b(!1),t(s.message_text)},className:"px-3 py-1 bg-dark-brown/10 text-dark-brown rounded-lg text-sm font-semibold hover:bg-dark-brown/20 transition-colors",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`rounded-xl px-4 py-3 ${l?"bg-gradient-to-br from-primary to-sage text-white":"bg-white border-2 border-dark-brown/5 text-dark-brown"}`,children:e.jsx("div",{className:"text-sm leading-relaxed break-words",dangerouslySetInnerHTML:{__html:h(s.message_text)}})}),p&&l&&e.jsxs("div",{className:"absolute -top-3 right-0 bg-white rounded-lg shadow-soft border border-dark-brown/10 flex gap-1 p-1",children:[e.jsx("button",{onClick:()=>b(!0),className:"p-1.5 hover:bg-cream/50 rounded transition-colors",title:"Edit",children:e.jsx(ye,{className:"w-4 h-4 text-dark-brown/60"})}),e.jsx("button",{onClick:n,className:"p-1.5 hover:bg-soft-red/10 rounded transition-colors",title:"Delete",children:e.jsx(de,{className:"w-4 h-4 text-soft-red"})})]})]})}),_.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:_.map(([y,j])=>e.jsxs("button",{onClick:()=>N(y),className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs transition-colors ${j.includes(r?.id)?"bg-accent/20 border-2 border-accent":"bg-white border-2 border-dark-brown/10 hover:border-accent"}`,children:[e.jsx("span",{children:y}),e.jsx("span",{className:"font-semibold",children:j.length})]},y))}),e.jsx("div",{className:"flex gap-1 mt-1",children:Xn.map(y=>e.jsx("button",{onClick:()=>N(y),className:"text-lg opacity-0 group-hover:opacity-100 hover:scale-125 transition-all",title:`React with ${y}`,children:y},y))})]})]})}function tl({room:s,teamMembers:l}){const{user:c}=G(),[g,r]=i.useState([]),[p,u]=i.useState(!0),[m,b]=i.useState([]),f=i.useRef(null),t=i.useRef(null),[n,a]=i.useState(!1);i.useEffect(()=>{s&&(N(),h(),k(),_())},[s?.id]),i.useEffect(()=>{y()},[g]);const N=async()=>{try{u(!0);const{data:w,error:P}=await C.from("chat_messages").select("*").eq("room_id",s.id).eq("is_deleted",!1).order("created_at",{ascending:!0}).limit(100);if(P)throw P;r(w||[])}catch(w){console.error("Error fetching messages:",w)}finally{u(!1)}},h=()=>{const w=C.channel(`room_${s.id}_messages`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},P=>{r(T=>[...T,P.new]),_()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},P=>{r(T=>T.map(S=>S.id===P.new.id?P.new:S))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},P=>{r(T=>T.filter(S=>S.id!==P.old.id))}).subscribe();return()=>{w.unsubscribe()}},k=()=>{const w=C.channel(`room_${s.id}_typing`).on("postgres_changes",{event:"*",schema:"public",table:"chat_typing_status",filter:`room_id=eq.${s.id}`},async()=>{const{data:P}=await C.from("chat_typing_status").select("*").eq("room_id",s.id).eq("is_typing",!0).neq("user_id",c?.id||"");b(P||[])}).subscribe();return()=>{w.unsubscribe()}},_=async()=>{if(c)try{const{error:w}=await C.from("chat_room_members").update({last_read_at:new Date().toISOString()}).eq("room_id",s.id).eq("user_id",c.id);if(w)throw w}catch(w){console.error("Error marking room as read:",w)}},y=()=>{f.current?.scrollIntoView({behavior:"smooth"})},j=()=>{if(!t.current)return;const{scrollTop:w,scrollHeight:P,clientHeight:T}=t.current,S=P-w-T<100;a(!S)},d=w=>{const P=new Date(w);return oa(P)?"Today":ia(P)?"Yesterday":$(P,"MMMM dd, yyyy")},x=(w,P)=>P?!Yt(new Date(w.created_at),new Date(P.created_at)):!0,o=w=>{const P=l.find(T=>T.id===w);return w===c?.id?"You":P?.full_name||P?.email?.split("@")[0]||"Unknown"},v=()=>m.map(w=>{const P=l.find(T=>T.id===w.user_id);return P?.full_name||P?.email?.split("@")[0]||"Someone"}).join(", ");return e.jsxs("div",{className:"flex-1 flex flex-col h-full",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 p-4 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"text-3xl",children:s.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary truncate",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-dark-brown/60 truncate",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-dark-brown/40"}),e.jsxs("span",{className:"text-sm text-dark-brown/60 font-medium",children:[l.length," partner",l.length!==1?"s":""]})]})]})}),e.jsxs("div",{ref:t,onScroll:j,className:"flex-1 overflow-y-auto p-4 bg-cream/30",children:[p?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):g.length>0?e.jsxs("div",{className:"space-y-4",children:[g.map((w,P)=>e.jsxs("div",{children:[x(w,g[P-1])&&e.jsxs("div",{className:"flex items-center gap-3 my-6",children:[e.jsx("div",{className:"flex-1 h-px bg-dark-brown/10"}),e.jsx("span",{className:"text-xs font-semibold text-dark-brown/40 px-3 py-1 bg-white rounded-full",children:d(w.created_at)}),e.jsx("div",{className:"flex-1 h-px bg-dark-brown/10"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[w.sender_id!==c?.id&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary to-sage flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:o(w.sender_id)[0]?.toUpperCase()}),e.jsxs("div",{className:`flex-1 ${w.sender_id===c?.id?"ml-auto":""}`,children:[w.sender_id!==c?.id&&e.jsx("div",{className:"text-sm font-semibold text-primary mb-1",children:o(w.sender_id)}),e.jsx(el,{message:w,isOwnMessage:w.sender_id===c?.id,onDelete:()=>N(),onEdit:()=>N()})]}),w.sender_id===c?.id&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary to-sage flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:o(w.sender_id)[0]?.toUpperCase()})]})]},w.id)),e.jsx("div",{ref:f})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:s.icon}),e.jsx("h4",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-dark-brown/40",children:"Start the conversation with your team!"})]})}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-soft mt-4",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsxs("span",{className:"text-sm text-dark-brown/60",children:[v()," ",m.length===1?"is":"are"," typing..."]})]})]}),n&&e.jsx("button",{onClick:y,className:"absolute bottom-24 right-8 p-3 bg-primary text-white rounded-full shadow-soft-lg hover:shadow-soft-xl transition-all z-10",children:e.jsx(Fs,{className:"w-5 h-5"})}),e.jsx(Jn,{roomId:s.id,onMessageSent:N})]})}const sl="00000000-0000-0000-0000-000000000001";function al(){const{user:s}=G(),[l,c]=i.useState(null),[g,r]=i.useState([]),[p,u]=i.useState(!0);i.useEffect(()=>{m()},[s]);const m=async()=>{if(s)try{const{data:b,error:f}=await C.from("chat_room_list").select("*").eq("id",sl).eq("user_id",s.id).maybeSingle();if(f)throw f;b&&c(b);const{data:t,error:n}=await C.from("team_chat_members").select("*");if(n)throw n;r(t||[])}catch(b){console.error("Error fetching room data:",b)}finally{u(!1)}};return p?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-73px)]",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Ne,{}),e.jsx(H,{}),e.jsxs("div",{className:"relative z-10 h-[calc(100vh-73px)] flex",children:[e.jsxs("div",{className:"w-80 glass-card border-r-2 border-primary/10 flex flex-col",children:[e.jsx("div",{className:"p-6 border-b-2 border-primary/10",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ‘¥"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-gradient",children:"Team Chat"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Common chat for all partners"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-dark-brown/60 uppercase tracking-wider mb-3 px-2",children:["Team Members (",g.length,")"]}),e.jsx("div",{className:"space-y-2",children:g.map(b=>e.jsx("div",{className:`p-3 rounded-xl transition-all ${b.id===s?.id?"bg-primary/10 border-2 border-primary/20":"bg-white border-2 border-transparent hover:border-primary/10"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-sage flex items-center justify-center text-white font-bold text-lg",children:(b.full_name||b.email)?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-primary truncate",children:[b.full_name||b.email?.split("@")[0]||"Partner",b.id===s?.id&&e.jsx("span",{className:"ml-2 text-xs text-primary/60 font-normal",children:"(You)"})]}),e.jsx("div",{className:"text-xs text-dark-brown/60 truncate",children:b.role||b.email})]}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-emerald-500 ring-2 ring-white flex-shrink-0",title:"Online"})]})},b.id))}),g.length===0&&e.jsxs("div",{className:"text-center py-8 px-4",children:[e.jsx(ve,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-dark-brown/40",children:"No team members found"})]})]}),e.jsx("div",{className:"p-4 border-t-2 border-primary/10 bg-white",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-dark-brown/40",children:"All partners can see and send messages"})})})]}),e.jsx("div",{className:"flex-1 flex flex-col glass-card",children:l?e.jsx(tl,{room:l,teamMembers:g}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ‘¥"}),e.jsx("h3",{className:"font-heading text-3xl font-bold text-primary mb-3",children:"Team Chat Unavailable"}),e.jsx("p",{className:"text-primary/60 text-lg font-medium",children:"Unable to load the team chat room"})]})})})]})]})}function rl(){const s=me(),{user:l}=G(),[c,g]=i.useState("profile"),[r,p]=i.useState({name:l?.name||"",email:l?.email||"",phone:l?.phone||""}),[u,m]=i.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[b,f]=i.useState(null),[t,n]=i.useState(null),[a,N]=i.useState(!1),[h,k]=i.useState(!1),_=async j=>{j.preventDefault(),N(!0),f(null);try{const d=localStorage.getItem("users"),x=d?JSON.parse(d):[],o=x.findIndex(v=>v.id===l?.id);if(o!==-1){x[o]={...x[o],name:r.name,email:r.email,phone:r.phone},localStorage.setItem("users",JSON.stringify(x));const v={id:x[o].id,name:x[o].name,email:x[o].email,phone:x[o].phone,role:x[o].role};localStorage.setItem("currentUser",JSON.stringify(v)),f({type:"success",text:"Profile updated successfully"}),setTimeout(()=>{window.location.reload()},1500)}}catch{f({type:"error",text:"Failed to update profile"})}finally{N(!1)}},y=async j=>{if(j.preventDefault(),k(!0),n(null),u.newPassword.length<8){n({type:"error",text:"New password must be at least 8 characters long"}),k(!1);return}if(u.newPassword!==u.confirmPassword){n({type:"error",text:"New passwords do not match"}),k(!1);return}try{const d=localStorage.getItem("users"),x=d?JSON.parse(d):[],o=x.findIndex(v=>v.id===l?.id&&v.password===u.currentPassword);o!==-1?(x[o].password=u.newPassword,localStorage.setItem("users",JSON.stringify(x)),n({type:"success",text:"Password changed successfully"}),m({currentPassword:"",newPassword:"",confirmPassword:""})):n({type:"error",text:"Current password is incorrect"})}catch{n({type:"error",text:"Failed to change password"})}finally{k(!1)}};return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Settings"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your account settings and preferences"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-primary/10",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>g("profile"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${c==="profile"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile"})]})}),e.jsx("button",{onClick:()=>g("security"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${c==="security"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Security"})]})})]})}),e.jsxs("div",{className:"p-6 md:p-8",children:[c==="profile"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-6 p-4 bg-cream/50 rounded-xl border border-primary/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-full flex items-center justify-center",children:e.jsx(We,{className:"w-6 h-6 text-cream"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:l?.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:l?.email})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-accent/20 rounded-full",children:[e.jsx(pt,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:l?.role})]})]})}),b&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${b.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[b.type==="success"?e.jsx(Y,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${b.type==="success"?"text-sage":"text-soft-red"}`,children:b.text})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"name",type:"text",value:r.name,onChange:j=>p({...r,name:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"email",type:"email",value:r.email,onChange:j=>p({...r,email:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"phone",type:"tel",value:r.phone,onChange:j=>p({...r,phone:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",disabled:a})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:a,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(zs,{className:"w-5 h-5"}),a?"Saving...":"Save Changes"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]}),c==="security"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"Change Password"}),e.jsx("p",{className:"text-dark-brown/70",children:"Update your password to keep your account secure"})]}),t&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${t.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[t.type==="success"?e.jsx(Y,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${t.type==="success"?"text-sage":"text-soft-red"}`,children:t.text})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"currentPassword",type:"password",value:u.currentPassword,onChange:j=>m({...u,currentPassword:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:h})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"newPassword",type:"password",value:u.newPassword,onChange:j=>m({...u,newPassword:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:h,minLength:8})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"confirmPassword",type:"password",value:u.confirmPassword,onChange:j=>m({...u,confirmPassword:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:h})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:h,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(Fe,{className:"w-5 h-5"}),h?"Changing...":"Change Password"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]})]})]})]})})]})}function nl(){const{user:s}=G(),[l,c]=i.useState([]),[g,r]=i.useState(!0),[p,u]=i.useState("all");i.useEffect(()=>{m()},[s?.id]);const m=async()=>{if(s?.id)try{const{data:h,error:k}=await C.from("notifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(k)throw k;c(h||[])}catch(h){console.error("Error fetching notifications:",h)}finally{r(!1)}},b=async h=>{try{const{error:k}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",h);if(k)throw k;c(_=>_.map(y=>y.id===h?{...y,is_read:!0,read_at:new Date().toISOString()}:y))}catch(k){console.error("Error marking notification as read:",k)}},f=async()=>{try{const h=l.filter(_=>!_.is_read).map(_=>_.id),{error:k}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).in("id",h);if(k)throw k;c(_=>_.map(y=>({...y,is_read:!0,read_at:y.read_at||new Date().toISOString()})))}catch(h){console.error("Error marking all as read:",h)}},t=async h=>{try{const{error:k}=await C.from("notifications").delete().eq("id",h);if(k)throw k;c(_=>_.filter(y=>y.id!==h))}catch(k){console.error("Error deleting notification:",k)}},n=p==="unread"?l.filter(h=>!h.is_read):l,a=l.filter(h=>!h.is_read).length,N=h=>{switch(h){case"expense":return"text-blue-600 bg-blue-50";case"batch":return"text-green-600 bg-green-50";case"license":return"text-orange-600 bg-orange-50";case"vendor":return"text-purple-600 bg-purple-50";case"product":return"text-pink-600 bg-pink-50";default:return"text-gray-600 bg-gray-50"}};return g?e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsx("div",{className:"min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-primary mb-2",children:"Notifications"}),e.jsx("p",{className:"text-gray-600",children:a>0?`You have ${a} unread notification${a>1?"s":""}`:"All caught up!"})]}),a>0&&e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary-dark transition-colors",children:[e.jsx(ka,{className:"w-4 h-4"}),"Mark All Read"]})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>u("all"),className:`px-4 py-2 rounded-button font-semibold transition-all ${p==="all"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["All (",l.length,")"]}),e.jsxs("button",{onClick:()=>u("unread"),className:`px-4 py-2 rounded-button font-semibold transition-all ${p==="unread"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["Unread (",a,")"]})]})]}),n.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(Ge,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:p==="unread"?"No unread notifications":"No notifications yet"}),e.jsx("p",{className:"text-gray-500",children:p==="unread"?"All notifications have been read":"You'll see notifications here when there's activity"})]}):e.jsx("div",{className:"space-y-3",children:n.map(h=>e.jsx("div",{className:`glass-card p-4 transition-all hover:shadow-lg ${h.is_read?"":"border-l-4 border-gold"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${N(h.type)}`,children:e.jsx(Ge,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsx("h3",{className:"font-semibold text-primary",children:h.title}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:Zt(new Date(h.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:h.message}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${N(h.type)}`,children:h.type}),!h.is_read&&e.jsxs("button",{onClick:()=>b(h.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-primary hover:bg-primary/5 rounded-button transition-colors",children:[e.jsx(ts,{className:"w-3 h-3"}),"Mark as read"]}),e.jsxs("button",{onClick:()=>t(h.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-red-600 hover:bg-red-50 rounded-button transition-colors ml-auto",children:[e.jsx(de,{className:"w-3 h-3"}),"Delete"]})]})]})]})},h.id))})]})})]})}function ll(){const{user:s}=G(),[l,c]=i.useState("pending"),[g,r]=i.useState([]),[p,u]=i.useState([]),[m,b]=i.useState([]),[f,t]=i.useState(!0),[n,a]=i.useState(""),[N,h]=i.useState(null),[k,_]=i.useState(!1),[y,j]=i.useState(null),[d,x]=i.useState("");i.useEffect(()=>{o()},[]);const o=async()=>{t(!0);try{const{data:A}=await C.from("users").select("*").eq("approval_status","pending").order("created_at",{ascending:!1}),{data:U}=await C.from("users").select(`
          *,
          approver:approved_by(name)
        `).eq("approval_status","approved").order("approved_at",{ascending:!1}),{data:z}=await C.from("users").select("*").eq("approval_status","rejected").order("created_at",{ascending:!1});r(A||[]),u((U||[]).map(W=>({...W,approver_name:W.approver?.name||"Unknown"}))),b(z||[])}catch(A){console.error("Error fetching users:",A)}finally{t(!1)}},v=async A=>{h(A);try{const{error:U}=await C.from("users").update({approval_status:"approved",approved_by:s?.id,approved_at:new Date().toISOString()}).eq("id",A);if(U)throw U;await C.from("notifications").insert({user_id:A,type:"account_approved",title:"Account Approved",message:"Your Organitto account has been approved! You can now login.",read:!1}),await o()}catch(U){console.error("Error approving user:",U),alert("Failed to approve user")}finally{h(null)}},w=A=>{j(A),_(!0),x("")},P=async()=>{if(!y||!d.trim()){alert("Please provide a reason for rejection");return}h(y.id);try{const{error:A}=await C.from("users").update({approval_status:"rejected",rejection_reason:d}).eq("id",y.id);if(A)throw A;await C.from("notifications").insert({user_id:y.id,type:"account_rejected",title:"Registration Not Approved",message:`Your registration was not approved. Reason: ${d}`,read:!1}),_(!1),j(null),x(""),await o()}catch(A){console.error("Error rejecting user:",A),alert("Failed to reject user")}finally{h(null)}},T=A=>{if(!n.trim())return A;const U=n.toLowerCase();return A.filter(z=>z.name.toLowerCase().includes(U)||z.email.toLowerCase().includes(U))},S=A=>new Date(A).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});return f?e.jsxs("div",{className:"min-h-screen bg-gradient-mesh",children:[e.jsx(H,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-mesh",children:[e.jsx(H,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx(ve,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"User Approval Management"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Review and manage user registrations"})]})]})}),e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>c("pending"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${l==="pending"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(ie,{className:"w-4 h-4 inline mr-2"}),"Pending (",g.length,")"]}),e.jsxs("button",{onClick:()=>c("approved"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${l==="approved"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(Y,{className:"w-4 h-4 inline mr-2"}),"Approved (",p.length,")"]}),e.jsxs("button",{onClick:()=>c("rejected"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${l==="rejected"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(Se,{className:"w-4 h-4 inline mr-2"}),"Rejected (",m.length,")"]})]}),e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(ft,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:n,onChange:A=>a(A.target.value),className:"input-float w-full pl-12"})]})]}),l==="pending"&&e.jsx("div",{className:"space-y-4",children:T(g).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No pending approvals"})]}):T(g).map(A=>e.jsx("div",{className:"glass-card p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:A.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:A.name}),e.jsx("p",{className:"text-sm text-primary/60",children:A.role.charAt(0).toUpperCase()+A.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",A.email]}),A.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",A.phone]}),e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Registered:"})," ",S(A.created_at)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(pe,{onClick:()=>v(A.id),disabled:N===A.id,variant:"primary",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>w(A),disabled:N===A.id,className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Reject"]})]})]})},A.id))}),l==="approved"&&e.jsx("div",{className:"space-y-4",children:T(p).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No approved users"})]}):T(p).map(A=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:A.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:A.name}),e.jsx("p",{className:"text-sm text-primary/60",children:A.role.charAt(0).toUpperCase()+A.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",A.email]}),A.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",A.phone]}),e.jsxs("p",{className:"text-sm text-green-600 font-semibold",children:["Approved by ",A.approver_name," on ",A.approved_at?S(A.approved_at):"N/A"]})]})]},A.id))}),l==="rejected"&&e.jsx("div",{className:"space-y-4",children:T(m).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No rejected users"})]}):T(m).map(A=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:A.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:A.name}),e.jsx("p",{className:"text-sm text-primary/60",children:A.role.charAt(0).toUpperCase()+A.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",A.email]}),A.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",A.phone]}),A.rejection_reason&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50/50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-sm font-semibold text-red-800 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700",children:A.rejection_reason})]})]})]},A.id))})]})]}),k&&y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"glass-card p-8 max-w-md w-full animate-scale-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary mb-4",children:"Reject Registration"}),e.jsxs("p",{className:"text-primary/70 mb-6",children:["Are you sure you want to reject ",e.jsx("span",{className:"font-bold",children:y.name}),"'s registration?"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-primary mb-3",children:"Rejection Reason (Required)"}),e.jsx("textarea",{value:d,onChange:A=>x(A.target.value),className:"input-float w-full h-32 resize-none",placeholder:"Explain why this registration is being rejected...",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{_(!1),j(null),x("")},className:"flex-1 px-6 py-3 glass-card text-primary font-bold rounded-button hover:shadow-md",children:"Cancel"}),e.jsx("button",{onClick:P,disabled:!d.trim()||N===y.id,className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50",children:"Confirm Reject"})]})]})})]})}function ol(){const s=Ss(),{user:l}=G(),g=["/","/login","/register"].includes(s.pathname),r=l&&!g;return e.jsxs(e.Fragment,{children:[!g&&e.jsx(Ne,{}),e.jsxs(ra,{children:[e.jsx(te,{path:"/",element:e.jsx(cr,{})}),e.jsx(te,{path:"/login",element:e.jsx(xr,{})}),e.jsx(te,{path:"/register",element:e.jsx(mr,{})}),e.jsx(te,{path:"/dashboard",element:e.jsx(ne,{children:e.jsx(br,{})})}),e.jsx(te,{path:"/finance",element:e.jsx(ne,{children:e.jsx(ur,{})})}),e.jsx(te,{path:"/expenses/add",element:e.jsx(ne,{children:e.jsx(fr,{})})}),e.jsx(te,{path:"/expenses/edit/:id",element:e.jsx(ne,{children:e.jsx(yr,{})})}),e.jsx(te,{path:"/expenses",element:e.jsx(ne,{children:e.jsx(vr,{})})}),e.jsx(te,{path:"/expenses/reports",element:e.jsx(ne,{children:e.jsx(Mr,{})})}),e.jsx(te,{path:"/investments",element:e.jsx(ne,{children:e.jsx(Tr,{})})}),e.jsx(te,{path:"/products",element:e.jsx(ne,{children:e.jsx(Vr,{})})}),e.jsx(te,{path:"/products/:id",element:e.jsx(ne,{children:e.jsx(rn,{})})}),e.jsx(te,{path:"/calculator",element:e.jsx(ne,{children:e.jsx(nn,{})})}),e.jsx(te,{path:"/vendors",element:e.jsx(ne,{children:e.jsx(cn,{})})}),e.jsx(te,{path:"/vendors/:id",element:e.jsx(ne,{children:e.jsx(jn,{})})}),e.jsx(te,{path:"/batches",element:e.jsx(ne,{children:e.jsx(wn,{})})}),e.jsx(te,{path:"/batches/:id",element:e.jsx(ne,{children:e.jsx(Pn,{})})}),e.jsx(te,{path:"/ingredients",element:e.jsx(ne,{children:e.jsx(An,{})})}),e.jsx(te,{path:"/ingredients/:id",element:e.jsx(ne,{children:e.jsx(Rn,{})})}),e.jsx(te,{path:"/compliance",element:e.jsx(ne,{children:e.jsx(zn,{})})}),e.jsx(te,{path:"/compliance/:id",element:e.jsx(ne,{children:e.jsx(Kn,{})})}),e.jsx(te,{path:"/chat",element:e.jsx(ne,{children:e.jsx(al,{})})}),e.jsx(te,{path:"/settings",element:e.jsx(ne,{children:e.jsx(rl,{})})}),e.jsx(te,{path:"/notifications",element:e.jsx(ne,{children:e.jsx(nl,{})})}),e.jsx(te,{path:"/admin/user-approvals",element:e.jsx(ne,{adminOnly:!0,children:e.jsx(ll,{})})}),e.jsx(te,{path:"*",element:e.jsx(Cs,{to:"/",replace:!0})})]}),r&&e.jsx(dr,{})]})}function il(){return e.jsx(aa,{children:e.jsxs(ja,{children:[e.jsx(lr,{}),e.jsx(nr,{}),e.jsx(or,{}),e.jsx(ol,{})]})})}Es(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(il,{})}));
