import{r as i,b as da,N as Zt,u as ce,d as es,O as ca,L as Ne,e as Je,B as xa,f as ma,h as K}from"./react-vendor-B1UGq2v7.js";import{c as ha}from"./supabase-vendor-DKRvmUUb.js";import{f as ts,a as R,s as xt,b as us,e as fs,c as pa,i as Jt,d as X,g as Es,h as As,j as Is}from"./date-vendor-Y3GY3t4o.js";import{R as be,L as Et,C as Fe,X as Le,Y as qe,T as ye,a as ft,b as $e,P as At,c as It,d as Tt,e as ba,A as ua,B as Ft,f as mt}from"./chart-vendor-DZhzrXBW.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))b(c);new MutationObserver(c=>{for(const n of c)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&b(a)}).observe(document,{childList:!0,subtree:!0});function h(c){const n={};return c.integrity&&(n.integrity=c.integrity),c.referrerPolicy&&(n.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?n.credentials="include":c.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function b(c){if(c.ep)return;c.ep=!0;const n=h(c);fetch(c.href,n)}})();var Ts={exports:{}},Lt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fa=i,ga=Symbol.for("react.element"),ja=Symbol.for("react.fragment"),ya=Object.prototype.hasOwnProperty,wa=fa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Na={key:!0,ref:!0,__self:!0,__source:!0};function Fs(s,l,h){var b,c={},n=null,a=null;h!==void 0&&(n=""+h),l.key!==void 0&&(n=""+l.key),l.ref!==void 0&&(a=l.ref);for(b in l)ya.call(l,b)&&!Na.hasOwnProperty(b)&&(c[b]=l[b]);if(s&&s.defaultProps)for(b in l=s.defaultProps,l)c[b]===void 0&&(c[b]=l[b]);return{$$typeof:ga,type:s,key:n,ref:a,props:c,_owner:wa.current}}Lt.Fragment=ja;Lt.jsx=Fs;Lt.jsxs=Fs;Ts.exports=Lt;var e=Ts.exports,Ls,gs=da;Ls=gs.createRoot,gs.hydrateRoot;const va="https://zvrkldiptatwsnflmvbp.supabase.co",ka="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2cmtsZGlwdGF0d3NuZmxtdmJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTU4MDMsImV4cCI6MjA4MTI3MTgwM30.cPJdSpxdkQxD6TfgJ4qsnNRTJWPwQvjTlhZPVcHR17A",C=ha(va,ka),qs=i.createContext(void 0);function _a({children:s}){const[l,h]=i.useState(null),[b,c]=i.useState(null),[n,a]=i.useState(!0);i.useEffect(()=>{C.auth.getSession().then(({data:{session:v}})=>{c(v),v?.user?o(v.user.id):a(!1)});const{data:{subscription:r}}=C.auth.onAuthStateChange((v,f)=>{c(f),f?.user?o(f.user.id):(h(null),a(!1))});return()=>r.unsubscribe()},[]);const o=async r=>{try{const{data:v,error:f}=await C.from("users").select("*").eq("id",r).maybeSingle();if(f)throw f;if(v){if(v.approval_status!=="approved"){await C.auth.signOut(),h(null),c(null),a(!1);return}h(v)}}catch(v){console.error("Error loading user profile:",v)}finally{a(!1)}},x={session:b,user:l,loading:n,signIn:async(r,v)=>{if(!r||!v)return{error:new Error("Please enter email and password")};try{const{data:f,error:j}=await C.auth.signInWithPassword({email:r,password:v});if(j)throw j;if(f.user){const{data:_,error:N}=await C.from("users").select("approval_status, rejection_reason").eq("id",f.user.id).maybeSingle();if(N)throw N;if(_?.approval_status==="pending")return await C.auth.signOut(),{error:new Error("Your account is pending approval. Please wait for admin to approve your registration.")};if(_?.approval_status==="rejected"){await C.auth.signOut();const w=_.rejection_reason?`
Reason: ${_.rejection_reason}`:"";return{error:new Error(`Your registration was not approved.${w}

Please contact admin for more information.`)}}await o(f.user.id)}return{error:null}}catch(f){return{error:new Error(f.message||"Invalid login credentials")}}},signUp:async(r,v,f,j,_="partner")=>{if(!r||!v||!f)return{error:new Error("Please fill all required fields")};try{const{data:N,error:w}=await C.auth.signUp({email:r,password:v});if(w)throw w;if(!N.user)throw new Error("Failed to create user");const y=_==="admin"?"approved":"pending",p=_==="admin"?new Date().toISOString():null,{error:d}=await C.from("users").insert({id:N.user.id,email:r,name:f,phone:j||null,role:_,approval_status:y,approved_at:p});if(d)throw d;return _==="admin"?await o(N.user.id):await C.auth.signOut(),{error:null}}catch(N){return{error:new Error(N.message||"Failed to create account")}}},signOut:async()=>{await C.auth.signOut(),h(null),c(null)}};return e.jsx(qs.Provider,{value:x,children:s})}function H(){const s=i.useContext(qs);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ca={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),F=(s,l)=>{const h=i.forwardRef(({color:b="currentColor",size:c=24,strokeWidth:n=2,absoluteStrokeWidth:a,className:o="",children:u,...m},t)=>i.createElement("svg",{ref:t,...Ca,width:c,height:c,stroke:b,strokeWidth:a?Number(n)*24/Number(c):n,className:["lucide",`lucide-${Sa(s)}`,o].join(" "),...m},[...l.map(([x,r])=>i.createElement(x,r)),...Array.isArray(u)?u:[u]]));return h.displayName=`${s}`,h};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=F("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=F("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=F("AlertOctagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=F("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=F("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=F("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=F("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=F("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=F("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=F("Beaker",[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=F("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=F("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=F("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=F("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=F("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=F("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=F("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=F("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=F("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=F("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=F("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=F("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=F("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=F("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=F("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=F("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=F("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=F("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=F("FileSearch",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"1vg67v"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=F("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=F("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=F("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=F("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=F("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=F("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=F("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=F("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=F("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=F("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=F("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=F("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=F("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=F("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=F("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=F("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=F("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=F("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=F("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=F("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=F("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=F("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=F("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=F("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=F("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=F("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=F("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=F("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=F("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=F("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=F("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=F("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=F("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=F("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=F("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=F("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=F("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=F("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=F("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=F("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=F("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=F("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=F("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=F("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=F("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=F("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=F("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=F("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=F("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=F("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=F("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=F("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=F("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=F("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=F("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=F("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=F("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=F("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=F("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=F("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=F("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=F("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=F("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=F("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=F("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=F("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function ws({children:s,adminOnly:l=!1}){const{user:h,loading:b}=H();return b?e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ls,{className:"w-12 h-12 text-primary animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading..."})]})}):h?h.approval_status!=="approved"?e.jsx(Zt,{to:"/login",replace:!0}):l&&h.role!=="admin"?e.jsx("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card p-10 text-center max-w-md",children:[e.jsx(Qa,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-primary mb-3",children:"Access Denied"}),e.jsx("p",{className:"text-primary/70 mb-6",children:"You don't have permission to access this page. This area is restricted to administrators only."}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-6 py-3 bg-gradient-primary text-white font-bold rounded-button hover:shadow-lg",children:"Go Back"})]})}):e.jsx(e.Fragment,{children:s}):e.jsx(Zt,{to:"/login",replace:!0})}function nr({onMenuClick:s}){const{user:l,signOut:h}=H(),b=ce(),[c,n]=i.useState(!1),[a,o]=i.useState(!1),[u,m]=i.useState([]),[t,x]=i.useState(0),[r,v]=i.useState(""),[f]=i.useState(3),j=u.filter(p=>!p.is_read).length;i.useEffect(()=>{if(l?.id){_(),l.role==="admin"&&N();const p=C.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${l.id}`},()=>{_()}).subscribe();return()=>{C.removeChannel(p)}}},[l?.id,l?.role]);const _=async()=>{if(l?.id)try{const{data:p,error:d}=await C.from("notifications").select("*").eq("user_id",l.id).order("created_at",{ascending:!1}).limit(5);if(d)throw d;m(p||[])}catch(p){console.error("Error fetching notifications:",p)}},N=async()=>{try{const{count:p,error:d}=await C.from("users").select("*",{count:"exact",head:!0}).eq("approval_status","pending");if(d)throw d;x(p||0)}catch(p){console.error("Error fetching pending users count:",p)}},w=async()=>{await h(),b("/")},y=p=>{p.key==="Enter"&&r.trim()&&console.log("Search for:",r)};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("button",{className:"mobile-menu-btn",onClick:s,children:e.jsx(Ua,{size:20})}),e.jsxs("div",{className:"logo desktop-only",children:[e.jsx("span",{className:"logo-icon",children:"ðŸŒ¿"}),e.jsx("span",{className:"logo-text",children:"Organitto"})]}),e.jsxs("div",{className:"search-bar desktop-only",children:[e.jsx(ve,{size:18,strokeWidth:2}),e.jsx("input",{type:"text",placeholder:"Search products, expenses, vendors...",className:"search-input",value:r,onChange:p=>v(p.target.value),onKeyDown:y}),e.jsx("kbd",{className:"search-kbd",children:"âŒ˜K"})]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("button",{className:"header-icon-btn",onClick:()=>b("/chat"),title:"Chat",children:[e.jsx(ze,{size:18}),f>0&&e.jsx("span",{className:"header-badge",children:f})]}),e.jsxs("div",{className:"header-dropdown-container",children:[e.jsxs("button",{className:"header-icon-btn",onClick:()=>n(!c),title:"Notifications",children:[e.jsx(Ke,{size:18}),j>0&&e.jsx("span",{className:"header-badge",children:j})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-dropdown-overlay",onClick:()=>n(!1)}),e.jsxs("div",{className:"header-dropdown notifications-dropdown",children:[e.jsxs("div",{className:"dropdown-header",children:[e.jsx("h3",{children:"Notifications"}),j>0&&e.jsxs("span",{className:"dropdown-badge",children:[j," new"]})]}),e.jsx("div",{className:"dropdown-body",children:u.length>0?u.map(p=>e.jsxs("div",{className:`notification-item ${p.is_read?"":"unread"}`,children:[e.jsx("div",{className:`notification-dot ${p.is_read?"":"active"}`}),e.jsxs("div",{className:"notification-content",children:[e.jsx("p",{className:"notification-title",children:p.title}),e.jsx("p",{className:"notification-message",children:p.message}),e.jsx("p",{className:"notification-time",children:ts(new Date(p.created_at),{addSuffix:!0})})]})]},p.id)):e.jsxs("div",{className:"dropdown-empty",children:[e.jsx(Ke,{size:32}),e.jsx("p",{children:"No notifications"})]})}),e.jsx("div",{className:"dropdown-footer",children:e.jsx("button",{onClick:()=>{n(!1),b("/notifications")},children:"View All Notifications"})})]})]})]}),e.jsxs("div",{className:"header-dropdown-container",children:[e.jsxs("button",{className:"user-menu",onClick:()=>o(!a),children:[e.jsx("div",{className:"user-avatar",children:l?.name?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{className:"user-name desktop-only",children:l?.name}),e.jsx(Rs,{size:16,className:"desktop-only"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-dropdown-overlay",onClick:()=>o(!1)}),e.jsxs("div",{className:"header-dropdown user-dropdown",children:[e.jsxs("div",{className:"dropdown-header user-header",children:[e.jsx("div",{className:"user-avatar large",children:l?.name?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-info-name",children:l?.name}),e.jsx("div",{className:"user-info-email",children:l?.email}),l?.role&&e.jsxs("div",{className:"user-info-role",children:[e.jsx(ut,{size:12}),e.jsx("span",{children:l.role})]})]})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("div",{className:"dropdown-body",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>{o(!1),b("/settings")},children:[e.jsx(Oe,{size:18}),e.jsx("span",{children:"Profile"})]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>{o(!1),b("/settings")},children:[e.jsx(Ks,{size:18}),e.jsx("span",{children:"Settings"})]}),l?.role==="admin"&&e.jsxs("button",{className:"dropdown-item",onClick:()=>{o(!1),b("/admin/user-approvals")},children:[e.jsx(ut,{size:18}),e.jsx("span",{children:"User Approvals"}),t>0&&e.jsx("span",{className:"dropdown-badge",children:t})]})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsx("div",{className:"dropdown-body",children:e.jsxs("button",{className:"dropdown-item danger",onClick:w,children:[e.jsx(Hs,{size:18}),e.jsx("span",{children:"Logout"})]})})]})]})]})]})]})}const xe=({icon:s,label:l,path:h,active:b,badge:c,hasDropdown:n,isOpen:a,onClick:o,isSubItem:u})=>{const m=ce(),t=()=>{o?o():h&&m(h)};return e.jsxs("button",{className:`nav-item ${b?"active":""} ${u?"sub-item":""}`,onClick:t,children:[s&&e.jsx("span",{className:"nav-icon",children:s}),e.jsx("span",{className:"nav-label",children:l}),c&&c>0&&e.jsx("span",{className:"nav-badge",children:c}),n&&e.jsx(Us,{className:`nav-chevron ${a?"open":""}`})]})};function lr({isOpen:s,onClose:l}){const{user:h,signOut:b}=H(),c=es(),n=ce(),[a,o]=i.useState(!1),[u,m]=i.useState(0),t=v=>c.pathname===v,x=()=>c.pathname.startsWith("/expenses")||c.pathname.startsWith("/investments")||c.pathname==="/finance",r=async()=>{await b(),n("/")};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`sidebar ${s?"open":""}`,children:[e.jsxs("div",{className:"sidebar-logo mobile-only",children:[e.jsx("span",{className:"logo-icon",children:"ðŸŒ¿"}),e.jsx("span",{className:"logo-text",children:"Organitto"})]}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:"nav-section",children:[e.jsx(xe,{icon:e.jsx($a,{size:18}),label:"Dashboard",path:"/dashboard",active:t("/dashboard")}),e.jsx(xe,{icon:e.jsx(er,{size:18}),label:"Finance",hasDropdown:!0,isOpen:a,onClick:()=>o(!a),active:x()}),a&&e.jsxs("div",{className:"nav-dropdown",children:[e.jsx(xe,{label:"Add Expense",path:"/expenses/add",isSubItem:!0,active:t("/expenses/add")}),e.jsx(xe,{label:"Expense List",path:"/expenses",isSubItem:!0,active:t("/expenses")}),e.jsx(xe,{label:"Reports",path:"/expenses/reports",isSubItem:!0,active:t("/expenses/reports")}),e.jsx(xe,{label:"Investments",path:"/investments",isSubItem:!0,active:t("/investments")})]}),e.jsx(xe,{icon:e.jsx(Fa,{size:18}),label:"Products",path:"/products",active:t("/products")}),e.jsx(xe,{icon:e.jsx($s,{size:18}),label:"Cost Calculator",path:"/calculator",active:t("/calculator")}),e.jsx(xe,{icon:e.jsx(je,{size:18}),label:"Vendors",path:"/vendors",active:t("/vendors")}),e.jsx(xe,{icon:e.jsx(le,{size:18}),label:"Batches",path:"/batches",active:t("/batches")}),e.jsx(xe,{icon:e.jsx(He,{size:18}),label:"Ingredients",path:"/ingredients",active:t("/ingredients")}),e.jsx(xe,{icon:e.jsx(Ya,{size:18}),label:"Compliance",path:"/compliance",active:t("/compliance")}),e.jsx(xe,{icon:e.jsx(ze,{size:18}),label:"Team Chat",path:"/chat",active:t("/chat")}),h?.role==="admin"&&e.jsx(xe,{icon:e.jsx(Xa,{size:18}),label:"User Approvals",path:"/admin/user-approvals",active:t("/admin/user-approvals"),badge:u})]}),e.jsxs("div",{className:"nav-section nav-section-bottom",children:[e.jsx(xe,{icon:e.jsx(Ks,{size:18}),label:"Settings",path:"/settings",active:t("/settings")}),e.jsx(xe,{icon:e.jsx(Hs,{size:18}),label:"Logout",onClick:r})]})]})]}),s&&e.jsx("div",{className:"sidebar-overlay",onClick:l})]})}function Ns(){const[s,l]=i.useState(!1),h=es(),b=()=>{l(!s)},c=()=>{l(!1)};return i.useEffect(()=>{window.innerWidth<768&&c()},[h.pathname]),i.useEffect(()=>{const n=()=>{window.innerWidth>=768&&l(!1)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),i.useEffect(()=>{const n=a=>{a.key==="Escape"&&s&&c()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[s]),e.jsxs("div",{className:"app-layout",children:[e.jsx(nr,{onMenuClick:b}),e.jsxs("div",{className:"app-body",children:[e.jsx(lr,{isOpen:s,onClose:c}),e.jsx("main",{className:"main-content",children:e.jsx(ca,{})})]})]})}function or(){const[s,l]=i.useState(!1),[h,b]=i.useState(!1),[c,n]=i.useState(null);return i.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&b(!0);const o=m=>{m.preventDefault(),n(m),l(!0)},u=()=>{b(!0),l(!1),n(null)};return window.addEventListener("beforeinstallprompt",o),window.addEventListener("appinstalled",u),()=>{window.removeEventListener("beforeinstallprompt",o),window.removeEventListener("appinstalled",u)}},[]),{isInstallable:s,isInstalled:h,installApp:async()=>{if(!c)return!1;try{await c.prompt();const{outcome:o}=await c.userChoice;return o==="accepted"?(n(null),l(!1),!0):!1}catch(o){return console.error("Error installing app:",o),!1}}}}function ir(){const[s,l]=i.useState(navigator.onLine);return i.useEffect(()=>{const h=()=>l(!0),b=()=>l(!1);return window.addEventListener("online",h),window.addEventListener("offline",b),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",b)}},[]),s}function dr(){const[s,l]=i.useState(!1),[h,b]=i.useState(null);return i.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(n=>{b(n),n.addEventListener("updatefound",()=>{const a=n.installing;a&&a.addEventListener("statechange",()=>{a.state==="installed"&&navigator.serviceWorker.controller&&l(!0)})})})},[]),{isUpdateAvailable:s,updateServiceWorker:()=>{h?.waiting&&(h.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())}}}function cr(){const{isInstallable:s,installApp:l}=or(),[h,b]=i.useState(!1),[c,n]=i.useState(!1);i.useEffect(()=>{localStorage.getItem("pwa-install-dismissed")&&n(!0)},[]),i.useEffect(()=>{if(s&&!c){const u=setTimeout(()=>{b(!0)},3e3);return()=>clearTimeout(u)}},[s,c]);const a=async()=>{await l()&&b(!1)},o=()=>{b(!1),n(!0),localStorage.setItem("pwa-install-dismissed","true")};return!h||!s?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-primary/10 p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:"ðŸŒ¿"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Install Organitto"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"Install our app for quick access, offline support, and a native experience!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:a,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(ke,{className:"w-4 h-4"}),"Install"]}),e.jsx("button",{onClick:o,className:"px-4 py-2.5 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Not Now"})]})]}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(re,{className:"w-5 h-5 text-dark-brown/40"})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"âš¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Fast"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“±"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Native"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Offline"})]})]})})]})})}function xr(){const s=ir(),[l,h]=i.useState(!1),[b,c]=i.useState(!1);return i.useEffect(()=>{s?l&&s&&(c(!0),setTimeout(()=>{h(!1),c(!1)},3e3)):(h(!0),c(!1))},[s,l]),l?e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${b?"bg-gradient-to-r from-sage to-primary":"bg-gradient-to-r from-accent to-soft-red"}`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-center gap-3 text-white",children:b?e.jsxs(e.Fragment,{children:[e.jsx(sr,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"Back online! Data syncing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(tr,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"You're offline"}),e.jsx("span",{className:"hidden sm:inline text-sm opacity-90",children:"- Changes will sync when you reconnect"})]})})})}):null}function mr(){const{isUpdateAvailable:s,updateServiceWorker:l}=dr(),[h,b]=i.useState(!1);return!s||h?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-accent/20 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(ys,{className:"w-6 h-6 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Update Available"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"A new version of Organitto is ready. Update now to get the latest features!"}),e.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(ys,{className:"w-4 h-4"}),"Update Now"]})]}),e.jsx("button",{onClick:()=>b(!0),className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(re,{className:"w-5 h-5 text-dark-brown/40"})})]})})})}const hr=[{icon:Pt,label:"Add Expense",path:"/expenses/new",color:"text-orange-500",bgGradient:"from-orange-500/20 to-orange-600/10"},{icon:le,label:"Add Product",path:"/products",color:"text-emerald-500",bgGradient:"from-emerald-500/20 to-emerald-600/10"},{icon:qa,label:"Add Batch",path:"/batches",color:"text-blue-500",bgGradient:"from-blue-500/20 to-blue-600/10"},{icon:Re,label:"Record Sale",path:"/expenses/new",color:"text-green-500",bgGradient:"from-green-500/20 to-green-600/10"},{icon:ae,label:"Quick Note",path:"/chat",color:"text-purple-500",bgGradient:"from-purple-500/20 to-purple-600/10"}];function pr(){const[s,l]=i.useState(!1),h=ce(),b=c=>{l(!1),h(c)};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-dark-brown/40 backdrop-blur-sm",onClick:()=>l(!1)}),e.jsx("div",{className:"relative z-10 flex flex-col-reverse gap-3 mb-5",children:hr.map((c,n)=>{const a=c.icon;return e.jsxs("button",{onClick:()=>b(c.path),className:"group flex items-center justify-end gap-3 animate-scale-in",style:{animationDelay:`${n*50}ms`},children:[e.jsx("div",{className:"glass-card px-5 py-3 font-semibold text-dark-brown whitespace-nowrap shadow-xl border border-cream/20 backdrop-blur-md",children:c.label}),e.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${c.bgGradient} backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-110 cursor-pointer border-2 border-white/30 glass-card`,children:e.jsx(a,{className:`w-8 h-8 ${c.color} drop-shadow-lg`,strokeWidth:2.5})})]},c.label)})})]}),e.jsxs("button",{onClick:()=>l(!s),className:`relative z-10 w-20 h-20 bg-gradient-to-br from-primary via-sage to-secondary rounded-2xl flex items-center justify-center shadow-2xl hover:shadow-[0_0_30px_rgba(139,69,19,0.5)] transition-all duration-300 hover:scale-110 active:scale-95 border-2 border-white/30 ${s?"rotate-45":"rotate-0"}`,"aria-label":s?"Close quick actions":"Open quick actions",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/0 via-white/10 to-white/0 rounded-2xl"}),s?e.jsx(re,{className:"w-9 h-9 text-white relative z-10 drop-shadow-lg",strokeWidth:3}):e.jsx(Q,{className:"w-9 h-9 text-white relative z-10 drop-shadow-lg",strokeWidth:3})]}),!s&&e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-accent rounded-full animate-pulse shadow-lg"})]})}const Se=()=>e.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0",children:[...Array(6)].map((s,l)=>e.jsx("div",{className:"leaf absolute",style:{left:`${10+l*16}%`,animationDelay:`${l*2}s`},children:e.jsx(He,{className:"text-[#2D5016]",size:24+Math.random()*12,style:{transform:`rotate(${Math.random()*360}deg)`,opacity:.06}})},l))}),J=({children:s,className:l="",hover:h=!0,tilt:b=!1,onClick:c})=>{const n="glass-card p-6",a=h?"hover:shadow-xl":"",o=b?"card-3d":"",u=c?"cursor-pointer":"";return e.jsx("div",{className:`${n} ${a} ${o} ${u} ${l}`,onClick:c,children:s})},ue=({children:s,variant:l="primary",size:h="md",className:b="",onClick:c,disabled:n=!1,type:a="button",icon:o})=>{const u="inline-flex items-center justify-center gap-2 font-semibold transition-all duration-300",m={primary:"btn-premium",gold:"btn-gold",neu:"btn-neu text-primary",outline:"border-2 border-primary text-primary hover:bg-primary hover:text-white bg-transparent"},t={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg"},x=n?"opacity-50 cursor-not-allowed":"";return e.jsxs("button",{type:a,onClick:c,disabled:n,className:`${u} ${m[l]} ${t[h]} ${x} ${b}`,children:[o&&e.jsx("span",{children:o}),s]})};function br(){const s=ce();return e.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-20",children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:e.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-12 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-30 group-hover:opacity-50 transition-opacity duration-700"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-32 md:h-40 w-auto object-contain relative z-10 drop-shadow-2xl transform group-hover:scale-110 transition-transform duration-500"})]})}),e.jsxs("div",{className:"mb-6 inline-flex items-center gap-2 px-4 py-2 glass-card",children:[e.jsx(Ka,{className:"w-4 h-4 text-gold"}),e.jsx("span",{className:"text-sm font-bold text-gradient",children:"Premium Ayurvedic Management"})]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-heading font-bold text-primary mb-6 leading-tight animate-fade-in",children:["Elevate Your"," ",e.jsx("span",{className:"text-gradient-gold",children:"Ayurvedic"}),e.jsx("br",{}),"Business"]}),e.jsx("p",{className:"text-xl md:text-2xl text-primary/70 mb-12 max-w-2xl mx-auto leading-relaxed font-medium",children:"The most sophisticated platform for managing your Ayurvedic practice with elegance and precision"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center items-center mb-20",children:[e.jsx(ue,{variant:"primary",size:"lg",onClick:()=>s("/register"),className:"min-w-[220px] text-lg shadow-colored",children:"Start Your Journey"}),e.jsx(ue,{variant:"gold",size:"lg",onClick:()=>s("/login"),className:"min-w-[220px] text-lg",children:"Sign In"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mt-24",children:[e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(He,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Natural Flow"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Manage your practice with intuitive tools that respect the natural rhythm of Ayurvedic care"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float-delayed",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-gold rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-glow transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(te,{className:"w-8 h-8 text-primary-dark"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Premium Analytics"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Gain comprehensive insights into your business health with sophisticated reporting tools"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(ut,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Secure & Reliable"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Enterprise-grade security ensuring your data is protected with the highest standards"})]})]})]})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-48 bg-gradient-to-t from-primary/10 via-gold/5 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 text-center z-20",children:e.jsx("p",{className:"text-sm text-primary/50 font-medium",children:"Trusted by leading Ayurvedic practitioners worldwide"})})]})}function ur(){const s=ce(),{signIn:l,user:h,loading:b}=H(),[c,n]=i.useState(""),[a,o]=i.useState(""),[u,m]=i.useState(""),[t,x]=i.useState(!1);i.useEffect(()=>{h&&!b&&s("/dashboard")},[h,b,s]);const r=async v=>{v.preventDefault(),m(""),x(!0);try{const{error:f}=await l(c,a);f&&(m(f.message||"Failed to sign in. Please check your credentials."),x(!1))}catch{m("An unexpected error occurred. Please try again."),x(!1)}};return e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(Be,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-md",children:[e.jsxs("div",{className:"glass-card p-8 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-300"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto",className:"h-16 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-200"})]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Welcome back"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Sign in to your account"})]}),u&&e.jsxs("div",{className:"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2 animate-slide-down",children:[e.jsx(fe,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:u})]}),e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Email address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),e.jsx("input",{id:"email",type:"email",value:c,onChange:v=>n(v.target.value),className:"w-full h-10 pl-10 pr-4 text-sm border border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 transition-all duration-150 focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10",placeholder:"you@example.com",required:!0,disabled:t})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),e.jsx("input",{id:"password",type:"password",value:a,onChange:v=>o(v.target.value),className:"w-full h-10 pl-10 pr-4 text-sm border border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 transition-all duration-150 focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:t})]})]}),e.jsx("button",{type:"submit",disabled:t,className:"w-full h-10 mt-6 bg-primary hover:bg-primary-dark text-white text-sm font-medium rounded-lg transition-all duration-150 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:t?"Signing in...":"Sign in"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx(Ne,{to:"/register",className:"text-primary font-semibold hover:text-primary-dark transition-colors",children:"Sign up"})]})})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center justify-center gap-1.5",children:[e.jsx(He,{className:"w-3.5 h-3.5"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function fr(){const s=ce(),{signUp:l,user:h,loading:b}=H(),[c,n]=i.useState({name:"",email:"",phone:"",password:"",confirmPassword:""}),[a,o]=i.useState(""),[u,m]=i.useState(!1),[t,x]=i.useState(!1),[r,v]=i.useState(!1);i.useEffect(()=>{if(h&&!b){u&&m(!1);const _=setTimeout(()=>{s("/dashboard")},t?2e3:0);return()=>clearTimeout(_)}},[h,b,u,t,s]);const f=async _=>{if(_.preventDefault(),o(""),c.password.length<8){o("Password must be at least 8 characters long");return}if(c.password!==c.confirmPassword){o("Passwords do not match");return}m(!0);try{const{count:N,error:w}=await C.from("users").select("*",{count:"exact",head:!0});if(w)throw new Error("Failed to check existing users");const y=N===0,p=y?"admin":"partner";y&&x(!0);const{error:d}=await l(c.email,c.password,c.name,c.phone,p);d?(o(d.message||"Failed to create account. Please try again."),m(!1),x(!1)):y||(v(!0),m(!1))}catch(N){o(N.message||"An unexpected error occurred. Please try again."),m(!1),x(!1)}},j=_=>{n({...c,[_.target.name]:_.target.value})};return t?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-sage to-primary p-6 rounded-full shadow-glow",children:e.jsx(Y,{className:"w-12 h-12 text-cream",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Welcome, Founder!"}),e.jsx("p",{className:"text-primary/70 mb-4 text-lg font-medium",children:"Your account has been created successfully. You have full access to all features."}),e.jsx("p",{className:"text-primary/50 text-sm font-medium animate-pulse",children:"Redirecting to dashboard..."})]})})]}):r?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-blue-500 to-cyan-600 p-6 rounded-full shadow-glow",children:e.jsx(Y,{className:"w-12 h-12 text-white",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Registration Successful!"}),e.jsx("p",{className:"text-primary/70 mb-6 text-lg font-medium",children:"Your account has been created and is pending admin approval."}),e.jsx("div",{className:"glass-card bg-blue-50/50 p-4 mb-6",children:e.jsx("p",{className:"text-primary/60 text-sm font-medium",children:"You will receive a notification once your account is approved. Please check back later or wait for an email confirmation."})}),e.jsx(Ne,{to:"/login",children:e.jsx(ue,{variant:"primary",size:"lg",className:"w-full",children:"Go to Login"})})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(Be,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-lg",children:[e.jsxs("div",{className:"glass-card p-10 md:p-12 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-10 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-500"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-20 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-300"})]})}),e.jsx("h1",{className:"font-heading text-5xl font-bold text-gradient text-center mb-3",children:"Create Account"}),e.jsx("p",{className:"text-primary/60 text-center mb-10 text-lg font-medium",children:"Join Organitto and start managing your business"}),a&&e.jsxs("div",{className:"mb-8 p-5 bg-gradient-to-r from-red-50/90 to-red-100/90 backdrop-blur-sm border border-red-200 rounded-button flex items-start gap-3 animate-slide-down",children:[e.jsx(fe,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-700 font-medium",children:a})]}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"name",name:"name",type:"text",value:c.name,onChange:j,className:"input-float w-full pl-12",placeholder:"John Doe",required:!0,disabled:u})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"email",name:"email",type:"email",value:c.email,onChange:j,className:"input-float w-full pl-12",placeholder:"you@example.com",required:!0,disabled:u})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"phone",name:"phone",type:"tel",value:c.phone,onChange:j,className:"input-float w-full pl-12",placeholder:"+1 (555) 000-0000",required:!0,disabled:u})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"password",name:"password",type:"password",value:c.password,onChange:j,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:u,minLength:8})]}),e.jsx("p",{className:"text-xs text-primary/50 mt-2 ml-1 font-medium",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",value:c.confirmPassword,onChange:j,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:u})]})]}),e.jsx(ue,{type:"submit",variant:"primary",size:"lg",disabled:u,className:"w-full text-lg mt-8",children:u?"Creating Account...":"Create Account"})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-primary/70 font-medium",children:["Already have an account?"," ",e.jsx(Ne,{to:"/login",className:"text-gradient-gold font-bold hover:underline transition-all",children:"Sign in here"})]})})]}),e.jsx("div",{className:"text-center mt-8 glass-card inline-block px-6 py-3 mx-auto",children:e.jsxs("p",{className:"text-primary/50 text-sm font-medium flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function ea({data:s}){const l=({active:h,payload:b,label:c})=>h&&b&&b.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-2",children:c}),b.map((n,a)=>e.jsxs("p",{className:"text-sm",style:{color:n.color},children:[n.name,": â‚¹",n.value.toLocaleString("en-IN")]},a))]}):null;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Investment vs Expense Trend"}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(Et,{data:s,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"month",stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"}}),e.jsx(qe,{stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"},tickFormatter:h=>`â‚¹${(h/1e3).toFixed(0)}k`}),e.jsx(ye,{content:e.jsx(l,{})}),e.jsx(ft,{wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}}),e.jsx($e,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,dot:{fill:"#2D5016",r:5},activeDot:{r:7},name:"Investments"}),e.jsx($e,{type:"monotone",dataKey:"expenses",stroke:"#C85A3E",strokeWidth:3,dot:{fill:"#C85A3E",r:5},activeDot:{r:7},name:"Expenses"})]})})]})}const vs=["#2D5016","#C85A3E","#D4AF37","#87A96B","#3E2723","#D84315"];function ta({data:s}){const l=({active:b,payload:c})=>b&&c&&c.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:c[0].name}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["â‚¹",c[0].value.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[(c[0].value/s.reduce((n,a)=>n+a.value,0)*100).toFixed(1),"% of total"]})]}):null,h=b=>`${b.name}`;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Category-wise Expenses"}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(At,{children:[e.jsx(It,{data:s,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",label:h,children:s.map((b,c)=>e.jsx(Tt,{fill:vs[c%vs.length]},`cell-${c}`))}),e.jsx(ye,{content:e.jsx(l,{})}),e.jsx(ft,{verticalAlign:"bottom",height:36,wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}})]})})]})}const gr=s=>{switch(s){case"expense":return{icon:we,color:"text-secondary",bg:"bg-secondary/20"};case"investment":return{icon:te,color:"text-primary",bg:"bg-primary/20"};case"product":return{icon:le,color:"text-accent",bg:"bg-accent/20"};default:return{icon:ae,color:"text-dark-brown",bg:"bg-dark-brown/20"}}};function jr({activities:s}){return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Recent Activity"}),e.jsxs("button",{className:"text-sm font-semibold text-primary hover:text-sage transition-colors duration-300 flex items-center gap-1",children:["View All",e.jsx(ss,{className:"w-4 h-4"})]})]}),s.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-dark-brown/50",children:"No recent activity"})}):e.jsx("div",{className:"space-y-4",children:s.map(l=>{const{icon:h,color:b,bg:c}=gr(l.activity_type),n=ts(new Date(l.created_at),{addSuffix:!0});return e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-cream/30 rounded-xl hover:bg-cream/50 transition-all duration-300",children:[e.jsx("div",{className:`w-10 h-10 ${c} rounded-full flex items-center justify-center flex-shrink-0`,children:e.jsx(h,{className:`w-5 h-5 ${b}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-dark-brown leading-relaxed mb-1",children:l.description}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:n})]})]},l.id)})})]})}function yr(){const{user:s}=H(),[l,h]=i.useState({totalInvestments:0,totalExpenses:0,activeProducts:0}),[b,c]=i.useState([]),[n,a]=i.useState(!0),o=R(new Date,"EEEE, MMMM d, yyyy"),u=[{month:"Jul",investments:85e3,expenses:52e3},{month:"Aug",investments:92e3,expenses:61e3},{month:"Sep",investments:78e3,expenses:48e3},{month:"Oct",investments:105e3,expenses:72e3},{month:"Nov",investments:118e3,expenses:68e3},{month:"Dec",investments:125e3,expenses:75e3}],m=[{name:"Raw Materials",value:125e3},{name:"Labor",value:85e3},{name:"Marketing",value:42e3},{name:"Packaging",value:38e3},{name:"Utilities",value:28e3},{name:"Other",value:22e3}];i.useEffect(()=>{t()},[s]);const t=async()=>{if(s)try{const[r,v,f,j]=await Promise.all([C.from("investments").select("amount"),C.from("expenses").select("amount"),C.from("products").select("id, current_stage").in("current_stage",["idea","research","formula","testing","packaging","printing","production","ready"]),C.from("activity_log").select("*").order("created_at",{ascending:!1}).limit(10)]),_=r.data?.reduce((w,y)=>w+parseFloat(y.amount.toString()),0)||0,N=v.data?.reduce((w,y)=>w+parseFloat(y.amount.toString()),0)||0;h({totalInvestments:_,totalExpenses:N,activeProducts:f.data?.length||0}),c(j.data||[])}catch(r){console.error("Error fetching dashboard data:",r)}finally{a(!1)}},x=l.totalInvestments-l.totalExpenses;return e.jsx("div",{className:"page-transition",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"dashboard-hero",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"greeting",children:["Namaste, ",e.jsx("span",{className:"greeting-accent",children:s?.name||"User"})]}),e.jsx("p",{className:"date-time mt-1",children:o}),s?.role==="admin"&&e.jsxs("div",{className:"role-badge",children:[e.jsx(He,{className:"w-3 h-3"}),e.jsx("span",{children:"Admin"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[#6B7280] text-[0.6875rem] uppercase tracking-wider font-medium mb-1",children:"Net Balance"}),e.jsxs("p",{className:`text-2xl md:text-[1.875rem] font-semibold ${x>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",x.toLocaleString("en-IN")]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-6 stagger-container",children:[e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Investments"}),e.jsxs("div",{className:"number",children:["â‚¹",(l.totalInvestments/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend positive mt-2",children:[e.jsx("span",{children:"â†‘"}),e.jsx("span",{children:"12%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"this month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Expenses"}),e.jsxs("div",{className:"number",children:["â‚¹",(l.totalExpenses/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend negative mt-2",children:[e.jsx("span",{children:"â†“"}),e.jsx("span",{children:"8%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"vs last month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Net Balance"}),e.jsxs("div",{className:`number ${x>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",(Math.abs(x)/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:`trend mt-2 ${x>=0?"positive":"negative"}`,children:[e.jsx("span",{children:x>=0?"â†‘":"â†“"}),e.jsx("span",{children:x>=0?"Positive":"Negative"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Active Products"}),e.jsx("div",{className:"number",children:l.activeProducts}),e.jsxs("div",{className:"trend mt-2 text-[#2D5016]",children:[e.jsx("span",{children:"â—"}),e.jsx("span",{children:"In Pipeline"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(ea,{data:u}),e.jsx(ta,{data:m})]}),e.jsx(jr,{activities:b})]})})}function _t({title:s,value:l,trend:h,icon:b,iconBgColor:c,iconColor:n,valueColor:a="text-dark-brown"}){const o=h&&h.value>=0;return e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 hover:scale-[1.02] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-0 group-hover:opacity-5 transition-opacity duration-300"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 ${c} rounded-full flex items-center justify-center`,children:e.jsx(b,{className:`w-6 h-6 ${n}`})}),h&&e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full ${o?"bg-sage/20":"bg-soft-red/20"}`,children:[o?e.jsx(te,{className:"w-3 h-3 text-sage"}):e.jsx(we,{className:"w-3 h-3 text-soft-red"}),e.jsxs("span",{className:`text-xs font-semibold ${o?"text-sage":"text-soft-red"}`,children:[Math.abs(h.value),"%"]})]})]}),e.jsx("h3",{className:"text-sm font-medium text-dark-brown/60 mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold ${a} mb-1`,children:l}),h&&e.jsx("p",{className:"text-xs text-dark-brown/50",children:h.label})]})]})}function wr(){const{user:s}=H(),[l,h]=i.useState({total:0,thisMonth:0,lastMonth:0,byCategory:[]}),[b,c]=i.useState({total:0,thisMonth:0,count:0}),[n,a]=i.useState(!0);i.useEffect(()=>{o()},[s?.id]);const o=async()=>{if(s?.id)try{const m=new Date,t=new Date(m.getFullYear(),m.getMonth(),1),x=new Date(m.getFullYear(),m.getMonth()-1,1),r=new Date(m.getFullYear(),m.getMonth(),0),{data:v,error:f}=await C.from("expenses").select("*").eq("user_id",s.id).eq("status","approved").order("expense_date",{ascending:!1});if(f)throw f;const j=v?.filter(d=>new Date(d.expense_date)>=t)||[],_=v?.filter(d=>new Date(d.expense_date)>=x&&new Date(d.expense_date)<=r)||[],N=v?.reduce((d,k)=>(d[k.category]=(d[k.category]||0)+parseFloat(k.amount),d),{})||{};h({total:v?.reduce((d,k)=>d+parseFloat(k.amount),0)||0,thisMonth:j.reduce((d,k)=>d+parseFloat(k.amount),0),lastMonth:_.reduce((d,k)=>d+parseFloat(k.amount),0),byCategory:Object.entries(N).map(([d,k])=>({category:d,total:k}))});const{data:w,error:y}=await C.from("investments").select("*").order("investment_date",{ascending:!1});y&&console.error("Error fetching investments:",y);const p=w?.filter(d=>new Date(d.investment_date)>=t)||[];c({total:w?.reduce((d,k)=>d+parseFloat(k.amount),0)||0,thisMonth:p.reduce((d,k)=>d+parseFloat(k.amount),0),count:w?.length||0})}catch(m){console.error("Error fetching financial data:",m)}finally{a(!1)}},u=l.lastMonth>0?(l.thisMonth-l.lastMonth)/l.lastMonth*100:0;return n?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 page-transition",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx(Re,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"Finance Overview"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Expense and investment analytics"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(_t,{title:"Total Expenses",value:`â‚¹${l.total.toLocaleString()}`,icon:Pt,trend:u>0?"up":u<0?"down":void 0,trendValue:u!==0?`${Math.abs(u).toFixed(1)}% vs last month`:void 0,iconColor:"bg-gradient-to-br from-red-500 to-pink-600"}),e.jsx(_t,{title:"This Month",value:`â‚¹${l.thisMonth.toLocaleString()}`,icon:De,iconColor:"bg-gradient-to-br from-blue-500 to-cyan-600"}),e.jsx(_t,{title:"Investments",value:`â‚¹${b.total.toLocaleString()}`,icon:Ba,trendValue:b.count>0?`${b.count} total`:void 0,iconColor:"bg-gradient-to-br from-green-500 to-emerald-600"}),e.jsx(_t,{title:"Net Balance",value:`â‚¹${(b.total-l.total).toLocaleString()}`,icon:te,trend:b.total>l.total?"up":"down",iconColor:"bg-gradient-gold"})]}),l.byCategory.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(Pt,{className:"w-5 h-5"}),"Expense by Category"]}),e.jsx(ta,{data:l.byCategory.map(m=>({name:m.category,value:m.total}))})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Expenses vs Investments"]}),e.jsx(ea,{data:[{month:"Last Month",investments:b.total-b.thisMonth,expenses:l.lastMonth},{month:"This Month",investments:b.thisMonth,expenses:l.thisMonth}]})]})]})]})}const ks=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],Nr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function vr(){const{user:s}=H(),l=ce(),[h,b]=i.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[c,n]=i.useState(null),[a,o]=i.useState(""),[u,m]=i.useState([]),[t,x]=i.useState([]),[r,v]=i.useState(!1),[f,j]=i.useState({}),[_,N]=i.useState(!1),[w,y]=i.useState(0);i.useEffect(()=>{p(),d()},[]);const p=async()=>{try{const{data:D,error:I}=await C.from("vendors").select("id, name").order("name");if(I)throw I;m(D||[])}catch(D){console.error("Error fetching vendors:",D)}},d=async()=>{try{const{data:D,error:I}=await C.from("users").select("id, name").order("name");if(I)throw I;x(D||[])}catch(D){console.error("Error fetching partners:",D)}},k=D=>{const I=D.target.files?.[0];if(I){if(I.size>5*1024*1024){j({...f,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes(I.type)){j({...f,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(n(I),j({...f,bill:""}),I.type.startsWith("image/")){const q=new FileReader;q.onloadend=()=>{o(q.result)},q.readAsDataURL(I)}else o("")}},g=()=>{const D={};return h.category||(D.category="Category is required"),(!h.amount||parseFloat(h.amount)<=0)&&(D.amount="Amount must be greater than 0"),h.date||(D.date="Date is required"),h.paymentMode||(D.paymentMode="Payment mode is required"),h.paidBy||(D.paidBy="Please select who paid"),j(D),Object.keys(D).length===0},M=async()=>{if(!c||!s)return null;try{const D=c.name.split(".").pop(),I=`${s.id}/${Date.now()}.${D}`,{error:q}=await C.storage.from("expense-bills").upload(I,c);if(q)throw q;const{data:B}=C.storage.from("expense-bills").getPublicUrl(I);return B.publicUrl}catch(D){return console.error("Error uploading bill:",D),null}},E=async(D="pending")=>{if(!(D==="pending"&&!g())){v(!0);try{let I=null;c&&(I=await M());const q={user_id:s?.id,category:h.category,subcategory:h.subcategory||null,amount:parseFloat(h.amount),expense_date:h.date,payment_mode:h.paymentMode,paid_by:h.paidBy,vendor_id:h.vendorId||null,bill_url:I,purpose:h.purpose||null,status:D==="draft"?"draft":"pending",submitted_by:s?.id,submitted_at:new Date().toISOString()},{error:B}=await C.from("expenses").insert(q);if(B)throw B;if(D!=="draft"){const G=ks.find(se=>se.value===h.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense",description:`${s?.name} added expense: â‚¹${parseFloat(h.amount).toLocaleString("en-IN")} for ${G?.label||h.category}`})}N(!0),setTimeout(()=>{l("/expenses")},2e3)}catch(I){console.error("Error submitting expense:",I),j({submit:"Failed to submit expense. Please try again."})}finally{v(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Add New Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Submit an expense for approval"})]}),_&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx(qt,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense submitted for approval!"})]}),f.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:f.submit})]}),e.jsx("form",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:h.category,onChange:D=>b({...h,category:D.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${f.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),ks.map(D=>e.jsxs("option",{value:D.value,children:[D.icon," ",D.label]},D.value))]}),f.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:f.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:h.subcategory,onChange:D=>b({...h,subcategory:D.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:h.amount,onChange:D=>b({...h,amount:D.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${f.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),f.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:f.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:h.date,onChange:D=>b({...h,date:D.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${f.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),f.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:f.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:h.paidBy,onChange:D=>b({...h,paidBy:D.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${f.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),t.map(D=>e.jsx("option",{value:D.id,children:D.name},D.id))]}),f.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:f.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Nr.map(D=>e.jsxs("button",{type:"button",onClick:()=>b({...h,paymentMode:D.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${h.paymentMode===D.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:D.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:D.label})]},D.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:h.vendorId,onChange:D=>b({...h,vendorId:D.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),u.map(D=>e.jsx("option",{value:D.id,children:D.name},D.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:k,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:c?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[a&&e.jsx("img",{src:a,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:c.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(c.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:D=>{D.preventDefault(),n(null),o("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(re,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),f.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:f.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[w,"/500"]})]}),e.jsx("textarea",{value:h.purpose,onChange:D=>{D.target.value.length<=500&&(b({...h,purpose:D.target.value}),y(D.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>E("pending"),disabled:r,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-5 h-5 animate-spin"}),"Submitting..."]}):"Submit for Approval"}),e.jsx("button",{type:"button",onClick:()=>E("draft"),disabled:r,className:"px-8 py-4 bg-transparent text-primary font-semibold rounded-xl border-2 border-primary hover:bg-primary hover:text-cream transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save as Draft"}),e.jsx("button",{type:"button",onClick:()=>l("/expenses"),disabled:r,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]})}const _s=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],kr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function _r(){const{user:s}=H(),l=ce(),{id:h}=Je(),b=s?.role==="admin",[c,n]=i.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[a,o]=i.useState(null),[u,m]=i.useState(""),[t,x]=i.useState(""),[r,v]=i.useState([]),[f,j]=i.useState([]),[_,N]=i.useState(!1),[w,y]=i.useState(!0),[p,d]=i.useState({}),[k,g]=i.useState(!1),[M,E]=i.useState(0);i.useEffect(()=>{if(!b){l("/expenses");return}D(),I(),q()},[h,b]);const D=async()=>{if(h)try{const{data:S,error:$}=await C.from("expenses").select("*").eq("id",h).maybeSingle();if($)throw $;S&&(n({category:S.category,subcategory:S.subcategory||"",amount:S.amount.toString(),date:S.expense_date,paymentMode:S.payment_mode,paidBy:S.paid_by,vendorId:S.vendor_id||"",purpose:S.purpose||""}),E(S.purpose?.length||0),x(S.bill_url||""))}catch(S){console.error("Error fetching expense:",S),alert("Failed to load expense. Redirecting to expense list."),l("/expenses")}finally{y(!1)}},I=async()=>{try{const{data:S,error:$}=await C.from("vendors").select("id, name").order("name");if($)throw $;v(S||[])}catch(S){console.error("Error fetching vendors:",S)}},q=async()=>{try{const{data:S,error:$}=await C.from("users").select("id, name").order("name");if($)throw $;j(S||[])}catch(S){console.error("Error fetching partners:",S)}},B=S=>{const $=S.target.files?.[0];if($){if($.size>5*1024*1024){d({...p,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes($.type)){d({...p,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(o($),d({...p,bill:""}),$.type.startsWith("image/")){const L=new FileReader;L.onloadend=()=>{m(L.result)},L.readAsDataURL($)}else m("")}},G=()=>{const S={};return c.category||(S.category="Category is required"),(!c.amount||parseFloat(c.amount)<=0)&&(S.amount="Amount must be greater than 0"),c.date||(S.date="Date is required"),c.paymentMode||(S.paymentMode="Payment mode is required"),c.paidBy||(S.paidBy="Please select who paid"),d(S),Object.keys(S).length===0},se=async()=>{if(!a||!s)return null;try{const S=a.name.split(".").pop(),$=`${s.id}/${Date.now()}.${S}`,{error:L}=await C.storage.from("expense-bills").upload($,a);if(L)throw L;const{data:V}=C.storage.from("expense-bills").getPublicUrl($);return V.publicUrl}catch(S){return console.error("Error uploading bill:",S),null}},ee=async S=>{if(S.preventDefault(),!!G()){N(!0);try{let $=t;if(a){const z=await se();z&&($=z)}const L={category:c.category,subcategory:c.subcategory||null,amount:parseFloat(c.amount),expense_date:c.date,payment_mode:c.paymentMode,paid_by:c.paidBy,vendor_id:c.vendorId||null,bill_url:$,purpose:c.purpose||null},{error:V}=await C.from("expenses").update(L).eq("id",h);if(V)throw V;const T=_s.find(z=>z.value===c.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense_updated",description:`${s?.name} updated expense: â‚¹${parseFloat(c.amount).toLocaleString("en-IN")} for ${T?.label||c.category}`}),g(!0),setTimeout(()=>{l("/expenses")},2e3)}catch($){console.error("Error updating expense:",$),d({submit:"Failed to update expense. Please try again."})}finally{N(!1)}}};return b?w?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})}):e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>l("/expenses"),className:"flex items-center gap-2 text-primary hover:text-primary/80 font-medium mb-4 transition-colors",children:[e.jsx(Be,{className:"w-4 h-4"}),"Back to Expenses"]}),e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Edit Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Update expense details"})]}),k&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx(qt,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense updated successfully!"})]}),p.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:p.submit})]}),e.jsx("form",{onSubmit:ee,className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:c.category,onChange:S=>n({...c,category:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${p.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),_s.map(S=>e.jsxs("option",{value:S.value,children:[S.icon," ",S.label]},S.value))]}),p.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:p.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:c.subcategory,onChange:S=>n({...c,subcategory:S.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:c.amount,onChange:S=>n({...c,amount:S.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${p.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),p.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:p.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:c.date,onChange:S=>n({...c,date:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${p.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),p.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:p.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:c.paidBy,onChange:S=>n({...c,paidBy:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${p.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),f.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]}),p.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:p.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:kr.map(S=>e.jsxs("button",{type:"button",onClick:()=>n({...c,paymentMode:S.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${c.paymentMode===S.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:S.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:S.label})]},S.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:c.vendorId,onChange:S=>n({...c,vendorId:S.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),r.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload"}),t&&!a&&e.jsx("div",{className:"mb-4 p-4 bg-sage/5 border-2 border-sage/20 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:"ðŸ“„"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"Current Bill"}),e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline",children:"View existing bill"})]})]}),e.jsx("button",{type:"button",onClick:()=>x(""),className:"text-xs text-soft-red hover:underline",children:"Remove"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:B,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:a?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[u&&e.jsx("img",{src:u,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:a.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(a.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:S=>{S.preventDefault(),o(null),m("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(re,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:t?"Upload new bill to replace existing":"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),p.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:p.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[M,"/500"]})]}),e.jsx("textarea",{value:c.purpose,onChange:S=>{S.target.value.length<=500&&(n({...c,purpose:S.target.value}),E(S.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"submit",disabled:_,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-5 h-5 animate-spin"}),"Updating..."]}):"Update Expense"}),e.jsx("button",{type:"button",onClick:()=>l("/expenses"),disabled:_,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]}):null}const Cr=["Duplicate entry","Insufficient proof","Incorrect amount","Wrong category","Not a business expense","Missing receipt","Other (specify below)"];function sa({isOpen:s,onClose:l,onConfirm:h,type:b,expense:c,loading:n=!1}){const[a,o]=i.useState(""),[u,m]=i.useState(""),[t,x]=i.useState("");if(!s)return null;const r=()=>{if(b==="reject"){const f=u==="Other (specify below)"?t:u;if(!f.trim()){alert("Please provide a reason for rejection");return}h(void 0,f)}else h(a)},v=f=>f.split("_").map(j=>j.charAt(0).toUpperCase()+j.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:`p-6 border-b-2 ${b==="approve"?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[b==="approve"?e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-green-600"})}):e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Me,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-gray-900",children:b==="approve"?"Approve Expense":"Reject Expense"}),e.jsx("p",{className:"text-sm text-gray-600",children:b==="approve"?"Confirm approval of this expense":"Please provide a reason"})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(re,{className:"w-5 h-5 text-gray-600"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"Expense Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[v(c.category),c.subcategory&&` - ${c.subcategory}`]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-orange-600 text-xl",children:["â‚¹",c.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Date(c.expense_date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment:"}),e.jsx("span",{className:"font-semibold text-gray-900 uppercase",children:c.payment_mode.replace("_"," ")})]})]})]}),b==="reject"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Reason for Rejection ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:u,onChange:f=>m(f.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select a reason"}),Cr.map(f=>e.jsx("option",{value:f,children:f},f))]})]}),u==="Other (specify below)"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Specify Reason"}),e.jsx("textarea",{value:t,onChange:f=>x(f.target.value),placeholder:"Please provide detailed reason...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(fe,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:"The submitter will be notified of this rejection and the reason provided."})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Comments (Optional)"}),e.jsx("textarea",{value:a,onChange:f=>o(f.target.value),placeholder:"Add any comments or notes...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:l,disabled:n,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 font-bold rounded-xl hover:bg-gray-50 transition-all duration-300 disabled:opacity-50 shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:r,disabled:n,className:`flex-1 px-6 py-3 font-bold rounded-xl shadow-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${b==="approve"?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white":"bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white"}`,children:n?"Processing...":b==="approve"?"Confirm Approval":"Confirm Rejection"})]})]})]})]})}function Sr({isOpen:s,onClose:l,billUrl:h,expenseDetails:b}){const[c,n]=i.useState(100),[a,o]=i.useState(0);if(!s)return null;const u=h.toLowerCase().endsWith(".pdf"),m=()=>{window.open(h,"_blank")},t=()=>{n(f=>Math.min(f+25,200))},x=()=>{n(f=>Math.max(f-25,50))},r=()=>{o(f=>(f+90)%360)},v=f=>f.split("_").map(j=>j.charAt(0).toUpperCase()+j.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-dark-brown/90 backdrop-blur-md",children:[e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between",children:[e.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-xl px-4 py-3 shadow-soft",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:v(b.category)})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"font-bold text-secondary",children:["â‚¹",b.amount.toLocaleString("en-IN")]})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:new Date(b.date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!u&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:x,disabled:c<=50,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(rr,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"px-4 py-3 bg-white/90 backdrop-blur-sm rounded-lg shadow-soft",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[c,"%"]})}),e.jsx("button",{onClick:t,disabled:c>=200,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(ar,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("button",{onClick:r,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 shadow-soft",children:e.jsx(Wa,{className:"w-5 h-5 text-dark-brown"})})]}),e.jsx("button",{onClick:m,className:"p-3 bg-primary/90 backdrop-blur-sm rounded-lg hover:bg-primary transition-all duration-300 shadow-soft",children:e.jsx(ke,{className:"w-5 h-5 text-cream"})}),e.jsx("button",{onClick:l,className:"p-3 bg-soft-red/90 backdrop-blur-sm rounded-lg hover:bg-soft-red transition-all duration-300 shadow-soft",children:e.jsx(re,{className:"w-5 h-5 text-white"})})]})]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-24 overflow-auto",children:u?e.jsx("iframe",{src:h,className:"w-full h-full bg-white rounded-xl shadow-soft-lg",title:"Bill PDF"}):e.jsx("img",{src:h,alt:"Bill",className:"max-w-full max-h-full object-contain rounded-xl shadow-soft-lg transition-transform duration-300",style:{transform:`scale(${c/100}) rotate(${a}deg)`}})})]})}const it=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20 text-sage"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-accent/20 text-accent"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-dark-brown/20 text-dark-brown"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš",color:"bg-primary/20 text-primary"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢",color:"bg-secondary/20 text-secondary"},{value:"lab_testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-sage/30 text-sage"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ",color:"bg-accent/30 text-accent"},{value:"utilities",label:"Utilities",icon:"âš¡",color:"bg-primary/30 text-primary"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢",color:"bg-dark-brown/30 text-dark-brown"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥",color:"bg-secondary/30 text-secondary"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§",color:"bg-sage/40 text-sage"},{value:"other",label:"Other",icon:"ðŸ“±",color:"bg-dark-brown/40 text-dark-brown"}];function Dr(){const{user:s}=H(),l=ce(),[h,b]=i.useState([]),[c,n]=i.useState(!0),[a,o]=i.useState(""),[u,m]=i.useState("all"),[t,x]=i.useState(null),[r,v]=i.useState(!1),[f,j]=i.useState("approve"),[_,N]=i.useState(!1),[w,y]=i.useState(null),[p,d]=i.useState(1),[k,g]=i.useState(20),[M,E]=i.useState(null),[D,I]=i.useState(!1),[q,B]=i.useState(""),[G,se]=i.useState(""),[ee,S]=i.useState([]),[$,L]=i.useState([]),[V,T]=i.useState("expense_date"),[z,ie]=i.useState("desc"),me=s?.role==="admin";i.useEffect(()=>{_e();const P=C.channel("expenses-changes").on("postgres_changes",{event:"*",schema:"public",table:"expenses"},()=>{_e()}).subscribe();return()=>{C.removeChannel(P)}},[]);const _e=async()=>{if(s)try{let P=C.from("expenses").select(`
          *,
          users_paid_by:users!expenses_paid_by_fkey(name),
          users_submitted_by:users!expenses_submitted_by_fkey(name),
          users_approved_by:users!expenses_approved_by_fkey(name),
          vendors(name)
        `);me||(P=P.eq("submitted_by",s.id));const{data:O,error:W}=await P.order(V,{ascending:z==="asc"});if(W)throw W;b(O||[])}catch(P){console.error("Error fetching expenses:",P)}finally{n(!1)}},jt=P=>{x(P),j("approve"),v(!0)},Ce=P=>{x(P),j("reject"),v(!0)},We=async(P,O)=>{if(!(!t||!s)){E(t.id);try{const W={status:f==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};f==="approve"&&P?W.approval_comments=P:f==="reject"&&O&&(W.rejection_reason=O);const{error:Nt}=await C.from("expenses").update(W).eq("id",t.id);if(Nt)throw Nt;const Ot=it.find(Qe=>Qe.value===t.category);await C.from("activity_log").insert({user_id:s.id,activity_type:f==="approve"?"expense_approved":"expense_rejected",description:`${s.name} ${f==="approve"?"approved":"rejected"} expense: â‚¹${t.amount.toLocaleString("en-IN")} for ${Ot?.label||t.category}`}),await _e(),v(!1),x(null)}catch(W){console.error("Error processing approval:",W),alert("Failed to process approval. Please try again.")}finally{E(null)}}},Xe=async P=>{if(confirm("Are you sure you want to delete this expense? This action cannot be undone."))try{const{error:O}=await C.from("expenses").delete().eq("id",P);if(O)throw O;await _e()}catch(O){console.error("Error deleting expense:",O),alert("Failed to delete expense. Please try again.")}},yt=P=>{P.bill_url&&(x(P),N(!0),C.from("expenses").update({viewed_bill:!0}).eq("id",P.id).then())},et=P=>{switch(P){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},Ee=P=>it.find(O=>O.value===P)||it[it.length-1],Ae=h.filter(P=>{if(u==="pending"&&P.status!=="pending"||u==="approved"&&P.status!=="approved"||u==="rejected"&&P.status!=="rejected"||u==="my_expenses"&&P.submitted_by!==s?.id)return!1;if(a){const O=a.toLowerCase();if(!P.category.toLowerCase().includes(O)&&!P.subcategory?.toLowerCase().includes(O)&&!P.purpose?.toLowerCase().includes(O)&&!P.vendors?.name.toLowerCase().includes(O))return!1}return!(q&&P.expense_date<q||G&&P.expense_date>G||ee.length>0&&!ee.includes(P.category)||$.length>0&&!$.includes(P.payment_mode))}),wt=Ae.slice((p-1)*k,p*k),Ie=Math.ceil(Ae.length/k),Rt=P=>P==="all"?h.length:P==="pending"?h.filter(O=>O.status==="pending").length:P==="approved"?h.filter(O=>O.status==="approved").length:P==="rejected"?h.filter(O=>O.status==="rejected").length:P==="my_expenses"?h.filter(O=>O.submitted_by===s?.id).length:0,Ut=h.filter(P=>{const O=new Date(P.expense_date),W=new Date;return O.getMonth()===W.getMonth()&&O.getFullYear()===W.getFullYear()}).reduce((P,O)=>P+O.amount,0),zt=P=>{S(O=>O.includes(P)?O.filter(W=>W!==P):[...O,P])},Bt=P=>{L(O=>O.includes(P)?O.filter(W=>W!==P):[...O,P])},tt=()=>{o(""),B(""),se(""),S([]),L([]),m("all")},Ge=P=>{V===P?ie(O=>O==="asc"?"desc":"asc"):(T(P),ie("desc"))};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Expense Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Manage and approve all expenses"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",Ut.toLocaleString("en-IN")]})]}),e.jsxs("button",{onClick:()=>l("/expenses/add"),className:"flex items-center gap-2 px-6 py-3 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Expense"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 mb-6",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 mt-2 overflow-x-auto pb-6 pt-2 scrollbar-thin",children:["all","pending","approved","rejected","my_expenses"].map(P=>e.jsxs("button",{onClick:()=>m(P),className:`px-4 py-2 rounded-lg font-medium whitespace-nowrap transition-all duration-300 flex items-center gap-2 ${u===P?"bg-primary text-cream shadow-soft":"bg-cream/50 text-dark-brown hover:bg-primary/10"}`,children:[P==="all"&&"All",P==="pending"&&"â³ Pending",P==="approved"&&"âœ… Approved",P==="rejected"&&"âŒ Rejected",P==="my_expenses"&&"My Expenses",e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${u===P?"bg-cream/20 text-cream":"bg-dark-brown/10 text-dark-brown"}`,children:Rt(P)})]},P))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search by category, vendor, or purpose...",value:a,onChange:P=>o(P.target.value),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsxs("button",{onClick:()=>I(!D),className:`flex items-center gap-2 px-6 py-3 border-2 font-semibold rounded-xl transition-all duration-300 ${D||ee.length>0||$.length>0||q||G?"border-primary bg-primary text-cream":"border-primary text-primary hover:bg-primary hover:text-cream"}`,children:[e.jsx(Bs,{className:"w-5 h-5"}),"Filters",ee.length+$.length+(q?1:0)+(G?1:0)>0&&e.jsx("span",{className:"px-2 py-0.5 bg-cream/20 rounded-full text-xs font-bold",children:ee.length+$.length+(q?1:0)+(G?1:0)})]}),e.jsxs("button",{onClick:()=>alert("Export feature coming soon"),className:"flex items-center gap-2 px-6 py-3 border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export"]})]}),D&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:q,onChange:P=>B(P.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:G,onChange:P=>se(P.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:it.map(P=>e.jsxs("button",{onClick:()=>zt(P.value),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${ee.includes(P.value)?P.color:"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:[P.icon," ",P.label]},P.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Mode"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["cash","upi","bank_transfer","card"].map(P=>e.jsx("button",{onClick:()=>Bt(P),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${$.includes(P)?"bg-primary text-cream":"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:P.toUpperCase().replace("_"," ")},P))})]}),e.jsx("button",{onClick:tt,className:"w-full py-2 text-soft-red font-semibold hover:bg-soft-red/10 rounded-lg transition-all",children:"Reset All Filters"})]})]})]}),c?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading expenses..."})}):Ae.length===0?e.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No expenses found"}),e.jsxs("button",{onClick:()=>l("/expenses/add"),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-white font-semibold rounded-xl hover:scale-105 transition-all duration-300",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Your First Expense"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-primary/10",children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>Ge("expense_date"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Date ",V==="expense_date"&&(z==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsxs("th",{onClick:()=>Ge("amount"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Amount ",V==="amount"&&(z==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Payment"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Bill"}),e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:wt.map((P,O)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{onClick:()=>y(w===P.id?null:P.id),className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors cursor-pointer ${O%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:R(new Date(P.expense_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Ee(P.category).color}`,children:[Ee(P.category).icon," ",Ee(P.category).label]})}),P.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1",children:P.subcategory})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",P.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:P.users_paid_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-xs font-semibold text-dark-brown uppercase",children:P.payment_mode.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-4",children:et(P.status)}),e.jsx("td",{className:"px-4 py-4",children:P.bill_url?e.jsx("button",{onClick:W=>{W.stopPropagation(),yt(P)},className:"p-2 hover:bg-primary/10 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No bill"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[me&&P.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:W=>{W.stopPropagation(),jt(P)},disabled:M===P.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(Y,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:W=>{W.stopPropagation(),Ce(P)},disabled:M===P.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Me,{className:"w-4 h-4 text-soft-red"})})]}),me&&e.jsx("button",{onClick:W=>{W.stopPropagation(),l(`/expenses/edit/${P.id}`)},className:"p-2 hover:bg-accent/10 rounded-lg transition-colors",title:"Edit",children:e.jsx(js,{className:"w-4 h-4 text-accent"})}),me&&e.jsx("button",{onClick:W=>{W.stopPropagation(),Xe(P.id)},className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(oe,{className:"w-4 h-4 text-soft-red"})})]})})]},P.id),w===P.id&&e.jsx("tr",{className:"bg-primary/5",children:e.jsx("td",{colSpan:8,className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-3",children:[P.purpose&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Purpose/Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:P.purpose})]}),P.vendors&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Vendor"}),e.jsx("p",{className:"text-sm text-dark-brown",children:P.vendors.name})]}),P.approval_comments&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-sage mb-1",children:"Approval Comments"}),e.jsx("p",{className:"text-sm text-dark-brown",children:P.approval_comments})]}),P.rejection_reason&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-soft-red mb-1",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-dark-brown",children:P.rejection_reason})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-dark-brown/50",children:[e.jsxs("span",{children:["Submitted by: ",P.users_submitted_by?.name]}),P.users_approved_by&&e.jsxs("span",{children:["Approved by: ",P.users_approved_by.name]})]})]})})})]}))})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:wt.map(P=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 hover:shadow-soft-lg transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Ee(P.category).color}`,children:[Ee(P.category).icon," ",Ee(P.category).label]}),et(P.status)]}),P.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mb-2",children:P.subcategory})]}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",P.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Date:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:R(new Date(P.expense_date),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Paid by:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:P.users_paid_by?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Payment:"}),e.jsx("span",{className:"font-medium text-dark-brown uppercase",children:P.payment_mode.replace("_"," ")})]})]}),P.purpose&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Purpose"}),e.jsx("p",{className:"text-sm text-dark-brown",children:P.purpose})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4 pt-3 border-t border-dark-brown/10",children:[P.bill_url&&e.jsxs("button",{onClick:()=>yt(P),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-primary/10 text-primary font-semibold rounded-lg hover:bg-primary/20 transition-colors",children:[e.jsx(Ue,{className:"w-4 h-4"}),"View Bill"]}),me&&P.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>jt(P),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-sage/10 text-sage font-semibold rounded-lg hover:bg-sage/20 transition-colors",children:[e.jsx(Y,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>Ce(P),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red font-semibold rounded-lg hover:bg-soft-red/20 transition-colors",children:[e.jsx(Me,{className:"w-4 h-4"}),"Reject"]})]}),me&&e.jsxs("button",{onClick:()=>l(`/expenses/edit/${P.id}`),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-accent/10 text-accent font-semibold rounded-lg hover:bg-accent/20 transition-colors",children:[e.jsx(js,{className:"w-4 h-4"}),"Edit"]})]})]},P.id))}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 mt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Items per page:"}),e.jsxs("select",{value:k,onChange:P=>{g(Number(P.target.value)),d(1)},className:"px-3 py-1 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsxs("span",{className:"text-sm text-dark-brown/70",children:["Showing ",(p-1)*k+1," - ",Math.min(p*k,Ae.length)," of ",Ae.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(P=>Math.max(1,P-1)),disabled:p===1,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ea,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,Ie)},(P,O)=>{let W;return Ie<=5||p<=3?W=O+1:p>=Ie-2?W=Ie-4+O:W=p-2+O,e.jsx("button",{onClick:()=>d(W),className:`w-10 h-10 rounded-lg font-semibold transition-all ${p===W?"bg-primary text-cream":"border-2 border-dark-brown/10 text-dark-brown hover:bg-primary/10"}`,children:W},W)})}),e.jsx("button",{onClick:()=>d(P=>Math.min(Ie,P+1)),disabled:p===Ie,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Us,{className:"w-5 h-5 text-dark-brown"})})]})]})})]})]})}),r&&t&&e.jsx(sa,{isOpen:r,onClose:()=>{v(!1),x(null)},onConfirm:We,type:f,expense:t,loading:M===t.id}),_&&t&&t.bill_url&&e.jsx(Sr,{isOpen:_,onClose:()=>{N(!1),x(null)},billUrl:t.bill_url,expenseDetails:{category:t.category,amount:t.amount,date:t.expense_date}})]})}function Mr({expenses:s,investments:l,vendors:h}){const b=s.filter(k=>k.status==="approved"),c=l.filter(k=>k.status==="approved"),n=b.reduce((k,g)=>k+g.amount,0),a=c.reduce((k,g)=>k+g.amount,0),o=a-n,u=a>0?o/a*100:0,m={};for(let k=11;k>=0;k--){const g=xt(new Date,k),M=R(g,"yyyy-MM"),E=R(g,"MMM yyyy");m[M]={month:E,investments:0,expenses:0,net:0}}c.forEach(k=>{const g=R(new Date(k.investment_date),"yyyy-MM");m[g]&&(m[g].investments+=k.amount)}),b.forEach(k=>{const g=R(new Date(k.expense_date),"yyyy-MM");m[g]&&(m[g].expenses+=k.amount)});const t=Object.values(m).map(k=>({...k,net:k.investments-k.expenses})),x=b.length>0?n/Object.keys(m).length:0,r=b.reduce((k,g)=>(k[g.category]||(k[g.category]=0),k[g.category]+=g.amount,k),{}),v=Object.entries(r).sort((k,g)=>g[1]-k[1])[0],f=b.reduce((k,g)=>{const M=g.paid_by||g.user_id;return k[M]||(k[M]={name:g.users_paid_by?.name||g.users?.name||"Unknown",total:0}),k[M].total+=g.amount,k},{}),j=Object.values(f).sort((k,g)=>g.total-k.total)[0],_=b.length>0?n/b.length:0,N=s.filter(k=>k.status==="pending").length,w=b.reduce((k,g)=>{const M=g.payment_mode||"unknown";return k[M]=(k[M]||0)+1,k},{}),y=Object.entries(w).sort((k,g)=>g[1]-k[1])[0],p=t.reduce((k,g)=>g.expenses>k.expenses?g:k,t[0]||{month:"N/A",expenses:0}),d=k=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[k]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/30 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Investments"})]}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-1",children:["â‚¹",a.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/20 to-secondary/10 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/30 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Expenses"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",n.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Spent"})]}),e.jsxs("div",{className:`bg-gradient-to-br rounded-xl p-6 border-2 shadow-soft ${o>=0?"from-accent/20 to-accent/10 border-accent/30":"from-soft-red/20 to-soft-red/10 border-soft-red/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${o>=0?"bg-accent/30":"bg-soft-red/30"}`,children:o>=0?e.jsx(te,{className:"w-6 h-6 text-accent"}):e.jsx(we,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:`text-xs font-semibold uppercase tracking-wide ${o>=0?"text-accent":"text-soft-red"}`,children:"Net Balance"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${o>=0?"text-accent":"text-soft-red"}`,children:["â‚¹",Math.abs(o).toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[u.toFixed(1),"% margin"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/30 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Burn Rate"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary mb-1",children:["â‚¹",x.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Month Avg"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-3xl",children:v?d(v[0]):"ðŸ“Š"}),e.jsx(is,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Category"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1",children:v?v[0]:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",v?v[1].toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:j?j.name.charAt(0):"?"}),e.jsx(je,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Spender"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1 truncate",children:j?j.name:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",j?j.total.toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(pt,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Avg Expense"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",_.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending Approvals"}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:N})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment vs Expense Trend (12 Months)"}),e.jsx(be,{width:"100%",height:400,children:e.jsxs(ba,{data:t,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(qe,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ye,{formatter:k=>`â‚¹${k.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ft,{}),e.jsx(ua,{type:"monotone",dataKey:"net",fill:"#B8860B",fillOpacity:.1,stroke:"none",name:"Net Balance"}),e.jsx($e,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,name:"Investments",dot:{fill:"#2D5016",r:5}}),e.jsx($e,{type:"monotone",dataKey:"expenses",stroke:"#C17817",strokeWidth:3,name:"Expenses",dot:{fill:"#C17817",r:5}})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-accent/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent",children:"Quick Insight"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Highest spending month:"})}),e.jsx("p",{className:"text-lg font-bold text-secondary",children:p.month}),e.jsxs("p",{className:"text-xl font-bold text-accent",children:["â‚¹",p.expenses.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-sage/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(pt,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage",children:"Payment Mode"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Most used:"})}),e.jsx("p",{className:"text-xl font-bold text-secondary uppercase",children:y?y[0]:"N/A"}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[y?y[1]:0," transactions"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-primary/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-sm font-semibold text-primary",children:"Efficiency"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Approval rate:"})}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[s.length>0?(b.length/s.length*100).toFixed(0):0,"%"]})]})]})]})}const Ct=["#C17817","#2D5016","#B8860B","#8B4513","#D4AF37","#CD853F","#DAA520","#A0522D"];function Pr({expenses:s}){const[l,h]=i.useState(null),[b,c]=i.useState("all"),n=s.filter(N=>N.status==="approved"),u=(N=>{if(b==="all")return N;const w=parseInt(b),y=xt(new Date,w);return N.filter(p=>new Date(p.expense_date)>=y)})(n).reduce((N,w)=>{const y=w.category;return N[y]||(N[y]={category:y,total:0,count:0,expenses:[]}),N[y].total+=w.amount,N[y].count+=1,N[y].expenses.push(w),N},{}),m=Object.values(u).sort((N,w)=>w.total-N.total),t=m.reduce((N,w)=>N+w.total,0),x=m.map(N=>({name:N.category,value:N.total})),r=m.map(N=>({category:N.category,amount:N.total})),v=N=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[N]||"ðŸ’°",f=N=>{const w={};for(let p=5;p>=0;p--){const d=xt(new Date,p),k=R(d,"MMM");w[k]=0}return n.filter(p=>p.category===N).forEach(p=>{const d=R(new Date(p.expense_date),"MMM");w[d]!==void 0&&(w[d]+=p.amount)}),Object.entries(w).map(([p,d])=>({month:p,value:d}))},j=N=>{const w=new Date().getMonth(),y=new Date(new Date().setMonth(w-1)).getMonth(),p=n.filter(g=>g.category===N&&new Date(g.expense_date).getMonth()===w).reduce((g,M)=>g+M.amount,0),d=n.filter(g=>g.category===N&&new Date(g.expense_date).getMonth()===y).reduce((g,M)=>g+M.amount,0);if(d===0)return{direction:"neutral",percent:0};const k=(p-d)/d*100;return{direction:k>0?"up":k<0?"down":"neutral",percent:Math.abs(k)}},_=l?u[l]:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4 items-center mb-6",children:e.jsxs("select",{value:b,onChange:N=>c(N.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"1",children:"Last Month"}),e.jsx("option",{value:"3",children:"Last 3 Months"}),e.jsx("option",{value:"6",children:"Last 6 Months"}),e.jsx("option",{value:"12",children:"Last Year"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map((N,w)=>{const y=t>0?N.total/t*100:0,p=N.count>0?N.total/N.count:0,d=j(N.category),k=f(N.category);return e.jsxs("div",{onClick:()=>h(N.category),className:`bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 shadow-soft cursor-pointer transition-all duration-300 hover:shadow-soft-lg hover:scale-[1.02] ${l===N.category?"border-accent ring-2 ring-accent/20":"border-dark-brown/10"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:v(N.category)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary",children:N.category}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[N.count," transactions"]})]})]}),e.jsxs("div",{className:"text-right",children:[d.direction==="up"&&e.jsxs("div",{className:"flex items-center gap-1 text-soft-red text-xs",children:[e.jsx(te,{className:"w-3 h-3"}),d.percent.toFixed(0),"%"]}),d.direction==="down"&&e.jsxs("div",{className:"flex items-center gap-1 text-sage text-xs",children:[e.jsx(we,{className:"w-3 h-3"}),d.percent.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",N.total.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[y.toFixed(1),"% of total expenses"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Average per transaction"}),e.jsxs("p",{className:"text-lg font-semibold text-accent",children:["â‚¹",p.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsx("div",{className:"h-16",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsx(Et,{data:k,children:e.jsx($e,{type:"monotone",dataKey:"value",stroke:Ct[w%Ct.length],strokeWidth:2,dot:!1})})})})]},N.category)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Distribution"}),x.length>0?e.jsx(be,{width:"100%",height:350,children:e.jsxs(At,{children:[e.jsx(It,{data:x,cx:"50%",cy:"50%",labelLine:!1,label:({name:N,percent:w})=>`${N} (${(w*100).toFixed(0)}%)`,outerRadius:120,fill:"#8884d8",dataKey:"value",onClick:N=>h(N.name),children:x.map((N,w)=>e.jsx(Tt,{fill:Ct[w%Ct.length],className:"cursor-pointer hover:opacity-80 transition-opacity"},`cell-${w}`))}),e.jsx(ye,{formatter:N=>`â‚¹${N.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Comparison"}),r.length>0?e.jsx(be,{width:"100%",height:350,children:e.jsxs(Ft,{data:r,layout:"vertical",children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(qe,{dataKey:"category",type:"category",width:120,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(ye,{formatter:N=>`â‚¹${N.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(mt,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0],onClick:N=>h(N.category),className:"cursor-pointer"})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]})]}),_&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-heading text-2xl font-bold text-primary flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:v(_.category)}),_.category," Details"]}),e.jsx("button",{onClick:()=>h(null),className:"px-4 py-2 text-sm font-semibold text-dark-brown hover:bg-dark-brown/5 rounded-lg transition-colors",children:"Clear Selection"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Subcategory"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"})]})}),e.jsx("tbody",{children:_.expenses.sort((N,w)=>new Date(w.expense_date).getTime()-new Date(N.expense_date).getTime()).map((N,w)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${w%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:R(new Date(N.expense_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:N.subcategory||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-lg font-bold text-secondary",children:["â‚¹",N.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:N.users_paid_by?.name||N.users?.name||"Unknown"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:N.vendors?.name||"-"})]},N.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Subtotal:"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-2xl font-bold text-accent",children:["â‚¹",_.total.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:2})]})})]})})]})]})}function Er({expenses:s,investments:l,allUsers:h}){const b=s.filter(j=>j.status==="approved"),c=l.filter(j=>j.status==="approved"),n={};h.forEach(j=>{n[j.id]={id:j.id,name:j.name,totalExpenses:0,totalInvestments:0,expenseCount:0,approvedCount:0,submittedCount:0,paymentModes:{},categories:{}}}),b.forEach(j=>{const _=j.paid_by||j.user_id;if(n[_]){n[_].totalExpenses+=j.amount,n[_].expenseCount+=1,j.status==="approved"&&(n[_].approvedCount+=1);const N=j.payment_mode||"unknown";n[_].paymentModes[N]=(n[_].paymentModes[N]||0)+1;const w=j.category;n[_].categories[w]=(n[_].categories[w]||0)+j.amount}}),s.forEach(j=>{const _=j.submitted_by;_&&n[_]&&(n[_].submittedCount+=1)}),c.forEach(j=>{const _=j.partner_id;n[_]&&(n[_].totalInvestments+=j.amount)});const a=Object.values(n).sort((j,_)=>_.totalInvestments-j.totalInvestments),o=a.map(j=>({name:j.name,Investment:j.totalInvestments,Expense:j.totalExpenses})),u=[...a].filter(j=>j.totalInvestments>0).sort((j,_)=>_.totalInvestments-j.totalInvestments).slice(0,5),m=[...a].filter(j=>j.totalExpenses>0).sort((j,_)=>_.totalExpenses-j.totalExpenses).slice(0,5),t=[...a].filter(j=>j.submittedCount>0).sort((j,_)=>_.approvedCount/_.submittedCount-j.approvedCount/j.submittedCount).slice(0,5),x=j=>j.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),r=j=>{const _=Object.entries(j);return _.length===0?"N/A":_.sort((N,w)=>w[1]-N[1])[0][0].toUpperCase()},v=j=>{const _=Object.entries(j);return _.length===0?"N/A":_.sort((N,w)=>w[1]-N[1])[0][0]},f=j=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[j]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(j=>{const _=j.totalInvestments-j.totalExpenses,N=j.submittedCount>0?j.approvedCount/j.submittedCount*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-lg",children:x(j.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:j.name}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[j.expenseCount," expenses â€¢ ",j.submittedCount," submitted"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-sage/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",j.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",j.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]}),e.jsxs("div",{className:`rounded-lg p-3 mb-4 ${_>=0?"bg-accent/10":"bg-soft-red/10"}`,children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Net Contribution"}),e.jsxs("p",{className:`text-xl font-bold ${_>=0?"text-accent":"text-soft-red"}`,children:[_>=0?"+":"","â‚¹",_.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Approval Rate"]}),e.jsxs("span",{className:"font-semibold text-sage",children:[N.toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4"}),"Payment Mode"]}),e.jsx("span",{className:"font-semibold text-primary",children:r(j.paymentModes)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"Top Category"]}),e.jsxs("span",{className:"font-semibold text-accent",children:[f(v(j.categories))," ",v(j.categories)]})]})]})]},j.id)})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Investment vs Expense Comparison"}),o.length>0?e.jsx(be,{width:"100%",height:400,children:e.jsxs(Ft,{data:o,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx(qe,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ye,{formatter:j=>`â‚¹${j.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ft,{}),e.jsx(mt,{dataKey:"Investment",fill:"#2D5016",radius:[8,8,0,0]}),e.jsx(mt,{dataKey:"Expense",fill:"#C17817",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[400px] flex items-center justify-center text-dark-brown/50",children:"No data available"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Ye,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Top Investors"})]}),e.jsx("div",{className:"space-y-3",children:u.length>0?u.map((j,_)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-accent/40",children:["#",_+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:x(j.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:j.name}),e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",j.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},j.id)):e.jsx("div",{className:"text-center py-8 text-dark-brown/50",children:e.jsx("p",{className:"text-sm",children:"No investments recorded yet"})})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Active Spenders"})]}),e.jsx("div",{className:"space-y-3",children:m.length>0?m.map((j,_)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-secondary/40",children:["#",_+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-secondary to-accent rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:x(j.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:j.name}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",j.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},j.id)):e.jsx("div",{className:"text-center py-8 text-dark-brown/50",children:e.jsx("p",{className:"text-sm",children:"No expenses recorded yet"})})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Best Approval Rate"})]}),e.jsx("div",{className:"space-y-3",children:t.length>0?t.map((j,_)=>{const N=j.approvedCount/j.submittedCount*100;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-sage/40",children:["#",_+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-sage to-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:x(j.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:j.name}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:[N.toFixed(0),"%"]})]})]},j.id)}):e.jsx("div",{className:"text-center py-8 text-dark-brown/50",children:e.jsx("p",{className:"text-sm",children:"No submissions recorded yet"})})})]})]})]})}function Ar({expenses:s,investments:l}){const[h,b]=i.useState(R(new Date,"yyyy-MM")),[c,n]=i.useState(!0),a=new Date(h+"-01"),o=us(a),u=fs(a),m=xt(a,1),t=us(m),x=fs(m),r=s.filter(S=>{const $=new Date(S.expense_date);return $>=o&&$<=u&&S.status==="approved"}),v=l.filter(S=>{const $=new Date(S.investment_date);return $>=o&&$<=u&&S.status==="approved"}),f=s.filter(S=>{const $=new Date(S.expense_date);return $>=t&&$<=x&&S.status==="approved"}),j=l.filter(S=>{const $=new Date(S.investment_date);return $>=t&&$<=x&&S.status==="approved"}),_=r.reduce((S,$)=>S+$.amount,0),N=v.reduce((S,$)=>S+$.amount,0),w=N-_,y=f.reduce((S,$)=>S+$.amount,0),p=j.reduce((S,$)=>S+$.amount,0),d=p-y,k=y>0?(_-y)/y*100:0,g=p>0?(N-p)/p*100:0,M=d!==0?(w-d)/Math.abs(d)*100:0,E=r.reduce((S,$)=>(S[$.category]||(S[$.category]={thisMonth:0,lastMonth:0}),S[$.category].thisMonth+=$.amount,S),{});f.forEach(S=>{E[S.category]||(E[S.category]={thisMonth:0,lastMonth:0}),E[S.category].lastMonth+=S.amount});const D=Object.entries(E).map(([S,$])=>{const L=$.lastMonth>0?($.thisMonth-$.lastMonth)/$.lastMonth*100:0;return{category:S,thisMonth:$.thisMonth,lastMonth:$.lastMonth,change:L,changeAmount:$.thisMonth-$.lastMonth}}).sort((S,$)=>$.thisMonth-S.thisMonth),q=pa({start:o,end:u}).map(S=>{const $=r.filter(z=>Jt(new Date(z.expense_date),S)),L=v.filter(z=>Jt(new Date(z.investment_date),S)),V=$.reduce((z,ie)=>z+ie.amount,0),T=L.reduce((z,ie)=>z+ie.amount,0);return{date:S,expenses:$,investments:L,expenseTotal:V,investmentTotal:T}}),B=[];for(let S=0;S<12;S++){const $=xt(new Date,S);B.push({value:R($,"yyyy-MM"),label:R($,"MMMM yyyy")})}const G=()=>{alert("PDF generation feature coming soon!")},se=()=>{alert("Excel export feature coming soon!")},ee=()=>{alert("Email report feature coming soon!")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("select",{value:h,onChange:S=>b(S.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 font-semibold",children:B.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))}),e.jsx("button",{onClick:()=>b(R(new Date,"yyyy-MM")),className:"px-4 py-2 bg-primary/10 text-primary font-semibold rounded-xl hover:bg-primary/20 transition-colors",children:"Current Month"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:S=>n(S.target.checked),className:"w-4 h-4 rounded border-2 border-accent text-accent focus:ring-accent"}),e.jsx("span",{className:"text-sm font-medium text-dark-brown",children:"Compare with last month"})]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-2xl shadow-soft-lg p-8 border-2 border-accent/30",children:[e.jsx("h3",{className:"font-heading text-4xl font-bold text-primary mb-6",children:R(a,"MMMM yyyy")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Investments"}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-2",children:["â‚¹",N.toLocaleString("en-IN")]}),c&&e.jsxs("div",{className:`flex items-center gap-2 ${g>=0?"text-sage":"text-soft-red"}`,children:[g>=0?e.jsx(te,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[g>=0?"+":"",g.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",_.toLocaleString("en-IN")]}),c&&e.jsxs("div",{className:`flex items-center gap-2 ${k<=0?"text-sage":"text-soft-red"}`,children:[k>=0?e.jsx(te,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[k>=0?"+":"",k.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-xl p-6 ${w>=0?"ring-2 ring-accent":"ring-2 ring-soft-red"}`,children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Net Change"}),e.jsxs("p",{className:`text-3xl font-bold mb-2 ${w>=0?"text-accent":"text-soft-red"}`,children:[w>=0?"+":"","â‚¹",w.toLocaleString("en-IN")]}),c&&e.jsxs("div",{className:`flex items-center gap-2 ${M>=0?"text-sage":"text-soft-red"}`,children:[M>=0?e.jsx(te,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[M>=0?"+":"",M.toFixed(1),"% vs last month"]})]})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"This Month"}),c&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Last Month"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Change"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-dark-brown",children:"Trend"})]})]})}),e.jsx("tbody",{children:D.map((S,$)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${$%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:S.category}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-secondary",children:["â‚¹",S.thisMonth.toLocaleString("en-IN")]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right text-dark-brown",children:["â‚¹",S.lastMonth.toLocaleString("en-IN")]}),e.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${S.changeAmount>=0?"text-soft-red":"text-sage"}`,children:[S.changeAmount>=0?"+":"","â‚¹",S.changeAmount.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${S.change>0?"bg-soft-red/20 text-soft-red":S.change<0?"bg-sage/20 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:[S.change>0&&e.jsx(te,{className:"w-3 h-3"}),S.change<0&&e.jsx(we,{className:"w-3 h-3"}),S.change.toFixed(0),"%"]})})]})]},S.category))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-bold text-dark-brown",children:"Total"}),e.jsxs("td",{className:"px-4 py-3 text-right text-xl font-bold text-accent",children:["â‚¹",_.toLocaleString("en-IN")]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-dark-brown",children:["â‚¹",y.toLocaleString("en-IN")]}),e.jsx("td",{colSpan:2})]})]})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Detailed Daily Breakdown"}),e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Investments"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Expenses"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Net"})]})}),e.jsx("tbody",{children:q.map((S,$)=>{const L=S.investmentTotal-S.expenseTotal;return S.expenses.length>0||S.investments.length>0?e.jsxs("tr",{className:`border-b border-dark-brown/5 ${$%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:R(S.date,"EEE, MMM d")}),e.jsx("td",{className:"px-4 py-3 text-right text-sage font-semibold",children:S.investmentTotal>0?`â‚¹${S.investmentTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-secondary font-semibold",children:S.expenseTotal>0?`â‚¹${S.expenseTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:`px-4 py-3 text-right font-bold ${L>0?"text-accent":L<0?"text-soft-red":"text-dark-brown"}`,children:L!==0?`${L>0?"+":""}â‚¹${L.toLocaleString("en-IN")}`:"-"})]},S.date.toString()):null})})]})})]}),e.jsxs("div",{className:"bg-cream/50 rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Export Options"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(ae,{className:"w-5 h-5"}),"Download PDF Report"]}),e.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export to Excel"]}),e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-primary text-primary font-semibold rounded-xl hover:bg-primary hover:text-white transition-all duration-300",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Email Report"]})]})]})]})}function Ir({expenses:s,vendors:l}){const b=s.filter(x=>x.status==="approved"&&x.vendor_id).reduce((x,r)=>{const v=r.vendor_id,f=r.vendors;if(!f)return x;x[v]||(x[v]={id:v,name:f.name,category:f.category,totalSpent:0,transactionCount:0,lastTransactionDate:r.expense_date,transactions:[],categories:{}}),x[v].totalSpent+=r.amount,x[v].transactionCount+=1,x[v].transactions.push(r),new Date(r.expense_date)>new Date(x[v].lastTransactionDate)&&(x[v].lastTransactionDate=r.expense_date);const j=r.category;return x[v].categories[j]=(x[v].categories[j]||0)+r.amount,x},{}),c=Object.values(b).sort((x,r)=>r.totalSpent-x.totalSpent),a=c.slice(0,10).map(x=>({name:x.name,amount:x.totalSpent})),o=x=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[x]||"ðŸ’°",u=x=>x&&{supplier:"ðŸ­",service:"ðŸ”§",contractor:"ðŸ‘·",transport:"ðŸšš",retail:"ðŸª"}[x.toLowerCase()]||"ðŸª",m=x=>X(new Date,new Date(x)),t=c.reduce((x,r)=>x+r.totalSpent,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(x=>{const r=x.transactionCount>0?x.totalSpent/x.transactionCount:0,v=m(x.lastTransactionDate),f=t>0?x.totalSpent/t*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary to-sage rounded-lg flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-3xl",children:u(x.category)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:x.name}),e.jsx("p",{className:"text-xs text-dark-brown/60 capitalize",children:x.category||"General Vendor"})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",x.totalSpent.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[f.toFixed(1),"% of all vendor spending"]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:x.transactionCount})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Avg Transaction"}),e.jsxs("span",{className:"font-bold text-accent",children:["â‚¹",r.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"Last Transaction"]}),e.jsxs("span",{className:`font-semibold ${v>60?"text-soft-red":"text-sage"}`,children:[v," days ago"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-2",children:"Primary Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(x.categories).sort((j,_)=>_[1]-j[1]).slice(0,3).map(([j,_])=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-accent/10 rounded-full text-xs font-semibold text-dark-brown",children:[o(j)," ",j]},j))})]})]},x.id)})}),a.length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Top 10 Vendors by Spending"}),e.jsx(be,{width:"100%",height:400,children:e.jsxs(Ft,{data:a,layout:"vertical",children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(qe,{dataKey:"name",type:"category",width:150,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(ye,{formatter:x=>`â‚¹${x.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(mt,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Js,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Vendors"})]}),e.jsx("p",{className:"text-5xl font-bold text-accent mb-2",children:c.length}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Active vendors with transactions"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Spent"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-2",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Across all vendors"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Avg Transaction"})]}),e.jsxs("p",{className:"text-4xl font-bold text-sage mb-2",children:["â‚¹",c.length>0?(t/c.reduce((x,r)=>x+r.transactionCount,0)).toLocaleString("en-IN",{maximumFractionDigits:0}):"0"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per vendor transaction"})]})]}),c.filter(x=>m(x.lastTransactionDate)>90).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-2xl shadow-soft p-6 border-2 border-soft-red/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-soft-red/20 rounded-lg flex items-center justify-center",children:e.jsx(he,{className:"w-6 h-6 text-soft-red"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Inactive Vendors"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-4",children:"The following vendors haven't been used in over 90 days. Consider reviewing your vendor relationships."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:c.filter(x=>m(x.lastTransactionDate)>90).map(x=>{const r=m(x.lastTransactionDate);return e.jsxs("div",{className:"bg-white/60 rounded-lg p-4 border border-soft-red/20",children:[e.jsx("p",{className:"font-semibold text-primary mb-1",children:x.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Last used: ",R(new Date(x.lastTransactionDate),"MMM d, yyyy")]}),e.jsxs("p",{className:"text-xs text-soft-red font-semibold mt-1",children:[r," days ago"]})]},x.id)})})]})]})}function Tr(){const[s,l]=i.useState("overview"),[h,b]=i.useState([]),[c,n]=i.useState([]),[a,o]=i.useState([]),[u,m]=i.useState([]),[t,x]=i.useState(!0);i.useEffect(()=>{r()},[]);const r=async()=>{try{const[f,j,_,N]=await Promise.all([C.from("expenses").select(`
            *,
            users:user_id(name, email),
            users_paid_by:users!expenses_paid_by_fkey(name, email),
            users_submitted_by:users!expenses_submitted_by_fkey(name),
            users_approved_by:users!expenses_approved_by_fkey(name),
            vendors(id, name, category)
          `).order("expense_date",{ascending:!1}),C.from("investments").select(`
            *,
            users:partner_id(name, email),
            users_submitted_by:users!investments_submitted_by_fkey(name)
          `).order("investment_date",{ascending:!1}),C.from("vendors").select("*").order("name"),C.from("users").select("id, name, email").order("name")]);if(f.error)throw f.error;if(j.error)throw j.error;if(_.error)throw _.error;if(N.error)throw N.error;b(f.data||[]),n(j.data||[]),o(_.data||[]),m(N.data||[])}catch(f){console.error("Error fetching data:",f)}finally{x(!1)}},v=[{id:"overview",name:"Overview",icon:te},{id:"category",name:"Category Analysis",icon:za},{id:"partner",name:"Partner Analysis",icon:je},{id:"monthly",name:"Monthly Reports",icon:De},{id:"vendor",name:"Vendor Analysis",icon:Js}];return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Financial Reports"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Comprehensive analysis of investments, expenses, and financial trends"})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-8 inline-flex gap-2 flex-wrap",children:v.map(f=>{const j=f.icon;return e.jsxs("button",{onClick:()=>l(f.id),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${s===f.id?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(j,{className:"w-5 h-5"}),f.name]},f.id)})}),t?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading reports..."})}):e.jsxs(e.Fragment,{children:[s==="overview"&&e.jsx(Mr,{expenses:h,investments:c,vendors:a}),s==="category"&&e.jsx(Pr,{expenses:h}),s==="partner"&&e.jsx(Er,{expenses:h,investments:c,allUsers:u}),s==="monthly"&&e.jsx(Ar,{expenses:h,investments:c}),s==="vendor"&&e.jsx(Ir,{expenses:h,vendors:a})]})]})})]})}const Fr=["Initial Capital","Product Development","Raw Material Purchase","Equipment Purchase","Marketing Budget","Working Capital","Infrastructure","Other"];function Lr({isOpen:s,onClose:l,onSuccess:h,preselectedPartnerId:b}){const{user:c}=H(),[n,a]=i.useState(!1),[o,u]=i.useState([]),[m,t]=i.useState(""),[x,r]=i.useState(!1),[v,f]=i.useState({partnerId:b||"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null}),j=c?.role==="admin";i.useEffect(()=>{s&&_()},[s]),i.useEffect(()=>{b&&f(g=>({...g,partnerId:b}))},[b]);const _=async()=>{try{const{data:g,error:M}=await C.from("users").select("id, name, email").order("name");if(M)throw M;u(g||[])}catch(g){console.error("Error fetching partners:",g)}},N=g=>{const M=g.target.files?.[0];if(M){if(M.size>10*1024*1024){alert("File size must be less than 10MB");return}f({...v,paymentProofFile:M})}},w=async g=>{try{const M=g.name.split(".").pop(),D=`payment-proofs/${`${Math.random()}.${M}`}`,{error:I}=await C.storage.from("investment-docs").upload(D,g);if(I)throw I;const{data:q}=C.storage.from("investment-docs").getPublicUrl(D);return q.publicUrl}catch(M){return console.error("Error uploading file:",M),null}},y=async g=>{if(g.preventDefault(),!v.partnerId||!v.amount||!v.purpose){alert("Please fill in all required fields");return}const M=parseFloat(v.amount);if(isNaN(M)||M<=0){alert("Please enter a valid positive amount");return}a(!0);try{let E=null;v.paymentProofFile&&(E=await w(v.paymentProofFile));const D={partner_id:v.partnerId,amount:M,investment_date:v.investmentDate,purpose:v.purpose,notes:v.notes||null,payment_proof_url:E,status:"pending",submitted_by:c?.id},{error:I}=await C.from("investments").insert([D]);if(I)throw I;const q=o.find(B=>B.id===v.partnerId);await C.from("activity_log").insert({user_id:c?.id,activity_type:"investment_added",description:`${c?.name} recorded investment of â‚¹${M.toLocaleString("en-IN")} for ${q?.name}`}),h(),l(),p()}catch(E){console.error("Error adding investment:",E),alert("Failed to add investment. Please try again.")}finally{a(!1)}},p=()=>{f({partnerId:"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null}),t("")},d=o.filter(g=>g.name.toLowerCase().includes(m.toLowerCase())||g.email.toLowerCase().includes(m.toLowerCase())),k=o.find(g=>g.id===v.partnerId);return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-3xl font-bold text-white",children:"Record Investment"}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Add a new partner investment to the records"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6 text-white"})})]})}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Partner ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:k?k.name:m,onChange:g=>{t(g.target.value),r(!0),f({...v,partnerId:""})},onFocus:()=>r(!0),placeholder:"Search for a partner...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),x&&!k&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border-2 border-dark-brown/10 rounded-xl shadow-soft-lg max-h-60 overflow-y-auto",children:d.length>0?d.map(g=>e.jsxs("button",{type:"button",onClick:()=>{f({...v,partnerId:g.id}),t(""),r(!1)},className:"w-full px-4 py-3 text-left hover:bg-accent/10 transition-colors border-b border-dark-brown/5 last:border-0",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:g.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:g.email})]},g.id)):e.jsx("p",{className:"px-4 py-3 text-dark-brown/50",children:"No partners found"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"number",value:v.amount,onChange:g=>f({...v,amount:g.target.value}),placeholder:"0",step:"0.01",min:"0",required:!0,className:"w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-dark-brown/40 text-sm",children:"INR"})]}),v.amount&&!isNaN(parseFloat(v.amount))&&e.jsxs("p",{className:"mt-2 text-sm text-dark-brown/60",children:["â‚¹",parseFloat(v.amount).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"date",value:v.investmentDate,onChange:g=>f({...v,investmentDate:g.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purpose / Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsxs("select",{value:v.purpose,onChange:g=>f({...v,purpose:g.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 appearance-none",children:[e.jsx("option",{value:"",children:"Select a purpose"}),Fr.map(g=>e.jsx("option",{value:g,children:g},g))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Proof (Optional)"}),e.jsxs("div",{className:"border-2 border-dashed border-dark-brown/20 rounded-xl p-6 hover:border-accent transition-colors",children:[e.jsx("input",{type:"file",id:"payment-proof",accept:"image/*,.pdf",onChange:N,className:"hidden"}),e.jsxs("label",{htmlFor:"payment-proof",className:"flex flex-col items-center cursor-pointer",children:[e.jsx(Pe,{className:"w-12 h-12 text-accent mb-3"}),v.paymentProofFile?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-sage",children:v.paymentProofFile.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(v.paymentProofFile.size/1024/1024).toFixed(2)," MB"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Upload Receipt or Bank Statement"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"PNG, JPG or PDF (max 10MB)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-4 top-4 w-5 h-5 text-accent"}),e.jsx("textarea",{value:v.notes,onChange:g=>f({...v,notes:g.target.value}),placeholder:"Add any additional details...",maxLength:500,rows:3,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 resize-none"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[v.notes.length,"/500 characters"]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-xl border border-blue-200",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-blue-600"})}),e.jsx("p",{className:"text-sm text-dark-brown",children:j?"This investment will require your approval before being recorded.":"This investment will be submitted for admin approval."})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-dark-brown/10",children:[e.jsx("button",{type:"button",onClick:l,disabled:n,className:"flex-1 px-6 py-3 border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:n,className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:n?"Recording...":e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-5 h-5"}),"Record Investment"]})})]})]})]})]}):null}function qr({partner:s,investments:l,totalInvestment:h,percentageOfTotal:b,isTopInvestor:c,onViewAll:n,onAddInvestment:a}){const o=t=>t.split(" ").map(x=>x[0]).join("").toUpperCase().slice(0,2),u=l.sort((t,x)=>new Date(x.investment_date).getTime()-new Date(t.investment_date).getTime()).slice(0,3),m=t=>({"Initial Capital":"ðŸ’°","Product Development":"ðŸ§ª","Raw Material Purchase":"ðŸŒ¿","Equipment Purchase":"ðŸ”§","Marketing Budget":"ðŸ“¢","Working Capital":"ðŸ’¼",Infrastructure:"ðŸ¢",Other:"ðŸ“Š"})[t]||"ðŸ’°";return e.jsxs("div",{className:`relative bg-gradient-to-br from-cream via-white to-sage/10 rounded-2xl shadow-soft hover:shadow-soft-lg transition-all duration-300 overflow-hidden ${c?"border-4 border-accent":"border-2 border-dark-brown/10"}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),c&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsxs("div",{className:"bg-accent text-white px-3 py-1.5 rounded-full flex items-center gap-2 shadow-soft",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold",children:"Top Investor"})]})}),e.jsxs("div",{className:"relative p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-xl",children:o(s.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary truncate",children:s.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 truncate",children:s.email})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-2",children:["â‚¹",h.toLocaleString("en-IN")]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-brown/70",children:[l.length," ",l.length===1?"investment":"investments"]}),e.jsxs("span",{className:"font-semibold text-secondary",children:[b.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-accent/10 to-secondary/10 rounded-xl p-1",children:e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary h-3 rounded-lg transition-all duration-500 shadow-soft",style:{width:`${Math.min(b,100)}%`}})}),u.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 uppercase tracking-wide",children:"Recent Investments"}),u.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 backdrop-blur-sm rounded-lg border border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsx("span",{className:"text-2xl",children:m(t.purpose)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown truncate",children:t.purpose}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:R(new Date(t.investment_date),"MMM d, yyyy")})]}),e.jsxs("p",{className:"text-sm font-bold text-secondary",children:["â‚¹",t.amount.toLocaleString("en-IN")]})]},t.id))]}):e.jsxs("div",{className:"text-center py-6 bg-white/60 backdrop-blur-sm rounded-lg border border-dashed border-dark-brown/20",children:[e.jsx("p",{className:"text-sm text-dark-brown/50",children:"No investments yet"}),e.jsx("p",{className:"text-xs text-dark-brown/40 mt-1",children:"Click + to add first investment"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs("button",{onClick:n,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300",children:[e.jsx(Ue,{className:"w-4 h-4"}),"View All"]}),e.jsx("button",{onClick:a,className:"flex items-center justify-center px-4 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:e.jsx(Q,{className:"w-5 h-5"})})]})]})]})}function $r({isOpen:s,onClose:l,partner:h,investments:b}){if(!s)return null;const c=b.reduce((o,u)=>o+u.amount,0),n=o=>{switch(o){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},a=()=>{alert("PDF generation feature coming soon!")};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"font-heading text-3xl font-bold text-white",children:[h.name,"'s Investment History"]}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Complete record of all investments"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"p-6 bg-cream/50 border-b border-dark-brown/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-4xl font-bold text-accent",children:["â‚¹",c.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 mt-1",children:["Across ",b.length," ",b.length===1?"investment":"investments"]})]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300 shadow-soft",children:[e.jsx(ke,{className:"w-5 h-5"}),"Download Statement"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:b.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-dark-brown/50",children:"No investments recorded yet"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),e.jsx("th",{className:"px-4 py-4 text-center text-sm font-semibold text-dark-brown",children:"Proof"})]})}),e.jsx("tbody",{children:b.sort((o,u)=>new Date(u.investment_date).getTime()-new Date(o.investment_date).getTime()).map((o,u)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${u%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:R(new Date(o.investment_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:o.purpose}),o.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1 line-clamp-2",children:o.notes})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",o.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:n(o.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm text-dark-brown",children:o.users_submitted_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:o.payment_proof_url?e.jsx("a",{href:o.payment_proof_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex p-2 hover:bg-primary/10 rounded-lg transition-colors",title:"View proof",children:e.jsx(Ue,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No proof"})})]},o.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-4 text-right font-bold text-dark-brown",children:"Total:"}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",c.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:3})]})})]})})}),e.jsx("div",{className:"p-4 bg-cream/50 border-t border-dark-brown/10 flex justify-end",children:e.jsx("button",{onClick:l,className:"px-6 py-3 bg-white border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300",children:"Close"})})]})]})}const Cs=["#B8860B","#2D5016","#C17817","#8B4513","#D4AF37","#CD853F","#DAA520"];function Rr({investments:s}){const l=s.filter(d=>d.status==="approved"),h=l.reduce((d,k)=>{const g=k.users?.name||"Unknown";return d[g]||(d[g]=0),d[g]+=k.amount,d},{}),b=Object.entries(h).map(([d,k])=>({name:d,value:Number(k)})),c=l.reduce((d,k)=>(d[k.purpose]||(d[k.purpose]=0),d[k.purpose]+=k.amount,d),{}),n=Object.entries(c).map(([d,k])=>({name:d,value:Number(k)})).sort((d,k)=>k.value-d.value),a=l.reduce((d,k)=>{const g=new Date(k.investment_date),M=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}`;return d[M]||(d[M]=0),d[M]+=k.amount,d},{}),o=Object.keys(a).sort();let u=0;const m=o.map(d=>{u+=a[d];const[k,g]=d.split("-");return{month:new Date(parseInt(k),parseInt(g)-1).toLocaleDateString("en-US",{month:"short",year:"2-digit"}),monthly:a[d],cumulative:u}}),t=l.reduce((d,k)=>d+k.amount,0),x=new Set(l.map(d=>d.partner_id)).size,r=x>0?t/x:0,v=new Date().getMonth(),f=new Date().getFullYear(),j=new Date(f,v-1),_=l.filter(d=>{const k=new Date(d.investment_date);return k.getMonth()===v&&k.getFullYear()===f}),N=l.filter(d=>{const k=new Date(d.investment_date);return k.getMonth()===j.getMonth()&&k.getFullYear()===j.getFullYear()}),w=_.reduce((d,k)=>d+k.amount,0),y=N.reduce((d,k)=>d+k.amount,0),p=y>0?(w-y)/y*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Re,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-xs font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-1",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Investment"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-3xl font-bold text-sage mb-1",children:x}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Partners Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(Za,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",r.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-6 border-2 border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Growth"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${p>=0?"text-sage":"text-soft-red"}`,children:[p>=0?"+":"",p.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"This Month"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Contributions"}),b.length>0?e.jsx(be,{width:"100%",height:300,children:e.jsxs(At,{children:[e.jsx(It,{data:b,cx:"50%",cy:"50%",labelLine:!1,label:({name:d,percent:k})=>`${d} (${(k*100).toFixed(0)}%)`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:b.map((d,k)=>e.jsx(Tt,{fill:Cs[k%Cs.length]},`cell-${k}`))}),e.jsx(ye,{formatter:d=>`â‚¹${d.toLocaleString("en-IN")}`})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment by Purpose"}),n.length>0?e.jsx(be,{width:"100%",height:300,children:e.jsxs(Ft,{data:n,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx(qe,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ye,{formatter:d=>`â‚¹${d.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(mt,{dataKey:"value",fill:"#B8860B",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment Timeline"}),m.length>0?e.jsx(be,{width:"100%",height:350,children:e.jsxs(Et,{data:m,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Le,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(qe,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ye,{formatter:d=>`â‚¹${d.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(ft,{}),e.jsx($e,{type:"monotone",dataKey:"monthly",stroke:"#C17817",strokeWidth:2,name:"Monthly Investment",dot:{fill:"#C17817",r:4}}),e.jsx($e,{type:"monotone",dataKey:"cumulative",stroke:"#2D5016",strokeWidth:3,name:"Cumulative Investment",dot:{fill:"#2D5016",r:5}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),t>=1e5&&e.jsxs("div",{className:"bg-gradient-to-r from-accent to-secondary rounded-2xl shadow-soft-lg p-8 text-center",children:[e.jsx("p",{className:"text-5xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"font-heading text-3xl font-bold text-white mb-2",children:"Milestone Achieved!"}),e.jsxs("p",{className:"text-white/90 text-lg",children:["Total investments have crossed â‚¹",(Math.floor(t/1e5)*1e5/1e3).toFixed(0),"K! Amazing progress toward building Organitto together."]})]})]})}function Ur(){const{user:s}=H(),[l,h]=i.useState([]),[b,c]=i.useState([]),[n,a]=i.useState(!0),[o,u]=i.useState("by_partner"),[m,t]=i.useState(!1),[x,r]=i.useState(),[v,f]=i.useState(!1),[j,_]=i.useState(null),[N,w]=i.useState(!1),[y,p]=i.useState("approve"),[d,k]=i.useState(null),[g,M]=i.useState(null),E=s?.role==="admin";i.useEffect(()=>{I(),D();const T=C.channel("investments-changes").on("postgres_changes",{event:"*",schema:"public",table:"investments"},()=>{I()}).subscribe();return()=>{C.removeChannel(T)}},[]);const D=async()=>{try{const{data:T,error:z}=await C.from("users").select("id, name, email").order("name");if(z)throw z;c(T||[])}catch(T){console.error("Error fetching users:",T)}},I=async()=>{try{const{data:T,error:z}=await C.from("investments").select(`
          *,
          users:partner_id(name, email),
          users_submitted_by:users!investments_submitted_by_fkey(name),
          users_approved_by:users!investments_approved_by_fkey(name)
        `).order("investment_date",{ascending:!1});if(z)throw z;h(T||[])}catch(T){console.error("Error fetching investments:",T)}finally{a(!1)}},q=T=>{k(T),p("approve"),w(!0)},B=T=>{k(T),p("reject"),w(!0)},G=async(T,z)=>{if(!(!d||!s)){M(d.id);try{const ie={status:y==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};y==="reject"&&z&&(ie.rejection_reason=z);const{error:me}=await C.from("investments").update(ie).eq("id",d.id);if(me)throw me;await C.from("activity_log").insert({user_id:s.id,activity_type:y==="approve"?"investment_approved":"investment_rejected",description:`${s.name} ${y==="approve"?"approved":"rejected"} investment: â‚¹${d.amount.toLocaleString("en-IN")} from ${d.users?.name}`}),await I(),w(!1),k(null)}catch(ie){console.error("Error processing approval:",ie),alert("Failed to process approval. Please try again.")}finally{M(null)}}},se=async T=>{if(confirm("Are you sure you want to delete this investment? This action cannot be undone."))try{const{error:z}=await C.from("investments").delete().eq("id",T);if(z)throw z;await I()}catch(z){console.error("Error deleting investment:",z),alert("Failed to delete investment. Please try again.")}},ee=b.map(T=>{const z=l.filter(me=>me.partner_id===T.id),ie=z.reduce((me,_e)=>me+_e.amount,0);return{partner:{id:T.id,name:T.name,email:T.email},investments:z,total:ie}});ee.sort((T,z)=>z.total-T.total);const S=l.filter(T=>T.status==="approved").reduce((T,z)=>T+z.amount,0);ee.filter(T=>T.investments.some(z=>z.status==="approved")).length;const $=b.length>0?S/b.length:0,L=ee.length>0?ee[0].partner.id:null,V=T=>{switch(T){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Investment Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track partner investments and grow together"})]}),e.jsxs("button",{onClick:()=>{r(void 0),t(!0)},className:"flex items-center gap-2 px-6 py-4 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Investment"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-4xl font-bold text-accent mb-1",children:["â‚¹",S.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Amount Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage mb-1",children:b.length}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Partners"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(ht,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-sm font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-1",children:["â‚¹",$.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-6 inline-flex gap-2",children:[e.jsxs("button",{onClick:()=>u("by_partner"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${o==="by_partner"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(je,{className:"w-5 h-5"}),"By Partner"]}),e.jsxs("button",{onClick:()=>u("all_investments"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${o==="all_investments"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"All Investments"]}),e.jsxs("button",{onClick:()=>u("statistics"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${o==="statistics"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(ht,{className:"w-5 h-5"}),"Statistics"]})]}),n?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading investments..."})}):o==="by_partner"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.length===0?e.jsx("div",{className:"col-span-full text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No partners found"})}):ee.map(T=>e.jsx(qr,{partner:T.partner,investments:T.investments,totalInvestment:T.total,percentageOfTotal:S>0?T.total/S*100:0,isTopInvestor:T.partner.id===L&&T.total>0,onViewAll:()=>{_(T),f(!0)},onAddInvestment:()=>{r(T.partner.id),t(!0)}},T.partner.id))}):o==="all_investments"?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Partner"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),E&&e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:l.map((T,z)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${z%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:R(new Date(T.investment_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:T.users?.name}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:T.users?.email})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",T.amount.toLocaleString("en-IN")]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:T.purpose}),T.notes&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1 line-clamp-1",children:T.notes})]}),e.jsx("td",{className:"px-4 py-4",children:V(T.status)}),e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:T.users_submitted_by?.name||"Unknown"}),E&&e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[T.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>q(T),disabled:g===T.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(Y,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:()=>B(T),disabled:g===T.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Me,{className:"w-4 h-4 text-soft-red"})})]}),e.jsx("button",{onClick:()=>se(T.id),className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(oe,{className:"w-4 h-4 text-soft-red"})})]})})]},T.id))})]})})}):e.jsx(Rr,{investments:l})]})}),m&&e.jsx(Lr,{isOpen:m,onClose:()=>{t(!1),r(void 0)},onSuccess:I,preselectedPartnerId:x}),v&&j&&e.jsx($r,{isOpen:v,onClose:()=>{f(!1),_(null)},partner:j.partner,investments:j.investments}),N&&d&&e.jsx(sa,{isOpen:N,onClose:()=>{w(!1),k(null)},onConfirm:G,type:y,expense:{category:d.purpose,subcategory:d.notes,amount:d.amount,expense_date:d.investment_date,payment_mode:"Investment"},loading:g===d.id})]})}function zr({product:s,users:l,onDragStart:h,onEdit:b,onMoveNext:c}){const n=ce(),a=X(new Date,new Date(s.stage_entered_at)),o=()=>{const r={high:{color:"bg-soft-red",dot:"ðŸ”´"},medium:{color:"bg-accent",dot:"ðŸŸ¡"},low:{color:"bg-sage",dot:"ðŸŸ¢"}};return r[s.priority]||r.medium},u=r=>({Skincare:"âœ¨","Hair Care":"ðŸ’†","Wellness & Supplements":"ðŸŒ¿","Oral Care":"ðŸ¦·","Personal Care":"ðŸ§´","Home Care":"ðŸ ",Other:"ðŸ“¦"})[r]||"ðŸ“¦",m=l.filter(r=>s.assigned_partners.includes(r.id)),t=r=>r.split(" ").map(v=>v[0]).join("").toUpperCase().slice(0,2),x=o();return e.jsxs("div",{draggable:!0,onDragStart:()=>h(s),className:"bg-white rounded-xl shadow-soft p-4 mb-3 cursor-move hover:shadow-soft-lg transition-all duration-300 border-2 border-transparent hover:border-accent/30 relative group",children:[e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${x.color} text-white`,children:[x.dot," ",s.priority.toUpperCase()]})}),s.image_url?e.jsx("div",{className:"w-full h-32 bg-cream/50 rounded-lg mb-3 overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-32 bg-gradient-to-br from-sage/20 to-accent/20 rounded-lg mb-3 flex items-center justify-center",children:e.jsx("span",{className:"text-5xl",children:u(s.category)})}),e.jsx("h4",{className:"font-heading text-lg font-bold text-primary mb-2 pr-16",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:s.category}),s.product_type&&e.jsx("span",{className:"text-xs px-2 py-1 bg-secondary/10 text-secondary rounded-full",children:s.product_type})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-dark-brown/60 font-semibold",children:"Stage Progress"}),e.jsxs("span",{className:"text-xs font-bold text-accent",children:[s.progress,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60 mb-3",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsxs("span",{className:a>30?"text-soft-red font-semibold":"",children:[a," days in stage",a>30&&" âš ï¸"]})]}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-3",children:[m.slice(0,3).map((r,v)=>e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent to-secondary flex items-center justify-center text-white text-xs font-bold border-2 border-white shadow-sm",style:{marginLeft:v>0?"-8px":"0",zIndex:3-v},title:r.name,children:t(r.name)},r.id)),m.length>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-dark-brown/20 flex items-center justify-center text-xs font-bold text-dark-brown ml-1",children:["+",m.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-dark-brown/60 mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3"}),"0/0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($t,{className:"w-3 h-3"}),"0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(os,{className:"w-3 h-3"}),"0"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>n(`/products/${s.id}`),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(Ue,{className:"w-4 h-4"}),"View"]}),e.jsxs("button",{onClick:()=>b(s),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),e.jsx("button",{onClick:()=>c(s),className:"flex items-center justify-center gap-1 px-3 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg transition-colors text-xs font-semibold",children:e.jsx(ss,{className:"w-4 h-4"})})]})]})}const Br=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],Or=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Vr=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function Hr({isOpen:s,onClose:l,onSubmit:h,users:b}){const[c,n]=i.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),[a,o]=i.useState(!1);if(!s)return null;const u=async t=>{t.preventDefault(),o(!0);try{await h(c),n({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),l()}catch(x){console.error("Error creating product:",x)}finally{o(!1)}},m=t=>{n(x=>({...x,assigned_partners:x.assigned_partners.includes(t)?x.assigned_partners.filter(r=>r!==t):[...x.assigned_partners,t]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Add New Product"}),e.jsx("button",{onClick:l,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(re,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:c.name,onChange:t=>n({...c,name:t.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:c.category,onChange:t=>n({...c,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),Br.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:c.product_type,onChange:t=>n({...c,product_type:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Or.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Initial Stage"}),e.jsx("select",{value:c.current_stage,onChange:t=>n({...c,current_stage:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Vr.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:c.target_launch_date,onChange:t=>n({...c,target_launch_date:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",bgColor:"bg-red-500",hoverColor:"hover:bg-red-600",borderColor:"border-red-500"},{value:"medium",label:"Medium",bgColor:"bg-orange-500",hoverColor:"hover:bg-orange-600",borderColor:"border-orange-500"},{value:"low",label:"Low",bgColor:"bg-green-500",hoverColor:"hover:bg-green-600",borderColor:"border-green-500"}].map(t=>e.jsxs("label",{className:`flex-1 cursor-pointer px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 border-2 ${c.priority===t.value?`${t.bgColor} ${t.borderColor} text-white shadow-md`:`bg-white ${t.borderColor} border-opacity-30 text-dark-brown hover:border-opacity-100 hover:shadow-sm`}`,children:[e.jsx("input",{type:"radio",name:"priority",value:t.value,checked:c.priority===t.value,onChange:x=>n({...c,priority:x.target.value}),className:"sr-only"}),t.label]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:c.description,onChange:t=>n({...c,description:t.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:b.map(t=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${c.assigned_partners.includes(t.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:c.assigned_partners.includes(t.id),onChange:()=>m(t.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:t.name})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:c.image_url,onChange:t=>n({...c,image_url:t.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Upload"]})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Or enter a direct image URL"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition-colors border-2 border-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:a,className:"flex-1 px-6 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold rounded-xl hover:from-emerald-700 hover:to-teal-700 shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-lg",children:a?"Creating...":"Create Product"})]})]})]})})}const Wr=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],Gr=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Qr=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function aa({isOpen:s,onClose:l,onSubmit:h,product:b,users:c}){const[n,a]=i.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:"",progress:0}),[o,u]=i.useState(!1);if(i.useEffect(()=>{b&&a({name:b.name||"",category:b.category||"",product_type:b.product_type||"",current_stage:b.current_stage||"idea",priority:b.priority||"medium",target_launch_date:b.target_launch_date||"",description:b.description||"",assigned_partners:b.assigned_partners||[],image_url:b.image_url||"",progress:b.progress||0})},[b]),!s)return null;const m=async x=>{x.preventDefault(),u(!0);try{await h(b.id,n),l()}catch(r){console.error("Error updating product:",r)}finally{u(!1)}},t=x=>{a(r=>({...r,assigned_partners:r.assigned_partners.includes(x)?r.assigned_partners.filter(v=>v!==x):[...r.assigned_partners,x]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Edit Product"}),e.jsx("button",{onClick:l,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(re,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:n.name,onChange:x=>a({...n,name:x.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:n.category,onChange:x=>a({...n,category:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),Wr.map(x=>e.jsx("option",{value:x,children:x},x))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:n.product_type,onChange:x=>a({...n,product_type:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Gr.map(x=>e.jsx("option",{value:x,children:x},x))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Stage"}),e.jsx("select",{value:n.current_stage,onChange:x=>a({...n,current_stage:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Qr.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:n.target_launch_date,onChange:x=>a({...n,target_launch_date:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Progress"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:n.progress,onChange:x=>a({...n,progress:parseInt(x.target.value)}),className:"flex-1"}),e.jsxs("span",{className:"text-2xl font-bold text-accent min-w-[60px]",children:[n.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${n.progress}%`}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",color:"bg-soft-red"},{value:"medium",label:"Medium",color:"bg-accent"},{value:"low",label:"Low",color:"bg-sage"}].map(x=>e.jsxs("label",{className:`flex-1 cursor-pointer ${n.priority===x.value?`${x.color} text-white`:"bg-dark-brown/5 text-dark-brown"} px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 hover:scale-105`,children:[e.jsx("input",{type:"radio",name:"priority",value:x.value,checked:n.priority===x.value,onChange:r=>a({...n,priority:r.target.value}),className:"sr-only"}),x.label]},x.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:n.description,onChange:x=>a({...n,description:x.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:c.map(x=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${n.assigned_partners.includes(x.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:n.assigned_partners.includes(x.id),onChange:()=>t(x.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:x.name})]},x.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:n.image_url,onChange:x=>a({...n,image_url:x.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Upload"]})]}),n.image_url&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:n.image_url,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg border-2 border-dark-brown/10"})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:o,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Updating...":"Update Product"})]})]})]})})}const dt=[{id:"idea",name:"Idea",icon:"ðŸŒ±",gradient:"from-sage/30 to-sage/10"},{id:"research",name:"Research",icon:"ðŸ”",gradient:"from-sage/25 to-sage/10"},{id:"formula",name:"Formula Creation",icon:"âš—ï¸",gradient:"from-sage/20 to-accent/10"},{id:"testing",name:"Testing",icon:"ðŸ§ª",gradient:"from-accent/30 to-accent/10"},{id:"packaging",name:"Packaging Design",icon:"ðŸ“¦",gradient:"from-accent/25 to-accent/10"},{id:"printing",name:"Printing",icon:"ðŸ–¨ï¸",gradient:"from-accent/20 to-secondary/10"},{id:"production",name:"Production",icon:"ðŸ­",gradient:"from-secondary/30 to-secondary/10"},{id:"ready",name:"Ready to Launch",icon:"ðŸš€",gradient:"from-secondary/25 to-secondary/10"},{id:"launched",name:"Launched",icon:"âœ…",gradient:"from-primary/40 to-primary/20"}];function Yr(){const{user:s}=H(),l=ce(),[h,b]=i.useState("board"),[c,n]=i.useState(!1),[a,o]=i.useState(!1),[u,m]=i.useState(null),[t,x]=i.useState([]),[r,v]=i.useState([]),[f,j]=i.useState(!0),[_,N]=i.useState(null),[w,y]=i.useState("all"),[p,d]=i.useState("");i.useEffect(()=>{k()},[]);const k=async()=>{try{const[L,V]=await Promise.all([C.from("products").select("*").order("created_at",{ascending:!1}),C.from("users").select("id, name, email").order("name")]);if(L.error)throw L.error;if(V.error)throw V.error;x(L.data||[]),v(V.data||[])}catch(L){console.error("Error fetching data:",L)}finally{j(!1)}},g=async L=>{try{const{data:V,error:T}=await C.from("products").insert([{...L,created_by:s?.id,stage_entered_at:new Date().toISOString()}]).select().single();if(T)throw T;await C.from("product_stage_history").insert([{product_id:V.id,stage:L.current_stage,moved_by:s?.id,notes:"Product created"}]),await k()}catch(V){throw console.error("Error creating product:",V),V}},M=L=>{N(L)},E=L=>{L.preventDefault()},D=async(L,V)=>{if(L.preventDefault(),!_||_.current_stage===V){N(null);return}if(V==="launched"&&!window.confirm(`Are you sure you want to launch "${_.name}"? This marks it as complete.`)){N(null);return}try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",_.id).is("exited_at",null),await C.from("products").update({current_stage:V,stage_entered_at:new Date().toISOString(),progress:V==="launched"?100:_.progress}).eq("id",_.id),await C.from("product_stage_history").insert([{product_id:_.id,stage:V,moved_by:s?.id}]),await k()}catch(T){console.error("Error moving product:",T)}finally{N(null)}},I=async L=>{const V=dt.findIndex(z=>z.id===L.current_stage);if(V===-1||V===dt.length-1)return;const T=dt[V+1].id;await D({preventDefault:()=>{}},T)},q=L=>{m(L),o(!0)},B=async(L,V)=>{try{const{error:T}=await C.from("products").update({...V,updated_at:new Date().toISOString()}).eq("id",L);if(T)throw T;await C.from("activity_log").insert({user_id:s?.id,activity_type:"product_updated",description:`${s?.name} updated product: ${V.name}`}),await k()}catch(T){throw console.error("Error updating product:",T),T}},G=t.filter(L=>!(w!=="all"&&L.priority!==w||p&&!L.name.toLowerCase().includes(p.toLowerCase()))),se=t.length,ee=t.filter(L=>L.current_stage!=="launched").length,S=t.filter(L=>L.current_stage==="launched").length,$=t.filter(L=>L.priority==="high").length;return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("button",{onClick:()=>n(!0),className:"fixed bottom-8 right-8 w-16 h-16 bg-gradient-to-r from-secondary to-accent text-white rounded-full shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-110 flex items-center justify-center z-40 group",children:e.jsx(Q,{className:"w-8 h-8 group-hover:rotate-90 transition-transform duration-300"})}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Product Development Pipeline"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track your Ayurvedic products from concept to launch"})]}),e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-3 px-6 py-4 bg-accent text-white rounded-xl font-bold text-lg shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-105 hover:bg-accent/90",children:[e.jsx(Q,{className:"w-6 h-6"}),"Add New Product"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(le,{className:"w-6 h-6 text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Products"})]}),e.jsx("p",{className:"text-4xl font-bold text-primary",children:se})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(he,{className:"w-6 h-6 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"In Development"})]}),e.jsx("p",{className:"text-4xl font-bold text-accent",children:ee})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ha,{className:"w-6 h-6 text-sage"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Launched"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage",children:S})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/20 to-soft-red/10 rounded-xl p-6 border-2 border-soft-red/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Y,{className:"w-6 h-6 text-soft-red"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"High Priority"})]}),e.jsx("p",{className:"text-4xl font-bold text-soft-red",children:$})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-4 mb-8 flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>b("board"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${h==="board"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(Ra,{className:"w-5 h-5"}),"Board View"]}),e.jsxs("button",{onClick:()=>b("list"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${h==="list"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"List View"]})]}),e.jsxs("div",{className:"flex gap-3 flex-1 max-w-md",children:[e.jsx("input",{type:"text",placeholder:"Search products...",value:p,onChange:L=>d(L.target.value),className:"flex-1 px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("select",{value:w,onChange:L=>y(L.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"low",children:"Low Priority"})]})]})]}),f?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading products..."})}):h==="board"?e.jsx("div",{className:"overflow-x-auto pb-4",children:e.jsx("div",{className:"flex gap-4 min-w-max",children:dt.map(L=>{const V=G.filter(T=>T.current_stage===L.id);return e.jsxs("div",{onDragOver:E,onDrop:T=>D(T,L.id),className:`w-80 flex-shrink-0 bg-gradient-to-b ${L.gradient} rounded-2xl p-4 border-2 border-dark-brown/10 shadow-soft`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-heading text-lg font-bold text-primary flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:L.icon}),L.name]}),e.jsx("span",{className:"bg-white px-3 py-1 rounded-full text-sm font-bold text-primary shadow-sm",children:V.length})]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-400px)] overflow-y-auto pr-2",children:V.length===0?e.jsx("div",{className:"text-center py-8 text-dark-brown/40 text-sm",children:"No products in this stage"}):V.map(T=>e.jsx(zr,{product:T,users:r,onDragStart:M,onEdit:q,onMoveNext:I},T.id))})]},L.id)})})}):e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Priority"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Progress"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Days in Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Target Launch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:G.map((L,V)=>{const T=dt.find(ie=>ie.id===L.current_stage),z=Math.floor((new Date().getTime()-new Date(L.stage_entered_at).getTime())/(1e3*60*60*24));return e.jsxs("tr",{className:`border-b border-dark-brown/5 ${V%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center text-2xl",children:T?.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-primary",children:L.name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:L.product_type})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:L.category})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-sm px-3 py-1 bg-gradient-to-r ${T?.gradient} rounded-full font-semibold text-dark-brown`,children:T?.name})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold text-white ${L.priority==="high"?"bg-soft-red":L.priority==="medium"?"bg-accent":"bg-sage"}`,children:L.priority.toUpperCase()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent",style:{width:`${L.progress}%`}})}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[L.progress,"%"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-sm ${z>30?"text-soft-red font-semibold":"text-dark-brown/70"}`,children:[z," days"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:L.target_launch_date||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(`/products/${L.id}`),className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",title:"View Details",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(L),className:"p-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors",title:"Edit Product",children:e.jsx(ge,{className:"w-4 h-4"})})]})})]},L.id)})})]})})}),G.length===0&&!f&&e.jsxs("div",{className:"text-center py-16 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ±"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"No products yet!"}),e.jsx("p",{className:"text-dark-brown/60 mb-6",children:"Create your first Ayurvedic product to get started"}),e.jsx("button",{onClick:()=>n(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300",children:"Create Product"})]})]})}),e.jsx(Hr,{isOpen:c,onClose:()=>n(!1),onSubmit:g,users:r}),u&&e.jsx(aa,{isOpen:a,onClose:()=>{o(!1),m(null)},onSubmit:B,product:u,users:r})]})}function Kr({product:s,onRefresh:l}){H();const[h,b]=i.useState([]),[c,n]=i.useState([]),[a,o]=i.useState(null),[u,m]=i.useState(!1),[t,x]=i.useState(s.description||"");i.useEffect(()=>{r()},[s.id]);const r=async()=>{try{const[y,p]=await Promise.all([C.from("product_stage_history").select("*, moved_by").eq("product_id",s.id).order("entered_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(y.error)throw y.error;if(p.error)throw p.error;if(b(y.data||[]),n(p.data||[]),s.created_by){const d=p.data?.find(k=>k.id===s.created_by);o(d)}}catch(y){console.error("Error fetching data:",y)}},v=async()=>{try{const{error:y}=await C.from("products").update({description:t}).eq("id",s.id);if(y)throw y;m(!1),l()}catch(y){console.error("Error updating description:",y)}},f=c.filter(y=>s.assigned_partners?.includes(y.id)),j=X(new Date,new Date(s.created_at)),_=y=>y.split(" ").map(p=>p[0]).join("").toUpperCase().slice(0,2),N=y=>c.find(d=>d.id===y)?.name||"Unknown",w={idea:"ðŸŒ± Idea",research:"ðŸ” Research",formula:"âš—ï¸ Formula Creation",testing:"ðŸ§ª Testing",packaging:"ðŸ“¦ Packaging Design",printing:"ðŸ–¨ï¸ Printing",production:"ðŸ­ Production",ready:"ðŸš€ Ready to Launch",launched:"âœ… Launched"};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Product Information"}),!u&&e.jsx("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"Edit Description"})]}),s.image_url&&e.jsx("div",{className:"mb-4 rounded-xl overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-64 object-cover"})}),u?e.jsxs("div",{children:[e.jsx("textarea",{value:t,onChange:y=>x(y.target.value),placeholder:"Enter product description...",rows:6,className:"w-full px-4 py-3 border-2 border-accent/30 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none mb-3"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-lg font-semibold hover:shadow-soft transition-all",children:"Save"}),e.jsx("button",{onClick:()=>{x(s.description||""),m(!1)},className:"px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:"Cancel"})]})]}):e.jsx("p",{className:"text-dark-brown/70 leading-relaxed",children:s.description||"No description provided yet."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Category"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Product Type"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.product_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created Date"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:R(new Date(s.created_at),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created By"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:a?.name||"Unknown"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Stage History"}),e.jsx("div",{className:"space-y-3",children:h.map((y,p)=>{const d=y.exited_at?X(new Date(y.exited_at),new Date(y.entered_at)):X(new Date,new Date(y.entered_at));return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white rounded-lg border-2 border-dark-brown/5",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-2xl ${p===0?"bg-accent/20":"bg-dark-brown/5"}`,children:w[y.stage]?.split(" ")[0]||"ðŸ“¦"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:w[y.stage]||y.stage}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Entered ",R(new Date(y.entered_at),"MMM dd, yyyy")," by ",N(y.moved_by)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-accent",children:[d," days"]}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:y.exited_at?"Completed":"Current"})]})]},y.id)})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-white rounded-xl p-6 border-2 border-accent/20",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Total Development"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[j," days"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Progress"}),e.jsxs("p",{className:"text-xl font-bold text-sage",children:[s.progress,"%"]})]})]}),s.target_launch_date&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center",children:e.jsx(De,{className:"w-6 h-6 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Target Launch"}),e.jsx("p",{className:"text-xl font-bold text-secondary",children:R(new Date(s.target_launch_date),"MMM dd, yyyy")})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Assigned Team"}),f.length>0?e.jsx("div",{className:"space-y-3",children:f.map(y=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:_(y.name)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:y.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 capitalize",children:y.role})]})]},y.id))}):e.jsx("p",{className:"text-dark-brown/50 text-sm",children:"No team members assigned yet."}),e.jsx("button",{className:"w-full mt-4 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"+ Add Team Member"})]})]})]})})}const Zr=["Herb","Oil","Powder","Extract","Base","Preservative","Fragrance","Active","Other"],Jr=["g","ml","kg","L","%","drops"],Xr=["Cooling","Heating","Vata-balancing","Pitta-balancing","Kapha-balancing","Anti-inflammatory","Antimicrobial","Moisturizing","Detoxifying","Rejuvenating"];function en({productId:s}){H();const[l,h]=i.useState([]),[b,c]=i.useState([]),[n,a]=i.useState(null),[o,u]=i.useState(!1),[m,t]=i.useState(null),[x,r]=i.useState({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""});i.useEffect(()=>{v()},[s]);const v=async()=>{try{const[p,d]=await Promise.all([C.from("product_ingredients").select("*").eq("product_id",s).order("created_at",{ascending:!0}),C.from("formula_versions").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(p.error)throw p.error;if(d.error)throw d.error;h(p.data||[]),c(d.data||[]);const k=d.data?.find(g=>g.is_current);a(k)}catch(p){console.error("Error fetching data:",p)}},f=async p=>{p.preventDefault();try{if(m){const{error:d}=await C.from("product_ingredients").update({...x,quantity:parseFloat(x.quantity)||0,cost_per_unit:parseFloat(x.cost_per_unit)||0}).eq("id",m);if(d)throw d}else{const{error:d}=await C.from("product_ingredients").insert([{product_id:s,...x,quantity:parseFloat(x.quantity)||0,cost_per_unit:parseFloat(x.cost_per_unit)||0}]);if(d)throw d}N(),v()}catch(d){console.error("Error saving ingredient:",d)}},j=p=>{r({ingredient_name:p.ingredient_name,botanical_name:p.botanical_name||"",type:p.type||"",quantity:p.quantity?.toString()||"",unit:p.unit||"g",vendor:p.vendor||"",cost_per_unit:p.cost_per_unit?.toString()||"",ayurvedic_properties:p.ayurvedic_properties||[],notes:p.notes||""}),t(p.id),u(!0)},_=async p=>{if(confirm("Are you sure you want to delete this ingredient?"))try{const{error:d}=await C.from("product_ingredients").delete().eq("id",p);if(d)throw d;v()}catch(d){console.error("Error deleting ingredient:",d)}},N=()=>{r({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""}),t(null),u(!1)},w=p=>{r(d=>({...d,ayurvedic_properties:d.ayurvedic_properties.includes(p)?d.ayurvedic_properties.filter(k=>k!==p):[...d.ayurvedic_properties,p]}))},y=l.reduce((p,d)=>p+(d.quantity||0)*(d.cost_per_unit||0),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Ingredients List"}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Ingredient"]})]}),e.jsx("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Cost/Unit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Properties"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:l.map((p,d)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${d%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:p.ingredient_name}),p.botanical_name&&e.jsx("p",{className:"text-sm text-dark-brown/60 italic",children:p.botanical_name})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:p.type||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[p.quantity||0," ",p.unit]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:p.vendor||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-dark-brown",children:["â‚¹",p.cost_per_unit?.toFixed(2)||"0.00"]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-bold text-accent",children:["â‚¹",((p.quantity||0)*(p.cost_per_unit||0)).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(p.ayurvedic_properties||[]).slice(0,2).map(k=>e.jsx("span",{className:"px-2 py-0.5 bg-sage/10 text-sage rounded text-xs font-semibold",children:k},k)),(p.ayurvedic_properties||[]).length>2&&e.jsxs("span",{className:"text-xs text-dark-brown/60",children:["+",(p.ayurvedic_properties||[]).length-2]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(p),className:"p-2 text-accent hover:bg-accent/10 rounded-lg transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(p.id),className:"p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})})]},p.id))}),e.jsx("tfoot",{className:"bg-accent/5 border-t-2 border-accent/20",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Total Raw Material Cost:"}),e.jsxs("td",{className:"px-4 py-3 font-bold text-xl text-accent",children:["â‚¹",y.toFixed(2)]}),e.jsx("td",{colSpan:2})]})})]})})}),l.length===0&&e.jsxs("div",{className:"text-center py-12 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ¿"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No ingredients added yet"}),e.jsx("button",{onClick:()=>u(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Add Your First Ingredient"})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:m?"Edit Ingredient":"Add New Ingredient"}),e.jsx("button",{onClick:N,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(re,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Ingredient Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:x.ingredient_name,onChange:p=>r({...x,ingredient_name:p.target.value}),placeholder:"e.g., Neem Extract",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical Name"}),e.jsx("input",{type:"text",value:x.botanical_name,onChange:p=>r({...x,botanical_name:p.target.value}),placeholder:"e.g., Azadirachta indica",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Type"}),e.jsxs("select",{value:x.type,onChange:p=>r({...x,type:p.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Zr.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",value:x.quantity,onChange:p=>r({...x,quantity:p.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("select",{value:x.unit,onChange:p=>r({...x,unit:p.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Jr.map(p=>e.jsx("option",{value:p,children:p},p))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor/Source"}),e.jsx("input",{type:"text",value:x.vendor,onChange:p=>r({...x,vendor:p.target.value}),placeholder:"Supplier name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:x.cost_per_unit,onChange:p=>r({...x,cost_per_unit:p.target.value}),placeholder:"0.00",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Ayurvedic Properties"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Xr.map(p=>e.jsxs("label",{className:`cursor-pointer px-3 py-2 rounded-lg border-2 transition-all ${x.ayurvedic_properties.includes(p)?"border-sage bg-sage/10 text-sage font-semibold":"border-dark-brown/10 hover:border-sage/50 text-dark-brown"}`,children:[e.jsx("input",{type:"checkbox",checked:x.ayurvedic_properties.includes(p),onChange:()=>w(p),className:"sr-only"}),e.jsx("span",{className:"text-sm",children:p})]},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:x.notes,onChange:p=>r({...x,notes:p.target.value}),placeholder:"Additional notes about this ingredient...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:N,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:m?"Update Ingredient":"Add Ingredient"})]})]})]})})]})}const Ss={stability:["pH Test","Viscosity Test","Color Consistency","Fragrance Stability","Separation Test"],safety:["Patch Test Results","Microbial Testing","Heavy Metals Testing","Allergen Testing"],performance:["Efficacy Test","Shelf Life Study","Consumer Testing"]};function tn({productId:s}){const{user:l}=H(),[h,b]=i.useState([]),[c,n]=i.useState([]),[a,o]=i.useState(!1),[u,m]=i.useState(!1),[t,x]=i.useState({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),[r,v]=i.useState({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5});i.useEffect(()=>{f()},[s]);const f=async()=>{try{const[w,y]=await Promise.all([C.from("product_tests").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("sample_batches").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(w.error)throw w.error;if(y.error)throw y.error;b(w.data||[]),n(y.data||[])}catch(w){console.error("Error fetching data:",w)}},j=async w=>{w.preventDefault();try{const{error:y}=await C.from("product_tests").insert([{product_id:s,...t,tested_by:l?.id}]);if(y)throw y;x({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),o(!1),f()}catch(y){console.error("Error adding test:",y)}},_=async w=>{w.preventDefault();try{const{error:y}=await C.from("sample_batches").insert([{product_id:s,...r,quantity:parseFloat(r.quantity)||0,rating:parseInt(r.rating.toString())||5,created_by:l?.id}]);if(y)throw y;v({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5}),m(!1),f()}catch(y){console.error("Error adding batch:",y)}},N=w=>{const y={pass:{icon:e.jsx(Y,{className:"w-4 h-4"}),color:"bg-sage text-white"},fail:{icon:e.jsx(Me,{className:"w-4 h-4"}),color:"bg-soft-red text-white"},pending:{icon:e.jsx(de,{className:"w-4 h-4"}),color:"bg-accent text-white"}};return y[w]||y.pending};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Testing & Quality Control"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Test"]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Sample Batch"]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(Ss).map(([w,y])=>{const p=h.filter(d=>d.test_category===w);return e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-xl font-bold text-primary mb-4 capitalize",children:[w," Testing"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.map(d=>{const k=p.find(M=>M.test_type===d),g=k?N(k.result):null;return e.jsxs("div",{className:`p-4 rounded-xl border-2 ${k?k.result==="pass"?"border-sage/30 bg-sage/5":k.result==="fail"?"border-soft-red/30 bg-soft-red/5":"border-accent/30 bg-accent/5":"border-dark-brown/10 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!k,readOnly:!0,className:"w-5 h-5 rounded border-2 border-dark-brown/20"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:d})]}),g&&e.jsxs("span",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${g.color}`,children:[g.icon,k.result.toUpperCase()]})]}),k&&e.jsxs("div",{className:"ml-7 space-y-1 text-sm",children:[k.target_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Target:"})," ",k.target_value]}),k.actual_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Actual:"})," ",k.actual_value]}),e.jsxs("p",{className:"text-dark-brown/60",children:["Tested on ",R(new Date(k.test_date),"MMM dd, yyyy")]}),k.notes&&e.jsx("p",{className:"text-dark-brown/70 italic",children:k.notes})]})]},d)})})]},w)})}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h4",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Sample Batches"}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(w=>e.jsxs("div",{className:"p-4 bg-white rounded-xl border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-dark-brown text-lg",children:w.batch_number}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[w.quantity," ",w.unit," â€¢ ",w.purpose]})]}),w.rating&&e.jsx("div",{className:"flex gap-0.5",children:[...Array(5)].map((y,p)=>e.jsx("span",{className:p<w.rating?"text-accent":"text-dark-brown/20",children:"â˜…"},p))})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Date:"})," ",R(new Date(w.batch_date),"MMM dd, yyyy")]}),w.given_to&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Given to:"})," ",w.given_to]}),w.feedback&&e.jsxs("p",{className:"text-dark-brown/70 italic",children:['"',w.feedback,'"']})]})]},w.id))}):e.jsx("p",{className:"text-center py-8 text-dark-brown/50",children:"No sample batches recorded yet"})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Test Result"})}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Category"}),e.jsxs("select",{required:!0,value:t.test_category,onChange:w=>x({...t,test_category:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"stability",children:"Stability Testing"}),e.jsx("option",{value:"safety",children:"Safety Testing"}),e.jsx("option",{value:"performance",children:"Performance Testing"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Test Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:t.test_type,onChange:w=>x({...t,test_type:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select test type"}),Ss[t.test_category]?.map(w=>e.jsx("option",{value:w,children:w},w))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Value"}),e.jsx("input",{type:"text",value:t.target_value,onChange:w=>x({...t,target_value:w.target.value}),placeholder:"e.g., pH 5.5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Actual Value"}),e.jsx("input",{type:"text",value:t.actual_value,onChange:w=>x({...t,actual_value:w.target.value}),placeholder:"e.g., pH 5.6",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Result"}),e.jsxs("select",{value:t.result,onChange:w=>x({...t,result:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"pass",children:"Pass"}),e.jsx("option",{value:"fail",children:"Fail"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Date"}),e.jsx("input",{type:"date",value:t.test_date,onChange:w=>x({...t,test_date:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:t.notes,onChange:w=>x({...t,notes:w.target.value}),rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Test"})]})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Sample Batch"})}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.batch_number,onChange:w=>v({...r,batch_number:w.target.value}),placeholder:"e.g., BATCH-001",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Date"}),e.jsx("input",{type:"date",value:r.batch_date,onChange:w=>v({...r,batch_date:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:r.quantity,onChange:w=>v({...r,quantity:w.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("input",{type:"text",value:r.unit,onChange:w=>v({...r,unit:w.target.value}),placeholder:"units/ml/g",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Purpose"}),e.jsxs("select",{value:r.purpose,onChange:w=>v({...r,purpose:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"testing",children:"Testing"}),e.jsx("option",{value:"sampling",children:"Sampling"}),e.jsx("option",{value:"gifting",children:"Gifting"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Given To"}),e.jsx("input",{type:"text",value:r.given_to,onChange:w=>v({...r,given_to:w.target.value}),placeholder:"Names of recipients",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Feedback"}),e.jsx("textarea",{value:r.feedback,onChange:w=>v({...r,feedback:w.target.value}),placeholder:"User feedback...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(w=>e.jsx("button",{type:"button",onClick:()=>v({...r,rating:w}),className:`text-3xl ${w<=r.rating?"text-accent":"text-dark-brown/20"}`,children:"â˜…"},w))})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Batch"})]})]})]})})]})}function sn({productId:s}){const{user:l}=H(),[h,b]=i.useState([]),[c,n]=i.useState(!1),[a,o]=i.useState({version_name:"",image_url:"",specifications:{}});i.useEffect(()=>{u()},[s]);const u=async()=>{try{const{data:r,error:v}=await C.from("packaging_designs").select("*").eq("product_id",s).order("created_at",{ascending:!1});if(v)throw v;b(r||[])}catch(r){console.error("Error fetching designs:",r)}},m=async r=>{r.preventDefault();try{const{error:v}=await C.from("packaging_designs").insert([{product_id:s,...a,uploaded_by:l?.id}]);if(v)throw v;o({version_name:"",image_url:"",specifications:{}}),n(!1),u()}catch(v){console.error("Error adding design:",v)}},t=async r=>{const v=h.find(N=>N.id===r);if(!v)return;const f=v.votes||[],_=f.includes(l?.id)?f.filter(N=>N!==l?.id):[...f,l?.id];try{const{error:N}=await C.from("packaging_designs").update({votes:_}).eq("id",r);if(N)throw N;u()}catch(N){console.error("Error voting:",N)}},x=r=>{const v={under_review:{color:"bg-accent",text:"Under Review"},approved:{color:"bg-sage",text:"Approved"},rejected:{color:"bg-soft-red",text:"Rejected"}};return v[r]||v.under_review};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Packaging Designs"}),e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Upload Design"]})]}),h.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(r=>{const v=x(r.status),f=r.votes||[];return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all",children:[r.image_url?e.jsx("div",{className:"aspect-square bg-cream/30",children:e.jsx("img",{src:r.image_url,alt:r.version_name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-cream/50 to-accent/10 flex items-center justify-center",children:e.jsx("span",{className:"text-6xl",children:"ðŸ“¦"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-bold text-dark-brown",children:r.version_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold text-white ${v.color}`,children:v.text})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>t(r.id),className:`flex items-center gap-1 px-3 py-2 rounded-lg font-semibold transition-all ${f.includes(l?.id)?"bg-accent text-white":"bg-accent/10 text-accent hover:bg-accent/20"}`,children:[e.jsx(Ja,{className:"w-4 h-4"}),f.length]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:[e.jsx(Ue,{className:"w-4 h-4"}),"View"]}),e.jsx("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]})]})]},r.id)})}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“¦"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No packaging designs uploaded yet"}),e.jsx("button",{onClick:()=>n(!0),className:"px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload First Design"})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-secondary to-accent p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload Design"})}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Design Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:a.version_name,onChange:r=>o({...a,version_name:r.target.value}),placeholder:"e.g., Design A",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Image URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:a.image_url,onChange:r=>o({...a,image_url:r.target.value}),placeholder:"https://example.com/design.jpg",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload Design"})]})]})]})})]})}const Wt=["Research","Formula","Packaging","Production","Marketing","Other"],an=["high","medium","low"],rn=["todo","in_progress","completed","blocked"];function nn({productId:s}){const{user:l}=H(),[h,b]=i.useState([]),[c,n]=i.useState([]),[a,o]=i.useState(!1),[u,m]=i.useState({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"});i.useEffect(()=>{t()},[s]);const t=async()=>{try{const[w,y]=await Promise.all([C.from("product_tasks").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(w.error)throw w.error;if(y.error)throw y.error;b(w.data||[]),n(y.data||[])}catch(w){console.error("Error fetching data:",w)}},x=async w=>{w.preventDefault();try{const{error:y}=await C.from("product_tasks").insert([{product_id:s,...u,created_by:l?.id}]);if(y)throw y;m({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"}),o(!1),t()}catch(y){console.error("Error adding task:",y)}},r=async(w,y)=>{try{const p={status:y};y==="completed"&&(p.completed_at=new Date().toISOString());const{error:d}=await C.from("product_tasks").update(p).eq("id",w);if(d)throw d;t()}catch(p){console.error("Error updating task:",p)}},v=w=>{const y={todo:{color:"bg-dark-brown/20 text-dark-brown",text:"To Do"},in_progress:{color:"bg-accent text-white",text:"In Progress"},completed:{color:"bg-sage text-white",text:"Completed"},blocked:{color:"bg-soft-red text-white",text:"Blocked"}};return y[w]||y.todo},f=w=>{const y={high:"border-l-soft-red",medium:"border-l-accent",low:"border-l-sage"};return y[w]||y.medium},j=w=>c.find(p=>p.id===w)?.name||"Unassigned",_=Wt.reduce((w,y)=>(w[y]=h.filter(p=>p.category===y),w),{}),N={total:h.length,completed:h.filter(w=>w.status==="completed").length,inProgress:h.filter(w=>w.status==="in_progress").length,overdue:h.filter(w=>w.due_date&&new Date(w.due_date)<new Date&&w.status!=="completed").length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Tasks & Checklist"}),e.jsxs("p",{className:"text-dark-brown/60 text-sm mt-1",children:[N.completed,"/",N.total," tasks completed"]})]}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Task"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-4 border-2 border-primary/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Total Tasks"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:N.total})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:N.inProgress})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-4 border-2 border-sage/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:N.completed})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-xl p-4 border-2 border-soft-red/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Overdue"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:N.overdue})]})]}),e.jsx("div",{className:"space-y-6",children:Wt.map(w=>{const y=_[w]||[];return y.length===0?null:e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary mb-4 flex items-center gap-2",children:[w," Tasks",e.jsx("span",{className:"px-2 py-1 bg-primary/10 rounded-full text-sm",children:y.length})]}),e.jsx("div",{className:"space-y-3",children:y.map(p=>{const d=v(p.status),k=f(p.priority),g=p.due_date&&new Date(p.due_date)<new Date&&p.status!=="completed";return e.jsx("div",{className:`bg-white p-4 rounded-xl border-l-4 ${k} shadow-sm hover:shadow-soft transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("input",{type:"checkbox",checked:p.status==="completed",onChange:()=>r(p.id,p.status==="completed"?"todo":"completed"),className:"w-5 h-5 mt-0.5 rounded border-2 border-dark-brown/20 cursor-pointer"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:`font-semibold text-dark-brown mb-1 ${p.status==="completed"?"line-through opacity-60":""}`,children:p.title}),p.description&&e.jsx("p",{className:"text-sm text-dark-brown/70 mb-2",children:p.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-dark-brown/60",children:[p.assigned_to&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-3 h-3"}),j(p.assigned_to)]}),p.due_date&&e.jsxs("span",{className:`flex items-center gap-1 ${g?"text-soft-red font-semibold":""}`,children:[e.jsx(De,{className:"w-3 h-3"}),R(new Date(p.due_date),"MMM dd"),g&&" (Overdue)"]})]})]})]}),e.jsx("select",{value:p.status,onChange:M=>r(p.id,M.target.value),className:`px-3 py-1 rounded-full text-xs font-semibold ${d.color} cursor-pointer`,children:rn.map(M=>e.jsx("option",{value:M,children:v(M).text},M))})]})},p.id)})})]},w)})}),h.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"âœ…"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No tasks created yet"}),e.jsx("button",{onClick:()=>o(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Create First Task"})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-sage p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add New Task"})}),e.jsxs("form",{onSubmit:x,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Task Title ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:u.title,onChange:w=>m({...u,title:w.target.value}),placeholder:"e.g., Complete pH testing",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:u.description,onChange:w=>m({...u,description:w.target.value}),placeholder:"Task description...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:u.category,onChange:w=>m({...u,category:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Wt.map(w=>e.jsx("option",{value:w,children:w},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("select",{value:u.priority,onChange:w=>m({...u,priority:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:an.map(w=>e.jsx("option",{value:w,children:w.charAt(0).toUpperCase()+w.slice(1)},w))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign To"}),e.jsxs("select",{value:u.assigned_to,onChange:w=>m({...u,assigned_to:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Unassigned"}),c.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:u.due_date,onChange:w=>m({...u,due_date:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Task"})]})]})]})})]})}function ln({productId:s}){const{user:l}=H(),[h,b]=i.useState([]),[c,n]=i.useState([]),[a,o]=i.useState("");i.useEffect(()=>{u();const j=m();return()=>{j.unsubscribe()}},[s]);const u=async()=>{try{const[j,_]=await Promise.all([C.from("product_comments").select("*").eq("product_id",s).is("parent_comment_id",null).order("created_at",{ascending:!0}),C.from("users").select("*")]);if(j.error)throw j.error;if(_.error)throw _.error;b(j.data||[]),n(_.data||[])}catch(j){console.error("Error fetching data:",j)}},m=()=>C.channel(`product_comments:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"product_comments",filter:`product_id=eq.${s}`},()=>{u()}).subscribe(),t=async j=>{if(j.preventDefault(),!!a.trim())try{const{error:_}=await C.from("product_comments").insert([{product_id:s,user_id:l?.id,text:a}]);if(_)throw _;o("")}catch(_){console.error("Error adding comment:",_)}},x=async(j,_)=>{const N=h.find(d=>d.id===j);if(!N)return;const w=N.reactions||[],y=w.find(d=>d.userId===l?.id&&d.emoji===_);let p;y?p=w.filter(d=>!(d.userId===l?.id&&d.emoji===_)):p=[...w,{userId:l?.id,emoji:_}];try{const{error:d}=await C.from("product_comments").update({reactions:p}).eq("id",j);if(d)throw d}catch(d){console.error("Error updating reaction:",d)}},r=j=>c.find(_=>_.id===j),v=j=>j.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),f=j=>{const _={};return j.forEach(N=>{_[N.emoji]||(_[N.emoji]=[]),_[N.emoji].push(N.userId)}),_};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Team Discussion"}),e.jsx("form",{onSubmit:t,className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:l?.name?v(l.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:a,onChange:j=>o(j.target.value),placeholder:"Share your thoughts, ask questions, or provide updates...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Add emoji",children:e.jsx(Zs,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Attach file",children:e.jsx(os,{className:"w-5 h-5"})})]}),e.jsxs("button",{type:"submit",disabled:!a.trim(),className:"flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ys,{className:"w-5 h-5"}),"Send"]})]})]})]})}),e.jsx("div",{className:"space-y-4",children:h.map(j=>{const _=r(j.user_id),N=f(j.reactions||[]);return e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-dark-brown/5 hover:border-accent/20 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:_?v(_.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:_?.name||"Unknown"}),e.jsx("span",{className:"text-sm text-dark-brown/50",children:R(new Date(j.created_at),"MMM dd, yyyy HH:mm")})]}),e.jsx("p",{className:"text-dark-brown/80 leading-relaxed mb-3",children:j.text}),Object.keys(N).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(N).map(([w,y])=>e.jsxs("button",{onClick:()=>x(j.id,w),className:`flex items-center gap-1 px-3 py-1 rounded-full text-sm transition-all ${y.includes(l?.id||"")?"bg-accent/20 border-2 border-accent":"bg-dark-brown/5 border-2 border-transparent hover:border-accent/30"}`,children:[e.jsx("span",{children:w}),e.jsx("span",{className:"font-semibold text-dark-brown",children:y.length})]},w))}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("button",{className:"hover:text-accent transition-colors",children:[e.jsx(Va,{className:"w-4 h-4 inline mr-1"}),"Reply"]}),e.jsx("button",{onClick:()=>x(j.id,"ðŸ‘"),className:"hover:text-accent transition-colors",children:"ðŸ‘ Like"}),e.jsx("button",{onClick:()=>x(j.id,"â¤ï¸"),className:"hover:text-accent transition-colors",children:"â¤ï¸ Love"}),e.jsx("button",{onClick:()=>x(j.id,"ðŸŽ‰"),className:"hover:text-accent transition-colors",children:"ðŸŽ‰ Celebrate"})]})]})]})},j.id)})}),h.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ’¬"}),e.jsx("p",{className:"text-dark-brown/60",children:"No comments yet. Start the discussion!"})]})]})}const Gt=[{name:"Formulas",icon:"âš—ï¸"},{name:"Test Reports",icon:"ðŸ§ª"},{name:"Packaging Designs",icon:"ðŸ“¦"},{name:"Certificates",icon:"ðŸ†"},{name:"Marketing Materials",icon:"ðŸ“¢"},{name:"Legal Documents",icon:"ðŸ“‹"},{name:"Research Papers",icon:"ðŸ“š"},{name:"Photos",icon:"ðŸ“¸"}];function on({productId:s}){const{user:l}=H(),[h,b]=i.useState([]),[c,n]=i.useState([]),[a,o]=i.useState(null),[u,m]=i.useState(!1),[t,x]=i.useState({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"});i.useEffect(()=>{r()},[s]);const r=async()=>{try{const[p,d]=await Promise.all([C.from("product_files").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*")]);if(p.error)throw p.error;if(d.error)throw d.error;b(p.data||[]),n(d.data||[])}catch(p){console.error("Error fetching data:",p)}},v=async p=>{p.preventDefault();try{const{error:d}=await C.from("product_files").insert([{product_id:s,...t,file_size:0,uploaded_by:l?.id}]);if(d)throw d;x({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"}),m(!1),r()}catch(d){console.error("Error uploading file:",d)}},f=async p=>{if(confirm("Are you sure you want to delete this file?"))try{const{error:d}=await C.from("product_files").delete().eq("id",p);if(d)throw d;r()}catch(d){console.error("Error deleting file:",d)}},j=p=>c.find(k=>k.id===p)?.name||"Unknown",_=p=>p.startsWith("image/")?e.jsx(ns,{className:"w-6 h-6"}):p==="application/pdf"?e.jsx(ae,{className:"w-6 h-6"}):e.jsx(zs,{className:"w-6 h-6"}),N=a?h.filter(p=>p.category===a):h,w=Gt.reduce((p,d)=>(p[d.name]=h.filter(k=>k.category===d.name).length,p),{}),y=p=>{if(p===0)return"0 KB";const d=1024,k=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(p)/Math.log(d));return Math.round(p/Math.pow(d,g)*100)/100+" "+k[g]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Files & Documents"}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Upload File"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Gt.map(p=>e.jsxs("button",{onClick:()=>o(a===p.name?null:p.name),className:`p-4 rounded-xl border-2 transition-all ${a===p.name?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:p.icon}),e.jsx("span",{className:"font-semibold text-dark-brown text-sm",children:p.name})]}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:w[p.name]||0})]},p.name))}),a&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Os,{className:"w-4 h-4 text-accent"}),e.jsxs("span",{className:"text-dark-brown",children:["Showing files in: ",e.jsx("strong",{children:a})]}),e.jsx("button",{onClick:()=>o(null),className:"text-accent hover:underline",children:"Clear filter"})]}),N.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(p=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border-2 border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center text-accent flex-shrink-0",children:_(p.file_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",title:p.file_name,children:p.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:p.category})]})]}),e.jsxs("div",{className:"text-xs text-dark-brown/60 space-y-1 mb-3",children:[e.jsxs("p",{children:["Uploaded by ",j(p.uploaded_by)]}),e.jsx("p",{children:R(new Date(p.created_at),"MMM dd, yyyy")}),p.file_size>0&&e.jsx("p",{children:y(p.file_size)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:p.file_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{onClick:()=>f(p.id),className:"px-3 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]},p.id))}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:a?`No files in ${a} yet`:"No files uploaded yet"}),e.jsx("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload Your First File"})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload File"})}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{required:!0,value:t.category,onChange:p=>x({...t,category:p.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Gt.map(p=>e.jsxs("option",{value:p.name,children:[p.icon," ",p.name]},p.name))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:t.file_name,onChange:p=>x({...t,file_name:p.target.value}),placeholder:"e.g., Formula v1.0.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:t.file_url,onChange:p=>x({...t,file_url:p.target.value}),placeholder:"https://example.com/file.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Enter the direct URL to your file"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"File Type"}),e.jsxs("select",{value:t.file_type,onChange:p=>x({...t,file_type:p.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"application/pdf",children:"PDF Document"}),e.jsx("option",{value:"image/jpeg",children:"JPEG Image"}),e.jsx("option",{value:"image/png",children:"PNG Image"}),e.jsx("option",{value:"application/msword",children:"Word Document"}),e.jsx("option",{value:"application/vnd.ms-excel",children:"Excel Spreadsheet"}),e.jsx("option",{value:"text/plain",children:"Text File"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload File"})]})]})]})})]})}const dn=[{id:"overview",name:"Overview",icon:ae},{id:"ingredients",name:"Ingredients & Formula",icon:He},{id:"testing",name:"Testing & Quality",icon:Xs},{id:"packaging",name:"Packaging",icon:le},{id:"tasks",name:"Tasks & Checklist",icon:rs},{id:"discussion",name:"Team Discussion",icon:$t},{id:"files",name:"Files & Documents",icon:Os}],St=[{id:"idea",name:"Idea",color:"bg-sage"},{id:"research",name:"Research",color:"bg-sage"},{id:"formula",name:"Formula Creation",color:"bg-accent"},{id:"testing",name:"Testing",color:"bg-accent"},{id:"packaging",name:"Packaging Design",color:"bg-secondary"},{id:"printing",name:"Printing",color:"bg-secondary"},{id:"production",name:"Production",color:"bg-secondary"},{id:"ready",name:"Ready to Launch",color:"bg-primary"},{id:"launched",name:"Launched",color:"bg-primary"}];function cn(){const{id:s}=Je(),l=ce(),{user:h}=H(),[b,c]=i.useState("overview"),[n,a]=i.useState(null),[o,u]=i.useState([]),[m,t]=i.useState(!0),[x,r]=i.useState(!1);i.useEffect(()=>{s&&v()},[s]);const v=async()=>{try{const[p,d]=await Promise.all([C.from("products").select("*").eq("id",s).single(),C.from("users").select("id, name, email").order("name")]);if(p.error)throw p.error;if(d.error)throw d.error;a(p.data),u(d.data||[])}catch(p){console.error("Error fetching data:",p)}finally{t(!1)}},f=v,j=async()=>{if(!n)return;const p=St.findIndex(k=>k.id===n.current_stage);if(p===-1||p===St.length-1)return;const d=St[p+1];if(!(d.id==="launched"&&!window.confirm(`Are you sure you want to launch "${n.name}"? This marks it as complete.`)))try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",n.id).is("exited_at",null),await C.from("products").update({current_stage:d.id,stage_entered_at:new Date().toISOString(),progress:d.id==="launched"?100:n.progress}).eq("id",n.id),await C.from("product_stage_history").insert([{product_id:n.id,stage:d.id,moved_by:h?.id}]),await f()}catch(k){console.error("Error moving product:",k)}},_=async(p,d)=>{try{const{error:k}=await C.from("products").update({...d,updated_at:new Date().toISOString()}).eq("id",p);if(k)throw k;await C.from("activity_log").insert({user_id:h?.id,activity_type:"product_updated",description:`${h?.name} updated product: ${d.name}`}),await f()}catch(k){throw console.error("Error updating product:",k),k}},N=p=>{const d={high:{color:"bg-soft-red",text:"HIGH"},medium:{color:"bg-accent",text:"MEDIUM"},low:{color:"bg-sage",text:"LOW"}};return d[p]||d.medium};if(m)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Loading product..."})})});if(!n)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Product not found"})})});const w=St.find(p=>p.id===n.current_stage),y=N(n.priority);return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/products"),className:"flex items-center gap-2 text-dark-brown/70 hover:text-primary mb-6 transition-colors",children:[e.jsx(Be,{className:"w-5 h-5"}),"Back to Pipeline"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-3",children:n.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-semibold",children:n.category}),e.jsx("span",{className:`px-3 py-1 ${y.color} text-white rounded-full text-sm font-semibold`,children:y.text}),w&&e.jsx("span",{className:`px-4 py-1 ${w.color} text-white rounded-full text-sm font-semibold`,children:w.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Stage Progress"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[n.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${n.progress}%`}})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(ge,{className:"w-5 h-5"}),"Edit"]}),e.jsxs("button",{onClick:j,disabled:n.current_stage==="launched",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ss,{className:"w-5 h-5"}),"Move to Next Stage"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(Ga,{className:"w-5 h-5"}),"Share"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-xl font-semibold transition-colors",children:[e.jsx(Ma,{className:"w-5 h-5"}),"Archive"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex min-w-max",children:dn.map(p=>{const d=p.icon;return e.jsxs("button",{onClick:()=>c(p.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all duration-300 border-b-4 ${b===p.id?"border-accent text-accent bg-accent/5":"border-transparent text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(d,{className:"w-5 h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:p.name})]},p.id)})})})}),e.jsxs("div",{className:"p-6",children:[b==="overview"&&e.jsx(Kr,{product:n,onRefresh:f}),b==="ingredients"&&e.jsx(en,{productId:n.id}),b==="testing"&&e.jsx(tn,{productId:n.id}),b==="packaging"&&e.jsx(sn,{productId:n.id}),b==="tasks"&&e.jsx(nn,{productId:n.id}),b==="discussion"&&e.jsx(ln,{productId:n.id}),b==="files"&&e.jsx(on,{productId:n.id})]})]})]}),n&&e.jsx(aa,{isOpen:x,onClose:()=>r(!1),onSubmit:_,product:n,users:o})]})}function xn(){const{user:s}=H(),[l,h]=i.useState([]),[b,c]=i.useState(""),[n,a]=i.useState(""),[o,u]=i.useState(100),[m,t]=i.useState([]),[x,r]=i.useState([{id:"1",name:"Primary Container (Bottle/Jar)",quantity:1,costPerPiece:0,total:0},{id:"2",name:"Label/Sticker",quantity:1,costPerPiece:0,total:0},{id:"3",name:"Secondary Packaging (Box)",quantity:1,costPerPiece:0,total:0}]),[v,f]=i.useState([]),[j,_]=i.useState(0),[N,w]=i.useState(0),[y,p]=i.useState(0),[d,k]=i.useState(0),[g,M]=i.useState(0),[E,D]=i.useState(0),[I,q]=i.useState(0),[B,G]=i.useState(0),[se,ee]=i.useState(10),[S,$]=i.useState(1),[L,V]=i.useState(0),[T,z]=i.useState(10),[ie,me]=i.useState(0),[_e,jt]=i.useState(12),[Ce,We]=i.useState([]),[Xe,yt]=i.useState(0),[et,Ee]=i.useState(0),[Ae,wt]=i.useState(0),[Ie,Rt]=i.useState(0),[Ut,zt]=i.useState([]),[Bt,tt]=i.useState(!1),[Ge,P]=i.useState("");i.useEffect(()=>{O(),W()},[]),i.useEffect(()=>{b&&Nt()},[b]);const O=async()=>{try{const{data:A,error:U}=await C.from("products").select("*").order("name");if(U)throw U;h(A||[])}catch(A){console.error("Error fetching products:",A)}},W=async()=>{try{const{data:A,error:U}=await C.from("product_cost_calculations").select("*").eq("is_draft",!1).order("created_at",{ascending:!1});if(U)throw U;zt(A||[])}catch(A){console.error("Error fetching calculations:",A)}},Nt=async()=>{const A=l.find(U=>U.id===b);if(A){a(A.name);try{const{data:U}=await C.from("product_ingredients").select("*").eq("product_id",b);if(U&&U.length>0){const Z=U.map(ne=>({id:ne.id,name:ne.ingredient_name,quantity:ne.quantity||0,unit:ne.unit||"g",costPerUnit:ne.cost_per_unit||0,total:(ne.quantity||0)*(ne.cost_per_unit||0)}));t(Z)}}catch(U){console.error("Error loading product data:",U)}}},Ot=()=>{t([...m,{id:Date.now().toString(),name:"",quantity:0,unit:"g",costPerUnit:0,total:0}])},Qe=(A,U,Z)=>{t(m.map(ne=>{if(ne.id===A){const pe={...ne,[U]:Z};return pe.total=pe.quantity*pe.costPerUnit,pe}return ne}))},ra=A=>{t(m.filter(U=>U.id!==A))},ds=(A,U,Z)=>{r(x.map(ne=>{if(ne.id===A){const pe={...ne,[U]:Z};return pe.total=pe.quantity*pe.costPerPiece,pe}return ne}))},na=()=>{f([...v,{id:Date.now().toString(),description:"",amount:0}])},la=()=>{We([...Ce,{id:Date.now().toString(),description:"",amount:0}])},st=m.reduce((A,U)=>A+U.total,0),at=[...x.map(A=>A.total),...v.map(A=>A.amount)].reduce((A,U)=>A+U,0),Vt=j*N,cs=y+d+g+E,rt=Vt+cs+I,Ht=S>0?B*se/100/S:0,xs=S>0?L*T/100/S:0,ms=_e>0?ie/_e:0,oa=Ce.reduce((A,U)=>A+U.amount,0),nt=Ht+xs+ms+oa,hs=et+Ae,lt=(Xe+hs)*o,vt=st+at+rt+nt+lt,ot=o>0?vt/o:0,kt=[{name:"Raw Materials",value:st,color:"#8B4513"},{name:"Packaging",value:at,color:"#D2691E"},{name:"Manufacturing",value:rt,color:"#CD853F"},{name:"Overheads",value:nt,color:"#DEB887"},{name:"Marketing",value:lt,color:"#F4A460"}].filter(A=>A.value>0),ps=A=>{const U=ot/(1-A/100),Z=U*.18,ne=U+Z,pe=U-ot;return{sellingPrice:U,gst:Z,mrp:ne,profit:pe,marginPercent:A}},bs=[30,40,50,60].map(A=>ps(A)),ia=async()=>{if(!Ge.trim()){alert("Please enter a calculation name");return}try{const A={product_id:b||null,calculation_name:Ge,batch_size:o,raw_material_costs:{ingredients:m,subtotal:st},packaging_costs:{components:x,other:v,subtotal:at},manufacturing_costs:{labour:Vt,utilities:cs,qc:I,subtotal:rt},overhead_costs:{rent:Ht,salaries:xs,compliance:ms,other:Ce,subtotal:nt},marketing_costs:{marketing:Xe*o,fulfillment:hs*o,subtotal:lt},total_cost:vt,cost_per_unit:ot,margin_scenarios:bs,saved_by:s?.id,is_draft:!1},{error:U}=await C.from("product_cost_calculations").insert([A]);if(U)throw U;tt(!1),P(""),W(),alert("Calculation saved successfully!")}catch(A){console.error("Error saving calculation:",A),alert("Error saving calculation")}};return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Product Cost Calculator"}),e.jsx("p",{className:"text-dark-brown/70",children:"Calculate unit economics and pricing strategy"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>tt(!0),className:"flex items-center gap-2 px-6 py-3 bg-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all hover:bg-accent/90",children:[e.jsx(Qs,{className:"w-5 h-5"}),"Save Calculation"]}),e.jsxs("button",{className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export PDF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Select Product (Optional)"}),e.jsxs("select",{value:b,onChange:A=>c(A.target.value),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Calculate for new product"}),l.map(A=>e.jsx("option",{value:A.id,children:A.name},A.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Load Saved Calculation"}),e.jsxs("select",{className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select saved calculation..."}),Ut.map(A=>e.jsxs("option",{value:A.id,children:[A.calculation_name," - ",new Date(A.created_at).toLocaleDateString()]},A.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Batch Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Name"}),e.jsx("input",{type:"text",value:n,onChange:A=>a(A.target.value),placeholder:"Enter product name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Size (Units)"}),e.jsx("input",{type:"number",value:o,onChange:A=>u(parseInt(A.target.value)||0),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Raw Materials"}),e.jsxs("button",{onClick:Ot,className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Ingredient"]})]}),e.jsx("div",{className:"space-y-3",children:m.map(A=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:A.name,onChange:U=>Qe(A.id,"name",U.target.value),placeholder:"Ingredient name",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:A.quantity,onChange:U=>Qe(A.id,"quantity",parseFloat(U.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:A.unit,onChange:U=>Qe(A.id,"unit",U.target.value),className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"ml",children:"ml"}),e.jsx("option",{value:"L",children:"L"})]}),e.jsx("input",{type:"number",value:A.costPerUnit,onChange:U=>Qe(A.id,"costPerUnit",parseFloat(U.target.value)||0),placeholder:"â‚¹/unit",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-2 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",A.total.toFixed(2)]}),e.jsx("button",{onClick:()=>ra(A.id),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]},A.id))}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Raw Material Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",st.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(st/o).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Packaging Costs"}),e.jsx("div",{className:"space-y-3 mb-4",children:x.map(A=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("span",{className:"col-span-4 text-sm font-semibold text-dark-brown",children:A.name}),e.jsx("input",{type:"number",value:A.quantity,onChange:U=>ds(A.id,"quantity",parseFloat(U.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:A.costPerPiece,onChange:U=>ds(A.id,"costPerPiece",parseFloat(U.target.value)||0),placeholder:"â‚¹/piece",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-3 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",(A.total*o).toFixed(2)]})]},A.id))}),e.jsx("button",{onClick:na,className:"text-sm text-accent hover:underline mb-3",children:"+ Add other packaging material"}),v.map(A=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center mb-2",children:[e.jsx("input",{type:"text",value:A.description,onChange:U=>f(v.map(Z=>Z.id===A.id?{...Z,description:U.target.value}:Z)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:A.amount,onChange:U=>f(v.map(Z=>Z.id===A.id?{...Z,amount:parseFloat(U.target.value)||0}:Z)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>f(v.filter(U=>U.id!==A.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]},A.id)),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Packaging Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",at.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(at/o).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Manufacturing Costs"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Labour Hours"}),e.jsx("input",{type:"number",value:j,onChange:A=>_(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Hour (â‚¹)"}),e.jsx("input",{type:"number",value:N,onChange:A=>w(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Labour: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",Vt.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Electricity (â‚¹)"}),e.jsx("input",{type:"number",value:y,onChange:A=>p(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Water (â‚¹)"}),e.jsx("input",{type:"number",value:d,onChange:A=>k(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Equipment Depreciation (â‚¹)"}),e.jsx("input",{type:"number",value:g,onChange:A=>M(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Other Utilities (â‚¹)"}),e.jsx("input",{type:"number",value:E,onChange:A=>D(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC/Testing Cost (â‚¹)"}),e.jsx("input",{type:"number",value:I,onChange:A=>q(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Manufacturing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",rt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(rt/o).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Overhead Allocation"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Rent (â‚¹)"}),e.jsx("input",{type:"number",value:B,onChange:A=>G(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation to this product: ",se,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:se,onChange:A=>ee(parseInt(A.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batches per Month"}),e.jsx("input",{type:"number",value:S,onChange:A=>$(parseInt(A.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Rent per batch: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",Ht.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Salaries (â‚¹)"}),e.jsx("input",{type:"number",value:L,onChange:A=>V(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation: ",T,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:T,onChange:A=>z(parseInt(A.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Compliance (â‚¹)"}),e.jsx("input",{type:"number",value:ie,onChange:A=>me(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Batches"}),e.jsx("input",{type:"number",value:_e,onChange:A=>jt(parseInt(A.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsx("button",{onClick:la,className:"text-sm text-accent hover:underline",children:"+ Add other overhead"}),Ce.map(A=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:A.description,onChange:U=>We(Ce.map(Z=>Z.id===A.id?{...Z,description:U.target.value}:Z)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:A.amount,onChange:U=>We(Ce.map(Z=>Z.id===A.id?{...Z,amount:parseFloat(U.target.value)||0}:Z)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>We(Ce.filter(U=>U.id!==A.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]},A.id))]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Overhead Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",nt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(nt/o).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Marketing & Distribution"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Marketing per Unit (â‚¹)"}),e.jsx("input",{type:"number",value:Xe,onChange:A=>yt(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Ads, samples, packaging inserts, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Shipping Material (â‚¹)"}),e.jsx("input",{type:"number",value:et,onChange:A=>Ee(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Courier Charges (â‚¹)"}),e.jsx("input",{type:"number",value:Ae,onChange:A=>wt(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Platform Fees (%)"}),e.jsx("input",{type:"number",value:Ie,onChange:A=>Rt(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Marketing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",lt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(lt/o).toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-2xl shadow-soft-lg p-6 text-white sticky top-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx($s,{className:"w-8 h-8"}),e.jsx("h3",{className:"font-heading text-2xl font-bold",children:"Cost Summary"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Total Batch Cost"}),e.jsxs("p",{className:"text-4xl font-bold",children:["â‚¹",vt.toFixed(2)]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-white/20 rounded-xl backdrop-blur-sm",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Cost Per Unit"}),e.jsxs("p",{className:"text-5xl font-bold",children:["â‚¹",ot.toFixed(2)]})]}),kt.length>0&&e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 backdrop-blur-sm",children:[e.jsx("p",{className:"text-sm font-semibold mb-3",children:"Cost Breakdown"}),e.jsx(be,{width:"100%",height:200,children:e.jsxs(At,{children:[e.jsx(It,{data:kt,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:kt.map((A,U)=>e.jsx(Tt,{fill:A.color},`cell-${U}`))}),e.jsx(ye,{formatter:A=>`â‚¹${A.toFixed(2)}`,contentStyle:{background:"#fff",border:"none",borderRadius:"8px"}})]})}),e.jsx("div",{className:"space-y-2 mt-3",children:kt.map((A,U)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:A.color}}),e.jsx("span",{children:A.name})]}),e.jsxs("span",{className:"font-semibold",children:[(A.value/vt*100).toFixed(1),"%"]})]},U))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Pricing Strategy"}),e.jsx("div",{className:"space-y-4",children:bs.map((A,U)=>e.jsxs("div",{className:"p-4 bg-gradient-to-br from-cream/50 to-white rounded-xl border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-bold text-lg text-primary",children:[A.marginPercent,"% Margin"]}),e.jsxs("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-sm font-semibold",children:["Profit: â‚¹",A.profit.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Selling Price (ex-GST):"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",A.sellingPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"GST @ 18%:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",A.gst.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"font-bold text-dark-brown",children:"MRP (incl. GST):"}),e.jsxs("span",{className:"font-bold text-xl text-sage",children:["â‚¹",A.mrp.toFixed(2)]})]})]})]},U))})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Profitability Scenarios"}),e.jsx("div",{className:"space-y-3",children:[100,500,1e3,5e3].map(A=>{const U=A*ps(40).mrp,Z=A*ot,ne=U-Z,pe=Z>0?ne/U*100:0;return e.jsxs("div",{className:"p-3 bg-cream/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-dark-brown",children:[A," units"]}),e.jsxs("span",{className:`text-sm font-bold ${ne>0?"text-sage":"text-soft-red"}`,children:[ne>0?"+":"","â‚¹",ne.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60",children:[e.jsxs("span",{children:["Revenue: â‚¹",U.toFixed(0)]}),e.jsxs("span",{children:["Margin: ",pe.toFixed(1),"%"]})]})]},A)})})]})]})]})]}),Bt&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Save Calculation"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Calculation Name"}),e.jsx("input",{type:"text",value:Ge,onChange:A=>P(A.target.value),placeholder:"e.g., Neem Face Wash v1.0 - 100 unit batch",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>tt(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:ia,className:"flex-1 px-6 py-3 bg-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all hover:bg-accent/90",children:"Save"})]})]})})]})}const mn=["Raw Materials","Packaging","Printing","Logistics","Lab Testing","Equipment","Other"],hn=["Immediate","7 days","15 days","30 days","45 days","60 days","Custom"];function pn({onClose:s,onSuccess:l}){const{user:h}=H(),[b,c]=i.useState(!1),[n,a]=i.useState({name:"",category:"Raw Materials",products:"",contactPerson:"",phone:"",email:"",alternatePhone:"",address:"",gstNumber:"",website:"",paymentTerms:"30 days",bankName:"",accountNumber:"",ifscCode:"",initialRating:3,notes:""}),[o,u]=i.useState({iso:!1,organic:!1,fssai:!1,gmp:!1,other:""}),m=async t=>{if(t.preventDefault(),!n.name||!n.phone){alert("Please fill in required fields (Name and Phone)");return}c(!0);try{const x=n.bankName?{bankName:n.bankName,accountNumber:n.accountNumber,ifscCode:n.ifscCode}:{},r=[];o.iso&&r.push("ISO Certified"),o.organic&&r.push("Organic Certified"),o.fssai&&r.push("FSSAI Approved"),o.gmp&&r.push("GMP Certified"),o.other&&r.push(o.other);const{error:v}=await C.from("vendors").insert([{name:n.name,category:n.category,products:n.products,contact_person:n.contactPerson,phone:n.phone,email:n.email,alternate_phone:n.alternatePhone,address:n.address,gst_number:n.gstNumber,website:n.website,payment_terms:n.paymentTerms,bank_details:x,certifications:r,initial_rating:n.initialRating,current_rating:n.initialRating,notes:n.notes,created_by:h?.id}]);if(v)throw v;l()}catch(x){console.error("Error adding vendor:",x),alert("Error adding vendor. Please try again.")}finally{c(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add New Vendor"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:n.name,onChange:t=>a({...n,name:t.target.value}),placeholder:"e.g., Green Valley Herbs",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:n.category,onChange:t=>a({...n,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:mn.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:n.contactPerson,onChange:t=>a({...n,contactPerson:t.target.value}),placeholder:"Contact person name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Products/Services"}),e.jsx("textarea",{value:n.products,onChange:t=>a({...n,products:t.target.value}),placeholder:"What does this vendor supply? e.g., Organic herbs, essential oils",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Contact Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Phone Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"tel",value:n.phone,onChange:t=>a({...n,phone:t.target.value}),placeholder:"+91-XXXXXXXXXX",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email"}),e.jsx("input",{type:"email",value:n.email,onChange:t=>a({...n,email:t.target.value}),placeholder:"vendor@example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Alternative Phone"}),e.jsx("input",{type:"tel",value:n.alternatePhone,onChange:t=>a({...n,alternatePhone:t.target.value}),placeholder:"Optional second number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Website"}),e.jsx("input",{type:"url",value:n.website,onChange:t=>a({...n,website:t.target.value}),placeholder:"https://example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Address"}),e.jsx("textarea",{value:n.address,onChange:t=>a({...n,address:t.target.value}),placeholder:"Street, city, state, pincode",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Business Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"GST Number"}),e.jsx("input",{type:"text",value:n.gstNumber,onChange:t=>a({...n,gstNumber:t.target.value}),placeholder:"22AAAAA0000A1Z5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Terms"}),e.jsx("select",{value:n.paymentTerms,onChange:t=>a({...n,paymentTerms:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:hn.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bank Name"}),e.jsx("input",{type:"text",value:n.bankName,onChange:t=>a({...n,bankName:t.target.value}),placeholder:"e.g., HDFC Bank",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:n.accountNumber,onChange:t=>a({...n,accountNumber:t.target.value}),placeholder:"Account number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"IFSC Code"}),e.jsx("input",{type:"text",value:n.ifscCode,onChange:t=>a({...n,ifscCode:t.target.value}),placeholder:"e.g., HDFC0001234",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality & Rating"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Initial Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>a({...n,initialRating:t}),className:"focus:outline-none",children:e.jsx(Ze,{className:`w-8 h-8 transition-colors ${t<=n.initialRating?"fill-amber-400 text-amber-400":"text-dark-brown/20 hover:text-amber-400"}`})},t)),e.jsxs("span",{className:"ml-2 text-sm font-semibold text-dark-brown",children:[n.initialRating," / 5"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Quality Certifications"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.iso,onChange:t=>u({...o,iso:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"ISO Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.organic,onChange:t=>u({...o,organic:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Organic Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.fssai,onChange:t=>u({...o,fssai:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"FSSAI Approved"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.gmp,onChange:t=>u({...o,gmp:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"GMP Certified"})]}),e.jsx("input",{type:"text",value:o.other,onChange:t=>u({...o,other:t.target.value}),placeholder:"Other certifications (comma separated)",className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Internal Notes"}),e.jsx("textarea",{value:n.notes,onChange:t=>a({...n,notes:t.target.value}),placeholder:"Any internal notes about this vendor (not visible to vendor)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:b,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:b?"Adding...":"Add Vendor"})]})]})})}const Qt=[{id:"all",label:"All Vendors",icon:"ðŸ¢",color:"bg-dark-brown/10"},{id:"Raw Materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20"},{id:"Packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-secondary/20"},{id:"Printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-blue-500/20"},{id:"Logistics",label:"Logistics",icon:"ðŸšš",color:"bg-accent/20"},{id:"Lab Testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-purple-500/20"},{id:"Other",label:"Other",icon:"ðŸ”§",color:"bg-dark-brown/20"}];function bn(){const[s,l]=i.useState([]),[h,b]=i.useState([]),[c,n]=i.useState("grid"),[a,o]=i.useState("all"),[u,m]=i.useState(""),[t,x]=i.useState(!1),[r,v]=i.useState({total:0,active:0,pendingPayments:0,avgRating:0});i.useEffect(()=>{f()},[]),i.useEffect(()=>{j()},[s,a,u]);const f=async()=>{try{const{data:y,error:p}=await C.from("vendors").select("*").order("name");if(p)throw p;const{data:d}=await C.from("vendor_transactions").select("vendor_id, amount, status"),{data:k}=await C.from("expenses").select("vendor_id, amount, status").not("vendor_id","is",null),g=(y||[]).map(q=>{const B=d?.filter(T=>T.vendor_id===q.id)||[],G=k?.filter(T=>T.vendor_id===q.id)||[],se=B.reduce((T,z)=>T+(parseFloat(z.amount)||0),0),ee=G.reduce((T,z)=>T+(parseFloat(z.amount)||0),0),S=se+ee,$=B.filter(T=>T.status==="pending").reduce((T,z)=>T+(parseFloat(z.amount)||0),0),L=G.filter(T=>T.status==="pending").reduce((T,z)=>T+(parseFloat(z.amount)||0),0),V=$+L;return{...q,totalSpent:S,pendingAmount:V}});l(g);const M=g.length,E=g.filter(q=>q.totalSpent>0).length,D=g.reduce((q,B)=>q+B.pendingAmount,0),I=g.reduce((q,B)=>q+(B.current_rating||0),0)/(M||1);v({total:M,active:E,pendingPayments:D,avgRating:I})}catch(y){console.error("Error fetching vendors:",y)}},j=()=>{let y=s;if(a!=="all"&&(y=y.filter(p=>p.category===a)),u){const p=u.toLowerCase();y=y.filter(d=>d.name?.toLowerCase().includes(p)||d.contact_person?.toLowerCase().includes(p)||d.email?.toLowerCase().includes(p)||d.phone?.includes(p))}b(y)},_=y=>Qt.find(d=>d.id===y)?.color||"bg-dark-brown/10",N=y=>Qt.find(d=>d.id===y)?.icon||"ðŸ¢",w=y=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(p=>e.jsx(Ze,{className:`w-4 h-4 ${p<=y?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},p))});return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Vendor & Supplier Directory"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your business relationships"})]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(je,{className:"w-8 h-8 text-primary"}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:r.total})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(te,{className:"w-8 h-8 text-sage"}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:r.active})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Active Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fe,{className:"w-8 h-8 text-soft-red"}),e.jsxs("span",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",r.pendingPayments.toFixed(0)]})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ye,{className:"w-8 h-8 text-amber-500"}),e.jsx("span",{className:"text-3xl font-bold text-amber-500",children:r.avgRating.toFixed(1)})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Average Rating"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-soft p-4 my-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto w-full lg:w-auto",children:Qt.map(y=>{const p=y.id==="all"?s.length:s.filter(d=>d.category===y.id).length;return e.jsxs("button",{onClick:()=>o(y.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${a===y.id?"bg-primary text-white shadow-soft":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:y.icon}),e.jsx("span",{children:y.label}),e.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded-full text-xs",children:p})]},y.id)})}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",value:u,onChange:y=>m(y.target.value),placeholder:"Search vendors...",className:"w-full pl-10 pr-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex items-center gap-1 p-1 bg-dark-brown/5 rounded-lg",children:[e.jsx("button",{onClick:()=>n("grid"),className:`p-2 rounded-lg transition-all ${c==="grid"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(Vs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>n("list"),className:`p-2 rounded-lg transition-all ${c==="list"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})})]})]})]})}),c==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(y=>e.jsxs(Ne,{to:`/vendors/${y.id}`,className:"bg-white rounded-xl shadow-soft hover:shadow-soft-lg transition-all overflow-hidden border-l-4 border-transparent hover:border-primary group",children:[e.jsx("div",{className:`h-2 ${_(y.category)}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary group-hover:text-accent transition-colors mb-1",children:y.name}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(y.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:N(y.category)}),y.category]})]})}),e.jsxs("div",{className:"flex items-center gap-1 mb-4",children:[w(y.current_rating||3),e.jsxs("span",{className:"text-sm text-dark-brown/60 ml-2",children:["(",y.current_rating?.toFixed(1)||"3.0",")"]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[y.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{children:y.phone})]}),y.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:y.email})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Total Spent"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",y.totalSpent?.toFixed(0)||"0"]})]}),y.pendingAmount>0&&e.jsxs("div",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",y.pendingAmount.toFixed(0)," due"]})]})]})]},y.id))}):e.jsx("div",{className:"bg-white rounded-xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Vendor Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Contact"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Rating"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Total Spent"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Pending"})]})}),e.jsx("tbody",{children:h.map((y,p)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${p%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx(Ne,{to:`/vendors/${y.id}`,className:"font-semibold text-primary hover:text-accent transition-colors",children:y.name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(y.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:N(y.category)}),y.category]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[y.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(bt,{className:"w-3 h-3"}),y.phone]}),y.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(Ve,{className:"w-3 h-3"}),y.email]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w(y.current_rating||3),e.jsx("span",{className:"text-sm text-dark-brown/60",children:y.current_rating?.toFixed(1)||"3.0"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",y.totalSpent?.toFixed(0)||"0"]})}),e.jsx("td",{className:"px-6 py-4",children:y.pendingAmount>0?e.jsxs("span",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",y.pendingAmount.toFixed(0)]}):e.jsx("span",{className:"text-sm text-dark-brown/40",children:"-"})})]},y.id))})]})})}),h.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:u?"Try adjusting your search":"Add your first vendor to get started"}),!u&&e.jsx("button",{onClick:()=>x(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Vendor"})]})]}),t&&e.jsx(pn,{onClose:()=>x(!1),onSuccess:()=>{x(!1),f()}})]})}function un({vendor:s}){const[l,h]=i.useState({totalSpent:0,thisMonth:0,thisYear:0,avgTransaction:0,pendingPayment:0,totalTransactions:0}),[b,c]=i.useState([]);i.useEffect(()=>{n(),a()},[s.id]);const n=async()=>{try{const{data:o}=await C.from("vendor_transactions").select("*").eq("vendor_id",s.id),{data:u}=await C.from("expenses").select("amount, expense_date, status").eq("vendor_id",s.id),m=[...(o||[]).map(N=>({amount:N.amount,date:N.date,status:N.status})),...(u||[]).map(N=>({amount:N.amount,date:N.expense_date,status:N.status}))],t=new Date,x=m.filter(N=>{const w=new Date(N.date);return w.getMonth()===t.getMonth()&&w.getFullYear()===t.getFullYear()}),r=m.filter(N=>new Date(N.date).getFullYear()===t.getFullYear()),v=m.reduce((N,w)=>N+parseFloat(w.amount),0),f=x.reduce((N,w)=>N+parseFloat(w.amount),0),j=r.reduce((N,w)=>N+parseFloat(w.amount),0),_=m.filter(N=>N.status==="pending").reduce((N,w)=>N+parseFloat(w.amount),0);h({totalSpent:v,thisMonth:f,thisYear:j,avgTransaction:m.length>0?v/m.length:0,pendingPayment:_,totalTransactions:m.length})}catch(o){console.error("Error fetching stats:",o)}},a=async()=>{try{const{data:o}=await C.from("vendor_transactions").select("date, amount").eq("vendor_id",s.id).order("date"),{data:u}=await C.from("expenses").select("expense_date, amount").eq("vendor_id",s.id).order("expense_date"),m=[...(o||[]).map(r=>({date:r.date,amount:r.amount})),...(u||[]).map(r=>({date:r.expense_date,amount:r.amount}))],t={};m.forEach(r=>{const v=new Date(r.date),f=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}`;t[f]||(t[f]=0),t[f]+=parseFloat(r.amount)});const x=Object.entries(t).map(([r,v])=>({month:r,amount:v}));c(x.slice(-12))}catch(o){console.error("Error fetching spending trend:",o)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Vendor Information"}),e.jsxs("div",{className:"space-y-3",children:[s.contact_person&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Contact Person"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.contact_person})]})]}),s.phone&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(bt,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Phone"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.phone}),s.alternate_phone&&e.jsx("p",{className:"text-sm text-dark-brown/60",children:s.alternate_phone})]})]}),s.email&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ve,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Email"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.email})]})]}),s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ws,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Address"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.address})]})]}),s.website&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(La,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Website"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-accent hover:underline",children:s.website})]})]}),s.gst_number&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(pt,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"GST Number"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.gst_number})]})]}),s.payment_terms&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ’³"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Payment Terms"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.payment_terms})]})]}),s.certifications&&Array.isArray(s.certifications)&&s.certifications.length>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ye,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Certifications"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:s.certifications.map((o,u)=>e.jsx("span",{className:"px-2 py-1 bg-sage/20 text-sage text-xs font-semibold rounded-full",children:o},u))})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",l.totalSpent.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",l.thisMonth.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Year"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",l.thisYear.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Avg Transaction"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",l.avgTransaction.toFixed(0)]})]})]}),l.pendingPayment>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Pending Payment"}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",l.pendingPayment.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Total Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:l.totalTransactions})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Category"}),e.jsx("span",{className:"font-bold text-primary",children:s.category})]}),s.products&&e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Products/Services"}),e.jsx("span",{className:"font-semibold text-primary text-right",children:s.products})]})]})]})]})]}),b.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(te,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Spending Trend (Last 12 Months)"})]}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(Et,{data:b,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Le,{dataKey:"month",stroke:"#6B5A4C",style:{fontSize:"12px"}}),e.jsx(qe,{stroke:"#6B5A4C",style:{fontSize:"12px"},tickFormatter:o=>`â‚¹${o}`}),e.jsx(ye,{contentStyle:{backgroundColor:"#fff",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},formatter:o=>[`â‚¹${o.toFixed(0)}`,"Spending"]}),e.jsx($e,{type:"monotone",dataKey:"amount",stroke:"#8B9A7E",strokeWidth:3,dot:{fill:"#8B9A7E",r:4},activeDot:{r:6}})]})})]})]})}const fn=["expense","payment"],gn=["Cash","Bank Transfer","Cheque","UPI","Card","Other"],jn=["paid","pending"];function yn({vendorId:s,onClose:l,onSuccess:h}){const{user:b}=H(),[c,n]=i.useState(!1),[a,o]=i.useState({date:new Date().toISOString().split("T")[0],transactionType:"expense",amount:"",description:"",paymentMode:"Bank Transfer",status:"paid",invoiceNumber:"",referenceNumber:""}),u=async m=>{if(m.preventDefault(),!a.amount||parseFloat(a.amount)<=0){alert("Please enter a valid amount");return}n(!0);try{const{error:t}=await C.from("vendor_transactions").insert([{vendor_id:s,date:a.date,transaction_type:a.transactionType,amount:parseFloat(a.amount),description:a.description||null,payment_mode:a.paymentMode,status:a.status,invoice_number:a.invoiceNumber||null,reference_number:a.referenceNumber||null,created_by:b?.id}]);if(t)throw t;h()}catch(t){console.error("Error adding transaction:",t),alert("Error adding transaction. Please try again.")}finally{n(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full",children:[e.jsxs("div",{className:"border-b-2 border-dark-brown/5 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add Transaction"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:u,className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.date,onChange:m=>o({...a,date:m.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Transaction Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:a.transactionType,onChange:m=>o({...a,transactionType:m.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:fn.map(m=>e.jsx("option",{value:m,children:m.charAt(0).toUpperCase()+m.slice(1)},m))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:a.amount,onChange:m=>o({...a,amount:m.target.value}),placeholder:"0.00",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Status ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:a.status,onChange:m=>o({...a,status:m.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:jn.map(m=>e.jsx("option",{value:m,children:m.charAt(0).toUpperCase()+m.slice(1)},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Mode"}),e.jsx("select",{value:a.paymentMode,onChange:m=>o({...a,paymentMode:m.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:gn.map(m=>e.jsx("option",{value:m,children:m},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Invoice Number"}),e.jsx("input",{type:"text",value:a.invoiceNumber,onChange:m=>o({...a,invoiceNumber:m.target.value}),placeholder:"INV-001",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Reference Number"}),e.jsx("input",{type:"text",value:a.referenceNumber,onChange:m=>o({...a,referenceNumber:m.target.value}),placeholder:"Transaction reference number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:m=>o({...a,description:m.target.value}),placeholder:"Transaction description or notes...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})}),e.jsxs("div",{className:"bg-cream/90 border-t-2 border-dark-brown/5 px-6 py-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:c,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:c?"Adding...":"Add Transaction"})]})]})})}function wn({vendorId:s}){const[l,h]=i.useState([]),[b,c]=i.useState([]),[n,a]=i.useState("all"),[o,u]=i.useState(!1);i.useEffect(()=>{m()},[s]),i.useEffect(()=>{t()},[l,n]);const m=async()=>{try{const{data:f,error:j}=await C.from("vendor_transactions").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(j)throw j;h(f||[])}catch(f){console.error("Error fetching transactions:",f)}},t=()=>{c(n==="all"?l:l.filter(f=>f.status===n))},x=b.reduce((f,j)=>f+parseFloat(j.amount),0),r=b.filter(f=>f.status==="paid").reduce((f,j)=>f+parseFloat(j.amount),0),v=b.filter(f=>f.status==="pending").reduce((f,j)=>f+parseFloat(j.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Bs,{className:"w-5 h-5 text-dark-brown/60"}),e.jsxs("select",{value:n,onChange:f=>a(f.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Transactions"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Transaction"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Transactions"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",x.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[b.length," transactions"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",r.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[b.filter(f=>f.status==="paid").length," transactions"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",v.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[b.filter(f=>f.status==="pending").length," transactions"]})]})]}),e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:b.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Payment Mode"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Invoice #"})]})}),e.jsx("tbody",{children:b.map((f,j)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${j%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:new Date(f.date).toLocaleDateString()})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f.transaction_type==="expense"?"bg-accent/10 text-accent":"bg-sage/10 text-sage"}`,children:f.transaction_type})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:f.description||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Re,{className:"w-4 h-4 text-sage"}),e.jsxs("span",{className:"text-sm font-bold text-sage",children:["â‚¹",parseFloat(f.amount).toFixed(2)]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:f.payment_mode||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f.status==="paid"?"bg-sage/10 text-sage":"bg-soft-red/10 text-soft-red"}`,children:f.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:f.invoice_number||"-"})})]},f.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Re,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No transactions found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Start by adding your first transaction"}),e.jsx("button",{onClick:()=>u(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Transaction"})]})}),o&&e.jsx(yn,{vendorId:s,onClose:()=>u(!1),onSuccess:()=>{u(!1),m()}})]})}const Nn=["pending","paid","overdue"];function vn({vendorId:s,onClose:l,onSuccess:h}){const{user:b}=H(),[c,n]=i.useState(!1),[a,o]=i.useState({invoiceNumber:"",date:new Date().toISOString().split("T")[0],dueDate:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],amount:"",status:"pending",notes:""}),u=async m=>{if(m.preventDefault(),!a.invoiceNumber||!a.amount||parseFloat(a.amount)<=0){alert("Please fill in required fields (Invoice Number and Amount)");return}n(!0);try{const{error:t}=await C.from("vendor_invoices").insert([{vendor_id:s,invoice_number:a.invoiceNumber,date:a.date,due_date:a.dueDate,amount:parseFloat(a.amount),status:a.status,notes:a.notes||null,created_by:b?.id}]);if(t)throw t;h()}catch(t){console.error("Error adding invoice:",t),alert("Error adding invoice. Please try again.")}finally{n(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full",children:[e.jsxs("div",{className:"border-b-2 border-dark-brown/5 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add Invoice"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:u,className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Invoice Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:a.invoiceNumber,onChange:m=>o({...a,invoiceNumber:m.target.value}),placeholder:"INV-2024-001",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:a.amount,onChange:m=>o({...a,amount:m.target.value}),placeholder:"0.00",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Invoice Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.date,onChange:m=>o({...a,date:m.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Due Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.dueDate,onChange:m=>o({...a,dueDate:m.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Status"}),e.jsx("select",{value:a.status,onChange:m=>o({...a,status:m.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Nn.map(m=>e.jsx("option",{value:m,children:m.charAt(0).toUpperCase()+m.slice(1)},m))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:m=>o({...a,notes:m.target.value}),placeholder:"Additional notes or comments...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})}),e.jsxs("div",{className:"bg-cream/90 border-t-2 border-dark-brown/5 px-6 py-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:c,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:c?"Adding...":"Add Invoice"})]})]})})}function kn({vendorId:s}){const[l,h]=i.useState([]),[b,c]=i.useState(!1);i.useEffect(()=>{n()},[s]);const n=async()=>{try{const{data:r,error:v}=await C.from("vendor_invoices").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(v)throw v;h(r||[])}catch(r){console.error("Error fetching invoices:",r)}},a=r=>{switch(r){case"paid":return e.jsx(Y,{className:"w-5 h-5 text-sage"});case"overdue":return e.jsx(fe,{className:"w-5 h-5 text-soft-red"});default:return e.jsx(de,{className:"w-5 h-5 text-accent"})}},o=r=>{switch(r){case"paid":return"bg-sage/10 text-sage";case"overdue":return"bg-soft-red/10 text-soft-red";default:return"bg-accent/10 text-accent"}},u=l.reduce((r,v)=>r+parseFloat(v.amount),0),m=l.filter(r=>r.status==="paid").reduce((r,v)=>r+parseFloat(v.amount),0),t=l.filter(r=>r.status==="pending").reduce((r,v)=>r+parseFloat(v.amount),0),x=l.filter(r=>r.status==="overdue").reduce((r,v)=>r+parseFloat(v.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Invoice Management"}),e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Upload Invoice"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Invoices"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",u.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[l.length," invoices"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",m.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[l.filter(r=>r.status==="paid").length," invoices"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",t.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[l.filter(r=>r.status==="pending").length," invoices"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Overdue"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",x.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[l.filter(r=>r.status==="overdue").length," invoices"]})]})]}),e.jsx("div",{className:"space-y-4",children:l.length>0?l.map(r=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ae,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary",children:["Invoice #",r.invoice_number]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Date: ",new Date(r.date).toLocaleDateString()," | Due: ",new Date(r.due_date).toLocaleDateString()]})]})]}),r.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2",children:r.notes})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",parseFloat(r.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a(r.status),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${o(r.status)}`,children:r.status})]}),r.status!=="paid"&&e.jsx("button",{className:"px-4 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg font-semibold transition-colors",children:"Mark as Paid"})]})]}),r.paid_date&&e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Paid on: ",new Date(r.paid_date).toLocaleDateString()," | Amount: â‚¹",parseFloat(r.paid_amount).toFixed(2)]})})]},r.id)):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No invoices found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Upload your first invoice to get started"}),e.jsx("button",{onClick:()=>c(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Invoice"})]})}),b&&e.jsx(vn,{vendorId:s,onClose:()=>c(!1),onSuccess:()=>{c(!1),n()}})]})}const _n=["kg","g","L","mL","pieces","box","packet","bottle","jar","other"];function Cn({vendorId:s,onClose:l,onSuccess:h}){const{user:b}=H(),[c,n]=i.useState(!1),[a,o]=i.useState({productName:"",category:"",unit:"kg",price:"",moq:"",leadTime:"",notes:""}),u=async m=>{if(m.preventDefault(),!a.productName||!a.price||parseFloat(a.price)<=0){alert("Please fill in required fields (Product Name and Price)");return}n(!0);try{const{error:t}=await C.from("vendor_prices").insert([{vendor_id:s,product_name:a.productName,category:a.category||null,unit:a.unit,price:parseFloat(a.price),moq:a.moq||null,lead_time:a.leadTime?parseInt(a.leadTime):null,notes:a.notes||null,created_by:b?.id}]);if(t)throw t;h()}catch(t){console.error("Error adding price item:",t),alert("Error adding price item. Please try again.")}finally{n(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full",children:[e.jsxs("div",{className:"border-b-2 border-dark-brown/5 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add Price Item"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:u,className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product/Service Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:a.productName,onChange:m=>o({...a,productName:m.target.value}),placeholder:"e.g., Organic Neem Powder",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("input",{type:"text",value:a.category,onChange:m=>o({...a,category:m.target.value}),placeholder:"e.g., Herbs, Oils, Packaging",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Unit ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:a.unit,onChange:m=>o({...a,unit:m.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:_n.map(m=>e.jsx("option",{value:m,children:m},m))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Price per Unit ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:a.price,onChange:m=>o({...a,price:m.target.value}),placeholder:"0.00",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Minimum Order Quantity (MOQ)"}),e.jsx("input",{type:"text",value:a.moq,onChange:m=>o({...a,moq:m.target.value}),placeholder:"e.g., 100 kg",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Lead Time (days)"}),e.jsx("input",{type:"number",value:a.leadTime,onChange:m=>o({...a,leadTime:m.target.value}),placeholder:"e.g., 7",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:m=>o({...a,notes:m.target.value}),placeholder:"Additional notes or specifications...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})}),e.jsxs("div",{className:"bg-cream/90 border-t-2 border-dark-brown/5 px-6 py-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:c,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:c?"Adding...":"Add Price Item"})]})]})})}function Sn({vendorId:s}){const[l,h]=i.useState([]),[b,c]=i.useState(!1);i.useEffect(()=>{n()},[s]);const n=async()=>{try{const{data:a,error:o}=await C.from("vendor_prices").select("*").eq("vendor_id",s).order("product_name");if(o)throw o;h(a||[])}catch(a){console.error("Error fetching prices:",a)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Price List"}),e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Price Item"]})]}),l.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Product/Service"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Unit"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Price"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"MOQ"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Lead Time"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Last Updated"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:l.map((a,o)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${o%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:a.product_name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-semibold",children:a.category||"General"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:a.unit})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-lg font-bold text-sage",children:["â‚¹",parseFloat(a.price).toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:a.moq||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:a.lead_time?`${a.lead_time} days`:"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/60",children:new Date(a.updated_at).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-primary/10 text-primary rounded-lg transition-colors",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-accent/10 text-accent rounded-lg transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})})]},a.id))})]})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(le,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No price items found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add price items to track vendor pricing"}),e.jsx("button",{onClick:()=>c(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Price Item"})]}),b&&e.jsx(Cn,{vendorId:s,onClose:()=>c(!1),onSuccess:()=>{c(!1),n()}})]})}const Dn=[{id:"contracts",label:"Contracts & Agreements"},{id:"gst",label:"GST Certificate"},{id:"certifications",label:"Quality Certifications"},{id:"catalogs",label:"Product Catalogs"},{id:"reports",label:"Test Reports"},{id:"other",label:"Other Documents"}];function Mn({vendorId:s,onClose:l,onSuccess:h}){const{user:b}=H(),[c,n]=i.useState(!1),[a,o]=i.useState({fileName:"",category:"other",description:"",fileUrl:"",fileSize:0}),u=async m=>{if(m.preventDefault(),!a.fileName){alert("Please enter a document name");return}n(!0);try{const{error:t}=await C.from("vendor_documents").insert([{vendor_id:s,file_name:a.fileName,category:a.category,description:a.description||null,file_url:a.fileUrl||null,file_size:a.fileSize,uploaded_by:b?.id}]);if(t)throw t;h()}catch(t){console.error("Error adding document:",t),alert("Error adding document. Please try again.")}finally{n(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full",children:[e.jsxs("div",{className:"border-b-2 border-dark-brown/5 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Upload Document"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:u,className:"p-6 space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Document Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:a.fileName,onChange:m=>o({...a,fileName:m.target.value}),placeholder:"e.g., GST Certificate 2024",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:a.category,onChange:m=>o({...a,category:m.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Dn.map(m=>e.jsx("option",{value:m.id,children:m.label},m.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Document URL (Optional)"}),e.jsx("input",{type:"url",value:a.fileUrl,onChange:m=>o({...a,fileUrl:m.target.value}),placeholder:"https://example.com/document.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"You can provide a link to the document stored elsewhere"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:m=>o({...a,description:m.target.value}),placeholder:"Document description or notes...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"border-2 border-dashed border-dark-brown/20 rounded-xl p-8 text-center bg-cream/30",children:[e.jsx(Pe,{className:"w-12 h-12 text-dark-brown/40 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"File upload functionality coming soon"}),e.jsx("p",{className:"text-xs text-dark-brown/40",children:"For now, you can provide a document URL above"})]})]})}),e.jsxs("div",{className:"bg-cream/90 border-t-2 border-dark-brown/5 px-6 py-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:c,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:c?"Adding...":"Add Document"})]})]})})}const Ds=[{id:"contracts",label:"Contracts & Agreements",icon:"ðŸ“„"},{id:"gst",label:"GST Certificate",icon:"ðŸ“œ"},{id:"certifications",label:"Quality Certifications",icon:"ðŸ†"},{id:"catalogs",label:"Product Catalogs",icon:"ðŸ“‹"},{id:"reports",label:"Test Reports",icon:"ðŸ“Š"},{id:"other",label:"Other Documents",icon:"ðŸ’¼"}];function Pn({vendorId:s}){const[l,h]=i.useState([]),[b,c]=i.useState("all"),[n,a]=i.useState(!1);i.useEffect(()=>{o()},[s]);const o=async()=>{try{const{data:x,error:r}=await C.from("vendor_documents").select("*").eq("vendor_id",s).order("uploaded_at",{ascending:!1});if(r)throw r;h(x||[])}catch(x){console.error("Error fetching documents:",x)}},u=b==="all"?l:l.filter(x=>x.category===b),m=x=>Ds.find(r=>r.id===x)||{icon:"ðŸ“„",label:x},t=x=>x<1024?x+" B":x<1024*1024?(x/1024).toFixed(1)+" KB":(x/(1024*1024)).toFixed(1)+" MB";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Documents"}),e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Upload Document"]})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${b==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",l.length,")"]}),Ds.map(x=>{const r=l.filter(v=>v.category===x.id).length;return e.jsxs("button",{onClick:()=>c(x.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${b===x.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:x.icon}),x.label," (",r,")"]},x.id)})]}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(x=>{const r=m(x.category);return e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl flex-shrink-0",children:r.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:x.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:r.label})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60 mb-3",children:[e.jsx("span",{children:t(x.file_size||0)}),e.jsx("span",{children:new Date(x.uploaded_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]},x.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:b==="all"?"Upload documents to keep vendor information organized":`No ${m(b).label.toLowerCase()} uploaded yet`}),e.jsx("button",{onClick:()=>a(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Document"})]}),n&&e.jsx(Mn,{vendorId:s,onClose:()=>a(!1),onSuccess:()=>{a(!1),o()}})]})}const Dt=[{id:"quality",label:"Product Quality"},{id:"delivery",label:"Delivery Time"},{id:"pricing",label:"Pricing"},{id:"service",label:"Customer Service"},{id:"reliability",label:"Reliability"}];function En({vendorId:s,vendorRating:l}){const{user:h}=H(),[b,c]=i.useState([]),[n,a]=i.useState([]),[o,u]=i.useState(""),[m,t]=i.useState(!1),[x,r]=i.useState(null),[v,f]=i.useState({category:"quality",rating:5,text:""});i.useEffect(()=>{j(),_()},[s]);const j=async()=>{try{const{data:E,error:D}=await C.from("vendor_notes").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(D)throw D;c(E||[])}catch(E){console.error("Error fetching notes:",E)}},_=async()=>{try{const{data:E,error:D}=await C.from("vendor_reviews").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(D)throw D;a(E||[])}catch(E){console.error("Error fetching reviews:",E)}},N=async()=>{if(o.trim())try{const{error:E}=await C.from("vendor_notes").insert([{vendor_id:s,note_text:o,written_by:h?.id}]);if(E)throw E;u(""),j()}catch(E){console.error("Error adding note:",E),alert("Error adding note")}},w=async()=>{if(!v.text.trim()){alert("Please write a review");return}try{const{error:E}=await C.from("vendor_reviews").insert([{vendor_id:s,category:v.category,rating:v.rating,review_text:v.text,reviewed_by:h?.id}]);if(E)throw E;f({category:"quality",rating:5,text:""}),t(!1),_()}catch(E){console.error("Error adding review:",E),alert("Error adding review")}},y=async()=>{if(!x||!x.review_text.trim()){alert("Please write a review");return}try{const{error:E}=await C.from("vendor_reviews").update({category:x.category,rating:x.rating,review_text:x.review_text}).eq("id",x.id);if(E)throw E;r(null),_()}catch(E){console.error("Error updating review:",E),alert("Error updating review")}},p=async E=>{if(confirm("Are you sure you want to delete this review?"))try{const{error:D}=await C.from("vendor_reviews").delete().eq("id",E);if(D)throw D;_()}catch(D){console.error("Error deleting review:",D),alert("Error deleting review")}},d=E=>{r({...E}),t(!1)},k=()=>{r(null)},g=(E,D=!1,I)=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(q=>e.jsx("button",{type:"button",onClick:()=>D&&I&&I(q),disabled:!D,className:D?"cursor-pointer":"",children:e.jsx(Ze,{className:`w-5 h-5 ${q<=E?"fill-amber-400 text-amber-400":"text-dark-brown/20"} ${D?"hover:fill-amber-400 hover:text-amber-400":""}`})},q))}),M=E=>{const D=n.filter(I=>I.category===E);return D.length===0?0:D.reduce((I,q)=>I+q.rating,0)/D.length};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Internal Notes"})}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:[e.jsx("textarea",{value:o,onChange:E=>u(E.target.value),placeholder:"Add a note about this vendor...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none mb-3"}),e.jsxs("button",{onClick:N,disabled:!o.trim(),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all disabled:opacity-50",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Note"]})]}),e.jsx("div",{className:"space-y-3",children:b.length>0?b.map(E=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Oe,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"User"}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[new Date(E.created_at).toLocaleDateString()," at"," ",new Date(E.created_at).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1 hover:bg-primary/10 text-primary rounded transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:E.note_text})]},E.id)):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx($t,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No notes yet"})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Ratings & Reviews"}),e.jsxs("button",{onClick:()=>{t(!m),r(null)},className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Review"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-amber-600/10 rounded-xl p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-5xl font-bold text-amber-600 mb-2",children:l?.toFixed(1)||"0.0"}),g(l||0),e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-2",children:["Based on ",n.length," reviews"]})]}),e.jsx("div",{className:"space-y-2",children:Dt.map(E=>{const D=M(E.id);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:E.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[g(D),e.jsx("span",{className:"text-sm text-dark-brown/60 w-8",children:D>0?D.toFixed(1):"-"})]})]},E.id)})})]}),m&&e.jsx("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:v.category,onChange:E=>f({...v,category:E.target.value}),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:Dt.map(E=>e.jsx("option",{value:E.id,children:E.label},E.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),g(v.rating,!0,E=>f({...v,rating:E}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Review"}),e.jsx("textarea",{value:v.text,onChange:E=>f({...v,text:E.target.value}),placeholder:"Write your review...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(!1),className:"flex-1 px-4 py-2 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:w,className:"flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-amber-600 text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Submit Review"})]})]})}),e.jsx("div",{className:"space-y-3",children:n.length>0?n.map(E=>{const D=Dt.find(q=>q.id===E.category);return x?.id===E.id?e.jsx("div",{className:"bg-cream/50 rounded-xl p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:x.category,onChange:q=>r({...x,category:q.target.value}),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:Dt.map(q=>e.jsx("option",{value:q.id,children:q.label},q.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),g(x.rating,!0,q=>r({...x,rating:q}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Review"}),e.jsx("textarea",{value:x.review_text,onChange:q=>r({...x,review_text:q.target.value}),placeholder:"Write your review...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k,className:"flex-1 px-4 py-2 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:y,className:"flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-amber-600 text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Update Review"})]})]})},E.id):e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:D?.label})}),g(E.rating)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(E.created_at).toLocaleDateString()}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>d(E),className:"p-1 hover:bg-primary/10 text-primary rounded transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(E.id),className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:E.review_text})]},E.id)}):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Ze,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No reviews yet"})]})})]})]})})}const An=["Raw Materials","Packaging","Printing","Logistics","Lab Testing","Equipment","Other"],In=["Immediate","7 days","15 days","30 days","45 days","60 days","Custom"];function Tn({vendor:s,onClose:l,onSuccess:h}){H();const[b,c]=i.useState(!1),[n,a]=i.useState({name:s.name||"",category:s.category||"Raw Materials",products:s.products||"",contactPerson:s.contact_person||"",phone:s.phone||"",email:s.email||"",alternatePhone:s.alternate_phone||"",address:s.address||"",gstNumber:s.gst_number||"",website:s.website||"",paymentTerms:s.payment_terms||"30 days",bankName:s.bank_details?.bankName||"",accountNumber:s.bank_details?.accountNumber||"",ifscCode:s.bank_details?.ifscCode||"",currentRating:s.current_rating||3,notes:s.notes||""}),[o,u]=i.useState({iso:s.certifications?.includes("ISO Certified")||!1,organic:s.certifications?.includes("Organic Certified")||!1,fssai:s.certifications?.includes("FSSAI Approved")||!1,gmp:s.certifications?.includes("GMP Certified")||!1,other:s.certifications?.filter(t=>!["ISO Certified","Organic Certified","FSSAI Approved","GMP Certified"].includes(t)).join(", ")||""}),m=async t=>{if(t.preventDefault(),!n.name||!n.phone){alert("Please fill in required fields (Name and Phone)");return}c(!0);try{const x=n.bankName?{bankName:n.bankName,accountNumber:n.accountNumber,ifscCode:n.ifscCode}:{},r=[];o.iso&&r.push("ISO Certified"),o.organic&&r.push("Organic Certified"),o.fssai&&r.push("FSSAI Approved"),o.gmp&&r.push("GMP Certified"),o.other&&r.push(o.other);const{error:v}=await C.from("vendors").update({name:n.name,category:n.category,products:n.products,contact_person:n.contactPerson,phone:n.phone,email:n.email,alternate_phone:n.alternatePhone,address:n.address,gst_number:n.gstNumber,website:n.website,payment_terms:n.paymentTerms,bank_details:x,certifications:r,current_rating:n.currentRating,notes:n.notes}).eq("id",s.id);if(v)throw v;h()}catch(x){console.error("Error updating vendor:",x),alert("Error updating vendor. Please try again.")}finally{c(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Edit Vendor"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:n.name,onChange:t=>a({...n,name:t.target.value}),placeholder:"e.g., Green Valley Herbs",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:n.category,onChange:t=>a({...n,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:An.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:n.contactPerson,onChange:t=>a({...n,contactPerson:t.target.value}),placeholder:"Contact person name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Products/Services"}),e.jsx("textarea",{value:n.products,onChange:t=>a({...n,products:t.target.value}),placeholder:"What does this vendor supply? e.g., Organic herbs, essential oils",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Contact Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Phone Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"tel",value:n.phone,onChange:t=>a({...n,phone:t.target.value}),placeholder:"+91-XXXXXXXXXX",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email"}),e.jsx("input",{type:"email",value:n.email,onChange:t=>a({...n,email:t.target.value}),placeholder:"vendor@example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Alternative Phone"}),e.jsx("input",{type:"tel",value:n.alternatePhone,onChange:t=>a({...n,alternatePhone:t.target.value}),placeholder:"Optional second number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Website"}),e.jsx("input",{type:"url",value:n.website,onChange:t=>a({...n,website:t.target.value}),placeholder:"https://example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Address"}),e.jsx("textarea",{value:n.address,onChange:t=>a({...n,address:t.target.value}),placeholder:"Street, city, state, pincode",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Business Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"GST Number"}),e.jsx("input",{type:"text",value:n.gstNumber,onChange:t=>a({...n,gstNumber:t.target.value}),placeholder:"22AAAAA0000A1Z5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Terms"}),e.jsx("select",{value:n.paymentTerms,onChange:t=>a({...n,paymentTerms:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:In.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bank Name"}),e.jsx("input",{type:"text",value:n.bankName,onChange:t=>a({...n,bankName:t.target.value}),placeholder:"e.g., HDFC Bank",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:n.accountNumber,onChange:t=>a({...n,accountNumber:t.target.value}),placeholder:"Account number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"IFSC Code"}),e.jsx("input",{type:"text",value:n.ifscCode,onChange:t=>a({...n,ifscCode:t.target.value}),placeholder:"e.g., HDFC0001234",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality & Rating"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Current Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>a({...n,currentRating:t}),className:"focus:outline-none",children:e.jsx(Ze,{className:`w-8 h-8 transition-colors ${t<=n.currentRating?"fill-amber-400 text-amber-400":"text-dark-brown/20 hover:text-amber-400"}`})},t)),e.jsxs("span",{className:"ml-2 text-sm font-semibold text-dark-brown",children:[n.currentRating," / 5"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Quality Certifications"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.iso,onChange:t=>u({...o,iso:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"ISO Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.organic,onChange:t=>u({...o,organic:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Organic Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.fssai,onChange:t=>u({...o,fssai:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"FSSAI Approved"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.gmp,onChange:t=>u({...o,gmp:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"GMP Certified"})]}),e.jsx("input",{type:"text",value:o.other,onChange:t=>u({...o,other:t.target.value}),placeholder:"Other certifications (comma separated)",className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Internal Notes"}),e.jsx("textarea",{value:n.notes,onChange:t=>a({...n,notes:t.target.value}),placeholder:"Any internal notes about this vendor (not visible to vendor)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:b,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:b?"Updating...":"Update Vendor"})]})]})})}const Fn=[{id:"overview",label:"Overview",icon:ht},{id:"transactions",label:"Transactions",icon:pt},{id:"invoices",label:"Invoices",icon:Pt},{id:"prices",label:"Price List",icon:gt},{id:"documents",label:"Documents",icon:ae},{id:"notes",label:"Notes & Reviews",icon:$t}],Ln=s=>({"Raw Materials":"bg-sage/20",Packaging:"bg-secondary/20",Printing:"bg-blue-500/20",Logistics:"bg-accent/20","Lab Testing":"bg-purple-500/20",Other:"bg-dark-brown/20"})[s]||"bg-dark-brown/10";function qn(){const{id:s}=Je(),l=ce(),{user:h}=H(),[b,c]=i.useState(null),[n,a]=i.useState("overview"),[o,u]=i.useState(!0),[m,t]=i.useState(!1);i.useEffect(()=>{s&&x()},[s]);const x=async()=>{try{const{data:f,error:j}=await C.from("vendors").select("*").eq("id",s).maybeSingle();if(j)throw j;c(f)}catch(f){console.error("Error fetching vendor:",f)}finally{u(!1)}},r=async()=>{if(confirm("Are you sure you want to delete this vendor? This action cannot be undone."))try{const{error:f}=await C.from("vendors").delete().eq("id",s);if(f)throw f;l("/vendors")}catch(f){console.error("Error deleting vendor:",f),alert("Error deleting vendor")}},v=f=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(j=>e.jsx(Ze,{className:`w-5 h-5 ${j<=f?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},j))});return o?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading vendor details..."})]})})}):b?e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/vendors"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Be,{className:"w-5 h-5"}),"Back to Vendors"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start gap-4 mb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-2",children:b.name}),e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${Ln(b.category)} rounded-full text-sm font-semibold`,children:b.category})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[v(b.current_rating||3),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown/60",children:[b.current_rating?.toFixed(1)||"3.0"," / 5.0"]})]})]}),h?.role==="admin"&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Delete"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:Fn.map(f=>{const j=f.icon;return e.jsxs("button",{onClick:()=>a(f.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${n===f.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(j,{className:"w-5 h-5"}),f.label]},f.id)})})}),e.jsxs("div",{className:"p-6",children:[n==="overview"&&e.jsx(un,{vendor:b,onUpdate:x}),n==="transactions"&&e.jsx(wn,{vendorId:b.id}),n==="invoices"&&e.jsx(kn,{vendorId:b.id}),n==="prices"&&e.jsx(Sn,{vendorId:b.id}),n==="documents"&&e.jsx(Pn,{vendorId:b.id}),n==="notes"&&e.jsx(En,{vendorId:b.id,vendorRating:b.current_rating})]})]})]}),m&&b&&e.jsx(Tn,{vendor:b,onClose:()=>t(!1),onSuccess:()=>{t(!1),x()}})]}):e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Vendor not found"}),e.jsx("button",{onClick:()=>l("/vendors"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Vendors"})]})})})}function $n({products:s,onClose:l,onSuccess:h}){const{user:b}=H(),[c,n]=i.useState(!1),[a,o]=i.useState(null),[u,m]=i.useState({batchNumber:"",manufacturingDate:R(new Date,"yyyy-MM-dd"),batchSize:"",expiryDate:"",storageLocation:"",qcNotes:""}),[t,x]=i.useState([]),[r,v]=i.useState({ingredientsVerified:!1,formulaFollowed:!1,phTestPassed:!1,visualInspectionPassed:!1,packagingChecked:!1,labelsApplied:!1,batchApproved:!1});i.useEffect(()=>{a&&(f(),j(),_())},[a]);const f=()=>{const d=R(new Date,"yyyyMMdd"),k=a?.name?.substring(0,3).toUpperCase()||"PRD",g="001";m(M=>({...M,batchNumber:`BT-${k}-${d}-${g}`}))},j=()=>{const d=a?.shelf_life||24,k=Es(new Date(u.manufacturingDate),d);m(g=>({...g,expiryDate:R(k,"yyyy-MM-dd")}))},_=async()=>{if(a?.id)try{const{data:d,error:k}=await C.from("product_ingredients").select("*").eq("product_id",a.id);if(k)throw k;d&&d.length>0?x(d.map(g=>({name:g.ingredient_name,lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:g.quantity||"",unit:g.unit||"kg"}))):x([])}catch(d){console.error("Error loading ingredients:",d)}},N=()=>{x([...t,{name:"",lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:"",unit:"kg"}])},w=d=>{x(t.filter((k,g)=>g!==d))},y=(d,k,g)=>{const M=[...t];M[d]={...M[d],[k]:g},x(M)},p=async d=>{if(d.preventDefault(),!a||!u.batchNumber||!u.batchSize){alert("Please fill in all required fields");return}n(!0);try{const{data:k,error:g}=await C.from("batches").insert([{batch_number:u.batchNumber,product_id:a.id,manufacturing_date:u.manufacturingDate,expiry_date:u.expiryDate,batch_size:parseInt(u.batchSize),units_in_stock:parseInt(u.batchSize),storage_location:u.storageLocation,qc_checklist:r,qc_notes:u.qcNotes,qc_approved:r.batchApproved,status:"active",created_by:b?.id}]).select().single();if(g)throw g;if(t.length>0&&k){const M=t.filter(E=>E.name).map(E=>({batch_id:k.id,ingredient_name:E.name,lot_number:E.lotNumber,supplier_batch_number:E.supplierBatchNumber,vendor_id:E.vendorId,ingredient_expiry_date:E.ingredientExpiryDate||null,quantity_used:E.quantityUsed?parseFloat(E.quantityUsed):null,unit:E.unit}));if(M.length>0){const{error:E}=await C.from("batch_ingredients").insert(M);if(E)throw E}}h()}catch(k){console.error("Error creating batch:",k),alert("Error creating batch. Please try again.")}finally{n(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Create New Batch"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:a?.id||"",onChange:d=>{const k=s.find(g=>g.id===d.target.value);o(k)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select a product"}),s.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:u.batchNumber,onChange:d=>m({...u,batchNumber:d.target.value}),placeholder:"BT-PRD-20241215-001",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Size (units) ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"number",value:u.batchSize,onChange:d=>m({...u,batchSize:d.target.value}),placeholder:"500",required:!0,min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Manufacturing Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:u.manufacturingDate,onChange:d=>{m({...u,manufacturingDate:d.target.value}),a&&j()},max:R(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:u.expiryDate,onChange:d=>m({...u,expiryDate:d.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:u.storageLocation,onChange:d=>m({...u,storageLocation:d.target.value}),placeholder:"e.g., Section A, Shelf 3",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Ingredients Used (Lot Tracking)"}),e.jsxs("button",{type:"button",onClick:N,className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Ingredient"]})]}),t.length>0?e.jsx("div",{className:"space-y-4",children:t.map((d,k)=>e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Ingredient #",k+1]}),e.jsx("button",{type:"button",onClick:()=>w(k),className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Name"}),e.jsx("input",{type:"text",value:d.name,onChange:g=>y(k,"name",g.target.value),placeholder:"e.g., Ashwagandha Powder",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Lot Number"}),e.jsx("input",{type:"text",value:d.lotNumber,onChange:g=>y(k,"lotNumber",g.target.value),placeholder:"Internal lot number",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Supplier Batch Number"}),e.jsx("input",{type:"text",value:d.supplierBatchNumber,onChange:g=>y(k,"supplierBatchNumber",g.target.value),placeholder:"Supplier's batch",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Quantity Used"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:d.quantityUsed,onChange:g=>y(k,"quantityUsed",g.target.value),placeholder:"Amount",step:"0.01",className:"flex-1 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:d.unit,onChange:g=>y(k,"unit",g.target.value),className:"px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"l",children:"l"}),e.jsx("option",{value:"ml",children:"ml"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Expiry Date"}),e.jsx("input",{type:"date",value:d.ingredientExpiryDate,onChange:g=>y(k,"ingredientExpiryDate",g.target.value),className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]},k))}):e.jsx("p",{className:"text-sm text-dark-brown/60 text-center py-4",children:"No ingredients added yet. Add ingredients to enable full traceability."})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality Control"}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.ingredientsVerified,onChange:d=>v({...r,ingredientsVerified:d.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"All ingredients verified"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.formulaFollowed,onChange:d=>v({...r,formulaFollowed:d.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Formula followed correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.phTestPassed,onChange:d=>v({...r,phTestPassed:d.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"pH test passed (if applicable)"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.visualInspectionPassed,onChange:d=>v({...r,visualInspectionPassed:d.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Visual inspection passed"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.packagingChecked,onChange:d=>v({...r,packagingChecked:d.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Packaging quality checked"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.labelsApplied,onChange:d=>v({...r,labelsApplied:d.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Labels applied correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.batchApproved,onChange:d=>v({...r,batchApproved:d.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Batch approved for distribution"})]}),e.jsxs("div",{className:"pt-3 border-t border-dark-brown/10",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC Notes"}),e.jsx("textarea",{value:u.qcNotes,onChange:d=>m({...u,qcNotes:d.target.value}),placeholder:"Any additional quality control notes...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:c,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:c?"Creating...":"Create Batch"})]})]})})}function Rn(){const[s,l]=i.useState([]),[h,b]=i.useState([]),[c,n]=i.useState([]),[a,o]=i.useState(""),[u,m]=i.useState("all"),[t,x]=i.useState(!1),[r,v]=i.useState({activeBatches:0,totalUnits:0,expiringSoon:0,productsWithBatches:0});i.useEffect(()=>{f(),j()},[]),i.useEffect(()=>{_(),N()},[s,a,u]);const f=async()=>{try{const{data:d,error:k}=await C.from("batches").select("*, products(name, images)").order("created_at",{ascending:!1});if(k)throw k;l(d||[])}catch(d){console.error("Error fetching batches:",d)}},j=async()=>{try{const{data:d,error:k}=await C.from("products").select("id, name, images").order("name");if(k)throw k;n(d||[])}catch(d){console.error("Error fetching products:",d)}},_=()=>{let d=s;if(u!=="all"&&(d=d.filter(k=>k.status===u)),a){const k=a.toLowerCase();d=d.filter(g=>g.batch_number?.toLowerCase().includes(k)||g.products?.name?.toLowerCase().includes(k))}b(d)},N=()=>{const d=new Date,k=s.filter(D=>D.status==="active").length,g=s.reduce((D,I)=>D+(I.units_in_stock||0),0),M=s.filter(D=>{const I=X(new Date(D.expiry_date),d);return I<=30&&I>=0}).length,E=new Set(s.map(D=>D.product_id)).size;v({activeBatches:k,totalUnits:g,expiringSoon:M,productsWithBatches:E})},w=d=>{const k=X(new Date(d),new Date);return k<0||k<=15?"text-soft-red":k<=30?"text-accent":k<=60?"text-amber-500":"text-sage"},y=d=>{const k=X(new Date(d.expiry_date),new Date);return d.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:k<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:d.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:k<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:d.units_in_stock<d.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:d.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}},p=d=>d.units_in_stock/d.batch_size*100;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(J,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Batch & Lot Tracking"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Complete traceability for manufacturing"})]}),e.jsxs(ue,{onClick:()=>x(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"New Batch"]})]})]}),e.jsxs(ue,{onClick:()=>x(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"New Batch"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(Y,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:r.activeBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active Batches"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(le,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:r.totalUnits})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Units in Stock"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(he,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:`text-3xl font-bold ${r.expiringSoon>0?"text-accent":"text-primary/40"}`,children:r.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring Soon (30d)"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-blue-500/20 rounded-button",children:e.jsx(de,{className:"w-6 h-6 text-blue-500"})}),e.jsx("span",{className:"text-3xl font-bold text-blue-500",children:r.productsWithBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Products with Batches"})]})]}),e.jsx(J,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:()=>m("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${u==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All Batches (",s.length,")"]}),e.jsxs("button",{onClick:()=>m("active"),className:`px-4 py-2 rounded-button font-bold transition-all ${u==="active"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Active (",s.filter(d=>d.status==="active").length,")"]}),e.jsxs("button",{onClick:()=>m("sold_out"),className:`px-4 py-2 rounded-button font-bold transition-all ${u==="sold_out"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Sold Out (",s.filter(d=>d.status==="sold_out").length,")"]})]}),e.jsxs("div",{className:"relative w-full lg:w-64",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:a,onChange:d=>o(d.target.value),placeholder:"Search batches...",className:"input-float w-full pl-12"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(d=>{const k=y(d),g=p(d),M=X(new Date(d.expiry_date),new Date);return e.jsx(Ne,{to:`/batches/${d.id}`,className:"block",children:e.jsx(J,{className:"hover:shadow-glow transition-all duration-300 group h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${k.color}`,children:[e.jsx("span",{className:"mr-1",children:k.icon}),k.label]})}),e.jsx("h3",{className:"font-mono text-lg font-bold text-primary group-hover:text-accent transition-colors mb-1",children:d.batch_number}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:d.products?.name||"Unknown Product"})]}),e.jsx(Gs,{className:"w-8 h-8 text-dark-brown/20 group-hover:text-primary transition-colors"})]}),d.products?.images&&d.products.images[0]&&e.jsx("div",{className:"w-full h-32 mb-4 rounded-lg overflow-hidden bg-cream",children:e.jsx("img",{src:d.products.images[0],alt:d.products.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Manufacturing"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(new Date(d.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Expiry"}),e.jsxs("span",{className:`font-semibold ${w(d.expiry_date)}`,children:[R(new Date(d.expiry_date),"MMM dd, yyyy"),e.jsxs("span",{className:"text-xs ml-1",children:["(",M>=0?`${M}d left`:"Expired",")"]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Stock Status"}),e.jsxs("span",{className:"font-bold text-primary",children:[d.units_in_stock," / ",d.batch_size," units"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${g>50?"bg-sage":g>20?"bg-amber-500":"bg-soft-red"}`,style:{width:`${g}%`}})})]}),d.qc_approved&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-sage",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold",children:"QC Approved"})]})]})})},d.id)})}),h.length===0&&e.jsxs(J,{className:"text-center py-16",children:[e.jsx(le,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No batches found"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:a?"Try adjusting your search":"Create your first batch to start tracking"}),!a&&e.jsx(ue,{onClick:()=>x(!0),variant:"primary",size:"lg",children:"Create Batch"})]})]}),t&&e.jsx($n,{products:c,onClose:()=>x(!1),onSuccess:()=>{x(!1),f()}})]})}function Un({batch:s}){const[l,h]=i.useState([]);i.useEffect(()=>{b()},[s.id]);const b=async()=>{try{const{data:a,error:o}=await C.from("batch_ingredients").select("*, vendors(name)").eq("batch_id",s.id);if(o)throw o;h(a||[])}catch(a){console.error("Error fetching ingredients:",a)}},c=X(new Date(s.expiry_date),new Date),n=s.units_in_stock/s.batch_size*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(le,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Batch Number"}),e.jsx("p",{className:"font-mono font-bold text-dark-brown",children:s.batch_number})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ“…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(s.manufacturing_date),"MMMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"â°"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(s.expiry_date),"MMMM dd, yyyy")}),e.jsx("p",{className:`text-xs mt-1 font-semibold ${c<0?"text-soft-red":c<=30?"text-accent":c<=60?"text-amber-500":"text-sage"}`,children:c>=0?`${c} days remaining`:"Expired"})]})]}),s.storage_location&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ws,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Storage Location"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.storage_location})]})]}),s.qc_approved&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-sage/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Y,{className:"w-5 h-5 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Quality Control"}),e.jsx("p",{className:"font-semibold text-sage",children:"Approved"}),s.qc_approved_date&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["on ",R(new Date(s.qc_approved_date),"MMM dd, yyyy")]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Produced"}),e.jsx("p",{className:"text-3xl font-bold",children:s.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_in_stock})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Sold"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_sold||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_damaged||0})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Remaining"}),e.jsxs("span",{className:"font-bold",children:[n.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all",style:{width:`${n}%`}})})]})]}),s.products&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Product Details"}),e.jsxs("div",{className:"flex items-start gap-4",children:[s.products.images&&s.products.images[0]&&e.jsx("img",{src:s.products.images[0],alt:s.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:s.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",s.batch_number]})]})]})]})]})]}),l.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Ingredient Traceability"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"Complete ingredient lot tracking for full traceability"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Supplier Batch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity Used"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry"})]})}),e.jsx("tbody",{children:l.map((a,o)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${o%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:a.ingredient_name}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:a.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:a.supplier_batch_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:a.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:a.quantity_used?`${a.quantity_used} ${a.unit}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:a.ingredient_expiry_date?R(new Date(a.ingredient_expiry_date),"MMM dd, yyyy"):"-"})]},a.id))})]})})]})]})}function zn({batchId:s,batch:l}){const[h,b]=i.useState([]);i.useEffect(()=>{c()},[s]);const c=async()=>{try{const{data:o,error:u}=await C.from("batch_tests").select("*").eq("batch_id",s).order("test_date",{ascending:!1});if(u)throw u;b(o||[])}catch(o){console.error("Error fetching tests:",o)}},n=l.qc_checklist||{},a=[{key:"ingredientsVerified",label:"All ingredients verified"},{key:"formulaFollowed",label:"Formula followed correctly"},{key:"phTestPassed",label:"pH test passed"},{key:"visualInspectionPassed",label:"Visual inspection passed"},{key:"packagingChecked",label:"Packaging quality checked"},{key:"labelsApplied",label:"Labels applied correctly"},{key:"batchApproved",label:"Batch approved for distribution"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"QC Checklist"}),l.qc_approved&&e.jsxs("span",{className:"flex items-center gap-2 px-3 py-1 bg-sage/10 text-sage rounded-full text-sm font-bold",children:[e.jsx(Y,{className:"w-4 h-4"}),"Approved"]})]}),e.jsx("div",{className:"space-y-3",children:a.map(o=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[n[o.key]?e.jsx(Y,{className:"w-5 h-5 text-sage flex-shrink-0"}):e.jsx(Me,{className:"w-5 h-5 text-dark-brown/20 flex-shrink-0"}),e.jsx("span",{className:`text-sm font-semibold ${n[o.key]?"text-dark-brown":"text-dark-brown/40"}`,children:o.label})]},o.key))}),l.qc_notes&&e.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-2",children:"QC Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:l.qc_notes})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Test Results"}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Test"]})]}),h.length>0?e.jsx("div",{className:"space-y-3",children:h.map(o=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:o.test_type}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${o.result.toLowerCase().includes("pass")?"bg-sage/10 text-sage":o.result.toLowerCase().includes("fail")?"bg-soft-red/10 text-soft-red":"bg-accent/10 text-accent"}`,children:o.result})]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Tested on: ",new Date(o.test_date).toLocaleDateString()]}),o.notes&&e.jsx("p",{className:"text-sm text-dark-brown mt-2",children:o.notes})]},o.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No test results recorded"})]})]})})]})})}function Bn({batchId:s,batch:l,onUpdate:h}){const[b,c]=i.useState([]),[n,a]=i.useState([]);i.useEffect(()=>{o(),u()},[s]);const o=async()=>{try{const{data:m,error:t}=await C.from("batch_dispatches").select("*").eq("batch_id",s).order("dispatch_date",{ascending:!1});if(t)throw t;c(m||[])}catch(m){console.error("Error fetching dispatches:",m)}},u=async()=>{try{const{data:m,error:t}=await C.from("batch_stock_adjustments").select("*").eq("batch_id",s).order("adjustment_date",{ascending:!1});if(t)throw t;a(m||[])}catch(m){console.error("Error fetching adjustments:",m)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Units"}),e.jsx("p",{className:"text-3xl font-bold",children:l.batch_size})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:l.units_in_stock})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Sold/Dispatched"}),e.jsx("p",{className:"text-3xl font-bold text-blue-500",children:l.units_sold||0})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:l.units_damaged||0})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Dispatch History"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-4 h-4"}),"Record Dispatch"]})]}),b.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Dispatch To"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Invoice #"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"})]})}),e.jsx("tbody",{children:b.map((m,t)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${t%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:R(new Date(m.dispatch_date),"MMM dd, yyyy")})]})}),e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:m.dispatch_to}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[m.quantity," units"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70 font-mono",children:m.invoice_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:m.dispatch_method||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${m.status==="delivered"?"bg-sage/10 text-sage":"bg-accent/10 text-accent"}`,children:m.status})})]},m.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"No dispatches recorded"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Record First Dispatch"})]})]}),n.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Adjustments"}),e.jsx("div",{className:"space-y-3",children:n.map(m=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-soft-red/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(we,{className:"w-5 h-5 text-soft-red"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown capitalize",children:m.adjustment_type}),e.jsxs("span",{className:"font-bold text-soft-red",children:["-",m.quantity," units"]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-1",children:m.reason}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:R(new Date(m.adjustment_date),"MMM dd, yyyy")}),m.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2 italic",children:m.notes})]})]},m.id))})]})]})}const Yt=[{id:"product",label:"Product Photos",icon:"ðŸ“¦"},{id:"packaging",label:"Packaging Photos",icon:"ðŸ“¦"},{id:"label",label:"Label Photos",icon:"ðŸ·ï¸"},{id:"qc",label:"QC Photos",icon:"âœ…"},{id:"process",label:"Process Photos",icon:"âš™ï¸"}];function On({batchId:s}){const[l,h]=i.useState([]),[b,c]=i.useState("all");i.useEffect(()=>{n()},[s]);const n=async()=>{try{const{data:o,error:u}=await C.from("batch_photos").select("*").eq("batch_id",s).order("uploaded_at",{ascending:!1});if(u)throw u;h(o||[])}catch(o){console.error("Error fetching photos:",o)}},a=b==="all"?l:l.filter(o=>o.category===b);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${b==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Photos (",l.length,")"]}),Yt.map(o=>{const u=l.filter(m=>m.category===o.id).length;return e.jsxs("button",{onClick:()=>c(o.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${b===o.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:o.icon}),o.label," (",u,")"]},o.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-4 h-4"}),"Upload Photos"]})]}),a.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:a.map(o=>{const u=Yt.find(m=>m.id===o.category);return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all group",children:[e.jsxs("div",{className:"aspect-square bg-cream relative",children:[e.jsx("img",{src:o.photo_url,alt:u?.label||"Batch photo",className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}),e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 bg-white/90 backdrop-blur-sm rounded-lg text-xs font-semibold",children:[u?.icon," ",u?.label]})]}),e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(o.uploaded_at).toLocaleDateString()})})]},o.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ns,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No photos uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:b==="all"?"Upload photos to document this batch":`No ${Yt.find(o=>o.id===b)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Photo"})]})]})}const Vn={batch_created:"ðŸŽ‰",status_changed:"ðŸ”„",dispatch:"ðŸ“¤",stock_adjustment:"ðŸ“Š",qc_approved:"âœ…",test_added:"ðŸ§ª",photo_uploaded:"ðŸ“¸",ingredient_added:"ðŸŒ¿"},Hn={batch_created:"bg-sage/10 text-sage",status_changed:"bg-blue-500/10 text-blue-500",dispatch:"bg-accent/10 text-accent",stock_adjustment:"bg-soft-red/10 text-soft-red",qc_approved:"bg-sage/10 text-sage",test_added:"bg-purple-500/10 text-purple-500",photo_uploaded:"bg-blue-500/10 text-blue-500",ingredient_added:"bg-primary/10 text-primary"};function Wn({batchId:s}){const[l,h]=i.useState([]),[b,c]=i.useState(!0);i.useEffect(()=>{n()},[s]);const n=async()=>{try{const{data:a,error:o}=await C.from("batch_activity_log").select("*").eq("batch_id",s).order("created_at",{ascending:!1});if(o)throw o;h(a||[])}catch(a){console.error("Error fetching activities:",a)}finally{c(!1)}};return b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading activity log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-sage/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Xt,{className:"w-6 h-6 text-primary"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Complete Traceability Log"})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"Full audit trail of all activities and changes for this batch. Every action is logged for compliance and quality assurance."})]}),l.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-dark-brown/10"}),e.jsx("div",{className:"space-y-6",children:l.map((a,o)=>{const u=Vn[a.activity_type]||"ðŸ“",m=Hn[a.activity_type]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:`absolute left-4 w-8 h-8 rounded-full ${m} flex items-center justify-center text-lg z-10`,children:u}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-1",children:a.activity_description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsxs("span",{children:[R(new Date(a.created_at),"MMM dd, yyyy")," at"," ",R(new Date(a.created_at),"HH:mm")]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${m}`,children:a.activity_type.replace("_"," ")})]}),a.details&&Object.keys(a.details).length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/5",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(a.details).map(([t,x])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1 capitalize",children:t.replace(/_/g," ")}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:typeof x=="object"?JSON.stringify(x):String(x)})]},t))})})]})]},a.id)})})]}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Xt,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity will be logged automatically as actions are performed on this batch"})]})]})}const Gn=[{id:"overview",label:"Overview",icon:ht},{id:"quality",label:"Quality & Testing",icon:Xs},{id:"inventory",label:"Inventory & Distribution",icon:le},{id:"photos",label:"Photos & Documents",icon:Ia},{id:"traceability",label:"Traceability Log",icon:Xt}];function Qn(){const{id:s}=Je(),l=ce(),[h,b]=i.useState(null),[c,n]=i.useState("overview"),[a,o]=i.useState(!0);i.useEffect(()=>{s&&u()},[s]);const u=async()=>{try{const{data:r,error:v}=await C.from("batches").select("*, products(name, images)").eq("id",s).maybeSingle();if(v)throw v;b(r)}catch(r){console.error("Error fetching batch:",r)}finally{o(!1)}},m=async()=>{if(confirm("Are you sure you want to delete this batch? This action cannot be undone."))try{const{error:r}=await C.from("batches").delete().eq("id",s);if(r)throw r;l("/batches")}catch(r){console.error("Error deleting batch:",r),alert("Error deleting batch")}},t=()=>{if(!h)return null;const r=X(new Date(h.expiry_date),new Date);return h.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:r<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:h.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:r<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:h.units_in_stock<h.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:h.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}};if(a)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading batch details..."})]})})});if(!h)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Batch not found"}),e.jsx("button",{onClick:()=>l("/batches"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Batches"})]})})});const x=t();return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/batches"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Be,{className:"w-5 h-5"}),"Back to Batches"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[h.products?.images&&h.products.images[0]&&e.jsx("img",{src:h.products.images[0],alt:h.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-mono text-3xl font-bold text-primary mb-2",children:h.batch_number}),e.jsx("p",{className:"text-lg font-semibold text-dark-brown",children:h.products?.name||"Unknown Product"}),x&&e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 mt-2 ${x.color} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:x.icon}),x.label]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Gs,{className:"w-4 h-4"}),"QR Code"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Oa,{className:"w-4 h-4"}),"Print Labels"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),h.status!=="recalled"&&e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(Da,{className:"w-4 h-4"}),"Recall"]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(h.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(h.expiry_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Units"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:h.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"In Stock"}),e.jsx("p",{className:"font-semibold text-sage",children:h.units_in_stock})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:Gn.map(r=>{const v=r.icon;return e.jsxs("button",{onClick:()=>n(r.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${c===r.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(v,{className:"w-5 h-5"}),r.label]},r.id)})})}),e.jsxs("div",{className:"p-6",children:[c==="overview"&&e.jsx(Un,{batch:h,onUpdate:u}),c==="quality"&&e.jsx(zn,{batchId:h.id,batch:h}),c==="inventory"&&e.jsx(Bn,{batchId:h.id,batch:h,onUpdate:u}),c==="photos"&&e.jsx(On,{batchId:h.id}),c==="traceability"&&e.jsx(Wn,{batchId:h.id})]})]})]})})}function Yn({vendors:s,onClose:l,onSuccess:h}){const{user:b}=H(),[c,n]=i.useState(!1),[a,o]=i.useState([]),[u,m]=i.useState(!1),[t,x]=i.useState(null),[r,v]=i.useState({ingredientId:"",purchaseDate:R(new Date,"yyyy-MM-dd"),quantity:"",expiryDate:"",lotNumber:"",vendorId:"",costPerUnit:"",invoiceNumber:"",storageLocation:"",notes:""}),[f,j]=i.useState({commonName:"",botanicalName:"",type:"herb",category:"raw_material",defaultUnit:"kg",typicalShelfLifeMonths:"24",reorderLevel:"",preferredVendorId:"",storageConditions:""});i.useEffect(()=>{_()},[]),i.useEffect(()=>{if(t){const y=t.typical_shelf_life_months||24,p=Es(new Date(r.purchaseDate),y);v(d=>({...d,expiryDate:R(p,"yyyy-MM-dd")}))}},[t,r.purchaseDate]);const _=async()=>{try{const{data:y,error:p}=await C.from("ingredients").select("*").order("common_name");if(p)throw p;o(y||[])}catch(y){console.error("Error fetching ingredients:",y)}},N=async()=>{if(!f.commonName)return alert("Please enter ingredient name"),null;try{const{data:y,error:p}=await C.from("ingredients").insert([{common_name:f.commonName,botanical_name:f.botanicalName,type:f.type,category:f.category,default_unit:f.defaultUnit,typical_shelf_life_months:parseInt(f.typicalShelfLifeMonths),reorder_level:f.reorderLevel?parseFloat(f.reorderLevel):0,preferred_vendor_id:f.preferredVendorId||null,storage_conditions:f.storageConditions}]).select().single();if(p)throw p;return y}catch(y){return console.error("Error creating ingredient:",y),alert("Error creating ingredient"),null}},w=async y=>{y.preventDefault();let p=r.ingredientId;if(u){const d=await N();if(!d)return;p=d.id}if(!p||!r.quantity||!r.purchaseDate||!r.expiryDate){alert("Please fill in all required fields");return}n(!0);try{const d=parseFloat(r.quantity),k=t?.default_unit||f.defaultUnit,{error:g}=await C.from("ingredient_stock").insert([{ingredient_id:p,purchase_date:r.purchaseDate,expiry_date:r.expiryDate,quantity:d,original_quantity:d,unit:k,lot_number:r.lotNumber,vendor_id:r.vendorId||null,cost_per_unit:r.costPerUnit?parseFloat(r.costPerUnit):null,invoice_number:r.invoiceNumber,storage_location:r.storageLocation,status:"active",notes:r.notes,purchased_by:b?.id}]);if(g)throw g;h()}catch(d){console.error("Error adding stock:",d),alert("Error adding stock. Please try again.")}finally{n(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:u?"Add New Ingredient & Stock":"Add Ingredient Stock"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:w,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[u?e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"New Ingredient Details"}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"text-sm text-dark-brown/60 hover:text-dark-brown",children:"Cancel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Common Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:f.commonName,onChange:y=>j({...f,commonName:y.target.value}),placeholder:"e.g., Ashwagandha Powder",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical/Scientific Name"}),e.jsx("input",{type:"text",value:f.botanicalName,onChange:y=>j({...f,botanicalName:y.target.value}),placeholder:"e.g., Withania somnifera",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:f.type,onChange:y=>j({...f,type:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"herb",children:"Herb"}),e.jsx("option",{value:"oil",children:"Oil"}),e.jsx("option",{value:"powder",children:"Powder"}),e.jsx("option",{value:"extract",children:"Extract"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"fragrance",children:"Fragrance"}),e.jsx("option",{value:"active",children:"Active Ingredient"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:f.category,onChange:y=>j({...f,category:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"raw_material",children:"Raw Material"}),e.jsx("option",{value:"active_ingredient",children:"Active Ingredient"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"packaging",children:"Packaging"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Default Unit ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:f.defaultUnit,onChange:y=>j({...f,defaultUnit:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"kg",children:"kg (Kilograms)"}),e.jsx("option",{value:"g",children:"g (Grams)"}),e.jsx("option",{value:"L",children:"L (Liters)"}),e.jsx("option",{value:"ml",children:"ml (Milliliters)"}),e.jsx("option",{value:"pieces",children:"Pieces"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Typical Shelf Life (months)"}),e.jsx("input",{type:"number",value:f.typicalShelfLifeMonths,onChange:y=>j({...f,typicalShelfLifeMonths:y.target.value}),min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Reorder Level"}),e.jsx("input",{type:"number",value:f.reorderLevel,onChange:y=>j({...f,reorderLevel:y.target.value}),placeholder:"Minimum stock threshold",step:"0.01",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Preferred Vendor"}),e.jsxs("select",{value:f.preferredVendorId,onChange:y=>j({...f,preferredVendorId:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("textarea",{value:f.storageConditions,onChange:y=>j({...f,storageConditions:y.target.value}),placeholder:"e.g., Store in cool, dry place away from direct sunlight",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Select Ingredient ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("button",{type:"button",onClick:()=>m(!0),className:"text-sm text-primary font-semibold hover:underline",children:"+ Or add new ingredient"})]}),e.jsxs("select",{value:r.ingredientId,onChange:y=>{v({...r,ingredientId:y.target.value});const p=a.find(d=>d.id===y.target.value);x(p)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select an ingredient"}),a.map(y=>e.jsxs("option",{value:y.id,children:[y.common_name," ",y.botanical_name&&`(${y.botanical_name})`]},y.id))]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Purchase Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purchase Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:r.purchaseDate,onChange:y=>v({...r,purchaseDate:y.target.value}),max:R(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Quantity Purchased ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:r.quantity,onChange:y=>v({...r,quantity:y.target.value}),placeholder:"Amount",step:"0.01",min:"0",required:!0,className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("div",{className:"px-4 py-3 bg-dark-brown/5 rounded-xl font-semibold text-dark-brown flex items-center",children:t?.default_unit||f.defaultUnit})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:r.expiryDate,onChange:y=>v({...r,expiryDate:y.target.value}),min:r.purchaseDate,required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Lot/Batch Number"}),e.jsx("input",{type:"text",value:r.lotNumber,onChange:y=>v({...r,lotNumber:y.target.value}),placeholder:"Supplier's lot number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:r.vendorId,onChange:y=>v({...r,vendorId:y.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit"}),e.jsx("input",{type:"number",value:r.costPerUnit,onChange:y=>v({...r,costPerUnit:y.target.value}),placeholder:"â‚¹ per unit",step:"0.01",min:"0",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Invoice Number"}),e.jsx("input",{type:"text",value:r.invoiceNumber,onChange:y=>v({...r,invoiceNumber:y.target.value}),placeholder:"Purchase invoice number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:r.storageLocation,onChange:y=>v({...r,storageLocation:y.target.value}),placeholder:"e.g., Section B, Shelf 5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:r.notes,onChange:y=>v({...r,notes:y.target.value}),placeholder:"Quality observations, storage instructions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:c,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:c?"Adding...":"Add to Inventory"})]})]})})}function Kn(){const[s,l]=i.useState([]),[h,b]=i.useState([]),[c,n]=i.useState([]),[a,o]=i.useState(""),[u,m]=i.useState("list"),[t,x]=i.useState("all"),[r,v]=i.useState(!1),[f,j]=i.useState({expired:0,expiring15d:0,expiring30d:0,lowStock:0,reorderNeeded:0});i.useEffect(()=>{_(),N()},[]),i.useEffect(()=>{w(),y()},[s,a,t]);const _=async()=>{try{const{data:g,error:M}=await C.from("ingredient_inventory_summary").select("*").order("common_name");if(M)throw M;l(g||[])}catch(g){console.error("Error fetching ingredients:",g)}},N=async()=>{try{const{data:g,error:M}=await C.from("vendors").select("id, name").order("name");if(M)throw M;n(g||[])}catch(g){console.error("Error fetching vendors:",g)}},w=()=>{let g=s;if(t!=="all"&&(g=g.filter(M=>M.inventory_status===t)),a){const M=a.toLowerCase();g=g.filter(E=>E.common_name?.toLowerCase().includes(M)||E.botanical_name?.toLowerCase().includes(M)||E.type?.toLowerCase().includes(M))}b(g)},y=()=>{const g=new Date,M=s.filter(B=>B.earliest_expiry?X(new Date(B.earliest_expiry),g)<0:!1).length,E=s.filter(B=>{if(!B.earliest_expiry)return!1;const G=X(new Date(B.earliest_expiry),g);return G>=0&&G<15}).length,D=s.filter(B=>{if(!B.earliest_expiry)return!1;const G=X(new Date(B.earliest_expiry),g);return G>=15&&G<30}).length,I=s.filter(B=>B.inventory_status==="low_stock").length,q=s.filter(B=>B.total_stock<B.reorder_level&&B.reorder_level>0).length;j({expired:M,expiring15d:E,expiring30d:D,lowStock:I,reorderNeeded:q})},p=g=>{if(!g)return"text-dark-brown/40";const M=X(new Date(g),new Date);return M<0||M<=15?"text-soft-red":M<=30?"text-accent":M<=60?"text-amber-500":"text-sage"},d=g=>{const M={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return M[g]||M.good_stock},k=g=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[g.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(J,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Ingredient Inventory"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Track stock levels, expiry dates, and reorder alerts"})]}),e.jsxs(ue,{onClick:()=>v(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Stock"]})]})]}),e.jsxs(ue,{onClick:()=>v(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Ingredient Stock"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx("button",{onClick:()=>x("expired"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="expired"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”´"}),e.jsx("span",{className:`text-3xl font-bold ${f.expired>0?"text-soft-red":"text-primary/20"}`,children:f.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})}),e.jsx("button",{onClick:()=>x("expiring_soon"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_soon"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ "}),e.jsx("span",{className:`text-3xl font-bold ${f.expiring15d>0?"text-soft-red":"text-primary/20"}`,children:f.expiring15d})]}),e.jsxs("p",{className:"text-sm font-bold text-primary/70",children:["Expiring ","<","15 days"]})]})}),e.jsx("button",{onClick:()=>x("expiring_30d"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_30d"?"ring-2 ring-amber-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¡"}),e.jsx("span",{className:`text-3xl font-bold ${f.expiring30d>0?"text-amber-500":"text-primary/20"}`,children:f.expiring30d})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring 15-30 days"})]})}),e.jsx("button",{onClick:()=>x("low_stock"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="low_stock"?"ring-2 ring-blue-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”µ"}),e.jsx("span",{className:`text-3xl font-bold ${f.lowStock>0?"text-blue-500":"text-primary/20"}`,children:f.lowStock})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Low Stock"})]})}),e.jsx("button",{onClick:()=>x(f.reorderNeeded>0?"low_stock":"all"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${f.reorderNeeded>0?"ring-2 ring-sage shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¢"}),e.jsx("span",{className:`text-3xl font-bold ${f.reorderNeeded>0?"text-sage":"text-primary/20"}`,children:f.reorderNeeded})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Reorder Needed"})]})})]}),e.jsx(J,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>x("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All (",s.length,")"]}),e.jsx("button",{onClick:()=>x("good_stock"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="good_stock"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:"Good Stock"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:a,onChange:g=>o(g.target.value),placeholder:"Search ingredients...",className:"input-float w-full pl-12"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-primary/5 rounded-button p-1",children:[e.jsx("button",{onClick:()=>m("list"),className:`p-2 rounded-button transition-all ${u==="list"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>m("grid"),className:`p-2 rounded-button transition-all ${u==="grid"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(Vs,{className:"w-5 h-5"})})]})]})]})}),u==="list"?e.jsxs(J,{className:"overflow-hidden p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Current Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Reorder Level"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Days Left"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:h.map((g,M)=>{const E=d(g.inventory_status),D=g.earliest_expiry?X(new Date(g.earliest_expiry),new Date):null;return e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${g.inventory_status==="expired"?"bg-soft-red/5":g.inventory_status==="expiring_soon"?"bg-accent/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[g.image_url?e.jsx("img",{src:g.image_url,alt:g.common_name,className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:g.common_name}),g.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:g.botanical_name})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${k(g.type)}`,children:g.type})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg text-primary",children:[g.total_stock||0," ",g.default_unit]}),g.active_lots>0&&e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[g.active_lots," active lots"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[g.reorder_level||0," ",g.default_unit]})}),e.jsx("td",{className:"px-4 py-3",children:g.earliest_expiry?e.jsx("p",{className:`font-semibold ${p(g.earliest_expiry)}`,children:R(new Date(g.earliest_expiry),"MMM dd, yyyy")}):e.jsx("p",{className:"text-dark-brown/40",children:"No stock"})}),e.jsx("td",{className:"px-4 py-3",children:D!==null?e.jsx("span",{className:`font-bold ${p(g.earliest_expiry)}`,children:D>=0?`${D}d`:"Expired"}):e.jsx("span",{className:"text-dark-brown/40",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${E.color}`,children:[e.jsx("span",{className:"mr-1",children:E.icon}),E.label]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(Ne,{to:`/ingredients/${g.ingredient_id}`,className:"px-4 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:"View Details"})})]},g.ingredient_id)})})]})}),h.length===0&&e.jsxs("div",{className:"text-center py-12 px-6",children:[e.jsx(le,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No ingredients found"}),e.jsx("p",{className:"text-primary/60 mb-4 text-lg font-medium",children:a?"Try adjusting your search":"Add your first ingredient to start tracking"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(g=>{const M=d(g.inventory_status),E=g.earliest_expiry?X(new Date(g.earliest_expiry),new Date):null;return e.jsx(Ne,{to:`/ingredients/${g.ingredient_id}`,className:"block",children:e.jsx(J,{className:"hover:shadow-glow transition-all duration-300 h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[g.image_url?e.jsx("img",{src:g.image_url,alt:g.common_name,className:"w-16 h-16 rounded-lg object-cover"}):e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:g.common_name}),g.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:g.botanical_name})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Stock"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[g.total_stock||0," ",g.default_unit]})]}),g.earliest_expiry&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry"}),e.jsxs("p",{className:`font-semibold ${p(g.earliest_expiry)}`,children:[R(new Date(g.earliest_expiry),"MMM dd, yyyy"),E!==null&&e.jsxs("span",{className:"text-xs ml-2",children:["(",E>=0?`${E}d left`:"Expired",")"]})]})]}),e.jsx("div",{children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${M.color}`,children:[e.jsx("span",{className:"mr-1",children:M.icon}),M.label]})})]})]})})},g.ingredient_id)})})]}),r&&e.jsx(Yn,{vendors:c,onClose:()=>v(!1),onSuccess:()=>{v(!1),_()}})]})}function Zn({ingredientId:s,ingredient:l,summary:h}){const[b,c]=i.useState([]);i.useEffect(()=>{n()},[s]);const n=async()=>{try{const{data:u,error:m}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).eq("status","active").order("expiry_date",{ascending:!0});if(m)throw m;c(u||[])}catch(u){console.error("Error fetching lots:",u)}},a=u=>{const m=X(new Date(u),new Date);return m<0||m<=15?"text-soft-red":m<=30?"text-accent":m<=60?"text-amber-500":"text-sage"},o=l.reorder_level>0?(h?.total_stock||0)/l.reorder_level*100:100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white/80 text-sm mb-2",children:"Total Quantity"}),e.jsx("p",{className:"text-5xl font-bold mb-1",children:h?.total_stock||0}),e.jsx("p",{className:"text-xl text-white/90",children:l.default_unit})]}),l.reorder_level>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Level"}),e.jsx("span",{className:"font-bold",children:o>=100?"Good":o>=50?"Low":"Critical"})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${o>=100?"bg-white":o>=50?"bg-amber-300":"bg-red-300"}`,style:{width:`${Math.min(o,100)}%`}})}),e.jsxs("p",{className:"text-white/70 text-xs mt-2",children:["Reorder level: ",l.reorder_level," ",l.default_unit]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Ingredient Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Type"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:l.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:l.category?.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Default Unit"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:l.default_unit})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Shelf Life"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[l.typical_shelf_life_months," months"]})]}),l.preferred_vendor_id&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Preferred Vendor"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:l.vendors?.name})]})]})]}),l.storage_conditions&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:l.storage_conditions})]})]})]}),h?.earliest_expiry&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Expiry Alert"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["Earliest lot expires on ",R(new Date(h.earliest_expiry),"MMMM dd, yyyy")," ","(",X(new Date(h.earliest_expiry),new Date)," days remaining)"]})]})]})}),b.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock by Lot/Batch"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Purchase Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Storage"})]})}),e.jsx("tbody",{children:b.map((u,m)=>{const t=X(new Date(u.expiry_date),new Date);return e.jsxs("tr",{className:`border-t border-dark-brown/5 ${m%2===0?"bg-white":"bg-cream/20"} ${t<15?"bg-soft-red/5":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown",children:u.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:R(new Date(u.purchase_date),"MMM dd, yyyy")}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:`font-semibold ${a(u.expiry_date)}`,children:R(new Date(u.expiry_date),"MMM dd, yyyy")}),e.jsx("p",{className:`text-xs ${a(u.expiry_date)}`,children:t>=0?`${t}d left`:"Expired"})]}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[u.quantity," ",u.unit]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:u.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:u.storage_location||"-"})]},u.id)})})]})})]})]})}function Jn({ingredientId:s,ingredient:l}){const[h,b]=i.useState([]),[c,n]=i.useState({totalPurchases:0,totalQuantity:0,totalSpent:0,avgCostPerUnit:0});i.useEffect(()=>{a()},[s]);const a=async()=>{try{const{data:u,error:m}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).order("purchase_date",{ascending:!1});if(m)throw m;b(u||[]);const t=u.length,x=u.reduce((f,j)=>f+(j.original_quantity||0),0),r=u.reduce((f,j)=>f+(j.cost_per_unit||0)*(j.original_quantity||0),0),v=r/(x||1);n({totalPurchases:t,totalQuantity:x,totalSpent:r,avgCostPerUnit:v})}catch(u){console.error("Error fetching purchases:",u)}},o=u=>({active:"bg-sage/10 text-sage",used:"bg-dark-brown/10 text-dark-brown",expired:"bg-soft-red/10 text-soft-red"})[u]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Purchases"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:c.totalPurchases})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Quantity"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[c.totalQuantity.toFixed(2)," ",l.default_unit]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",c.totalSpent.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Avg Cost/Unit"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",c.avgCostPerUnit.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Purchase Timeline"}),h.length>0?e.jsx("div",{className:"space-y-4",children:h.map(u=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(De,{className:"w-5 h-5 text-primary"}),e.jsx("h4",{className:"font-semibold text-dark-brown",children:R(new Date(u.purchase_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:u.vendors?.name||"Unknown Vendor"}),u.invoice_number&&e.jsxs("span",{className:"ml-2 text-dark-brown/60",children:["â€¢ Invoice: ",u.invoice_number]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${o(u.status)}`,children:u.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Quantity"}),e.jsxs("p",{className:"font-bold text-primary",children:[u.original_quantity," ",u.unit]}),u.status==="active"&&u.quantity<u.original_quantity&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[u.quantity," ",u.unit," remaining"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Cost/Unit"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:u.cost_per_unit?`â‚¹${u.cost_per_unit}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Cost"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:u.cost_per_unit?`â‚¹${(u.cost_per_unit*u.original_quantity).toFixed(2)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"text-sm text-dark-brown",children:R(new Date(u.expiry_date),"MMM dd, yyyy")})]})]}),u.lot_number&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-xs text-dark-brown/60",children:["Lot: ",e.jsx("span",{className:"font-mono text-dark-brown",children:u.lot_number})]})}),u.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:u.notes})})]},u.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No purchase history recorded"})]})]})]})}function Xn({ingredientId:s,ingredient:l}){const[h,b]=i.useState([]),[c,n]=i.useState([]),[a,o]=i.useState(0);i.useEffect(()=>{u(),m()},[s]);const u=async()=>{try{const{data:t,error:x}=await C.from("ingredient_usage").select("*, batches(batch_number), products(name)").eq("ingredient_id",s).order("usage_date",{ascending:!1});if(x)throw x;b(t||[]);const r=t.reduce((v,f)=>v+(f.quantity||0),0);o(r)}catch(t){console.error("Error fetching usage:",t)}},m=async()=>{try{const{data:t,error:x}=await C.from("product_ingredients").select("*, products(id, name, images)").eq("ingredient_name",l.common_name);if(x)throw x;n(t||[])}catch(t){console.error("Error fetching products:",t)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Used (Lifetime)"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[a.toFixed(2)," ",l.default_unit]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Usage Instances"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:h.length})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Used in Products"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:c.length})]})]}),c.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Products Using This Ingredient"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(t=>e.jsx(Ne,{to:`/products/${t.products.id}`,className:"p-4 bg-cream/50 rounded-lg hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.products.images&&t.products.images[0]?e.jsx("img",{src:t.products.images[0],alt:t.products.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(as,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:t.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[t.quantity," ",t.unit," per batch"]})]})]})},t.id))})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage History"}),h.length>0?e.jsx("div",{className:"space-y-3",children:h.map(t=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(De,{className:"w-4 h-4 text-dark-brown/60"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(new Date(t.usage_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 capitalize",children:["Used for: ",t.used_for?.replace("_"," ")]})]}),e.jsxs("span",{className:"font-bold text-primary text-lg",children:[t.quantity," ",l.default_unit]})]}),t.batches&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",e.jsx(Ne,{to:`/batches/${t.batch_id}`,className:"font-mono text-primary hover:underline",children:t.batches.batch_number})]})}),t.products&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Product: ",e.jsx("span",{className:"font-semibold text-dark-brown",children:t.products.name})]})}),t.notes&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70 italic",children:t.notes})})]},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No usage recorded yet"})]})]})]})}function el({ingredientId:s,ingredient:l}){const[h,b]=i.useState({turnoverRate:0,wasteQuantity:0,wasteCost:0,minPrice:0,maxPrice:0,avgPrice:0,currentPrice:0,totalUsed:0,totalPurchased:0});i.useEffect(()=>{c()},[s]);const c=async()=>{try{const[o,u]=await Promise.all([C.from("ingredient_stock").select("*").eq("ingredient_id",s),C.from("ingredient_usage").select("quantity").eq("ingredient_id",s)]);if(o.error)throw o.error;if(u.error)throw u.error;const m=o.data||[],t=u.data||[],x=m.filter(k=>k.status==="expired"),r=x.reduce((k,g)=>k+(g.quantity||0),0),v=x.reduce((k,g)=>k+(g.cost_per_unit||0)*(g.quantity||0),0),f=m.map(k=>k.cost_per_unit).filter(k=>k>0),j=f.length>0?Math.min(...f):0,_=f.length>0?Math.max(...f):0,N=f.length>0?f.reduce((k,g)=>k+g,0)/f.length:0,w=m.filter(k=>k.cost_per_unit>0).sort((k,g)=>new Date(g.purchase_date).getTime()-new Date(k.purchase_date).getTime()),y=w.length>0?w[0].cost_per_unit:0,p=t.reduce((k,g)=>k+(g.quantity||0),0),d=m.reduce((k,g)=>k+(g.original_quantity||0),0);b({turnoverRate:d>0?p/d*100:0,wasteQuantity:r,wasteCost:v,minPrice:j,maxPrice:_,avgPrice:N,currentPrice:y,totalUsed:p,totalPurchased:d})}catch(o){console.error("Error fetching analytics:",o)}},n=h.totalPurchased>0?h.wasteQuantity/h.totalPurchased*100:0,a=h.avgPrice>0?(h.currentPrice-h.avgPrice)/h.avgPrice*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Turnover Rate"}),e.jsx(te,{className:"w-5 h-5 text-primary"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[h.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Usage efficiency"})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Quantity"}),e.jsx(fe,{className:"w-5 h-5 text-soft-red"})]}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:[h.wasteQuantity.toFixed(2)," ",l.default_unit]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.toFixed(1),"% of total purchased"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Cost"}),e.jsx(Re,{className:"w-5 h-5 text-accent"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",h.wasteCost.toFixed(0)]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Lost value from expiry"})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Minimum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",h.minPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Maximum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",h.maxPrice.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Average Price"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",h.avgPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Price vs Average"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-2xl font-bold ${a>0?"text-soft-red":"text-sage"}`,children:[a>0?"+":"",a.toFixed(1),"%"]}),a>0?e.jsx(te,{className:"w-5 h-5 text-soft-red"}):e.jsx(we,{className:"w-5 h-5 text-sage"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["â‚¹",h.currentPrice.toFixed(2)," per unit"]})]})]})]})]}),n>10&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Waste Reduction Recommendations"}),e.jsxs("ul",{className:"space-y-2 text-sm text-dark-brown/70",children:[e.jsx("li",{children:"â€¢ Consider reducing purchase quantities to match usage rate"}),e.jsx("li",{children:"â€¢ Implement FIFO (First In, First Out) more strictly"}),e.jsx("li",{children:"â€¢ Review storage conditions to extend shelf life"}),e.jsxs("li",{children:["â€¢ Adjust reorder level to: ",(h.totalUsed/6).toFixed(2)," ",l.default_unit," (based on 6-month usage)"]})]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Purchased"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:h.totalPurchased.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:l.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Used"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:h.totalUsed.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:l.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Utilization Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:[h.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:"Used vs Purchased"})]})]})]})]})}const ct=[{id:"coa",label:"Quality Certificates (COA)",icon:Ye},{id:"organic_cert",label:"Organic Certifications",icon:Ye},{id:"test_report",label:"Test Reports",icon:as},{id:"msds",label:"MSDS (Safety Data Sheets)",icon:he},{id:"specification",label:"Vendor Specifications",icon:ae},{id:"photo",label:"Ingredient Photos",icon:zs}];function tl({ingredientId:s}){const[l,h]=i.useState([]),[b,c]=i.useState("all");i.useEffect(()=>{n()},[s]);const n=async()=>{try{const{data:t,error:x}=await C.from("ingredient_documents").select("*").eq("ingredient_id",s).order("uploaded_at",{ascending:!1});if(x)throw x;h(t||[])}catch(t){console.error("Error fetching documents:",t)}},a=b==="all"?l:l.filter(t=>t.category===b),o=t=>{const x=ct.find(r=>r.id===t);return x?x.icon:ae},u=t=>t?X(new Date(t),new Date)<=30:!1,m=t=>t?X(new Date(t),new Date)<0:!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${b==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",l.length,")"]}),ct.map(t=>{const x=l.filter(r=>r.category===t.id).length;return e.jsxs("button",{onClick:()=>c(t.id),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${b===t.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[t.label.split(" ")[0]," (",x,")"]},t.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(Q,{className:"w-4 h-4"}),"Upload Document"]})]}),a.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:a.map(t=>{const x=o(t.category),r=ct.find(v=>v.id===t.category);return e.jsx("div",{className:`bg-white border-2 rounded-xl p-4 hover:shadow-soft transition-all ${m(t.expiry_date)?"border-soft-red/20 bg-soft-red/5":u(t.expiry_date)?"border-accent/20 bg-accent/5":"border-dark-brown/5"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(x,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:t.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:r?.label})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("span",{children:["Uploaded: ",R(new Date(t.uploaded_at),"MMM dd, yyyy")]}),t.expiry_date&&e.jsx("span",{className:`font-semibold ${m(t.expiry_date)?"text-soft-red":u(t.expiry_date)?"text-accent":"text-dark-brown"}`,children:m(t.expiry_date)?e.jsxs(e.Fragment,{children:["Expired: ",R(new Date(t.expiry_date),"MMM dd, yyyy")]}):e.jsxs(e.Fragment,{children:["Expires: ",R(new Date(t.expiry_date),"MMM dd, yyyy")]})})]}),(m(t.expiry_date)||u(t.expiry_date))&&e.jsxs("div",{className:`mt-2 flex items-center gap-2 text-sm font-semibold ${m(t.expiry_date)?"text-soft-red":"text-accent"}`,children:[e.jsx(he,{className:"w-4 h-4"}),m(t.expiry_date)?e.jsx("span",{children:"Certificate expired - renewal required"}):e.jsxs("span",{children:["Expiring in ",X(new Date(t.expiry_date),new Date)," days"]})]})]})]})},t.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:b==="all"?"Upload quality certificates, test reports, and other documents":`No ${ct.find(t=>t.id===b)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),l.some(t=>m(t.expiry_date)||u(t.expiry_date))&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Certificate Expiry Alerts"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-3",children:"Some certificates are expired or expiring soon. Ensure you have updated certifications."}),e.jsx("ul",{className:"space-y-1 text-sm text-dark-brown/70",children:l.filter(t=>m(t.expiry_date)||u(t.expiry_date)).map(t=>e.jsxs("li",{children:["â€¢ ",t.file_name," - ",m(t.expiry_date)?"Expired":"Expiring soon"]},t.id))})]})]})}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:ct.map(t=>{const x=t.icon,r=l.filter(v=>v.category===t.id).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(x,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:t.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[r," document",r!==1?"s":""]})]})]},t.id)})})]})]})}const sl=[{id:"overview",label:"Overview & Stock",icon:ht},{id:"purchase",label:"Purchase History",icon:le},{id:"usage",label:"Usage in Products",icon:as},{id:"analytics",label:"Analytics",icon:te},{id:"documents",label:"Documents",icon:ae}];function al(){const{id:s}=Je(),l=ce(),[h,b]=i.useState(null),[c,n]=i.useState(null),[a,o]=i.useState("overview"),[u,m]=i.useState(!0);i.useEffect(()=>{s&&(t(),x())},[s]);const t=async()=>{try{const{data:N,error:w}=await C.from("ingredients").select("*, vendors(name)").eq("id",s).maybeSingle();if(w)throw w;b(N)}catch(N){console.error("Error fetching ingredient:",N)}finally{m(!1)}},x=async()=>{try{const{data:N,error:w}=await C.from("ingredient_inventory_summary").select("*").eq("ingredient_id",s).maybeSingle();if(w)throw w;n(N)}catch(N){console.error("Error fetching summary:",N)}},r=async()=>{if(confirm("Are you sure you want to delete this ingredient? This action cannot be undone."))try{const{error:N}=await C.from("ingredients").delete().eq("id",s);if(N)throw N;l("/ingredients")}catch(N){console.error("Error deleting ingredient:",N),alert("Error deleting ingredient")}},v=()=>{if(!c)return null;const N={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return N[c.inventory_status]||N.good_stock},f=N=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[N?.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";if(u)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading ingredient details..."})]})})});if(!h)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Ingredient not found"}),e.jsx("button",{onClick:()=>l("/ingredients"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Ingredients"})]})})});const j=v(),_=c?.earliest_expiry?X(new Date(c.earliest_expiry),new Date):null;return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/ingredients"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Be,{className:"w-5 h-5"}),"Back to Ingredients"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[h.image_url?e.jsx("img",{src:h.image_url,alt:h.common_name,className:"w-20 h-20 rounded-lg object-cover"}):e.jsx("div",{className:"w-20 h-20 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-10 h-10 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:h.common_name}),h.botanical_name&&e.jsx("p",{className:"text-lg italic text-dark-brown/70 mb-2",children:h.botanical_name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${f(h.type)}`,children:h.type}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-dark-brown/5 text-dark-brown capitalize",children:h.category?.replace("_"," ")}),j&&e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${j.color}`,children:[e.jsx("span",{className:"mr-1",children:j.icon}),j.label]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Stock"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Stock"}),e.jsxs("p",{className:"font-bold text-2xl text-sage",children:[c?.total_stock||0," ",h.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Reorder Level"}),e.jsxs("p",{className:"font-semibold text-dark-brown",children:[h.reorder_level||0," ",h.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Active Lots"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:c?.active_lots||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold ${_===null?"text-dark-brown/40":_<0||_<=15?"text-soft-red":_<=30?"text-accent":"text-sage"}`,children:_!==null?_>=0?`${_} days`:"Expired":"No stock"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:sl.map(N=>{const w=N.icon;return e.jsxs("button",{onClick:()=>o(N.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${a===N.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(w,{className:"w-5 h-5"}),N.label]},N.id)})})}),e.jsxs("div",{className:"p-6",children:[a==="overview"&&e.jsx(Zn,{ingredientId:s,ingredient:h,summary:c,onUpdate:()=>{t(),x()}}),a==="purchase"&&e.jsx(Jn,{ingredientId:s,ingredient:h}),a==="usage"&&e.jsx(Xn,{ingredientId:s,ingredient:h}),a==="analytics"&&e.jsx(el,{ingredientId:s,ingredient:h}),a==="documents"&&e.jsx(tl,{ingredientId:s})]})]})]})})}const rl=[{value:"fssai",label:"FSSAI License"},{value:"ayush",label:"Ayush License"},{value:"gmp",label:"GMP Certification"},{value:"trade",label:"Trade License"},{value:"gst",label:"GST Registration"},{value:"organic",label:"Organic Certification"},{value:"pollution",label:"Pollution Control"},{value:"fire",label:"Fire Safety Certificate"},{value:"drug",label:"Drug License"},{value:"other",label:"Other"}];function nl({onClose:s,onSuccess:l}){const{user:h}=H(),[b,c]=i.useState(!1),[n,a]=i.useState(!1),[o,u]=i.useState({licenseType:"fssai",licenseNumber:"",issuedTo:"",issuingAuthority:"",issueDate:"",expiryDate:"",renewalReminderDays:"30",scope:"",status:"active",notes:"",reminderEmail:!0,reminderPush:!0}),m=async t=>{if(t.preventDefault(),!o.licenseNumber||!o.issuedTo||!o.issuingAuthority||!o.issueDate){alert("Please fill in all required fields");return}if(!n&&!o.expiryDate){alert('Please provide an expiry date or check "No Expiry"');return}c(!0);try{const{error:x}=await C.from("licenses").insert([{license_type:o.licenseType,license_number:o.licenseNumber,issued_to:o.issuedTo,issuing_authority:o.issuingAuthority,issue_date:o.issueDate,expiry_date:n?null:o.expiryDate,renewal_reminder_days:parseInt(o.renewalReminderDays),scope:o.scope,status:o.status,notes:o.notes,reminder_email:o.reminderEmail,reminder_push:o.reminderPush,created_by:h?.id}]);if(x)throw x;l()}catch(x){console.error("Error adding license:",x),alert("Error adding license. Please try again.")}finally{c(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add License/Certificate"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:m,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:o.licenseType,onChange:t=>u({...o,licenseType:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:rl.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License/Certificate Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:o.licenseNumber,onChange:t=>u({...o,licenseNumber:t.target.value}),placeholder:"e.g., 12345678901234",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issued To ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:o.issuedTo,onChange:t=>u({...o,issuedTo:t.target.value}),placeholder:"Business name",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issuing Authority ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:o.issuingAuthority,onChange:t=>u({...o,issuingAuthority:t.target.value}),placeholder:"e.g., FSSAI, State Ayush Department",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issue Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:o.issueDate,onChange:t=>u({...o,issueDate:t.target.value}),max:R(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Expiry Date ",!n&&e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:t=>{a(t.target.checked),t.target.checked&&u({...o,expiryDate:""})},className:"w-4 h-4 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-xs text-dark-brown/70",children:"No Expiry"})]})]}),e.jsx("input",{type:"date",value:o.expiryDate,onChange:t=>u({...o,expiryDate:t.target.value}),min:o.issueDate,required:!n,disabled:n,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none disabled:bg-dark-brown/5 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Renewal Reminder (days before expiry)"}),e.jsx("input",{type:"number",value:o.renewalReminderDays,onChange:t=>u({...o,renewalReminderDays:t.target.value}),min:"1",max:"365",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Status ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:o.status,onChange:t=>u({...o,status:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending Application"}),e.jsx("option",{value:"renewal_in_process",children:"Renewal In Process"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Scope/Coverage"}),e.jsx("textarea",{value:o.scope,onChange:t=>u({...o,scope:t.target.value}),placeholder:"What this license covers (e.g., Manufacturing of Ayurvedic products)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:o.notes,onChange:t=>u({...o,notes:t.target.value}),placeholder:"Important information, conditions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2 bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.reminderEmail,onChange:t=>u({...o,reminderEmail:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email reminder"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.reminderPush,onChange:t=>u({...o,reminderPush:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push notification"})]})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:b,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:b?"Adding...":"Add License"})]})]})})}const Ms={fssai:{label:"FSSAI License",icon:"ðŸ´",color:"from-blue-500 to-blue-600"},ayush:{label:"Ayush License",icon:"ðŸŒ¿",color:"from-sage to-primary"},gmp:{label:"GMP Certification",icon:"âœ“",color:"from-primary to-accent"},trade:{label:"Trade License",icon:"ðŸª",color:"from-amber-500 to-amber-600"},gst:{label:"GST Registration",icon:"ðŸ’¼",color:"from-purple-500 to-purple-600"},organic:{label:"Organic Certification",icon:"ðŸŒ±",color:"from-green-500 to-green-600"},pollution:{label:"Pollution Control",icon:"ðŸ­",color:"from-teal-500 to-teal-600"},fire:{label:"Fire Safety",icon:"ðŸ”¥",color:"from-red-500 to-red-600"},drug:{label:"Drug License",icon:"ðŸ’Š",color:"from-pink-500 to-pink-600"},other:{label:"Other License",icon:"ðŸ“„",color:"from-dark-brown to-primary"}};function ll(){const[s,l]=i.useState([]),[h,b]=i.useState(!1),[c,n]=i.useState({total:0,active:0,expiringSoon:0,expired:0,complianceScore:100});i.useEffect(()=>{a()},[]),i.useEffect(()=>{o()},[s]);const a=async()=>{try{const{data:r,error:v}=await C.from("license_summary").select("*").order("expiry_date",{ascending:!0,nullsFirst:!1});if(v)throw v;l(r||[])}catch(r){console.error("Error fetching licenses:",r)}},o=()=>{const r=s.length,v=s.filter(N=>N.expiry_status==="active"||N.expiry_status==="no_expiry").length,f=s.filter(N=>N.expiry_status==="expiring_soon"||N.expiry_status==="renewal_due"||N.expiry_status==="critical").length,j=s.filter(N=>N.expiry_status==="expired").length,_=r>0?Math.round((v+f)/r*100):100;n({total:r,active:v,expiringSoon:f,expired:j,complianceScore:_})},u=(r,v)=>{const f={active:{label:"Active",color:"bg-sage/10 text-sage",icon:Y},renewal_due:{label:"Renewal Due",color:"bg-amber-500/10 text-amber-500",icon:de},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:he},critical:{label:"Critical",color:"bg-soft-red/10 text-soft-red",icon:he},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:he},no_expiry:{label:"No Expiry",color:"bg-blue-500/10 text-blue-500",icon:Y}};return f[r]||f.active},m=()=>c.complianceScore===100?"text-sage":c.complianceScore>=80?"text-amber-500":"text-soft-red",t=()=>c.complianceScore===100?{label:"All Compliant",icon:"ðŸŸ¢"}:c.complianceScore>=80?{label:"Needs Attention",icon:"ðŸŸ¡"}:{label:"Critical Issues",icon:"ðŸ”´"},x=r=>Ms[r]||Ms.other;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(J,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Compliance & Certifications"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 md:gap-4",children:[e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Manage licenses and certifications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-primary/60 font-medium",children:"Status:"}),e.jsxs("span",{className:`font-bold text-lg ${m()}`,children:[t().icon," ",t().label," (",c.complianceScore,"%)"]})]})]})]}),e.jsxs(ue,{onClick:()=>b(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add License"]})]})]}),e.jsxs(ue,{onClick:()=>b(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add License/Certificate"]}),c.expiringSoon>0&&e.jsx(J,{className:"bg-accent/10 border-2 border-accent/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-primary",children:[c.expiringSoon," license",c.expiringSoon!==1?"s":""," expiring in next 90 days - Review required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Initiate renewal process to maintain compliance"})]})]})}),c.expired>0&&e.jsx(J,{className:"bg-soft-red/10 border-2 border-soft-red/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-soft-red flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-soft-red",children:[c.expired," license",c.expired!==1?"s have":" has"," expired - Immediate action required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Operating without valid licenses may result in penalties and business disruption"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(ut,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:c.total})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Licenses"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(Y,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:c.active})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active & Valid"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(de,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-3xl font-bold text-accent",children:c.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Renewal Due Soon"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-soft-red/20 rounded-button",children:e.jsx(he,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:"text-3xl font-bold text-soft-red",children:c.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})]}),s.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(r=>{const v=x(r.license_type),f=u(r.expiry_status,r.days_until_expiry),j=f.icon,_=r.total_checklist_items>0?Math.round(r.completed_checklist_items/r.total_checklist_items*100):100;return e.jsx(Ne,{to:`/compliance/${r.id}`,className:"block",children:e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 overflow-hidden p-0",children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${v.color}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-4xl",children:v.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:v.label}),e.jsx("p",{className:"text-xs text-dark-brown/60 font-mono",children:r.license_number})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Issued by:"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:r.issuing_authority})]}),r.expiry_date&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Expiry:"}),e.jsx("span",{className:`text-sm font-semibold ${r.expiry_status==="expired"||r.expiry_status==="critical"?"text-soft-red":r.expiry_status==="expiring_soon"?"text-accent":r.expiry_status==="renewal_due"?"text-amber-500":"text-sage"}`,children:R(new Date(r.expiry_date),"MMM dd, yyyy")})]}),r.days_until_expiry!==null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Days remaining:"}),e.jsx("span",{className:`text-lg font-bold ${r.days_until_expiry<0||r.days_until_expiry<=7?"text-soft-red":r.days_until_expiry<=30?"text-accent":r.days_until_expiry<=90?"text-amber-500":"text-sage"}`,children:r.days_until_expiry>=0?r.days_until_expiry:"Expired"})]})]}),r.total_checklist_items>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Compliance:"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[_,"%"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${_===100?"bg-sage":_>=80?"bg-amber-500":"bg-soft-red"}`,style:{width:`${_}%`}})})]})]}),e.jsx("div",{className:"pt-3 border-t border-dark-brown/10",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${f.color}`,children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-bold",children:f.label})]})})]})]})},r.id)})}):e.jsxs(J,{className:"p-16 text-center",children:[e.jsx(ae,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No licenses recorded yet"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:"Add your business licenses and certifications to track compliance"}),e.jsx(ue,{onClick:()=>b(!0),variant:"primary",size:"lg",children:"Add First License"})]})]}),h&&e.jsx(nl,{onClose:()=>b(!1),onSuccess:()=>{b(!1),a()}})]})}function ol({license:s}){const l=s.expiry_date?X(new Date(s.expiry_date),new Date):null,h=s.expiry_date?new Date(new Date(s.expiry_date).getTime()-s.renewal_reminder_days*24*60*60*1e3):null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"License Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issued To"}),e.jsx("p",{className:"font-semibold text-lg",children:s.issued_to})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"License Number"}),e.jsx("p",{className:"font-semibold text-lg font-mono",children:s.license_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold",children:s.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold",children:R(new Date(s.issue_date),"MMMM dd, yyyy")})]})]})]}),s.expiry_date&&e.jsx("div",{className:`rounded-xl p-6 ${l&&l<0?"bg-soft-red/10 border-2 border-soft-red/20":l&&l<=30?"bg-accent/10 border-2 border-accent/20":l&&l<=90?"bg-amber-500/10 border-2 border-amber-500/20":"bg-sage/10 border-2 border-sage/20"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${l&&l<0?"bg-soft-red/20":l&&l<=30?"bg-accent/20":l&&l<=90?"bg-amber-500/20":"bg-sage/20"}`,children:e.jsx(De,{className:`w-8 h-8 ${l&&l<0?"text-soft-red":l&&l<=30?"text-accent":l&&l<=90?"text-amber-500":"text-sage"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:l&&l<0?"License Expired":l&&l<=7?"License Expiring This Week":l&&l<=30?"License Expiring This Month":"License Renewal Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Expiry Date:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(new Date(s.expiry_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Days Until Expiry:"}),e.jsx("span",{className:`font-bold text-2xl ${l&&l<0?"text-soft-red":l&&l<=30?"text-accent":l&&l<=90?"text-amber-500":"text-sage"}`,children:l&&l>=0?l:"Expired"})]}),h&&l&&l>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Renewal Due By:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(h,"MMMM dd, yyyy")})]})]})]})]})}),s.scope&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Scope & Coverage"}),e.jsx("p",{className:"text-dark-brown/70",children:s.scope})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-4",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email Reminders"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_email?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_email?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push Notifications"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_push?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_push?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Reminder Period"})]}),e.jsxs("span",{className:"font-semibold text-dark-brown",children:[s.renewal_reminder_days," days before expiry"]})]})]})]}),s.notes&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("p",{className:"text-dark-brown/70 whitespace-pre-wrap",children:s.notes})]})]})}),s.last_inspection_date&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Inspection Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Last Inspection:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(new Date(s.last_inspection_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Inspections:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:s.inspection_count})]})]})]})]})}const Kt=[{value:"original",label:"Original License/Certificate"},{value:"renewal",label:"Renewal Documents"},{value:"application",label:"Application Forms"},{value:"receipt",label:"Payment Receipts"},{value:"correspondence",label:"Correspondence"},{value:"inspection",label:"Inspection Reports"},{value:"compliance",label:"Compliance Certificates"}];function il({licenseId:s}){const[l,h]=i.useState([]),[b,c]=i.useState("all");i.useEffect(()=>{n()},[s]);const n=async()=>{try{const{data:m,error:t}=await C.from("license_documents").select("*").eq("license_id",s).order("uploaded_at",{ascending:!1});if(t)throw t;h(m||[])}catch(m){console.error("Error fetching documents:",m)}},a=b==="all"?l:l.filter(m=>m.category===b),o=m=>{const t=Kt.find(x=>x.value===m);return t?t.label:m},u=m=>e.jsx(ae,{className:"w-6 h-6 text-primary"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${b==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All (",l.length,")"]}),Kt.map(m=>{const t=l.filter(x=>x.category===m.value).length;return t===0?null:e.jsxs("button",{onClick:()=>c(m.value),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${b===m.value?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[m.label.split(" ")[0]," (",t,")"]},m.value)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(Q,{className:"w-4 h-4"}),"Upload Document"]})]}),a.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:a.map(m=>e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:u(m.category)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:m.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:o(m.category)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:e.jsxs("span",{children:["Uploaded: ",R(new Date(m.uploaded_at),"MMM dd, yyyy")]})})]})]})},m.id))}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:b==="all"?"Upload license documents, receipts, and correspondence":`No ${o(b).toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Kt.map(m=>{const t=l.filter(x=>x.category===m.value).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(ae,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:m.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[t," document",t!==1?"s":""]})]})]},m.value)})})]})]})}const dl={fssai:["Display license at prominent location","Maintain hygiene standards","Source ingredients from licensed suppliers","Label products correctly (FSSAI logo, license number)","Maintain manufacturing records","Annual returns filed"],ayush:["Follow GMP guidelines","Use only approved ingredients","Maintain batch records","Quality control testing","Proper labeling (Ayush logo)"],gmp:["Maintain clean facility","Follow SOP (Standard Operating Procedures)","Staff training records","Equipment calibration","Documented processes"]};function cl({licenseId:s,license:l,onUpdate:h}){const{user:b}=H(),[c,n]=i.useState([]),[a,o]=i.useState(!1),[u,m]=i.useState("");i.useEffect(()=>{t()},[s]);const t=async()=>{try{const{data:N,error:w}=await C.from("compliance_checklist").select("*").eq("license_id",s).order("created_at",{ascending:!0});if(w)throw w;if(!N||N.length===0){const y=dl[l.license_type]||[];y.length>0&&await x(y)}else n(N)}catch(N){console.error("Error fetching checklist:",N)}},x=async N=>{try{const w=N.map(d=>({license_id:s,checklist_item:d,completed:!1})),{data:y,error:p}=await C.from("compliance_checklist").insert(w).select();if(p)throw p;n(y||[])}catch(w){console.error("Error initializing checklist:",w)}},r=async(N,w)=>{try{const{error:y}=await C.from("compliance_checklist").update({completed:!w,last_verified_date:w?null:new Date().toISOString().split("T")[0],verified_by:w?null:b?.id}).eq("id",N);if(y)throw y;await t(),h()}catch(y){console.error("Error updating checklist:",y)}},v=async()=>{if(u.trim())try{const{error:N}=await C.from("compliance_checklist").insert([{license_id:s,checklist_item:u,completed:!1}]);if(N)throw N;m(""),o(!1),await t(),h()}catch(N){console.error("Error adding checklist item:",N)}},f=c.filter(N=>N.completed).length,j=c.length,_=j>0?Math.round(f/j*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Compliance Score"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-5xl font-bold mb-2",children:[_,"%"]}),e.jsxs("p",{className:"text-white/80",children:[f," of ",j," items completed"]})]}),e.jsxs("div",{className:"w-32 h-32 relative",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"rgba(255,255,255,0.2)",strokeWidth:"12",fill:"none"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"white",strokeWidth:"12",fill:"none",strokeDasharray:`${_/100*351.86} 351.86`,strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(Y,{className:"w-12 h-12 text-white"})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Compliance Requirements"}),e.jsxs("button",{onClick:()=>o(!a),className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-lg font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Item"]})]}),a&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("input",{type:"text",value:u,onChange:N=>m(N.target.value),placeholder:"Enter new compliance requirement...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none mb-3",onKeyDown:N=>{N.key==="Enter"&&v()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 bg-primary text-white rounded-lg font-semibold hover:bg-primary/90 transition-colors",children:"Add"}),e.jsx("button",{onClick:()=>{o(!1),m("")},className:"px-4 py-2 bg-dark-brown/10 text-dark-brown rounded-lg font-semibold hover:bg-dark-brown/20 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-3",children:c.map(N=>e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${N.completed?"bg-sage/5 border-sage/20":"bg-white border-dark-brown/10"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>r(N.id,N.completed),className:"flex-shrink-0 mt-1",children:N.completed?e.jsx(Y,{className:"w-6 h-6 text-sage"}):e.jsx(Aa,{className:"w-6 h-6 text-dark-brown/30 hover:text-primary transition-colors"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold ${N.completed?"text-sage line-through":"text-dark-brown"}`,children:N.checklist_item}),N.completed&&N.last_verified_date&&e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-1",children:["Verified on ",R(new Date(N.last_verified_date),"MMM dd, yyyy")]}),N.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2 italic",children:N.notes}),N.proof_url&&e.jsxs("button",{className:"flex items-center gap-2 mt-2 text-sm text-primary hover:underline",children:[e.jsx(Pe,{className:"w-4 h-4"}),"View proof"]})]})]})},N.id))}),c.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Y,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No compliance requirements added"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add compliance requirements specific to this license"}),e.jsx("button",{onClick:()=>o(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add First Requirement"})]}),_<100&&c.length>0&&e.jsxs("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Pending Items"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[j-f," compliance requirement",j-f!==1?"s":""," still need",j-f===1?"s":""," to be completed to achieve 100% compliance."]})]}),_===100&&c.length>0&&e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-8 h-8 text-sage"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sage text-lg",children:"100% Compliant"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"All compliance requirements have been met"})]})]})})]})}function xl({licenseId:s}){const[l,h]=i.useState([]),[b,c]=i.useState({totalRenewals:0,totalCost:0,avgCost:0,lastRenewalCost:0});i.useEffect(()=>{n()},[s]);const n=async()=>{try{const{data:a,error:o}=await C.from("license_renewals").select("*").eq("license_id",s).order("renewal_date",{ascending:!1});if(o)throw o;if(h(a||[]),a&&a.length>0){const u=a.length,m=a.reduce((r,v)=>r+(v.cost||0),0),t=m/u,x=a[0].cost||0;c({totalRenewals:u,totalCost:m,avgCost:t,lastRenewalCost:x})}}catch(a){console.error("Error fetching renewals:",a)}};return e.jsxs("div",{className:"space-y-6",children:[l.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Renewals"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:b.totalRenewals})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:["â‚¹",b.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Average Cost"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",b.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Last Renewal"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",b.lastRenewalCost.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Renewal Timeline"}),l.length>0?e.jsx("div",{className:"space-y-4",children:l.map((a,o)=>e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:"absolute -left-2 top-0 w-4 h-4 rounded-full bg-primary border-4 border-white"}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(de,{className:"w-5 h-5 text-primary"}),e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Renewal ",l.length-o]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:R(new Date(a.renewal_date),"MMMM dd, yyyy")})]}),a.cost&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",a.cost]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Previous Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:R(new Date(a.previous_expiry),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"New Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-sage",children:R(new Date(a.new_expiry),"MMM dd, yyyy")})]})]}),a.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:a.notes})}),a.certificate_url&&e.jsxs("button",{className:"mt-3 flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(ae,{className:"w-4 h-4"}),"View renewed certificate"]})]})]},a.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h4",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No renewal history"}),e.jsx("p",{className:"text-dark-brown/40",children:"Renewal records will appear here when the license is renewed"})]})]}),l.length>1&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Re,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Total Spent on Renewals"})]}),e.jsxs("span",{className:"font-bold text-lg text-primary",children:["â‚¹",b.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-5 h-5 text-sage"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Average Renewal Cost"})]}),e.jsxs("span",{className:"font-bold text-lg text-sage",children:["â‚¹",b.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Last Renewal Cost"})]}),e.jsxs("span",{className:`font-bold text-lg ${b.lastRenewalCost>b.avgCost?"text-soft-red":"text-sage"}`,children:["â‚¹",b.lastRenewalCost.toFixed(0),b.lastRenewalCost>b.avgCost&&e.jsxs("span",{className:"text-xs ml-2",children:["(+",((b.lastRenewalCost-b.avgCost)/b.avgCost*100).toFixed(0),"%)"]})]})]})]})]})]})}function ml({licenseId:s}){const[l,h]=i.useState([]),[b,c]=i.useState(!0);i.useEffect(()=>{n()},[s]);const n=async()=>{try{const a=[],[o,u,m,t,x]=await Promise.all([C.from("licenses").select("created_at, updated_at").eq("id",s).maybeSingle(),C.from("license_documents").select("file_name, uploaded_at, category").eq("license_id",s),C.from("license_renewals").select("renewal_date, new_expiry").eq("license_id",s),C.from("compliance_checklist").select("checklist_item, completed, last_verified_date").eq("license_id",s),C.from("inspections").select("inspection_date, compliance_status, authority").eq("license_id",s)]);o.data&&(a.push({type:"license_added",timestamp:o.data.created_at,description:"License added to system",icon:ae,color:"text-primary"}),o.data.updated_at!==o.data.created_at&&a.push({type:"license_updated",timestamp:o.data.updated_at,description:"License details updated",icon:ge,color:"text-blue-500"})),u.data&&u.data.forEach(r=>{a.push({type:"document_uploaded",timestamp:r.uploaded_at,description:`Document uploaded: ${r.file_name}`,details:`Category: ${r.category}`,icon:Pe,color:"text-sage"})}),m.data&&m.data.forEach(r=>{a.push({type:"renewal_processed",timestamp:r.renewal_date,description:"License renewed",details:`New expiry: ${R(new Date(r.new_expiry),"MMM dd, yyyy")}`,icon:de,color:"text-accent"})}),t.data&&t.data.filter(r=>r.completed&&r.last_verified_date).forEach(r=>{a.push({type:"compliance_verified",timestamp:r.last_verified_date,description:"Compliance item verified",details:r.checklist_item,icon:Y,color:"text-sage"})}),x.data&&x.data.forEach(r=>{a.push({type:"inspection",timestamp:r.inspection_date,description:`Inspection by ${r.authority}`,details:`Result: ${r.compliance_status}`,icon:Ue,color:r.compliance_status==="pass"?"text-sage":"text-accent"})}),a.sort((r,v)=>new Date(v.timestamp).getTime()-new Date(r.timestamp).getTime()),h(a)}catch(a){console.error("Error fetching audit log:",a)}finally{c(!1)}};return b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading audit log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-2",children:"Activity History"}),e.jsx("p",{className:"text-dark-brown/70",children:"Complete audit trail of all activities related to this license"})]}),l.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:e.jsx("div",{className:"space-y-4",children:l.map((a,o)=>{const u=a.icon;return e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:`absolute -left-3 top-0 w-6 h-6 rounded-full bg-white border-2 border-dark-brown/10 flex items-center justify-center ${a.color}`,children:e.jsx(u,{className:"w-3 h-3"})}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:a.description}),e.jsx("span",{className:"text-sm text-dark-brown/60",children:R(new Date(a.timestamp),"MMM dd, yyyy")})]}),a.details&&e.jsx("p",{className:"text-sm text-dark-brown/70",children:a.details}),e.jsx("p",{className:"text-xs text-dark-brown/50 mt-2",children:R(new Date(a.timestamp),"h:mm a")})]})]},o)})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity history will appear here as actions are performed"})]}),e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-sage flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Full Transparency"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"This audit log provides a complete history of all activities related to this license. All actions are timestamped and recorded for compliance and regulatory purposes."})]})]})})]})}const hl=[{id:"details",label:"Details",icon:ae},{id:"documents",label:"Documents",icon:Ta},{id:"compliance",label:"Compliance Checklist",icon:rs},{id:"renewal",label:"Renewal History",icon:de},{id:"audit",label:"Audit Log",icon:ae}],Ps={fssai:{label:"FSSAI License",icon:"ðŸ´"},ayush:{label:"Ayush License",icon:"ðŸŒ¿"},gmp:{label:"GMP Certification",icon:"âœ“"},trade:{label:"Trade License",icon:"ðŸª"},gst:{label:"GST Registration",icon:"ðŸ’¼"},organic:{label:"Organic Certification",icon:"ðŸŒ±"},pollution:{label:"Pollution Control",icon:"ðŸ­"},fire:{label:"Fire Safety",icon:"ðŸ”¥"},drug:{label:"Drug License",icon:"ðŸ’Š"},other:{label:"Other License",icon:"ðŸ“„"}};function pl(){const{id:s}=Je(),l=ce(),[h,b]=i.useState(null),[c,n]=i.useState("details"),[a,o]=i.useState(!0);i.useEffect(()=>{s&&u()},[s]);const u=async()=>{try{const{data:j,error:_}=await C.from("license_summary").select("*").eq("id",s).maybeSingle();if(_)throw _;b(j)}catch(j){console.error("Error fetching license:",j)}finally{o(!1)}},m=async()=>{if(confirm("Are you sure you want to delete this license? This action cannot be undone."))try{const{error:j}=await C.from("licenses").delete().eq("id",s);if(j)throw j;l("/compliance")}catch(j){console.error("Error deleting license:",j),alert("Error deleting license")}},t=()=>{if(!h)return null;const j={active:{label:"Active",color:"bg-sage/10 text-sage"},pending:{label:"Pending Application",color:"bg-amber-500/10 text-amber-500"},renewal_in_process:{label:"Renewal In Process",color:"bg-blue-500/10 text-blue-500"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red"}};return j[h.status]||j.active},x=()=>{if(!h||!h.expiry_date)return"text-dark-brown";const j=X(new Date(h.expiry_date),new Date);return j<0||j<=7?"text-soft-red":j<=30?"text-accent":j<=90?"text-amber-500":"text-sage"};if(a)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading license details..."})]})})});if(!h)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"License not found"}),e.jsx("button",{onClick:()=>l("/compliance"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Compliance"})]})})});const r=Ps[h.license_type]||Ps.other,v=t(),f=h.expiry_date?X(new Date(h.expiry_date),new Date):null;return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/compliance"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Be,{className:"w-5 h-5"}),"Back to Compliance"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsx("div",{className:"text-5xl",children:r.icon}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:r.label}),e.jsx("p",{className:"text-lg font-mono text-dark-brown/70 mb-2",children:h.license_number}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:v&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${v.color}`,children:v.label})})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:h.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(h.issue_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:`font-semibold ${x()}`,children:h.expiry_date?R(new Date(h.expiry_date),"MMM dd, yyyy"):"No Expiry"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold text-xl ${x()}`,children:f!==null?f>=0?`${f} days`:"Expired":"N/A"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:hl.map(j=>{const _=j.icon;return e.jsxs("button",{onClick:()=>n(j.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${c===j.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(_,{className:"w-5 h-5"}),j.label]},j.id)})})}),e.jsxs("div",{className:"p-6",children:[c==="details"&&e.jsx(ol,{licenseId:s,license:h,onUpdate:u}),c==="documents"&&e.jsx(il,{licenseId:s}),c==="compliance"&&e.jsx(cl,{licenseId:s,license:h,onUpdate:u}),c==="renewal"&&e.jsx(xl,{licenseId:s,license:h}),c==="audit"&&e.jsx(ml,{licenseId:s})]})]})]})})}const bl=["ðŸ˜Š","ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥","âœ…","ðŸ‘","ðŸ’¡","ðŸŒŸ","ðŸ™","ðŸ’¯"];function ul({roomId:s,onMessageSent:l}){const{user:h}=H(),[b,c]=i.useState(""),[n,a]=i.useState(!1),[o,u]=i.useState(!1),m=i.useRef(null),t=i.useRef();i.useEffect(()=>{x()},[b]),i.useEffect(()=>()=>{t.current&&clearTimeout(t.current),r(!1)},[s]);const x=()=>{if(m.current){m.current.style.height="auto";const w=Math.min(m.current.scrollHeight,200);m.current.style.height=`${w}px`}},r=async w=>{if(h)try{w?await C.from("chat_typing_status").upsert({room_id:s,user_id:h.id,is_typing:!0,last_typing_time:new Date().toISOString()},{onConflict:"room_id,user_id"}):await C.from("chat_typing_status").delete().eq("room_id",s).eq("user_id",h.id)}catch(y){console.error("Error updating typing status:",y)}},v=w=>{c(w.target.value),t.current&&clearTimeout(t.current),w.target.value.trim()?(r(!0),t.current=setTimeout(()=>{r(!1)},3e3)):r(!1)},f=async w=>{if(w?.preventDefault(),!b.trim()||!h||n)return;const y=b.trim();c(""),a(!0),r(!1),t.current&&clearTimeout(t.current);try{const p=j(y),{error:d}=await C.from("chat_messages").insert([{room_id:s,sender_id:h.id,message_text:y,message_type:"text",mentions:p}]);if(d)throw d;l()}catch(p){console.error("Error sending message:",p),c(y)}finally{a(!1)}},j=w=>{const y=/@(\w+)/g,p=[];let d;for(;(d=y.exec(w))!==null;)p.push(d[1]);return p},_=w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),f())},N=w=>{const y=m.current;if(!y)return;const p=y.selectionStart,d=y.selectionEnd,k=b.substring(0,p)+w+b.substring(d);c(k),setTimeout(()=>{y.focus();const g=p+w.length;y.setSelectionRange(g,g)},0),u(!1)};return e.jsx("div",{className:"border-t-2 border-white/40 bg-gradient-to-br from-white/70 to-cream/50 p-6 backdrop-blur-sm",children:e.jsxs("form",{onSubmit:f,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex-1 bg-white/80 border-2 border-white/60 rounded-2xl focus-within:border-primary/40 focus-within:shadow-xl transition-all shadow-lg backdrop-blur-sm",children:[e.jsx("textarea",{ref:m,value:b,onChange:v,onKeyDown:_,placeholder:"Type your message... (Shift+Enter for new line)",rows:1,className:"w-full px-5 py-4 bg-transparent resize-none focus:outline-none text-dark-brown placeholder:text-dark-brown/40 font-medium",style:{maxHeight:"200px"}}),e.jsxs("div",{className:"flex items-center gap-2 px-5 pb-4",children:[e.jsx("button",{type:"button",className:"p-2.5 hover:bg-primary/10 rounded-xl transition-all text-dark-brown/60 hover:text-primary hover:scale-110 active:scale-95",title:"Attach file",children:e.jsx(os,{className:"w-5 h-5",strokeWidth:2})}),e.jsx("button",{type:"button",className:"p-2.5 hover:bg-primary/10 rounded-xl transition-all text-dark-brown/60 hover:text-primary hover:scale-110 active:scale-95",title:"Attach image",children:e.jsx(ns,{className:"w-5 h-5",strokeWidth:2})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>u(!o),className:"p-2.5 hover:bg-primary/10 rounded-xl transition-all text-dark-brown/60 hover:text-primary hover:scale-110 active:scale-95",title:"Add emoji",children:e.jsx(Zs,{className:"w-5 h-5",strokeWidth:2})}),o&&e.jsx("div",{className:"absolute bottom-full left-0 mb-3 bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border-2 border-white/60 p-4 grid grid-cols-6 gap-2",children:bl.map(w=>e.jsx("button",{type:"button",onClick:()=>N(w),className:"text-2xl hover:bg-primary/10 rounded-xl p-2 transition-all hover:scale-125 active:scale-95",children:w},w))})]}),e.jsx("div",{className:"flex-1"}),b.length>0&&e.jsxs("span",{className:"text-xs text-dark-brown/50 font-semibold bg-dark-brown/5 px-3 py-1.5 rounded-lg",children:[b.length," chars"]})]})]}),e.jsx("button",{type:"submit",disabled:!b.trim()||n,className:"p-5 bg-gradient-to-br from-primary via-sage to-secondary text-white rounded-2xl font-bold hover:shadow-2xl hover:scale-105 active:scale-95 transition-all disabled:opacity-40 disabled:cursor-not-allowed flex-shrink-0 border-2 border-white/30 shadow-xl",title:"Send message",children:e.jsx(Ys,{className:"w-6 h-6",strokeWidth:2.5})})]}),e.jsx("div",{className:"flex items-center gap-2 px-2",children:e.jsxs("div",{className:"flex-1 flex flex-wrap gap-2 text-xs text-dark-brown/50",children:[e.jsxs("span",{className:"bg-white/60 px-3 py-1.5 rounded-lg font-medium border border-white/40",children:[e.jsx("span",{className:"font-mono text-primary font-semibold",children:"@username"})," to mention"]}),e.jsxs("span",{className:"bg-white/60 px-3 py-1.5 rounded-lg font-medium border border-white/40",children:[e.jsx("span",{className:"font-mono text-primary font-semibold",children:"**text**"})," for bold"]})]})})]})})}const fl=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥"];function gl({message:s,isOwnMessage:l,onDelete:h,onEdit:b}){const{user:c}=H(),[n,a]=i.useState(!1),[o,u]=i.useState(!1),[m,t]=i.useState(s.message_text),x=async()=>{if(confirm("Delete this message?"))try{const{error:N}=await C.from("chat_messages").update({is_deleted:!0,deleted_at:new Date().toISOString()}).eq("id",s.id);if(N)throw N;h()}catch(N){console.error("Error deleting message:",N)}},r=async()=>{if(m.trim())try{const{error:N}=await C.from("chat_messages").update({message_text:m.trim(),is_edited:!0,edited_at:new Date().toISOString()}).eq("id",s.id);if(N)throw N;u(!1),b()}catch(N){console.error("Error editing message:",N)}},v=async N=>{if(c)try{const w=s.reactions||{},y=w[N]||[],p={...w};y.includes(c.id)?(p[N]=y.filter(k=>k!==c.id),p[N].length===0&&delete p[N]):p[N]=[...y,c.id];const{error:d}=await C.from("chat_messages").update({reactions:p}).eq("id",s.id);if(d)throw d}catch(w){console.error("Error adding reaction:",w)}},f=N=>{let w=N;return w=w.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),w=w.replace(/\*(.*?)\*/g,"<em>$1</em>"),w=w.replace(/`(.*?)`/g,'<code class="bg-dark-brown/10 px-1 rounded">$1</code>'),w=w.replace(/@(\w+)/g,'<span class="bg-accent/20 text-accent font-semibold px-1 rounded">@$1</span>'),w},j=s.reactions||{},_=Object.entries(j).filter(([N,w])=>w.length>0);return e.jsx("div",{className:`group relative ${l?"flex justify-end":"flex justify-start"}`,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:e.jsxs("div",{className:`flex-1 max-w-2xl ${l?"items-end":"items-start"} flex flex-col`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${l?"flex-row-reverse":"flex-row"}`,children:[e.jsx("span",{className:"text-xs text-dark-brown/50 font-semibold",children:R(new Date(s.created_at),"h:mm a")}),s.is_edited&&e.jsx("span",{className:"text-xs text-dark-brown/40 italic bg-dark-brown/5 px-2 py-0.5 rounded-full",children:"edited"})]}),e.jsx("div",{className:"relative",children:o?e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm border-2 border-primary/30 rounded-2xl p-5 shadow-xl",children:[e.jsx("textarea",{value:m,onChange:N=>t(N.target.value),className:"w-full p-3 bg-cream/30 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary resize-none font-medium text-dark-brown",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsx("button",{onClick:r,className:"px-5 py-2 bg-gradient-to-br from-primary to-sage text-white rounded-xl text-sm font-bold hover:shadow-xl transition-all hover:scale-105 active:scale-95",children:"Save"}),e.jsx("button",{onClick:()=>{u(!1),t(s.message_text)},className:"px-5 py-2 bg-white border-2 border-dark-brown/20 text-dark-brown rounded-xl text-sm font-bold hover:bg-dark-brown/5 transition-all hover:scale-105 active:scale-95",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`rounded-2xl px-5 py-4 shadow-lg transition-all ${l?"bg-gradient-to-br from-primary via-sage to-secondary text-white border-2 border-white/30":"bg-white/90 backdrop-blur-sm border-2 border-white/60 text-dark-brown"}`,children:e.jsx("div",{className:`text-base leading-relaxed break-words font-medium ${l?"text-white":"text-dark-brown"}`,dangerouslySetInnerHTML:{__html:f(s.message_text)}})}),n&&l&&e.jsxs("div",{className:"absolute -top-4 right-0 bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl border-2 border-white/60 flex gap-2 p-2",children:[e.jsx("button",{onClick:()=>u(!0),className:"p-2 hover:bg-primary/10 rounded-lg transition-all hover:scale-110 active:scale-95",title:"Edit",children:e.jsx(ge,{className:"w-5 h-5 text-primary",strokeWidth:2})}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-red-50 rounded-lg transition-all hover:scale-110 active:scale-95",title:"Delete",children:e.jsx(oe,{className:"w-5 h-5 text-red-500",strokeWidth:2})})]})]})}),_.length>0&&e.jsx("div",{className:`flex flex-wrap gap-2 mt-3 ${l?"justify-end":"justify-start"}`,children:_.map(([N,w])=>e.jsxs("button",{onClick:()=>v(N),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-sm font-bold transition-all hover:scale-110 active:scale-95 shadow-md ${w.includes(c?.id)?"bg-gradient-to-br from-amber-100 to-amber-200 border-2 border-amber-400":"bg-white/90 backdrop-blur-sm border-2 border-white/60 hover:border-primary/40"}`,children:[e.jsx("span",{className:"text-lg",children:N}),e.jsx("span",{className:"text-dark-brown",children:w.length})]},N))}),e.jsx("div",{className:`flex gap-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity ${l?"justify-end":"justify-start"}`,children:fl.map(N=>e.jsx("button",{onClick:()=>v(N),className:"text-xl hover:scale-125 active:scale-95 transition-all p-1.5 hover:bg-white/60 rounded-xl backdrop-blur-sm",title:`React with ${N}`,children:N},N))})]})})}function jl({room:s,teamMembers:l}){const{user:h}=H(),[b,c]=i.useState([]),[n,a]=i.useState(!0),[o,u]=i.useState([]),m=i.useRef(null),t=i.useRef(null),[x,r]=i.useState(!1);i.useEffect(()=>{s&&(v(),f(),j(),_())},[s?.id]),i.useEffect(()=>{N()},[b]);const v=async()=>{try{a(!0);const{data:g,error:M}=await C.from("chat_messages").select("*").eq("room_id",s.id).eq("is_deleted",!1).order("created_at",{ascending:!0}).limit(100);if(M)throw M;c(g||[])}catch(g){console.error("Error fetching messages:",g)}finally{a(!1)}},f=()=>{const g=C.channel(`room_${s.id}_messages`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},M=>{c(E=>[...E,M.new]),_()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},M=>{c(E=>E.map(D=>D.id===M.new.id?M.new:D))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},M=>{c(E=>E.filter(D=>D.id!==M.old.id))}).subscribe();return()=>{g.unsubscribe()}},j=()=>{const g=C.channel(`room_${s.id}_typing`).on("postgres_changes",{event:"*",schema:"public",table:"chat_typing_status",filter:`room_id=eq.${s.id}`},async()=>{const{data:M}=await C.from("chat_typing_status").select("*").eq("room_id",s.id).eq("is_typing",!0).neq("user_id",h?.id||"");u(M||[])}).subscribe();return()=>{g.unsubscribe()}},_=async()=>{if(h)try{const{error:g}=await C.from("chat_room_members").update({last_read_at:new Date().toISOString()}).eq("room_id",s.id).eq("user_id",h.id);if(g)throw g}catch(g){console.error("Error marking room as read:",g)}},N=()=>{m.current?.scrollIntoView({behavior:"smooth"})},w=()=>{if(!t.current)return;const{scrollTop:g,scrollHeight:M,clientHeight:E}=t.current,D=M-g-E<100;r(!D)},y=g=>{const M=new Date(g);return As(M)?"Today":Is(M)?"Yesterday":R(M,"MMMM dd, yyyy")},p=(g,M)=>M?!Jt(new Date(g.created_at),new Date(M.created_at)):!0,d=g=>{const M=l.find(E=>E.id===g);return g===h?.id?"You":M?.full_name||M?.email?.split("@")[0]||"Unknown"},k=()=>o.map(g=>{const M=l.find(E=>E.id===g.user_id);return M?.full_name||M?.email?.split("@")[0]||"Someone"}).join(", ");return e.jsxs("div",{className:"flex-1 flex flex-col h-full",children:[e.jsx("div",{className:"border-b-2 border-white/40 p-6 bg-gradient-to-r from-white/60 to-cream/40 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary/20 to-sage/10 rounded-2xl flex items-center justify-center text-3xl shadow-lg border-2 border-white/50",children:s.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary truncate drop-shadow-sm",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-dark-brown/70 truncate font-medium",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/60 rounded-xl border border-white/50 shadow-md backdrop-blur-sm",children:[e.jsx(je,{className:"w-5 h-5 text-primary",strokeWidth:2.5}),e.jsxs("span",{className:"text-sm text-primary font-bold",children:[l.length," partner",l.length!==1?"s":""]})]})]})}),e.jsxs("div",{ref:t,onScroll:w,className:"flex-1 overflow-y-auto p-6 bg-gradient-to-br from-cream/40 to-white/30",children:[n?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):b.length>0?e.jsxs("div",{className:"space-y-5",children:[b.map((g,M)=>e.jsxs("div",{children:[p(g,b[M-1])&&e.jsxs("div",{className:"flex items-center gap-4 my-8",children:[e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-dark-brown/20 to-transparent"}),e.jsx("span",{className:"text-xs font-bold text-dark-brown/50 px-4 py-2 bg-white/60 backdrop-blur-sm rounded-full shadow-sm border border-white/50",children:y(g.created_at)}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-dark-brown/20 to-transparent"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[g.sender_id!==h?.id&&e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-base flex-shrink-0 shadow-lg border-2 border-white/30",children:d(g.sender_id)[0]?.toUpperCase()}),e.jsxs("div",{className:`flex-1 ${g.sender_id===h?.id?"ml-auto":""}`,children:[g.sender_id!==h?.id&&e.jsx("div",{className:"text-sm font-bold text-primary mb-2 ml-1",children:d(g.sender_id)}),e.jsx(gl,{message:g,isOwnMessage:g.sender_id===h?.id,onDelete:()=>v(),onEdit:()=>v()})]}),g.sender_id===h?.id&&e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-base flex-shrink-0 shadow-lg border-2 border-white/30",children:d(g.sender_id)[0]?.toUpperCase()})]})]},g.id)),e.jsx("div",{ref:m})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-primary/10 to-sage/10 rounded-full flex items-center justify-center mx-auto mb-6 text-6xl shadow-xl border-2 border-white/50",children:s.icon}),e.jsx("h4",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No messages yet"}),e.jsx("p",{className:"text-dark-brown/60 font-medium text-lg",children:"Start the conversation with your team!"})]})}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg mt-6 border-2 border-white/50",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("span",{className:"w-2.5 h-2.5 bg-primary rounded-full animate-bounce shadow-sm",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2.5 h-2.5 bg-primary rounded-full animate-bounce shadow-sm",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2.5 h-2.5 bg-primary rounded-full animate-bounce shadow-sm",style:{animationDelay:"300ms"}})]}),e.jsxs("span",{className:"text-sm text-dark-brown/70 font-medium",children:[k()," ",o.length===1?"is":"are"," typing..."]})]})]}),x&&e.jsx("button",{onClick:N,className:"absolute bottom-28 right-8 p-4 bg-gradient-to-br from-primary to-sage text-white rounded-2xl shadow-2xl hover:shadow-[0_8px_30px_rgba(139,69,19,0.4)] transition-all z-10 hover:scale-110 active:scale-95 border-2 border-white/30",children:e.jsx(Rs,{className:"w-6 h-6",strokeWidth:2.5})}),e.jsx(ul,{roomId:s.id,onMessageSent:v})]})}function yl({onSelectRoom:s,selectedRoomId:l,onNewChat:h,onNewGroup:b}){const{user:c}=H(),[n,a]=i.useState([]),[o,u]=i.useState(!0),[m,t]=i.useState(""),[x,r]=i.useState([]),[v,f]=i.useState(!1);i.useEffect(()=>{c&&(j(),_(),N())},[c]);const j=async()=>{if(c)try{const{data:g,error:M}=await C.from("chat_rooms").select("*").contains("participant_ids",[c.id]).order("created_at",{ascending:!1});if(M)throw M;const E=await Promise.all((g||[]).map(async D=>{const{data:I}=await C.from("chat_room_members").select("last_read_at").eq("room_id",D.id).eq("user_id",c.id).maybeSingle(),{data:q}=await C.from("chat_messages").select("message_text, created_at, sender_id").eq("room_id",D.id).eq("is_deleted",!1).order("created_at",{ascending:!1}).limit(1).maybeSingle(),{data:B}=await C.from("chat_messages").select("id",{count:"exact",head:!0}).eq("room_id",D.id).neq("sender_id",c.id).eq("is_deleted",!1).gt("created_at",I?.last_read_at||"1970-01-01");if(D.is_direct&&D.participant_ids?.length===2){const G=D.participant_ids.find(ee=>ee!==c.id),{data:se}=await C.from("users").select("id, name, email, role").eq("id",G).maybeSingle();return{room_id:D.id,name:D.name,type:D.type,is_direct:D.is_direct,participant_ids:D.participant_ids,icon:D.icon,description:D.description,unread_count:B?.count||0,last_message_text:q?.message_text||null,last_message_at:q?.created_at||null,display_name:se?.name||se?.email?.split("@")[0]||"User",display_icon:"ðŸ‘¤",other_user:se}}return{room_id:D.id,name:D.name,type:D.type,is_direct:D.is_direct,participant_ids:D.participant_ids,icon:D.icon,description:D.description,unread_count:B?.count||0,last_message_text:q?.message_text||null,last_message_at:q?.created_at||null,display_name:D.name,display_icon:D.icon||"ðŸ’¬"}}));E.sort((D,I)=>{const q=D.last_message_at?new Date(D.last_message_at).getTime():0;return(I.last_message_at?new Date(I.last_message_at).getTime():0)-q}),a(E)}catch(g){console.error("Error fetching rooms:",g)}finally{u(!1)}},_=async()=>{try{const{data:g,error:M}=await C.from("users").select("id, name, email, role").eq("approval_status","approved").neq("id",c?.id||"");if(M)throw M;r(g||[])}catch(g){console.error("Error fetching users:",g)}},N=()=>{const g=C.channel("user_rooms").on("postgres_changes",{event:"*",schema:"public",table:"chat_messages"},()=>{j()}).subscribe();return()=>{g.unsubscribe()}},w=g=>{if(!g)return"";const M=new Date(g);return As(M)?R(M,"h:mm a"):Is(M)?"Yesterday":R(M,"MMM d")},y=g=>g.type==="direct"?"ðŸ‘¤":g.type==="group"?"ðŸ‘¥":g.type==="team"?"ðŸ¢":g.display_icon||"ðŸ’¬",p=n.filter(g=>g.display_name?.toLowerCase().includes(m.toLowerCase())),d=x.filter(g=>g.name?.toLowerCase().includes(m.toLowerCase())||g.email?.toLowerCase().includes(m.toLowerCase())),k=async g=>{try{const{data:M,error:E}=await C.rpc("get_or_create_direct_chat",{other_user_id:g});if(E)throw E;const{data:D}=await C.from("chat_rooms").select("*").eq("id",M).maybeSingle();if(D){const I=D.participant_ids.find(G=>G!==c?.id),{data:q}=await C.from("users").select("id, name, email, role").eq("id",I).maybeSingle(),B={room_id:D.id,name:D.name,type:D.type,is_direct:D.is_direct,participant_ids:D.participant_ids,icon:D.icon,description:D.description,unread_count:0,last_message_text:null,last_message_at:null,display_name:q?.name||q?.email?.split("@")[0]||"User",display_icon:"ðŸ‘¤",other_user:q};s(B),f(!1),j()}}catch(M){console.error("Error creating/opening chat:",M)}};return e.jsxs("div",{className:"flex flex-col h-full bg-gradient-to-b from-white/50 to-cream/30",children:[e.jsxs("div",{className:"p-4 border-b border-white/40",children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:m,onChange:g=>t(g.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-sm font-medium placeholder:text-dark-brown/40"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>f(!v),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-xl font-semibold text-sm hover:shadow-lg transition-all hover:scale-105 active:scale-95 ${v?"bg-gradient-to-br from-primary to-sage text-white":"bg-white/80 border-2 border-primary/20 text-primary"}`,children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"Users"})]}),e.jsx("button",{onClick:b,className:"flex items-center justify-center gap-2 px-3 py-2 bg-white/80 border-2 border-primary/20 text-primary rounded-xl font-semibold text-sm hover:shadow-lg transition-all hover:scale-105 active:scale-95",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),v&&e.jsx("div",{className:"border-b-2 border-white/40 bg-white/30 p-3",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-xs font-bold text-dark-brown/70 uppercase tracking-wider",children:["All Users (",x.length,")"]}),e.jsx("button",{onClick:()=>f(!1),className:"text-xs text-primary font-semibold hover:underline",children:"Show Chats"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):v?e.jsx("div",{className:"p-2",children:d.length>0?d.map(g=>e.jsx("button",{onClick:()=>k(g.id),className:"w-full p-3 rounded-xl mb-2 transition-all text-left bg-white/60 border-2 border-white/40 hover:border-primary/20 hover:shadow-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-lg border-2 border-white/50",children:(g.name||g.email)?.[0]?.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-primary truncate text-sm",children:g.name||g.email?.split("@")[0]||"User"}),g.role==="admin"&&e.jsx(Mt,{className:"w-3 h-3 text-amber-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:g.email})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ze,{className:"w-5 h-5 text-primary/60"})})]})},g.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(je,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center",children:"No users found"})]})}):p.length>0?e.jsx("div",{className:"p-2",children:p.map(g=>e.jsx("button",{onClick:()=>s(g),className:`w-full p-3 rounded-xl mb-2 transition-all text-left ${l===g.room_id?"bg-gradient-to-br from-primary/20 to-sage/10 border-2 border-primary/30 shadow-lg":"bg-white/60 border-2 border-white/40 hover:border-primary/20 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary/20 to-sage/10 flex items-center justify-center text-2xl border-2 border-white/50",children:y(g)}),g.unread_count>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center text-white text-xs font-bold border-2 border-white",children:g.unread_count>9?"9+":g.unread_count})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-primary truncate text-sm",children:g.display_name}),g.other_user?.role==="admin"&&e.jsx(Mt,{className:"w-3 h-3 text-amber-500 flex-shrink-0"})]}),e.jsx("span",{className:"text-xs text-dark-brown/50 font-medium flex-shrink-0 ml-2",children:w(g.last_message_at)})]}),g.last_message_text&&e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:g.last_message_text}),!g.last_message_text&&g.type==="direct"&&e.jsx("p",{className:"text-xs text-dark-brown/40 italic",children:"Start a conversation"})]})]})},g.room_id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(ze,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center mb-4",children:m?"No conversations found":"No conversations yet"}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-gradient-to-br from-primary to-sage text-white rounded-xl font-semibold text-sm hover:shadow-lg transition-all",children:"Start a conversation"})]})})]})}function wl({onClose:s,onChatCreated:l}){const{user:h}=H(),[b,c]=i.useState([]),[n,a]=i.useState([]),[o,u]=i.useState(""),[m,t]=i.useState(!0),[x,r]=i.useState(!1);i.useEffect(()=>{v()},[h]),i.useEffect(()=>{a(o?b.filter(j=>j.name?.toLowerCase().includes(o.toLowerCase())||j.email?.toLowerCase().includes(o.toLowerCase())):b)},[o,b]);const v=async()=>{try{const{data:j,error:_}=await C.from("users").select("id, name, email, role").eq("approval_status","approved").neq("id",h?.id||"").order("name",{ascending:!0});if(_)throw _;c(j||[]),a(j||[])}catch(j){console.error("Error fetching users:",j)}finally{t(!1)}},f=async j=>{if(!(!h||x)){r(!0);try{const{data:_,error:N}=await C.rpc("get_or_create_direct_chat",{other_user_id:j});if(N)throw N;l(_),s()}catch(_){console.error("Error creating direct chat:",_),alert("Failed to start chat. Please try again.")}finally{r(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-dark-brown/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col border-2 border-white/50",children:[e.jsxs("div",{className:"p-6 border-b-2 border-white/40 bg-gradient-to-r from-primary/10 to-sage/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-2xl flex items-center justify-center text-white shadow-lg",children:e.jsx(ze,{className:"w-6 h-6",strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-heading font-bold text-primary",children:"New Chat"}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium",children:"Start a conversation"})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/60 rounded-xl transition-all hover:scale-110 active:scale-95",children:e.jsx(re,{className:"w-5 h-5 text-dark-brown/60"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:o,onChange:j=>u(j.target.value),className:"w-full pl-11 pr-4 py-3 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-sm font-medium placeholder:text-dark-brown/40",autoFocus:!0})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:m?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):n.length>0?e.jsx("div",{className:"space-y-2",children:n.map(j=>e.jsx("button",{onClick:()=>f(j.id),disabled:x,className:"w-full p-4 rounded-2xl bg-white/60 border-2 border-white/60 hover:border-primary/30 hover:shadow-lg transition-all text-left group disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-lg shadow-lg",children:(j.name||j.email)?.[0]?.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-primary text-base truncate",children:j.name||j.email?.split("@")[0]||"User"}),j.role==="admin"&&e.jsx(Mt,{className:"w-4 h-4 text-amber-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:j.email})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ze,{className:"w-5 h-5 text-primary",strokeWidth:2})})]})},j.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(ve,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center",children:o?"No users found":"No users available"})]})})]})})}function Nl({onClose:s,onGroupCreated:l}){const{user:h}=H(),[b,c]=i.useState([]),[n,a]=i.useState([]),[o,u]=i.useState(""),[m,t]=i.useState(new Set),[x,r]=i.useState(""),[v,f]=i.useState(!0),[j,_]=i.useState(!1);i.useEffect(()=>{N()},[h]),i.useEffect(()=>{a(o?b.filter(d=>d.name?.toLowerCase().includes(o.toLowerCase())||d.email?.toLowerCase().includes(o.toLowerCase())):b)},[o,b]);const N=async()=>{try{const{data:d,error:k}=await C.from("users").select("id, name, email, role").eq("approval_status","approved").neq("id",h?.id||"").order("name",{ascending:!0});if(k)throw k;c(d||[]),a(d||[])}catch(d){console.error("Error fetching users:",d)}finally{f(!1)}},w=d=>{const k=new Set(m);k.has(d)?k.delete(d):k.add(d),t(k)},y=async()=>{if(!(!h||j||!x.trim()||m.size===0)){_(!0);try{const{data:d,error:k}=await C.from("chat_rooms").insert([{name:x.trim(),type:"group",is_direct:!1,created_by:h.id,icon:"ðŸ‘¥"}]).select().single();if(k)throw k;const g=[{room_id:d.id,user_id:h.id,role:"admin"},...Array.from(m).map(E=>({room_id:d.id,user_id:E,role:"member"}))],{error:M}=await C.from("chat_room_members").insert(g);if(M)throw M;l(d.id),s()}catch(d){console.error("Error creating group:",d),alert("Failed to create group. Please try again.")}finally{_(!1)}}},p=x.trim().length>0&&m.size>0;return e.jsx("div",{className:"fixed inset-0 bg-dark-brown/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-lg max-h-[85vh] flex flex-col border-2 border-white/50",children:[e.jsxs("div",{className:"p-6 border-b-2 border-white/40 bg-gradient-to-r from-primary/10 to-sage/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-2xl flex items-center justify-center text-white shadow-lg",children:e.jsx(je,{className:"w-6 h-6",strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-heading font-bold text-primary",children:"Create Group"}),e.jsxs("p",{className:"text-sm text-dark-brown/60 font-medium",children:[m.size," member",m.size!==1?"s":""," selected"]})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/60 rounded-xl transition-all hover:scale-110 active:scale-95",children:e.jsx(re,{className:"w-5 h-5 text-dark-brown/60"})})]}),e.jsx("input",{type:"text",placeholder:"Group name...",value:x,onChange:d=>r(d.target.value),className:"w-full px-4 py-3 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-base font-semibold placeholder:text-dark-brown/40 mb-3",maxLength:50}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search members...",value:o,onChange:d=>u(d.target.value),className:"w-full pl-11 pr-4 py-3 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-sm font-medium placeholder:text-dark-brown/40"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):n.length>0?e.jsx("div",{className:"space-y-2",children:n.map(d=>{const k=m.has(d.id);return e.jsx("button",{onClick:()=>w(d.id),className:`w-full p-4 rounded-2xl border-2 transition-all text-left ${k?"bg-gradient-to-br from-primary/20 to-sage/10 border-primary/40 shadow-lg":"bg-white/60 border-white/60 hover:border-primary/20 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-lg shadow-lg",children:(d.name||d.email)?.[0]?.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-primary text-base truncate",children:d.name||d.email?.split("@")[0]||"User"}),d.role==="admin"&&e.jsx(Mt,{className:"w-4 h-4 text-amber-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:d.email})]}),e.jsx("div",{className:`w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all ${k?"bg-primary border-primary":"border-dark-brown/30"}`,children:k&&e.jsx(qt,{className:"w-4 h-4 text-white",strokeWidth:3})})]})},d.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(ve,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center",children:o?"No users found":"No users available"})]})}),e.jsx("div",{className:"p-6 border-t-2 border-white/40 bg-gradient-to-r from-white/60 to-cream/40",children:e.jsx("button",{onClick:y,disabled:!p||j,className:"w-full py-3 bg-gradient-to-br from-primary via-sage to-secondary text-white rounded-2xl font-bold text-base hover:shadow-2xl transition-all disabled:opacity-40 disabled:cursor-not-allowed hover:scale-105 active:scale-95",children:j?"Creating...":"Create Group"})})]})})}function vl(){const{user:s}=H(),[l,h]=i.useState(null),[b,c]=i.useState([]);i.useState(!1);const[n,a]=i.useState(!1),[o,u]=i.useState(!1),m=async r=>{h(r),await t(r.room_id)},t=async r=>{try{const{data:v,error:f}=await C.from("chat_room_members").select(`
          user_id,
          role,
          joined_at
        `).eq("room_id",r);if(f)throw f;const j=await Promise.all((v||[]).map(async _=>{const{data:N}=await C.from("users").select("id, name, email, role").eq("id",_.user_id).maybeSingle();return{..._,...N}}));c(j)}catch(v){console.error("Error fetching room members:",v)}},x=async r=>{const{data:v,error:f}=await C.from("chat_user_rooms").select("*").eq("room_id",r).eq("user_id",s?.id||"").maybeSingle();v&&!f&&await m(v)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 h-screen flex p-6 gap-4",children:[e.jsxs("div",{className:"w-96 glass-card rounded-3xl border-2 border-white/50 shadow-2xl flex flex-col overflow-hidden backdrop-blur-xl",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary via-sage to-secondary p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"}),e.jsx("div",{className:"absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border-2 border-white/30 shadow-xl",children:e.jsx(ze,{className:"w-6 h-6 text-white",strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-white drop-shadow-lg",children:"Messages"}),e.jsx("p",{className:"text-xs text-white/90 font-medium",children:"Your conversations"})]})]})})]}),e.jsx(yl,{onSelectRoom:m,selectedRoomId:l?.room_id||null,onNewChat:()=>a(!0),onNewGroup:()=>u(!0)})]}),e.jsx("div",{className:"flex-1 flex flex-col glass-card rounded-3xl border-2 border-white/50 shadow-2xl overflow-hidden backdrop-blur-xl",children:l?e.jsx(jl,{room:{id:l.room_id,name:l.display_name,icon:l.display_icon,description:l.description,type:l.type,is_direct:l.is_direct},teamMembers:b}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gradient-to-br from-white/50 to-cream/30",children:e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"w-32 h-32 bg-gradient-to-br from-primary/20 to-sage/10 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl",children:e.jsx(ze,{className:"w-16 h-16 text-primary",strokeWidth:1.5})}),e.jsx("h3",{className:"font-heading text-4xl font-bold text-primary mb-4",children:"Select a conversation"}),e.jsx("p",{className:"text-dark-brown/60 text-lg font-medium max-w-md mb-6",children:"Choose a conversation from the list or start a new chat with your team."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>a(!0),className:"px-6 py-3 bg-gradient-to-br from-primary to-sage text-white rounded-xl font-bold hover:shadow-2xl transition-all hover:scale-105 active:scale-95",children:"New Chat"}),e.jsx("button",{onClick:()=>u(!0),className:"px-6 py-3 bg-white border-2 border-primary/20 text-primary rounded-xl font-bold hover:shadow-xl transition-all hover:scale-105 active:scale-95",children:"New Group"})]})]})})})]}),n&&e.jsx(wl,{onClose:()=>a(!1),onChatCreated:x}),o&&e.jsx(Nl,{onClose:()=>u(!1),onGroupCreated:x})]})}function kl(){const s=ce(),{user:l}=H(),[h,b]=i.useState("profile"),[c,n]=i.useState({name:l?.name||"",email:l?.email||"",phone:l?.phone||""}),[a,o]=i.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[u,m]=i.useState(null),[t,x]=i.useState(null),[r,v]=i.useState(!1),[f,j]=i.useState(!1),_=async w=>{w.preventDefault(),v(!0),m(null);try{const y=localStorage.getItem("users"),p=y?JSON.parse(y):[],d=p.findIndex(k=>k.id===l?.id);if(d!==-1){p[d]={...p[d],name:c.name,email:c.email,phone:c.phone},localStorage.setItem("users",JSON.stringify(p));const k={id:p[d].id,name:p[d].name,email:p[d].email,phone:p[d].phone,role:p[d].role};localStorage.setItem("currentUser",JSON.stringify(k)),m({type:"success",text:"Profile updated successfully"}),setTimeout(()=>{window.location.reload()},1500)}}catch{m({type:"error",text:"Failed to update profile"})}finally{v(!1)}},N=async w=>{if(w.preventDefault(),j(!0),x(null),a.newPassword.length<8){x({type:"error",text:"New password must be at least 8 characters long"}),j(!1);return}if(a.newPassword!==a.confirmPassword){x({type:"error",text:"New passwords do not match"}),j(!1);return}try{const y=localStorage.getItem("users"),p=y?JSON.parse(y):[],d=p.findIndex(k=>k.id===l?.id&&k.password===a.currentPassword);d!==-1?(p[d].password=a.newPassword,localStorage.setItem("users",JSON.stringify(p)),x({type:"success",text:"Password changed successfully"}),o({currentPassword:"",newPassword:"",confirmPassword:""})):x({type:"error",text:"Current password is incorrect"})}catch{x({type:"error",text:"Failed to change password"})}finally{j(!1)}};return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Settings"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your account settings and preferences"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-primary/10",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>b("profile"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${h==="profile"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile"})]})}),e.jsx("button",{onClick:()=>b("security"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${h==="security"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsx("span",{children:"Security"})]})})]})}),e.jsxs("div",{className:"p-6 md:p-8",children:[h==="profile"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-6 p-4 bg-cream/50 rounded-xl border border-primary/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-full flex items-center justify-center",children:e.jsx(Oe,{className:"w-6 h-6 text-cream"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:l?.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:l?.email})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-accent/20 rounded-full",children:[e.jsx(ut,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:l?.role})]})]})}),u&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${u.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[u.type==="success"?e.jsx(Y,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${u.type==="success"?"text-sage":"text-soft-red"}`,children:u.text})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"name",type:"text",value:c.name,onChange:w=>n({...c,name:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:r})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"email",type:"email",value:c.email,onChange:w=>n({...c,email:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:r})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"phone",type:"tel",value:c.phone,onChange:w=>n({...c,phone:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",disabled:r})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:r,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(Qs,{className:"w-5 h-5"}),r?"Saving...":"Save Changes"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]}),h==="security"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"Change Password"}),e.jsx("p",{className:"text-dark-brown/70",children:"Update your password to keep your account secure"})]}),t&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${t.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[t.type==="success"?e.jsx(Y,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${t.type==="success"?"text-sage":"text-soft-red"}`,children:t.text})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"currentPassword",type:"password",value:a.currentPassword,onChange:w=>o({...a,currentPassword:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:f})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"newPassword",type:"password",value:a.newPassword,onChange:w=>o({...a,newPassword:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:f,minLength:8})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"confirmPassword",type:"password",value:a.confirmPassword,onChange:w=>o({...a,confirmPassword:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:f})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:f,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(Te,{className:"w-5 h-5"}),f?"Changing...":"Change Password"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]})]})]})]})})})}function _l(){const{user:s}=H(),[l,h]=i.useState([]),[b,c]=i.useState(!0),[n,a]=i.useState("all");i.useEffect(()=>{o()},[s?.id]);const o=async()=>{if(s?.id)try{const{data:f,error:j}=await C.from("notifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(j)throw j;h(f||[])}catch(f){console.error("Error fetching notifications:",f)}finally{c(!1)}},u=async f=>{try{const{error:j}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",f);if(j)throw j;h(_=>_.map(N=>N.id===f?{...N,is_read:!0,read_at:new Date().toISOString()}:N))}catch(j){console.error("Error marking notification as read:",j)}},m=async()=>{try{const f=l.filter(_=>!_.is_read).map(_=>_.id),{error:j}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).in("id",f);if(j)throw j;h(_=>_.map(N=>({...N,is_read:!0,read_at:N.read_at||new Date().toISOString()})))}catch(f){console.error("Error marking all as read:",f)}},t=async f=>{try{const{error:j}=await C.from("notifications").delete().eq("id",f);if(j)throw j;h(_=>_.filter(N=>N.id!==f))}catch(j){console.error("Error deleting notification:",j)}},x=n==="unread"?l.filter(f=>!f.is_read):l,r=l.filter(f=>!f.is_read).length,v=f=>{switch(f){case"expense":return"text-blue-600 bg-blue-50";case"batch":return"text-green-600 bg-green-50";case"license":return"text-orange-600 bg-orange-50";case"vendor":return"text-purple-600 bg-purple-50";case"product":return"text-pink-600 bg-pink-50";default:return"text-gray-600 bg-gray-50"}};return b?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsx("div",{className:"min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-primary mb-2",children:"Notifications"}),e.jsx("p",{className:"text-gray-600",children:r>0?`You have ${r} unread notification${r>1?"s":""}`:"All caught up!"})]}),r>0&&e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary-dark transition-colors",children:[e.jsx(Pa,{className:"w-4 h-4"}),"Mark All Read"]})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>a("all"),className:`px-4 py-2 rounded-button font-semibold transition-all ${n==="all"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["All (",l.length,")"]}),e.jsxs("button",{onClick:()=>a("unread"),className:`px-4 py-2 rounded-button font-semibold transition-all ${n==="unread"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["Unread (",r,")"]})]})]}),x.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(Ke,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:n==="unread"?"No unread notifications":"No notifications yet"}),e.jsx("p",{className:"text-gray-500",children:n==="unread"?"All notifications have been read":"You'll see notifications here when there's activity"})]}):e.jsx("div",{className:"space-y-3",children:x.map(f=>e.jsx("div",{className:`glass-card p-4 transition-all hover:shadow-lg ${f.is_read?"":"border-l-4 border-gold"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${v(f.type)}`,children:e.jsx(Ke,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsx("h3",{className:"font-semibold text-primary",children:f.title}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:ts(new Date(f.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:f.message}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${v(f.type)}`,children:f.type}),!f.is_read&&e.jsxs("button",{onClick:()=>u(f.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-primary hover:bg-primary/5 rounded-button transition-colors",children:[e.jsx(qt,{className:"w-3 h-3"}),"Mark as read"]}),e.jsxs("button",{onClick:()=>t(f.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-red-600 hover:bg-red-50 rounded-button transition-colors ml-auto",children:[e.jsx(oe,{className:"w-3 h-3"}),"Delete"]})]})]})]})},f.id))})]})})}function Cl(){const{user:s}=H(),[l,h]=i.useState("pending"),[b,c]=i.useState([]),[n,a]=i.useState([]),[o,u]=i.useState([]),[m,t]=i.useState(!0),[x,r]=i.useState(""),[v,f]=i.useState(null),[j,_]=i.useState(!1),[N,w]=i.useState(null),[y,p]=i.useState("");i.useEffect(()=>{d()},[]);const d=async()=>{t(!0);try{const{data:I}=await C.from("users").select("*").eq("approval_status","pending").order("created_at",{ascending:!1}),{data:q}=await C.from("users").select("*").eq("approval_status","approved").order("approved_at",{ascending:!1}),{data:B}=await C.from("users").select("*").eq("approval_status","rejected").order("created_at",{ascending:!1});if(q&&q.length>0){const G=q.map(S=>S.approved_by).filter(S=>S!==null),{data:se}=await C.from("users").select("id, name").in("id",G),ee=new Map(se?.map(S=>[S.id,S.name])||[]);a(q.map(S=>({...S,approver_name:S.approved_by&&ee.get(S.approved_by)||"Self-registered"})))}else a([]);c(I||[]),u(B||[])}catch(I){console.error("Error fetching users:",I)}finally{t(!1)}},k=async I=>{f(I);try{const{error:q}=await C.from("users").update({approval_status:"approved",approved_by:s?.id,approved_at:new Date().toISOString()}).eq("id",I);if(q)throw q;await C.from("notifications").insert({user_id:I,type:"account_approved",title:"Account Approved",message:"Your Organitto account has been approved! You can now login.",read:!1}),await d()}catch(q){console.error("Error approving user:",q),alert("Failed to approve user")}finally{f(null)}},g=I=>{w(I),_(!0),p("")},M=async()=>{if(!N||!y.trim()){alert("Please provide a reason for rejection");return}f(N.id);try{const{error:I}=await C.from("users").update({approval_status:"rejected",rejection_reason:y}).eq("id",N.id);if(I)throw I;await C.from("notifications").insert({user_id:N.id,type:"account_rejected",title:"Registration Not Approved",message:`Your registration was not approved. Reason: ${y}`,read:!1}),_(!1),w(null),p(""),await d()}catch(I){console.error("Error rejecting user:",I),alert("Failed to reject user")}finally{f(null)}},E=I=>{if(!x.trim())return I;const q=x.toLowerCase();return I.filter(B=>B.name.toLowerCase().includes(q)||B.email.toLowerCase().includes(q))},D=I=>new Date(I).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});return m?e.jsx("div",{className:"min-h-screen bg-gradient-mesh",children:e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-mesh",children:[e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx(je,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"User Approval Management"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Review and manage user registrations"})]})]})}),e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>h("pending"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${l==="pending"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(de,{className:"w-4 h-4 inline mr-2"}),"Pending (",b.length,")"]}),e.jsxs("button",{onClick:()=>h("approved"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${l==="approved"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(Y,{className:"w-4 h-4 inline mr-2"}),"Approved (",n.length,")"]}),e.jsxs("button",{onClick:()=>h("rejected"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${l==="rejected"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-2"}),"Rejected (",o.length,")"]})]}),e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:x,onChange:I=>r(I.target.value),className:"input-float w-full pl-12"})]})]}),l==="pending"&&e.jsx("div",{className:"space-y-4",children:E(b).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No pending approvals"})]}):E(b).map(I=>e.jsx("div",{className:"glass-card p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:I.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:I.name}),e.jsx("p",{className:"text-sm text-primary/60",children:I.role.charAt(0).toUpperCase()+I.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",I.email]}),I.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",I.phone]}),e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Registered:"})," ",D(I.created_at)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ue,{onClick:()=>k(I.id),disabled:v===I.id,variant:"primary",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>g(I),disabled:v===I.id,className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Reject"]})]})]})},I.id))}),l==="approved"&&e.jsx("div",{className:"space-y-4",children:E(n).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No approved users"})]}):E(n).map(I=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:I.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:I.name}),e.jsx("p",{className:"text-sm text-primary/60",children:I.role.charAt(0).toUpperCase()+I.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",I.email]}),I.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",I.phone]}),e.jsxs("p",{className:"text-sm text-green-600 font-semibold",children:["Approved by ",I.approver_name," on ",I.approved_at?D(I.approved_at):"N/A"]})]})]},I.id))}),l==="rejected"&&e.jsx("div",{className:"space-y-4",children:E(o).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No rejected users"})]}):E(o).map(I=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:I.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:I.name}),e.jsx("p",{className:"text-sm text-primary/60",children:I.role.charAt(0).toUpperCase()+I.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",I.email]}),I.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",I.phone]}),I.rejection_reason&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50/50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-sm font-semibold text-red-800 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700",children:I.rejection_reason})]})]})]},I.id))})]})]}),j&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"glass-card p-8 max-w-md w-full animate-scale-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary mb-4",children:"Reject Registration"}),e.jsxs("p",{className:"text-primary/70 mb-6",children:["Are you sure you want to reject ",e.jsx("span",{className:"font-bold",children:N.name}),"'s registration?"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-primary mb-3",children:"Rejection Reason (Required)"}),e.jsx("textarea",{value:y,onChange:I=>p(I.target.value),className:"input-float w-full h-32 resize-none",placeholder:"Explain why this registration is being rejected...",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{_(!1),w(null),p("")},className:"flex-1 px-6 py-3 glass-card text-primary font-bold rounded-button hover:shadow-md",children:"Cancel"}),e.jsx("button",{onClick:M,disabled:!y.trim()||v===N.id,className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50",children:"Confirm Reject"})]})]})})]})}function Sl(){const s=es(),{user:l}=H(),b=["/","/login","/register"].includes(s.pathname),c=l&&!b;return e.jsxs(e.Fragment,{children:[!b&&e.jsx(Se,{}),e.jsxs(ma,{children:[e.jsx(K,{path:"/",element:e.jsx(br,{})}),e.jsx(K,{path:"/login",element:e.jsx(ur,{})}),e.jsx(K,{path:"/register",element:e.jsx(fr,{})}),e.jsxs(K,{element:e.jsx(ws,{children:e.jsx(Ns,{})}),children:[e.jsx(K,{path:"/dashboard",element:e.jsx(yr,{})}),e.jsx(K,{path:"/finance",element:e.jsx(wr,{})}),e.jsx(K,{path:"/expenses/add",element:e.jsx(vr,{})}),e.jsx(K,{path:"/expenses/edit/:id",element:e.jsx(_r,{})}),e.jsx(K,{path:"/expenses",element:e.jsx(Dr,{})}),e.jsx(K,{path:"/expenses/reports",element:e.jsx(Tr,{})}),e.jsx(K,{path:"/investments",element:e.jsx(Ur,{})}),e.jsx(K,{path:"/products",element:e.jsx(Yr,{})}),e.jsx(K,{path:"/products/:id",element:e.jsx(cn,{})}),e.jsx(K,{path:"/calculator",element:e.jsx(xn,{})}),e.jsx(K,{path:"/vendors",element:e.jsx(bn,{})}),e.jsx(K,{path:"/vendors/:id",element:e.jsx(qn,{})}),e.jsx(K,{path:"/batches",element:e.jsx(Rn,{})}),e.jsx(K,{path:"/batches/:id",element:e.jsx(Qn,{})}),e.jsx(K,{path:"/ingredients",element:e.jsx(Kn,{})}),e.jsx(K,{path:"/ingredients/:id",element:e.jsx(al,{})}),e.jsx(K,{path:"/compliance",element:e.jsx(ll,{})}),e.jsx(K,{path:"/compliance/:id",element:e.jsx(pl,{})}),e.jsx(K,{path:"/chat",element:e.jsx(vl,{})}),e.jsx(K,{path:"/settings",element:e.jsx(kl,{})}),e.jsx(K,{path:"/notifications",element:e.jsx(_l,{})})]}),e.jsx(K,{path:"/admin/user-approvals",element:e.jsx(ws,{adminOnly:!0,children:e.jsx(Ns,{})}),children:e.jsx(K,{index:!0,element:e.jsx(Cl,{})})}),e.jsx(K,{path:"*",element:e.jsx(Zt,{to:"/",replace:!0})})]}),c&&e.jsx(pr,{})]})}function Dl(){return e.jsx(xa,{children:e.jsxs(_a,{children:[e.jsx(xr,{}),e.jsx(cr,{}),e.jsx(mr,{}),e.jsx(Sl,{})]})})}Ls(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(Dl,{})}));
