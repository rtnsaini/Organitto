import{r as o,b as da,N as Jt,u as de,d as es,O as ca,L as Ne,e as Je,B as xa,f as ma,h as K}from"./react-vendor-B1UGq2v7.js";import{c as ha}from"./supabase-vendor-DKRvmUUb.js";import{f as ts,a as q,s as ct,b as us,e as fs,c as pa,i as Zt,d as X,g as Ps,h as As,j as Is}from"./date-vendor-Y3GY3t4o.js";import{R as be,L as Et,C as Fe,X as Te,Y as Le,T as je,a as ft,b as $e,P as Pt,c as At,d as It,e as ba,A as ua,B as Ft,f as xt}from"./chart-vendor-DZhzrXBW.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))u(l);new MutationObserver(l=>{for(const m of l)if(m.type==="childList")for(const p of m.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&u(p)}).observe(document,{childList:!0,subtree:!0});function c(l){const m={};return l.integrity&&(m.integrity=l.integrity),l.referrerPolicy&&(m.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?m.credentials="include":l.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function u(l){if(l.ep)return;l.ep=!0;const m=c(l);fetch(l.href,m)}})();var Fs={exports:{}},Tt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fa=o,ga=Symbol.for("react.element"),ja=Symbol.for("react.fragment"),ya=Object.prototype.hasOwnProperty,wa=fa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Na={key:!0,ref:!0,__self:!0,__source:!0};function Ts(s,n,c){var u,l={},m=null,p=null;c!==void 0&&(m=""+c),n.key!==void 0&&(m=""+n.key),n.ref!==void 0&&(p=n.ref);for(u in n)ya.call(n,u)&&!Na.hasOwnProperty(u)&&(l[u]=n[u]);if(s&&s.defaultProps)for(u in n=s.defaultProps,n)l[u]===void 0&&(l[u]=n[u]);return{$$typeof:ga,type:s,key:m,ref:p,props:l,_owner:wa.current}}Tt.Fragment=ja;Tt.jsx=Ts;Tt.jsxs=Ts;Fs.exports=Tt;var e=Fs.exports,Ls,gs=da;Ls=gs.createRoot,gs.hydrateRoot;const va="https://zvrkldiptatwsnflmvbp.supabase.co",ka="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2cmtsZGlwdGF0d3NuZmxtdmJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTU4MDMsImV4cCI6MjA4MTI3MTgwM30.cPJdSpxdkQxD6TfgJ4qsnNRTJWPwQvjTlhZPVcHR17A",C=ha(va,ka),$s=o.createContext(void 0);function _a({children:s}){const[n,c]=o.useState(null),[u,l]=o.useState(null),[m,p]=o.useState(!0);o.useEffect(()=>{C.auth.getSession().then(({data:{session:k}})=>{l(k),k?.user?x(k.user.id):p(!1)});const{data:{subscription:a}}=C.auth.onAuthStateChange((k,N)=>{l(N),N?.user?x(N.user.id):(c(null),p(!1))});return()=>a.unsubscribe()},[]);const x=async a=>{try{const{data:k,error:N}=await C.from("users").select("*").eq("id",a).maybeSingle();if(N)throw N;if(k){if(k.approval_status!=="approved"){await C.auth.signOut(),c(null),l(null),p(!1);return}c(k)}}catch(k){console.error("Error loading user profile:",k)}finally{p(!1)}},i={session:u,user:n,loading:m,signIn:async(a,k)=>{if(!a||!k)return{error:new Error("Please enter email and password")};try{const{data:N,error:j}=await C.auth.signInWithPassword({email:a,password:k});if(j)throw j;if(N.user){const{data:_,error:w}=await C.from("users").select("approval_status, rejection_reason").eq("id",N.user.id).maybeSingle();if(w)throw w;if(_?.approval_status==="pending")return await C.auth.signOut(),{error:new Error("Your account is pending approval. Please wait for admin to approve your registration.")};if(_?.approval_status==="rejected"){await C.auth.signOut();const y=_.rejection_reason?`
Reason: ${_.rejection_reason}`:"";return{error:new Error(`Your registration was not approved.${y}

Please contact admin for more information.`)}}await x(N.user.id)}return{error:null}}catch(N){return{error:new Error(N.message||"Invalid login credentials")}}},signUp:async(a,k,N,j,_="partner")=>{if(!a||!k||!N)return{error:new Error("Please fill all required fields")};try{const{data:w,error:y}=await C.auth.signUp({email:a,password:k});if(y)throw y;if(!w.user)throw new Error("Failed to create user");const h=_==="admin"?"approved":"pending",d=_==="admin"?new Date().toISOString():null,{error:r}=await C.from("users").insert({id:w.user.id,email:a,name:N,phone:j||null,role:_,approval_status:h,approved_at:d});if(r)throw r;return _==="admin"?await x(w.user.id):await C.auth.signOut(),{error:null}}catch(w){return{error:new Error(w.message||"Failed to create account")}}},signOut:async()=>{await C.auth.signOut(),c(null),l(null)}};return e.jsx($s.Provider,{value:i,children:s})}function H(){const s=o.useContext($s);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ca={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),I=(s,n)=>{const c=o.forwardRef(({color:u="currentColor",size:l=24,strokeWidth:m=2,absoluteStrokeWidth:p,className:x="",children:b,...f},t)=>o.createElement("svg",{ref:t,...Ca,width:l,height:l,stroke:u,strokeWidth:p?Number(m)*24/Number(l):m,className:["lucide",`lucide-${Sa(s)}`,x].join(" "),...f},[...n.map(([i,a])=>o.createElement(i,a)),...Array.isArray(b)?b:[b]]));return c.displayName=`${s}`,c};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=I("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=I("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=I("AlertOctagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=I("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=I("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=I("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=I("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=I("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=I("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=I("Beaker",[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=I("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=I("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=I("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=I("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=I("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=I("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=I("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=I("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=I("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=I("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=I("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=I("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=I("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=I("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=I("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=I("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=I("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=I("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=I("FileSearch",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"1vg67v"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=I("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=I("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=I("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=I("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=I("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=I("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=I("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=I("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=I("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=I("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=I("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=I("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=I("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=I("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=I("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=I("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=I("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=I("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=I("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=I("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=I("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=I("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=I("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=I("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=I("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=I("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=I("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=I("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=I("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=I("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=I("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=I("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=I("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=I("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=I("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=I("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=I("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=I("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=I("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=I("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=I("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=I("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=I("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=I("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=I("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=I("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=I("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=I("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=I("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=I("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=I("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=I("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=I("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=I("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=I("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=I("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=I("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=I("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=I("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=I("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=I("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=I("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=I("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=I("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=I("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=I("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function ws({children:s,adminOnly:n=!1}){const{user:c,loading:u}=H();return u?e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ls,{className:"w-12 h-12 text-primary animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading..."})]})}):c?c.approval_status!=="approved"?e.jsx(Jt,{to:"/login",replace:!0}):n&&c.role!=="admin"?e.jsx("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card p-10 text-center max-w-md",children:[e.jsx(Qa,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-primary mb-3",children:"Access Denied"}),e.jsx("p",{className:"text-primary/70 mb-6",children:"You don't have permission to access this page. This area is restricted to administrators only."}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-6 py-3 bg-gradient-primary text-white font-bold rounded-button hover:shadow-lg",children:"Go Back"})]})}):e.jsx(e.Fragment,{children:s}):e.jsx(Jt,{to:"/login",replace:!0})}function nr({onMenuClick:s}){const{user:n,signOut:c}=H(),u=de(),[l,m]=o.useState(!1),[p,x]=o.useState(!1),[b,f]=o.useState([]),[t,i]=o.useState(0),[a,k]=o.useState(""),[N]=o.useState(3),j=b.filter(d=>!d.is_read).length;o.useEffect(()=>{if(n?.id){_(),n.role==="admin"&&w();const d=C.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${n.id}`},()=>{_()}).subscribe();return()=>{C.removeChannel(d)}}},[n?.id,n?.role]);const _=async()=>{if(n?.id)try{const{data:d,error:r}=await C.from("notifications").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}).limit(5);if(r)throw r;f(d||[])}catch(d){console.error("Error fetching notifications:",d)}},w=async()=>{try{const{count:d,error:r}=await C.from("users").select("*",{count:"exact",head:!0}).eq("approval_status","pending");if(r)throw r;i(d||0)}catch(d){console.error("Error fetching pending users count:",d)}},y=async()=>{await c(),u("/")},h=d=>{d.key==="Enter"&&a.trim()&&console.log("Search for:",a)};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("button",{className:"mobile-menu-btn",onClick:s,children:e.jsx(Ua,{size:20})}),e.jsxs("div",{className:"logo desktop-only",children:[e.jsx("span",{className:"logo-icon",children:"ðŸŒ¿"}),e.jsx("span",{className:"logo-text",children:"Organitto"})]}),e.jsxs("div",{className:"search-bar desktop-only",children:[e.jsx(ve,{size:18,strokeWidth:2}),e.jsx("input",{type:"text",placeholder:"Search products, expenses, vendors...",className:"search-input",value:a,onChange:d=>k(d.target.value),onKeyDown:h}),e.jsx("kbd",{className:"search-kbd",children:"âŒ˜K"})]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("button",{className:"header-icon-btn",onClick:()=>u("/chat"),title:"Chat",children:[e.jsx(Ue,{size:18}),N>0&&e.jsx("span",{className:"header-badge",children:N})]}),e.jsxs("div",{className:"header-dropdown-container",children:[e.jsxs("button",{className:"header-icon-btn",onClick:()=>m(!l),title:"Notifications",children:[e.jsx(Ke,{size:18}),j>0&&e.jsx("span",{className:"header-badge",children:j})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-dropdown-overlay",onClick:()=>m(!1)}),e.jsxs("div",{className:"header-dropdown notifications-dropdown",children:[e.jsxs("div",{className:"dropdown-header",children:[e.jsx("h3",{children:"Notifications"}),j>0&&e.jsxs("span",{className:"dropdown-badge",children:[j," new"]})]}),e.jsx("div",{className:"dropdown-body",children:b.length>0?b.map(d=>e.jsxs("div",{className:`notification-item ${d.is_read?"":"unread"}`,children:[e.jsx("div",{className:`notification-dot ${d.is_read?"":"active"}`}),e.jsxs("div",{className:"notification-content",children:[e.jsx("p",{className:"notification-title",children:d.title}),e.jsx("p",{className:"notification-message",children:d.message}),e.jsx("p",{className:"notification-time",children:ts(new Date(d.created_at),{addSuffix:!0})})]})]},d.id)):e.jsxs("div",{className:"dropdown-empty",children:[e.jsx(Ke,{size:32}),e.jsx("p",{children:"No notifications"})]})}),e.jsx("div",{className:"dropdown-footer",children:e.jsx("button",{onClick:()=>{m(!1),u("/notifications")},children:"View All Notifications"})})]})]})]}),e.jsxs("div",{className:"header-dropdown-container",children:[e.jsxs("button",{className:"user-menu",onClick:()=>x(!p),children:[e.jsx("div",{className:"user-avatar",children:n?.name?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{className:"user-name desktop-only",children:n?.name}),e.jsx(Rs,{size:16,className:"desktop-only"})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-dropdown-overlay",onClick:()=>x(!1)}),e.jsxs("div",{className:"header-dropdown user-dropdown",children:[e.jsxs("div",{className:"dropdown-header user-header",children:[e.jsx("div",{className:"user-avatar large",children:n?.name?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-info-name",children:n?.name}),e.jsx("div",{className:"user-info-email",children:n?.email}),n?.role&&e.jsxs("div",{className:"user-info-role",children:[e.jsx(bt,{size:12}),e.jsx("span",{children:n.role})]})]})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("div",{className:"dropdown-body",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>{x(!1),u("/settings")},children:[e.jsx(Oe,{size:18}),e.jsx("span",{children:"Profile"})]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>{x(!1),u("/settings")},children:[e.jsx(Ks,{size:18}),e.jsx("span",{children:"Settings"})]}),n?.role==="admin"&&e.jsxs("button",{className:"dropdown-item",onClick:()=>{x(!1),u("/admin/user-approvals")},children:[e.jsx(bt,{size:18}),e.jsx("span",{children:"User Approvals"}),t>0&&e.jsx("span",{className:"dropdown-badge",children:t})]})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsx("div",{className:"dropdown-body",children:e.jsxs("button",{className:"dropdown-item danger",onClick:y,children:[e.jsx(Hs,{size:18}),e.jsx("span",{children:"Logout"})]})})]})]})]})]})]})}const xe=({icon:s,label:n,path:c,active:u,badge:l,hasDropdown:m,isOpen:p,onClick:x,isSubItem:b})=>{const f=de(),t=()=>{x?x():c&&f(c)};return e.jsxs("button",{className:`nav-item ${u?"active":""} ${b?"sub-item":""}`,onClick:t,children:[s&&e.jsx("span",{className:"nav-icon",children:s}),e.jsx("span",{className:"nav-label",children:n}),l&&l>0&&e.jsx("span",{className:"nav-badge",children:l}),m&&e.jsx(Us,{className:`nav-chevron ${p?"open":""}`})]})};function lr({isOpen:s,onClose:n}){const{user:c,signOut:u}=H(),l=es(),m=de(),[p,x]=o.useState(!1),[b,f]=o.useState(0),t=k=>l.pathname===k,i=()=>l.pathname.startsWith("/expenses")||l.pathname.startsWith("/investments")||l.pathname==="/finance",a=async()=>{await u(),m("/")};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`sidebar ${s?"open":""}`,children:[e.jsxs("div",{className:"sidebar-logo mobile-only",children:[e.jsx("span",{className:"logo-icon",children:"ðŸŒ¿"}),e.jsx("span",{className:"logo-text",children:"Organitto"})]}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:"nav-section",children:[e.jsx(xe,{icon:e.jsx(qa,{size:18}),label:"Dashboard",path:"/dashboard",active:t("/dashboard")}),e.jsx(xe,{icon:e.jsx(er,{size:18}),label:"Finance",hasDropdown:!0,isOpen:p,onClick:()=>x(!p),active:i()}),p&&e.jsxs("div",{className:"nav-dropdown",children:[e.jsx(xe,{label:"Add Expense",path:"/expenses/add",isSubItem:!0,active:t("/expenses/add")}),e.jsx(xe,{label:"Expense List",path:"/expenses",isSubItem:!0,active:t("/expenses")}),e.jsx(xe,{label:"Reports",path:"/expenses/reports",isSubItem:!0,active:t("/expenses/reports")}),e.jsx(xe,{label:"Investments",path:"/investments",isSubItem:!0,active:t("/investments")})]}),e.jsx(xe,{icon:e.jsx(Ta,{size:18}),label:"Products",path:"/products",active:t("/products")}),e.jsx(xe,{icon:e.jsx(qs,{size:18}),label:"Cost Calculator",path:"/calculator",active:t("/calculator")}),e.jsx(xe,{icon:e.jsx(ge,{size:18}),label:"Vendors",path:"/vendors",active:t("/vendors")}),e.jsx(xe,{icon:e.jsx(ne,{size:18}),label:"Batches",path:"/batches",active:t("/batches")}),e.jsx(xe,{icon:e.jsx(He,{size:18}),label:"Ingredients",path:"/ingredients",active:t("/ingredients")}),e.jsx(xe,{icon:e.jsx(Ya,{size:18}),label:"Compliance",path:"/compliance",active:t("/compliance")}),e.jsx(xe,{icon:e.jsx(Ue,{size:18}),label:"Team Chat",path:"/chat",active:t("/chat")}),c?.role==="admin"&&e.jsx(xe,{icon:e.jsx(Xa,{size:18}),label:"User Approvals",path:"/admin/user-approvals",active:t("/admin/user-approvals"),badge:b})]}),e.jsxs("div",{className:"nav-section nav-section-bottom",children:[e.jsx(xe,{icon:e.jsx(Ks,{size:18}),label:"Settings",path:"/settings",active:t("/settings")}),e.jsx(xe,{icon:e.jsx(Hs,{size:18}),label:"Logout",onClick:a})]})]})]}),s&&e.jsx("div",{className:"sidebar-overlay",onClick:n})]})}function Ns(){const[s,n]=o.useState(!1),c=es(),u=()=>{n(!s)},l=()=>{n(!1)};return o.useEffect(()=>{window.innerWidth<768&&l()},[c.pathname]),o.useEffect(()=>{const m=()=>{window.innerWidth>=768&&n(!1)};return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]),o.useEffect(()=>{const m=p=>{p.key==="Escape"&&s&&l()};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[s]),e.jsxs("div",{className:"app-layout",children:[e.jsx(nr,{onMenuClick:u}),e.jsxs("div",{className:"app-body",children:[e.jsx(lr,{isOpen:s,onClose:l}),e.jsx("main",{className:"main-content",children:e.jsx(ca,{})})]})]})}function or(){const[s,n]=o.useState(!1),[c,u]=o.useState(!1),[l,m]=o.useState(null);return o.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&u(!0);const x=f=>{f.preventDefault(),m(f),n(!0)},b=()=>{u(!0),n(!1),m(null)};return window.addEventListener("beforeinstallprompt",x),window.addEventListener("appinstalled",b),()=>{window.removeEventListener("beforeinstallprompt",x),window.removeEventListener("appinstalled",b)}},[]),{isInstallable:s,isInstalled:c,installApp:async()=>{if(!l)return!1;try{await l.prompt();const{outcome:x}=await l.userChoice;return x==="accepted"?(m(null),n(!1),!0):!1}catch(x){return console.error("Error installing app:",x),!1}}}}function ir(){const[s,n]=o.useState(navigator.onLine);return o.useEffect(()=>{const c=()=>n(!0),u=()=>n(!1);return window.addEventListener("online",c),window.addEventListener("offline",u),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",u)}},[]),s}function dr(){const[s,n]=o.useState(!1),[c,u]=o.useState(null);return o.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(m=>{u(m),m.addEventListener("updatefound",()=>{const p=m.installing;p&&p.addEventListener("statechange",()=>{p.state==="installed"&&navigator.serviceWorker.controller&&n(!0)})})})},[]),{isUpdateAvailable:s,updateServiceWorker:()=>{c?.waiting&&(c.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())}}}function cr(){const{isInstallable:s,installApp:n}=or(),[c,u]=o.useState(!1),[l,m]=o.useState(!1);o.useEffect(()=>{localStorage.getItem("pwa-install-dismissed")&&m(!0)},[]),o.useEffect(()=>{if(s&&!l){const b=setTimeout(()=>{u(!0)},3e3);return()=>clearTimeout(b)}},[s,l]);const p=async()=>{await n()&&u(!1)},x=()=>{u(!1),m(!0),localStorage.setItem("pwa-install-dismissed","true")};return!c||!s?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-primary/10 p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:"ðŸŒ¿"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Install Organitto"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"Install our app for quick access, offline support, and a native experience!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:p,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(ke,{className:"w-4 h-4"}),"Install"]}),e.jsx("button",{onClick:x,className:"px-4 py-2.5 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Not Now"})]})]}),e.jsx("button",{onClick:x,className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-dark-brown/40"})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"âš¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Fast"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“±"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Native"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Offline"})]})]})})]})})}function xr(){const s=ir(),[n,c]=o.useState(!1),[u,l]=o.useState(!1);return o.useEffect(()=>{s?n&&s&&(l(!0),setTimeout(()=>{c(!1),l(!1)},3e3)):(c(!0),l(!1))},[s,n]),n?e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${u?"bg-gradient-to-r from-sage to-primary":"bg-gradient-to-r from-accent to-soft-red"}`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-center gap-3 text-white",children:u?e.jsxs(e.Fragment,{children:[e.jsx(sr,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"Back online! Data syncing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(tr,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"You're offline"}),e.jsx("span",{className:"hidden sm:inline text-sm opacity-90",children:"- Changes will sync when you reconnect"})]})})})}):null}function mr(){const{isUpdateAvailable:s,updateServiceWorker:n}=dr(),[c,u]=o.useState(!1);return!s||c?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-accent/20 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(ys,{className:"w-6 h-6 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Update Available"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"A new version of Organitto is ready. Update now to get the latest features!"}),e.jsxs("button",{onClick:n,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(ys,{className:"w-4 h-4"}),"Update Now"]})]}),e.jsx("button",{onClick:()=>u(!0),className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-dark-brown/40"})})]})})})}const hr=[{icon:Mt,label:"Add Expense",path:"/expenses/new",color:"text-orange-500",bgGradient:"from-orange-500/20 to-orange-600/10"},{icon:ne,label:"Add Product",path:"/products",color:"text-emerald-500",bgGradient:"from-emerald-500/20 to-emerald-600/10"},{icon:$a,label:"Add Batch",path:"/batches",color:"text-blue-500",bgGradient:"from-blue-500/20 to-blue-600/10"},{icon:qe,label:"Record Sale",path:"/expenses/new",color:"text-green-500",bgGradient:"from-green-500/20 to-green-600/10"},{icon:ae,label:"Quick Note",path:"/chat",color:"text-purple-500",bgGradient:"from-purple-500/20 to-purple-600/10"}];function pr(){const[s,n]=o.useState(!1),c=de(),u=l=>{n(!1),c(l)};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-dark-brown/40 backdrop-blur-sm",onClick:()=>n(!1)}),e.jsx("div",{className:"relative z-10 flex flex-col-reverse gap-3 mb-5",children:hr.map((l,m)=>{const p=l.icon;return e.jsxs("button",{onClick:()=>u(l.path),className:"group flex items-center justify-end gap-3 animate-scale-in",style:{animationDelay:`${m*50}ms`},children:[e.jsx("div",{className:"glass-card px-5 py-3 font-semibold text-dark-brown whitespace-nowrap shadow-xl border border-cream/20 backdrop-blur-md",children:l.label}),e.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${l.bgGradient} backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-110 cursor-pointer border-2 border-white/30 glass-card`,children:e.jsx(p,{className:`w-8 h-8 ${l.color} drop-shadow-lg`,strokeWidth:2.5})})]},l.label)})})]}),e.jsxs("button",{onClick:()=>n(!s),className:`relative z-10 w-20 h-20 bg-gradient-to-br from-primary via-sage to-secondary rounded-2xl flex items-center justify-center shadow-2xl hover:shadow-[0_0_30px_rgba(139,69,19,0.5)] transition-all duration-300 hover:scale-110 active:scale-95 border-2 border-white/30 ${s?"rotate-45":"rotate-0"}`,"aria-label":s?"Close quick actions":"Open quick actions",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/0 via-white/10 to-white/0 rounded-2xl"}),s?e.jsx(ce,{className:"w-9 h-9 text-white relative z-10 drop-shadow-lg",strokeWidth:3}):e.jsx(G,{className:"w-9 h-9 text-white relative z-10 drop-shadow-lg",strokeWidth:3})]}),!s&&e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-accent rounded-full animate-pulse shadow-lg"})]})}const Se=()=>e.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0",children:[...Array(6)].map((s,n)=>e.jsx("div",{className:"leaf absolute",style:{left:`${10+n*16}%`,animationDelay:`${n*2}s`},children:e.jsx(He,{className:"text-[#2D5016]",size:24+Math.random()*12,style:{transform:`rotate(${Math.random()*360}deg)`,opacity:.06}})},n))}),Z=({children:s,className:n="",hover:c=!0,tilt:u=!1,onClick:l})=>{const m="glass-card p-6",p=c?"hover:shadow-xl":"",x=u?"card-3d":"",b=l?"cursor-pointer":"";return e.jsx("div",{className:`${m} ${p} ${x} ${b} ${n}`,onClick:l,children:s})},ue=({children:s,variant:n="primary",size:c="md",className:u="",onClick:l,disabled:m=!1,type:p="button",icon:x})=>{const b="inline-flex items-center justify-center gap-2 font-semibold transition-all duration-300",f={primary:"btn-premium",gold:"btn-gold",neu:"btn-neu text-primary",outline:"border-2 border-primary text-primary hover:bg-primary hover:text-white bg-transparent"},t={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg"},i=m?"opacity-50 cursor-not-allowed":"";return e.jsxs("button",{type:p,onClick:l,disabled:m,className:`${b} ${f[n]} ${t[c]} ${i} ${u}`,children:[x&&e.jsx("span",{children:x}),s]})};function br(){const s=de();return e.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-20",children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:e.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-12 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-30 group-hover:opacity-50 transition-opacity duration-700"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-32 md:h-40 w-auto object-contain relative z-10 drop-shadow-2xl transform group-hover:scale-110 transition-transform duration-500"})]})}),e.jsxs("div",{className:"mb-6 inline-flex items-center gap-2 px-4 py-2 glass-card",children:[e.jsx(Ka,{className:"w-4 h-4 text-gold"}),e.jsx("span",{className:"text-sm font-bold text-gradient",children:"Premium Ayurvedic Management"})]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-heading font-bold text-primary mb-6 leading-tight animate-fade-in",children:["Elevate Your"," ",e.jsx("span",{className:"text-gradient-gold",children:"Ayurvedic"}),e.jsx("br",{}),"Business"]}),e.jsx("p",{className:"text-xl md:text-2xl text-primary/70 mb-12 max-w-2xl mx-auto leading-relaxed font-medium",children:"The most sophisticated platform for managing your Ayurvedic practice with elegance and precision"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center items-center mb-20",children:[e.jsx(ue,{variant:"primary",size:"lg",onClick:()=>s("/register"),className:"min-w-[220px] text-lg shadow-colored",children:"Start Your Journey"}),e.jsx(ue,{variant:"gold",size:"lg",onClick:()=>s("/login"),className:"min-w-[220px] text-lg",children:"Sign In"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mt-24",children:[e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(He,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Natural Flow"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Manage your practice with intuitive tools that respect the natural rhythm of Ayurvedic care"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float-delayed",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-gold rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-glow transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(se,{className:"w-8 h-8 text-primary-dark"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Premium Analytics"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Gain comprehensive insights into your business health with sophisticated reporting tools"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(bt,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Secure & Reliable"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Enterprise-grade security ensuring your data is protected with the highest standards"})]})]})]})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-48 bg-gradient-to-t from-primary/10 via-gold/5 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 text-center z-20",children:e.jsx("p",{className:"text-sm text-primary/50 font-medium",children:"Trusted by leading Ayurvedic practitioners worldwide"})})]})}function ur(){const s=de(),{signIn:n,user:c,loading:u}=H(),[l,m]=o.useState(""),[p,x]=o.useState(""),[b,f]=o.useState(""),[t,i]=o.useState(!1);o.useEffect(()=>{c&&!u&&s("/dashboard")},[c,u,s]);const a=async k=>{k.preventDefault(),f(""),i(!0);try{const{error:N}=await n(l,p);N&&(f(N.message||"Failed to sign in. Please check your credentials."),i(!1))}catch{f("An unexpected error occurred. Please try again."),i(!1)}};return e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(ze,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-md",children:[e.jsxs("div",{className:"glass-card p-8 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-300"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto",className:"h-16 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-200"})]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Welcome back"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Sign in to your account"})]}),b&&e.jsxs("div",{className:"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2 animate-slide-down",children:[e.jsx(fe,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:b})]}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Email address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),e.jsx("input",{id:"email",type:"email",value:l,onChange:k=>m(k.target.value),className:"w-full h-10 pl-10 pr-4 text-sm border border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 transition-all duration-150 focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10",placeholder:"you@example.com",required:!0,disabled:t})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),e.jsx("input",{id:"password",type:"password",value:p,onChange:k=>x(k.target.value),className:"w-full h-10 pl-10 pr-4 text-sm border border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 transition-all duration-150 focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:t})]})]}),e.jsx("button",{type:"submit",disabled:t,className:"w-full h-10 mt-6 bg-primary hover:bg-primary-dark text-white text-sm font-medium rounded-lg transition-all duration-150 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:t?"Signing in...":"Sign in"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx(Ne,{to:"/register",className:"text-primary font-semibold hover:text-primary-dark transition-colors",children:"Sign up"})]})})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center justify-center gap-1.5",children:[e.jsx(He,{className:"w-3.5 h-3.5"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function fr(){const s=de(),{signUp:n,user:c,loading:u}=H(),[l,m]=o.useState({name:"",email:"",phone:"",password:"",confirmPassword:""}),[p,x]=o.useState(""),[b,f]=o.useState(!1),[t,i]=o.useState(!1),[a,k]=o.useState(!1);o.useEffect(()=>{if(c&&!u){b&&f(!1);const _=setTimeout(()=>{s("/dashboard")},t?2e3:0);return()=>clearTimeout(_)}},[c,u,b,t,s]);const N=async _=>{if(_.preventDefault(),x(""),l.password.length<8){x("Password must be at least 8 characters long");return}if(l.password!==l.confirmPassword){x("Passwords do not match");return}f(!0);try{const{count:w,error:y}=await C.from("users").select("*",{count:"exact",head:!0});if(y)throw new Error("Failed to check existing users");const h=w===0,d=h?"admin":"partner";h&&i(!0);const{error:r}=await n(l.email,l.password,l.name,l.phone,d);r?(x(r.message||"Failed to create account. Please try again."),f(!1),i(!1)):h||(k(!0),f(!1))}catch(w){x(w.message||"An unexpected error occurred. Please try again."),f(!1),i(!1)}},j=_=>{m({...l,[_.target.name]:_.target.value})};return t?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-sage to-primary p-6 rounded-full shadow-glow",children:e.jsx(Q,{className:"w-12 h-12 text-cream",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Welcome, Founder!"}),e.jsx("p",{className:"text-primary/70 mb-4 text-lg font-medium",children:"Your account has been created successfully. You have full access to all features."}),e.jsx("p",{className:"text-primary/50 text-sm font-medium animate-pulse",children:"Redirecting to dashboard..."})]})})]}):a?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-blue-500 to-cyan-600 p-6 rounded-full shadow-glow",children:e.jsx(Q,{className:"w-12 h-12 text-white",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Registration Successful!"}),e.jsx("p",{className:"text-primary/70 mb-6 text-lg font-medium",children:"Your account has been created and is pending admin approval."}),e.jsx("div",{className:"glass-card bg-blue-50/50 p-4 mb-6",children:e.jsx("p",{className:"text-primary/60 text-sm font-medium",children:"You will receive a notification once your account is approved. Please check back later or wait for an email confirmation."})}),e.jsx(Ne,{to:"/login",children:e.jsx(ue,{variant:"primary",size:"lg",className:"w-full",children:"Go to Login"})})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(ze,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-lg",children:[e.jsxs("div",{className:"glass-card p-10 md:p-12 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-10 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-500"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-20 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-300"})]})}),e.jsx("h1",{className:"font-heading text-5xl font-bold text-gradient text-center mb-3",children:"Create Account"}),e.jsx("p",{className:"text-primary/60 text-center mb-10 text-lg font-medium",children:"Join Organitto and start managing your business"}),p&&e.jsxs("div",{className:"mb-8 p-5 bg-gradient-to-r from-red-50/90 to-red-100/90 backdrop-blur-sm border border-red-200 rounded-button flex items-start gap-3 animate-slide-down",children:[e.jsx(fe,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-700 font-medium",children:p})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"name",name:"name",type:"text",value:l.name,onChange:j,className:"input-float w-full pl-12",placeholder:"John Doe",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"email",name:"email",type:"email",value:l.email,onChange:j,className:"input-float w-full pl-12",placeholder:"you@example.com",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(pt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"phone",name:"phone",type:"tel",value:l.phone,onChange:j,className:"input-float w-full pl-12",placeholder:"+1 (555) 000-0000",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"password",name:"password",type:"password",value:l.password,onChange:j,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:b,minLength:8})]}),e.jsx("p",{className:"text-xs text-primary/50 mt-2 ml-1 font-medium",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",value:l.confirmPassword,onChange:j,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:b})]})]}),e.jsx(ue,{type:"submit",variant:"primary",size:"lg",disabled:b,className:"w-full text-lg mt-8",children:b?"Creating Account...":"Create Account"})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-primary/70 font-medium",children:["Already have an account?"," ",e.jsx(Ne,{to:"/login",className:"text-gradient-gold font-bold hover:underline transition-all",children:"Sign in here"})]})})]}),e.jsx("div",{className:"text-center mt-8 glass-card inline-block px-6 py-3 mx-auto",children:e.jsxs("p",{className:"text-primary/50 text-sm font-medium flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function ea({data:s}){const n=({active:c,payload:u,label:l})=>c&&u&&u.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-2",children:l}),u.map((m,p)=>e.jsxs("p",{className:"text-sm",style:{color:m.color},children:[m.name,": â‚¹",m.value.toLocaleString("en-IN")]},p))]}):null;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Investment vs Expense Trend"}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(Et,{data:s,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"month",stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"}}),e.jsx(Le,{stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"},tickFormatter:c=>`â‚¹${(c/1e3).toFixed(0)}k`}),e.jsx(je,{content:e.jsx(n,{})}),e.jsx(ft,{wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}}),e.jsx($e,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,dot:{fill:"#2D5016",r:5},activeDot:{r:7},name:"Investments"}),e.jsx($e,{type:"monotone",dataKey:"expenses",stroke:"#C85A3E",strokeWidth:3,dot:{fill:"#C85A3E",r:5},activeDot:{r:7},name:"Expenses"})]})})]})}const vs=["#2D5016","#C85A3E","#D4AF37","#87A96B","#3E2723","#D84315"];function ta({data:s}){const n=({active:u,payload:l})=>u&&l&&l.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:l[0].name}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["â‚¹",l[0].value.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[(l[0].value/s.reduce((m,p)=>m+p.value,0)*100).toFixed(1),"% of total"]})]}):null,c=u=>`${u.name}`;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Category-wise Expenses"}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(Pt,{children:[e.jsx(At,{data:s,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",label:c,children:s.map((u,l)=>e.jsx(It,{fill:vs[l%vs.length]},`cell-${l}`))}),e.jsx(je,{content:e.jsx(n,{})}),e.jsx(ft,{verticalAlign:"bottom",height:36,wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}})]})})]})}const gr=s=>{switch(s){case"expense":return{icon:we,color:"text-secondary",bg:"bg-secondary/20"};case"investment":return{icon:se,color:"text-primary",bg:"bg-primary/20"};case"product":return{icon:ne,color:"text-accent",bg:"bg-accent/20"};default:return{icon:ae,color:"text-dark-brown",bg:"bg-dark-brown/20"}}};function jr({activities:s}){return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Recent Activity"}),e.jsxs("button",{className:"text-sm font-semibold text-primary hover:text-sage transition-colors duration-300 flex items-center gap-1",children:["View All",e.jsx(ss,{className:"w-4 h-4"})]})]}),s.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-dark-brown/50",children:"No recent activity"})}):e.jsx("div",{className:"space-y-4",children:s.map(n=>{const{icon:c,color:u,bg:l}=gr(n.activity_type),m=ts(new Date(n.created_at),{addSuffix:!0});return e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-cream/30 rounded-xl hover:bg-cream/50 transition-all duration-300",children:[e.jsx("div",{className:`w-10 h-10 ${l} rounded-full flex items-center justify-center flex-shrink-0`,children:e.jsx(c,{className:`w-5 h-5 ${u}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-dark-brown leading-relaxed mb-1",children:n.description}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:m})]})]},n.id)})})]})}function yr(){const{user:s}=H(),[n,c]=o.useState({totalInvestments:0,totalExpenses:0,activeProducts:0}),[u,l]=o.useState([]),[m,p]=o.useState(!0),x=q(new Date,"EEEE, MMMM d, yyyy"),b=[{month:"Jul",investments:85e3,expenses:52e3},{month:"Aug",investments:92e3,expenses:61e3},{month:"Sep",investments:78e3,expenses:48e3},{month:"Oct",investments:105e3,expenses:72e3},{month:"Nov",investments:118e3,expenses:68e3},{month:"Dec",investments:125e3,expenses:75e3}],f=[{name:"Raw Materials",value:125e3},{name:"Labor",value:85e3},{name:"Marketing",value:42e3},{name:"Packaging",value:38e3},{name:"Utilities",value:28e3},{name:"Other",value:22e3}];o.useEffect(()=>{t()},[s]);const t=async()=>{if(s)try{const[a,k,N,j]=await Promise.all([C.from("investments").select("amount"),C.from("expenses").select("amount"),C.from("products").select("id, current_stage").in("current_stage",["idea","research","formula","testing","packaging","printing","production","ready"]),C.from("activity_log").select("*").order("created_at",{ascending:!1}).limit(10)]),_=a.data?.reduce((y,h)=>y+parseFloat(h.amount.toString()),0)||0,w=k.data?.reduce((y,h)=>y+parseFloat(h.amount.toString()),0)||0;c({totalInvestments:_,totalExpenses:w,activeProducts:N.data?.length||0}),l(j.data||[])}catch(a){console.error("Error fetching dashboard data:",a)}finally{p(!1)}},i=n.totalInvestments-n.totalExpenses;return e.jsx("div",{className:"page-transition",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"dashboard-hero",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"greeting",children:["Namaste, ",e.jsx("span",{className:"greeting-accent",children:s?.name||"User"})]}),e.jsx("p",{className:"date-time mt-1",children:x}),s?.role==="admin"&&e.jsxs("div",{className:"role-badge",children:[e.jsx(He,{className:"w-3 h-3"}),e.jsx("span",{children:"Admin"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[#6B7280] text-[0.6875rem] uppercase tracking-wider font-medium mb-1",children:"Net Balance"}),e.jsxs("p",{className:`text-2xl md:text-[1.875rem] font-semibold ${i>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",i.toLocaleString("en-IN")]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-6 stagger-container",children:[e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Investments"}),e.jsxs("div",{className:"number",children:["â‚¹",(n.totalInvestments/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend positive mt-2",children:[e.jsx("span",{children:"â†‘"}),e.jsx("span",{children:"12%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"this month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Expenses"}),e.jsxs("div",{className:"number",children:["â‚¹",(n.totalExpenses/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend negative mt-2",children:[e.jsx("span",{children:"â†“"}),e.jsx("span",{children:"8%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"vs last month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Net Balance"}),e.jsxs("div",{className:`number ${i>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",(Math.abs(i)/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:`trend mt-2 ${i>=0?"positive":"negative"}`,children:[e.jsx("span",{children:i>=0?"â†‘":"â†“"}),e.jsx("span",{children:i>=0?"Positive":"Negative"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Active Products"}),e.jsx("div",{className:"number",children:n.activeProducts}),e.jsxs("div",{className:"trend mt-2 text-[#2D5016]",children:[e.jsx("span",{children:"â—"}),e.jsx("span",{children:"In Pipeline"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(ea,{data:b}),e.jsx(ta,{data:f})]}),e.jsx(jr,{activities:u})]})})}function _t({title:s,value:n,trend:c,icon:u,iconBgColor:l,iconColor:m,valueColor:p="text-dark-brown"}){const x=c&&c.value>=0;return e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 hover:scale-[1.02] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-0 group-hover:opacity-5 transition-opacity duration-300"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 ${l} rounded-full flex items-center justify-center`,children:e.jsx(u,{className:`w-6 h-6 ${m}`})}),c&&e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full ${x?"bg-sage/20":"bg-soft-red/20"}`,children:[x?e.jsx(se,{className:"w-3 h-3 text-sage"}):e.jsx(we,{className:"w-3 h-3 text-soft-red"}),e.jsxs("span",{className:`text-xs font-semibold ${x?"text-sage":"text-soft-red"}`,children:[Math.abs(c.value),"%"]})]})]}),e.jsx("h3",{className:"text-sm font-medium text-dark-brown/60 mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold ${p} mb-1`,children:n}),c&&e.jsx("p",{className:"text-xs text-dark-brown/50",children:c.label})]})]})}function wr(){const{user:s}=H(),[n,c]=o.useState({total:0,thisMonth:0,lastMonth:0,byCategory:[]}),[u,l]=o.useState({total:0,thisMonth:0,count:0}),[m,p]=o.useState(!0);o.useEffect(()=>{x()},[s?.id]);const x=async()=>{if(s?.id)try{const f=new Date,t=new Date(f.getFullYear(),f.getMonth(),1),i=new Date(f.getFullYear(),f.getMonth()-1,1),a=new Date(f.getFullYear(),f.getMonth(),0),{data:k,error:N}=await C.from("expenses").select("*").eq("user_id",s.id).eq("status","approved").order("expense_date",{ascending:!1});if(N)throw N;const j=k?.filter(r=>new Date(r.expense_date)>=t)||[],_=k?.filter(r=>new Date(r.expense_date)>=i&&new Date(r.expense_date)<=a)||[],w=k?.reduce((r,v)=>(r[v.category]=(r[v.category]||0)+parseFloat(v.amount),r),{})||{};c({total:k?.reduce((r,v)=>r+parseFloat(v.amount),0)||0,thisMonth:j.reduce((r,v)=>r+parseFloat(v.amount),0),lastMonth:_.reduce((r,v)=>r+parseFloat(v.amount),0),byCategory:Object.entries(w).map(([r,v])=>({category:r,total:v}))});const{data:y,error:h}=await C.from("investments").select("*").order("investment_date",{ascending:!1});h&&console.error("Error fetching investments:",h);const d=y?.filter(r=>new Date(r.investment_date)>=t)||[];l({total:y?.reduce((r,v)=>r+parseFloat(v.amount),0)||0,thisMonth:d.reduce((r,v)=>r+parseFloat(v.amount),0),count:y?.length||0})}catch(f){console.error("Error fetching financial data:",f)}finally{p(!1)}},b=n.lastMonth>0?(n.thisMonth-n.lastMonth)/n.lastMonth*100:0;return m?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 page-transition",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx(qe,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"Finance Overview"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Expense and investment analytics"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(_t,{title:"Total Expenses",value:`â‚¹${n.total.toLocaleString()}`,icon:Mt,trend:b>0?"up":b<0?"down":void 0,trendValue:b!==0?`${Math.abs(b).toFixed(1)}% vs last month`:void 0,iconColor:"bg-gradient-to-br from-red-500 to-pink-600"}),e.jsx(_t,{title:"This Month",value:`â‚¹${n.thisMonth.toLocaleString()}`,icon:De,iconColor:"bg-gradient-to-br from-blue-500 to-cyan-600"}),e.jsx(_t,{title:"Investments",value:`â‚¹${u.total.toLocaleString()}`,icon:Ba,trendValue:u.count>0?`${u.count} total`:void 0,iconColor:"bg-gradient-to-br from-green-500 to-emerald-600"}),e.jsx(_t,{title:"Net Balance",value:`â‚¹${(u.total-n.total).toLocaleString()}`,icon:se,trend:u.total>n.total?"up":"down",iconColor:"bg-gradient-gold"})]}),n.byCategory.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(Mt,{className:"w-5 h-5"}),"Expense by Category"]}),e.jsx(ta,{data:n.byCategory.map(f=>({name:f.category,value:f.total}))})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Expenses vs Investments"]}),e.jsx(ea,{data:[{month:"Last Month",investments:u.total-u.thisMonth,expenses:n.lastMonth},{month:"This Month",investments:u.thisMonth,expenses:n.thisMonth}]})]})]})]})}const ks=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],Nr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function vr(){const{user:s}=H(),n=de(),[c,u]=o.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[l,m]=o.useState(null),[p,x]=o.useState(""),[b,f]=o.useState([]),[t,i]=o.useState([]),[a,k]=o.useState(!1),[N,j]=o.useState({}),[_,w]=o.useState(!1),[y,h]=o.useState(0);o.useEffect(()=>{d(),r()},[]);const d=async()=>{try{const{data:A,error:P}=await C.from("vendors").select("id, name").order("name");if(P)throw P;f(A||[])}catch(A){console.error("Error fetching vendors:",A)}},r=async()=>{try{const{data:A,error:P}=await C.from("users").select("id, name").order("name");if(P)throw P;i(A||[])}catch(A){console.error("Error fetching partners:",A)}},v=A=>{const P=A.target.files?.[0];if(P){if(P.size>5*1024*1024){j({...N,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes(P.type)){j({...N,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(m(P),j({...N,bill:""}),P.type.startsWith("image/")){const U=new FileReader;U.onloadend=()=>{x(U.result)},U.readAsDataURL(P)}else x("")}},g=()=>{const A={};return c.category||(A.category="Category is required"),(!c.amount||parseFloat(c.amount)<=0)&&(A.amount="Amount must be greater than 0"),c.date||(A.date="Date is required"),c.paymentMode||(A.paymentMode="Payment mode is required"),c.paidBy||(A.paidBy="Please select who paid"),j(A),Object.keys(A).length===0},D=async()=>{if(!l||!s)return null;try{const A=l.name.split(".").pop(),P=`${s.id}/${Date.now()}.${A}`,{error:U}=await C.storage.from("expense-bills").upload(P,l);if(U)throw U;const{data:O}=C.storage.from("expense-bills").getPublicUrl(P);return O.publicUrl}catch(A){return console.error("Error uploading bill:",A),null}},T=async(A="pending")=>{if(!(A==="pending"&&!g())){k(!0);try{let P=null;l&&(P=await D());const U={user_id:s?.id,category:c.category,subcategory:c.subcategory||null,amount:parseFloat(c.amount),expense_date:c.date,payment_mode:c.paymentMode,paid_by:c.paidBy,vendor_id:c.vendorId||null,bill_url:P,purpose:c.purpose||null,status:A==="draft"?"draft":"pending",submitted_by:s?.id,submitted_at:new Date().toISOString()},{error:O}=await C.from("expenses").insert(U);if(O)throw O;if(A!=="draft"){const Y=ks.find(ee=>ee.value===c.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense",description:`${s?.name} added expense: â‚¹${parseFloat(c.amount).toLocaleString("en-IN")} for ${Y?.label||c.category}`})}w(!0),setTimeout(()=>{n("/expenses")},2e3)}catch(P){console.error("Error submitting expense:",P),j({submit:"Failed to submit expense. Please try again."})}finally{k(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Add New Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Submit an expense for approval"})]}),_&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx(Lt,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense submitted for approval!"})]}),N.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:N.submit})]}),e.jsx("form",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:c.category,onChange:A=>u({...c,category:A.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${N.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),ks.map(A=>e.jsxs("option",{value:A.value,children:[A.icon," ",A.label]},A.value))]}),N.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:N.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:c.subcategory,onChange:A=>u({...c,subcategory:A.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:c.amount,onChange:A=>u({...c,amount:A.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${N.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),N.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:N.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:c.date,onChange:A=>u({...c,date:A.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${N.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),N.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:N.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:c.paidBy,onChange:A=>u({...c,paidBy:A.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${N.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),t.map(A=>e.jsx("option",{value:A.id,children:A.name},A.id))]}),N.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:N.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Nr.map(A=>e.jsxs("button",{type:"button",onClick:()=>u({...c,paymentMode:A.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${c.paymentMode===A.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:A.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:A.label})]},A.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:c.vendorId,onChange:A=>u({...c,vendorId:A.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),b.map(A=>e.jsx("option",{value:A.id,children:A.name},A.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:v,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:l?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[p&&e.jsx("img",{src:p,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:l.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(l.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:A=>{A.preventDefault(),m(null),x("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(ce,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),N.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:N.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[y,"/500"]})]}),e.jsx("textarea",{value:c.purpose,onChange:A=>{A.target.value.length<=500&&(u({...c,purpose:A.target.value}),h(A.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>T("pending"),disabled:a,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-5 h-5 animate-spin"}),"Submitting..."]}):"Submit for Approval"}),e.jsx("button",{type:"button",onClick:()=>T("draft"),disabled:a,className:"px-8 py-4 bg-transparent text-primary font-semibold rounded-xl border-2 border-primary hover:bg-primary hover:text-cream transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save as Draft"}),e.jsx("button",{type:"button",onClick:()=>n("/expenses"),disabled:a,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]})}const _s=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],kr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function _r(){const{user:s}=H(),n=de(),{id:c}=Je(),u=s?.role==="admin",[l,m]=o.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[p,x]=o.useState(null),[b,f]=o.useState(""),[t,i]=o.useState(""),[a,k]=o.useState([]),[N,j]=o.useState([]),[_,w]=o.useState(!1),[y,h]=o.useState(!0),[d,r]=o.useState({}),[v,g]=o.useState(!1),[D,T]=o.useState(0);o.useEffect(()=>{if(!u){n("/expenses");return}A(),P(),U()},[c,u]);const A=async()=>{if(c)try{const{data:S,error:$}=await C.from("expenses").select("*").eq("id",c).maybeSingle();if($)throw $;S&&(m({category:S.category,subcategory:S.subcategory||"",amount:S.amount.toString(),date:S.expense_date,paymentMode:S.payment_mode,paidBy:S.paid_by,vendorId:S.vendor_id||"",purpose:S.purpose||""}),T(S.purpose?.length||0),i(S.bill_url||""))}catch(S){console.error("Error fetching expense:",S),alert("Failed to load expense. Redirecting to expense list."),n("/expenses")}finally{h(!1)}},P=async()=>{try{const{data:S,error:$}=await C.from("vendors").select("id, name").order("name");if($)throw $;k(S||[])}catch(S){console.error("Error fetching vendors:",S)}},U=async()=>{try{const{data:S,error:$}=await C.from("users").select("id, name").order("name");if($)throw $;j(S||[])}catch(S){console.error("Error fetching partners:",S)}},O=S=>{const $=S.target.files?.[0];if($){if($.size>5*1024*1024){r({...d,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes($.type)){r({...d,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(x($),r({...d,bill:""}),$.type.startsWith("image/")){const L=new FileReader;L.onloadend=()=>{f(L.result)},L.readAsDataURL($)}else f("")}},Y=()=>{const S={};return l.category||(S.category="Category is required"),(!l.amount||parseFloat(l.amount)<=0)&&(S.amount="Amount must be greater than 0"),l.date||(S.date="Date is required"),l.paymentMode||(S.paymentMode="Payment mode is required"),l.paidBy||(S.paidBy="Please select who paid"),r(S),Object.keys(S).length===0},ee=async()=>{if(!p||!s)return null;try{const S=p.name.split(".").pop(),$=`${s.id}/${Date.now()}.${S}`,{error:L}=await C.storage.from("expense-bills").upload($,p);if(L)throw L;const{data:V}=C.storage.from("expense-bills").getPublicUrl($);return V.publicUrl}catch(S){return console.error("Error uploading bill:",S),null}},te=async S=>{if(S.preventDefault(),!!Y()){w(!0);try{let $=t;if(p){const z=await ee();z&&($=z)}const L={category:l.category,subcategory:l.subcategory||null,amount:parseFloat(l.amount),expense_date:l.date,payment_mode:l.paymentMode,paid_by:l.paidBy,vendor_id:l.vendorId||null,bill_url:$,purpose:l.purpose||null},{error:V}=await C.from("expenses").update(L).eq("id",c);if(V)throw V;const F=_s.find(z=>z.value===l.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense_updated",description:`${s?.name} updated expense: â‚¹${parseFloat(l.amount).toLocaleString("en-IN")} for ${F?.label||l.category}`}),g(!0),setTimeout(()=>{n("/expenses")},2e3)}catch($){console.error("Error updating expense:",$),r({submit:"Failed to update expense. Please try again."})}finally{w(!1)}}};return u?y?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})}):e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>n("/expenses"),className:"flex items-center gap-2 text-primary hover:text-primary/80 font-medium mb-4 transition-colors",children:[e.jsx(ze,{className:"w-4 h-4"}),"Back to Expenses"]}),e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Edit Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Update expense details"})]}),v&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx(Lt,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense updated successfully!"})]}),d.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:d.submit})]}),e.jsx("form",{onSubmit:te,className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:l.category,onChange:S=>m({...l,category:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${d.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),_s.map(S=>e.jsxs("option",{value:S.value,children:[S.icon," ",S.label]},S.value))]}),d.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:d.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:l.subcategory,onChange:S=>m({...l,subcategory:S.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:l.amount,onChange:S=>m({...l,amount:S.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${d.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),d.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:d.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:l.date,onChange:S=>m({...l,date:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${d.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),d.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:d.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:l.paidBy,onChange:S=>m({...l,paidBy:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${d.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),N.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]}),d.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:d.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:kr.map(S=>e.jsxs("button",{type:"button",onClick:()=>m({...l,paymentMode:S.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${l.paymentMode===S.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:S.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:S.label})]},S.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:l.vendorId,onChange:S=>m({...l,vendorId:S.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),a.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload"}),t&&!p&&e.jsx("div",{className:"mb-4 p-4 bg-sage/5 border-2 border-sage/20 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:"ðŸ“„"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"Current Bill"}),e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline",children:"View existing bill"})]})]}),e.jsx("button",{type:"button",onClick:()=>i(""),className:"text-xs text-soft-red hover:underline",children:"Remove"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:O,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:p?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[b&&e.jsx("img",{src:b,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:p.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(p.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:S=>{S.preventDefault(),x(null),f("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(ce,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:t?"Upload new bill to replace existing":"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),d.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:d.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[D,"/500"]})]}),e.jsx("textarea",{value:l.purpose,onChange:S=>{S.target.value.length<=500&&(m({...l,purpose:S.target.value}),T(S.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"submit",disabled:_,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-5 h-5 animate-spin"}),"Updating..."]}):"Update Expense"}),e.jsx("button",{type:"button",onClick:()=>n("/expenses"),disabled:_,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]}):null}const Cr=["Duplicate entry","Insufficient proof","Incorrect amount","Wrong category","Not a business expense","Missing receipt","Other (specify below)"];function sa({isOpen:s,onClose:n,onConfirm:c,type:u,expense:l,loading:m=!1}){const[p,x]=o.useState(""),[b,f]=o.useState(""),[t,i]=o.useState("");if(!s)return null;const a=()=>{if(u==="reject"){const N=b==="Other (specify below)"?t:b;if(!N.trim()){alert("Please provide a reason for rejection");return}c(void 0,N)}else c(p)},k=N=>N.split("_").map(j=>j.charAt(0).toUpperCase()+j.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:`p-6 border-b-2 ${u==="approve"?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u==="approve"?e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-green-600"})}):e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Me,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-gray-900",children:u==="approve"?"Approve Expense":"Reject Expense"}),e.jsx("p",{className:"text-sm text-gray-600",children:u==="approve"?"Confirm approval of this expense":"Please provide a reason"})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-5 h-5 text-gray-600"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"Expense Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[k(l.category),l.subcategory&&` - ${l.subcategory}`]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-orange-600 text-xl",children:["â‚¹",l.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Date(l.expense_date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment:"}),e.jsx("span",{className:"font-semibold text-gray-900 uppercase",children:l.payment_mode.replace("_"," ")})]})]})]}),u==="reject"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Reason for Rejection ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:b,onChange:N=>f(N.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select a reason"}),Cr.map(N=>e.jsx("option",{value:N,children:N},N))]})]}),b==="Other (specify below)"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Specify Reason"}),e.jsx("textarea",{value:t,onChange:N=>i(N.target.value),placeholder:"Please provide detailed reason...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(fe,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:"The submitter will be notified of this rejection and the reason provided."})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Comments (Optional)"}),e.jsx("textarea",{value:p,onChange:N=>x(N.target.value),placeholder:"Add any comments or notes...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:n,disabled:m,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 font-bold rounded-xl hover:bg-gray-50 transition-all duration-300 disabled:opacity-50 shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:m,className:`flex-1 px-6 py-3 font-bold rounded-xl shadow-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${u==="approve"?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white":"bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white"}`,children:m?"Processing...":u==="approve"?"Confirm Approval":"Confirm Rejection"})]})]})]})]})}function Sr({isOpen:s,onClose:n,billUrl:c,expenseDetails:u}){const[l,m]=o.useState(100),[p,x]=o.useState(0);if(!s)return null;const b=c.toLowerCase().endsWith(".pdf"),f=()=>{window.open(c,"_blank")},t=()=>{m(N=>Math.min(N+25,200))},i=()=>{m(N=>Math.max(N-25,50))},a=()=>{x(N=>(N+90)%360)},k=N=>N.split("_").map(j=>j.charAt(0).toUpperCase()+j.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-dark-brown/90 backdrop-blur-md",children:[e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between",children:[e.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-xl px-4 py-3 shadow-soft",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:k(u.category)})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"font-bold text-secondary",children:["â‚¹",u.amount.toLocaleString("en-IN")]})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:new Date(u.date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!b&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i,disabled:l<=50,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(rr,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"px-4 py-3 bg-white/90 backdrop-blur-sm rounded-lg shadow-soft",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[l,"%"]})}),e.jsx("button",{onClick:t,disabled:l>=200,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(ar,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("button",{onClick:a,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 shadow-soft",children:e.jsx(Wa,{className:"w-5 h-5 text-dark-brown"})})]}),e.jsx("button",{onClick:f,className:"p-3 bg-primary/90 backdrop-blur-sm rounded-lg hover:bg-primary transition-all duration-300 shadow-soft",children:e.jsx(ke,{className:"w-5 h-5 text-cream"})}),e.jsx("button",{onClick:n,className:"p-3 bg-soft-red/90 backdrop-blur-sm rounded-lg hover:bg-soft-red transition-all duration-300 shadow-soft",children:e.jsx(ce,{className:"w-5 h-5 text-white"})})]})]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-24 overflow-auto",children:b?e.jsx("iframe",{src:c,className:"w-full h-full bg-white rounded-xl shadow-soft-lg",title:"Bill PDF"}):e.jsx("img",{src:c,alt:"Bill",className:"max-w-full max-h-full object-contain rounded-xl shadow-soft-lg transition-transform duration-300",style:{transform:`scale(${l/100}) rotate(${p}deg)`}})})]})}const ot=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20 text-sage"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-accent/20 text-accent"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-dark-brown/20 text-dark-brown"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš",color:"bg-primary/20 text-primary"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢",color:"bg-secondary/20 text-secondary"},{value:"lab_testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-sage/30 text-sage"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ",color:"bg-accent/30 text-accent"},{value:"utilities",label:"Utilities",icon:"âš¡",color:"bg-primary/30 text-primary"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢",color:"bg-dark-brown/30 text-dark-brown"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥",color:"bg-secondary/30 text-secondary"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§",color:"bg-sage/40 text-sage"},{value:"other",label:"Other",icon:"ðŸ“±",color:"bg-dark-brown/40 text-dark-brown"}];function Dr(){const{user:s}=H(),n=de(),[c,u]=o.useState([]),[l,m]=o.useState(!0),[p,x]=o.useState(""),[b,f]=o.useState("all"),[t,i]=o.useState(null),[a,k]=o.useState(!1),[N,j]=o.useState("approve"),[_,w]=o.useState(!1),[y,h]=o.useState(null),[d,r]=o.useState(1),[v,g]=o.useState(20),[D,T]=o.useState(null),[A,P]=o.useState(!1),[U,O]=o.useState(""),[Y,ee]=o.useState(""),[te,S]=o.useState([]),[$,L]=o.useState([]),[V,F]=o.useState("expense_date"),[z,le]=o.useState("desc"),me=s?.role==="admin";o.useEffect(()=>{_e();const M=C.channel("expenses-changes").on("postgres_changes",{event:"*",schema:"public",table:"expenses"},()=>{_e()}).subscribe();return()=>{C.removeChannel(M)}},[]);const _e=async()=>{if(s)try{let M=C.from("expenses").select(`
          *,
          users_paid_by:users!expenses_paid_by_fkey(name),
          users_submitted_by:users!expenses_submitted_by_fkey(name),
          users_approved_by:users!expenses_approved_by_fkey(name),
          vendors(name)
        `);me||(M=M.eq("submitted_by",s.id));const{data:B,error:W}=await M.order(V,{ascending:z==="asc"});if(W)throw W;u(B||[])}catch(M){console.error("Error fetching expenses:",M)}finally{m(!1)}},jt=M=>{i(M),j("approve"),k(!0)},Ce=M=>{i(M),j("reject"),k(!0)},We=async(M,B)=>{if(!(!t||!s)){T(t.id);try{const W={status:N==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};N==="approve"&&M?W.approval_comments=M:N==="reject"&&B&&(W.rejection_reason=B);const{error:Nt}=await C.from("expenses").update(W).eq("id",t.id);if(Nt)throw Nt;const Bt=ot.find(Qe=>Qe.value===t.category);await C.from("activity_log").insert({user_id:s.id,activity_type:N==="approve"?"expense_approved":"expense_rejected",description:`${s.name} ${N==="approve"?"approved":"rejected"} expense: â‚¹${t.amount.toLocaleString("en-IN")} for ${Bt?.label||t.category}`}),await _e(),k(!1),i(null)}catch(W){console.error("Error processing approval:",W),alert("Failed to process approval. Please try again.")}finally{T(null)}}},Ze=async M=>{if(confirm("Are you sure you want to delete this expense? This action cannot be undone."))try{const{error:B}=await C.from("expenses").delete().eq("id",M);if(B)throw B;await _e()}catch(B){console.error("Error deleting expense:",B),alert("Failed to delete expense. Please try again.")}},yt=M=>{M.bill_url&&(i(M),w(!0),C.from("expenses").update({viewed_bill:!0}).eq("id",M.id).then())},Xe=M=>{switch(M){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},Ee=M=>ot.find(B=>B.value===M)||ot[ot.length-1],Pe=c.filter(M=>{if(b==="pending"&&M.status!=="pending"||b==="approved"&&M.status!=="approved"||b==="rejected"&&M.status!=="rejected"||b==="my_expenses"&&M.submitted_by!==s?.id)return!1;if(p){const B=p.toLowerCase();if(!M.category.toLowerCase().includes(B)&&!M.subcategory?.toLowerCase().includes(B)&&!M.purpose?.toLowerCase().includes(B)&&!M.vendors?.name.toLowerCase().includes(B))return!1}return!(U&&M.expense_date<U||Y&&M.expense_date>Y||te.length>0&&!te.includes(M.category)||$.length>0&&!$.includes(M.payment_mode))}),wt=Pe.slice((d-1)*v,d*v),Ae=Math.ceil(Pe.length/v),qt=M=>M==="all"?c.length:M==="pending"?c.filter(B=>B.status==="pending").length:M==="approved"?c.filter(B=>B.status==="approved").length:M==="rejected"?c.filter(B=>B.status==="rejected").length:M==="my_expenses"?c.filter(B=>B.submitted_by===s?.id).length:0,Rt=c.filter(M=>{const B=new Date(M.expense_date),W=new Date;return B.getMonth()===W.getMonth()&&B.getFullYear()===W.getFullYear()}).reduce((M,B)=>M+B.amount,0),Ut=M=>{S(B=>B.includes(M)?B.filter(W=>W!==M):[...B,M])},zt=M=>{L(B=>B.includes(M)?B.filter(W=>W!==M):[...B,M])},et=()=>{x(""),O(""),ee(""),S([]),L([]),f("all")},Ge=M=>{V===M?le(B=>B==="asc"?"desc":"asc"):(F(M),le("desc"))};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Expense Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Manage and approve all expenses"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",Rt.toLocaleString("en-IN")]})]}),e.jsxs("button",{onClick:()=>n("/expenses/add"),className:"flex items-center gap-2 px-6 py-3 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Expense"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 mb-6",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 mt-2 overflow-x-auto pb-6 pt-2 scrollbar-thin",children:["all","pending","approved","rejected","my_expenses"].map(M=>e.jsxs("button",{onClick:()=>f(M),className:`px-4 py-2 rounded-lg font-medium whitespace-nowrap transition-all duration-300 flex items-center gap-2 ${b===M?"bg-primary text-cream shadow-soft":"bg-cream/50 text-dark-brown hover:bg-primary/10"}`,children:[M==="all"&&"All",M==="pending"&&"â³ Pending",M==="approved"&&"âœ… Approved",M==="rejected"&&"âŒ Rejected",M==="my_expenses"&&"My Expenses",e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${b===M?"bg-cream/20 text-cream":"bg-dark-brown/10 text-dark-brown"}`,children:qt(M)})]},M))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search by category, vendor, or purpose...",value:p,onChange:M=>x(M.target.value),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsxs("button",{onClick:()=>P(!A),className:`flex items-center gap-2 px-6 py-3 border-2 font-semibold rounded-xl transition-all duration-300 ${A||te.length>0||$.length>0||U||Y?"border-primary bg-primary text-cream":"border-primary text-primary hover:bg-primary hover:text-cream"}`,children:[e.jsx(Bs,{className:"w-5 h-5"}),"Filters",te.length+$.length+(U?1:0)+(Y?1:0)>0&&e.jsx("span",{className:"px-2 py-0.5 bg-cream/20 rounded-full text-xs font-bold",children:te.length+$.length+(U?1:0)+(Y?1:0)})]}),e.jsxs("button",{onClick:()=>alert("Export feature coming soon"),className:"flex items-center gap-2 px-6 py-3 border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export"]})]}),A&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:U,onChange:M=>O(M.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:Y,onChange:M=>ee(M.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ot.map(M=>e.jsxs("button",{onClick:()=>Ut(M.value),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${te.includes(M.value)?M.color:"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:[M.icon," ",M.label]},M.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Mode"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["cash","upi","bank_transfer","card"].map(M=>e.jsx("button",{onClick:()=>zt(M),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${$.includes(M)?"bg-primary text-cream":"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:M.toUpperCase().replace("_"," ")},M))})]}),e.jsx("button",{onClick:et,className:"w-full py-2 text-soft-red font-semibold hover:bg-soft-red/10 rounded-lg transition-all",children:"Reset All Filters"})]})]})]}),l?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading expenses..."})}):Pe.length===0?e.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No expenses found"}),e.jsxs("button",{onClick:()=>n("/expenses/add"),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-white font-semibold rounded-xl hover:scale-105 transition-all duration-300",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Your First Expense"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-primary/10",children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>Ge("expense_date"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Date ",V==="expense_date"&&(z==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsxs("th",{onClick:()=>Ge("amount"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Amount ",V==="amount"&&(z==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Payment"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Bill"}),e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:wt.map((M,B)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{onClick:()=>h(y===M.id?null:M.id),className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors cursor-pointer ${B%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:q(new Date(M.expense_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Ee(M.category).color}`,children:[Ee(M.category).icon," ",Ee(M.category).label]})}),M.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1",children:M.subcategory})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",M.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:M.users_paid_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-xs font-semibold text-dark-brown uppercase",children:M.payment_mode.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-4",children:Xe(M.status)}),e.jsx("td",{className:"px-4 py-4",children:M.bill_url?e.jsx("button",{onClick:W=>{W.stopPropagation(),yt(M)},className:"p-2 hover:bg-primary/10 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No bill"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[me&&M.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:W=>{W.stopPropagation(),jt(M)},disabled:D===M.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(Q,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:W=>{W.stopPropagation(),Ce(M)},disabled:D===M.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Me,{className:"w-4 h-4 text-soft-red"})})]}),me&&e.jsx("button",{onClick:W=>{W.stopPropagation(),n(`/expenses/edit/${M.id}`)},className:"p-2 hover:bg-accent/10 rounded-lg transition-colors",title:"Edit",children:e.jsx(js,{className:"w-4 h-4 text-accent"})}),me&&e.jsx("button",{onClick:W=>{W.stopPropagation(),Ze(M.id)},className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(ie,{className:"w-4 h-4 text-soft-red"})})]})})]},M.id),y===M.id&&e.jsx("tr",{className:"bg-primary/5",children:e.jsx("td",{colSpan:8,className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-3",children:[M.purpose&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Purpose/Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.purpose})]}),M.vendors&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Vendor"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.vendors.name})]}),M.approval_comments&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-sage mb-1",children:"Approval Comments"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.approval_comments})]}),M.rejection_reason&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-soft-red mb-1",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.rejection_reason})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-dark-brown/50",children:[e.jsxs("span",{children:["Submitted by: ",M.users_submitted_by?.name]}),M.users_approved_by&&e.jsxs("span",{children:["Approved by: ",M.users_approved_by.name]})]})]})})})]}))})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:wt.map(M=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 hover:shadow-soft-lg transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Ee(M.category).color}`,children:[Ee(M.category).icon," ",Ee(M.category).label]}),Xe(M.status)]}),M.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mb-2",children:M.subcategory})]}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",M.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Date:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:q(new Date(M.expense_date),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Paid by:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:M.users_paid_by?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Payment:"}),e.jsx("span",{className:"font-medium text-dark-brown uppercase",children:M.payment_mode.replace("_"," ")})]})]}),M.purpose&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Purpose"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.purpose})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4 pt-3 border-t border-dark-brown/10",children:[M.bill_url&&e.jsxs("button",{onClick:()=>yt(M),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-primary/10 text-primary font-semibold rounded-lg hover:bg-primary/20 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"View Bill"]}),me&&M.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>jt(M),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-sage/10 text-sage font-semibold rounded-lg hover:bg-sage/20 transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>Ce(M),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red font-semibold rounded-lg hover:bg-soft-red/20 transition-colors",children:[e.jsx(Me,{className:"w-4 h-4"}),"Reject"]})]}),me&&e.jsxs("button",{onClick:()=>n(`/expenses/edit/${M.id}`),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-accent/10 text-accent font-semibold rounded-lg hover:bg-accent/20 transition-colors",children:[e.jsx(js,{className:"w-4 h-4"}),"Edit"]})]})]},M.id))}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 mt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Items per page:"}),e.jsxs("select",{value:v,onChange:M=>{g(Number(M.target.value)),r(1)},className:"px-3 py-1 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsxs("span",{className:"text-sm text-dark-brown/70",children:["Showing ",(d-1)*v+1," - ",Math.min(d*v,Pe.length)," of ",Pe.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(M=>Math.max(1,M-1)),disabled:d===1,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Pa,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,Ae)},(M,B)=>{let W;return Ae<=5||d<=3?W=B+1:d>=Ae-2?W=Ae-4+B:W=d-2+B,e.jsx("button",{onClick:()=>r(W),className:`w-10 h-10 rounded-lg font-semibold transition-all ${d===W?"bg-primary text-cream":"border-2 border-dark-brown/10 text-dark-brown hover:bg-primary/10"}`,children:W},W)})}),e.jsx("button",{onClick:()=>r(M=>Math.min(Ae,M+1)),disabled:d===Ae,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Us,{className:"w-5 h-5 text-dark-brown"})})]})]})})]})]})}),a&&t&&e.jsx(sa,{isOpen:a,onClose:()=>{k(!1),i(null)},onConfirm:We,type:N,expense:t,loading:D===t.id}),_&&t&&t.bill_url&&e.jsx(Sr,{isOpen:_,onClose:()=>{w(!1),i(null)},billUrl:t.bill_url,expenseDetails:{category:t.category,amount:t.amount,date:t.expense_date}})]})}function Mr({expenses:s,investments:n,vendors:c}){const u=s.filter(v=>v.status==="approved"),l=n.filter(v=>v.status==="approved"),m=u.reduce((v,g)=>v+g.amount,0),p=l.reduce((v,g)=>v+g.amount,0),x=p-m,b=p>0?x/p*100:0,f={};for(let v=11;v>=0;v--){const g=ct(new Date,v),D=q(g,"yyyy-MM"),T=q(g,"MMM yyyy");f[D]={month:T,investments:0,expenses:0,net:0}}l.forEach(v=>{const g=q(new Date(v.investment_date),"yyyy-MM");f[g]&&(f[g].investments+=v.amount)}),u.forEach(v=>{const g=q(new Date(v.expense_date),"yyyy-MM");f[g]&&(f[g].expenses+=v.amount)});const t=Object.values(f).map(v=>({...v,net:v.investments-v.expenses})),i=u.length>0?m/Object.keys(f).length:0,a=u.reduce((v,g)=>(v[g.category]||(v[g.category]=0),v[g.category]+=g.amount,v),{}),k=Object.entries(a).sort((v,g)=>g[1]-v[1])[0],N=u.reduce((v,g)=>{const D=g.paid_by||g.user_id;return v[D]||(v[D]={name:g.users_paid_by?.name||g.users?.name||"Unknown",total:0}),v[D].total+=g.amount,v},{}),j=Object.values(N).sort((v,g)=>g.total-v.total)[0],_=u.length>0?m/u.length:0,w=s.filter(v=>v.status==="pending").length,y=u.reduce((v,g)=>{const D=g.payment_mode||"unknown";return v[D]=(v[D]||0)+1,v},{}),h=Object.entries(y).sort((v,g)=>g[1]-v[1])[0],d=t.reduce((v,g)=>g.expenses>v.expenses?g:v,t[0]||{month:"N/A",expenses:0}),r=v=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[v]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/30 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Investments"})]}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-1",children:["â‚¹",p.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/20 to-secondary/10 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/30 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Expenses"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",m.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Spent"})]}),e.jsxs("div",{className:`bg-gradient-to-br rounded-xl p-6 border-2 shadow-soft ${x>=0?"from-accent/20 to-accent/10 border-accent/30":"from-soft-red/20 to-soft-red/10 border-soft-red/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${x>=0?"bg-accent/30":"bg-soft-red/30"}`,children:x>=0?e.jsx(se,{className:"w-6 h-6 text-accent"}):e.jsx(we,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:`text-xs font-semibold uppercase tracking-wide ${x>=0?"text-accent":"text-soft-red"}`,children:"Net Balance"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${x>=0?"text-accent":"text-soft-red"}`,children:["â‚¹",Math.abs(x).toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[b.toFixed(1),"% margin"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/30 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Burn Rate"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary mb-1",children:["â‚¹",i.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Month Avg"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-3xl",children:k?r(k[0]):"ðŸ“Š"}),e.jsx(is,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Category"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1",children:k?k[0]:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",k?k[1].toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:j?j.name.charAt(0):"?"}),e.jsx(ge,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Spender"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1 truncate",children:j?j.name:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",j?j.total.toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(ht,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Avg Expense"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",_.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending Approvals"}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:w})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment vs Expense Trend (12 Months)"}),e.jsx(be,{width:"100%",height:400,children:e.jsxs(ba,{data:t,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Le,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(je,{formatter:v=>`â‚¹${v.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ft,{}),e.jsx(ua,{type:"monotone",dataKey:"net",fill:"#B8860B",fillOpacity:.1,stroke:"none",name:"Net Balance"}),e.jsx($e,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,name:"Investments",dot:{fill:"#2D5016",r:5}}),e.jsx($e,{type:"monotone",dataKey:"expenses",stroke:"#C17817",strokeWidth:3,name:"Expenses",dot:{fill:"#C17817",r:5}})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-accent/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent",children:"Quick Insight"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Highest spending month:"})}),e.jsx("p",{className:"text-lg font-bold text-secondary",children:d.month}),e.jsxs("p",{className:"text-xl font-bold text-accent",children:["â‚¹",d.expenses.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-sage/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(ht,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage",children:"Payment Mode"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Most used:"})}),e.jsx("p",{className:"text-xl font-bold text-secondary uppercase",children:h?h[0]:"N/A"}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[h?h[1]:0," transactions"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-primary/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-sm font-semibold text-primary",children:"Efficiency"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Approval rate:"})}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[s.length>0?(u.length/s.length*100).toFixed(0):0,"%"]})]})]})]})}const Ct=["#C17817","#2D5016","#B8860B","#8B4513","#D4AF37","#CD853F","#DAA520","#A0522D"];function Er({expenses:s}){const[n,c]=o.useState(null),[u,l]=o.useState("all"),m=s.filter(w=>w.status==="approved"),b=(w=>{if(u==="all")return w;const y=parseInt(u),h=ct(new Date,y);return w.filter(d=>new Date(d.expense_date)>=h)})(m).reduce((w,y)=>{const h=y.category;return w[h]||(w[h]={category:h,total:0,count:0,expenses:[]}),w[h].total+=y.amount,w[h].count+=1,w[h].expenses.push(y),w},{}),f=Object.values(b).sort((w,y)=>y.total-w.total),t=f.reduce((w,y)=>w+y.total,0),i=f.map(w=>({name:w.category,value:w.total})),a=f.map(w=>({category:w.category,amount:w.total})),k=w=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[w]||"ðŸ’°",N=w=>{const y={};for(let d=5;d>=0;d--){const r=ct(new Date,d),v=q(r,"MMM");y[v]=0}return m.filter(d=>d.category===w).forEach(d=>{const r=q(new Date(d.expense_date),"MMM");y[r]!==void 0&&(y[r]+=d.amount)}),Object.entries(y).map(([d,r])=>({month:d,value:r}))},j=w=>{const y=new Date().getMonth(),h=new Date(new Date().setMonth(y-1)).getMonth(),d=m.filter(g=>g.category===w&&new Date(g.expense_date).getMonth()===y).reduce((g,D)=>g+D.amount,0),r=m.filter(g=>g.category===w&&new Date(g.expense_date).getMonth()===h).reduce((g,D)=>g+D.amount,0);if(r===0)return{direction:"neutral",percent:0};const v=(d-r)/r*100;return{direction:v>0?"up":v<0?"down":"neutral",percent:Math.abs(v)}},_=n?b[n]:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4 items-center mb-6",children:e.jsxs("select",{value:u,onChange:w=>l(w.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"1",children:"Last Month"}),e.jsx("option",{value:"3",children:"Last 3 Months"}),e.jsx("option",{value:"6",children:"Last 6 Months"}),e.jsx("option",{value:"12",children:"Last Year"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map((w,y)=>{const h=t>0?w.total/t*100:0,d=w.count>0?w.total/w.count:0,r=j(w.category),v=N(w.category);return e.jsxs("div",{onClick:()=>c(w.category),className:`bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 shadow-soft cursor-pointer transition-all duration-300 hover:shadow-soft-lg hover:scale-[1.02] ${n===w.category?"border-accent ring-2 ring-accent/20":"border-dark-brown/10"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:k(w.category)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary",children:w.category}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[w.count," transactions"]})]})]}),e.jsxs("div",{className:"text-right",children:[r.direction==="up"&&e.jsxs("div",{className:"flex items-center gap-1 text-soft-red text-xs",children:[e.jsx(se,{className:"w-3 h-3"}),r.percent.toFixed(0),"%"]}),r.direction==="down"&&e.jsxs("div",{className:"flex items-center gap-1 text-sage text-xs",children:[e.jsx(we,{className:"w-3 h-3"}),r.percent.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",w.total.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[h.toFixed(1),"% of total expenses"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Average per transaction"}),e.jsxs("p",{className:"text-lg font-semibold text-accent",children:["â‚¹",d.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsx("div",{className:"h-16",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsx(Et,{data:v,children:e.jsx($e,{type:"monotone",dataKey:"value",stroke:Ct[y%Ct.length],strokeWidth:2,dot:!1})})})})]},w.category)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Distribution"}),i.length>0?e.jsx(be,{width:"100%",height:350,children:e.jsxs(Pt,{children:[e.jsx(At,{data:i,cx:"50%",cy:"50%",labelLine:!1,label:({name:w,percent:y})=>`${w} (${(y*100).toFixed(0)}%)`,outerRadius:120,fill:"#8884d8",dataKey:"value",onClick:w=>c(w.name),children:i.map((w,y)=>e.jsx(It,{fill:Ct[y%Ct.length],className:"cursor-pointer hover:opacity-80 transition-opacity"},`cell-${y}`))}),e.jsx(je,{formatter:w=>`â‚¹${w.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Comparison"}),a.length>0?e.jsx(be,{width:"100%",height:350,children:e.jsxs(Ft,{data:a,layout:"vertical",children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Le,{dataKey:"category",type:"category",width:120,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(je,{formatter:w=>`â‚¹${w.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(xt,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0],onClick:w=>c(w.category),className:"cursor-pointer"})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]})]}),_&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-heading text-2xl font-bold text-primary flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:k(_.category)}),_.category," Details"]}),e.jsx("button",{onClick:()=>c(null),className:"px-4 py-2 text-sm font-semibold text-dark-brown hover:bg-dark-brown/5 rounded-lg transition-colors",children:"Clear Selection"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Subcategory"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"})]})}),e.jsx("tbody",{children:_.expenses.sort((w,y)=>new Date(y.expense_date).getTime()-new Date(w.expense_date).getTime()).map((w,y)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${y%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:q(new Date(w.expense_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:w.subcategory||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-lg font-bold text-secondary",children:["â‚¹",w.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:w.users_paid_by?.name||w.users?.name||"Unknown"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:w.vendors?.name||"-"})]},w.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Subtotal:"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-2xl font-bold text-accent",children:["â‚¹",_.total.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:2})]})})]})})]})]})}function Pr({expenses:s,investments:n,allUsers:c}){const u=s.filter(j=>j.status==="approved"),l=n.filter(j=>j.status==="approved"),m={};c.forEach(j=>{m[j.id]={id:j.id,name:j.name,totalExpenses:0,totalInvestments:0,expenseCount:0,approvedCount:0,submittedCount:0,paymentModes:{},categories:{}}}),u.forEach(j=>{const _=j.paid_by||j.user_id;if(m[_]){m[_].totalExpenses+=j.amount,m[_].expenseCount+=1,j.status==="approved"&&(m[_].approvedCount+=1);const w=j.payment_mode||"unknown";m[_].paymentModes[w]=(m[_].paymentModes[w]||0)+1;const y=j.category;m[_].categories[y]=(m[_].categories[y]||0)+j.amount}}),s.forEach(j=>{const _=j.submitted_by;_&&m[_]&&(m[_].submittedCount+=1)}),l.forEach(j=>{const _=j.partner_id;m[_]&&(m[_].totalInvestments+=j.amount)});const p=Object.values(m).sort((j,_)=>_.totalInvestments-j.totalInvestments),x=p.map(j=>({name:j.name,Investment:j.totalInvestments,Expense:j.totalExpenses})),b=[...p].filter(j=>j.totalInvestments>0).sort((j,_)=>_.totalInvestments-j.totalInvestments).slice(0,5),f=[...p].filter(j=>j.totalExpenses>0).sort((j,_)=>_.totalExpenses-j.totalExpenses).slice(0,5),t=[...p].filter(j=>j.submittedCount>0).sort((j,_)=>_.approvedCount/_.submittedCount-j.approvedCount/j.submittedCount).slice(0,5),i=j=>j.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),a=j=>{const _=Object.entries(j);return _.length===0?"N/A":_.sort((w,y)=>y[1]-w[1])[0][0].toUpperCase()},k=j=>{const _=Object.entries(j);return _.length===0?"N/A":_.sort((w,y)=>y[1]-w[1])[0][0]},N=j=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[j]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(j=>{const _=j.totalInvestments-j.totalExpenses,w=j.submittedCount>0?j.approvedCount/j.submittedCount*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-lg",children:i(j.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:j.name}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[j.expenseCount," expenses â€¢ ",j.submittedCount," submitted"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-sage/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",j.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",j.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]}),e.jsxs("div",{className:`rounded-lg p-3 mb-4 ${_>=0?"bg-accent/10":"bg-soft-red/10"}`,children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Net Contribution"}),e.jsxs("p",{className:`text-xl font-bold ${_>=0?"text-accent":"text-soft-red"}`,children:[_>=0?"+":"","â‚¹",_.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Approval Rate"]}),e.jsxs("span",{className:"font-semibold text-sage",children:[w.toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4"}),"Payment Mode"]}),e.jsx("span",{className:"font-semibold text-primary",children:a(j.paymentModes)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"Top Category"]}),e.jsxs("span",{className:"font-semibold text-accent",children:[N(k(j.categories))," ",k(j.categories)]})]})]})]},j.id)})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Investment vs Expense Comparison"}),x.length>0?e.jsx(be,{width:"100%",height:400,children:e.jsxs(Ft,{data:x,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx(Le,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(je,{formatter:j=>`â‚¹${j.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ft,{}),e.jsx(xt,{dataKey:"Investment",fill:"#2D5016",radius:[8,8,0,0]}),e.jsx(xt,{dataKey:"Expense",fill:"#C17817",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[400px] flex items-center justify-center text-dark-brown/50",children:"No data available"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Ye,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Top Investors"})]}),e.jsx("div",{className:"space-y-3",children:b.length>0?b.map((j,_)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-accent/40",children:["#",_+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:i(j.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:j.name}),e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",j.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},j.id)):e.jsx("div",{className:"text-center py-8 text-dark-brown/50",children:e.jsx("p",{className:"text-sm",children:"No investments recorded yet"})})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Active Spenders"})]}),e.jsx("div",{className:"space-y-3",children:f.length>0?f.map((j,_)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-secondary/40",children:["#",_+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-secondary to-accent rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:i(j.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:j.name}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",j.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},j.id)):e.jsx("div",{className:"text-center py-8 text-dark-brown/50",children:e.jsx("p",{className:"text-sm",children:"No expenses recorded yet"})})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Best Approval Rate"})]}),e.jsx("div",{className:"space-y-3",children:t.length>0?t.map((j,_)=>{const w=j.approvedCount/j.submittedCount*100;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-sage/40",children:["#",_+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-sage to-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:i(j.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:j.name}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:[w.toFixed(0),"%"]})]})]},j.id)}):e.jsx("div",{className:"text-center py-8 text-dark-brown/50",children:e.jsx("p",{className:"text-sm",children:"No submissions recorded yet"})})})]})]})]})}function Ar({expenses:s,investments:n}){const[c,u]=o.useState(q(new Date,"yyyy-MM")),[l,m]=o.useState(!0),p=new Date(c+"-01"),x=us(p),b=fs(p),f=ct(p,1),t=us(f),i=fs(f),a=s.filter(S=>{const $=new Date(S.expense_date);return $>=x&&$<=b&&S.status==="approved"}),k=n.filter(S=>{const $=new Date(S.investment_date);return $>=x&&$<=b&&S.status==="approved"}),N=s.filter(S=>{const $=new Date(S.expense_date);return $>=t&&$<=i&&S.status==="approved"}),j=n.filter(S=>{const $=new Date(S.investment_date);return $>=t&&$<=i&&S.status==="approved"}),_=a.reduce((S,$)=>S+$.amount,0),w=k.reduce((S,$)=>S+$.amount,0),y=w-_,h=N.reduce((S,$)=>S+$.amount,0),d=j.reduce((S,$)=>S+$.amount,0),r=d-h,v=h>0?(_-h)/h*100:0,g=d>0?(w-d)/d*100:0,D=r!==0?(y-r)/Math.abs(r)*100:0,T=a.reduce((S,$)=>(S[$.category]||(S[$.category]={thisMonth:0,lastMonth:0}),S[$.category].thisMonth+=$.amount,S),{});N.forEach(S=>{T[S.category]||(T[S.category]={thisMonth:0,lastMonth:0}),T[S.category].lastMonth+=S.amount});const A=Object.entries(T).map(([S,$])=>{const L=$.lastMonth>0?($.thisMonth-$.lastMonth)/$.lastMonth*100:0;return{category:S,thisMonth:$.thisMonth,lastMonth:$.lastMonth,change:L,changeAmount:$.thisMonth-$.lastMonth}}).sort((S,$)=>$.thisMonth-S.thisMonth),U=pa({start:x,end:b}).map(S=>{const $=a.filter(z=>Zt(new Date(z.expense_date),S)),L=k.filter(z=>Zt(new Date(z.investment_date),S)),V=$.reduce((z,le)=>z+le.amount,0),F=L.reduce((z,le)=>z+le.amount,0);return{date:S,expenses:$,investments:L,expenseTotal:V,investmentTotal:F}}),O=[];for(let S=0;S<12;S++){const $=ct(new Date,S);O.push({value:q($,"yyyy-MM"),label:q($,"MMMM yyyy")})}const Y=()=>{alert("PDF generation feature coming soon!")},ee=()=>{alert("Excel export feature coming soon!")},te=()=>{alert("Email report feature coming soon!")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("select",{value:c,onChange:S=>u(S.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 font-semibold",children:O.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))}),e.jsx("button",{onClick:()=>u(q(new Date,"yyyy-MM")),className:"px-4 py-2 bg-primary/10 text-primary font-semibold rounded-xl hover:bg-primary/20 transition-colors",children:"Current Month"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:S=>m(S.target.checked),className:"w-4 h-4 rounded border-2 border-accent text-accent focus:ring-accent"}),e.jsx("span",{className:"text-sm font-medium text-dark-brown",children:"Compare with last month"})]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-2xl shadow-soft-lg p-8 border-2 border-accent/30",children:[e.jsx("h3",{className:"font-heading text-4xl font-bold text-primary mb-6",children:q(p,"MMMM yyyy")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Investments"}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-2",children:["â‚¹",w.toLocaleString("en-IN")]}),l&&e.jsxs("div",{className:`flex items-center gap-2 ${g>=0?"text-sage":"text-soft-red"}`,children:[g>=0?e.jsx(se,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[g>=0?"+":"",g.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",_.toLocaleString("en-IN")]}),l&&e.jsxs("div",{className:`flex items-center gap-2 ${v<=0?"text-sage":"text-soft-red"}`,children:[v>=0?e.jsx(se,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[v>=0?"+":"",v.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-xl p-6 ${y>=0?"ring-2 ring-accent":"ring-2 ring-soft-red"}`,children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Net Change"}),e.jsxs("p",{className:`text-3xl font-bold mb-2 ${y>=0?"text-accent":"text-soft-red"}`,children:[y>=0?"+":"","â‚¹",y.toLocaleString("en-IN")]}),l&&e.jsxs("div",{className:`flex items-center gap-2 ${D>=0?"text-sage":"text-soft-red"}`,children:[D>=0?e.jsx(se,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[D>=0?"+":"",D.toFixed(1),"% vs last month"]})]})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"This Month"}),l&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Last Month"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Change"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-dark-brown",children:"Trend"})]})]})}),e.jsx("tbody",{children:A.map((S,$)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${$%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:S.category}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-secondary",children:["â‚¹",S.thisMonth.toLocaleString("en-IN")]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right text-dark-brown",children:["â‚¹",S.lastMonth.toLocaleString("en-IN")]}),e.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${S.changeAmount>=0?"text-soft-red":"text-sage"}`,children:[S.changeAmount>=0?"+":"","â‚¹",S.changeAmount.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${S.change>0?"bg-soft-red/20 text-soft-red":S.change<0?"bg-sage/20 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:[S.change>0&&e.jsx(se,{className:"w-3 h-3"}),S.change<0&&e.jsx(we,{className:"w-3 h-3"}),S.change.toFixed(0),"%"]})})]})]},S.category))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-bold text-dark-brown",children:"Total"}),e.jsxs("td",{className:"px-4 py-3 text-right text-xl font-bold text-accent",children:["â‚¹",_.toLocaleString("en-IN")]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-dark-brown",children:["â‚¹",h.toLocaleString("en-IN")]}),e.jsx("td",{colSpan:2})]})]})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Detailed Daily Breakdown"}),e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Investments"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Expenses"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Net"})]})}),e.jsx("tbody",{children:U.map((S,$)=>{const L=S.investmentTotal-S.expenseTotal;return S.expenses.length>0||S.investments.length>0?e.jsxs("tr",{className:`border-b border-dark-brown/5 ${$%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:q(S.date,"EEE, MMM d")}),e.jsx("td",{className:"px-4 py-3 text-right text-sage font-semibold",children:S.investmentTotal>0?`â‚¹${S.investmentTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-secondary font-semibold",children:S.expenseTotal>0?`â‚¹${S.expenseTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:`px-4 py-3 text-right font-bold ${L>0?"text-accent":L<0?"text-soft-red":"text-dark-brown"}`,children:L!==0?`${L>0?"+":""}â‚¹${L.toLocaleString("en-IN")}`:"-"})]},S.date.toString()):null})})]})})]}),e.jsxs("div",{className:"bg-cream/50 rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Export Options"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(ae,{className:"w-5 h-5"}),"Download PDF Report"]}),e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export to Excel"]}),e.jsxs("button",{onClick:te,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-primary text-primary font-semibold rounded-xl hover:bg-primary hover:text-white transition-all duration-300",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Email Report"]})]})]})]})}function Ir({expenses:s,vendors:n}){const u=s.filter(i=>i.status==="approved"&&i.vendor_id).reduce((i,a)=>{const k=a.vendor_id,N=a.vendors;if(!N)return i;i[k]||(i[k]={id:k,name:N.name,category:N.category,totalSpent:0,transactionCount:0,lastTransactionDate:a.expense_date,transactions:[],categories:{}}),i[k].totalSpent+=a.amount,i[k].transactionCount+=1,i[k].transactions.push(a),new Date(a.expense_date)>new Date(i[k].lastTransactionDate)&&(i[k].lastTransactionDate=a.expense_date);const j=a.category;return i[k].categories[j]=(i[k].categories[j]||0)+a.amount,i},{}),l=Object.values(u).sort((i,a)=>a.totalSpent-i.totalSpent),p=l.slice(0,10).map(i=>({name:i.name,amount:i.totalSpent})),x=i=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[i]||"ðŸ’°",b=i=>i&&{supplier:"ðŸ­",service:"ðŸ”§",contractor:"ðŸ‘·",transport:"ðŸšš",retail:"ðŸª"}[i.toLowerCase()]||"ðŸª",f=i=>X(new Date,new Date(i)),t=l.reduce((i,a)=>i+a.totalSpent,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(i=>{const a=i.transactionCount>0?i.totalSpent/i.transactionCount:0,k=f(i.lastTransactionDate),N=t>0?i.totalSpent/t*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary to-sage rounded-lg flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-3xl",children:b(i.category)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:i.name}),e.jsx("p",{className:"text-xs text-dark-brown/60 capitalize",children:i.category||"General Vendor"})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",i.totalSpent.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[N.toFixed(1),"% of all vendor spending"]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:i.transactionCount})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Avg Transaction"}),e.jsxs("span",{className:"font-bold text-accent",children:["â‚¹",a.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),"Last Transaction"]}),e.jsxs("span",{className:`font-semibold ${k>60?"text-soft-red":"text-sage"}`,children:[k," days ago"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-2",children:"Primary Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(i.categories).sort((j,_)=>_[1]-j[1]).slice(0,3).map(([j,_])=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-accent/10 rounded-full text-xs font-semibold text-dark-brown",children:[x(j)," ",j]},j))})]})]},i.id)})}),p.length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Top 10 Vendors by Spending"}),e.jsx(be,{width:"100%",height:400,children:e.jsxs(Ft,{data:p,layout:"vertical",children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Le,{dataKey:"name",type:"category",width:150,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(je,{formatter:i=>`â‚¹${i.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(xt,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Zs,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Vendors"})]}),e.jsx("p",{className:"text-5xl font-bold text-accent mb-2",children:l.length}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Active vendors with transactions"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Spent"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-2",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Across all vendors"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Avg Transaction"})]}),e.jsxs("p",{className:"text-4xl font-bold text-sage mb-2",children:["â‚¹",l.length>0?(t/l.reduce((i,a)=>i+a.transactionCount,0)).toLocaleString("en-IN",{maximumFractionDigits:0}):"0"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per vendor transaction"})]})]}),l.filter(i=>f(i.lastTransactionDate)>90).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-2xl shadow-soft p-6 border-2 border-soft-red/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-soft-red/20 rounded-lg flex items-center justify-center",children:e.jsx(he,{className:"w-6 h-6 text-soft-red"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Inactive Vendors"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-4",children:"The following vendors haven't been used in over 90 days. Consider reviewing your vendor relationships."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:l.filter(i=>f(i.lastTransactionDate)>90).map(i=>{const a=f(i.lastTransactionDate);return e.jsxs("div",{className:"bg-white/60 rounded-lg p-4 border border-soft-red/20",children:[e.jsx("p",{className:"font-semibold text-primary mb-1",children:i.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Last used: ",q(new Date(i.lastTransactionDate),"MMM d, yyyy")]}),e.jsxs("p",{className:"text-xs text-soft-red font-semibold mt-1",children:[a," days ago"]})]},i.id)})})]})]})}function Fr(){const[s,n]=o.useState("overview"),[c,u]=o.useState([]),[l,m]=o.useState([]),[p,x]=o.useState([]),[b,f]=o.useState([]),[t,i]=o.useState(!0);o.useEffect(()=>{a()},[]);const a=async()=>{try{const[N,j,_,w]=await Promise.all([C.from("expenses").select(`
            *,
            users:user_id(name, email),
            users_paid_by:users!expenses_paid_by_fkey(name, email),
            users_submitted_by:users!expenses_submitted_by_fkey(name),
            users_approved_by:users!expenses_approved_by_fkey(name),
            vendors(id, name, category)
          `).order("expense_date",{ascending:!1}),C.from("investments").select(`
            *,
            users:partner_id(name, email),
            users_submitted_by:users!investments_submitted_by_fkey(name)
          `).order("investment_date",{ascending:!1}),C.from("vendors").select("*").order("name"),C.from("users").select("id, name, email").order("name")]);if(N.error)throw N.error;if(j.error)throw j.error;if(_.error)throw _.error;if(w.error)throw w.error;u(N.data||[]),m(j.data||[]),x(_.data||[]),f(w.data||[])}catch(N){console.error("Error fetching data:",N)}finally{i(!1)}},k=[{id:"overview",name:"Overview",icon:se},{id:"category",name:"Category Analysis",icon:za},{id:"partner",name:"Partner Analysis",icon:ge},{id:"monthly",name:"Monthly Reports",icon:De},{id:"vendor",name:"Vendor Analysis",icon:Zs}];return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Financial Reports"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Comprehensive analysis of investments, expenses, and financial trends"})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-8 inline-flex gap-2 flex-wrap",children:k.map(N=>{const j=N.icon;return e.jsxs("button",{onClick:()=>n(N.id),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${s===N.id?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(j,{className:"w-5 h-5"}),N.name]},N.id)})}),t?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading reports..."})}):e.jsxs(e.Fragment,{children:[s==="overview"&&e.jsx(Mr,{expenses:c,investments:l,vendors:p}),s==="category"&&e.jsx(Er,{expenses:c}),s==="partner"&&e.jsx(Pr,{expenses:c,investments:l,allUsers:b}),s==="monthly"&&e.jsx(Ar,{expenses:c,investments:l}),s==="vendor"&&e.jsx(Ir,{expenses:c,vendors:p})]})]})})]})}const Tr=["Initial Capital","Product Development","Raw Material Purchase","Equipment Purchase","Marketing Budget","Working Capital","Infrastructure","Other"];function Lr({isOpen:s,onClose:n,onSuccess:c,preselectedPartnerId:u}){const{user:l}=H(),[m,p]=o.useState(!1),[x,b]=o.useState([]),[f,t]=o.useState(""),[i,a]=o.useState(!1),[k,N]=o.useState({partnerId:u||"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null}),j=l?.role==="admin";o.useEffect(()=>{s&&_()},[s]),o.useEffect(()=>{u&&N(g=>({...g,partnerId:u}))},[u]);const _=async()=>{try{const{data:g,error:D}=await C.from("users").select("id, name, email").order("name");if(D)throw D;b(g||[])}catch(g){console.error("Error fetching partners:",g)}},w=g=>{const D=g.target.files?.[0];if(D){if(D.size>10*1024*1024){alert("File size must be less than 10MB");return}N({...k,paymentProofFile:D})}},y=async g=>{try{const D=g.name.split(".").pop(),A=`payment-proofs/${`${Math.random()}.${D}`}`,{error:P}=await C.storage.from("investment-docs").upload(A,g);if(P)throw P;const{data:U}=C.storage.from("investment-docs").getPublicUrl(A);return U.publicUrl}catch(D){return console.error("Error uploading file:",D),null}},h=async g=>{if(g.preventDefault(),!k.partnerId||!k.amount||!k.purpose){alert("Please fill in all required fields");return}const D=parseFloat(k.amount);if(isNaN(D)||D<=0){alert("Please enter a valid positive amount");return}p(!0);try{let T=null;k.paymentProofFile&&(T=await y(k.paymentProofFile));const A={partner_id:k.partnerId,amount:D,investment_date:k.investmentDate,purpose:k.purpose,notes:k.notes||null,payment_proof_url:T,status:"pending",submitted_by:l?.id},{error:P}=await C.from("investments").insert([A]);if(P)throw P;const U=x.find(O=>O.id===k.partnerId);await C.from("activity_log").insert({user_id:l?.id,activity_type:"investment_added",description:`${l?.name} recorded investment of â‚¹${D.toLocaleString("en-IN")} for ${U?.name}`}),c(),n(),d()}catch(T){console.error("Error adding investment:",T),alert("Failed to add investment. Please try again.")}finally{p(!1)}},d=()=>{N({partnerId:"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null}),t("")},r=x.filter(g=>g.name.toLowerCase().includes(f.toLowerCase())||g.email.toLowerCase().includes(f.toLowerCase())),v=x.find(g=>g.id===k.partnerId);return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-3xl font-bold text-white",children:"Record Investment"}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Add a new partner investment to the records"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]})}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Partner ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:v?v.name:f,onChange:g=>{t(g.target.value),a(!0),N({...k,partnerId:""})},onFocus:()=>a(!0),placeholder:"Search for a partner...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),i&&!v&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border-2 border-dark-brown/10 rounded-xl shadow-soft-lg max-h-60 overflow-y-auto",children:r.length>0?r.map(g=>e.jsxs("button",{type:"button",onClick:()=>{N({...k,partnerId:g.id}),t(""),a(!1)},className:"w-full px-4 py-3 text-left hover:bg-accent/10 transition-colors border-b border-dark-brown/5 last:border-0",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:g.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:g.email})]},g.id)):e.jsx("p",{className:"px-4 py-3 text-dark-brown/50",children:"No partners found"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"number",value:k.amount,onChange:g=>N({...k,amount:g.target.value}),placeholder:"0",step:"0.01",min:"0",required:!0,className:"w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-dark-brown/40 text-sm",children:"INR"})]}),k.amount&&!isNaN(parseFloat(k.amount))&&e.jsxs("p",{className:"mt-2 text-sm text-dark-brown/60",children:["â‚¹",parseFloat(k.amount).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"date",value:k.investmentDate,onChange:g=>N({...k,investmentDate:g.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purpose / Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsxs("select",{value:k.purpose,onChange:g=>N({...k,purpose:g.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 appearance-none",children:[e.jsx("option",{value:"",children:"Select a purpose"}),Tr.map(g=>e.jsx("option",{value:g,children:g},g))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Proof (Optional)"}),e.jsxs("div",{className:"border-2 border-dashed border-dark-brown/20 rounded-xl p-6 hover:border-accent transition-colors",children:[e.jsx("input",{type:"file",id:"payment-proof",accept:"image/*,.pdf",onChange:w,className:"hidden"}),e.jsxs("label",{htmlFor:"payment-proof",className:"flex flex-col items-center cursor-pointer",children:[e.jsx(Be,{className:"w-12 h-12 text-accent mb-3"}),k.paymentProofFile?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-sage",children:k.paymentProofFile.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(k.paymentProofFile.size/1024/1024).toFixed(2)," MB"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Upload Receipt or Bank Statement"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"PNG, JPG or PDF (max 10MB)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-4 top-4 w-5 h-5 text-accent"}),e.jsx("textarea",{value:k.notes,onChange:g=>N({...k,notes:g.target.value}),placeholder:"Add any additional details...",maxLength:500,rows:3,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 resize-none"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[k.notes.length,"/500 characters"]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-xl border border-blue-200",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-5 h-5 text-blue-600"})}),e.jsx("p",{className:"text-sm text-dark-brown",children:j?"This investment will require your approval before being recorded.":"This investment will be submitted for admin approval."})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-dark-brown/10",children:[e.jsx("button",{type:"button",onClick:n,disabled:m,className:"flex-1 px-6 py-3 border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m,className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:m?"Recording...":e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-5 h-5"}),"Record Investment"]})})]})]})]})]}):null}function $r({partner:s,investments:n,totalInvestment:c,percentageOfTotal:u,isTopInvestor:l,onViewAll:m,onAddInvestment:p}){const x=t=>t.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2),b=n.sort((t,i)=>new Date(i.investment_date).getTime()-new Date(t.investment_date).getTime()).slice(0,3),f=t=>({"Initial Capital":"ðŸ’°","Product Development":"ðŸ§ª","Raw Material Purchase":"ðŸŒ¿","Equipment Purchase":"ðŸ”§","Marketing Budget":"ðŸ“¢","Working Capital":"ðŸ’¼",Infrastructure:"ðŸ¢",Other:"ðŸ“Š"})[t]||"ðŸ’°";return e.jsxs("div",{className:`relative bg-gradient-to-br from-cream via-white to-sage/10 rounded-2xl shadow-soft hover:shadow-soft-lg transition-all duration-300 overflow-hidden ${l?"border-4 border-accent":"border-2 border-dark-brown/10"}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),l&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsxs("div",{className:"bg-accent text-white px-3 py-1.5 rounded-full flex items-center gap-2 shadow-soft",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold",children:"Top Investor"})]})}),e.jsxs("div",{className:"relative p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-xl",children:x(s.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary truncate",children:s.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 truncate",children:s.email})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-2",children:["â‚¹",c.toLocaleString("en-IN")]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-brown/70",children:[n.length," ",n.length===1?"investment":"investments"]}),e.jsxs("span",{className:"font-semibold text-secondary",children:[u.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-accent/10 to-secondary/10 rounded-xl p-1",children:e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary h-3 rounded-lg transition-all duration-500 shadow-soft",style:{width:`${Math.min(u,100)}%`}})}),b.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 uppercase tracking-wide",children:"Recent Investments"}),b.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 backdrop-blur-sm rounded-lg border border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsx("span",{className:"text-2xl",children:f(t.purpose)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown truncate",children:t.purpose}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:q(new Date(t.investment_date),"MMM d, yyyy")})]}),e.jsxs("p",{className:"text-sm font-bold text-secondary",children:["â‚¹",t.amount.toLocaleString("en-IN")]})]},t.id))]}):e.jsxs("div",{className:"text-center py-6 bg-white/60 backdrop-blur-sm rounded-lg border border-dashed border-dark-brown/20",children:[e.jsx("p",{className:"text-sm text-dark-brown/50",children:"No investments yet"}),e.jsx("p",{className:"text-xs text-dark-brown/40 mt-1",children:"Click + to add first investment"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs("button",{onClick:m,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300",children:[e.jsx(Re,{className:"w-4 h-4"}),"View All"]}),e.jsx("button",{onClick:p,className:"flex items-center justify-center px-4 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:e.jsx(G,{className:"w-5 h-5"})})]})]})]})}function qr({isOpen:s,onClose:n,partner:c,investments:u}){if(!s)return null;const l=u.reduce((x,b)=>x+b.amount,0),m=x=>{switch(x){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},p=()=>{alert("PDF generation feature coming soon!")};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"font-heading text-3xl font-bold text-white",children:[c.name,"'s Investment History"]}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Complete record of all investments"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"p-6 bg-cream/50 border-b border-dark-brown/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-4xl font-bold text-accent",children:["â‚¹",l.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 mt-1",children:["Across ",u.length," ",u.length===1?"investment":"investments"]})]}),e.jsxs("button",{onClick:p,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300 shadow-soft",children:[e.jsx(ke,{className:"w-5 h-5"}),"Download Statement"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:u.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-dark-brown/50",children:"No investments recorded yet"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),e.jsx("th",{className:"px-4 py-4 text-center text-sm font-semibold text-dark-brown",children:"Proof"})]})}),e.jsx("tbody",{children:u.sort((x,b)=>new Date(b.investment_date).getTime()-new Date(x.investment_date).getTime()).map((x,b)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${b%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:q(new Date(x.investment_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:x.purpose}),x.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1 line-clamp-2",children:x.notes})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",x.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:m(x.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm text-dark-brown",children:x.users_submitted_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:x.payment_proof_url?e.jsx("a",{href:x.payment_proof_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex p-2 hover:bg-primary/10 rounded-lg transition-colors",title:"View proof",children:e.jsx(Re,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No proof"})})]},x.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-4 text-right font-bold text-dark-brown",children:"Total:"}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",l.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:3})]})})]})})}),e.jsx("div",{className:"p-4 bg-cream/50 border-t border-dark-brown/10 flex justify-end",children:e.jsx("button",{onClick:n,className:"px-6 py-3 bg-white border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300",children:"Close"})})]})]})}const Cs=["#B8860B","#2D5016","#C17817","#8B4513","#D4AF37","#CD853F","#DAA520"];function Rr({investments:s}){const n=s.filter(r=>r.status==="approved"),c=n.reduce((r,v)=>{const g=v.users?.name||"Unknown";return r[g]||(r[g]=0),r[g]+=v.amount,r},{}),u=Object.entries(c).map(([r,v])=>({name:r,value:Number(v)})),l=n.reduce((r,v)=>(r[v.purpose]||(r[v.purpose]=0),r[v.purpose]+=v.amount,r),{}),m=Object.entries(l).map(([r,v])=>({name:r,value:Number(v)})).sort((r,v)=>v.value-r.value),p=n.reduce((r,v)=>{const g=new Date(v.investment_date),D=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}`;return r[D]||(r[D]=0),r[D]+=v.amount,r},{}),x=Object.keys(p).sort();let b=0;const f=x.map(r=>{b+=p[r];const[v,g]=r.split("-");return{month:new Date(parseInt(v),parseInt(g)-1).toLocaleDateString("en-US",{month:"short",year:"2-digit"}),monthly:p[r],cumulative:b}}),t=n.reduce((r,v)=>r+v.amount,0),i=new Set(n.map(r=>r.partner_id)).size,a=i>0?t/i:0,k=new Date().getMonth(),N=new Date().getFullYear(),j=new Date(N,k-1),_=n.filter(r=>{const v=new Date(r.investment_date);return v.getMonth()===k&&v.getFullYear()===N}),w=n.filter(r=>{const v=new Date(r.investment_date);return v.getMonth()===j.getMonth()&&v.getFullYear()===j.getFullYear()}),y=_.reduce((r,v)=>r+v.amount,0),h=w.reduce((r,v)=>r+v.amount,0),d=h>0?(y-h)/h*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-xs font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-1",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Investment"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(ge,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-3xl font-bold text-sage mb-1",children:i}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Partners Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(Ja,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",a.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-6 border-2 border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Growth"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${d>=0?"text-sage":"text-soft-red"}`,children:[d>=0?"+":"",d.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"This Month"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Contributions"}),u.length>0?e.jsx(be,{width:"100%",height:300,children:e.jsxs(Pt,{children:[e.jsx(At,{data:u,cx:"50%",cy:"50%",labelLine:!1,label:({name:r,percent:v})=>`${r} (${(v*100).toFixed(0)}%)`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:u.map((r,v)=>e.jsx(It,{fill:Cs[v%Cs.length]},`cell-${v}`))}),e.jsx(je,{formatter:r=>`â‚¹${r.toLocaleString("en-IN")}`})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment by Purpose"}),m.length>0?e.jsx(be,{width:"100%",height:300,children:e.jsxs(Ft,{data:m,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx(Le,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(je,{formatter:r=>`â‚¹${r.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(xt,{dataKey:"value",fill:"#B8860B",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment Timeline"}),f.length>0?e.jsx(be,{width:"100%",height:350,children:e.jsxs(Et,{data:f,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Le,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(je,{formatter:r=>`â‚¹${r.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(ft,{}),e.jsx($e,{type:"monotone",dataKey:"monthly",stroke:"#C17817",strokeWidth:2,name:"Monthly Investment",dot:{fill:"#C17817",r:4}}),e.jsx($e,{type:"monotone",dataKey:"cumulative",stroke:"#2D5016",strokeWidth:3,name:"Cumulative Investment",dot:{fill:"#2D5016",r:5}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),t>=1e5&&e.jsxs("div",{className:"bg-gradient-to-r from-accent to-secondary rounded-2xl shadow-soft-lg p-8 text-center",children:[e.jsx("p",{className:"text-5xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"font-heading text-3xl font-bold text-white mb-2",children:"Milestone Achieved!"}),e.jsxs("p",{className:"text-white/90 text-lg",children:["Total investments have crossed â‚¹",(Math.floor(t/1e5)*1e5/1e3).toFixed(0),"K! Amazing progress toward building Organitto together."]})]})]})}function Ur(){const{user:s}=H(),[n,c]=o.useState([]),[u,l]=o.useState([]),[m,p]=o.useState(!0),[x,b]=o.useState("by_partner"),[f,t]=o.useState(!1),[i,a]=o.useState(),[k,N]=o.useState(!1),[j,_]=o.useState(null),[w,y]=o.useState(!1),[h,d]=o.useState("approve"),[r,v]=o.useState(null),[g,D]=o.useState(null),T=s?.role==="admin";o.useEffect(()=>{P(),A();const F=C.channel("investments-changes").on("postgres_changes",{event:"*",schema:"public",table:"investments"},()=>{P()}).subscribe();return()=>{C.removeChannel(F)}},[]);const A=async()=>{try{const{data:F,error:z}=await C.from("users").select("id, name, email").order("name");if(z)throw z;l(F||[])}catch(F){console.error("Error fetching users:",F)}},P=async()=>{try{const{data:F,error:z}=await C.from("investments").select(`
          *,
          users:partner_id(name, email),
          users_submitted_by:users!investments_submitted_by_fkey(name),
          users_approved_by:users!investments_approved_by_fkey(name)
        `).order("investment_date",{ascending:!1});if(z)throw z;c(F||[])}catch(F){console.error("Error fetching investments:",F)}finally{p(!1)}},U=F=>{v(F),d("approve"),y(!0)},O=F=>{v(F),d("reject"),y(!0)},Y=async(F,z)=>{if(!(!r||!s)){D(r.id);try{const le={status:h==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};h==="reject"&&z&&(le.rejection_reason=z);const{error:me}=await C.from("investments").update(le).eq("id",r.id);if(me)throw me;await C.from("activity_log").insert({user_id:s.id,activity_type:h==="approve"?"investment_approved":"investment_rejected",description:`${s.name} ${h==="approve"?"approved":"rejected"} investment: â‚¹${r.amount.toLocaleString("en-IN")} from ${r.users?.name}`}),await P(),y(!1),v(null)}catch(le){console.error("Error processing approval:",le),alert("Failed to process approval. Please try again.")}finally{D(null)}}},ee=async F=>{if(confirm("Are you sure you want to delete this investment? This action cannot be undone."))try{const{error:z}=await C.from("investments").delete().eq("id",F);if(z)throw z;await P()}catch(z){console.error("Error deleting investment:",z),alert("Failed to delete investment. Please try again.")}},te=u.map(F=>{const z=n.filter(me=>me.partner_id===F.id),le=z.reduce((me,_e)=>me+_e.amount,0);return{partner:{id:F.id,name:F.name,email:F.email},investments:z,total:le}});te.sort((F,z)=>z.total-F.total);const S=n.filter(F=>F.status==="approved").reduce((F,z)=>F+z.amount,0);te.filter(F=>F.investments.some(z=>z.status==="approved")).length;const $=u.length>0?S/u.length:0,L=te.length>0?te[0].partner.id:null,V=F=>{switch(F){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Investment Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track partner investments and grow together"})]}),e.jsxs("button",{onClick:()=>{a(void 0),t(!0)},className:"flex items-center gap-2 px-6 py-4 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Investment"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-4xl font-bold text-accent mb-1",children:["â‚¹",S.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Amount Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(ge,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage mb-1",children:u.length}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Partners"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(mt,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-sm font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-1",children:["â‚¹",$.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-6 inline-flex gap-2",children:[e.jsxs("button",{onClick:()=>b("by_partner"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${x==="by_partner"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(ge,{className:"w-5 h-5"}),"By Partner"]}),e.jsxs("button",{onClick:()=>b("all_investments"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${x==="all_investments"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"All Investments"]}),e.jsxs("button",{onClick:()=>b("statistics"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${x==="statistics"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(mt,{className:"w-5 h-5"}),"Statistics"]})]}),m?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading investments..."})}):x==="by_partner"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.length===0?e.jsx("div",{className:"col-span-full text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No partners found"})}):te.map(F=>e.jsx($r,{partner:F.partner,investments:F.investments,totalInvestment:F.total,percentageOfTotal:S>0?F.total/S*100:0,isTopInvestor:F.partner.id===L&&F.total>0,onViewAll:()=>{_(F),N(!0)},onAddInvestment:()=>{a(F.partner.id),t(!0)}},F.partner.id))}):x==="all_investments"?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Partner"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),T&&e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((F,z)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${z%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:q(new Date(F.investment_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:F.users?.name}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:F.users?.email})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",F.amount.toLocaleString("en-IN")]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:F.purpose}),F.notes&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1 line-clamp-1",children:F.notes})]}),e.jsx("td",{className:"px-4 py-4",children:V(F.status)}),e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:F.users_submitted_by?.name||"Unknown"}),T&&e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[F.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>U(F),disabled:g===F.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(Q,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:()=>O(F),disabled:g===F.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Me,{className:"w-4 h-4 text-soft-red"})})]}),e.jsx("button",{onClick:()=>ee(F.id),className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(ie,{className:"w-4 h-4 text-soft-red"})})]})})]},F.id))})]})})}):e.jsx(Rr,{investments:n})]})}),f&&e.jsx(Lr,{isOpen:f,onClose:()=>{t(!1),a(void 0)},onSuccess:P,preselectedPartnerId:i}),k&&j&&e.jsx(qr,{isOpen:k,onClose:()=>{N(!1),_(null)},partner:j.partner,investments:j.investments}),w&&r&&e.jsx(sa,{isOpen:w,onClose:()=>{y(!1),v(null)},onConfirm:Y,type:h,expense:{category:r.purpose,subcategory:r.notes,amount:r.amount,expense_date:r.investment_date,payment_mode:"Investment"},loading:g===r.id})]})}function zr({product:s,users:n,onDragStart:c,onEdit:u,onMoveNext:l}){const m=de(),p=X(new Date,new Date(s.stage_entered_at)),x=()=>{const a={high:{color:"bg-soft-red",dot:"ðŸ”´"},medium:{color:"bg-accent",dot:"ðŸŸ¡"},low:{color:"bg-sage",dot:"ðŸŸ¢"}};return a[s.priority]||a.medium},b=a=>({Skincare:"âœ¨","Hair Care":"ðŸ’†","Wellness & Supplements":"ðŸŒ¿","Oral Care":"ðŸ¦·","Personal Care":"ðŸ§´","Home Care":"ðŸ ",Other:"ðŸ“¦"})[a]||"ðŸ“¦",f=n.filter(a=>s.assigned_partners.includes(a.id)),t=a=>a.split(" ").map(k=>k[0]).join("").toUpperCase().slice(0,2),i=x();return e.jsxs("div",{draggable:!0,onDragStart:()=>c(s),className:"bg-white rounded-xl shadow-soft p-4 mb-3 cursor-move hover:shadow-soft-lg transition-all duration-300 border-2 border-transparent hover:border-accent/30 relative group",children:[e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${i.color} text-white`,children:[i.dot," ",s.priority.toUpperCase()]})}),s.image_url?e.jsx("div",{className:"w-full h-32 bg-cream/50 rounded-lg mb-3 overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-32 bg-gradient-to-br from-sage/20 to-accent/20 rounded-lg mb-3 flex items-center justify-center",children:e.jsx("span",{className:"text-5xl",children:b(s.category)})}),e.jsx("h4",{className:"font-heading text-lg font-bold text-primary mb-2 pr-16",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:s.category}),s.product_type&&e.jsx("span",{className:"text-xs px-2 py-1 bg-secondary/10 text-secondary rounded-full",children:s.product_type})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-dark-brown/60 font-semibold",children:"Stage Progress"}),e.jsxs("span",{className:"text-xs font-bold text-accent",children:[s.progress,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60 mb-3",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsxs("span",{className:p>30?"text-soft-red font-semibold":"",children:[p," days in stage",p>30&&" âš ï¸"]})]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-3",children:[f.slice(0,3).map((a,k)=>e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent to-secondary flex items-center justify-center text-white text-xs font-bold border-2 border-white shadow-sm",style:{marginLeft:k>0?"-8px":"0",zIndex:3-k},title:a.name,children:t(a.name)},a.id)),f.length>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-dark-brown/20 flex items-center justify-center text-xs font-bold text-dark-brown ml-1",children:["+",f.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-dark-brown/60 mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3"}),"0/0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($t,{className:"w-3 h-3"}),"0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(os,{className:"w-3 h-3"}),"0"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>m(`/products/${s.id}`),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(Re,{className:"w-4 h-4"}),"View"]}),e.jsxs("button",{onClick:()=>u(s),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),e.jsx("button",{onClick:()=>l(s),className:"flex items-center justify-center gap-1 px-3 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg transition-colors text-xs font-semibold",children:e.jsx(ss,{className:"w-4 h-4"})})]})]})}const Br=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],Or=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Vr=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function Hr({isOpen:s,onClose:n,onSubmit:c,users:u}){const[l,m]=o.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),[p,x]=o.useState(!1);if(!s)return null;const b=async t=>{t.preventDefault(),x(!0);try{await c(l),m({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),n()}catch(i){console.error("Error creating product:",i)}finally{x(!1)}},f=t=>{m(i=>({...i,assigned_partners:i.assigned_partners.includes(t)?i.assigned_partners.filter(a=>a!==t):[...i.assigned_partners,t]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Add New Product"}),e.jsx("button",{onClick:n,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:l.name,onChange:t=>m({...l,name:t.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:l.category,onChange:t=>m({...l,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),Br.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:l.product_type,onChange:t=>m({...l,product_type:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Or.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Initial Stage"}),e.jsx("select",{value:l.current_stage,onChange:t=>m({...l,current_stage:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Vr.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:l.target_launch_date,onChange:t=>m({...l,target_launch_date:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",bgColor:"bg-red-500",hoverColor:"hover:bg-red-600",borderColor:"border-red-500"},{value:"medium",label:"Medium",bgColor:"bg-orange-500",hoverColor:"hover:bg-orange-600",borderColor:"border-orange-500"},{value:"low",label:"Low",bgColor:"bg-green-500",hoverColor:"hover:bg-green-600",borderColor:"border-green-500"}].map(t=>e.jsxs("label",{className:`flex-1 cursor-pointer px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 border-2 ${l.priority===t.value?`${t.bgColor} ${t.borderColor} text-white shadow-md`:`bg-white ${t.borderColor} border-opacity-30 text-dark-brown hover:border-opacity-100 hover:shadow-sm`}`,children:[e.jsx("input",{type:"radio",name:"priority",value:t.value,checked:l.priority===t.value,onChange:i=>m({...l,priority:i.target.value}),className:"sr-only"}),t.label]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:l.description,onChange:t=>m({...l,description:t.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:u.map(t=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${l.assigned_partners.includes(t.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:l.assigned_partners.includes(t.id),onChange:()=>f(t.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:t.name})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:l.image_url,onChange:t=>m({...l,image_url:t.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Be,{className:"w-5 h-5"}),"Upload"]})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Or enter a direct image URL"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition-colors border-2 border-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"flex-1 px-6 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold rounded-xl hover:from-emerald-700 hover:to-teal-700 shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-lg",children:p?"Creating...":"Create Product"})]})]})]})})}const Wr=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],Gr=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Qr=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function aa({isOpen:s,onClose:n,onSubmit:c,product:u,users:l}){const[m,p]=o.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:"",progress:0}),[x,b]=o.useState(!1);if(o.useEffect(()=>{u&&p({name:u.name||"",category:u.category||"",product_type:u.product_type||"",current_stage:u.current_stage||"idea",priority:u.priority||"medium",target_launch_date:u.target_launch_date||"",description:u.description||"",assigned_partners:u.assigned_partners||[],image_url:u.image_url||"",progress:u.progress||0})},[u]),!s)return null;const f=async i=>{i.preventDefault(),b(!0);try{await c(u.id,m),n()}catch(a){console.error("Error updating product:",a)}finally{b(!1)}},t=i=>{p(a=>({...a,assigned_partners:a.assigned_partners.includes(i)?a.assigned_partners.filter(k=>k!==i):[...a.assigned_partners,i]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Edit Product"}),e.jsx("button",{onClick:n,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:m.name,onChange:i=>p({...m,name:i.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:m.category,onChange:i=>p({...m,category:i.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),Wr.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:m.product_type,onChange:i=>p({...m,product_type:i.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Gr.map(i=>e.jsx("option",{value:i,children:i},i))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Stage"}),e.jsx("select",{value:m.current_stage,onChange:i=>p({...m,current_stage:i.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Qr.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:m.target_launch_date,onChange:i=>p({...m,target_launch_date:i.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Progress"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:m.progress,onChange:i=>p({...m,progress:parseInt(i.target.value)}),className:"flex-1"}),e.jsxs("span",{className:"text-2xl font-bold text-accent min-w-[60px]",children:[m.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${m.progress}%`}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",color:"bg-soft-red"},{value:"medium",label:"Medium",color:"bg-accent"},{value:"low",label:"Low",color:"bg-sage"}].map(i=>e.jsxs("label",{className:`flex-1 cursor-pointer ${m.priority===i.value?`${i.color} text-white`:"bg-dark-brown/5 text-dark-brown"} px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 hover:scale-105`,children:[e.jsx("input",{type:"radio",name:"priority",value:i.value,checked:m.priority===i.value,onChange:a=>p({...m,priority:a.target.value}),className:"sr-only"}),i.label]},i.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:m.description,onChange:i=>p({...m,description:i.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:l.map(i=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${m.assigned_partners.includes(i.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:m.assigned_partners.includes(i.id),onChange:()=>t(i.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:i.name})]},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:m.image_url,onChange:i=>p({...m,image_url:i.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Be,{className:"w-5 h-5"}),"Upload"]})]}),m.image_url&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:m.image_url,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg border-2 border-dark-brown/10"})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Updating...":"Update Product"})]})]})]})})}const it=[{id:"idea",name:"Idea",icon:"ðŸŒ±",gradient:"from-sage/30 to-sage/10"},{id:"research",name:"Research",icon:"ðŸ”",gradient:"from-sage/25 to-sage/10"},{id:"formula",name:"Formula Creation",icon:"âš—ï¸",gradient:"from-sage/20 to-accent/10"},{id:"testing",name:"Testing",icon:"ðŸ§ª",gradient:"from-accent/30 to-accent/10"},{id:"packaging",name:"Packaging Design",icon:"ðŸ“¦",gradient:"from-accent/25 to-accent/10"},{id:"printing",name:"Printing",icon:"ðŸ–¨ï¸",gradient:"from-accent/20 to-secondary/10"},{id:"production",name:"Production",icon:"ðŸ­",gradient:"from-secondary/30 to-secondary/10"},{id:"ready",name:"Ready to Launch",icon:"ðŸš€",gradient:"from-secondary/25 to-secondary/10"},{id:"launched",name:"Launched",icon:"âœ…",gradient:"from-primary/40 to-primary/20"}];function Yr(){const{user:s}=H(),n=de(),[c,u]=o.useState("board"),[l,m]=o.useState(!1),[p,x]=o.useState(!1),[b,f]=o.useState(null),[t,i]=o.useState([]),[a,k]=o.useState([]),[N,j]=o.useState(!0),[_,w]=o.useState(null),[y,h]=o.useState("all"),[d,r]=o.useState("");o.useEffect(()=>{v()},[]);const v=async()=>{try{const[L,V]=await Promise.all([C.from("products").select("*").order("created_at",{ascending:!1}),C.from("users").select("id, name, email").order("name")]);if(L.error)throw L.error;if(V.error)throw V.error;i(L.data||[]),k(V.data||[])}catch(L){console.error("Error fetching data:",L)}finally{j(!1)}},g=async L=>{try{const{data:V,error:F}=await C.from("products").insert([{...L,created_by:s?.id,stage_entered_at:new Date().toISOString()}]).select().single();if(F)throw F;await C.from("product_stage_history").insert([{product_id:V.id,stage:L.current_stage,moved_by:s?.id,notes:"Product created"}]),await v()}catch(V){throw console.error("Error creating product:",V),V}},D=L=>{w(L)},T=L=>{L.preventDefault()},A=async(L,V)=>{if(L.preventDefault(),!_||_.current_stage===V){w(null);return}if(V==="launched"&&!window.confirm(`Are you sure you want to launch "${_.name}"? This marks it as complete.`)){w(null);return}try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",_.id).is("exited_at",null),await C.from("products").update({current_stage:V,stage_entered_at:new Date().toISOString(),progress:V==="launched"?100:_.progress}).eq("id",_.id),await C.from("product_stage_history").insert([{product_id:_.id,stage:V,moved_by:s?.id}]),await v()}catch(F){console.error("Error moving product:",F)}finally{w(null)}},P=async L=>{const V=it.findIndex(z=>z.id===L.current_stage);if(V===-1||V===it.length-1)return;const F=it[V+1].id;await A({preventDefault:()=>{}},F)},U=L=>{f(L),x(!0)},O=async(L,V)=>{try{const{error:F}=await C.from("products").update({...V,updated_at:new Date().toISOString()}).eq("id",L);if(F)throw F;await C.from("activity_log").insert({user_id:s?.id,activity_type:"product_updated",description:`${s?.name} updated product: ${V.name}`}),await v()}catch(F){throw console.error("Error updating product:",F),F}},Y=t.filter(L=>!(y!=="all"&&L.priority!==y||d&&!L.name.toLowerCase().includes(d.toLowerCase()))),ee=t.length,te=t.filter(L=>L.current_stage!=="launched").length,S=t.filter(L=>L.current_stage==="launched").length,$=t.filter(L=>L.priority==="high").length;return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("button",{onClick:()=>m(!0),className:"fixed bottom-8 right-8 w-16 h-16 bg-gradient-to-r from-secondary to-accent text-white rounded-full shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-110 flex items-center justify-center z-40 group",children:e.jsx(G,{className:"w-8 h-8 group-hover:rotate-90 transition-transform duration-300"})}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Product Development Pipeline"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track your Ayurvedic products from concept to launch"})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-3 px-6 py-4 bg-accent text-white rounded-xl font-bold text-lg shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-105 hover:bg-accent/90",children:[e.jsx(G,{className:"w-6 h-6"}),"Add New Product"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ne,{className:"w-6 h-6 text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Products"})]}),e.jsx("p",{className:"text-4xl font-bold text-primary",children:ee})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(he,{className:"w-6 h-6 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"In Development"})]}),e.jsx("p",{className:"text-4xl font-bold text-accent",children:te})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ha,{className:"w-6 h-6 text-sage"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Launched"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage",children:S})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/20 to-soft-red/10 rounded-xl p-6 border-2 border-soft-red/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Q,{className:"w-6 h-6 text-soft-red"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"High Priority"})]}),e.jsx("p",{className:"text-4xl font-bold text-soft-red",children:$})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-4 mb-8 flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>u("board"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${c==="board"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(Ra,{className:"w-5 h-5"}),"Board View"]}),e.jsxs("button",{onClick:()=>u("list"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${c==="list"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"List View"]})]}),e.jsxs("div",{className:"flex gap-3 flex-1 max-w-md",children:[e.jsx("input",{type:"text",placeholder:"Search products...",value:d,onChange:L=>r(L.target.value),className:"flex-1 px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("select",{value:y,onChange:L=>h(L.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"low",children:"Low Priority"})]})]})]}),N?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading products..."})}):c==="board"?e.jsx("div",{className:"overflow-x-auto pb-4",children:e.jsx("div",{className:"flex gap-4 min-w-max",children:it.map(L=>{const V=Y.filter(F=>F.current_stage===L.id);return e.jsxs("div",{onDragOver:T,onDrop:F=>A(F,L.id),className:`w-80 flex-shrink-0 bg-gradient-to-b ${L.gradient} rounded-2xl p-4 border-2 border-dark-brown/10 shadow-soft`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-heading text-lg font-bold text-primary flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:L.icon}),L.name]}),e.jsx("span",{className:"bg-white px-3 py-1 rounded-full text-sm font-bold text-primary shadow-sm",children:V.length})]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-400px)] overflow-y-auto pr-2",children:V.length===0?e.jsx("div",{className:"text-center py-8 text-dark-brown/40 text-sm",children:"No products in this stage"}):V.map(F=>e.jsx(zr,{product:F,users:a,onDragStart:D,onEdit:U,onMoveNext:P},F.id))})]},L.id)})})}):e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Priority"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Progress"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Days in Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Target Launch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:Y.map((L,V)=>{const F=it.find(le=>le.id===L.current_stage),z=Math.floor((new Date().getTime()-new Date(L.stage_entered_at).getTime())/(1e3*60*60*24));return e.jsxs("tr",{className:`border-b border-dark-brown/5 ${V%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center text-2xl",children:F?.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-primary",children:L.name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:L.product_type})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:L.category})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-sm px-3 py-1 bg-gradient-to-r ${F?.gradient} rounded-full font-semibold text-dark-brown`,children:F?.name})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold text-white ${L.priority==="high"?"bg-soft-red":L.priority==="medium"?"bg-accent":"bg-sage"}`,children:L.priority.toUpperCase()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent",style:{width:`${L.progress}%`}})}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[L.progress,"%"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-sm ${z>30?"text-soft-red font-semibold":"text-dark-brown/70"}`,children:[z," days"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:L.target_launch_date||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(`/products/${L.id}`),className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",title:"View Details",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U(L),className:"p-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors",title:"Edit Product",children:e.jsx(ye,{className:"w-4 h-4"})})]})})]},L.id)})})]})})}),Y.length===0&&!N&&e.jsxs("div",{className:"text-center py-16 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ±"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"No products yet!"}),e.jsx("p",{className:"text-dark-brown/60 mb-6",children:"Create your first Ayurvedic product to get started"}),e.jsx("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300",children:"Create Product"})]})]})}),e.jsx(Hr,{isOpen:l,onClose:()=>m(!1),onSubmit:g,users:a}),b&&e.jsx(aa,{isOpen:p,onClose:()=>{x(!1),f(null)},onSubmit:O,product:b,users:a})]})}function Kr({product:s,onRefresh:n}){H();const[c,u]=o.useState([]),[l,m]=o.useState([]),[p,x]=o.useState(null),[b,f]=o.useState(!1),[t,i]=o.useState(s.description||"");o.useEffect(()=>{a()},[s.id]);const a=async()=>{try{const[h,d]=await Promise.all([C.from("product_stage_history").select("*, moved_by").eq("product_id",s.id).order("entered_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(h.error)throw h.error;if(d.error)throw d.error;if(u(h.data||[]),m(d.data||[]),s.created_by){const r=d.data?.find(v=>v.id===s.created_by);x(r)}}catch(h){console.error("Error fetching data:",h)}},k=async()=>{try{const{error:h}=await C.from("products").update({description:t}).eq("id",s.id);if(h)throw h;f(!1),n()}catch(h){console.error("Error updating description:",h)}},N=l.filter(h=>s.assigned_partners?.includes(h.id)),j=X(new Date,new Date(s.created_at)),_=h=>h.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2),w=h=>l.find(r=>r.id===h)?.name||"Unknown",y={idea:"ðŸŒ± Idea",research:"ðŸ” Research",formula:"âš—ï¸ Formula Creation",testing:"ðŸ§ª Testing",packaging:"ðŸ“¦ Packaging Design",printing:"ðŸ–¨ï¸ Printing",production:"ðŸ­ Production",ready:"ðŸš€ Ready to Launch",launched:"âœ… Launched"};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Product Information"}),!b&&e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"Edit Description"})]}),s.image_url&&e.jsx("div",{className:"mb-4 rounded-xl overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-64 object-cover"})}),b?e.jsxs("div",{children:[e.jsx("textarea",{value:t,onChange:h=>i(h.target.value),placeholder:"Enter product description...",rows:6,className:"w-full px-4 py-3 border-2 border-accent/30 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none mb-3"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-lg font-semibold hover:shadow-soft transition-all",children:"Save"}),e.jsx("button",{onClick:()=>{i(s.description||""),f(!1)},className:"px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:"Cancel"})]})]}):e.jsx("p",{className:"text-dark-brown/70 leading-relaxed",children:s.description||"No description provided yet."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Category"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Product Type"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.product_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created Date"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:q(new Date(s.created_at),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created By"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:p?.name||"Unknown"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Stage History"}),e.jsx("div",{className:"space-y-3",children:c.map((h,d)=>{const r=h.exited_at?X(new Date(h.exited_at),new Date(h.entered_at)):X(new Date,new Date(h.entered_at));return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white rounded-lg border-2 border-dark-brown/5",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-2xl ${d===0?"bg-accent/20":"bg-dark-brown/5"}`,children:y[h.stage]?.split(" ")[0]||"ðŸ“¦"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:y[h.stage]||h.stage}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Entered ",q(new Date(h.entered_at),"MMM dd, yyyy")," by ",w(h.moved_by)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-accent",children:[r," days"]}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:h.exited_at?"Completed":"Current"})]})]},h.id)})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-white rounded-xl p-6 border-2 border-accent/20",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Total Development"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[j," days"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Progress"}),e.jsxs("p",{className:"text-xl font-bold text-sage",children:[s.progress,"%"]})]})]}),s.target_launch_date&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center",children:e.jsx(De,{className:"w-6 h-6 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Target Launch"}),e.jsx("p",{className:"text-xl font-bold text-secondary",children:q(new Date(s.target_launch_date),"MMM dd, yyyy")})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Assigned Team"}),N.length>0?e.jsx("div",{className:"space-y-3",children:N.map(h=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:_(h.name)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:h.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 capitalize",children:h.role})]})]},h.id))}):e.jsx("p",{className:"text-dark-brown/50 text-sm",children:"No team members assigned yet."}),e.jsx("button",{className:"w-full mt-4 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"+ Add Team Member"})]})]})]})})}const Jr=["Herb","Oil","Powder","Extract","Base","Preservative","Fragrance","Active","Other"],Zr=["g","ml","kg","L","%","drops"],Xr=["Cooling","Heating","Vata-balancing","Pitta-balancing","Kapha-balancing","Anti-inflammatory","Antimicrobial","Moisturizing","Detoxifying","Rejuvenating"];function en({productId:s}){H();const[n,c]=o.useState([]),[u,l]=o.useState([]),[m,p]=o.useState(null),[x,b]=o.useState(!1),[f,t]=o.useState(null),[i,a]=o.useState({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""});o.useEffect(()=>{k()},[s]);const k=async()=>{try{const[d,r]=await Promise.all([C.from("product_ingredients").select("*").eq("product_id",s).order("created_at",{ascending:!0}),C.from("formula_versions").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(d.error)throw d.error;if(r.error)throw r.error;c(d.data||[]),l(r.data||[]);const v=r.data?.find(g=>g.is_current);p(v)}catch(d){console.error("Error fetching data:",d)}},N=async d=>{d.preventDefault();try{if(f){const{error:r}=await C.from("product_ingredients").update({...i,quantity:parseFloat(i.quantity)||0,cost_per_unit:parseFloat(i.cost_per_unit)||0}).eq("id",f);if(r)throw r}else{const{error:r}=await C.from("product_ingredients").insert([{product_id:s,...i,quantity:parseFloat(i.quantity)||0,cost_per_unit:parseFloat(i.cost_per_unit)||0}]);if(r)throw r}w(),k()}catch(r){console.error("Error saving ingredient:",r)}},j=d=>{a({ingredient_name:d.ingredient_name,botanical_name:d.botanical_name||"",type:d.type||"",quantity:d.quantity?.toString()||"",unit:d.unit||"g",vendor:d.vendor||"",cost_per_unit:d.cost_per_unit?.toString()||"",ayurvedic_properties:d.ayurvedic_properties||[],notes:d.notes||""}),t(d.id),b(!0)},_=async d=>{if(confirm("Are you sure you want to delete this ingredient?"))try{const{error:r}=await C.from("product_ingredients").delete().eq("id",d);if(r)throw r;k()}catch(r){console.error("Error deleting ingredient:",r)}},w=()=>{a({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""}),t(null),b(!1)},y=d=>{a(r=>({...r,ayurvedic_properties:r.ayurvedic_properties.includes(d)?r.ayurvedic_properties.filter(v=>v!==d):[...r.ayurvedic_properties,d]}))},h=n.reduce((d,r)=>d+(r.quantity||0)*(r.cost_per_unit||0),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Ingredients List"}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Ingredient"]})]}),e.jsx("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Cost/Unit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Properties"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((d,r)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${r%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:d.ingredient_name}),d.botanical_name&&e.jsx("p",{className:"text-sm text-dark-brown/60 italic",children:d.botanical_name})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:d.type||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[d.quantity||0," ",d.unit]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:d.vendor||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-dark-brown",children:["â‚¹",d.cost_per_unit?.toFixed(2)||"0.00"]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-bold text-accent",children:["â‚¹",((d.quantity||0)*(d.cost_per_unit||0)).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(d.ayurvedic_properties||[]).slice(0,2).map(v=>e.jsx("span",{className:"px-2 py-0.5 bg-sage/10 text-sage rounded text-xs font-semibold",children:v},v)),(d.ayurvedic_properties||[]).length>2&&e.jsxs("span",{className:"text-xs text-dark-brown/60",children:["+",(d.ayurvedic_properties||[]).length-2]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(d),className:"p-2 text-accent hover:bg-accent/10 rounded-lg transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(d.id),className:"p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]})})]},d.id))}),e.jsx("tfoot",{className:"bg-accent/5 border-t-2 border-accent/20",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Total Raw Material Cost:"}),e.jsxs("td",{className:"px-4 py-3 font-bold text-xl text-accent",children:["â‚¹",h.toFixed(2)]}),e.jsx("td",{colSpan:2})]})})]})})}),n.length===0&&e.jsxs("div",{className:"text-center py-12 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ¿"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No ingredients added yet"}),e.jsx("button",{onClick:()=>b(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Add Your First Ingredient"})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:f?"Edit Ingredient":"Add New Ingredient"}),e.jsx("button",{onClick:w,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Ingredient Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:i.ingredient_name,onChange:d=>a({...i,ingredient_name:d.target.value}),placeholder:"e.g., Neem Extract",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical Name"}),e.jsx("input",{type:"text",value:i.botanical_name,onChange:d=>a({...i,botanical_name:d.target.value}),placeholder:"e.g., Azadirachta indica",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Type"}),e.jsxs("select",{value:i.type,onChange:d=>a({...i,type:d.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Jr.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",value:i.quantity,onChange:d=>a({...i,quantity:d.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("select",{value:i.unit,onChange:d=>a({...i,unit:d.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Zr.map(d=>e.jsx("option",{value:d,children:d},d))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor/Source"}),e.jsx("input",{type:"text",value:i.vendor,onChange:d=>a({...i,vendor:d.target.value}),placeholder:"Supplier name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:i.cost_per_unit,onChange:d=>a({...i,cost_per_unit:d.target.value}),placeholder:"0.00",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Ayurvedic Properties"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Xr.map(d=>e.jsxs("label",{className:`cursor-pointer px-3 py-2 rounded-lg border-2 transition-all ${i.ayurvedic_properties.includes(d)?"border-sage bg-sage/10 text-sage font-semibold":"border-dark-brown/10 hover:border-sage/50 text-dark-brown"}`,children:[e.jsx("input",{type:"checkbox",checked:i.ayurvedic_properties.includes(d),onChange:()=>y(d),className:"sr-only"}),e.jsx("span",{className:"text-sm",children:d})]},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:i.notes,onChange:d=>a({...i,notes:d.target.value}),placeholder:"Additional notes about this ingredient...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:w,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:f?"Update Ingredient":"Add Ingredient"})]})]})]})})]})}const Ss={stability:["pH Test","Viscosity Test","Color Consistency","Fragrance Stability","Separation Test"],safety:["Patch Test Results","Microbial Testing","Heavy Metals Testing","Allergen Testing"],performance:["Efficacy Test","Shelf Life Study","Consumer Testing"]};function tn({productId:s}){const{user:n}=H(),[c,u]=o.useState([]),[l,m]=o.useState([]),[p,x]=o.useState(!1),[b,f]=o.useState(!1),[t,i]=o.useState({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),[a,k]=o.useState({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5});o.useEffect(()=>{N()},[s]);const N=async()=>{try{const[y,h]=await Promise.all([C.from("product_tests").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("sample_batches").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(y.error)throw y.error;if(h.error)throw h.error;u(y.data||[]),m(h.data||[])}catch(y){console.error("Error fetching data:",y)}},j=async y=>{y.preventDefault();try{const{error:h}=await C.from("product_tests").insert([{product_id:s,...t,tested_by:n?.id}]);if(h)throw h;i({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),x(!1),N()}catch(h){console.error("Error adding test:",h)}},_=async y=>{y.preventDefault();try{const{error:h}=await C.from("sample_batches").insert([{product_id:s,...a,quantity:parseFloat(a.quantity)||0,rating:parseInt(a.rating.toString())||5,created_by:n?.id}]);if(h)throw h;k({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5}),f(!1),N()}catch(h){console.error("Error adding batch:",h)}},w=y=>{const h={pass:{icon:e.jsx(Q,{className:"w-4 h-4"}),color:"bg-sage text-white"},fail:{icon:e.jsx(Me,{className:"w-4 h-4"}),color:"bg-soft-red text-white"},pending:{icon:e.jsx(oe,{className:"w-4 h-4"}),color:"bg-accent text-white"}};return h[y]||h.pending};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Testing & Quality Control"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Test"]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Sample Batch"]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(Ss).map(([y,h])=>{const d=c.filter(r=>r.test_category===y);return e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-xl font-bold text-primary mb-4 capitalize",children:[y," Testing"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(r=>{const v=d.find(D=>D.test_type===r),g=v?w(v.result):null;return e.jsxs("div",{className:`p-4 rounded-xl border-2 ${v?v.result==="pass"?"border-sage/30 bg-sage/5":v.result==="fail"?"border-soft-red/30 bg-soft-red/5":"border-accent/30 bg-accent/5":"border-dark-brown/10 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!v,readOnly:!0,className:"w-5 h-5 rounded border-2 border-dark-brown/20"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:r})]}),g&&e.jsxs("span",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${g.color}`,children:[g.icon,v.result.toUpperCase()]})]}),v&&e.jsxs("div",{className:"ml-7 space-y-1 text-sm",children:[v.target_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Target:"})," ",v.target_value]}),v.actual_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Actual:"})," ",v.actual_value]}),e.jsxs("p",{className:"text-dark-brown/60",children:["Tested on ",q(new Date(v.test_date),"MMM dd, yyyy")]}),v.notes&&e.jsx("p",{className:"text-dark-brown/70 italic",children:v.notes})]})]},r)})})]},y)})}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h4",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Sample Batches"}),l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:l.map(y=>e.jsxs("div",{className:"p-4 bg-white rounded-xl border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-dark-brown text-lg",children:y.batch_number}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[y.quantity," ",y.unit," â€¢ ",y.purpose]})]}),y.rating&&e.jsx("div",{className:"flex gap-0.5",children:[...Array(5)].map((h,d)=>e.jsx("span",{className:d<y.rating?"text-accent":"text-dark-brown/20",children:"â˜…"},d))})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Date:"})," ",q(new Date(y.batch_date),"MMM dd, yyyy")]}),y.given_to&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Given to:"})," ",y.given_to]}),y.feedback&&e.jsxs("p",{className:"text-dark-brown/70 italic",children:['"',y.feedback,'"']})]})]},y.id))}):e.jsx("p",{className:"text-center py-8 text-dark-brown/50",children:"No sample batches recorded yet"})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Test Result"})}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Category"}),e.jsxs("select",{required:!0,value:t.test_category,onChange:y=>i({...t,test_category:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"stability",children:"Stability Testing"}),e.jsx("option",{value:"safety",children:"Safety Testing"}),e.jsx("option",{value:"performance",children:"Performance Testing"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Test Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:t.test_type,onChange:y=>i({...t,test_type:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select test type"}),Ss[t.test_category]?.map(y=>e.jsx("option",{value:y,children:y},y))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Value"}),e.jsx("input",{type:"text",value:t.target_value,onChange:y=>i({...t,target_value:y.target.value}),placeholder:"e.g., pH 5.5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Actual Value"}),e.jsx("input",{type:"text",value:t.actual_value,onChange:y=>i({...t,actual_value:y.target.value}),placeholder:"e.g., pH 5.6",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Result"}),e.jsxs("select",{value:t.result,onChange:y=>i({...t,result:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"pass",children:"Pass"}),e.jsx("option",{value:"fail",children:"Fail"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Date"}),e.jsx("input",{type:"date",value:t.test_date,onChange:y=>i({...t,test_date:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:t.notes,onChange:y=>i({...t,notes:y.target.value}),rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Test"})]})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Sample Batch"})}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:a.batch_number,onChange:y=>k({...a,batch_number:y.target.value}),placeholder:"e.g., BATCH-001",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Date"}),e.jsx("input",{type:"date",value:a.batch_date,onChange:y=>k({...a,batch_date:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:a.quantity,onChange:y=>k({...a,quantity:y.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("input",{type:"text",value:a.unit,onChange:y=>k({...a,unit:y.target.value}),placeholder:"units/ml/g",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Purpose"}),e.jsxs("select",{value:a.purpose,onChange:y=>k({...a,purpose:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"testing",children:"Testing"}),e.jsx("option",{value:"sampling",children:"Sampling"}),e.jsx("option",{value:"gifting",children:"Gifting"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Given To"}),e.jsx("input",{type:"text",value:a.given_to,onChange:y=>k({...a,given_to:y.target.value}),placeholder:"Names of recipients",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Feedback"}),e.jsx("textarea",{value:a.feedback,onChange:y=>k({...a,feedback:y.target.value}),placeholder:"User feedback...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(y=>e.jsx("button",{type:"button",onClick:()=>k({...a,rating:y}),className:`text-3xl ${y<=a.rating?"text-accent":"text-dark-brown/20"}`,children:"â˜…"},y))})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Batch"})]})]})]})})]})}function sn({productId:s}){const{user:n}=H(),[c,u]=o.useState([]),[l,m]=o.useState(!1),[p,x]=o.useState({version_name:"",image_url:"",specifications:{}});o.useEffect(()=>{b()},[s]);const b=async()=>{try{const{data:a,error:k}=await C.from("packaging_designs").select("*").eq("product_id",s).order("created_at",{ascending:!1});if(k)throw k;u(a||[])}catch(a){console.error("Error fetching designs:",a)}},f=async a=>{a.preventDefault();try{const{error:k}=await C.from("packaging_designs").insert([{product_id:s,...p,uploaded_by:n?.id}]);if(k)throw k;x({version_name:"",image_url:"",specifications:{}}),m(!1),b()}catch(k){console.error("Error adding design:",k)}},t=async a=>{const k=c.find(w=>w.id===a);if(!k)return;const N=k.votes||[],_=N.includes(n?.id)?N.filter(w=>w!==n?.id):[...N,n?.id];try{const{error:w}=await C.from("packaging_designs").update({votes:_}).eq("id",a);if(w)throw w;b()}catch(w){console.error("Error voting:",w)}},i=a=>{const k={under_review:{color:"bg-accent",text:"Under Review"},approved:{color:"bg-sage",text:"Approved"},rejected:{color:"bg-soft-red",text:"Rejected"}};return k[a]||k.under_review};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Packaging Designs"}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Upload Design"]})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(a=>{const k=i(a.status),N=a.votes||[];return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all",children:[a.image_url?e.jsx("div",{className:"aspect-square bg-cream/30",children:e.jsx("img",{src:a.image_url,alt:a.version_name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-cream/50 to-accent/10 flex items-center justify-center",children:e.jsx("span",{className:"text-6xl",children:"ðŸ“¦"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-bold text-dark-brown",children:a.version_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold text-white ${k.color}`,children:k.text})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>t(a.id),className:`flex items-center gap-1 px-3 py-2 rounded-lg font-semibold transition-all ${N.includes(n?.id)?"bg-accent text-white":"bg-accent/10 text-accent hover:bg-accent/20"}`,children:[e.jsx(Za,{className:"w-4 h-4"}),N.length]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"View"]}),e.jsx("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]})]})]},a.id)})}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“¦"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No packaging designs uploaded yet"}),e.jsx("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload First Design"})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-secondary to-accent p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload Design"})}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Design Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:p.version_name,onChange:a=>x({...p,version_name:a.target.value}),placeholder:"e.g., Design A",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Image URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:p.image_url,onChange:a=>x({...p,image_url:a.target.value}),placeholder:"https://example.com/design.jpg",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload Design"})]})]})]})})]})}const Ht=["Research","Formula","Packaging","Production","Marketing","Other"],an=["high","medium","low"],rn=["todo","in_progress","completed","blocked"];function nn({productId:s}){const{user:n}=H(),[c,u]=o.useState([]),[l,m]=o.useState([]),[p,x]=o.useState(!1),[b,f]=o.useState({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"});o.useEffect(()=>{t()},[s]);const t=async()=>{try{const[y,h]=await Promise.all([C.from("product_tasks").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(y.error)throw y.error;if(h.error)throw h.error;u(y.data||[]),m(h.data||[])}catch(y){console.error("Error fetching data:",y)}},i=async y=>{y.preventDefault();try{const{error:h}=await C.from("product_tasks").insert([{product_id:s,...b,created_by:n?.id}]);if(h)throw h;f({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"}),x(!1),t()}catch(h){console.error("Error adding task:",h)}},a=async(y,h)=>{try{const d={status:h};h==="completed"&&(d.completed_at=new Date().toISOString());const{error:r}=await C.from("product_tasks").update(d).eq("id",y);if(r)throw r;t()}catch(d){console.error("Error updating task:",d)}},k=y=>{const h={todo:{color:"bg-dark-brown/20 text-dark-brown",text:"To Do"},in_progress:{color:"bg-accent text-white",text:"In Progress"},completed:{color:"bg-sage text-white",text:"Completed"},blocked:{color:"bg-soft-red text-white",text:"Blocked"}};return h[y]||h.todo},N=y=>{const h={high:"border-l-soft-red",medium:"border-l-accent",low:"border-l-sage"};return h[y]||h.medium},j=y=>l.find(d=>d.id===y)?.name||"Unassigned",_=Ht.reduce((y,h)=>(y[h]=c.filter(d=>d.category===h),y),{}),w={total:c.length,completed:c.filter(y=>y.status==="completed").length,inProgress:c.filter(y=>y.status==="in_progress").length,overdue:c.filter(y=>y.due_date&&new Date(y.due_date)<new Date&&y.status!=="completed").length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Tasks & Checklist"}),e.jsxs("p",{className:"text-dark-brown/60 text-sm mt-1",children:[w.completed,"/",w.total," tasks completed"]})]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Task"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-4 border-2 border-primary/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Total Tasks"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:w.total})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:w.inProgress})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-4 border-2 border-sage/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:w.completed})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-xl p-4 border-2 border-soft-red/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Overdue"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:w.overdue})]})]}),e.jsx("div",{className:"space-y-6",children:Ht.map(y=>{const h=_[y]||[];return h.length===0?null:e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary mb-4 flex items-center gap-2",children:[y," Tasks",e.jsx("span",{className:"px-2 py-1 bg-primary/10 rounded-full text-sm",children:h.length})]}),e.jsx("div",{className:"space-y-3",children:h.map(d=>{const r=k(d.status),v=N(d.priority),g=d.due_date&&new Date(d.due_date)<new Date&&d.status!=="completed";return e.jsx("div",{className:`bg-white p-4 rounded-xl border-l-4 ${v} shadow-sm hover:shadow-soft transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("input",{type:"checkbox",checked:d.status==="completed",onChange:()=>a(d.id,d.status==="completed"?"todo":"completed"),className:"w-5 h-5 mt-0.5 rounded border-2 border-dark-brown/20 cursor-pointer"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:`font-semibold text-dark-brown mb-1 ${d.status==="completed"?"line-through opacity-60":""}`,children:d.title}),d.description&&e.jsx("p",{className:"text-sm text-dark-brown/70 mb-2",children:d.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-dark-brown/60",children:[d.assigned_to&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-3 h-3"}),j(d.assigned_to)]}),d.due_date&&e.jsxs("span",{className:`flex items-center gap-1 ${g?"text-soft-red font-semibold":""}`,children:[e.jsx(De,{className:"w-3 h-3"}),q(new Date(d.due_date),"MMM dd"),g&&" (Overdue)"]})]})]})]}),e.jsx("select",{value:d.status,onChange:D=>a(d.id,D.target.value),className:`px-3 py-1 rounded-full text-xs font-semibold ${r.color} cursor-pointer`,children:rn.map(D=>e.jsx("option",{value:D,children:k(D).text},D))})]})},d.id)})})]},y)})}),c.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"âœ…"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No tasks created yet"}),e.jsx("button",{onClick:()=>x(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Create First Task"})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-sage p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add New Task"})}),e.jsxs("form",{onSubmit:i,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Task Title ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:b.title,onChange:y=>f({...b,title:y.target.value}),placeholder:"e.g., Complete pH testing",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:b.description,onChange:y=>f({...b,description:y.target.value}),placeholder:"Task description...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:b.category,onChange:y=>f({...b,category:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Ht.map(y=>e.jsx("option",{value:y,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("select",{value:b.priority,onChange:y=>f({...b,priority:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:an.map(y=>e.jsx("option",{value:y,children:y.charAt(0).toUpperCase()+y.slice(1)},y))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign To"}),e.jsxs("select",{value:b.assigned_to,onChange:y=>f({...b,assigned_to:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Unassigned"}),l.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:b.due_date,onChange:y=>f({...b,due_date:y.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Task"})]})]})]})})]})}function ln({productId:s}){const{user:n}=H(),[c,u]=o.useState([]),[l,m]=o.useState([]),[p,x]=o.useState("");o.useEffect(()=>{b();const j=f();return()=>{j.unsubscribe()}},[s]);const b=async()=>{try{const[j,_]=await Promise.all([C.from("product_comments").select("*").eq("product_id",s).is("parent_comment_id",null).order("created_at",{ascending:!0}),C.from("users").select("*")]);if(j.error)throw j.error;if(_.error)throw _.error;u(j.data||[]),m(_.data||[])}catch(j){console.error("Error fetching data:",j)}},f=()=>C.channel(`product_comments:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"product_comments",filter:`product_id=eq.${s}`},()=>{b()}).subscribe(),t=async j=>{if(j.preventDefault(),!!p.trim())try{const{error:_}=await C.from("product_comments").insert([{product_id:s,user_id:n?.id,text:p}]);if(_)throw _;x("")}catch(_){console.error("Error adding comment:",_)}},i=async(j,_)=>{const w=c.find(r=>r.id===j);if(!w)return;const y=w.reactions||[],h=y.find(r=>r.userId===n?.id&&r.emoji===_);let d;h?d=y.filter(r=>!(r.userId===n?.id&&r.emoji===_)):d=[...y,{userId:n?.id,emoji:_}];try{const{error:r}=await C.from("product_comments").update({reactions:d}).eq("id",j);if(r)throw r}catch(r){console.error("Error updating reaction:",r)}},a=j=>l.find(_=>_.id===j),k=j=>j.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),N=j=>{const _={};return j.forEach(w=>{_[w.emoji]||(_[w.emoji]=[]),_[w.emoji].push(w.userId)}),_};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Team Discussion"}),e.jsx("form",{onSubmit:t,className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:n?.name?k(n.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:p,onChange:j=>x(j.target.value),placeholder:"Share your thoughts, ask questions, or provide updates...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Add emoji",children:e.jsx(Js,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Attach file",children:e.jsx(os,{className:"w-5 h-5"})})]}),e.jsxs("button",{type:"submit",disabled:!p.trim(),className:"flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ys,{className:"w-5 h-5"}),"Send"]})]})]})]})}),e.jsx("div",{className:"space-y-4",children:c.map(j=>{const _=a(j.user_id),w=N(j.reactions||[]);return e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-dark-brown/5 hover:border-accent/20 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:_?k(_.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:_?.name||"Unknown"}),e.jsx("span",{className:"text-sm text-dark-brown/50",children:q(new Date(j.created_at),"MMM dd, yyyy HH:mm")})]}),e.jsx("p",{className:"text-dark-brown/80 leading-relaxed mb-3",children:j.text}),Object.keys(w).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(w).map(([y,h])=>e.jsxs("button",{onClick:()=>i(j.id,y),className:`flex items-center gap-1 px-3 py-1 rounded-full text-sm transition-all ${h.includes(n?.id||"")?"bg-accent/20 border-2 border-accent":"bg-dark-brown/5 border-2 border-transparent hover:border-accent/30"}`,children:[e.jsx("span",{children:y}),e.jsx("span",{className:"font-semibold text-dark-brown",children:h.length})]},y))}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("button",{className:"hover:text-accent transition-colors",children:[e.jsx(Va,{className:"w-4 h-4 inline mr-1"}),"Reply"]}),e.jsx("button",{onClick:()=>i(j.id,"ðŸ‘"),className:"hover:text-accent transition-colors",children:"ðŸ‘ Like"}),e.jsx("button",{onClick:()=>i(j.id,"â¤ï¸"),className:"hover:text-accent transition-colors",children:"â¤ï¸ Love"}),e.jsx("button",{onClick:()=>i(j.id,"ðŸŽ‰"),className:"hover:text-accent transition-colors",children:"ðŸŽ‰ Celebrate"})]})]})]})},j.id)})}),c.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ’¬"}),e.jsx("p",{className:"text-dark-brown/60",children:"No comments yet. Start the discussion!"})]})]})}const Wt=[{name:"Formulas",icon:"âš—ï¸"},{name:"Test Reports",icon:"ðŸ§ª"},{name:"Packaging Designs",icon:"ðŸ“¦"},{name:"Certificates",icon:"ðŸ†"},{name:"Marketing Materials",icon:"ðŸ“¢"},{name:"Legal Documents",icon:"ðŸ“‹"},{name:"Research Papers",icon:"ðŸ“š"},{name:"Photos",icon:"ðŸ“¸"}];function on({productId:s}){const{user:n}=H(),[c,u]=o.useState([]),[l,m]=o.useState([]),[p,x]=o.useState(null),[b,f]=o.useState(!1),[t,i]=o.useState({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"});o.useEffect(()=>{a()},[s]);const a=async()=>{try{const[d,r]=await Promise.all([C.from("product_files").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*")]);if(d.error)throw d.error;if(r.error)throw r.error;u(d.data||[]),m(r.data||[])}catch(d){console.error("Error fetching data:",d)}},k=async d=>{d.preventDefault();try{const{error:r}=await C.from("product_files").insert([{product_id:s,...t,file_size:0,uploaded_by:n?.id}]);if(r)throw r;i({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"}),f(!1),a()}catch(r){console.error("Error uploading file:",r)}},N=async d=>{if(confirm("Are you sure you want to delete this file?"))try{const{error:r}=await C.from("product_files").delete().eq("id",d);if(r)throw r;a()}catch(r){console.error("Error deleting file:",r)}},j=d=>l.find(v=>v.id===d)?.name||"Unknown",_=d=>d.startsWith("image/")?e.jsx(ns,{className:"w-6 h-6"}):d==="application/pdf"?e.jsx(ae,{className:"w-6 h-6"}):e.jsx(zs,{className:"w-6 h-6"}),w=p?c.filter(d=>d.category===p):c,y=Wt.reduce((d,r)=>(d[r.name]=c.filter(v=>v.category===r.name).length,d),{}),h=d=>{if(d===0)return"0 KB";const r=1024,v=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(d)/Math.log(r));return Math.round(d/Math.pow(r,g)*100)/100+" "+v[g]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Files & Documents"}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Be,{className:"w-5 h-5"}),"Upload File"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Wt.map(d=>e.jsxs("button",{onClick:()=>x(p===d.name?null:d.name),className:`p-4 rounded-xl border-2 transition-all ${p===d.name?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:d.icon}),e.jsx("span",{className:"font-semibold text-dark-brown text-sm",children:d.name})]}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:y[d.name]||0})]},d.name))}),p&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Os,{className:"w-4 h-4 text-accent"}),e.jsxs("span",{className:"text-dark-brown",children:["Showing files in: ",e.jsx("strong",{children:p})]}),e.jsx("button",{onClick:()=>x(null),className:"text-accent hover:underline",children:"Clear filter"})]}),w.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map(d=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border-2 border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center text-accent flex-shrink-0",children:_(d.file_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",title:d.file_name,children:d.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:d.category})]})]}),e.jsxs("div",{className:"text-xs text-dark-brown/60 space-y-1 mb-3",children:[e.jsxs("p",{children:["Uploaded by ",j(d.uploaded_by)]}),e.jsx("p",{children:q(new Date(d.created_at),"MMM dd, yyyy")}),d.file_size>0&&e.jsx("p",{children:h(d.file_size)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:d.file_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{onClick:()=>N(d.id),className:"px-3 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]})]},d.id))}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:p?`No files in ${p} yet`:"No files uploaded yet"}),e.jsx("button",{onClick:()=>f(!0),className:"px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload Your First File"})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload File"})}),e.jsxs("form",{onSubmit:k,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{required:!0,value:t.category,onChange:d=>i({...t,category:d.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Wt.map(d=>e.jsxs("option",{value:d.name,children:[d.icon," ",d.name]},d.name))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:t.file_name,onChange:d=>i({...t,file_name:d.target.value}),placeholder:"e.g., Formula v1.0.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:t.file_url,onChange:d=>i({...t,file_url:d.target.value}),placeholder:"https://example.com/file.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Enter the direct URL to your file"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"File Type"}),e.jsxs("select",{value:t.file_type,onChange:d=>i({...t,file_type:d.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"application/pdf",children:"PDF Document"}),e.jsx("option",{value:"image/jpeg",children:"JPEG Image"}),e.jsx("option",{value:"image/png",children:"PNG Image"}),e.jsx("option",{value:"application/msword",children:"Word Document"}),e.jsx("option",{value:"application/vnd.ms-excel",children:"Excel Spreadsheet"}),e.jsx("option",{value:"text/plain",children:"Text File"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload File"})]})]})]})})]})}const dn=[{id:"overview",name:"Overview",icon:ae},{id:"ingredients",name:"Ingredients & Formula",icon:He},{id:"testing",name:"Testing & Quality",icon:Xs},{id:"packaging",name:"Packaging",icon:ne},{id:"tasks",name:"Tasks & Checklist",icon:rs},{id:"discussion",name:"Team Discussion",icon:$t},{id:"files",name:"Files & Documents",icon:Os}],St=[{id:"idea",name:"Idea",color:"bg-sage"},{id:"research",name:"Research",color:"bg-sage"},{id:"formula",name:"Formula Creation",color:"bg-accent"},{id:"testing",name:"Testing",color:"bg-accent"},{id:"packaging",name:"Packaging Design",color:"bg-secondary"},{id:"printing",name:"Printing",color:"bg-secondary"},{id:"production",name:"Production",color:"bg-secondary"},{id:"ready",name:"Ready to Launch",color:"bg-primary"},{id:"launched",name:"Launched",color:"bg-primary"}];function cn(){const{id:s}=Je(),n=de(),{user:c}=H(),[u,l]=o.useState("overview"),[m,p]=o.useState(null),[x,b]=o.useState([]),[f,t]=o.useState(!0),[i,a]=o.useState(!1);o.useEffect(()=>{s&&k()},[s]);const k=async()=>{try{const[d,r]=await Promise.all([C.from("products").select("*").eq("id",s).single(),C.from("users").select("id, name, email").order("name")]);if(d.error)throw d.error;if(r.error)throw r.error;p(d.data),b(r.data||[])}catch(d){console.error("Error fetching data:",d)}finally{t(!1)}},N=k,j=async()=>{if(!m)return;const d=St.findIndex(v=>v.id===m.current_stage);if(d===-1||d===St.length-1)return;const r=St[d+1];if(!(r.id==="launched"&&!window.confirm(`Are you sure you want to launch "${m.name}"? This marks it as complete.`)))try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",m.id).is("exited_at",null),await C.from("products").update({current_stage:r.id,stage_entered_at:new Date().toISOString(),progress:r.id==="launched"?100:m.progress}).eq("id",m.id),await C.from("product_stage_history").insert([{product_id:m.id,stage:r.id,moved_by:c?.id}]),await N()}catch(v){console.error("Error moving product:",v)}},_=async(d,r)=>{try{const{error:v}=await C.from("products").update({...r,updated_at:new Date().toISOString()}).eq("id",d);if(v)throw v;await C.from("activity_log").insert({user_id:c?.id,activity_type:"product_updated",description:`${c?.name} updated product: ${r.name}`}),await N()}catch(v){throw console.error("Error updating product:",v),v}},w=d=>{const r={high:{color:"bg-soft-red",text:"HIGH"},medium:{color:"bg-accent",text:"MEDIUM"},low:{color:"bg-sage",text:"LOW"}};return r[d]||r.medium};if(f)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Loading product..."})})});if(!m)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Product not found"})})});const y=St.find(d=>d.id===m.current_stage),h=w(m.priority);return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/products"),className:"flex items-center gap-2 text-dark-brown/70 hover:text-primary mb-6 transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Pipeline"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-3",children:m.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-semibold",children:m.category}),e.jsx("span",{className:`px-3 py-1 ${h.color} text-white rounded-full text-sm font-semibold`,children:h.text}),y&&e.jsx("span",{className:`px-4 py-1 ${y.color} text-white rounded-full text-sm font-semibold`,children:y.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Stage Progress"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[m.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${m.progress}%`}})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(ye,{className:"w-5 h-5"}),"Edit"]}),e.jsxs("button",{onClick:j,disabled:m.current_stage==="launched",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ss,{className:"w-5 h-5"}),"Move to Next Stage"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(Ga,{className:"w-5 h-5"}),"Share"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-xl font-semibold transition-colors",children:[e.jsx(Ma,{className:"w-5 h-5"}),"Archive"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex min-w-max",children:dn.map(d=>{const r=d.icon;return e.jsxs("button",{onClick:()=>l(d.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all duration-300 border-b-4 ${u===d.id?"border-accent text-accent bg-accent/5":"border-transparent text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(r,{className:"w-5 h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:d.name})]},d.id)})})})}),e.jsxs("div",{className:"p-6",children:[u==="overview"&&e.jsx(Kr,{product:m,onRefresh:N}),u==="ingredients"&&e.jsx(en,{productId:m.id}),u==="testing"&&e.jsx(tn,{productId:m.id}),u==="packaging"&&e.jsx(sn,{productId:m.id}),u==="tasks"&&e.jsx(nn,{productId:m.id}),u==="discussion"&&e.jsx(ln,{productId:m.id}),u==="files"&&e.jsx(on,{productId:m.id})]})]})]}),m&&e.jsx(aa,{isOpen:i,onClose:()=>a(!1),onSubmit:_,product:m,users:x})]})}function xn(){const{user:s}=H(),[n,c]=o.useState([]),[u,l]=o.useState(""),[m,p]=o.useState(""),[x,b]=o.useState(100),[f,t]=o.useState([]),[i,a]=o.useState([{id:"1",name:"Primary Container (Bottle/Jar)",quantity:1,costPerPiece:0,total:0},{id:"2",name:"Label/Sticker",quantity:1,costPerPiece:0,total:0},{id:"3",name:"Secondary Packaging (Box)",quantity:1,costPerPiece:0,total:0}]),[k,N]=o.useState([]),[j,_]=o.useState(0),[w,y]=o.useState(0),[h,d]=o.useState(0),[r,v]=o.useState(0),[g,D]=o.useState(0),[T,A]=o.useState(0),[P,U]=o.useState(0),[O,Y]=o.useState(0),[ee,te]=o.useState(10),[S,$]=o.useState(1),[L,V]=o.useState(0),[F,z]=o.useState(10),[le,me]=o.useState(0),[_e,jt]=o.useState(12),[Ce,We]=o.useState([]),[Ze,yt]=o.useState(0),[Xe,Ee]=o.useState(0),[Pe,wt]=o.useState(0),[Ae,qt]=o.useState(0),[Rt,Ut]=o.useState([]),[zt,et]=o.useState(!1),[Ge,M]=o.useState("");o.useEffect(()=>{B(),W()},[]),o.useEffect(()=>{u&&Nt()},[u]);const B=async()=>{try{const{data:E,error:R}=await C.from("products").select("*").order("name");if(R)throw R;c(E||[])}catch(E){console.error("Error fetching products:",E)}},W=async()=>{try{const{data:E,error:R}=await C.from("product_cost_calculations").select("*").eq("is_draft",!1).order("created_at",{ascending:!1});if(R)throw R;Ut(E||[])}catch(E){console.error("Error fetching calculations:",E)}},Nt=async()=>{const E=n.find(R=>R.id===u);if(E){p(E.name);try{const{data:R}=await C.from("product_ingredients").select("*").eq("product_id",u);if(R&&R.length>0){const J=R.map(re=>({id:re.id,name:re.ingredient_name,quantity:re.quantity||0,unit:re.unit||"g",costPerUnit:re.cost_per_unit||0,total:(re.quantity||0)*(re.cost_per_unit||0)}));t(J)}}catch(R){console.error("Error loading product data:",R)}}},Bt=()=>{t([...f,{id:Date.now().toString(),name:"",quantity:0,unit:"g",costPerUnit:0,total:0}])},Qe=(E,R,J)=>{t(f.map(re=>{if(re.id===E){const pe={...re,[R]:J};return pe.total=pe.quantity*pe.costPerUnit,pe}return re}))},ra=E=>{t(f.filter(R=>R.id!==E))},ds=(E,R,J)=>{a(i.map(re=>{if(re.id===E){const pe={...re,[R]:J};return pe.total=pe.quantity*pe.costPerPiece,pe}return re}))},na=()=>{N([...k,{id:Date.now().toString(),description:"",amount:0}])},la=()=>{We([...Ce,{id:Date.now().toString(),description:"",amount:0}])},tt=f.reduce((E,R)=>E+R.total,0),st=[...i.map(E=>E.total),...k.map(E=>E.amount)].reduce((E,R)=>E+R,0),Ot=j*w,cs=h+r+g+T,at=Ot+cs+P,Vt=S>0?O*ee/100/S:0,xs=S>0?L*F/100/S:0,ms=_e>0?le/_e:0,oa=Ce.reduce((E,R)=>E+R.amount,0),rt=Vt+xs+ms+oa,hs=Xe+Pe,nt=(Ze+hs)*x,vt=tt+st+at+rt+nt,lt=x>0?vt/x:0,kt=[{name:"Raw Materials",value:tt,color:"#8B4513"},{name:"Packaging",value:st,color:"#D2691E"},{name:"Manufacturing",value:at,color:"#CD853F"},{name:"Overheads",value:rt,color:"#DEB887"},{name:"Marketing",value:nt,color:"#F4A460"}].filter(E=>E.value>0),ps=E=>{const R=lt/(1-E/100),J=R*.18,re=R+J,pe=R-lt;return{sellingPrice:R,gst:J,mrp:re,profit:pe,marginPercent:E}},bs=[30,40,50,60].map(E=>ps(E)),ia=async()=>{if(!Ge.trim()){alert("Please enter a calculation name");return}try{const E={product_id:u||null,calculation_name:Ge,batch_size:x,raw_material_costs:{ingredients:f,subtotal:tt},packaging_costs:{components:i,other:k,subtotal:st},manufacturing_costs:{labour:Ot,utilities:cs,qc:P,subtotal:at},overhead_costs:{rent:Vt,salaries:xs,compliance:ms,other:Ce,subtotal:rt},marketing_costs:{marketing:Ze*x,fulfillment:hs*x,subtotal:nt},total_cost:vt,cost_per_unit:lt,margin_scenarios:bs,saved_by:s?.id,is_draft:!1},{error:R}=await C.from("product_cost_calculations").insert([E]);if(R)throw R;et(!1),M(""),W(),alert("Calculation saved successfully!")}catch(E){console.error("Error saving calculation:",E),alert("Error saving calculation")}};return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Product Cost Calculator"}),e.jsx("p",{className:"text-dark-brown/70",children:"Calculate unit economics and pricing strategy"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>et(!0),className:"flex items-center gap-2 px-6 py-3 bg-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all hover:bg-accent/90",children:[e.jsx(Qs,{className:"w-5 h-5"}),"Save Calculation"]}),e.jsxs("button",{className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export PDF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Select Product (Optional)"}),e.jsxs("select",{value:u,onChange:E=>l(E.target.value),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Calculate for new product"}),n.map(E=>e.jsx("option",{value:E.id,children:E.name},E.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Load Saved Calculation"}),e.jsxs("select",{className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select saved calculation..."}),Rt.map(E=>e.jsxs("option",{value:E.id,children:[E.calculation_name," - ",new Date(E.created_at).toLocaleDateString()]},E.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Batch Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Name"}),e.jsx("input",{type:"text",value:m,onChange:E=>p(E.target.value),placeholder:"Enter product name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Size (Units)"}),e.jsx("input",{type:"number",value:x,onChange:E=>b(parseInt(E.target.value)||0),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Raw Materials"}),e.jsxs("button",{onClick:Bt,className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Ingredient"]})]}),e.jsx("div",{className:"space-y-3",children:f.map(E=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:E.name,onChange:R=>Qe(E.id,"name",R.target.value),placeholder:"Ingredient name",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:E.quantity,onChange:R=>Qe(E.id,"quantity",parseFloat(R.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:E.unit,onChange:R=>Qe(E.id,"unit",R.target.value),className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"ml",children:"ml"}),e.jsx("option",{value:"L",children:"L"})]}),e.jsx("input",{type:"number",value:E.costPerUnit,onChange:R=>Qe(E.id,"costPerUnit",parseFloat(R.target.value)||0),placeholder:"â‚¹/unit",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-2 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",E.total.toFixed(2)]}),e.jsx("button",{onClick:()=>ra(E.id),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]},E.id))}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Raw Material Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",tt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(tt/x).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Packaging Costs"}),e.jsx("div",{className:"space-y-3 mb-4",children:i.map(E=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("span",{className:"col-span-4 text-sm font-semibold text-dark-brown",children:E.name}),e.jsx("input",{type:"number",value:E.quantity,onChange:R=>ds(E.id,"quantity",parseFloat(R.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:E.costPerPiece,onChange:R=>ds(E.id,"costPerPiece",parseFloat(R.target.value)||0),placeholder:"â‚¹/piece",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-3 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",(E.total*x).toFixed(2)]})]},E.id))}),e.jsx("button",{onClick:na,className:"text-sm text-accent hover:underline mb-3",children:"+ Add other packaging material"}),k.map(E=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center mb-2",children:[e.jsx("input",{type:"text",value:E.description,onChange:R=>N(k.map(J=>J.id===E.id?{...J,description:R.target.value}:J)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:E.amount,onChange:R=>N(k.map(J=>J.id===E.id?{...J,amount:parseFloat(R.target.value)||0}:J)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>N(k.filter(R=>R.id!==E.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]},E.id)),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Packaging Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",st.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(st/x).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Manufacturing Costs"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Labour Hours"}),e.jsx("input",{type:"number",value:j,onChange:E=>_(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Hour (â‚¹)"}),e.jsx("input",{type:"number",value:w,onChange:E=>y(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Labour: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",Ot.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Electricity (â‚¹)"}),e.jsx("input",{type:"number",value:h,onChange:E=>d(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Water (â‚¹)"}),e.jsx("input",{type:"number",value:r,onChange:E=>v(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Equipment Depreciation (â‚¹)"}),e.jsx("input",{type:"number",value:g,onChange:E=>D(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Other Utilities (â‚¹)"}),e.jsx("input",{type:"number",value:T,onChange:E=>A(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC/Testing Cost (â‚¹)"}),e.jsx("input",{type:"number",value:P,onChange:E=>U(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Manufacturing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",at.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(at/x).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Overhead Allocation"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Rent (â‚¹)"}),e.jsx("input",{type:"number",value:O,onChange:E=>Y(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation to this product: ",ee,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:ee,onChange:E=>te(parseInt(E.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batches per Month"}),e.jsx("input",{type:"number",value:S,onChange:E=>$(parseInt(E.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Rent per batch: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",Vt.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Salaries (â‚¹)"}),e.jsx("input",{type:"number",value:L,onChange:E=>V(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation: ",F,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:F,onChange:E=>z(parseInt(E.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Compliance (â‚¹)"}),e.jsx("input",{type:"number",value:le,onChange:E=>me(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Batches"}),e.jsx("input",{type:"number",value:_e,onChange:E=>jt(parseInt(E.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsx("button",{onClick:la,className:"text-sm text-accent hover:underline",children:"+ Add other overhead"}),Ce.map(E=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:E.description,onChange:R=>We(Ce.map(J=>J.id===E.id?{...J,description:R.target.value}:J)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:E.amount,onChange:R=>We(Ce.map(J=>J.id===E.id?{...J,amount:parseFloat(R.target.value)||0}:J)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>We(Ce.filter(R=>R.id!==E.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]},E.id))]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Overhead Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",rt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(rt/x).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Marketing & Distribution"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Marketing per Unit (â‚¹)"}),e.jsx("input",{type:"number",value:Ze,onChange:E=>yt(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Ads, samples, packaging inserts, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Shipping Material (â‚¹)"}),e.jsx("input",{type:"number",value:Xe,onChange:E=>Ee(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Courier Charges (â‚¹)"}),e.jsx("input",{type:"number",value:Pe,onChange:E=>wt(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Platform Fees (%)"}),e.jsx("input",{type:"number",value:Ae,onChange:E=>qt(parseFloat(E.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Marketing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",nt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(nt/x).toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-2xl shadow-soft-lg p-6 text-white sticky top-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(qs,{className:"w-8 h-8"}),e.jsx("h3",{className:"font-heading text-2xl font-bold",children:"Cost Summary"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Total Batch Cost"}),e.jsxs("p",{className:"text-4xl font-bold",children:["â‚¹",vt.toFixed(2)]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-white/20 rounded-xl backdrop-blur-sm",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Cost Per Unit"}),e.jsxs("p",{className:"text-5xl font-bold",children:["â‚¹",lt.toFixed(2)]})]}),kt.length>0&&e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 backdrop-blur-sm",children:[e.jsx("p",{className:"text-sm font-semibold mb-3",children:"Cost Breakdown"}),e.jsx(be,{width:"100%",height:200,children:e.jsxs(Pt,{children:[e.jsx(At,{data:kt,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:kt.map((E,R)=>e.jsx(It,{fill:E.color},`cell-${R}`))}),e.jsx(je,{formatter:E=>`â‚¹${E.toFixed(2)}`,contentStyle:{background:"#fff",border:"none",borderRadius:"8px"}})]})}),e.jsx("div",{className:"space-y-2 mt-3",children:kt.map((E,R)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:E.color}}),e.jsx("span",{children:E.name})]}),e.jsxs("span",{className:"font-semibold",children:[(E.value/vt*100).toFixed(1),"%"]})]},R))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Pricing Strategy"}),e.jsx("div",{className:"space-y-4",children:bs.map((E,R)=>e.jsxs("div",{className:"p-4 bg-gradient-to-br from-cream/50 to-white rounded-xl border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-bold text-lg text-primary",children:[E.marginPercent,"% Margin"]}),e.jsxs("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-sm font-semibold",children:["Profit: â‚¹",E.profit.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Selling Price (ex-GST):"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",E.sellingPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"GST @ 18%:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",E.gst.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"font-bold text-dark-brown",children:"MRP (incl. GST):"}),e.jsxs("span",{className:"font-bold text-xl text-sage",children:["â‚¹",E.mrp.toFixed(2)]})]})]})]},R))})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Profitability Scenarios"}),e.jsx("div",{className:"space-y-3",children:[100,500,1e3,5e3].map(E=>{const R=E*ps(40).mrp,J=E*lt,re=R-J,pe=J>0?re/R*100:0;return e.jsxs("div",{className:"p-3 bg-cream/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-dark-brown",children:[E," units"]}),e.jsxs("span",{className:`text-sm font-bold ${re>0?"text-sage":"text-soft-red"}`,children:[re>0?"+":"","â‚¹",re.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60",children:[e.jsxs("span",{children:["Revenue: â‚¹",R.toFixed(0)]}),e.jsxs("span",{children:["Margin: ",pe.toFixed(1),"%"]})]})]},E)})})]})]})]})]}),zt&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Save Calculation"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Calculation Name"}),e.jsx("input",{type:"text",value:Ge,onChange:E=>M(E.target.value),placeholder:"e.g., Neem Face Wash v1.0 - 100 unit batch",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>et(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:ia,className:"flex-1 px-6 py-3 bg-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all hover:bg-accent/90",children:"Save"})]})]})})]})}const mn=["Raw Materials","Packaging","Printing","Logistics","Lab Testing","Equipment","Other"],hn=["Immediate","7 days","15 days","30 days","45 days","60 days","Custom"];function pn({onClose:s,onSuccess:n}){const{user:c}=H(),[u,l]=o.useState(!1),[m,p]=o.useState({name:"",category:"Raw Materials",products:"",contactPerson:"",phone:"",email:"",alternatePhone:"",address:"",gstNumber:"",website:"",paymentTerms:"30 days",bankName:"",accountNumber:"",ifscCode:"",initialRating:3,notes:""}),[x,b]=o.useState({iso:!1,organic:!1,fssai:!1,gmp:!1,other:""}),f=async t=>{if(t.preventDefault(),!m.name||!m.phone){alert("Please fill in required fields (Name and Phone)");return}l(!0);try{const i=m.bankName?{bankName:m.bankName,accountNumber:m.accountNumber,ifscCode:m.ifscCode}:{},a=[];x.iso&&a.push("ISO Certified"),x.organic&&a.push("Organic Certified"),x.fssai&&a.push("FSSAI Approved"),x.gmp&&a.push("GMP Certified"),x.other&&a.push(x.other);const{error:k}=await C.from("vendors").insert([{name:m.name,category:m.category,products:m.products,contact_person:m.contactPerson,phone:m.phone,email:m.email,alternate_phone:m.alternatePhone,address:m.address,gst_number:m.gstNumber,website:m.website,payment_terms:m.paymentTerms,bank_details:i,certifications:a,initial_rating:m.initialRating,current_rating:m.initialRating,notes:m.notes,created_by:c?.id}]);if(k)throw k;n()}catch(i){console.error("Error adding vendor:",i),alert("Error adding vendor. Please try again.")}finally{l(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add New Vendor"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:m.name,onChange:t=>p({...m,name:t.target.value}),placeholder:"e.g., Green Valley Herbs",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:m.category,onChange:t=>p({...m,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:mn.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:m.contactPerson,onChange:t=>p({...m,contactPerson:t.target.value}),placeholder:"Contact person name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Products/Services"}),e.jsx("textarea",{value:m.products,onChange:t=>p({...m,products:t.target.value}),placeholder:"What does this vendor supply? e.g., Organic herbs, essential oils",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Contact Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Phone Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"tel",value:m.phone,onChange:t=>p({...m,phone:t.target.value}),placeholder:"+91-XXXXXXXXXX",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email"}),e.jsx("input",{type:"email",value:m.email,onChange:t=>p({...m,email:t.target.value}),placeholder:"vendor@example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Alternative Phone"}),e.jsx("input",{type:"tel",value:m.alternatePhone,onChange:t=>p({...m,alternatePhone:t.target.value}),placeholder:"Optional second number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Website"}),e.jsx("input",{type:"url",value:m.website,onChange:t=>p({...m,website:t.target.value}),placeholder:"https://example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Address"}),e.jsx("textarea",{value:m.address,onChange:t=>p({...m,address:t.target.value}),placeholder:"Street, city, state, pincode",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Business Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"GST Number"}),e.jsx("input",{type:"text",value:m.gstNumber,onChange:t=>p({...m,gstNumber:t.target.value}),placeholder:"22AAAAA0000A1Z5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Terms"}),e.jsx("select",{value:m.paymentTerms,onChange:t=>p({...m,paymentTerms:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:hn.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bank Name"}),e.jsx("input",{type:"text",value:m.bankName,onChange:t=>p({...m,bankName:t.target.value}),placeholder:"e.g., HDFC Bank",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:m.accountNumber,onChange:t=>p({...m,accountNumber:t.target.value}),placeholder:"Account number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"IFSC Code"}),e.jsx("input",{type:"text",value:m.ifscCode,onChange:t=>p({...m,ifscCode:t.target.value}),placeholder:"e.g., HDFC0001234",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality & Rating"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Initial Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>p({...m,initialRating:t}),className:"focus:outline-none",children:e.jsx(ut,{className:`w-8 h-8 transition-colors ${t<=m.initialRating?"fill-amber-400 text-amber-400":"text-dark-brown/20 hover:text-amber-400"}`})},t)),e.jsxs("span",{className:"ml-2 text-sm font-semibold text-dark-brown",children:[m.initialRating," / 5"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Quality Certifications"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.iso,onChange:t=>b({...x,iso:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"ISO Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.organic,onChange:t=>b({...x,organic:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Organic Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.fssai,onChange:t=>b({...x,fssai:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"FSSAI Approved"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.gmp,onChange:t=>b({...x,gmp:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"GMP Certified"})]}),e.jsx("input",{type:"text",value:x.other,onChange:t=>b({...x,other:t.target.value}),placeholder:"Other certifications (comma separated)",className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Internal Notes"}),e.jsx("textarea",{value:m.notes,onChange:t=>p({...m,notes:t.target.value}),placeholder:"Any internal notes about this vendor (not visible to vendor)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:u,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:u?"Adding...":"Add Vendor"})]})]})})}const Gt=[{id:"all",label:"All Vendors",icon:"ðŸ¢",color:"bg-dark-brown/10"},{id:"Raw Materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20"},{id:"Packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-secondary/20"},{id:"Printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-blue-500/20"},{id:"Logistics",label:"Logistics",icon:"ðŸšš",color:"bg-accent/20"},{id:"Lab Testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-purple-500/20"},{id:"Other",label:"Other",icon:"ðŸ”§",color:"bg-dark-brown/20"}];function bn(){const[s,n]=o.useState([]),[c,u]=o.useState([]),[l,m]=o.useState("grid"),[p,x]=o.useState("all"),[b,f]=o.useState(""),[t,i]=o.useState(!1),[a,k]=o.useState({total:0,active:0,pendingPayments:0,avgRating:0});o.useEffect(()=>{N()},[]),o.useEffect(()=>{j()},[s,p,b]);const N=async()=>{try{const{data:h,error:d}=await C.from("vendors").select("*").order("name");if(d)throw d;const{data:r}=await C.from("vendor_transactions").select("vendor_id, amount, status"),v=(h||[]).map(P=>{const U=r?.filter(ee=>ee.vendor_id===P.id)||[],O=U.reduce((ee,te)=>ee+(parseFloat(te.amount)||0),0),Y=U.filter(ee=>ee.status==="pending").reduce((ee,te)=>ee+(parseFloat(te.amount)||0),0);return{...P,totalSpent:O,pendingAmount:Y}});n(v);const g=v.length,D=v.filter(P=>P.totalSpent>0).length,T=v.reduce((P,U)=>P+U.pendingAmount,0),A=v.reduce((P,U)=>P+(U.current_rating||0),0)/(g||1);k({total:g,active:D,pendingPayments:T,avgRating:A})}catch(h){console.error("Error fetching vendors:",h)}},j=()=>{let h=s;if(p!=="all"&&(h=h.filter(d=>d.category===p)),b){const d=b.toLowerCase();h=h.filter(r=>r.name?.toLowerCase().includes(d)||r.contact_person?.toLowerCase().includes(d)||r.email?.toLowerCase().includes(d)||r.phone?.includes(d))}u(h)},_=h=>Gt.find(r=>r.id===h)?.color||"bg-dark-brown/10",w=h=>Gt.find(r=>r.id===h)?.icon||"ðŸ¢",y=h=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(d=>e.jsx(ut,{className:`w-4 h-4 ${d<=h?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},d))});return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Vendor & Supplier Directory"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your business relationships"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ge,{className:"w-8 h-8 text-primary"}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:a.total})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(se,{className:"w-8 h-8 text-sage"}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:a.active})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Active Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fe,{className:"w-8 h-8 text-soft-red"}),e.jsxs("span",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",a.pendingPayments.toFixed(0)]})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ye,{className:"w-8 h-8 text-amber-500"}),e.jsx("span",{className:"text-3xl font-bold text-amber-500",children:a.avgRating.toFixed(1)})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Average Rating"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-soft p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto w-full lg:w-auto",children:Gt.map(h=>{const d=h.id==="all"?s.length:s.filter(r=>r.category===h.id).length;return e.jsxs("button",{onClick:()=>x(h.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${p===h.id?"bg-primary text-white shadow-soft":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:h.icon}),e.jsx("span",{children:h.label}),e.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded-full text-xs",children:d})]},h.id)})}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",value:b,onChange:h=>f(h.target.value),placeholder:"Search vendors...",className:"w-full pl-10 pr-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex items-center gap-1 p-1 bg-dark-brown/5 rounded-lg",children:[e.jsx("button",{onClick:()=>m("grid"),className:`p-2 rounded-lg transition-all ${l==="grid"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(Vs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>m("list"),className:`p-2 rounded-lg transition-all ${l==="list"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})})]})]})]})}),l==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(h=>e.jsxs(Ne,{to:`/vendors/${h.id}`,className:"bg-white rounded-xl shadow-soft hover:shadow-soft-lg transition-all overflow-hidden border-l-4 border-transparent hover:border-primary group",children:[e.jsx("div",{className:`h-2 ${_(h.category)}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary group-hover:text-accent transition-colors mb-1",children:h.name}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(h.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:w(h.category)}),h.category]})]})}),e.jsxs("div",{className:"flex items-center gap-1 mb-4",children:[y(h.current_rating||3),e.jsxs("span",{className:"text-sm text-dark-brown/60 ml-2",children:["(",h.current_rating?.toFixed(1)||"3.0",")"]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[h.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{children:h.phone})]}),h.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:h.email})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Total Spent"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",h.totalSpent?.toFixed(0)||"0"]})]}),h.pendingAmount>0&&e.jsxs("div",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",h.pendingAmount.toFixed(0)," due"]})]})]})]},h.id))}):e.jsx("div",{className:"bg-white rounded-xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Vendor Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Contact"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Rating"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Total Spent"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Pending"})]})}),e.jsx("tbody",{children:c.map((h,d)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${d%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx(Ne,{to:`/vendors/${h.id}`,className:"font-semibold text-primary hover:text-accent transition-colors",children:h.name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(h.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:w(h.category)}),h.category]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[h.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(pt,{className:"w-3 h-3"}),h.phone]}),h.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(Ve,{className:"w-3 h-3"}),h.email]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[y(h.current_rating||3),e.jsx("span",{className:"text-sm text-dark-brown/60",children:h.current_rating?.toFixed(1)||"3.0"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",h.totalSpent?.toFixed(0)||"0"]})}),e.jsx("td",{className:"px-6 py-4",children:h.pendingAmount>0?e.jsxs("span",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",h.pendingAmount.toFixed(0)]}):e.jsx("span",{className:"text-sm text-dark-brown/40",children:"-"})})]},h.id))})]})})}),c.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:b?"Try adjusting your search":"Add your first vendor to get started"}),!b&&e.jsx("button",{onClick:()=>i(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Vendor"})]})]}),t&&e.jsx(pn,{onClose:()=>i(!1),onSuccess:()=>{i(!1),N()}})]})}function un({vendor:s}){const[n,c]=o.useState({totalSpent:0,thisMonth:0,thisYear:0,avgTransaction:0,pendingPayment:0,totalTransactions:0}),[u,l]=o.useState([]);o.useEffect(()=>{m(),p()},[s.id]);const m=async()=>{try{const{data:x}=await C.from("vendor_transactions").select("*").eq("vendor_id",s.id);if(!x)return;const b=new Date,f=x.filter(j=>{const _=new Date(j.date);return _.getMonth()===b.getMonth()&&_.getFullYear()===b.getFullYear()}),t=x.filter(j=>new Date(j.date).getFullYear()===b.getFullYear()),i=x.reduce((j,_)=>j+parseFloat(_.amount),0),a=f.reduce((j,_)=>j+parseFloat(_.amount),0),k=t.reduce((j,_)=>j+parseFloat(_.amount),0),N=x.filter(j=>j.status==="pending").reduce((j,_)=>j+parseFloat(_.amount),0);c({totalSpent:i,thisMonth:a,thisYear:k,avgTransaction:x.length>0?i/x.length:0,pendingPayment:N,totalTransactions:x.length})}catch(x){console.error("Error fetching stats:",x)}},p=async()=>{try{const{data:x}=await C.from("vendor_transactions").select("date, amount").eq("vendor_id",s.id).order("date");if(!x)return;const b={};x.forEach(t=>{const i=new Date(t.date),a=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`;b[a]||(b[a]=0),b[a]+=parseFloat(t.amount)});const f=Object.entries(b).map(([t,i])=>({month:t,amount:i}));l(f.slice(-12))}catch(x){console.error("Error fetching spending trend:",x)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Vendor Information"}),e.jsxs("div",{className:"space-y-3",children:[s.contact_person&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Contact Person"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.contact_person})]})]}),s.phone&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(pt,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Phone"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.phone}),s.alternate_phone&&e.jsx("p",{className:"text-sm text-dark-brown/60",children:s.alternate_phone})]})]}),s.email&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ve,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Email"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.email})]})]}),s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ws,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Address"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.address})]})]}),s.website&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(La,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Website"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-accent hover:underline",children:s.website})]})]}),s.gst_number&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ht,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"GST Number"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.gst_number})]})]}),s.payment_terms&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ’³"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Payment Terms"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.payment_terms})]})]}),s.certifications&&Array.isArray(s.certifications)&&s.certifications.length>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ye,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Certifications"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:s.certifications.map((x,b)=>e.jsx("span",{className:"px-2 py-1 bg-sage/20 text-sage text-xs font-semibold rounded-full",children:x},b))})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.totalSpent.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.thisMonth.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Year"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.thisYear.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Avg Transaction"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.avgTransaction.toFixed(0)]})]})]}),n.pendingPayment>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Pending Payment"}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",n.pendingPayment.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Total Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:n.totalTransactions})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Category"}),e.jsx("span",{className:"font-bold text-primary",children:s.category})]}),s.products&&e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Products/Services"}),e.jsx("span",{className:"font-semibold text-primary text-right",children:s.products})]})]})]})]})]}),u.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(se,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Spending Trend (Last 12 Months)"})]}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(Et,{data:u,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Te,{dataKey:"month",stroke:"#6B5A4C",style:{fontSize:"12px"}}),e.jsx(Le,{stroke:"#6B5A4C",style:{fontSize:"12px"},tickFormatter:x=>`â‚¹${x}`}),e.jsx(je,{contentStyle:{backgroundColor:"#fff",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},formatter:x=>[`â‚¹${x.toFixed(0)}`,"Spending"]}),e.jsx($e,{type:"monotone",dataKey:"amount",stroke:"#8B9A7E",strokeWidth:3,dot:{fill:"#8B9A7E",r:4},activeDot:{r:6}})]})})]})]})}function fn({vendorId:s}){const[n,c]=o.useState([]),[u,l]=o.useState([]),[m,p]=o.useState("all");o.useEffect(()=>{x()},[s]),o.useEffect(()=>{b()},[n,m]);const x=async()=>{try{const{data:a,error:k}=await C.from("vendor_transactions").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(k)throw k;c(a||[])}catch(a){console.error("Error fetching transactions:",a)}},b=()=>{l(m==="all"?n:n.filter(a=>a.status===m))},f=u.reduce((a,k)=>a+parseFloat(k.amount),0),t=u.filter(a=>a.status==="paid").reduce((a,k)=>a+parseFloat(k.amount),0),i=u.filter(a=>a.status==="pending").reduce((a,k)=>a+parseFloat(k.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Bs,{className:"w-5 h-5 text-dark-brown/60"}),e.jsxs("select",{value:m,onChange:a=>p(a.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Transactions"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Transaction"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Transactions"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",f.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[u.length," transactions"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",t.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[u.filter(a=>a.status==="paid").length," transactions"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",i.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[u.filter(a=>a.status==="pending").length," transactions"]})]})]}),e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Payment Mode"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Invoice #"})]})}),e.jsx("tbody",{children:u.map((a,k)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${k%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:new Date(a.date).toLocaleDateString()})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${a.transaction_type==="expense"?"bg-accent/10 text-accent":"bg-sage/10 text-sage"}`,children:a.transaction_type})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:a.description||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4 text-sage"}),e.jsxs("span",{className:"text-sm font-bold text-sage",children:["â‚¹",parseFloat(a.amount).toFixed(2)]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:a.payment_mode||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${a.status==="paid"?"bg-sage/10 text-sage":"bg-soft-red/10 text-soft-red"}`,children:a.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:a.invoice_number||"-"})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(qe,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No transactions found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Start by adding your first transaction"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Transaction"})]})})]})}function gn({vendorId:s}){const[n,c]=o.useState([]);o.useEffect(()=>{u()},[s]);const u=async()=>{try{const{data:t,error:i}=await C.from("vendor_invoices").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(i)throw i;c(t||[])}catch(t){console.error("Error fetching invoices:",t)}},l=t=>{switch(t){case"paid":return e.jsx(Q,{className:"w-5 h-5 text-sage"});case"overdue":return e.jsx(fe,{className:"w-5 h-5 text-soft-red"});default:return e.jsx(oe,{className:"w-5 h-5 text-accent"})}},m=t=>{switch(t){case"paid":return"bg-sage/10 text-sage";case"overdue":return"bg-soft-red/10 text-soft-red";default:return"bg-accent/10 text-accent"}},p=n.reduce((t,i)=>t+parseFloat(i.amount),0),x=n.filter(t=>t.status==="paid").reduce((t,i)=>t+parseFloat(i.amount),0),b=n.filter(t=>t.status==="pending").reduce((t,i)=>t+parseFloat(i.amount),0),f=n.filter(t=>t.status==="overdue").reduce((t,i)=>t+parseFloat(i.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Invoice Management"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Upload Invoice"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Invoices"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",p.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.length," invoices"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",x.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.filter(t=>t.status==="paid").length," invoices"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",b.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.filter(t=>t.status==="pending").length," invoices"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Overdue"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",f.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.filter(t=>t.status==="overdue").length," invoices"]})]})]}),e.jsx("div",{className:"space-y-4",children:n.length>0?n.map(t=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ae,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary",children:["Invoice #",t.invoice_number]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Date: ",new Date(t.date).toLocaleDateString()," | Due: ",new Date(t.due_date).toLocaleDateString()]})]})]}),t.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2",children:t.notes})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",parseFloat(t.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l(t.status),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${m(t.status)}`,children:t.status})]}),t.status!=="paid"&&e.jsx("button",{className:"px-4 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg font-semibold transition-colors",children:"Mark as Paid"})]})]}),t.paid_date&&e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Paid on: ",new Date(t.paid_date).toLocaleDateString()," | Amount: â‚¹",parseFloat(t.paid_amount).toFixed(2)]})})]},t.id)):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No invoices found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Upload your first invoice to get started"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Invoice"})]})})]})}function jn({vendorId:s}){const[n,c]=o.useState([]);o.useEffect(()=>{u()},[s]);const u=async()=>{try{const{data:l,error:m}=await C.from("vendor_prices").select("*").eq("vendor_id",s).order("product_name");if(m)throw m;c(l||[])}catch(l){console.error("Error fetching prices:",l)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Price List"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Price Item"]})]}),n.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Product/Service"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Unit"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Price"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"MOQ"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Lead Time"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Last Updated"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((l,m)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${m%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:l.product_name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-semibold",children:l.category||"General"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:l.unit})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-lg font-bold text-sage",children:["â‚¹",parseFloat(l.price).toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:l.moq||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:l.lead_time?`${l.lead_time} days`:"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/60",children:new Date(l.updated_at).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-primary/10 text-primary rounded-lg transition-colors",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-accent/10 text-accent rounded-lg transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]})})]},l.id))})]})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ne,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No price items found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add price items to track vendor pricing"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Price Item"})]})]})}const Ds=[{id:"contracts",label:"Contracts & Agreements",icon:"ðŸ“„"},{id:"gst",label:"GST Certificate",icon:"ðŸ“œ"},{id:"certifications",label:"Quality Certifications",icon:"ðŸ†"},{id:"catalogs",label:"Product Catalogs",icon:"ðŸ“‹"},{id:"reports",label:"Test Reports",icon:"ðŸ“Š"},{id:"other",label:"Other Documents",icon:"ðŸ’¼"}];function yn({vendorId:s}){const[n,c]=o.useState([]),[u,l]=o.useState("all");o.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:f,error:t}=await C.from("vendor_documents").select("*").eq("vendor_id",s).order("uploaded_at",{ascending:!1});if(t)throw t;c(f||[])}catch(f){console.error("Error fetching documents:",f)}},p=u==="all"?n:n.filter(f=>f.category===u),x=f=>Ds.find(t=>t.id===f)||{icon:"ðŸ“„",label:f},b=f=>f<1024?f+" B":f<1024*1024?(f/1024).toFixed(1)+" KB":(f/(1024*1024)).toFixed(1)+" MB";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Documents"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Upload Document"]})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>l("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",n.length,")"]}),Ds.map(f=>{const t=n.filter(i=>i.category===f.id).length;return e.jsxs("button",{onClick:()=>l(f.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u===f.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:f.icon}),f.label," (",t,")"]},f.id)})]}),p.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(f=>{const t=x(f.category);return e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl flex-shrink-0",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:f.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:t.label})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60 mb-3",children:[e.jsx("span",{children:b(f.file_size||0)}),e.jsx("span",{children:new Date(f.uploaded_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]})]},f.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:u==="all"?"Upload documents to keep vendor information organized":`No ${x(u).label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Document"})]})]})}const Qt=[{id:"quality",label:"Product Quality"},{id:"delivery",label:"Delivery Time"},{id:"pricing",label:"Pricing"},{id:"service",label:"Customer Service"},{id:"reliability",label:"Reliability"}];function wn({vendorId:s,vendorRating:n}){const{user:c}=H(),[u,l]=o.useState([]),[m,p]=o.useState([]),[x,b]=o.useState(""),[f,t]=o.useState(!1),[i,a]=o.useState({category:"quality",rating:5,text:""});o.useEffect(()=>{k(),N()},[s]);const k=async()=>{try{const{data:h,error:d}=await C.from("vendor_notes").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(d)throw d;l(h||[])}catch(h){console.error("Error fetching notes:",h)}},N=async()=>{try{const{data:h,error:d}=await C.from("vendor_reviews").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(d)throw d;p(h||[])}catch(h){console.error("Error fetching reviews:",h)}},j=async()=>{if(x.trim())try{const{error:h}=await C.from("vendor_notes").insert([{vendor_id:s,note_text:x,written_by:c?.id}]);if(h)throw h;b(""),k()}catch(h){console.error("Error adding note:",h),alert("Error adding note")}},_=async()=>{if(!i.text.trim()){alert("Please write a review");return}try{const{error:h}=await C.from("vendor_reviews").insert([{vendor_id:s,category:i.category,rating:i.rating,review_text:i.text,reviewed_by:c?.id}]);if(h)throw h;a({category:"quality",rating:5,text:""}),t(!1),N()}catch(h){console.error("Error adding review:",h),alert("Error adding review")}},w=(h,d=!1,r)=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(v=>e.jsx("button",{type:"button",onClick:()=>d&&r&&r(v),disabled:!d,className:d?"cursor-pointer":"",children:e.jsx(ut,{className:`w-5 h-5 ${v<=h?"fill-amber-400 text-amber-400":"text-dark-brown/20"} ${d?"hover:fill-amber-400 hover:text-amber-400":""}`})},v))}),y=h=>{const d=m.filter(r=>r.category===h);return d.length===0?0:d.reduce((r,v)=>r+v.rating,0)/d.length};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Internal Notes"})}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:[e.jsx("textarea",{value:x,onChange:h=>b(h.target.value),placeholder:"Add a note about this vendor...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none mb-3"}),e.jsxs("button",{onClick:j,disabled:!x.trim(),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all disabled:opacity-50",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Note"]})]}),e.jsx("div",{className:"space-y-3",children:u.length>0?u.map(h=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Oe,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"User"}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[new Date(h.created_at).toLocaleDateString()," at"," ",new Date(h.created_at).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1 hover:bg-primary/10 text-primary rounded transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:h.note_text})]},h.id)):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx($t,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No notes yet"})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Ratings & Reviews"}),e.jsxs("button",{onClick:()=>t(!f),className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Review"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-amber-600/10 rounded-xl p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-5xl font-bold text-amber-600 mb-2",children:n?.toFixed(1)||"0.0"}),w(n||0),e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-2",children:["Based on ",m.length," reviews"]})]}),e.jsx("div",{className:"space-y-2",children:Qt.map(h=>{const d=y(h.id);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:h.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[w(d),e.jsx("span",{className:"text-sm text-dark-brown/60 w-8",children:d>0?d.toFixed(1):"-"})]})]},h.id)})})]}),f&&e.jsx("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:i.category,onChange:h=>a({...i,category:h.target.value}),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:Qt.map(h=>e.jsx("option",{value:h.id,children:h.label},h.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),w(i.rating,!0,h=>a({...i,rating:h}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Review"}),e.jsx("textarea",{value:i.text,onChange:h=>a({...i,text:h.target.value}),placeholder:"Write your review...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(!1),className:"flex-1 px-4 py-2 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:_,className:"flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-amber-600 text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Submit Review"})]})]})}),e.jsx("div",{className:"space-y-3",children:m.length>0?m.map(h=>{const d=Qt.find(r=>r.id===h.category);return e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:d?.label}),w(h.rating)]}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(h.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:h.review_text})]},h.id)}):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ut,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No reviews yet"})]})})]})]})})}const Nn=[{id:"overview",label:"Overview",icon:mt},{id:"transactions",label:"Transactions",icon:ht},{id:"invoices",label:"Invoices",icon:Mt},{id:"prices",label:"Price List",icon:gt},{id:"documents",label:"Documents",icon:ae},{id:"notes",label:"Notes & Reviews",icon:$t}],vn=s=>({"Raw Materials":"bg-sage/20",Packaging:"bg-secondary/20",Printing:"bg-blue-500/20",Logistics:"bg-accent/20","Lab Testing":"bg-purple-500/20",Other:"bg-dark-brown/20"})[s]||"bg-dark-brown/10";function kn(){const{id:s}=Je(),n=de(),[c,u]=o.useState(null),[l,m]=o.useState("overview"),[p,x]=o.useState(!0);o.useEffect(()=>{s&&b()},[s]);const b=async()=>{try{const{data:i,error:a}=await C.from("vendors").select("*").eq("id",s).maybeSingle();if(a)throw a;u(i)}catch(i){console.error("Error fetching vendor:",i)}finally{x(!1)}},f=async()=>{if(confirm("Are you sure you want to delete this vendor? This action cannot be undone."))try{const{error:i}=await C.from("vendors").delete().eq("id",s);if(i)throw i;n("/vendors")}catch(i){console.error("Error deleting vendor:",i),alert("Error deleting vendor")}},t=i=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(a=>e.jsx(ut,{className:`w-5 h-5 ${a<=i?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},a))});return p?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading vendor details..."})]})})}):c?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/vendors"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Vendors"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start gap-4 mb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-2",children:c.name}),e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${vn(c.category)} rounded-full text-sm font-semibold`,children:c.category})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[t(c.current_rating||3),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown/60",children:[c.current_rating?.toFixed(1)||"3.0"," / 5.0"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{},className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4"}),"Delete"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:Nn.map(i=>{const a=i.icon;return e.jsxs("button",{onClick:()=>m(i.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${l===i.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(a,{className:"w-5 h-5"}),i.label]},i.id)})})}),e.jsxs("div",{className:"p-6",children:[l==="overview"&&e.jsx(un,{vendor:c,onUpdate:b}),l==="transactions"&&e.jsx(fn,{vendorId:c.id}),l==="invoices"&&e.jsx(gn,{vendorId:c.id}),l==="prices"&&e.jsx(jn,{vendorId:c.id}),l==="documents"&&e.jsx(yn,{vendorId:c.id}),l==="notes"&&e.jsx(wn,{vendorId:c.id,vendorRating:c.current_rating})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Vendor not found"}),e.jsx("button",{onClick:()=>n("/vendors"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Vendors"})]})})})}function _n({products:s,onClose:n,onSuccess:c}){const{user:u}=H(),[l,m]=o.useState(!1),[p,x]=o.useState(null),[b,f]=o.useState({batchNumber:"",manufacturingDate:q(new Date,"yyyy-MM-dd"),batchSize:"",expiryDate:"",storageLocation:"",qcNotes:""}),[t,i]=o.useState([]),[a,k]=o.useState({ingredientsVerified:!1,formulaFollowed:!1,phTestPassed:!1,visualInspectionPassed:!1,packagingChecked:!1,labelsApplied:!1,batchApproved:!1});o.useEffect(()=>{p&&(N(),j(),_())},[p]);const N=()=>{const r=q(new Date,"yyyyMMdd"),v=p?.name?.substring(0,3).toUpperCase()||"PRD",g="001";f(D=>({...D,batchNumber:`BT-${v}-${r}-${g}`}))},j=()=>{const r=p?.shelf_life||24,v=Ps(new Date(b.manufacturingDate),r);f(g=>({...g,expiryDate:q(v,"yyyy-MM-dd")}))},_=async()=>{if(p?.id)try{const{data:r,error:v}=await C.from("product_ingredients").select("*").eq("product_id",p.id);if(v)throw v;r&&r.length>0?i(r.map(g=>({name:g.ingredient_name,lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:g.quantity||"",unit:g.unit||"kg"}))):i([])}catch(r){console.error("Error loading ingredients:",r)}},w=()=>{i([...t,{name:"",lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:"",unit:"kg"}])},y=r=>{i(t.filter((v,g)=>g!==r))},h=(r,v,g)=>{const D=[...t];D[r]={...D[r],[v]:g},i(D)},d=async r=>{if(r.preventDefault(),!p||!b.batchNumber||!b.batchSize){alert("Please fill in all required fields");return}m(!0);try{const{data:v,error:g}=await C.from("batches").insert([{batch_number:b.batchNumber,product_id:p.id,manufacturing_date:b.manufacturingDate,expiry_date:b.expiryDate,batch_size:parseInt(b.batchSize),units_in_stock:parseInt(b.batchSize),storage_location:b.storageLocation,qc_checklist:a,qc_notes:b.qcNotes,qc_approved:a.batchApproved,status:"active",created_by:u?.id}]).select().single();if(g)throw g;if(t.length>0&&v){const D=t.filter(T=>T.name).map(T=>({batch_id:v.id,ingredient_name:T.name,lot_number:T.lotNumber,supplier_batch_number:T.supplierBatchNumber,vendor_id:T.vendorId,ingredient_expiry_date:T.ingredientExpiryDate||null,quantity_used:T.quantityUsed?parseFloat(T.quantityUsed):null,unit:T.unit}));if(D.length>0){const{error:T}=await C.from("batch_ingredients").insert(D);if(T)throw T}}c()}catch(v){console.error("Error creating batch:",v),alert("Error creating batch. Please try again.")}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Create New Batch"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:p?.id||"",onChange:r=>{const v=s.find(g=>g.id===r.target.value);x(v)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select a product"}),s.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:b.batchNumber,onChange:r=>f({...b,batchNumber:r.target.value}),placeholder:"BT-PRD-20241215-001",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Size (units) ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"number",value:b.batchSize,onChange:r=>f({...b,batchSize:r.target.value}),placeholder:"500",required:!0,min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Manufacturing Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:b.manufacturingDate,onChange:r=>{f({...b,manufacturingDate:r.target.value}),p&&j()},max:q(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:b.expiryDate,onChange:r=>f({...b,expiryDate:r.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:b.storageLocation,onChange:r=>f({...b,storageLocation:r.target.value}),placeholder:"e.g., Section A, Shelf 3",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Ingredients Used (Lot Tracking)"}),e.jsxs("button",{type:"button",onClick:w,className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Ingredient"]})]}),t.length>0?e.jsx("div",{className:"space-y-4",children:t.map((r,v)=>e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Ingredient #",v+1]}),e.jsx("button",{type:"button",onClick:()=>y(v),className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Name"}),e.jsx("input",{type:"text",value:r.name,onChange:g=>h(v,"name",g.target.value),placeholder:"e.g., Ashwagandha Powder",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Lot Number"}),e.jsx("input",{type:"text",value:r.lotNumber,onChange:g=>h(v,"lotNumber",g.target.value),placeholder:"Internal lot number",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Supplier Batch Number"}),e.jsx("input",{type:"text",value:r.supplierBatchNumber,onChange:g=>h(v,"supplierBatchNumber",g.target.value),placeholder:"Supplier's batch",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Quantity Used"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:r.quantityUsed,onChange:g=>h(v,"quantityUsed",g.target.value),placeholder:"Amount",step:"0.01",className:"flex-1 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:r.unit,onChange:g=>h(v,"unit",g.target.value),className:"px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"l",children:"l"}),e.jsx("option",{value:"ml",children:"ml"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Expiry Date"}),e.jsx("input",{type:"date",value:r.ingredientExpiryDate,onChange:g=>h(v,"ingredientExpiryDate",g.target.value),className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]},v))}):e.jsx("p",{className:"text-sm text-dark-brown/60 text-center py-4",children:"No ingredients added yet. Add ingredients to enable full traceability."})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality Control"}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.ingredientsVerified,onChange:r=>k({...a,ingredientsVerified:r.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"All ingredients verified"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.formulaFollowed,onChange:r=>k({...a,formulaFollowed:r.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Formula followed correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.phTestPassed,onChange:r=>k({...a,phTestPassed:r.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"pH test passed (if applicable)"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.visualInspectionPassed,onChange:r=>k({...a,visualInspectionPassed:r.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Visual inspection passed"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.packagingChecked,onChange:r=>k({...a,packagingChecked:r.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Packaging quality checked"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.labelsApplied,onChange:r=>k({...a,labelsApplied:r.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Labels applied correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.batchApproved,onChange:r=>k({...a,batchApproved:r.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Batch approved for distribution"})]}),e.jsxs("div",{className:"pt-3 border-t border-dark-brown/10",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC Notes"}),e.jsx("textarea",{value:b.qcNotes,onChange:r=>f({...b,qcNotes:r.target.value}),placeholder:"Any additional quality control notes...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:d,disabled:l,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:l?"Creating...":"Create Batch"})]})]})})}function Cn(){const[s,n]=o.useState([]),[c,u]=o.useState([]),[l,m]=o.useState([]),[p,x]=o.useState(""),[b,f]=o.useState("all"),[t,i]=o.useState(!1),[a,k]=o.useState({activeBatches:0,totalUnits:0,expiringSoon:0,productsWithBatches:0});o.useEffect(()=>{N(),j()},[]),o.useEffect(()=>{_(),w()},[s,p,b]);const N=async()=>{try{const{data:r,error:v}=await C.from("batches").select("*, products(name, images)").order("created_at",{ascending:!1});if(v)throw v;n(r||[])}catch(r){console.error("Error fetching batches:",r)}},j=async()=>{try{const{data:r,error:v}=await C.from("products").select("id, name, images").order("name");if(v)throw v;m(r||[])}catch(r){console.error("Error fetching products:",r)}},_=()=>{let r=s;if(b!=="all"&&(r=r.filter(v=>v.status===b)),p){const v=p.toLowerCase();r=r.filter(g=>g.batch_number?.toLowerCase().includes(v)||g.products?.name?.toLowerCase().includes(v))}u(r)},w=()=>{const r=new Date,v=s.filter(A=>A.status==="active").length,g=s.reduce((A,P)=>A+(P.units_in_stock||0),0),D=s.filter(A=>{const P=X(new Date(A.expiry_date),r);return P<=30&&P>=0}).length,T=new Set(s.map(A=>A.product_id)).size;k({activeBatches:v,totalUnits:g,expiringSoon:D,productsWithBatches:T})},y=r=>{const v=X(new Date(r),new Date);return v<0||v<=15?"text-soft-red":v<=30?"text-accent":v<=60?"text-amber-500":"text-sage"},h=r=>{const v=X(new Date(r.expiry_date),new Date);return r.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:v<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:r.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:v<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:r.units_in_stock<r.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:r.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}},d=r=>r.units_in_stock/r.batch_size*100;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(Z,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Batch & Lot Tracking"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Complete traceability for manufacturing"})]}),e.jsxs(ue,{onClick:()=>i(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"New Batch"]})]})]}),e.jsxs(ue,{onClick:()=>i(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"New Batch"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(Q,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:a.activeBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active Batches"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(ne,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:a.totalUnits})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Units in Stock"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(he,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:`text-3xl font-bold ${a.expiringSoon>0?"text-accent":"text-primary/40"}`,children:a.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring Soon (30d)"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-blue-500/20 rounded-button",children:e.jsx(oe,{className:"w-6 h-6 text-blue-500"})}),e.jsx("span",{className:"text-3xl font-bold text-blue-500",children:a.productsWithBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Products with Batches"})]})]}),e.jsx(Z,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:()=>f("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${b==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All Batches (",s.length,")"]}),e.jsxs("button",{onClick:()=>f("active"),className:`px-4 py-2 rounded-button font-bold transition-all ${b==="active"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Active (",s.filter(r=>r.status==="active").length,")"]}),e.jsxs("button",{onClick:()=>f("sold_out"),className:`px-4 py-2 rounded-button font-bold transition-all ${b==="sold_out"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Sold Out (",s.filter(r=>r.status==="sold_out").length,")"]})]}),e.jsxs("div",{className:"relative w-full lg:w-64",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:p,onChange:r=>x(r.target.value),placeholder:"Search batches...",className:"input-float w-full pl-12"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(r=>{const v=h(r),g=d(r),D=X(new Date(r.expiry_date),new Date);return e.jsx(Ne,{to:`/batches/${r.id}`,className:"block",children:e.jsx(Z,{className:"hover:shadow-glow transition-all duration-300 group h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${v.color}`,children:[e.jsx("span",{className:"mr-1",children:v.icon}),v.label]})}),e.jsx("h3",{className:"font-mono text-lg font-bold text-primary group-hover:text-accent transition-colors mb-1",children:r.batch_number}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:r.products?.name||"Unknown Product"})]}),e.jsx(Gs,{className:"w-8 h-8 text-dark-brown/20 group-hover:text-primary transition-colors"})]}),r.products?.images&&r.products.images[0]&&e.jsx("div",{className:"w-full h-32 mb-4 rounded-lg overflow-hidden bg-cream",children:e.jsx("img",{src:r.products.images[0],alt:r.products.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Manufacturing"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:q(new Date(r.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Expiry"}),e.jsxs("span",{className:`font-semibold ${y(r.expiry_date)}`,children:[q(new Date(r.expiry_date),"MMM dd, yyyy"),e.jsxs("span",{className:"text-xs ml-1",children:["(",D>=0?`${D}d left`:"Expired",")"]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Stock Status"}),e.jsxs("span",{className:"font-bold text-primary",children:[r.units_in_stock," / ",r.batch_size," units"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${g>50?"bg-sage":g>20?"bg-amber-500":"bg-soft-red"}`,style:{width:`${g}%`}})})]}),r.qc_approved&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-sage",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold",children:"QC Approved"})]})]})})},r.id)})}),c.length===0&&e.jsxs(Z,{className:"text-center py-16",children:[e.jsx(ne,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No batches found"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:p?"Try adjusting your search":"Create your first batch to start tracking"}),!p&&e.jsx(ue,{onClick:()=>i(!0),variant:"primary",size:"lg",children:"Create Batch"})]})]}),t&&e.jsx(_n,{products:l,onClose:()=>i(!1),onSuccess:()=>{i(!1),N()}})]})}function Sn({batch:s}){const[n,c]=o.useState([]);o.useEffect(()=>{u()},[s.id]);const u=async()=>{try{const{data:p,error:x}=await C.from("batch_ingredients").select("*, vendors(name)").eq("batch_id",s.id);if(x)throw x;c(p||[])}catch(p){console.error("Error fetching ingredients:",p)}},l=X(new Date(s.expiry_date),new Date),m=s.units_in_stock/s.batch_size*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ne,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Batch Number"}),e.jsx("p",{className:"font-mono font-bold text-dark-brown",children:s.batch_number})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ“…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:q(new Date(s.manufacturing_date),"MMMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"â°"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:q(new Date(s.expiry_date),"MMMM dd, yyyy")}),e.jsx("p",{className:`text-xs mt-1 font-semibold ${l<0?"text-soft-red":l<=30?"text-accent":l<=60?"text-amber-500":"text-sage"}`,children:l>=0?`${l} days remaining`:"Expired"})]})]}),s.storage_location&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ws,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Storage Location"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.storage_location})]})]}),s.qc_approved&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-sage/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"w-5 h-5 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Quality Control"}),e.jsx("p",{className:"font-semibold text-sage",children:"Approved"}),s.qc_approved_date&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["on ",q(new Date(s.qc_approved_date),"MMM dd, yyyy")]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Produced"}),e.jsx("p",{className:"text-3xl font-bold",children:s.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_in_stock})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Sold"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_sold||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_damaged||0})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Remaining"}),e.jsxs("span",{className:"font-bold",children:[m.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all",style:{width:`${m}%`}})})]})]}),s.products&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Product Details"}),e.jsxs("div",{className:"flex items-start gap-4",children:[s.products.images&&s.products.images[0]&&e.jsx("img",{src:s.products.images[0],alt:s.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:s.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",s.batch_number]})]})]})]})]})]}),n.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Ingredient Traceability"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"Complete ingredient lot tracking for full traceability"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Supplier Batch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity Used"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry"})]})}),e.jsx("tbody",{children:n.map((p,x)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${x%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:p.ingredient_name}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:p.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:p.supplier_batch_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:p.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:p.quantity_used?`${p.quantity_used} ${p.unit}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:p.ingredient_expiry_date?q(new Date(p.ingredient_expiry_date),"MMM dd, yyyy"):"-"})]},p.id))})]})})]})]})}function Dn({batchId:s,batch:n}){const[c,u]=o.useState([]);o.useEffect(()=>{l()},[s]);const l=async()=>{try{const{data:x,error:b}=await C.from("batch_tests").select("*").eq("batch_id",s).order("test_date",{ascending:!1});if(b)throw b;u(x||[])}catch(x){console.error("Error fetching tests:",x)}},m=n.qc_checklist||{},p=[{key:"ingredientsVerified",label:"All ingredients verified"},{key:"formulaFollowed",label:"Formula followed correctly"},{key:"phTestPassed",label:"pH test passed"},{key:"visualInspectionPassed",label:"Visual inspection passed"},{key:"packagingChecked",label:"Packaging quality checked"},{key:"labelsApplied",label:"Labels applied correctly"},{key:"batchApproved",label:"Batch approved for distribution"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"QC Checklist"}),n.qc_approved&&e.jsxs("span",{className:"flex items-center gap-2 px-3 py-1 bg-sage/10 text-sage rounded-full text-sm font-bold",children:[e.jsx(Q,{className:"w-4 h-4"}),"Approved"]})]}),e.jsx("div",{className:"space-y-3",children:p.map(x=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[m[x.key]?e.jsx(Q,{className:"w-5 h-5 text-sage flex-shrink-0"}):e.jsx(Me,{className:"w-5 h-5 text-dark-brown/20 flex-shrink-0"}),e.jsx("span",{className:`text-sm font-semibold ${m[x.key]?"text-dark-brown":"text-dark-brown/40"}`,children:x.label})]},x.key))}),n.qc_notes&&e.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-2",children:"QC Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:n.qc_notes})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Test Results"}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Test"]})]}),c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(x=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:x.test_type}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${x.result.toLowerCase().includes("pass")?"bg-sage/10 text-sage":x.result.toLowerCase().includes("fail")?"bg-soft-red/10 text-soft-red":"bg-accent/10 text-accent"}`,children:x.result})]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Tested on: ",new Date(x.test_date).toLocaleDateString()]}),x.notes&&e.jsx("p",{className:"text-sm text-dark-brown mt-2",children:x.notes})]},x.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No test results recorded"})]})]})})]})})}function Mn({batchId:s,batch:n,onUpdate:c}){const[u,l]=o.useState([]),[m,p]=o.useState([]);o.useEffect(()=>{x(),b()},[s]);const x=async()=>{try{const{data:f,error:t}=await C.from("batch_dispatches").select("*").eq("batch_id",s).order("dispatch_date",{ascending:!1});if(t)throw t;l(f||[])}catch(f){console.error("Error fetching dispatches:",f)}},b=async()=>{try{const{data:f,error:t}=await C.from("batch_stock_adjustments").select("*").eq("batch_id",s).order("adjustment_date",{ascending:!1});if(t)throw t;p(f||[])}catch(f){console.error("Error fetching adjustments:",f)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Units"}),e.jsx("p",{className:"text-3xl font-bold",children:n.batch_size})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:n.units_in_stock})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Sold/Dispatched"}),e.jsx("p",{className:"text-3xl font-bold text-blue-500",children:n.units_sold||0})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:n.units_damaged||0})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Dispatch History"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-4 h-4"}),"Record Dispatch"]})]}),u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Dispatch To"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Invoice #"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"})]})}),e.jsx("tbody",{children:u.map((f,t)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${t%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:q(new Date(f.dispatch_date),"MMM dd, yyyy")})]})}),e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:f.dispatch_to}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[f.quantity," units"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70 font-mono",children:f.invoice_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:f.dispatch_method||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f.status==="delivered"?"bg-sage/10 text-sage":"bg-accent/10 text-accent"}`,children:f.status})})]},f.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"No dispatches recorded"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Record First Dispatch"})]})]}),m.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Adjustments"}),e.jsx("div",{className:"space-y-3",children:m.map(f=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-soft-red/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(we,{className:"w-5 h-5 text-soft-red"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown capitalize",children:f.adjustment_type}),e.jsxs("span",{className:"font-bold text-soft-red",children:["-",f.quantity," units"]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-1",children:f.reason}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:q(new Date(f.adjustment_date),"MMM dd, yyyy")}),f.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2 italic",children:f.notes})]})]},f.id))})]})]})}const Yt=[{id:"product",label:"Product Photos",icon:"ðŸ“¦"},{id:"packaging",label:"Packaging Photos",icon:"ðŸ“¦"},{id:"label",label:"Label Photos",icon:"ðŸ·ï¸"},{id:"qc",label:"QC Photos",icon:"âœ…"},{id:"process",label:"Process Photos",icon:"âš™ï¸"}];function En({batchId:s}){const[n,c]=o.useState([]),[u,l]=o.useState("all");o.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:x,error:b}=await C.from("batch_photos").select("*").eq("batch_id",s).order("uploaded_at",{ascending:!1});if(b)throw b;c(x||[])}catch(x){console.error("Error fetching photos:",x)}},p=u==="all"?n:n.filter(x=>x.category===u);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>l("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Photos (",n.length,")"]}),Yt.map(x=>{const b=n.filter(f=>f.category===x.id).length;return e.jsxs("button",{onClick:()=>l(x.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u===x.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:x.icon}),x.label," (",b,")"]},x.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-4 h-4"}),"Upload Photos"]})]}),p.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:p.map(x=>{const b=Yt.find(f=>f.id===x.category);return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all group",children:[e.jsxs("div",{className:"aspect-square bg-cream relative",children:[e.jsx("img",{src:x.photo_url,alt:b?.label||"Batch photo",className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}),e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 bg-white/90 backdrop-blur-sm rounded-lg text-xs font-semibold",children:[b?.icon," ",b?.label]})]}),e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(x.uploaded_at).toLocaleDateString()})})]},x.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ns,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No photos uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:u==="all"?"Upload photos to document this batch":`No ${Yt.find(x=>x.id===u)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Photo"})]})]})}const Pn={batch_created:"ðŸŽ‰",status_changed:"ðŸ”„",dispatch:"ðŸ“¤",stock_adjustment:"ðŸ“Š",qc_approved:"âœ…",test_added:"ðŸ§ª",photo_uploaded:"ðŸ“¸",ingredient_added:"ðŸŒ¿"},An={batch_created:"bg-sage/10 text-sage",status_changed:"bg-blue-500/10 text-blue-500",dispatch:"bg-accent/10 text-accent",stock_adjustment:"bg-soft-red/10 text-soft-red",qc_approved:"bg-sage/10 text-sage",test_added:"bg-purple-500/10 text-purple-500",photo_uploaded:"bg-blue-500/10 text-blue-500",ingredient_added:"bg-primary/10 text-primary"};function In({batchId:s}){const[n,c]=o.useState([]),[u,l]=o.useState(!0);o.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:p,error:x}=await C.from("batch_activity_log").select("*").eq("batch_id",s).order("created_at",{ascending:!1});if(x)throw x;c(p||[])}catch(p){console.error("Error fetching activities:",p)}finally{l(!1)}};return u?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading activity log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-sage/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Xt,{className:"w-6 h-6 text-primary"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Complete Traceability Log"})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"Full audit trail of all activities and changes for this batch. Every action is logged for compliance and quality assurance."})]}),n.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-dark-brown/10"}),e.jsx("div",{className:"space-y-6",children:n.map((p,x)=>{const b=Pn[p.activity_type]||"ðŸ“",f=An[p.activity_type]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:`absolute left-4 w-8 h-8 rounded-full ${f} flex items-center justify-center text-lg z-10`,children:b}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-1",children:p.activity_description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsxs("span",{children:[q(new Date(p.created_at),"MMM dd, yyyy")," at"," ",q(new Date(p.created_at),"HH:mm")]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f}`,children:p.activity_type.replace("_"," ")})]}),p.details&&Object.keys(p.details).length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/5",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(p.details).map(([t,i])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1 capitalize",children:t.replace(/_/g," ")}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:typeof i=="object"?JSON.stringify(i):String(i)})]},t))})})]})]},p.id)})})]}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Xt,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity will be logged automatically as actions are performed on this batch"})]})]})}const Fn=[{id:"overview",label:"Overview",icon:mt},{id:"quality",label:"Quality & Testing",icon:Xs},{id:"inventory",label:"Inventory & Distribution",icon:ne},{id:"photos",label:"Photos & Documents",icon:Ia},{id:"traceability",label:"Traceability Log",icon:Xt}];function Tn(){const{id:s}=Je(),n=de(),[c,u]=o.useState(null),[l,m]=o.useState("overview"),[p,x]=o.useState(!0);o.useEffect(()=>{s&&b()},[s]);const b=async()=>{try{const{data:a,error:k}=await C.from("batches").select("*, products(name, images)").eq("id",s).maybeSingle();if(k)throw k;u(a)}catch(a){console.error("Error fetching batch:",a)}finally{x(!1)}},f=async()=>{if(confirm("Are you sure you want to delete this batch? This action cannot be undone."))try{const{error:a}=await C.from("batches").delete().eq("id",s);if(a)throw a;n("/batches")}catch(a){console.error("Error deleting batch:",a),alert("Error deleting batch")}},t=()=>{if(!c)return null;const a=X(new Date(c.expiry_date),new Date);return c.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:a<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:c.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:a<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:c.units_in_stock<c.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:c.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}};if(p)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading batch details..."})]})})});if(!c)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Batch not found"}),e.jsx("button",{onClick:()=>n("/batches"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Batches"})]})})});const i=t();return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/batches"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Batches"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[c.products?.images&&c.products.images[0]&&e.jsx("img",{src:c.products.images[0],alt:c.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-mono text-3xl font-bold text-primary mb-2",children:c.batch_number}),e.jsx("p",{className:"text-lg font-semibold text-dark-brown",children:c.products?.name||"Unknown Product"}),i&&e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 mt-2 ${i.color} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:i.icon}),i.label]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Gs,{className:"w-4 h-4"}),"QR Code"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Oa,{className:"w-4 h-4"}),"Print Labels"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),c.status!=="recalled"&&e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(Da,{className:"w-4 h-4"}),"Recall"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:q(new Date(c.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:q(new Date(c.expiry_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Units"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:c.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"In Stock"}),e.jsx("p",{className:"font-semibold text-sage",children:c.units_in_stock})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:Fn.map(a=>{const k=a.icon;return e.jsxs("button",{onClick:()=>m(a.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${l===a.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(k,{className:"w-5 h-5"}),a.label]},a.id)})})}),e.jsxs("div",{className:"p-6",children:[l==="overview"&&e.jsx(Sn,{batch:c,onUpdate:b}),l==="quality"&&e.jsx(Dn,{batchId:c.id,batch:c}),l==="inventory"&&e.jsx(Mn,{batchId:c.id,batch:c,onUpdate:b}),l==="photos"&&e.jsx(En,{batchId:c.id}),l==="traceability"&&e.jsx(In,{batchId:c.id})]})]})]})})}function Ln({vendors:s,onClose:n,onSuccess:c}){const{user:u}=H(),[l,m]=o.useState(!1),[p,x]=o.useState([]),[b,f]=o.useState(!1),[t,i]=o.useState(null),[a,k]=o.useState({ingredientId:"",purchaseDate:q(new Date,"yyyy-MM-dd"),quantity:"",expiryDate:"",lotNumber:"",vendorId:"",costPerUnit:"",invoiceNumber:"",storageLocation:"",notes:""}),[N,j]=o.useState({commonName:"",botanicalName:"",type:"herb",category:"raw_material",defaultUnit:"kg",typicalShelfLifeMonths:"24",reorderLevel:"",preferredVendorId:"",storageConditions:""});o.useEffect(()=>{_()},[]),o.useEffect(()=>{if(t){const h=t.typical_shelf_life_months||24,d=Ps(new Date(a.purchaseDate),h);k(r=>({...r,expiryDate:q(d,"yyyy-MM-dd")}))}},[t,a.purchaseDate]);const _=async()=>{try{const{data:h,error:d}=await C.from("ingredients").select("*").order("common_name");if(d)throw d;x(h||[])}catch(h){console.error("Error fetching ingredients:",h)}},w=async()=>{if(!N.commonName)return alert("Please enter ingredient name"),null;try{const{data:h,error:d}=await C.from("ingredients").insert([{common_name:N.commonName,botanical_name:N.botanicalName,type:N.type,category:N.category,default_unit:N.defaultUnit,typical_shelf_life_months:parseInt(N.typicalShelfLifeMonths),reorder_level:N.reorderLevel?parseFloat(N.reorderLevel):0,preferred_vendor_id:N.preferredVendorId||null,storage_conditions:N.storageConditions}]).select().single();if(d)throw d;return h}catch(h){return console.error("Error creating ingredient:",h),alert("Error creating ingredient"),null}},y=async h=>{h.preventDefault();let d=a.ingredientId;if(b){const r=await w();if(!r)return;d=r.id}if(!d||!a.quantity||!a.purchaseDate||!a.expiryDate){alert("Please fill in all required fields");return}m(!0);try{const r=parseFloat(a.quantity),v=t?.default_unit||N.defaultUnit,{error:g}=await C.from("ingredient_stock").insert([{ingredient_id:d,purchase_date:a.purchaseDate,expiry_date:a.expiryDate,quantity:r,original_quantity:r,unit:v,lot_number:a.lotNumber,vendor_id:a.vendorId||null,cost_per_unit:a.costPerUnit?parseFloat(a.costPerUnit):null,invoice_number:a.invoiceNumber,storage_location:a.storageLocation,status:"active",notes:a.notes,purchased_by:u?.id}]);if(g)throw g;c()}catch(r){console.error("Error adding stock:",r),alert("Error adding stock. Please try again.")}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:b?"Add New Ingredient & Stock":"Add Ingredient Stock"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[b?e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"New Ingredient Details"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"text-sm text-dark-brown/60 hover:text-dark-brown",children:"Cancel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Common Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:N.commonName,onChange:h=>j({...N,commonName:h.target.value}),placeholder:"e.g., Ashwagandha Powder",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical/Scientific Name"}),e.jsx("input",{type:"text",value:N.botanicalName,onChange:h=>j({...N,botanicalName:h.target.value}),placeholder:"e.g., Withania somnifera",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:N.type,onChange:h=>j({...N,type:h.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"herb",children:"Herb"}),e.jsx("option",{value:"oil",children:"Oil"}),e.jsx("option",{value:"powder",children:"Powder"}),e.jsx("option",{value:"extract",children:"Extract"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"fragrance",children:"Fragrance"}),e.jsx("option",{value:"active",children:"Active Ingredient"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:N.category,onChange:h=>j({...N,category:h.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"raw_material",children:"Raw Material"}),e.jsx("option",{value:"active_ingredient",children:"Active Ingredient"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"packaging",children:"Packaging"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Default Unit ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:N.defaultUnit,onChange:h=>j({...N,defaultUnit:h.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"kg",children:"kg (Kilograms)"}),e.jsx("option",{value:"g",children:"g (Grams)"}),e.jsx("option",{value:"L",children:"L (Liters)"}),e.jsx("option",{value:"ml",children:"ml (Milliliters)"}),e.jsx("option",{value:"pieces",children:"Pieces"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Typical Shelf Life (months)"}),e.jsx("input",{type:"number",value:N.typicalShelfLifeMonths,onChange:h=>j({...N,typicalShelfLifeMonths:h.target.value}),min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Reorder Level"}),e.jsx("input",{type:"number",value:N.reorderLevel,onChange:h=>j({...N,reorderLevel:h.target.value}),placeholder:"Minimum stock threshold",step:"0.01",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Preferred Vendor"}),e.jsxs("select",{value:N.preferredVendorId,onChange:h=>j({...N,preferredVendorId:h.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("textarea",{value:N.storageConditions,onChange:h=>j({...N,storageConditions:h.target.value}),placeholder:"e.g., Store in cool, dry place away from direct sunlight",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Select Ingredient ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("button",{type:"button",onClick:()=>f(!0),className:"text-sm text-primary font-semibold hover:underline",children:"+ Or add new ingredient"})]}),e.jsxs("select",{value:a.ingredientId,onChange:h=>{k({...a,ingredientId:h.target.value});const d=p.find(r=>r.id===h.target.value);i(d)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select an ingredient"}),p.map(h=>e.jsxs("option",{value:h.id,children:[h.common_name," ",h.botanical_name&&`(${h.botanical_name})`]},h.id))]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Purchase Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purchase Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.purchaseDate,onChange:h=>k({...a,purchaseDate:h.target.value}),max:q(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Quantity Purchased ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:a.quantity,onChange:h=>k({...a,quantity:h.target.value}),placeholder:"Amount",step:"0.01",min:"0",required:!0,className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("div",{className:"px-4 py-3 bg-dark-brown/5 rounded-xl font-semibold text-dark-brown flex items-center",children:t?.default_unit||N.defaultUnit})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.expiryDate,onChange:h=>k({...a,expiryDate:h.target.value}),min:a.purchaseDate,required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Lot/Batch Number"}),e.jsx("input",{type:"text",value:a.lotNumber,onChange:h=>k({...a,lotNumber:h.target.value}),placeholder:"Supplier's lot number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:a.vendorId,onChange:h=>k({...a,vendorId:h.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit"}),e.jsx("input",{type:"number",value:a.costPerUnit,onChange:h=>k({...a,costPerUnit:h.target.value}),placeholder:"â‚¹ per unit",step:"0.01",min:"0",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Invoice Number"}),e.jsx("input",{type:"text",value:a.invoiceNumber,onChange:h=>k({...a,invoiceNumber:h.target.value}),placeholder:"Purchase invoice number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:a.storageLocation,onChange:h=>k({...a,storageLocation:h.target.value}),placeholder:"e.g., Section B, Shelf 5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:h=>k({...a,notes:h.target.value}),placeholder:"Quality observations, storage instructions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:y,disabled:l,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:l?"Adding...":"Add to Inventory"})]})]})})}function $n(){const[s,n]=o.useState([]),[c,u]=o.useState([]),[l,m]=o.useState([]),[p,x]=o.useState(""),[b,f]=o.useState("list"),[t,i]=o.useState("all"),[a,k]=o.useState(!1),[N,j]=o.useState({expired:0,expiring15d:0,expiring30d:0,lowStock:0,reorderNeeded:0});o.useEffect(()=>{_(),w()},[]),o.useEffect(()=>{y(),h()},[s,p,t]);const _=async()=>{try{const{data:g,error:D}=await C.from("ingredient_inventory_summary").select("*").order("common_name");if(D)throw D;n(g||[])}catch(g){console.error("Error fetching ingredients:",g)}},w=async()=>{try{const{data:g,error:D}=await C.from("vendors").select("id, name").order("name");if(D)throw D;m(g||[])}catch(g){console.error("Error fetching vendors:",g)}},y=()=>{let g=s;if(t!=="all"&&(g=g.filter(D=>D.inventory_status===t)),p){const D=p.toLowerCase();g=g.filter(T=>T.common_name?.toLowerCase().includes(D)||T.botanical_name?.toLowerCase().includes(D)||T.type?.toLowerCase().includes(D))}u(g)},h=()=>{const g=new Date,D=s.filter(O=>O.earliest_expiry?X(new Date(O.earliest_expiry),g)<0:!1).length,T=s.filter(O=>{if(!O.earliest_expiry)return!1;const Y=X(new Date(O.earliest_expiry),g);return Y>=0&&Y<15}).length,A=s.filter(O=>{if(!O.earliest_expiry)return!1;const Y=X(new Date(O.earliest_expiry),g);return Y>=15&&Y<30}).length,P=s.filter(O=>O.inventory_status==="low_stock").length,U=s.filter(O=>O.total_stock<O.reorder_level&&O.reorder_level>0).length;j({expired:D,expiring15d:T,expiring30d:A,lowStock:P,reorderNeeded:U})},d=g=>{if(!g)return"text-dark-brown/40";const D=X(new Date(g),new Date);return D<0||D<=15?"text-soft-red":D<=30?"text-accent":D<=60?"text-amber-500":"text-sage"},r=g=>{const D={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return D[g]||D.good_stock},v=g=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[g.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(Z,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Ingredient Inventory"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Track stock levels, expiry dates, and reorder alerts"})]}),e.jsxs(ue,{onClick:()=>k(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Stock"]})]})]}),e.jsxs(ue,{onClick:()=>k(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Ingredient Stock"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx("button",{onClick:()=>i("expired"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${t==="expired"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”´"}),e.jsx("span",{className:`text-3xl font-bold ${N.expired>0?"text-soft-red":"text-primary/20"}`,children:N.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})}),e.jsx("button",{onClick:()=>i("expiring_soon"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_soon"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ "}),e.jsx("span",{className:`text-3xl font-bold ${N.expiring15d>0?"text-soft-red":"text-primary/20"}`,children:N.expiring15d})]}),e.jsxs("p",{className:"text-sm font-bold text-primary/70",children:["Expiring ","<","15 days"]})]})}),e.jsx("button",{onClick:()=>i("expiring_30d"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_30d"?"ring-2 ring-amber-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¡"}),e.jsx("span",{className:`text-3xl font-bold ${N.expiring30d>0?"text-amber-500":"text-primary/20"}`,children:N.expiring30d})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring 15-30 days"})]})}),e.jsx("button",{onClick:()=>i("low_stock"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${t==="low_stock"?"ring-2 ring-blue-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”µ"}),e.jsx("span",{className:`text-3xl font-bold ${N.lowStock>0?"text-blue-500":"text-primary/20"}`,children:N.lowStock})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Low Stock"})]})}),e.jsx("button",{onClick:()=>i(N.reorderNeeded>0?"low_stock":"all"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${N.reorderNeeded>0?"ring-2 ring-sage shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¢"}),e.jsx("span",{className:`text-3xl font-bold ${N.reorderNeeded>0?"text-sage":"text-primary/20"}`,children:N.reorderNeeded})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Reorder Needed"})]})})]}),e.jsx(Z,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>i("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All (",s.length,")"]}),e.jsx("button",{onClick:()=>i("good_stock"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="good_stock"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:"Good Stock"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:p,onChange:g=>x(g.target.value),placeholder:"Search ingredients...",className:"input-float w-full pl-12"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-primary/5 rounded-button p-1",children:[e.jsx("button",{onClick:()=>f("list"),className:`p-2 rounded-button transition-all ${b==="list"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>f("grid"),className:`p-2 rounded-button transition-all ${b==="grid"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(Vs,{className:"w-5 h-5"})})]})]})]})}),b==="list"?e.jsxs(Z,{className:"overflow-hidden p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Current Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Reorder Level"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Days Left"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:c.map((g,D)=>{const T=r(g.inventory_status),A=g.earliest_expiry?X(new Date(g.earliest_expiry),new Date):null;return e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${g.inventory_status==="expired"?"bg-soft-red/5":g.inventory_status==="expiring_soon"?"bg-accent/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[g.image_url?e.jsx("img",{src:g.image_url,alt:g.common_name,className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:g.common_name}),g.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:g.botanical_name})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${v(g.type)}`,children:g.type})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg text-primary",children:[g.total_stock||0," ",g.default_unit]}),g.active_lots>0&&e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[g.active_lots," active lots"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[g.reorder_level||0," ",g.default_unit]})}),e.jsx("td",{className:"px-4 py-3",children:g.earliest_expiry?e.jsx("p",{className:`font-semibold ${d(g.earliest_expiry)}`,children:q(new Date(g.earliest_expiry),"MMM dd, yyyy")}):e.jsx("p",{className:"text-dark-brown/40",children:"No stock"})}),e.jsx("td",{className:"px-4 py-3",children:A!==null?e.jsx("span",{className:`font-bold ${d(g.earliest_expiry)}`,children:A>=0?`${A}d`:"Expired"}):e.jsx("span",{className:"text-dark-brown/40",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${T.color}`,children:[e.jsx("span",{className:"mr-1",children:T.icon}),T.label]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(Ne,{to:`/ingredients/${g.ingredient_id}`,className:"px-4 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:"View Details"})})]},g.ingredient_id)})})]})}),c.length===0&&e.jsxs("div",{className:"text-center py-12 px-6",children:[e.jsx(ne,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No ingredients found"}),e.jsx("p",{className:"text-primary/60 mb-4 text-lg font-medium",children:p?"Try adjusting your search":"Add your first ingredient to start tracking"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(g=>{const D=r(g.inventory_status),T=g.earliest_expiry?X(new Date(g.earliest_expiry),new Date):null;return e.jsx(Ne,{to:`/ingredients/${g.ingredient_id}`,className:"block",children:e.jsx(Z,{className:"hover:shadow-glow transition-all duration-300 h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[g.image_url?e.jsx("img",{src:g.image_url,alt:g.common_name,className:"w-16 h-16 rounded-lg object-cover"}):e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:g.common_name}),g.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:g.botanical_name})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Stock"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[g.total_stock||0," ",g.default_unit]})]}),g.earliest_expiry&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry"}),e.jsxs("p",{className:`font-semibold ${d(g.earliest_expiry)}`,children:[q(new Date(g.earliest_expiry),"MMM dd, yyyy"),T!==null&&e.jsxs("span",{className:"text-xs ml-2",children:["(",T>=0?`${T}d left`:"Expired",")"]})]})]}),e.jsx("div",{children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${D.color}`,children:[e.jsx("span",{className:"mr-1",children:D.icon}),D.label]})})]})]})})},g.ingredient_id)})})]}),a&&e.jsx(Ln,{vendors:l,onClose:()=>k(!1),onSuccess:()=>{k(!1),_()}})]})}function qn({ingredientId:s,ingredient:n,summary:c}){const[u,l]=o.useState([]);o.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:b,error:f}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).eq("status","active").order("expiry_date",{ascending:!0});if(f)throw f;l(b||[])}catch(b){console.error("Error fetching lots:",b)}},p=b=>{const f=X(new Date(b),new Date);return f<0||f<=15?"text-soft-red":f<=30?"text-accent":f<=60?"text-amber-500":"text-sage"},x=n.reorder_level>0?(c?.total_stock||0)/n.reorder_level*100:100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white/80 text-sm mb-2",children:"Total Quantity"}),e.jsx("p",{className:"text-5xl font-bold mb-1",children:c?.total_stock||0}),e.jsx("p",{className:"text-xl text-white/90",children:n.default_unit})]}),n.reorder_level>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Level"}),e.jsx("span",{className:"font-bold",children:x>=100?"Good":x>=50?"Low":"Critical"})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${x>=100?"bg-white":x>=50?"bg-amber-300":"bg-red-300"}`,style:{width:`${Math.min(x,100)}%`}})}),e.jsxs("p",{className:"text-white/70 text-xs mt-2",children:["Reorder level: ",n.reorder_level," ",n.default_unit]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Ingredient Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Type"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:n.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:n.category?.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Default Unit"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:n.default_unit})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Shelf Life"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[n.typical_shelf_life_months," months"]})]}),n.preferred_vendor_id&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Preferred Vendor"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:n.vendors?.name})]})]})]}),n.storage_conditions&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:n.storage_conditions})]})]})]}),c?.earliest_expiry&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Expiry Alert"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["Earliest lot expires on ",q(new Date(c.earliest_expiry),"MMMM dd, yyyy")," ","(",X(new Date(c.earliest_expiry),new Date)," days remaining)"]})]})]})}),u.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock by Lot/Batch"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Purchase Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Storage"})]})}),e.jsx("tbody",{children:u.map((b,f)=>{const t=X(new Date(b.expiry_date),new Date);return e.jsxs("tr",{className:`border-t border-dark-brown/5 ${f%2===0?"bg-white":"bg-cream/20"} ${t<15?"bg-soft-red/5":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown",children:b.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:q(new Date(b.purchase_date),"MMM dd, yyyy")}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:`font-semibold ${p(b.expiry_date)}`,children:q(new Date(b.expiry_date),"MMM dd, yyyy")}),e.jsx("p",{className:`text-xs ${p(b.expiry_date)}`,children:t>=0?`${t}d left`:"Expired"})]}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[b.quantity," ",b.unit]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:b.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:b.storage_location||"-"})]},b.id)})})]})})]})]})}function Rn({ingredientId:s,ingredient:n}){const[c,u]=o.useState([]),[l,m]=o.useState({totalPurchases:0,totalQuantity:0,totalSpent:0,avgCostPerUnit:0});o.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:b,error:f}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).order("purchase_date",{ascending:!1});if(f)throw f;u(b||[]);const t=b.length,i=b.reduce((N,j)=>N+(j.original_quantity||0),0),a=b.reduce((N,j)=>N+(j.cost_per_unit||0)*(j.original_quantity||0),0),k=a/(i||1);m({totalPurchases:t,totalQuantity:i,totalSpent:a,avgCostPerUnit:k})}catch(b){console.error("Error fetching purchases:",b)}},x=b=>({active:"bg-sage/10 text-sage",used:"bg-dark-brown/10 text-dark-brown",expired:"bg-soft-red/10 text-soft-red"})[b]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Purchases"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:l.totalPurchases})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Quantity"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[l.totalQuantity.toFixed(2)," ",n.default_unit]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",l.totalSpent.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Avg Cost/Unit"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",l.avgCostPerUnit.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Purchase Timeline"}),c.length>0?e.jsx("div",{className:"space-y-4",children:c.map(b=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(De,{className:"w-5 h-5 text-primary"}),e.jsx("h4",{className:"font-semibold text-dark-brown",children:q(new Date(b.purchase_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:b.vendors?.name||"Unknown Vendor"}),b.invoice_number&&e.jsxs("span",{className:"ml-2 text-dark-brown/60",children:["â€¢ Invoice: ",b.invoice_number]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${x(b.status)}`,children:b.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Quantity"}),e.jsxs("p",{className:"font-bold text-primary",children:[b.original_quantity," ",b.unit]}),b.status==="active"&&b.quantity<b.original_quantity&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[b.quantity," ",b.unit," remaining"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Cost/Unit"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:b.cost_per_unit?`â‚¹${b.cost_per_unit}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Cost"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:b.cost_per_unit?`â‚¹${(b.cost_per_unit*b.original_quantity).toFixed(2)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"text-sm text-dark-brown",children:q(new Date(b.expiry_date),"MMM dd, yyyy")})]})]}),b.lot_number&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-xs text-dark-brown/60",children:["Lot: ",e.jsx("span",{className:"font-mono text-dark-brown",children:b.lot_number})]})}),b.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:b.notes})})]},b.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ne,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No purchase history recorded"})]})]})]})}function Un({ingredientId:s,ingredient:n}){const[c,u]=o.useState([]),[l,m]=o.useState([]),[p,x]=o.useState(0);o.useEffect(()=>{b(),f()},[s]);const b=async()=>{try{const{data:t,error:i}=await C.from("ingredient_usage").select("*, batches(batch_number), products(name)").eq("ingredient_id",s).order("usage_date",{ascending:!1});if(i)throw i;u(t||[]);const a=t.reduce((k,N)=>k+(N.quantity||0),0);x(a)}catch(t){console.error("Error fetching usage:",t)}},f=async()=>{try{const{data:t,error:i}=await C.from("product_ingredients").select("*, products(id, name, images)").eq("ingredient_name",n.common_name);if(i)throw i;m(t||[])}catch(t){console.error("Error fetching products:",t)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Used (Lifetime)"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[p.toFixed(2)," ",n.default_unit]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Usage Instances"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:c.length})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Used in Products"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:l.length})]})]}),l.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Products Using This Ingredient"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:l.map(t=>e.jsx(Ne,{to:`/products/${t.products.id}`,className:"p-4 bg-cream/50 rounded-lg hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.products.images&&t.products.images[0]?e.jsx("img",{src:t.products.images[0],alt:t.products.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(as,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:t.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[t.quantity," ",t.unit," per batch"]})]})]})},t.id))})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage History"}),c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(De,{className:"w-4 h-4 text-dark-brown/60"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:q(new Date(t.usage_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 capitalize",children:["Used for: ",t.used_for?.replace("_"," ")]})]}),e.jsxs("span",{className:"font-bold text-primary text-lg",children:[t.quantity," ",n.default_unit]})]}),t.batches&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",e.jsx(Ne,{to:`/batches/${t.batch_id}`,className:"font-mono text-primary hover:underline",children:t.batches.batch_number})]})}),t.products&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Product: ",e.jsx("span",{className:"font-semibold text-dark-brown",children:t.products.name})]})}),t.notes&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70 italic",children:t.notes})})]},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ne,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No usage recorded yet"})]})]})]})}function zn({ingredientId:s,ingredient:n}){const[c,u]=o.useState({turnoverRate:0,wasteQuantity:0,wasteCost:0,minPrice:0,maxPrice:0,avgPrice:0,currentPrice:0,totalUsed:0,totalPurchased:0});o.useEffect(()=>{l()},[s]);const l=async()=>{try{const[x,b]=await Promise.all([C.from("ingredient_stock").select("*").eq("ingredient_id",s),C.from("ingredient_usage").select("quantity").eq("ingredient_id",s)]);if(x.error)throw x.error;if(b.error)throw b.error;const f=x.data||[],t=b.data||[],i=f.filter(v=>v.status==="expired"),a=i.reduce((v,g)=>v+(g.quantity||0),0),k=i.reduce((v,g)=>v+(g.cost_per_unit||0)*(g.quantity||0),0),N=f.map(v=>v.cost_per_unit).filter(v=>v>0),j=N.length>0?Math.min(...N):0,_=N.length>0?Math.max(...N):0,w=N.length>0?N.reduce((v,g)=>v+g,0)/N.length:0,y=f.filter(v=>v.cost_per_unit>0).sort((v,g)=>new Date(g.purchase_date).getTime()-new Date(v.purchase_date).getTime()),h=y.length>0?y[0].cost_per_unit:0,d=t.reduce((v,g)=>v+(g.quantity||0),0),r=f.reduce((v,g)=>v+(g.original_quantity||0),0);u({turnoverRate:r>0?d/r*100:0,wasteQuantity:a,wasteCost:k,minPrice:j,maxPrice:_,avgPrice:w,currentPrice:h,totalUsed:d,totalPurchased:r})}catch(x){console.error("Error fetching analytics:",x)}},m=c.totalPurchased>0?c.wasteQuantity/c.totalPurchased*100:0,p=c.avgPrice>0?(c.currentPrice-c.avgPrice)/c.avgPrice*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Turnover Rate"}),e.jsx(se,{className:"w-5 h-5 text-primary"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[c.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Usage efficiency"})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Quantity"}),e.jsx(fe,{className:"w-5 h-5 text-soft-red"})]}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:[c.wasteQuantity.toFixed(2)," ",n.default_unit]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[m.toFixed(1),"% of total purchased"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Cost"}),e.jsx(qe,{className:"w-5 h-5 text-accent"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",c.wasteCost.toFixed(0)]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Lost value from expiry"})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Minimum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",c.minPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Maximum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",c.maxPrice.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Average Price"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",c.avgPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Price vs Average"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-2xl font-bold ${p>0?"text-soft-red":"text-sage"}`,children:[p>0?"+":"",p.toFixed(1),"%"]}),p>0?e.jsx(se,{className:"w-5 h-5 text-soft-red"}):e.jsx(we,{className:"w-5 h-5 text-sage"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["â‚¹",c.currentPrice.toFixed(2)," per unit"]})]})]})]})]}),m>10&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Waste Reduction Recommendations"}),e.jsxs("ul",{className:"space-y-2 text-sm text-dark-brown/70",children:[e.jsx("li",{children:"â€¢ Consider reducing purchase quantities to match usage rate"}),e.jsx("li",{children:"â€¢ Implement FIFO (First In, First Out) more strictly"}),e.jsx("li",{children:"â€¢ Review storage conditions to extend shelf life"}),e.jsxs("li",{children:["â€¢ Adjust reorder level to: ",(c.totalUsed/6).toFixed(2)," ",n.default_unit," (based on 6-month usage)"]})]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Purchased"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:c.totalPurchased.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:n.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Used"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:c.totalUsed.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:n.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Utilization Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:[c.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:"Used vs Purchased"})]})]})]})]})}const dt=[{id:"coa",label:"Quality Certificates (COA)",icon:Ye},{id:"organic_cert",label:"Organic Certifications",icon:Ye},{id:"test_report",label:"Test Reports",icon:as},{id:"msds",label:"MSDS (Safety Data Sheets)",icon:he},{id:"specification",label:"Vendor Specifications",icon:ae},{id:"photo",label:"Ingredient Photos",icon:zs}];function Bn({ingredientId:s}){const[n,c]=o.useState([]),[u,l]=o.useState("all");o.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:t,error:i}=await C.from("ingredient_documents").select("*").eq("ingredient_id",s).order("uploaded_at",{ascending:!1});if(i)throw i;c(t||[])}catch(t){console.error("Error fetching documents:",t)}},p=u==="all"?n:n.filter(t=>t.category===u),x=t=>{const i=dt.find(a=>a.id===t);return i?i.icon:ae},b=t=>t?X(new Date(t),new Date)<=30:!1,f=t=>t?X(new Date(t),new Date)<0:!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>l("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",n.length,")"]}),dt.map(t=>{const i=n.filter(a=>a.category===t.id).length;return e.jsxs("button",{onClick:()=>l(t.id),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u===t.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[t.label.split(" ")[0]," (",i,")"]},t.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(G,{className:"w-4 h-4"}),"Upload Document"]})]}),p.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:p.map(t=>{const i=x(t.category),a=dt.find(k=>k.id===t.category);return e.jsx("div",{className:`bg-white border-2 rounded-xl p-4 hover:shadow-soft transition-all ${f(t.expiry_date)?"border-soft-red/20 bg-soft-red/5":b(t.expiry_date)?"border-accent/20 bg-accent/5":"border-dark-brown/5"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(i,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:t.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:a?.label})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("span",{children:["Uploaded: ",q(new Date(t.uploaded_at),"MMM dd, yyyy")]}),t.expiry_date&&e.jsx("span",{className:`font-semibold ${f(t.expiry_date)?"text-soft-red":b(t.expiry_date)?"text-accent":"text-dark-brown"}`,children:f(t.expiry_date)?e.jsxs(e.Fragment,{children:["Expired: ",q(new Date(t.expiry_date),"MMM dd, yyyy")]}):e.jsxs(e.Fragment,{children:["Expires: ",q(new Date(t.expiry_date),"MMM dd, yyyy")]})})]}),(f(t.expiry_date)||b(t.expiry_date))&&e.jsxs("div",{className:`mt-2 flex items-center gap-2 text-sm font-semibold ${f(t.expiry_date)?"text-soft-red":"text-accent"}`,children:[e.jsx(he,{className:"w-4 h-4"}),f(t.expiry_date)?e.jsx("span",{children:"Certificate expired - renewal required"}):e.jsxs("span",{children:["Expiring in ",X(new Date(t.expiry_date),new Date)," days"]})]})]})]})},t.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:u==="all"?"Upload quality certificates, test reports, and other documents":`No ${dt.find(t=>t.id===u)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),n.some(t=>f(t.expiry_date)||b(t.expiry_date))&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Certificate Expiry Alerts"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-3",children:"Some certificates are expired or expiring soon. Ensure you have updated certifications."}),e.jsx("ul",{className:"space-y-1 text-sm text-dark-brown/70",children:n.filter(t=>f(t.expiry_date)||b(t.expiry_date)).map(t=>e.jsxs("li",{children:["â€¢ ",t.file_name," - ",f(t.expiry_date)?"Expired":"Expiring soon"]},t.id))})]})]})}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:dt.map(t=>{const i=t.icon,a=n.filter(k=>k.category===t.id).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(i,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:t.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[a," document",a!==1?"s":""]})]})]},t.id)})})]})]})}const On=[{id:"overview",label:"Overview & Stock",icon:mt},{id:"purchase",label:"Purchase History",icon:ne},{id:"usage",label:"Usage in Products",icon:as},{id:"analytics",label:"Analytics",icon:se},{id:"documents",label:"Documents",icon:ae}];function Vn(){const{id:s}=Je(),n=de(),[c,u]=o.useState(null),[l,m]=o.useState(null),[p,x]=o.useState("overview"),[b,f]=o.useState(!0);o.useEffect(()=>{s&&(t(),i())},[s]);const t=async()=>{try{const{data:w,error:y}=await C.from("ingredients").select("*, vendors(name)").eq("id",s).maybeSingle();if(y)throw y;u(w)}catch(w){console.error("Error fetching ingredient:",w)}finally{f(!1)}},i=async()=>{try{const{data:w,error:y}=await C.from("ingredient_inventory_summary").select("*").eq("ingredient_id",s).maybeSingle();if(y)throw y;m(w)}catch(w){console.error("Error fetching summary:",w)}},a=async()=>{if(confirm("Are you sure you want to delete this ingredient? This action cannot be undone."))try{const{error:w}=await C.from("ingredients").delete().eq("id",s);if(w)throw w;n("/ingredients")}catch(w){console.error("Error deleting ingredient:",w),alert("Error deleting ingredient")}},k=()=>{if(!l)return null;const w={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return w[l.inventory_status]||w.good_stock},N=w=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[w?.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";if(b)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading ingredient details..."})]})})});if(!c)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Ingredient not found"}),e.jsx("button",{onClick:()=>n("/ingredients"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Ingredients"})]})})});const j=k(),_=l?.earliest_expiry?X(new Date(l.earliest_expiry),new Date):null;return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/ingredients"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Ingredients"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[c.image_url?e.jsx("img",{src:c.image_url,alt:c.common_name,className:"w-20 h-20 rounded-lg object-cover"}):e.jsx("div",{className:"w-20 h-20 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-10 h-10 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:c.common_name}),c.botanical_name&&e.jsx("p",{className:"text-lg italic text-dark-brown/70 mb-2",children:c.botanical_name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${N(c.type)}`,children:c.type}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-dark-brown/5 text-dark-brown capitalize",children:c.category?.replace("_"," ")}),j&&e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${j.color}`,children:[e.jsx("span",{className:"mr-1",children:j.icon}),j.label]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Stock"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Stock"}),e.jsxs("p",{className:"font-bold text-2xl text-sage",children:[l?.total_stock||0," ",c.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Reorder Level"}),e.jsxs("p",{className:"font-semibold text-dark-brown",children:[c.reorder_level||0," ",c.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Active Lots"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:l?.active_lots||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold ${_===null?"text-dark-brown/40":_<0||_<=15?"text-soft-red":_<=30?"text-accent":"text-sage"}`,children:_!==null?_>=0?`${_} days`:"Expired":"No stock"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:On.map(w=>{const y=w.icon;return e.jsxs("button",{onClick:()=>x(w.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${p===w.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(y,{className:"w-5 h-5"}),w.label]},w.id)})})}),e.jsxs("div",{className:"p-6",children:[p==="overview"&&e.jsx(qn,{ingredientId:s,ingredient:c,summary:l,onUpdate:()=>{t(),i()}}),p==="purchase"&&e.jsx(Rn,{ingredientId:s,ingredient:c}),p==="usage"&&e.jsx(Un,{ingredientId:s,ingredient:c}),p==="analytics"&&e.jsx(zn,{ingredientId:s,ingredient:c}),p==="documents"&&e.jsx(Bn,{ingredientId:s})]})]})]})})}const Hn=[{value:"fssai",label:"FSSAI License"},{value:"ayush",label:"Ayush License"},{value:"gmp",label:"GMP Certification"},{value:"trade",label:"Trade License"},{value:"gst",label:"GST Registration"},{value:"organic",label:"Organic Certification"},{value:"pollution",label:"Pollution Control"},{value:"fire",label:"Fire Safety Certificate"},{value:"drug",label:"Drug License"},{value:"other",label:"Other"}];function Wn({onClose:s,onSuccess:n}){const{user:c}=H(),[u,l]=o.useState(!1),[m,p]=o.useState(!1),[x,b]=o.useState({licenseType:"fssai",licenseNumber:"",issuedTo:"",issuingAuthority:"",issueDate:"",expiryDate:"",renewalReminderDays:"30",scope:"",status:"active",notes:"",reminderEmail:!0,reminderPush:!0}),f=async t=>{if(t.preventDefault(),!x.licenseNumber||!x.issuedTo||!x.issuingAuthority||!x.issueDate){alert("Please fill in all required fields");return}if(!m&&!x.expiryDate){alert('Please provide an expiry date or check "No Expiry"');return}l(!0);try{const{error:i}=await C.from("licenses").insert([{license_type:x.licenseType,license_number:x.licenseNumber,issued_to:x.issuedTo,issuing_authority:x.issuingAuthority,issue_date:x.issueDate,expiry_date:m?null:x.expiryDate,renewal_reminder_days:parseInt(x.renewalReminderDays),scope:x.scope,status:x.status,notes:x.notes,reminder_email:x.reminderEmail,reminder_push:x.reminderPush,created_by:c?.id}]);if(i)throw i;n()}catch(i){console.error("Error adding license:",i),alert("Error adding license. Please try again.")}finally{l(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add License/Certificate"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:f,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:x.licenseType,onChange:t=>b({...x,licenseType:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Hn.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License/Certificate Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:x.licenseNumber,onChange:t=>b({...x,licenseNumber:t.target.value}),placeholder:"e.g., 12345678901234",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issued To ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:x.issuedTo,onChange:t=>b({...x,issuedTo:t.target.value}),placeholder:"Business name",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issuing Authority ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:x.issuingAuthority,onChange:t=>b({...x,issuingAuthority:t.target.value}),placeholder:"e.g., FSSAI, State Ayush Department",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issue Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:x.issueDate,onChange:t=>b({...x,issueDate:t.target.value}),max:q(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Expiry Date ",!m&&e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:t=>{p(t.target.checked),t.target.checked&&b({...x,expiryDate:""})},className:"w-4 h-4 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-xs text-dark-brown/70",children:"No Expiry"})]})]}),e.jsx("input",{type:"date",value:x.expiryDate,onChange:t=>b({...x,expiryDate:t.target.value}),min:x.issueDate,required:!m,disabled:m,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none disabled:bg-dark-brown/5 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Renewal Reminder (days before expiry)"}),e.jsx("input",{type:"number",value:x.renewalReminderDays,onChange:t=>b({...x,renewalReminderDays:t.target.value}),min:"1",max:"365",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Status ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:x.status,onChange:t=>b({...x,status:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending Application"}),e.jsx("option",{value:"renewal_in_process",children:"Renewal In Process"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Scope/Coverage"}),e.jsx("textarea",{value:x.scope,onChange:t=>b({...x,scope:t.target.value}),placeholder:"What this license covers (e.g., Manufacturing of Ayurvedic products)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:x.notes,onChange:t=>b({...x,notes:t.target.value}),placeholder:"Important information, conditions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2 bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.reminderEmail,onChange:t=>b({...x,reminderEmail:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email reminder"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.reminderPush,onChange:t=>b({...x,reminderPush:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push notification"})]})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:u,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:u?"Adding...":"Add License"})]})]})})}const Ms={fssai:{label:"FSSAI License",icon:"ðŸ´",color:"from-blue-500 to-blue-600"},ayush:{label:"Ayush License",icon:"ðŸŒ¿",color:"from-sage to-primary"},gmp:{label:"GMP Certification",icon:"âœ“",color:"from-primary to-accent"},trade:{label:"Trade License",icon:"ðŸª",color:"from-amber-500 to-amber-600"},gst:{label:"GST Registration",icon:"ðŸ’¼",color:"from-purple-500 to-purple-600"},organic:{label:"Organic Certification",icon:"ðŸŒ±",color:"from-green-500 to-green-600"},pollution:{label:"Pollution Control",icon:"ðŸ­",color:"from-teal-500 to-teal-600"},fire:{label:"Fire Safety",icon:"ðŸ”¥",color:"from-red-500 to-red-600"},drug:{label:"Drug License",icon:"ðŸ’Š",color:"from-pink-500 to-pink-600"},other:{label:"Other License",icon:"ðŸ“„",color:"from-dark-brown to-primary"}};function Gn(){const[s,n]=o.useState([]),[c,u]=o.useState(!1),[l,m]=o.useState({total:0,active:0,expiringSoon:0,expired:0,complianceScore:100});o.useEffect(()=>{p()},[]),o.useEffect(()=>{x()},[s]);const p=async()=>{try{const{data:a,error:k}=await C.from("license_summary").select("*").order("expiry_date",{ascending:!0,nullsFirst:!1});if(k)throw k;n(a||[])}catch(a){console.error("Error fetching licenses:",a)}},x=()=>{const a=s.length,k=s.filter(w=>w.expiry_status==="active"||w.expiry_status==="no_expiry").length,N=s.filter(w=>w.expiry_status==="expiring_soon"||w.expiry_status==="renewal_due"||w.expiry_status==="critical").length,j=s.filter(w=>w.expiry_status==="expired").length,_=a>0?Math.round((k+N)/a*100):100;m({total:a,active:k,expiringSoon:N,expired:j,complianceScore:_})},b=(a,k)=>{const N={active:{label:"Active",color:"bg-sage/10 text-sage",icon:Q},renewal_due:{label:"Renewal Due",color:"bg-amber-500/10 text-amber-500",icon:oe},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:he},critical:{label:"Critical",color:"bg-soft-red/10 text-soft-red",icon:he},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:he},no_expiry:{label:"No Expiry",color:"bg-blue-500/10 text-blue-500",icon:Q}};return N[a]||N.active},f=()=>l.complianceScore===100?"text-sage":l.complianceScore>=80?"text-amber-500":"text-soft-red",t=()=>l.complianceScore===100?{label:"All Compliant",icon:"ðŸŸ¢"}:l.complianceScore>=80?{label:"Needs Attention",icon:"ðŸŸ¡"}:{label:"Critical Issues",icon:"ðŸ”´"},i=a=>Ms[a]||Ms.other;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(Z,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Compliance & Certifications"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 md:gap-4",children:[e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Manage licenses and certifications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-primary/60 font-medium",children:"Status:"}),e.jsxs("span",{className:`font-bold text-lg ${f()}`,children:[t().icon," ",t().label," (",l.complianceScore,"%)"]})]})]})]}),e.jsxs(ue,{onClick:()=>u(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Add License"]})]})]}),e.jsxs(ue,{onClick:()=>u(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Add License/Certificate"]}),l.expiringSoon>0&&e.jsx(Z,{className:"bg-accent/10 border-2 border-accent/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-primary",children:[l.expiringSoon," license",l.expiringSoon!==1?"s":""," expiring in next 90 days - Review required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Initiate renewal process to maintain compliance"})]})]})}),l.expired>0&&e.jsx(Z,{className:"bg-soft-red/10 border-2 border-soft-red/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-soft-red flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-soft-red",children:[l.expired," license",l.expired!==1?"s have":" has"," expired - Immediate action required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Operating without valid licenses may result in penalties and business disruption"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(bt,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:l.total})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Licenses"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(Q,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:l.active})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active & Valid"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(oe,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-3xl font-bold text-accent",children:l.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Renewal Due Soon"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-soft-red/20 rounded-button",children:e.jsx(he,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:"text-3xl font-bold text-soft-red",children:l.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})]}),s.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(a=>{const k=i(a.license_type),N=b(a.expiry_status,a.days_until_expiry),j=N.icon,_=a.total_checklist_items>0?Math.round(a.completed_checklist_items/a.total_checklist_items*100):100;return e.jsx(Ne,{to:`/compliance/${a.id}`,className:"block",children:e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 overflow-hidden p-0",children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${k.color}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-4xl",children:k.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:k.label}),e.jsx("p",{className:"text-xs text-dark-brown/60 font-mono",children:a.license_number})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Issued by:"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:a.issuing_authority})]}),a.expiry_date&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Expiry:"}),e.jsx("span",{className:`text-sm font-semibold ${a.expiry_status==="expired"||a.expiry_status==="critical"?"text-soft-red":a.expiry_status==="expiring_soon"?"text-accent":a.expiry_status==="renewal_due"?"text-amber-500":"text-sage"}`,children:q(new Date(a.expiry_date),"MMM dd, yyyy")})]}),a.days_until_expiry!==null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Days remaining:"}),e.jsx("span",{className:`text-lg font-bold ${a.days_until_expiry<0||a.days_until_expiry<=7?"text-soft-red":a.days_until_expiry<=30?"text-accent":a.days_until_expiry<=90?"text-amber-500":"text-sage"}`,children:a.days_until_expiry>=0?a.days_until_expiry:"Expired"})]})]}),a.total_checklist_items>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Compliance:"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[_,"%"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${_===100?"bg-sage":_>=80?"bg-amber-500":"bg-soft-red"}`,style:{width:`${_}%`}})})]})]}),e.jsx("div",{className:"pt-3 border-t border-dark-brown/10",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${N.color}`,children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-bold",children:N.label})]})})]})]})},a.id)})}):e.jsxs(Z,{className:"p-16 text-center",children:[e.jsx(ae,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No licenses recorded yet"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:"Add your business licenses and certifications to track compliance"}),e.jsx(ue,{onClick:()=>u(!0),variant:"primary",size:"lg",children:"Add First License"})]})]}),c&&e.jsx(Wn,{onClose:()=>u(!1),onSuccess:()=>{u(!1),p()}})]})}function Qn({license:s}){const n=s.expiry_date?X(new Date(s.expiry_date),new Date):null,c=s.expiry_date?new Date(new Date(s.expiry_date).getTime()-s.renewal_reminder_days*24*60*60*1e3):null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"License Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issued To"}),e.jsx("p",{className:"font-semibold text-lg",children:s.issued_to})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"License Number"}),e.jsx("p",{className:"font-semibold text-lg font-mono",children:s.license_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold",children:s.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold",children:q(new Date(s.issue_date),"MMMM dd, yyyy")})]})]})]}),s.expiry_date&&e.jsx("div",{className:`rounded-xl p-6 ${n&&n<0?"bg-soft-red/10 border-2 border-soft-red/20":n&&n<=30?"bg-accent/10 border-2 border-accent/20":n&&n<=90?"bg-amber-500/10 border-2 border-amber-500/20":"bg-sage/10 border-2 border-sage/20"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${n&&n<0?"bg-soft-red/20":n&&n<=30?"bg-accent/20":n&&n<=90?"bg-amber-500/20":"bg-sage/20"}`,children:e.jsx(De,{className:`w-8 h-8 ${n&&n<0?"text-soft-red":n&&n<=30?"text-accent":n&&n<=90?"text-amber-500":"text-sage"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:n&&n<0?"License Expired":n&&n<=7?"License Expiring This Week":n&&n<=30?"License Expiring This Month":"License Renewal Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Expiry Date:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:q(new Date(s.expiry_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Days Until Expiry:"}),e.jsx("span",{className:`font-bold text-2xl ${n&&n<0?"text-soft-red":n&&n<=30?"text-accent":n&&n<=90?"text-amber-500":"text-sage"}`,children:n&&n>=0?n:"Expired"})]}),c&&n&&n>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Renewal Due By:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:q(c,"MMMM dd, yyyy")})]})]})]})]})}),s.scope&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Scope & Coverage"}),e.jsx("p",{className:"text-dark-brown/70",children:s.scope})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-4",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email Reminders"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_email?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_email?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push Notifications"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_push?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_push?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Reminder Period"})]}),e.jsxs("span",{className:"font-semibold text-dark-brown",children:[s.renewal_reminder_days," days before expiry"]})]})]})]}),s.notes&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("p",{className:"text-dark-brown/70 whitespace-pre-wrap",children:s.notes})]})]})}),s.last_inspection_date&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Inspection Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Last Inspection:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:q(new Date(s.last_inspection_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Inspections:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:s.inspection_count})]})]})]})]})}const Kt=[{value:"original",label:"Original License/Certificate"},{value:"renewal",label:"Renewal Documents"},{value:"application",label:"Application Forms"},{value:"receipt",label:"Payment Receipts"},{value:"correspondence",label:"Correspondence"},{value:"inspection",label:"Inspection Reports"},{value:"compliance",label:"Compliance Certificates"}];function Yn({licenseId:s}){const[n,c]=o.useState([]),[u,l]=o.useState("all");o.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:f,error:t}=await C.from("license_documents").select("*").eq("license_id",s).order("uploaded_at",{ascending:!1});if(t)throw t;c(f||[])}catch(f){console.error("Error fetching documents:",f)}},p=u==="all"?n:n.filter(f=>f.category===u),x=f=>{const t=Kt.find(i=>i.value===f);return t?t.label:f},b=f=>e.jsx(ae,{className:"w-6 h-6 text-primary"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>l("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All (",n.length,")"]}),Kt.map(f=>{const t=n.filter(i=>i.category===f.value).length;return t===0?null:e.jsxs("button",{onClick:()=>l(f.value),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u===f.value?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[f.label.split(" ")[0]," (",t,")"]},f.value)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(G,{className:"w-4 h-4"}),"Upload Document"]})]}),p.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:p.map(f=>e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:b(f.category)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:f.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:x(f.category)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:e.jsxs("span",{children:["Uploaded: ",q(new Date(f.uploaded_at),"MMM dd, yyyy")]})})]})]})},f.id))}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:u==="all"?"Upload license documents, receipts, and correspondence":`No ${x(u).toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Kt.map(f=>{const t=n.filter(i=>i.category===f.value).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(ae,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:f.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[t," document",t!==1?"s":""]})]})]},f.value)})})]})]})}const Kn={fssai:["Display license at prominent location","Maintain hygiene standards","Source ingredients from licensed suppliers","Label products correctly (FSSAI logo, license number)","Maintain manufacturing records","Annual returns filed"],ayush:["Follow GMP guidelines","Use only approved ingredients","Maintain batch records","Quality control testing","Proper labeling (Ayush logo)"],gmp:["Maintain clean facility","Follow SOP (Standard Operating Procedures)","Staff training records","Equipment calibration","Documented processes"]};function Jn({licenseId:s,license:n,onUpdate:c}){const{user:u}=H(),[l,m]=o.useState([]),[p,x]=o.useState(!1),[b,f]=o.useState("");o.useEffect(()=>{t()},[s]);const t=async()=>{try{const{data:w,error:y}=await C.from("compliance_checklist").select("*").eq("license_id",s).order("created_at",{ascending:!0});if(y)throw y;if(!w||w.length===0){const h=Kn[n.license_type]||[];h.length>0&&await i(h)}else m(w)}catch(w){console.error("Error fetching checklist:",w)}},i=async w=>{try{const y=w.map(r=>({license_id:s,checklist_item:r,completed:!1})),{data:h,error:d}=await C.from("compliance_checklist").insert(y).select();if(d)throw d;m(h||[])}catch(y){console.error("Error initializing checklist:",y)}},a=async(w,y)=>{try{const{error:h}=await C.from("compliance_checklist").update({completed:!y,last_verified_date:y?null:new Date().toISOString().split("T")[0],verified_by:y?null:u?.id}).eq("id",w);if(h)throw h;await t(),c()}catch(h){console.error("Error updating checklist:",h)}},k=async()=>{if(b.trim())try{const{error:w}=await C.from("compliance_checklist").insert([{license_id:s,checklist_item:b,completed:!1}]);if(w)throw w;f(""),x(!1),await t(),c()}catch(w){console.error("Error adding checklist item:",w)}},N=l.filter(w=>w.completed).length,j=l.length,_=j>0?Math.round(N/j*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Compliance Score"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-5xl font-bold mb-2",children:[_,"%"]}),e.jsxs("p",{className:"text-white/80",children:[N," of ",j," items completed"]})]}),e.jsxs("div",{className:"w-32 h-32 relative",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"rgba(255,255,255,0.2)",strokeWidth:"12",fill:"none"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"white",strokeWidth:"12",fill:"none",strokeDasharray:`${_/100*351.86} 351.86`,strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(Q,{className:"w-12 h-12 text-white"})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Compliance Requirements"}),e.jsxs("button",{onClick:()=>x(!p),className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-lg font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Item"]})]}),p&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("input",{type:"text",value:b,onChange:w=>f(w.target.value),placeholder:"Enter new compliance requirement...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none mb-3",onKeyDown:w=>{w.key==="Enter"&&k()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 bg-primary text-white rounded-lg font-semibold hover:bg-primary/90 transition-colors",children:"Add"}),e.jsx("button",{onClick:()=>{x(!1),f("")},className:"px-4 py-2 bg-dark-brown/10 text-dark-brown rounded-lg font-semibold hover:bg-dark-brown/20 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-3",children:l.map(w=>e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${w.completed?"bg-sage/5 border-sage/20":"bg-white border-dark-brown/10"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>a(w.id,w.completed),className:"flex-shrink-0 mt-1",children:w.completed?e.jsx(Q,{className:"w-6 h-6 text-sage"}):e.jsx(Aa,{className:"w-6 h-6 text-dark-brown/30 hover:text-primary transition-colors"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold ${w.completed?"text-sage line-through":"text-dark-brown"}`,children:w.checklist_item}),w.completed&&w.last_verified_date&&e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-1",children:["Verified on ",q(new Date(w.last_verified_date),"MMM dd, yyyy")]}),w.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2 italic",children:w.notes}),w.proof_url&&e.jsxs("button",{className:"flex items-center gap-2 mt-2 text-sm text-primary hover:underline",children:[e.jsx(Be,{className:"w-4 h-4"}),"View proof"]})]})]})},w.id))}),l.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Q,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No compliance requirements added"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add compliance requirements specific to this license"}),e.jsx("button",{onClick:()=>x(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add First Requirement"})]}),_<100&&l.length>0&&e.jsxs("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Pending Items"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[j-N," compliance requirement",j-N!==1?"s":""," still need",j-N===1?"s":""," to be completed to achieve 100% compliance."]})]}),_===100&&l.length>0&&e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"w-8 h-8 text-sage"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sage text-lg",children:"100% Compliant"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"All compliance requirements have been met"})]})]})})]})}function Zn({licenseId:s}){const[n,c]=o.useState([]),[u,l]=o.useState({totalRenewals:0,totalCost:0,avgCost:0,lastRenewalCost:0});o.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:p,error:x}=await C.from("license_renewals").select("*").eq("license_id",s).order("renewal_date",{ascending:!1});if(x)throw x;if(c(p||[]),p&&p.length>0){const b=p.length,f=p.reduce((a,k)=>a+(k.cost||0),0),t=f/b,i=p[0].cost||0;l({totalRenewals:b,totalCost:f,avgCost:t,lastRenewalCost:i})}}catch(p){console.error("Error fetching renewals:",p)}};return e.jsxs("div",{className:"space-y-6",children:[n.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Renewals"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:u.totalRenewals})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:["â‚¹",u.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Average Cost"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",u.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Last Renewal"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",u.lastRenewalCost.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Renewal Timeline"}),n.length>0?e.jsx("div",{className:"space-y-4",children:n.map((p,x)=>e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:"absolute -left-2 top-0 w-4 h-4 rounded-full bg-primary border-4 border-white"}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(oe,{className:"w-5 h-5 text-primary"}),e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Renewal ",n.length-x]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:q(new Date(p.renewal_date),"MMMM dd, yyyy")})]}),p.cost&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",p.cost]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Previous Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:q(new Date(p.previous_expiry),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"New Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-sage",children:q(new Date(p.new_expiry),"MMM dd, yyyy")})]})]}),p.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:p.notes})}),p.certificate_url&&e.jsxs("button",{className:"mt-3 flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(ae,{className:"w-4 h-4"}),"View renewed certificate"]})]})]},p.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h4",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No renewal history"}),e.jsx("p",{className:"text-dark-brown/40",children:"Renewal records will appear here when the license is renewed"})]})]}),n.length>1&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Total Spent on Renewals"})]}),e.jsxs("span",{className:"font-bold text-lg text-primary",children:["â‚¹",u.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-sage"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Average Renewal Cost"})]}),e.jsxs("span",{className:"font-bold text-lg text-sage",children:["â‚¹",u.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Last Renewal Cost"})]}),e.jsxs("span",{className:`font-bold text-lg ${u.lastRenewalCost>u.avgCost?"text-soft-red":"text-sage"}`,children:["â‚¹",u.lastRenewalCost.toFixed(0),u.lastRenewalCost>u.avgCost&&e.jsxs("span",{className:"text-xs ml-2",children:["(+",((u.lastRenewalCost-u.avgCost)/u.avgCost*100).toFixed(0),"%)"]})]})]})]})]})]})}function Xn({licenseId:s}){const[n,c]=o.useState([]),[u,l]=o.useState(!0);o.useEffect(()=>{m()},[s]);const m=async()=>{try{const p=[],[x,b,f,t,i]=await Promise.all([C.from("licenses").select("created_at, updated_at").eq("id",s).maybeSingle(),C.from("license_documents").select("file_name, uploaded_at, category").eq("license_id",s),C.from("license_renewals").select("renewal_date, new_expiry").eq("license_id",s),C.from("compliance_checklist").select("checklist_item, completed, last_verified_date").eq("license_id",s),C.from("inspections").select("inspection_date, compliance_status, authority").eq("license_id",s)]);x.data&&(p.push({type:"license_added",timestamp:x.data.created_at,description:"License added to system",icon:ae,color:"text-primary"}),x.data.updated_at!==x.data.created_at&&p.push({type:"license_updated",timestamp:x.data.updated_at,description:"License details updated",icon:ye,color:"text-blue-500"})),b.data&&b.data.forEach(a=>{p.push({type:"document_uploaded",timestamp:a.uploaded_at,description:`Document uploaded: ${a.file_name}`,details:`Category: ${a.category}`,icon:Be,color:"text-sage"})}),f.data&&f.data.forEach(a=>{p.push({type:"renewal_processed",timestamp:a.renewal_date,description:"License renewed",details:`New expiry: ${q(new Date(a.new_expiry),"MMM dd, yyyy")}`,icon:oe,color:"text-accent"})}),t.data&&t.data.filter(a=>a.completed&&a.last_verified_date).forEach(a=>{p.push({type:"compliance_verified",timestamp:a.last_verified_date,description:"Compliance item verified",details:a.checklist_item,icon:Q,color:"text-sage"})}),i.data&&i.data.forEach(a=>{p.push({type:"inspection",timestamp:a.inspection_date,description:`Inspection by ${a.authority}`,details:`Result: ${a.compliance_status}`,icon:Re,color:a.compliance_status==="pass"?"text-sage":"text-accent"})}),p.sort((a,k)=>new Date(k.timestamp).getTime()-new Date(a.timestamp).getTime()),c(p)}catch(p){console.error("Error fetching audit log:",p)}finally{l(!1)}};return u?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading audit log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-2",children:"Activity History"}),e.jsx("p",{className:"text-dark-brown/70",children:"Complete audit trail of all activities related to this license"})]}),n.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:e.jsx("div",{className:"space-y-4",children:n.map((p,x)=>{const b=p.icon;return e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:`absolute -left-3 top-0 w-6 h-6 rounded-full bg-white border-2 border-dark-brown/10 flex items-center justify-center ${p.color}`,children:e.jsx(b,{className:"w-3 h-3"})}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:p.description}),e.jsx("span",{className:"text-sm text-dark-brown/60",children:q(new Date(p.timestamp),"MMM dd, yyyy")})]}),p.details&&e.jsx("p",{className:"text-sm text-dark-brown/70",children:p.details}),e.jsx("p",{className:"text-xs text-dark-brown/50 mt-2",children:q(new Date(p.timestamp),"h:mm a")})]})]},x)})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity history will appear here as actions are performed"})]}),e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-6 h-6 text-sage flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Full Transparency"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"This audit log provides a complete history of all activities related to this license. All actions are timestamped and recorded for compliance and regulatory purposes."})]})]})})]})}const el=[{id:"details",label:"Details",icon:ae},{id:"documents",label:"Documents",icon:Fa},{id:"compliance",label:"Compliance Checklist",icon:rs},{id:"renewal",label:"Renewal History",icon:oe},{id:"audit",label:"Audit Log",icon:ae}],Es={fssai:{label:"FSSAI License",icon:"ðŸ´"},ayush:{label:"Ayush License",icon:"ðŸŒ¿"},gmp:{label:"GMP Certification",icon:"âœ“"},trade:{label:"Trade License",icon:"ðŸª"},gst:{label:"GST Registration",icon:"ðŸ’¼"},organic:{label:"Organic Certification",icon:"ðŸŒ±"},pollution:{label:"Pollution Control",icon:"ðŸ­"},fire:{label:"Fire Safety",icon:"ðŸ”¥"},drug:{label:"Drug License",icon:"ðŸ’Š"},other:{label:"Other License",icon:"ðŸ“„"}};function tl(){const{id:s}=Je(),n=de(),[c,u]=o.useState(null),[l,m]=o.useState("details"),[p,x]=o.useState(!0);o.useEffect(()=>{s&&b()},[s]);const b=async()=>{try{const{data:j,error:_}=await C.from("license_summary").select("*").eq("id",s).maybeSingle();if(_)throw _;u(j)}catch(j){console.error("Error fetching license:",j)}finally{x(!1)}},f=async()=>{if(confirm("Are you sure you want to delete this license? This action cannot be undone."))try{const{error:j}=await C.from("licenses").delete().eq("id",s);if(j)throw j;n("/compliance")}catch(j){console.error("Error deleting license:",j),alert("Error deleting license")}},t=()=>{if(!c)return null;const j={active:{label:"Active",color:"bg-sage/10 text-sage"},pending:{label:"Pending Application",color:"bg-amber-500/10 text-amber-500"},renewal_in_process:{label:"Renewal In Process",color:"bg-blue-500/10 text-blue-500"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red"}};return j[c.status]||j.active},i=()=>{if(!c||!c.expiry_date)return"text-dark-brown";const j=X(new Date(c.expiry_date),new Date);return j<0||j<=7?"text-soft-red":j<=30?"text-accent":j<=90?"text-amber-500":"text-sage"};if(p)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading license details..."})]})})});if(!c)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"License not found"}),e.jsx("button",{onClick:()=>n("/compliance"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Compliance"})]})})});const a=Es[c.license_type]||Es.other,k=t(),N=c.expiry_date?X(new Date(c.expiry_date),new Date):null;return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/compliance"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Compliance"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsx("div",{className:"text-5xl",children:a.icon}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:a.label}),e.jsx("p",{className:"text-lg font-mono text-dark-brown/70 mb-2",children:c.license_number}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:k&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${k.color}`,children:k.label})})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:c.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:q(new Date(c.issue_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:`font-semibold ${i()}`,children:c.expiry_date?q(new Date(c.expiry_date),"MMM dd, yyyy"):"No Expiry"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold text-xl ${i()}`,children:N!==null?N>=0?`${N} days`:"Expired":"N/A"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:el.map(j=>{const _=j.icon;return e.jsxs("button",{onClick:()=>m(j.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${l===j.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(_,{className:"w-5 h-5"}),j.label]},j.id)})})}),e.jsxs("div",{className:"p-6",children:[l==="details"&&e.jsx(Qn,{licenseId:s,license:c,onUpdate:b}),l==="documents"&&e.jsx(Yn,{licenseId:s}),l==="compliance"&&e.jsx(Jn,{licenseId:s,license:c,onUpdate:b}),l==="renewal"&&e.jsx(Zn,{licenseId:s,license:c}),l==="audit"&&e.jsx(Xn,{licenseId:s})]})]})]})})}const sl=["ðŸ˜Š","ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥","âœ…","ðŸ‘","ðŸ’¡","ðŸŒŸ","ðŸ™","ðŸ’¯"];function al({roomId:s,onMessageSent:n}){const{user:c}=H(),[u,l]=o.useState(""),[m,p]=o.useState(!1),[x,b]=o.useState(!1),f=o.useRef(null),t=o.useRef();o.useEffect(()=>{i()},[u]),o.useEffect(()=>()=>{t.current&&clearTimeout(t.current),a(!1)},[s]);const i=()=>{if(f.current){f.current.style.height="auto";const y=Math.min(f.current.scrollHeight,200);f.current.style.height=`${y}px`}},a=async y=>{if(c)try{y?await C.from("chat_typing_status").upsert({room_id:s,user_id:c.id,is_typing:!0,last_typing_time:new Date().toISOString()},{onConflict:"room_id,user_id"}):await C.from("chat_typing_status").delete().eq("room_id",s).eq("user_id",c.id)}catch(h){console.error("Error updating typing status:",h)}},k=y=>{l(y.target.value),t.current&&clearTimeout(t.current),y.target.value.trim()?(a(!0),t.current=setTimeout(()=>{a(!1)},3e3)):a(!1)},N=async y=>{if(y?.preventDefault(),!u.trim()||!c||m)return;const h=u.trim();l(""),p(!0),a(!1),t.current&&clearTimeout(t.current);try{const d=j(h),{error:r}=await C.from("chat_messages").insert([{room_id:s,sender_id:c.id,message_text:h,message_type:"text",mentions:d}]);if(r)throw r;n()}catch(d){console.error("Error sending message:",d),l(h)}finally{p(!1)}},j=y=>{const h=/@(\w+)/g,d=[];let r;for(;(r=h.exec(y))!==null;)d.push(r[1]);return d},_=y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),N())},w=y=>{const h=f.current;if(!h)return;const d=h.selectionStart,r=h.selectionEnd,v=u.substring(0,d)+y+u.substring(r);l(v),setTimeout(()=>{h.focus();const g=d+y.length;h.setSelectionRange(g,g)},0),b(!1)};return e.jsx("div",{className:"border-t-2 border-white/40 bg-gradient-to-br from-white/70 to-cream/50 p-6 backdrop-blur-sm",children:e.jsxs("form",{onSubmit:N,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex-1 bg-white/80 border-2 border-white/60 rounded-2xl focus-within:border-primary/40 focus-within:shadow-xl transition-all shadow-lg backdrop-blur-sm",children:[e.jsx("textarea",{ref:f,value:u,onChange:k,onKeyDown:_,placeholder:"Type your message... (Shift+Enter for new line)",rows:1,className:"w-full px-5 py-4 bg-transparent resize-none focus:outline-none text-dark-brown placeholder:text-dark-brown/40 font-medium",style:{maxHeight:"200px"}}),e.jsxs("div",{className:"flex items-center gap-2 px-5 pb-4",children:[e.jsx("button",{type:"button",className:"p-2.5 hover:bg-primary/10 rounded-xl transition-all text-dark-brown/60 hover:text-primary hover:scale-110 active:scale-95",title:"Attach file",children:e.jsx(os,{className:"w-5 h-5",strokeWidth:2})}),e.jsx("button",{type:"button",className:"p-2.5 hover:bg-primary/10 rounded-xl transition-all text-dark-brown/60 hover:text-primary hover:scale-110 active:scale-95",title:"Attach image",children:e.jsx(ns,{className:"w-5 h-5",strokeWidth:2})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>b(!x),className:"p-2.5 hover:bg-primary/10 rounded-xl transition-all text-dark-brown/60 hover:text-primary hover:scale-110 active:scale-95",title:"Add emoji",children:e.jsx(Js,{className:"w-5 h-5",strokeWidth:2})}),x&&e.jsx("div",{className:"absolute bottom-full left-0 mb-3 bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border-2 border-white/60 p-4 grid grid-cols-6 gap-2",children:sl.map(y=>e.jsx("button",{type:"button",onClick:()=>w(y),className:"text-2xl hover:bg-primary/10 rounded-xl p-2 transition-all hover:scale-125 active:scale-95",children:y},y))})]}),e.jsx("div",{className:"flex-1"}),u.length>0&&e.jsxs("span",{className:"text-xs text-dark-brown/50 font-semibold bg-dark-brown/5 px-3 py-1.5 rounded-lg",children:[u.length," chars"]})]})]}),e.jsx("button",{type:"submit",disabled:!u.trim()||m,className:"p-5 bg-gradient-to-br from-primary via-sage to-secondary text-white rounded-2xl font-bold hover:shadow-2xl hover:scale-105 active:scale-95 transition-all disabled:opacity-40 disabled:cursor-not-allowed flex-shrink-0 border-2 border-white/30 shadow-xl",title:"Send message",children:e.jsx(Ys,{className:"w-6 h-6",strokeWidth:2.5})})]}),e.jsx("div",{className:"flex items-center gap-2 px-2",children:e.jsxs("div",{className:"flex-1 flex flex-wrap gap-2 text-xs text-dark-brown/50",children:[e.jsxs("span",{className:"bg-white/60 px-3 py-1.5 rounded-lg font-medium border border-white/40",children:[e.jsx("span",{className:"font-mono text-primary font-semibold",children:"@username"})," to mention"]}),e.jsxs("span",{className:"bg-white/60 px-3 py-1.5 rounded-lg font-medium border border-white/40",children:[e.jsx("span",{className:"font-mono text-primary font-semibold",children:"**text**"})," for bold"]})]})})]})})}const rl=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥"];function nl({message:s,isOwnMessage:n,onDelete:c,onEdit:u}){const{user:l}=H(),[m,p]=o.useState(!1),[x,b]=o.useState(!1),[f,t]=o.useState(s.message_text),i=async()=>{if(confirm("Delete this message?"))try{const{error:w}=await C.from("chat_messages").update({is_deleted:!0,deleted_at:new Date().toISOString()}).eq("id",s.id);if(w)throw w;c()}catch(w){console.error("Error deleting message:",w)}},a=async()=>{if(f.trim())try{const{error:w}=await C.from("chat_messages").update({message_text:f.trim(),is_edited:!0,edited_at:new Date().toISOString()}).eq("id",s.id);if(w)throw w;b(!1),u()}catch(w){console.error("Error editing message:",w)}},k=async w=>{if(l)try{const y=s.reactions||{},h=y[w]||[],d={...y};h.includes(l.id)?(d[w]=h.filter(v=>v!==l.id),d[w].length===0&&delete d[w]):d[w]=[...h,l.id];const{error:r}=await C.from("chat_messages").update({reactions:d}).eq("id",s.id);if(r)throw r}catch(y){console.error("Error adding reaction:",y)}},N=w=>{let y=w;return y=y.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),y=y.replace(/\*(.*?)\*/g,"<em>$1</em>"),y=y.replace(/`(.*?)`/g,'<code class="bg-dark-brown/10 px-1 rounded">$1</code>'),y=y.replace(/@(\w+)/g,'<span class="bg-accent/20 text-accent font-semibold px-1 rounded">@$1</span>'),y},j=s.reactions||{},_=Object.entries(j).filter(([w,y])=>y.length>0);return e.jsx("div",{className:`group relative ${n?"flex justify-end":"flex justify-start"}`,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:e.jsxs("div",{className:`flex-1 max-w-2xl ${n?"items-end":"items-start"} flex flex-col`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${n?"flex-row-reverse":"flex-row"}`,children:[e.jsx("span",{className:"text-xs text-dark-brown/50 font-semibold",children:q(new Date(s.created_at),"h:mm a")}),s.is_edited&&e.jsx("span",{className:"text-xs text-dark-brown/40 italic bg-dark-brown/5 px-2 py-0.5 rounded-full",children:"edited"})]}),e.jsx("div",{className:"relative",children:x?e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm border-2 border-primary/30 rounded-2xl p-5 shadow-xl",children:[e.jsx("textarea",{value:f,onChange:w=>t(w.target.value),className:"w-full p-3 bg-cream/30 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary resize-none font-medium text-dark-brown",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsx("button",{onClick:a,className:"px-5 py-2 bg-gradient-to-br from-primary to-sage text-white rounded-xl text-sm font-bold hover:shadow-xl transition-all hover:scale-105 active:scale-95",children:"Save"}),e.jsx("button",{onClick:()=>{b(!1),t(s.message_text)},className:"px-5 py-2 bg-white border-2 border-dark-brown/20 text-dark-brown rounded-xl text-sm font-bold hover:bg-dark-brown/5 transition-all hover:scale-105 active:scale-95",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`rounded-2xl px-5 py-4 shadow-lg transition-all ${n?"bg-gradient-to-br from-primary via-sage to-secondary text-white border-2 border-white/30":"bg-white/90 backdrop-blur-sm border-2 border-white/60 text-dark-brown"}`,children:e.jsx("div",{className:`text-base leading-relaxed break-words font-medium ${n?"text-white":"text-dark-brown"}`,dangerouslySetInnerHTML:{__html:N(s.message_text)}})}),m&&n&&e.jsxs("div",{className:"absolute -top-4 right-0 bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl border-2 border-white/60 flex gap-2 p-2",children:[e.jsx("button",{onClick:()=>b(!0),className:"p-2 hover:bg-primary/10 rounded-lg transition-all hover:scale-110 active:scale-95",title:"Edit",children:e.jsx(ye,{className:"w-5 h-5 text-primary",strokeWidth:2})}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-red-50 rounded-lg transition-all hover:scale-110 active:scale-95",title:"Delete",children:e.jsx(ie,{className:"w-5 h-5 text-red-500",strokeWidth:2})})]})]})}),_.length>0&&e.jsx("div",{className:`flex flex-wrap gap-2 mt-3 ${n?"justify-end":"justify-start"}`,children:_.map(([w,y])=>e.jsxs("button",{onClick:()=>k(w),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-sm font-bold transition-all hover:scale-110 active:scale-95 shadow-md ${y.includes(l?.id)?"bg-gradient-to-br from-amber-100 to-amber-200 border-2 border-amber-400":"bg-white/90 backdrop-blur-sm border-2 border-white/60 hover:border-primary/40"}`,children:[e.jsx("span",{className:"text-lg",children:w}),e.jsx("span",{className:"text-dark-brown",children:y.length})]},w))}),e.jsx("div",{className:`flex gap-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity ${n?"justify-end":"justify-start"}`,children:rl.map(w=>e.jsx("button",{onClick:()=>k(w),className:"text-xl hover:scale-125 active:scale-95 transition-all p-1.5 hover:bg-white/60 rounded-xl backdrop-blur-sm",title:`React with ${w}`,children:w},w))})]})})}function ll({room:s,teamMembers:n}){const{user:c}=H(),[u,l]=o.useState([]),[m,p]=o.useState(!0),[x,b]=o.useState([]),f=o.useRef(null),t=o.useRef(null),[i,a]=o.useState(!1);o.useEffect(()=>{s&&(k(),N(),j(),_())},[s?.id]),o.useEffect(()=>{w()},[u]);const k=async()=>{try{p(!0);const{data:g,error:D}=await C.from("chat_messages").select("*").eq("room_id",s.id).eq("is_deleted",!1).order("created_at",{ascending:!0}).limit(100);if(D)throw D;l(g||[])}catch(g){console.error("Error fetching messages:",g)}finally{p(!1)}},N=()=>{const g=C.channel(`room_${s.id}_messages`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},D=>{l(T=>[...T,D.new]),_()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},D=>{l(T=>T.map(A=>A.id===D.new.id?D.new:A))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},D=>{l(T=>T.filter(A=>A.id!==D.old.id))}).subscribe();return()=>{g.unsubscribe()}},j=()=>{const g=C.channel(`room_${s.id}_typing`).on("postgres_changes",{event:"*",schema:"public",table:"chat_typing_status",filter:`room_id=eq.${s.id}`},async()=>{const{data:D}=await C.from("chat_typing_status").select("*").eq("room_id",s.id).eq("is_typing",!0).neq("user_id",c?.id||"");b(D||[])}).subscribe();return()=>{g.unsubscribe()}},_=async()=>{if(c)try{const{error:g}=await C.from("chat_room_members").update({last_read_at:new Date().toISOString()}).eq("room_id",s.id).eq("user_id",c.id);if(g)throw g}catch(g){console.error("Error marking room as read:",g)}},w=()=>{f.current?.scrollIntoView({behavior:"smooth"})},y=()=>{if(!t.current)return;const{scrollTop:g,scrollHeight:D,clientHeight:T}=t.current,A=D-g-T<100;a(!A)},h=g=>{const D=new Date(g);return As(D)?"Today":Is(D)?"Yesterday":q(D,"MMMM dd, yyyy")},d=(g,D)=>D?!Zt(new Date(g.created_at),new Date(D.created_at)):!0,r=g=>{const D=n.find(T=>T.id===g);return g===c?.id?"You":D?.full_name||D?.email?.split("@")[0]||"Unknown"},v=()=>x.map(g=>{const D=n.find(T=>T.id===g.user_id);return D?.full_name||D?.email?.split("@")[0]||"Someone"}).join(", ");return e.jsxs("div",{className:"flex-1 flex flex-col h-full",children:[e.jsx("div",{className:"border-b-2 border-white/40 p-6 bg-gradient-to-r from-white/60 to-cream/40 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary/20 to-sage/10 rounded-2xl flex items-center justify-center text-3xl shadow-lg border-2 border-white/50",children:s.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary truncate drop-shadow-sm",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-dark-brown/70 truncate font-medium",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/60 rounded-xl border border-white/50 shadow-md backdrop-blur-sm",children:[e.jsx(ge,{className:"w-5 h-5 text-primary",strokeWidth:2.5}),e.jsxs("span",{className:"text-sm text-primary font-bold",children:[n.length," partner",n.length!==1?"s":""]})]})]})}),e.jsxs("div",{ref:t,onScroll:y,className:"flex-1 overflow-y-auto p-6 bg-gradient-to-br from-cream/40 to-white/30",children:[m?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):u.length>0?e.jsxs("div",{className:"space-y-5",children:[u.map((g,D)=>e.jsxs("div",{children:[d(g,u[D-1])&&e.jsxs("div",{className:"flex items-center gap-4 my-8",children:[e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-dark-brown/20 to-transparent"}),e.jsx("span",{className:"text-xs font-bold text-dark-brown/50 px-4 py-2 bg-white/60 backdrop-blur-sm rounded-full shadow-sm border border-white/50",children:h(g.created_at)}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-dark-brown/20 to-transparent"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[g.sender_id!==c?.id&&e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-base flex-shrink-0 shadow-lg border-2 border-white/30",children:r(g.sender_id)[0]?.toUpperCase()}),e.jsxs("div",{className:`flex-1 ${g.sender_id===c?.id?"ml-auto":""}`,children:[g.sender_id!==c?.id&&e.jsx("div",{className:"text-sm font-bold text-primary mb-2 ml-1",children:r(g.sender_id)}),e.jsx(nl,{message:g,isOwnMessage:g.sender_id===c?.id,onDelete:()=>k(),onEdit:()=>k()})]}),g.sender_id===c?.id&&e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-base flex-shrink-0 shadow-lg border-2 border-white/30",children:r(g.sender_id)[0]?.toUpperCase()})]})]},g.id)),e.jsx("div",{ref:f})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-primary/10 to-sage/10 rounded-full flex items-center justify-center mx-auto mb-6 text-6xl shadow-xl border-2 border-white/50",children:s.icon}),e.jsx("h4",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No messages yet"}),e.jsx("p",{className:"text-dark-brown/60 font-medium text-lg",children:"Start the conversation with your team!"})]})}),x.length>0&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg mt-6 border-2 border-white/50",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("span",{className:"w-2.5 h-2.5 bg-primary rounded-full animate-bounce shadow-sm",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2.5 h-2.5 bg-primary rounded-full animate-bounce shadow-sm",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2.5 h-2.5 bg-primary rounded-full animate-bounce shadow-sm",style:{animationDelay:"300ms"}})]}),e.jsxs("span",{className:"text-sm text-dark-brown/70 font-medium",children:[v()," ",x.length===1?"is":"are"," typing..."]})]})]}),i&&e.jsx("button",{onClick:w,className:"absolute bottom-28 right-8 p-4 bg-gradient-to-br from-primary to-sage text-white rounded-2xl shadow-2xl hover:shadow-[0_8px_30px_rgba(139,69,19,0.4)] transition-all z-10 hover:scale-110 active:scale-95 border-2 border-white/30",children:e.jsx(Rs,{className:"w-6 h-6",strokeWidth:2.5})}),e.jsx(al,{roomId:s.id,onMessageSent:k})]})}function ol({onSelectRoom:s,selectedRoomId:n,onNewChat:c,onNewGroup:u}){const{user:l}=H(),[m,p]=o.useState([]),[x,b]=o.useState(!0),[f,t]=o.useState(""),[i,a]=o.useState([]),[k,N]=o.useState(!1);o.useEffect(()=>{l&&(j(),_(),w())},[l]);const j=async()=>{if(l)try{const{data:g,error:D}=await C.from("chat_user_rooms").select("*").eq("user_id",l.id).order("last_message_at",{ascending:!1,nullsFirst:!1});if(D)throw D;const T=await Promise.all((g||[]).map(async A=>{if(A.is_direct&&A.participant_ids?.length===2){const P=A.participant_ids.find(O=>O!==l.id),{data:U}=await C.from("users").select("id, name, email, role").eq("id",P).maybeSingle();return{...A,display_name:U?.name||U?.email?.split("@")[0]||"User",display_icon:"ðŸ‘¤",other_user:U}}return{...A,display_name:A.name,display_icon:A.icon}}));p(T)}catch(g){console.error("Error fetching rooms:",g)}finally{b(!1)}},_=async()=>{try{const{data:g,error:D}=await C.from("users").select("id, name, email, role").eq("approval_status","approved").neq("id",l?.id||"");if(D)throw D;a(g||[])}catch(g){console.error("Error fetching users:",g)}},w=()=>{const g=C.channel("user_rooms").on("postgres_changes",{event:"*",schema:"public",table:"chat_messages"},()=>{j()}).subscribe();return()=>{g.unsubscribe()}},y=g=>{if(!g)return"";const D=new Date(g);return As(D)?q(D,"h:mm a"):Is(D)?"Yesterday":q(D,"MMM d")},h=g=>g.type==="direct"?"ðŸ‘¤":g.type==="group"?"ðŸ‘¥":g.type==="team"?"ðŸ¢":g.display_icon||"ðŸ’¬",d=m.filter(g=>g.display_name?.toLowerCase().includes(f.toLowerCase())),r=i.filter(g=>g.name?.toLowerCase().includes(f.toLowerCase())||g.email?.toLowerCase().includes(f.toLowerCase())),v=async g=>{try{const{data:D,error:T}=await C.rpc("get_or_create_direct_chat",{user1_id:l?.id,user2_id:g});if(T)throw T;const{data:A}=await C.from("chat_user_rooms").select("*").eq("room_id",D).eq("user_id",l?.id||"").maybeSingle();if(A){const P=A.participant_ids.find(Y=>Y!==l?.id),{data:U}=await C.from("users").select("id, name, email, role").eq("id",P).maybeSingle(),O={...A,display_name:U?.name||U?.email?.split("@")[0]||"User",display_icon:"ðŸ‘¤",other_user:U};s(O),N(!1)}}catch(D){console.error("Error creating/opening chat:",D)}};return e.jsxs("div",{className:"flex flex-col h-full bg-gradient-to-b from-white/50 to-cream/30",children:[e.jsxs("div",{className:"p-4 border-b border-white/40",children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:f,onChange:g=>t(g.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-sm font-medium placeholder:text-dark-brown/40"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N(!k),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-xl font-semibold text-sm hover:shadow-lg transition-all hover:scale-105 active:scale-95 ${k?"bg-gradient-to-br from-primary to-sage text-white":"bg-white/80 border-2 border-primary/20 text-primary"}`,children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{children:"Users"})]}),e.jsx("button",{onClick:u,className:"flex items-center justify-center gap-2 px-3 py-2 bg-white/80 border-2 border-primary/20 text-primary rounded-xl font-semibold text-sm hover:shadow-lg transition-all hover:scale-105 active:scale-95",children:e.jsx(G,{className:"w-4 h-4"})})]})]}),k&&e.jsx("div",{className:"border-b-2 border-white/40 bg-white/30 p-3",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-xs font-bold text-dark-brown/70 uppercase tracking-wider",children:["All Users (",i.length,")"]}),e.jsx("button",{onClick:()=>N(!1),className:"text-xs text-primary font-semibold hover:underline",children:"Show Chats"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):k?e.jsx("div",{className:"p-2",children:r.length>0?r.map(g=>e.jsx("button",{onClick:()=>v(g.id),className:"w-full p-3 rounded-xl mb-2 transition-all text-left bg-white/60 border-2 border-white/40 hover:border-primary/20 hover:shadow-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-lg border-2 border-white/50",children:(g.name||g.email)?.[0]?.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-primary truncate text-sm",children:g.name||g.email?.split("@")[0]||"User"}),g.role==="admin"&&e.jsx(Dt,{className:"w-3 h-3 text-amber-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:g.email})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ue,{className:"w-5 h-5 text-primary/60"})})]})},g.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(ge,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center",children:"No users found"})]})}):d.length>0?e.jsx("div",{className:"p-2",children:d.map(g=>e.jsx("button",{onClick:()=>s(g),className:`w-full p-3 rounded-xl mb-2 transition-all text-left ${n===g.room_id?"bg-gradient-to-br from-primary/20 to-sage/10 border-2 border-primary/30 shadow-lg":"bg-white/60 border-2 border-white/40 hover:border-primary/20 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary/20 to-sage/10 flex items-center justify-center text-2xl border-2 border-white/50",children:h(g)}),g.unread_count>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center text-white text-xs font-bold border-2 border-white",children:g.unread_count>9?"9+":g.unread_count})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-primary truncate text-sm",children:g.display_name}),g.other_user?.role==="admin"&&e.jsx(Dt,{className:"w-3 h-3 text-amber-500 flex-shrink-0"})]}),e.jsx("span",{className:"text-xs text-dark-brown/50 font-medium flex-shrink-0 ml-2",children:y(g.last_message_at)})]}),g.last_message_text&&e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:g.last_message_text}),!g.last_message_text&&g.type==="direct"&&e.jsx("p",{className:"text-xs text-dark-brown/40 italic",children:"Start a conversation"})]})]})},g.room_id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(Ue,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center mb-4",children:f?"No conversations found":"No conversations yet"}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gradient-to-br from-primary to-sage text-white rounded-xl font-semibold text-sm hover:shadow-lg transition-all",children:"Start a conversation"})]})})]})}function il({onClose:s,onChatCreated:n}){const{user:c}=H(),[u,l]=o.useState([]),[m,p]=o.useState([]),[x,b]=o.useState(""),[f,t]=o.useState(!0),[i,a]=o.useState(!1);o.useEffect(()=>{k()},[c]),o.useEffect(()=>{p(x?u.filter(j=>j.name?.toLowerCase().includes(x.toLowerCase())||j.email?.toLowerCase().includes(x.toLowerCase())):u)},[x,u]);const k=async()=>{try{const{data:j,error:_}=await C.from("users").select("id, name, email, role").eq("approval_status","approved").neq("id",c?.id||"").order("name",{ascending:!0});if(_)throw _;l(j||[]),p(j||[])}catch(j){console.error("Error fetching users:",j)}finally{t(!1)}},N=async j=>{if(!(!c||i)){a(!0);try{const{data:_,error:w}=await C.rpc("get_or_create_direct_chat",{user1_id:c.id,user2_id:j});if(w)throw w;n(_),s()}catch(_){console.error("Error creating direct chat:",_),alert("Failed to start chat. Please try again.")}finally{a(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-dark-brown/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col border-2 border-white/50",children:[e.jsxs("div",{className:"p-6 border-b-2 border-white/40 bg-gradient-to-r from-primary/10 to-sage/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-2xl flex items-center justify-center text-white shadow-lg",children:e.jsx(Ue,{className:"w-6 h-6",strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-heading font-bold text-primary",children:"New Chat"}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium",children:"Start a conversation"})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/60 rounded-xl transition-all hover:scale-110 active:scale-95",children:e.jsx(ce,{className:"w-5 h-5 text-dark-brown/60"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:x,onChange:j=>b(j.target.value),className:"w-full pl-11 pr-4 py-3 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-sm font-medium placeholder:text-dark-brown/40",autoFocus:!0})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:f?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):m.length>0?e.jsx("div",{className:"space-y-2",children:m.map(j=>e.jsx("button",{onClick:()=>N(j.id),disabled:i,className:"w-full p-4 rounded-2xl bg-white/60 border-2 border-white/60 hover:border-primary/30 hover:shadow-lg transition-all text-left group disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-lg shadow-lg",children:(j.name||j.email)?.[0]?.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-primary text-base truncate",children:j.name||j.email?.split("@")[0]||"User"}),j.role==="admin"&&e.jsx(Dt,{className:"w-4 h-4 text-amber-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:j.email})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ue,{className:"w-5 h-5 text-primary",strokeWidth:2})})]})},j.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(ve,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center",children:x?"No users found":"No users available"})]})})]})})}function dl({onClose:s,onGroupCreated:n}){const{user:c}=H(),[u,l]=o.useState([]),[m,p]=o.useState([]),[x,b]=o.useState(""),[f,t]=o.useState(new Set),[i,a]=o.useState(""),[k,N]=o.useState(!0),[j,_]=o.useState(!1);o.useEffect(()=>{w()},[c]),o.useEffect(()=>{p(x?u.filter(r=>r.name?.toLowerCase().includes(x.toLowerCase())||r.email?.toLowerCase().includes(x.toLowerCase())):u)},[x,u]);const w=async()=>{try{const{data:r,error:v}=await C.from("users").select("id, name, email, role").eq("approval_status","approved").neq("id",c?.id||"").order("name",{ascending:!0});if(v)throw v;l(r||[]),p(r||[])}catch(r){console.error("Error fetching users:",r)}finally{N(!1)}},y=r=>{const v=new Set(f);v.has(r)?v.delete(r):v.add(r),t(v)},h=async()=>{if(!(!c||j||!i.trim()||f.size===0)){_(!0);try{const{data:r,error:v}=await C.from("chat_rooms").insert([{name:i.trim(),type:"group",is_direct:!1,created_by:c.id,icon:"ðŸ‘¥"}]).select().single();if(v)throw v;const g=[{room_id:r.id,user_id:c.id,role:"admin"},...Array.from(f).map(T=>({room_id:r.id,user_id:T,role:"member"}))],{error:D}=await C.from("chat_room_members").insert(g);if(D)throw D;n(r.id),s()}catch(r){console.error("Error creating group:",r),alert("Failed to create group. Please try again.")}finally{_(!1)}}},d=i.trim().length>0&&f.size>0;return e.jsx("div",{className:"fixed inset-0 bg-dark-brown/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-lg max-h-[85vh] flex flex-col border-2 border-white/50",children:[e.jsxs("div",{className:"p-6 border-b-2 border-white/40 bg-gradient-to-r from-primary/10 to-sage/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-2xl flex items-center justify-center text-white shadow-lg",children:e.jsx(ge,{className:"w-6 h-6",strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-heading font-bold text-primary",children:"Create Group"}),e.jsxs("p",{className:"text-sm text-dark-brown/60 font-medium",children:[f.size," member",f.size!==1?"s":""," selected"]})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/60 rounded-xl transition-all hover:scale-110 active:scale-95",children:e.jsx(ce,{className:"w-5 h-5 text-dark-brown/60"})})]}),e.jsx("input",{type:"text",placeholder:"Group name...",value:i,onChange:r=>a(r.target.value),className:"w-full px-4 py-3 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-base font-semibold placeholder:text-dark-brown/40 mb-3",maxLength:50}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search members...",value:x,onChange:r=>b(r.target.value),className:"w-full pl-11 pr-4 py-3 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-sm font-medium placeholder:text-dark-brown/40"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):m.length>0?e.jsx("div",{className:"space-y-2",children:m.map(r=>{const v=f.has(r.id);return e.jsx("button",{onClick:()=>y(r.id),className:`w-full p-4 rounded-2xl border-2 transition-all text-left ${v?"bg-gradient-to-br from-primary/20 to-sage/10 border-primary/40 shadow-lg":"bg-white/60 border-white/60 hover:border-primary/20 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-lg shadow-lg",children:(r.name||r.email)?.[0]?.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-primary text-base truncate",children:r.name||r.email?.split("@")[0]||"User"}),r.role==="admin"&&e.jsx(Dt,{className:"w-4 h-4 text-amber-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:r.email})]}),e.jsx("div",{className:`w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all ${v?"bg-primary border-primary":"border-dark-brown/30"}`,children:v&&e.jsx(Lt,{className:"w-4 h-4 text-white",strokeWidth:3})})]})},r.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(ve,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center",children:x?"No users found":"No users available"})]})}),e.jsx("div",{className:"p-6 border-t-2 border-white/40 bg-gradient-to-r from-white/60 to-cream/40",children:e.jsx("button",{onClick:h,disabled:!d||j,className:"w-full py-3 bg-gradient-to-br from-primary via-sage to-secondary text-white rounded-2xl font-bold text-base hover:shadow-2xl transition-all disabled:opacity-40 disabled:cursor-not-allowed hover:scale-105 active:scale-95",children:j?"Creating...":"Create Group"})})]})})}function cl(){const{user:s}=H(),[n,c]=o.useState(null),[u,l]=o.useState([]);o.useState(!1);const[m,p]=o.useState(!1),[x,b]=o.useState(!1),f=async a=>{c(a),await t(a.room_id)},t=async a=>{try{const{data:k,error:N}=await C.from("chat_room_members").select(`
          user_id,
          role,
          joined_at
        `).eq("room_id",a);if(N)throw N;const j=await Promise.all((k||[]).map(async _=>{const{data:w}=await C.from("users").select("id, name, email, role").eq("id",_.user_id).maybeSingle();return{..._,...w}}));l(j)}catch(k){console.error("Error fetching room members:",k)}},i=async a=>{const{data:k,error:N}=await C.from("chat_user_rooms").select("*").eq("room_id",a).eq("user_id",s?.id||"").maybeSingle();k&&!N&&await f(k)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 h-screen flex p-6 gap-4",children:[e.jsxs("div",{className:"w-96 glass-card rounded-3xl border-2 border-white/50 shadow-2xl flex flex-col overflow-hidden backdrop-blur-xl",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary via-sage to-secondary p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"}),e.jsx("div",{className:"absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border-2 border-white/30 shadow-xl",children:e.jsx(Ue,{className:"w-6 h-6 text-white",strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-white drop-shadow-lg",children:"Messages"}),e.jsx("p",{className:"text-xs text-white/90 font-medium",children:"Your conversations"})]})]})})]}),e.jsx(ol,{onSelectRoom:f,selectedRoomId:n?.room_id||null,onNewChat:()=>p(!0),onNewGroup:()=>b(!0)})]}),e.jsx("div",{className:"flex-1 flex flex-col glass-card rounded-3xl border-2 border-white/50 shadow-2xl overflow-hidden backdrop-blur-xl",children:n?e.jsx(ll,{room:{id:n.room_id,name:n.display_name,icon:n.display_icon,description:n.description,type:n.type,is_direct:n.is_direct},teamMembers:u}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gradient-to-br from-white/50 to-cream/30",children:e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"w-32 h-32 bg-gradient-to-br from-primary/20 to-sage/10 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl",children:e.jsx(Ue,{className:"w-16 h-16 text-primary",strokeWidth:1.5})}),e.jsx("h3",{className:"font-heading text-4xl font-bold text-primary mb-4",children:"Select a conversation"}),e.jsx("p",{className:"text-dark-brown/60 text-lg font-medium max-w-md mb-6",children:"Choose a conversation from the list or start a new chat with your team."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-gradient-to-br from-primary to-sage text-white rounded-xl font-bold hover:shadow-2xl transition-all hover:scale-105 active:scale-95",children:"New Chat"}),e.jsx("button",{onClick:()=>b(!0),className:"px-6 py-3 bg-white border-2 border-primary/20 text-primary rounded-xl font-bold hover:shadow-xl transition-all hover:scale-105 active:scale-95",children:"New Group"})]})]})})})]}),m&&e.jsx(il,{onClose:()=>p(!1),onChatCreated:i}),x&&e.jsx(dl,{onClose:()=>b(!1),onGroupCreated:i})]})}function xl(){const s=de(),{user:n}=H(),[c,u]=o.useState("profile"),[l,m]=o.useState({name:n?.name||"",email:n?.email||"",phone:n?.phone||""}),[p,x]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[b,f]=o.useState(null),[t,i]=o.useState(null),[a,k]=o.useState(!1),[N,j]=o.useState(!1),_=async y=>{y.preventDefault(),k(!0),f(null);try{const h=localStorage.getItem("users"),d=h?JSON.parse(h):[],r=d.findIndex(v=>v.id===n?.id);if(r!==-1){d[r]={...d[r],name:l.name,email:l.email,phone:l.phone},localStorage.setItem("users",JSON.stringify(d));const v={id:d[r].id,name:d[r].name,email:d[r].email,phone:d[r].phone,role:d[r].role};localStorage.setItem("currentUser",JSON.stringify(v)),f({type:"success",text:"Profile updated successfully"}),setTimeout(()=>{window.location.reload()},1500)}}catch{f({type:"error",text:"Failed to update profile"})}finally{k(!1)}},w=async y=>{if(y.preventDefault(),j(!0),i(null),p.newPassword.length<8){i({type:"error",text:"New password must be at least 8 characters long"}),j(!1);return}if(p.newPassword!==p.confirmPassword){i({type:"error",text:"New passwords do not match"}),j(!1);return}try{const h=localStorage.getItem("users"),d=h?JSON.parse(h):[],r=d.findIndex(v=>v.id===n?.id&&v.password===p.currentPassword);r!==-1?(d[r].password=p.newPassword,localStorage.setItem("users",JSON.stringify(d)),i({type:"success",text:"Password changed successfully"}),x({currentPassword:"",newPassword:"",confirmPassword:""})):i({type:"error",text:"Current password is incorrect"})}catch{i({type:"error",text:"Failed to change password"})}finally{j(!1)}};return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Settings"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your account settings and preferences"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-primary/10",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>u("profile"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${c==="profile"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile"})]})}),e.jsx("button",{onClick:()=>u("security"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${c==="security"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),e.jsx("span",{children:"Security"})]})})]})}),e.jsxs("div",{className:"p-6 md:p-8",children:[c==="profile"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-6 p-4 bg-cream/50 rounded-xl border border-primary/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-full flex items-center justify-center",children:e.jsx(Oe,{className:"w-6 h-6 text-cream"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:n?.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:n?.email})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-accent/20 rounded-full",children:[e.jsx(bt,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:n?.role})]})]})}),b&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${b.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[b.type==="success"?e.jsx(Q,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${b.type==="success"?"text-sage":"text-soft-red"}`,children:b.text})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"name",type:"text",value:l.name,onChange:y=>m({...l,name:y.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"email",type:"email",value:l.email,onChange:y=>m({...l,email:y.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(pt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"phone",type:"tel",value:l.phone,onChange:y=>m({...l,phone:y.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",disabled:a})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:a,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(Qs,{className:"w-5 h-5"}),a?"Saving...":"Save Changes"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]}),c==="security"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"Change Password"}),e.jsx("p",{className:"text-dark-brown/70",children:"Update your password to keep your account secure"})]}),t&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${t.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[t.type==="success"?e.jsx(Q,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${t.type==="success"?"text-sage":"text-soft-red"}`,children:t.text})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"currentPassword",type:"password",value:p.currentPassword,onChange:y=>x({...p,currentPassword:y.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:N})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"newPassword",type:"password",value:p.newPassword,onChange:y=>x({...p,newPassword:y.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:N,minLength:8})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"confirmPassword",type:"password",value:p.confirmPassword,onChange:y=>x({...p,confirmPassword:y.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:N})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:N,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(Ie,{className:"w-5 h-5"}),N?"Changing...":"Change Password"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]})]})]})]})})})}function ml(){const{user:s}=H(),[n,c]=o.useState([]),[u,l]=o.useState(!0),[m,p]=o.useState("all");o.useEffect(()=>{x()},[s?.id]);const x=async()=>{if(s?.id)try{const{data:N,error:j}=await C.from("notifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(j)throw j;c(N||[])}catch(N){console.error("Error fetching notifications:",N)}finally{l(!1)}},b=async N=>{try{const{error:j}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",N);if(j)throw j;c(_=>_.map(w=>w.id===N?{...w,is_read:!0,read_at:new Date().toISOString()}:w))}catch(j){console.error("Error marking notification as read:",j)}},f=async()=>{try{const N=n.filter(_=>!_.is_read).map(_=>_.id),{error:j}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).in("id",N);if(j)throw j;c(_=>_.map(w=>({...w,is_read:!0,read_at:w.read_at||new Date().toISOString()})))}catch(N){console.error("Error marking all as read:",N)}},t=async N=>{try{const{error:j}=await C.from("notifications").delete().eq("id",N);if(j)throw j;c(_=>_.filter(w=>w.id!==N))}catch(j){console.error("Error deleting notification:",j)}},i=m==="unread"?n.filter(N=>!N.is_read):n,a=n.filter(N=>!N.is_read).length,k=N=>{switch(N){case"expense":return"text-blue-600 bg-blue-50";case"batch":return"text-green-600 bg-green-50";case"license":return"text-orange-600 bg-orange-50";case"vendor":return"text-purple-600 bg-purple-50";case"product":return"text-pink-600 bg-pink-50";default:return"text-gray-600 bg-gray-50"}};return u?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsx("div",{className:"min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-primary mb-2",children:"Notifications"}),e.jsx("p",{className:"text-gray-600",children:a>0?`You have ${a} unread notification${a>1?"s":""}`:"All caught up!"})]}),a>0&&e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary-dark transition-colors",children:[e.jsx(Ea,{className:"w-4 h-4"}),"Mark All Read"]})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>p("all"),className:`px-4 py-2 rounded-button font-semibold transition-all ${m==="all"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["All (",n.length,")"]}),e.jsxs("button",{onClick:()=>p("unread"),className:`px-4 py-2 rounded-button font-semibold transition-all ${m==="unread"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["Unread (",a,")"]})]})]}),i.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(Ke,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:m==="unread"?"No unread notifications":"No notifications yet"}),e.jsx("p",{className:"text-gray-500",children:m==="unread"?"All notifications have been read":"You'll see notifications here when there's activity"})]}):e.jsx("div",{className:"space-y-3",children:i.map(N=>e.jsx("div",{className:`glass-card p-4 transition-all hover:shadow-lg ${N.is_read?"":"border-l-4 border-gold"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${k(N.type)}`,children:e.jsx(Ke,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsx("h3",{className:"font-semibold text-primary",children:N.title}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:ts(new Date(N.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:N.message}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${k(N.type)}`,children:N.type}),!N.is_read&&e.jsxs("button",{onClick:()=>b(N.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-primary hover:bg-primary/5 rounded-button transition-colors",children:[e.jsx(Lt,{className:"w-3 h-3"}),"Mark as read"]}),e.jsxs("button",{onClick:()=>t(N.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-red-600 hover:bg-red-50 rounded-button transition-colors ml-auto",children:[e.jsx(ie,{className:"w-3 h-3"}),"Delete"]})]})]})]})},N.id))})]})})}function hl(){const{user:s}=H(),[n,c]=o.useState("pending"),[u,l]=o.useState([]),[m,p]=o.useState([]),[x,b]=o.useState([]),[f,t]=o.useState(!0),[i,a]=o.useState(""),[k,N]=o.useState(null),[j,_]=o.useState(!1),[w,y]=o.useState(null),[h,d]=o.useState("");o.useEffect(()=>{r()},[]);const r=async()=>{t(!0);try{const{data:P}=await C.from("users").select("*").eq("approval_status","pending").order("created_at",{ascending:!1}),{data:U}=await C.from("users").select("*").eq("approval_status","approved").order("approved_at",{ascending:!1}),{data:O}=await C.from("users").select("*").eq("approval_status","rejected").order("created_at",{ascending:!1});if(U&&U.length>0){const Y=U.map(S=>S.approved_by).filter(S=>S!==null),{data:ee}=await C.from("users").select("id, name").in("id",Y),te=new Map(ee?.map(S=>[S.id,S.name])||[]);p(U.map(S=>({...S,approver_name:S.approved_by&&te.get(S.approved_by)||"Self-registered"})))}else p([]);l(P||[]),b(O||[])}catch(P){console.error("Error fetching users:",P)}finally{t(!1)}},v=async P=>{N(P);try{const{error:U}=await C.from("users").update({approval_status:"approved",approved_by:s?.id,approved_at:new Date().toISOString()}).eq("id",P);if(U)throw U;await C.from("notifications").insert({user_id:P,type:"account_approved",title:"Account Approved",message:"Your Organitto account has been approved! You can now login.",read:!1}),await r()}catch(U){console.error("Error approving user:",U),alert("Failed to approve user")}finally{N(null)}},g=P=>{y(P),_(!0),d("")},D=async()=>{if(!w||!h.trim()){alert("Please provide a reason for rejection");return}N(w.id);try{const{error:P}=await C.from("users").update({approval_status:"rejected",rejection_reason:h}).eq("id",w.id);if(P)throw P;await C.from("notifications").insert({user_id:w.id,type:"account_rejected",title:"Registration Not Approved",message:`Your registration was not approved. Reason: ${h}`,read:!1}),_(!1),y(null),d(""),await r()}catch(P){console.error("Error rejecting user:",P),alert("Failed to reject user")}finally{N(null)}},T=P=>{if(!i.trim())return P;const U=i.toLowerCase();return P.filter(O=>O.name.toLowerCase().includes(U)||O.email.toLowerCase().includes(U))},A=P=>new Date(P).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});return f?e.jsx("div",{className:"min-h-screen bg-gradient-mesh",children:e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-mesh",children:[e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx(ge,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"User Approval Management"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Review and manage user registrations"})]})]})}),e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>c("pending"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${n==="pending"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(oe,{className:"w-4 h-4 inline mr-2"}),"Pending (",u.length,")"]}),e.jsxs("button",{onClick:()=>c("approved"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${n==="approved"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(Q,{className:"w-4 h-4 inline mr-2"}),"Approved (",m.length,")"]}),e.jsxs("button",{onClick:()=>c("rejected"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${n==="rejected"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-2"}),"Rejected (",x.length,")"]})]}),e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:i,onChange:P=>a(P.target.value),className:"input-float w-full pl-12"})]})]}),n==="pending"&&e.jsx("div",{className:"space-y-4",children:T(u).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No pending approvals"})]}):T(u).map(P=>e.jsx("div",{className:"glass-card p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:P.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:P.name}),e.jsx("p",{className:"text-sm text-primary/60",children:P.role.charAt(0).toUpperCase()+P.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",P.email]}),P.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",P.phone]}),e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Registered:"})," ",A(P.created_at)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ue,{onClick:()=>v(P.id),disabled:k===P.id,variant:"primary",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>g(P),disabled:k===P.id,className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Reject"]})]})]})},P.id))}),n==="approved"&&e.jsx("div",{className:"space-y-4",children:T(m).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No approved users"})]}):T(m).map(P=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:P.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:P.name}),e.jsx("p",{className:"text-sm text-primary/60",children:P.role.charAt(0).toUpperCase()+P.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",P.email]}),P.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",P.phone]}),e.jsxs("p",{className:"text-sm text-green-600 font-semibold",children:["Approved by ",P.approver_name," on ",P.approved_at?A(P.approved_at):"N/A"]})]})]},P.id))}),n==="rejected"&&e.jsx("div",{className:"space-y-4",children:T(x).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No rejected users"})]}):T(x).map(P=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:P.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:P.name}),e.jsx("p",{className:"text-sm text-primary/60",children:P.role.charAt(0).toUpperCase()+P.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",P.email]}),P.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",P.phone]}),P.rejection_reason&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50/50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-sm font-semibold text-red-800 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700",children:P.rejection_reason})]})]})]},P.id))})]})]}),j&&w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"glass-card p-8 max-w-md w-full animate-scale-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary mb-4",children:"Reject Registration"}),e.jsxs("p",{className:"text-primary/70 mb-6",children:["Are you sure you want to reject ",e.jsx("span",{className:"font-bold",children:w.name}),"'s registration?"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-primary mb-3",children:"Rejection Reason (Required)"}),e.jsx("textarea",{value:h,onChange:P=>d(P.target.value),className:"input-float w-full h-32 resize-none",placeholder:"Explain why this registration is being rejected...",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{_(!1),y(null),d("")},className:"flex-1 px-6 py-3 glass-card text-primary font-bold rounded-button hover:shadow-md",children:"Cancel"}),e.jsx("button",{onClick:D,disabled:!h.trim()||k===w.id,className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50",children:"Confirm Reject"})]})]})})]})}function pl(){const s=es(),{user:n}=H(),u=["/","/login","/register"].includes(s.pathname),l=n&&!u;return e.jsxs(e.Fragment,{children:[!u&&e.jsx(Se,{}),e.jsxs(ma,{children:[e.jsx(K,{path:"/",element:e.jsx(br,{})}),e.jsx(K,{path:"/login",element:e.jsx(ur,{})}),e.jsx(K,{path:"/register",element:e.jsx(fr,{})}),e.jsxs(K,{element:e.jsx(ws,{children:e.jsx(Ns,{})}),children:[e.jsx(K,{path:"/dashboard",element:e.jsx(yr,{})}),e.jsx(K,{path:"/finance",element:e.jsx(wr,{})}),e.jsx(K,{path:"/expenses/add",element:e.jsx(vr,{})}),e.jsx(K,{path:"/expenses/edit/:id",element:e.jsx(_r,{})}),e.jsx(K,{path:"/expenses",element:e.jsx(Dr,{})}),e.jsx(K,{path:"/expenses/reports",element:e.jsx(Fr,{})}),e.jsx(K,{path:"/investments",element:e.jsx(Ur,{})}),e.jsx(K,{path:"/products",element:e.jsx(Yr,{})}),e.jsx(K,{path:"/products/:id",element:e.jsx(cn,{})}),e.jsx(K,{path:"/calculator",element:e.jsx(xn,{})}),e.jsx(K,{path:"/vendors",element:e.jsx(bn,{})}),e.jsx(K,{path:"/vendors/:id",element:e.jsx(kn,{})}),e.jsx(K,{path:"/batches",element:e.jsx(Cn,{})}),e.jsx(K,{path:"/batches/:id",element:e.jsx(Tn,{})}),e.jsx(K,{path:"/ingredients",element:e.jsx($n,{})}),e.jsx(K,{path:"/ingredients/:id",element:e.jsx(Vn,{})}),e.jsx(K,{path:"/compliance",element:e.jsx(Gn,{})}),e.jsx(K,{path:"/compliance/:id",element:e.jsx(tl,{})}),e.jsx(K,{path:"/chat",element:e.jsx(cl,{})}),e.jsx(K,{path:"/settings",element:e.jsx(xl,{})}),e.jsx(K,{path:"/notifications",element:e.jsx(ml,{})})]}),e.jsx(K,{path:"/admin/user-approvals",element:e.jsx(ws,{adminOnly:!0,children:e.jsx(Ns,{})}),children:e.jsx(K,{index:!0,element:e.jsx(hl,{})})}),e.jsx(K,{path:"*",element:e.jsx(Jt,{to:"/",replace:!0})})]}),l&&e.jsx(pr,{})]})}function bl(){return e.jsx(xa,{children:e.jsxs(_a,{children:[e.jsx(xr,{}),e.jsx(cr,{}),e.jsx(mr,{}),e.jsx(pl,{})]})})}Ls(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(bl,{})}));
