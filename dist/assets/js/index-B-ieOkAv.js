import{r as i,b as da,N as Zt,u as ce,d as es,O as ca,L as Ne,e as Je,B as xa,f as ma,h as K}from"./react-vendor-B1UGq2v7.js";import{c as ha}from"./supabase-vendor-DKRvmUUb.js";import{f as ts,a as R,s as xt,b as us,e as fs,c as pa,i as Jt,d as X,g as Es,h as As,j as Is}from"./date-vendor-Y3GY3t4o.js";import{R as be,L as Et,C as Fe,X as Te,Y as Le,T as ye,a as ft,b as $e,P as At,c as It,d as Ft,e as ba,A as ua,B as Tt,f as mt}from"./chart-vendor-DZhzrXBW.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))p(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&p(m)}).observe(document,{childList:!0,subtree:!0});function x(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function p(o){if(o.ep)return;o.ep=!0;const r=x(o);fetch(o.href,r)}})();var Fs={exports:{}},Lt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fa=i,ga=Symbol.for("react.element"),ja=Symbol.for("react.fragment"),ya=Object.prototype.hasOwnProperty,wa=fa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Na={key:!0,ref:!0,__self:!0,__source:!0};function Ts(s,n,x){var p,o={},r=null,m=null;x!==void 0&&(r=""+x),n.key!==void 0&&(r=""+n.key),n.ref!==void 0&&(m=n.ref);for(p in n)ya.call(n,p)&&!Na.hasOwnProperty(p)&&(o[p]=n[p]);if(s&&s.defaultProps)for(p in n=s.defaultProps,n)o[p]===void 0&&(o[p]=n[p]);return{$$typeof:ga,type:s,key:r,ref:m,props:o,_owner:wa.current}}Lt.Fragment=ja;Lt.jsx=Ts;Lt.jsxs=Ts;Fs.exports=Lt;var e=Fs.exports,Ls,gs=da;Ls=gs.createRoot,gs.hydrateRoot;const va="https://zvrkldiptatwsnflmvbp.supabase.co",ka="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2cmtsZGlwdGF0d3NuZmxtdmJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTU4MDMsImV4cCI6MjA4MTI3MTgwM30.cPJdSpxdkQxD6TfgJ4qsnNRTJWPwQvjTlhZPVcHR17A",C=ha(va,ka),$s=i.createContext(void 0);function _a({children:s}){const[n,x]=i.useState(null),[p,o]=i.useState(null),[r,m]=i.useState(!0);i.useEffect(()=>{C.auth.getSession().then(({data:{session:N}})=>{o(N),N?.user?d(N.user.id):m(!1)});const{data:{subscription:a}}=C.auth.onAuthStateChange((N,y)=>{o(y),y?.user?d(y.user.id):(x(null),m(!1))});return()=>a.unsubscribe()},[]);const d=async a=>{try{const{data:N,error:y}=await C.from("users").select("*").eq("id",a).maybeSingle();if(y)throw y;if(N){if(N.approval_status!=="approved"){await C.auth.signOut(),x(null),o(null),m(!1);return}x(N)}}catch(N){console.error("Error loading user profile:",N)}finally{m(!1)}},c={session:p,user:n,loading:r,signIn:async(a,N)=>{if(!a||!N)return{error:new Error("Please enter email and password")};try{const{data:y,error:f}=await C.auth.signInWithPassword({email:a,password:N});if(f)throw f;if(y.user){const{data:_,error:v}=await C.from("users").select("approval_status, rejection_reason").eq("id",y.user.id).maybeSingle();if(v)throw v;if(_?.approval_status==="pending")return await C.auth.signOut(),{error:new Error("Your account is pending approval. Please wait for admin to approve your registration.")};if(_?.approval_status==="rejected"){await C.auth.signOut();const w=_.rejection_reason?`
Reason: ${_.rejection_reason}`:"";return{error:new Error(`Your registration was not approved.${w}

Please contact admin for more information.`)}}await d(y.user.id)}return{error:null}}catch(y){return{error:new Error(y.message||"Invalid login credentials")}}},signUp:async(a,N,y,f,_="partner")=>{if(!a||!N||!y)return{error:new Error("Please fill all required fields")};try{const{data:v,error:w}=await C.auth.signUp({email:a,password:N});if(w)throw w;if(!v.user)throw new Error("Failed to create user");const j=_==="admin"?"approved":"pending",h=_==="admin"?new Date().toISOString():null,{error:l}=await C.from("users").insert({id:v.user.id,email:a,name:y,phone:f||null,role:_,approval_status:j,approved_at:h});if(l)throw l;return _==="admin"?await d(v.user.id):await C.auth.signOut(),{error:null}}catch(v){return{error:new Error(v.message||"Failed to create account")}}},signOut:async()=>{await C.auth.signOut(),x(null),o(null)}};return e.jsx($s.Provider,{value:c,children:s})}function H(){const s=i.useContext($s);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ca={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),F=(s,n)=>{const x=i.forwardRef(({color:p="currentColor",size:o=24,strokeWidth:r=2,absoluteStrokeWidth:m,className:d="",children:b,...u},t)=>i.createElement("svg",{ref:t,...Ca,width:o,height:o,stroke:p,strokeWidth:m?Number(r)*24/Number(o):r,className:["lucide",`lucide-${Sa(s)}`,d].join(" "),...u},[...n.map(([c,a])=>i.createElement(c,a)),...Array.isArray(b)?b:[b]]));return x.displayName=`${s}`,x};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=F("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=F("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=F("AlertOctagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=F("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=F("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=F("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=F("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=F("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=F("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=F("Beaker",[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=F("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=F("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=F("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=F("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=F("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=F("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=F("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=F("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=F("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=F("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=F("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=F("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=F("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=F("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=F("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=F("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=F("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=F("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=F("FileSearch",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"1vg67v"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=F("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=F("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=F("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=F("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=F("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=F("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=F("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=F("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=F("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=F("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=F("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=F("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=F("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=F("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=F("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=F("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=F("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=F("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=F("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=F("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=F("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=F("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=F("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=F("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=F("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=F("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=F("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=F("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=F("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=F("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=F("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=F("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=F("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=F("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=F("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=F("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=F("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=F("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=F("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=F("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=F("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=F("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=F("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=F("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=F("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=F("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=F("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=F("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=F("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=F("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=F("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=F("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=F("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=F("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=F("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=F("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=F("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=F("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=F("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=F("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=F("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=F("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=F("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=F("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=F("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=F("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function ws({children:s,adminOnly:n=!1}){const{user:x,loading:p}=H();return p?e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ls,{className:"w-12 h-12 text-primary animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading..."})]})}):x?x.approval_status!=="approved"?e.jsx(Zt,{to:"/login",replace:!0}):n&&x.role!=="admin"?e.jsx("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card p-10 text-center max-w-md",children:[e.jsx(Qa,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-primary mb-3",children:"Access Denied"}),e.jsx("p",{className:"text-primary/70 mb-6",children:"You don't have permission to access this page. This area is restricted to administrators only."}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-6 py-3 bg-gradient-primary text-white font-bold rounded-button hover:shadow-lg",children:"Go Back"})]})}):e.jsx(e.Fragment,{children:s}):e.jsx(Zt,{to:"/login",replace:!0})}function nr({onMenuClick:s}){const{user:n,signOut:x}=H(),p=ce(),[o,r]=i.useState(!1),[m,d]=i.useState(!1),[b,u]=i.useState([]),[t,c]=i.useState(0),[a,N]=i.useState(""),[y]=i.useState(3),f=b.filter(h=>!h.is_read).length;i.useEffect(()=>{if(n?.id){_(),n.role==="admin"&&v();const h=C.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${n.id}`},()=>{_()}).subscribe();return()=>{C.removeChannel(h)}}},[n?.id,n?.role]);const _=async()=>{if(n?.id)try{const{data:h,error:l}=await C.from("notifications").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}).limit(5);if(l)throw l;u(h||[])}catch(h){console.error("Error fetching notifications:",h)}},v=async()=>{try{const{count:h,error:l}=await C.from("users").select("*",{count:"exact",head:!0}).eq("approval_status","pending");if(l)throw l;c(h||0)}catch(h){console.error("Error fetching pending users count:",h)}},w=async()=>{await x(),p("/")},j=h=>{h.key==="Enter"&&a.trim()&&console.log("Search for:",a)};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("button",{className:"mobile-menu-btn",onClick:s,children:e.jsx(Ua,{size:20})}),e.jsxs("div",{className:"logo desktop-only",children:[e.jsx("span",{className:"logo-icon",children:"ðŸŒ¿"}),e.jsx("span",{className:"logo-text",children:"Organitto"})]}),e.jsxs("div",{className:"search-bar desktop-only",children:[e.jsx(ve,{size:18,strokeWidth:2}),e.jsx("input",{type:"text",placeholder:"Search products, expenses, vendors...",className:"search-input",value:a,onChange:h=>N(h.target.value),onKeyDown:j}),e.jsx("kbd",{className:"search-kbd",children:"âŒ˜K"})]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("button",{className:"header-icon-btn",onClick:()=>p("/chat"),title:"Chat",children:[e.jsx(Ue,{size:18}),y>0&&e.jsx("span",{className:"header-badge",children:y})]}),e.jsxs("div",{className:"header-dropdown-container",children:[e.jsxs("button",{className:"header-icon-btn",onClick:()=>r(!o),title:"Notifications",children:[e.jsx(Ke,{size:18}),f>0&&e.jsx("span",{className:"header-badge",children:f})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-dropdown-overlay",onClick:()=>r(!1)}),e.jsxs("div",{className:"header-dropdown notifications-dropdown",children:[e.jsxs("div",{className:"dropdown-header",children:[e.jsx("h3",{children:"Notifications"}),f>0&&e.jsxs("span",{className:"dropdown-badge",children:[f," new"]})]}),e.jsx("div",{className:"dropdown-body",children:b.length>0?b.map(h=>e.jsxs("div",{className:`notification-item ${h.is_read?"":"unread"}`,children:[e.jsx("div",{className:`notification-dot ${h.is_read?"":"active"}`}),e.jsxs("div",{className:"notification-content",children:[e.jsx("p",{className:"notification-title",children:h.title}),e.jsx("p",{className:"notification-message",children:h.message}),e.jsx("p",{className:"notification-time",children:ts(new Date(h.created_at),{addSuffix:!0})})]})]},h.id)):e.jsxs("div",{className:"dropdown-empty",children:[e.jsx(Ke,{size:32}),e.jsx("p",{children:"No notifications"})]})}),e.jsx("div",{className:"dropdown-footer",children:e.jsx("button",{onClick:()=>{r(!1),p("/notifications")},children:"View All Notifications"})})]})]})]}),e.jsxs("div",{className:"header-dropdown-container",children:[e.jsxs("button",{className:"user-menu",onClick:()=>d(!m),children:[e.jsx("div",{className:"user-avatar",children:n?.name?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{className:"user-name desktop-only",children:n?.name}),e.jsx(Rs,{size:16,className:"desktop-only"})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-dropdown-overlay",onClick:()=>d(!1)}),e.jsxs("div",{className:"header-dropdown user-dropdown",children:[e.jsxs("div",{className:"dropdown-header user-header",children:[e.jsx("div",{className:"user-avatar large",children:n?.name?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-info-name",children:n?.name}),e.jsx("div",{className:"user-info-email",children:n?.email}),n?.role&&e.jsxs("div",{className:"user-info-role",children:[e.jsx(ut,{size:12}),e.jsx("span",{children:n.role})]})]})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("div",{className:"dropdown-body",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>{d(!1),p("/settings")},children:[e.jsx(Oe,{size:18}),e.jsx("span",{children:"Profile"})]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>{d(!1),p("/settings")},children:[e.jsx(Ks,{size:18}),e.jsx("span",{children:"Settings"})]}),n?.role==="admin"&&e.jsxs("button",{className:"dropdown-item",onClick:()=>{d(!1),p("/admin/user-approvals")},children:[e.jsx(ut,{size:18}),e.jsx("span",{children:"User Approvals"}),t>0&&e.jsx("span",{className:"dropdown-badge",children:t})]})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsx("div",{className:"dropdown-body",children:e.jsxs("button",{className:"dropdown-item danger",onClick:w,children:[e.jsx(Hs,{size:18}),e.jsx("span",{children:"Logout"})]})})]})]})]})]})]})}const xe=({icon:s,label:n,path:x,active:p,badge:o,hasDropdown:r,isOpen:m,onClick:d,isSubItem:b})=>{const u=ce(),t=()=>{d?d():x&&u(x)};return e.jsxs("button",{className:`nav-item ${p?"active":""} ${b?"sub-item":""}`,onClick:t,children:[s&&e.jsx("span",{className:"nav-icon",children:s}),e.jsx("span",{className:"nav-label",children:n}),o&&o>0&&e.jsx("span",{className:"nav-badge",children:o}),r&&e.jsx(Us,{className:`nav-chevron ${m?"open":""}`})]})};function lr({isOpen:s,onClose:n}){const{user:x,signOut:p}=H(),o=es(),r=ce(),[m,d]=i.useState(!1),[b,u]=i.useState(0),t=N=>o.pathname===N,c=()=>o.pathname.startsWith("/expenses")||o.pathname.startsWith("/investments")||o.pathname==="/finance",a=async()=>{await p(),r("/")};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`sidebar ${s?"open":""}`,children:[e.jsxs("div",{className:"sidebar-logo mobile-only",children:[e.jsx("span",{className:"logo-icon",children:"ðŸŒ¿"}),e.jsx("span",{className:"logo-text",children:"Organitto"})]}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:"nav-section",children:[e.jsx(xe,{icon:e.jsx(qa,{size:18}),label:"Dashboard",path:"/dashboard",active:t("/dashboard")}),e.jsx(xe,{icon:e.jsx(er,{size:18}),label:"Finance",hasDropdown:!0,isOpen:m,onClick:()=>d(!m),active:c()}),m&&e.jsxs("div",{className:"nav-dropdown",children:[e.jsx(xe,{label:"Add Expense",path:"/expenses/add",isSubItem:!0,active:t("/expenses/add")}),e.jsx(xe,{label:"Expense List",path:"/expenses",isSubItem:!0,active:t("/expenses")}),e.jsx(xe,{label:"Reports",path:"/expenses/reports",isSubItem:!0,active:t("/expenses/reports")}),e.jsx(xe,{label:"Investments",path:"/investments",isSubItem:!0,active:t("/investments")})]}),e.jsx(xe,{icon:e.jsx(Ta,{size:18}),label:"Products",path:"/products",active:t("/products")}),e.jsx(xe,{icon:e.jsx(qs,{size:18}),label:"Cost Calculator",path:"/calculator",active:t("/calculator")}),e.jsx(xe,{icon:e.jsx(je,{size:18}),label:"Vendors",path:"/vendors",active:t("/vendors")}),e.jsx(xe,{icon:e.jsx(ne,{size:18}),label:"Batches",path:"/batches",active:t("/batches")}),e.jsx(xe,{icon:e.jsx(He,{size:18}),label:"Ingredients",path:"/ingredients",active:t("/ingredients")}),e.jsx(xe,{icon:e.jsx(Ya,{size:18}),label:"Compliance",path:"/compliance",active:t("/compliance")}),e.jsx(xe,{icon:e.jsx(Ue,{size:18}),label:"Team Chat",path:"/chat",active:t("/chat")}),x?.role==="admin"&&e.jsx(xe,{icon:e.jsx(Xa,{size:18}),label:"User Approvals",path:"/admin/user-approvals",active:t("/admin/user-approvals"),badge:b})]}),e.jsxs("div",{className:"nav-section nav-section-bottom",children:[e.jsx(xe,{icon:e.jsx(Ks,{size:18}),label:"Settings",path:"/settings",active:t("/settings")}),e.jsx(xe,{icon:e.jsx(Hs,{size:18}),label:"Logout",onClick:a})]})]})]}),s&&e.jsx("div",{className:"sidebar-overlay",onClick:n})]})}function Ns(){const[s,n]=i.useState(!1),x=es(),p=()=>{n(!s)},o=()=>{n(!1)};return i.useEffect(()=>{window.innerWidth<768&&o()},[x.pathname]),i.useEffect(()=>{const r=()=>{window.innerWidth>=768&&n(!1)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),i.useEffect(()=>{const r=m=>{m.key==="Escape"&&s&&o()};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[s]),e.jsxs("div",{className:"app-layout",children:[e.jsx(nr,{onMenuClick:p}),e.jsxs("div",{className:"app-body",children:[e.jsx(lr,{isOpen:s,onClose:o}),e.jsx("main",{className:"main-content",children:e.jsx(ca,{})})]})]})}function or(){const[s,n]=i.useState(!1),[x,p]=i.useState(!1),[o,r]=i.useState(null);return i.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&p(!0);const d=u=>{u.preventDefault(),r(u),n(!0)},b=()=>{p(!0),n(!1),r(null)};return window.addEventListener("beforeinstallprompt",d),window.addEventListener("appinstalled",b),()=>{window.removeEventListener("beforeinstallprompt",d),window.removeEventListener("appinstalled",b)}},[]),{isInstallable:s,isInstalled:x,installApp:async()=>{if(!o)return!1;try{await o.prompt();const{outcome:d}=await o.userChoice;return d==="accepted"?(r(null),n(!1),!0):!1}catch(d){return console.error("Error installing app:",d),!1}}}}function ir(){const[s,n]=i.useState(navigator.onLine);return i.useEffect(()=>{const x=()=>n(!0),p=()=>n(!1);return window.addEventListener("online",x),window.addEventListener("offline",p),()=>{window.removeEventListener("online",x),window.removeEventListener("offline",p)}},[]),s}function dr(){const[s,n]=i.useState(!1),[x,p]=i.useState(null);return i.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(r=>{p(r),r.addEventListener("updatefound",()=>{const m=r.installing;m&&m.addEventListener("statechange",()=>{m.state==="installed"&&navigator.serviceWorker.controller&&n(!0)})})})},[]),{isUpdateAvailable:s,updateServiceWorker:()=>{x?.waiting&&(x.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())}}}function cr(){const{isInstallable:s,installApp:n}=or(),[x,p]=i.useState(!1),[o,r]=i.useState(!1);i.useEffect(()=>{localStorage.getItem("pwa-install-dismissed")&&r(!0)},[]),i.useEffect(()=>{if(s&&!o){const b=setTimeout(()=>{p(!0)},3e3);return()=>clearTimeout(b)}},[s,o]);const m=async()=>{await n()&&p(!1)},d=()=>{p(!1),r(!0),localStorage.setItem("pwa-install-dismissed","true")};return!x||!s?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-primary/10 p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:"ðŸŒ¿"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Install Organitto"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"Install our app for quick access, offline support, and a native experience!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:m,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(ke,{className:"w-4 h-4"}),"Install"]}),e.jsx("button",{onClick:d,className:"px-4 py-2.5 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Not Now"})]})]}),e.jsx("button",{onClick:d,className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(oe,{className:"w-5 h-5 text-dark-brown/40"})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"âš¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Fast"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“±"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Native"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Offline"})]})]})})]})})}function xr(){const s=ir(),[n,x]=i.useState(!1),[p,o]=i.useState(!1);return i.useEffect(()=>{s?n&&s&&(o(!0),setTimeout(()=>{x(!1),o(!1)},3e3)):(x(!0),o(!1))},[s,n]),n?e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${p?"bg-gradient-to-r from-sage to-primary":"bg-gradient-to-r from-accent to-soft-red"}`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-center gap-3 text-white",children:p?e.jsxs(e.Fragment,{children:[e.jsx(sr,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"Back online! Data syncing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(tr,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"You're offline"}),e.jsx("span",{className:"hidden sm:inline text-sm opacity-90",children:"- Changes will sync when you reconnect"})]})})})}):null}function mr(){const{isUpdateAvailable:s,updateServiceWorker:n}=dr(),[x,p]=i.useState(!1);return!s||x?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-accent/20 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(ys,{className:"w-6 h-6 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Update Available"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"A new version of Organitto is ready. Update now to get the latest features!"}),e.jsxs("button",{onClick:n,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(ys,{className:"w-4 h-4"}),"Update Now"]})]}),e.jsx("button",{onClick:()=>p(!0),className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(oe,{className:"w-5 h-5 text-dark-brown/40"})})]})})})}const hr=[{icon:Pt,label:"Add Expense",path:"/expenses/new",color:"text-orange-500",bgGradient:"from-orange-500/20 to-orange-600/10"},{icon:ne,label:"Add Product",path:"/products",color:"text-emerald-500",bgGradient:"from-emerald-500/20 to-emerald-600/10"},{icon:$a,label:"Add Batch",path:"/batches",color:"text-blue-500",bgGradient:"from-blue-500/20 to-blue-600/10"},{icon:qe,label:"Record Sale",path:"/expenses/new",color:"text-green-500",bgGradient:"from-green-500/20 to-green-600/10"},{icon:ae,label:"Quick Note",path:"/chat",color:"text-purple-500",bgGradient:"from-purple-500/20 to-purple-600/10"}];function pr(){const[s,n]=i.useState(!1),x=ce(),p=o=>{n(!1),x(o)};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-dark-brown/40 backdrop-blur-sm",onClick:()=>n(!1)}),e.jsx("div",{className:"relative z-10 flex flex-col-reverse gap-3 mb-5",children:hr.map((o,r)=>{const m=o.icon;return e.jsxs("button",{onClick:()=>p(o.path),className:"group flex items-center justify-end gap-3 animate-scale-in",style:{animationDelay:`${r*50}ms`},children:[e.jsx("div",{className:"glass-card px-5 py-3 font-semibold text-dark-brown whitespace-nowrap shadow-xl border border-cream/20 backdrop-blur-md",children:o.label}),e.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${o.bgGradient} backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-110 cursor-pointer border-2 border-white/30 glass-card`,children:e.jsx(m,{className:`w-8 h-8 ${o.color} drop-shadow-lg`,strokeWidth:2.5})})]},o.label)})})]}),e.jsxs("button",{onClick:()=>n(!s),className:`relative z-10 w-20 h-20 bg-gradient-to-br from-primary via-sage to-secondary rounded-2xl flex items-center justify-center shadow-2xl hover:shadow-[0_0_30px_rgba(139,69,19,0.5)] transition-all duration-300 hover:scale-110 active:scale-95 border-2 border-white/30 ${s?"rotate-45":"rotate-0"}`,"aria-label":s?"Close quick actions":"Open quick actions",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/0 via-white/10 to-white/0 rounded-2xl"}),s?e.jsx(oe,{className:"w-9 h-9 text-white relative z-10 drop-shadow-lg",strokeWidth:3}):e.jsx(G,{className:"w-9 h-9 text-white relative z-10 drop-shadow-lg",strokeWidth:3})]}),!s&&e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-accent rounded-full animate-pulse shadow-lg"})]})}const Se=()=>e.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0",children:[...Array(6)].map((s,n)=>e.jsx("div",{className:"leaf absolute",style:{left:`${10+n*16}%`,animationDelay:`${n*2}s`},children:e.jsx(He,{className:"text-[#2D5016]",size:24+Math.random()*12,style:{transform:`rotate(${Math.random()*360}deg)`,opacity:.06}})},n))}),J=({children:s,className:n="",hover:x=!0,tilt:p=!1,onClick:o})=>{const r="glass-card p-6",m=x?"hover:shadow-xl":"",d=p?"card-3d":"",b=o?"cursor-pointer":"";return e.jsx("div",{className:`${r} ${m} ${d} ${b} ${n}`,onClick:o,children:s})},ue=({children:s,variant:n="primary",size:x="md",className:p="",onClick:o,disabled:r=!1,type:m="button",icon:d})=>{const b="inline-flex items-center justify-center gap-2 font-semibold transition-all duration-300",u={primary:"btn-premium",gold:"btn-gold",neu:"btn-neu text-primary",outline:"border-2 border-primary text-primary hover:bg-primary hover:text-white bg-transparent"},t={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg"},c=r?"opacity-50 cursor-not-allowed":"";return e.jsxs("button",{type:m,onClick:o,disabled:r,className:`${b} ${u[n]} ${t[x]} ${c} ${p}`,children:[d&&e.jsx("span",{children:d}),s]})};function br(){const s=ce();return e.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-20",children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:e.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-12 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-30 group-hover:opacity-50 transition-opacity duration-700"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-32 md:h-40 w-auto object-contain relative z-10 drop-shadow-2xl transform group-hover:scale-110 transition-transform duration-500"})]})}),e.jsxs("div",{className:"mb-6 inline-flex items-center gap-2 px-4 py-2 glass-card",children:[e.jsx(Ka,{className:"w-4 h-4 text-gold"}),e.jsx("span",{className:"text-sm font-bold text-gradient",children:"Premium Ayurvedic Management"})]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-heading font-bold text-primary mb-6 leading-tight animate-fade-in",children:["Elevate Your"," ",e.jsx("span",{className:"text-gradient-gold",children:"Ayurvedic"}),e.jsx("br",{}),"Business"]}),e.jsx("p",{className:"text-xl md:text-2xl text-primary/70 mb-12 max-w-2xl mx-auto leading-relaxed font-medium",children:"The most sophisticated platform for managing your Ayurvedic practice with elegance and precision"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center items-center mb-20",children:[e.jsx(ue,{variant:"primary",size:"lg",onClick:()=>s("/register"),className:"min-w-[220px] text-lg shadow-colored",children:"Start Your Journey"}),e.jsx(ue,{variant:"gold",size:"lg",onClick:()=>s("/login"),className:"min-w-[220px] text-lg",children:"Sign In"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mt-24",children:[e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(He,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Natural Flow"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Manage your practice with intuitive tools that respect the natural rhythm of Ayurvedic care"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float-delayed",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-gold rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-glow transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(se,{className:"w-8 h-8 text-primary-dark"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Premium Analytics"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Gain comprehensive insights into your business health with sophisticated reporting tools"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(ut,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Secure & Reliable"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Enterprise-grade security ensuring your data is protected with the highest standards"})]})]})]})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-48 bg-gradient-to-t from-primary/10 via-gold/5 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 text-center z-20",children:e.jsx("p",{className:"text-sm text-primary/50 font-medium",children:"Trusted by leading Ayurvedic practitioners worldwide"})})]})}function ur(){const s=ce(),{signIn:n,user:x,loading:p}=H(),[o,r]=i.useState(""),[m,d]=i.useState(""),[b,u]=i.useState(""),[t,c]=i.useState(!1);i.useEffect(()=>{x&&!p&&s("/dashboard")},[x,p,s]);const a=async N=>{N.preventDefault(),u(""),c(!0);try{const{error:y}=await n(o,m);y&&(u(y.message||"Failed to sign in. Please check your credentials."),c(!1))}catch{u("An unexpected error occurred. Please try again."),c(!1)}};return e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(ze,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-md",children:[e.jsxs("div",{className:"glass-card p-8 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-300"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto",className:"h-16 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-200"})]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Welcome back"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Sign in to your account"})]}),b&&e.jsxs("div",{className:"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2 animate-slide-down",children:[e.jsx(fe,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:b})]}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Email address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),e.jsx("input",{id:"email",type:"email",value:o,onChange:N=>r(N.target.value),className:"w-full h-10 pl-10 pr-4 text-sm border border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 transition-all duration-150 focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10",placeholder:"you@example.com",required:!0,disabled:t})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),e.jsx("input",{id:"password",type:"password",value:m,onChange:N=>d(N.target.value),className:"w-full h-10 pl-10 pr-4 text-sm border border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 transition-all duration-150 focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:t})]})]}),e.jsx("button",{type:"submit",disabled:t,className:"w-full h-10 mt-6 bg-primary hover:bg-primary-dark text-white text-sm font-medium rounded-lg transition-all duration-150 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:t?"Signing in...":"Sign in"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx(Ne,{to:"/register",className:"text-primary font-semibold hover:text-primary-dark transition-colors",children:"Sign up"})]})})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center justify-center gap-1.5",children:[e.jsx(He,{className:"w-3.5 h-3.5"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function fr(){const s=ce(),{signUp:n,user:x,loading:p}=H(),[o,r]=i.useState({name:"",email:"",phone:"",password:"",confirmPassword:""}),[m,d]=i.useState(""),[b,u]=i.useState(!1),[t,c]=i.useState(!1),[a,N]=i.useState(!1);i.useEffect(()=>{if(x&&!p){b&&u(!1);const _=setTimeout(()=>{s("/dashboard")},t?2e3:0);return()=>clearTimeout(_)}},[x,p,b,t,s]);const y=async _=>{if(_.preventDefault(),d(""),o.password.length<8){d("Password must be at least 8 characters long");return}if(o.password!==o.confirmPassword){d("Passwords do not match");return}u(!0);try{const{count:v,error:w}=await C.from("users").select("*",{count:"exact",head:!0});if(w)throw new Error("Failed to check existing users");const j=v===0,h=j?"admin":"partner";j&&c(!0);const{error:l}=await n(o.email,o.password,o.name,o.phone,h);l?(d(l.message||"Failed to create account. Please try again."),u(!1),c(!1)):j||(N(!0),u(!1))}catch(v){d(v.message||"An unexpected error occurred. Please try again."),u(!1),c(!1)}},f=_=>{r({...o,[_.target.name]:_.target.value})};return t?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-sage to-primary p-6 rounded-full shadow-glow",children:e.jsx(Q,{className:"w-12 h-12 text-cream",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Welcome, Founder!"}),e.jsx("p",{className:"text-primary/70 mb-4 text-lg font-medium",children:"Your account has been created successfully. You have full access to all features."}),e.jsx("p",{className:"text-primary/50 text-sm font-medium animate-pulse",children:"Redirecting to dashboard..."})]})})]}):a?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-blue-500 to-cyan-600 p-6 rounded-full shadow-glow",children:e.jsx(Q,{className:"w-12 h-12 text-white",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Registration Successful!"}),e.jsx("p",{className:"text-primary/70 mb-6 text-lg font-medium",children:"Your account has been created and is pending admin approval."}),e.jsx("div",{className:"glass-card bg-blue-50/50 p-4 mb-6",children:e.jsx("p",{className:"text-primary/60 text-sm font-medium",children:"You will receive a notification once your account is approved. Please check back later or wait for an email confirmation."})}),e.jsx(Ne,{to:"/login",children:e.jsx(ue,{variant:"primary",size:"lg",className:"w-full",children:"Go to Login"})})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(Se,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(ze,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-lg",children:[e.jsxs("div",{className:"glass-card p-10 md:p-12 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-10 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-500"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-20 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-300"})]})}),e.jsx("h1",{className:"font-heading text-5xl font-bold text-gradient text-center mb-3",children:"Create Account"}),e.jsx("p",{className:"text-primary/60 text-center mb-10 text-lg font-medium",children:"Join Organitto and start managing your business"}),m&&e.jsxs("div",{className:"mb-8 p-5 bg-gradient-to-r from-red-50/90 to-red-100/90 backdrop-blur-sm border border-red-200 rounded-button flex items-start gap-3 animate-slide-down",children:[e.jsx(fe,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-700 font-medium",children:m})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"name",name:"name",type:"text",value:o.name,onChange:f,className:"input-float w-full pl-12",placeholder:"John Doe",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"email",name:"email",type:"email",value:o.email,onChange:f,className:"input-float w-full pl-12",placeholder:"you@example.com",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"phone",name:"phone",type:"tel",value:o.phone,onChange:f,className:"input-float w-full pl-12",placeholder:"+1 (555) 000-0000",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"password",name:"password",type:"password",value:o.password,onChange:f,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:b,minLength:8})]}),e.jsx("p",{className:"text-xs text-primary/50 mt-2 ml-1 font-medium",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",value:o.confirmPassword,onChange:f,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:b})]})]}),e.jsx(ue,{type:"submit",variant:"primary",size:"lg",disabled:b,className:"w-full text-lg mt-8",children:b?"Creating Account...":"Create Account"})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-primary/70 font-medium",children:["Already have an account?"," ",e.jsx(Ne,{to:"/login",className:"text-gradient-gold font-bold hover:underline transition-all",children:"Sign in here"})]})})]}),e.jsx("div",{className:"text-center mt-8 glass-card inline-block px-6 py-3 mx-auto",children:e.jsxs("p",{className:"text-primary/50 text-sm font-medium flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function ea({data:s}){const n=({active:x,payload:p,label:o})=>x&&p&&p.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-2",children:o}),p.map((r,m)=>e.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": â‚¹",r.value.toLocaleString("en-IN")]},m))]}):null;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Investment vs Expense Trend"}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(Et,{data:s,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"month",stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"}}),e.jsx(Le,{stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"},tickFormatter:x=>`â‚¹${(x/1e3).toFixed(0)}k`}),e.jsx(ye,{content:e.jsx(n,{})}),e.jsx(ft,{wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}}),e.jsx($e,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,dot:{fill:"#2D5016",r:5},activeDot:{r:7},name:"Investments"}),e.jsx($e,{type:"monotone",dataKey:"expenses",stroke:"#C85A3E",strokeWidth:3,dot:{fill:"#C85A3E",r:5},activeDot:{r:7},name:"Expenses"})]})})]})}const vs=["#2D5016","#C85A3E","#D4AF37","#87A96B","#3E2723","#D84315"];function ta({data:s}){const n=({active:p,payload:o})=>p&&o&&o.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:o[0].name}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["â‚¹",o[0].value.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[(o[0].value/s.reduce((r,m)=>r+m.value,0)*100).toFixed(1),"% of total"]})]}):null,x=p=>`${p.name}`;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Category-wise Expenses"}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(At,{children:[e.jsx(It,{data:s,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",label:x,children:s.map((p,o)=>e.jsx(Ft,{fill:vs[o%vs.length]},`cell-${o}`))}),e.jsx(ye,{content:e.jsx(n,{})}),e.jsx(ft,{verticalAlign:"bottom",height:36,wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}})]})})]})}const gr=s=>{switch(s){case"expense":return{icon:we,color:"text-secondary",bg:"bg-secondary/20"};case"investment":return{icon:se,color:"text-primary",bg:"bg-primary/20"};case"product":return{icon:ne,color:"text-accent",bg:"bg-accent/20"};default:return{icon:ae,color:"text-dark-brown",bg:"bg-dark-brown/20"}}};function jr({activities:s}){return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Recent Activity"}),e.jsxs("button",{className:"text-sm font-semibold text-primary hover:text-sage transition-colors duration-300 flex items-center gap-1",children:["View All",e.jsx(ss,{className:"w-4 h-4"})]})]}),s.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-dark-brown/50",children:"No recent activity"})}):e.jsx("div",{className:"space-y-4",children:s.map(n=>{const{icon:x,color:p,bg:o}=gr(n.activity_type),r=ts(new Date(n.created_at),{addSuffix:!0});return e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-cream/30 rounded-xl hover:bg-cream/50 transition-all duration-300",children:[e.jsx("div",{className:`w-10 h-10 ${o} rounded-full flex items-center justify-center flex-shrink-0`,children:e.jsx(x,{className:`w-5 h-5 ${p}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-dark-brown leading-relaxed mb-1",children:n.description}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:r})]})]},n.id)})})]})}function yr(){const{user:s}=H(),[n,x]=i.useState({totalInvestments:0,totalExpenses:0,activeProducts:0}),[p,o]=i.useState([]),[r,m]=i.useState(!0),d=R(new Date,"EEEE, MMMM d, yyyy"),b=[{month:"Jul",investments:85e3,expenses:52e3},{month:"Aug",investments:92e3,expenses:61e3},{month:"Sep",investments:78e3,expenses:48e3},{month:"Oct",investments:105e3,expenses:72e3},{month:"Nov",investments:118e3,expenses:68e3},{month:"Dec",investments:125e3,expenses:75e3}],u=[{name:"Raw Materials",value:125e3},{name:"Labor",value:85e3},{name:"Marketing",value:42e3},{name:"Packaging",value:38e3},{name:"Utilities",value:28e3},{name:"Other",value:22e3}];i.useEffect(()=>{t()},[s]);const t=async()=>{if(s)try{const[a,N,y,f]=await Promise.all([C.from("investments").select("amount"),C.from("expenses").select("amount"),C.from("products").select("id, current_stage").in("current_stage",["idea","research","formula","testing","packaging","printing","production","ready"]),C.from("activity_log").select("*").order("created_at",{ascending:!1}).limit(10)]),_=a.data?.reduce((w,j)=>w+parseFloat(j.amount.toString()),0)||0,v=N.data?.reduce((w,j)=>w+parseFloat(j.amount.toString()),0)||0;x({totalInvestments:_,totalExpenses:v,activeProducts:y.data?.length||0}),o(f.data||[])}catch(a){console.error("Error fetching dashboard data:",a)}finally{m(!1)}},c=n.totalInvestments-n.totalExpenses;return e.jsx("div",{className:"page-transition",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"dashboard-hero",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"greeting",children:["Namaste, ",e.jsx("span",{className:"greeting-accent",children:s?.name||"User"})]}),e.jsx("p",{className:"date-time mt-1",children:d}),s?.role==="admin"&&e.jsxs("div",{className:"role-badge",children:[e.jsx(He,{className:"w-3 h-3"}),e.jsx("span",{children:"Admin"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[#6B7280] text-[0.6875rem] uppercase tracking-wider font-medium mb-1",children:"Net Balance"}),e.jsxs("p",{className:`text-2xl md:text-[1.875rem] font-semibold ${c>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",c.toLocaleString("en-IN")]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-6 stagger-container",children:[e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Investments"}),e.jsxs("div",{className:"number",children:["â‚¹",(n.totalInvestments/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend positive mt-2",children:[e.jsx("span",{children:"â†‘"}),e.jsx("span",{children:"12%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"this month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Expenses"}),e.jsxs("div",{className:"number",children:["â‚¹",(n.totalExpenses/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend negative mt-2",children:[e.jsx("span",{children:"â†“"}),e.jsx("span",{children:"8%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"vs last month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Net Balance"}),e.jsxs("div",{className:`number ${c>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",(Math.abs(c)/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:`trend mt-2 ${c>=0?"positive":"negative"}`,children:[e.jsx("span",{children:c>=0?"â†‘":"â†“"}),e.jsx("span",{children:c>=0?"Positive":"Negative"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Active Products"}),e.jsx("div",{className:"number",children:n.activeProducts}),e.jsxs("div",{className:"trend mt-2 text-[#2D5016]",children:[e.jsx("span",{children:"â—"}),e.jsx("span",{children:"In Pipeline"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(ea,{data:b}),e.jsx(ta,{data:u})]}),e.jsx(jr,{activities:p})]})})}function _t({title:s,value:n,trend:x,icon:p,iconBgColor:o,iconColor:r,valueColor:m="text-dark-brown"}){const d=x&&x.value>=0;return e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 hover:scale-[1.02] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-0 group-hover:opacity-5 transition-opacity duration-300"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 ${o} rounded-full flex items-center justify-center`,children:e.jsx(p,{className:`w-6 h-6 ${r}`})}),x&&e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full ${d?"bg-sage/20":"bg-soft-red/20"}`,children:[d?e.jsx(se,{className:"w-3 h-3 text-sage"}):e.jsx(we,{className:"w-3 h-3 text-soft-red"}),e.jsxs("span",{className:`text-xs font-semibold ${d?"text-sage":"text-soft-red"}`,children:[Math.abs(x.value),"%"]})]})]}),e.jsx("h3",{className:"text-sm font-medium text-dark-brown/60 mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold ${m} mb-1`,children:n}),x&&e.jsx("p",{className:"text-xs text-dark-brown/50",children:x.label})]})]})}function wr(){const{user:s}=H(),[n,x]=i.useState({total:0,thisMonth:0,lastMonth:0,byCategory:[]}),[p,o]=i.useState({total:0,thisMonth:0,count:0}),[r,m]=i.useState(!0);i.useEffect(()=>{d()},[s?.id]);const d=async()=>{if(s?.id)try{const u=new Date,t=new Date(u.getFullYear(),u.getMonth(),1),c=new Date(u.getFullYear(),u.getMonth()-1,1),a=new Date(u.getFullYear(),u.getMonth(),0),{data:N,error:y}=await C.from("expenses").select("*").eq("user_id",s.id).eq("status","approved").order("expense_date",{ascending:!1});if(y)throw y;const f=N?.filter(l=>new Date(l.expense_date)>=t)||[],_=N?.filter(l=>new Date(l.expense_date)>=c&&new Date(l.expense_date)<=a)||[],v=N?.reduce((l,k)=>(l[k.category]=(l[k.category]||0)+parseFloat(k.amount),l),{})||{};x({total:N?.reduce((l,k)=>l+parseFloat(k.amount),0)||0,thisMonth:f.reduce((l,k)=>l+parseFloat(k.amount),0),lastMonth:_.reduce((l,k)=>l+parseFloat(k.amount),0),byCategory:Object.entries(v).map(([l,k])=>({category:l,total:k}))});const{data:w,error:j}=await C.from("investments").select("*").order("investment_date",{ascending:!1});j&&console.error("Error fetching investments:",j);const h=w?.filter(l=>new Date(l.investment_date)>=t)||[];o({total:w?.reduce((l,k)=>l+parseFloat(k.amount),0)||0,thisMonth:h.reduce((l,k)=>l+parseFloat(k.amount),0),count:w?.length||0})}catch(u){console.error("Error fetching financial data:",u)}finally{m(!1)}},b=n.lastMonth>0?(n.thisMonth-n.lastMonth)/n.lastMonth*100:0;return r?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 page-transition",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx(qe,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"Finance Overview"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Expense and investment analytics"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(_t,{title:"Total Expenses",value:`â‚¹${n.total.toLocaleString()}`,icon:Pt,trend:b>0?"up":b<0?"down":void 0,trendValue:b!==0?`${Math.abs(b).toFixed(1)}% vs last month`:void 0,iconColor:"bg-gradient-to-br from-red-500 to-pink-600"}),e.jsx(_t,{title:"This Month",value:`â‚¹${n.thisMonth.toLocaleString()}`,icon:De,iconColor:"bg-gradient-to-br from-blue-500 to-cyan-600"}),e.jsx(_t,{title:"Investments",value:`â‚¹${p.total.toLocaleString()}`,icon:Ba,trendValue:p.count>0?`${p.count} total`:void 0,iconColor:"bg-gradient-to-br from-green-500 to-emerald-600"}),e.jsx(_t,{title:"Net Balance",value:`â‚¹${(p.total-n.total).toLocaleString()}`,icon:se,trend:p.total>n.total?"up":"down",iconColor:"bg-gradient-gold"})]}),n.byCategory.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(Pt,{className:"w-5 h-5"}),"Expense by Category"]}),e.jsx(ta,{data:n.byCategory.map(u=>({name:u.category,value:u.total}))})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Expenses vs Investments"]}),e.jsx(ea,{data:[{month:"Last Month",investments:p.total-p.thisMonth,expenses:n.lastMonth},{month:"This Month",investments:p.thisMonth,expenses:n.thisMonth}]})]})]})]})}const ks=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],Nr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function vr(){const{user:s}=H(),n=ce(),[x,p]=i.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[o,r]=i.useState(null),[m,d]=i.useState(""),[b,u]=i.useState([]),[t,c]=i.useState([]),[a,N]=i.useState(!1),[y,f]=i.useState({}),[_,v]=i.useState(!1),[w,j]=i.useState(0);i.useEffect(()=>{h(),l()},[]);const h=async()=>{try{const{data:E,error:I}=await C.from("vendors").select("id, name").order("name");if(I)throw I;u(E||[])}catch(E){console.error("Error fetching vendors:",E)}},l=async()=>{try{const{data:E,error:I}=await C.from("users").select("id, name").order("name");if(I)throw I;c(E||[])}catch(E){console.error("Error fetching partners:",E)}},k=E=>{const I=E.target.files?.[0];if(I){if(I.size>5*1024*1024){f({...y,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes(I.type)){f({...y,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(r(I),f({...y,bill:""}),I.type.startsWith("image/")){const q=new FileReader;q.onloadend=()=>{d(q.result)},q.readAsDataURL(I)}else d("")}},g=()=>{const E={};return x.category||(E.category="Category is required"),(!x.amount||parseFloat(x.amount)<=0)&&(E.amount="Amount must be greater than 0"),x.date||(E.date="Date is required"),x.paymentMode||(E.paymentMode="Payment mode is required"),x.paidBy||(E.paidBy="Please select who paid"),f(E),Object.keys(E).length===0},D=async()=>{if(!o||!s)return null;try{const E=o.name.split(".").pop(),I=`${s.id}/${Date.now()}.${E}`,{error:q}=await C.storage.from("expense-bills").upload(I,o);if(q)throw q;const{data:O}=C.storage.from("expense-bills").getPublicUrl(I);return O.publicUrl}catch(E){return console.error("Error uploading bill:",E),null}},P=async(E="pending")=>{if(!(E==="pending"&&!g())){N(!0);try{let I=null;o&&(I=await D());const q={user_id:s?.id,category:x.category,subcategory:x.subcategory||null,amount:parseFloat(x.amount),expense_date:x.date,payment_mode:x.paymentMode,paid_by:x.paidBy,vendor_id:x.vendorId||null,bill_url:I,purpose:x.purpose||null,status:E==="draft"?"draft":"pending",submitted_by:s?.id,submitted_at:new Date().toISOString()},{error:O}=await C.from("expenses").insert(q);if(O)throw O;if(E!=="draft"){const Y=ks.find(ee=>ee.value===x.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense",description:`${s?.name} added expense: â‚¹${parseFloat(x.amount).toLocaleString("en-IN")} for ${Y?.label||x.category}`})}v(!0),setTimeout(()=>{n("/expenses")},2e3)}catch(I){console.error("Error submitting expense:",I),f({submit:"Failed to submit expense. Please try again."})}finally{N(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Add New Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Submit an expense for approval"})]}),_&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx($t,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense submitted for approval!"})]}),y.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:y.submit})]}),e.jsx("form",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:x.category,onChange:E=>p({...x,category:E.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${y.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),ks.map(E=>e.jsxs("option",{value:E.value,children:[E.icon," ",E.label]},E.value))]}),y.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:y.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:x.subcategory,onChange:E=>p({...x,subcategory:E.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:x.amount,onChange:E=>p({...x,amount:E.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${y.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),y.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:y.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:x.date,onChange:E=>p({...x,date:E.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${y.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),y.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:y.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:x.paidBy,onChange:E=>p({...x,paidBy:E.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${y.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),t.map(E=>e.jsx("option",{value:E.id,children:E.name},E.id))]}),y.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:y.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Nr.map(E=>e.jsxs("button",{type:"button",onClick:()=>p({...x,paymentMode:E.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${x.paymentMode===E.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:E.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:E.label})]},E.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:x.vendorId,onChange:E=>p({...x,vendorId:E.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),b.map(E=>e.jsx("option",{value:E.id,children:E.name},E.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:k,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:o?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[m&&e.jsx("img",{src:m,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:o.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(o.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:E=>{E.preventDefault(),r(null),d("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(oe,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),y.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:y.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[w,"/500"]})]}),e.jsx("textarea",{value:x.purpose,onChange:E=>{E.target.value.length<=500&&(p({...x,purpose:E.target.value}),j(E.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>P("pending"),disabled:a,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-5 h-5 animate-spin"}),"Submitting..."]}):"Submit for Approval"}),e.jsx("button",{type:"button",onClick:()=>P("draft"),disabled:a,className:"px-8 py-4 bg-transparent text-primary font-semibold rounded-xl border-2 border-primary hover:bg-primary hover:text-cream transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save as Draft"}),e.jsx("button",{type:"button",onClick:()=>n("/expenses"),disabled:a,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]})}const _s=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],kr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function _r(){const{user:s}=H(),n=ce(),{id:x}=Je(),p=s?.role==="admin",[o,r]=i.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[m,d]=i.useState(null),[b,u]=i.useState(""),[t,c]=i.useState(""),[a,N]=i.useState([]),[y,f]=i.useState([]),[_,v]=i.useState(!1),[w,j]=i.useState(!0),[h,l]=i.useState({}),[k,g]=i.useState(!1),[D,P]=i.useState(0);i.useEffect(()=>{if(!p){n("/expenses");return}E(),I(),q()},[x,p]);const E=async()=>{if(x)try{const{data:S,error:$}=await C.from("expenses").select("*").eq("id",x).maybeSingle();if($)throw $;S&&(r({category:S.category,subcategory:S.subcategory||"",amount:S.amount.toString(),date:S.expense_date,paymentMode:S.payment_mode,paidBy:S.paid_by,vendorId:S.vendor_id||"",purpose:S.purpose||""}),P(S.purpose?.length||0),c(S.bill_url||""))}catch(S){console.error("Error fetching expense:",S),alert("Failed to load expense. Redirecting to expense list."),n("/expenses")}finally{j(!1)}},I=async()=>{try{const{data:S,error:$}=await C.from("vendors").select("id, name").order("name");if($)throw $;N(S||[])}catch(S){console.error("Error fetching vendors:",S)}},q=async()=>{try{const{data:S,error:$}=await C.from("users").select("id, name").order("name");if($)throw $;f(S||[])}catch(S){console.error("Error fetching partners:",S)}},O=S=>{const $=S.target.files?.[0];if($){if($.size>5*1024*1024){l({...h,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes($.type)){l({...h,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(d($),l({...h,bill:""}),$.type.startsWith("image/")){const L=new FileReader;L.onloadend=()=>{u(L.result)},L.readAsDataURL($)}else u("")}},Y=()=>{const S={};return o.category||(S.category="Category is required"),(!o.amount||parseFloat(o.amount)<=0)&&(S.amount="Amount must be greater than 0"),o.date||(S.date="Date is required"),o.paymentMode||(S.paymentMode="Payment mode is required"),o.paidBy||(S.paidBy="Please select who paid"),l(S),Object.keys(S).length===0},ee=async()=>{if(!m||!s)return null;try{const S=m.name.split(".").pop(),$=`${s.id}/${Date.now()}.${S}`,{error:L}=await C.storage.from("expense-bills").upload($,m);if(L)throw L;const{data:V}=C.storage.from("expense-bills").getPublicUrl($);return V.publicUrl}catch(S){return console.error("Error uploading bill:",S),null}},te=async S=>{if(S.preventDefault(),!!Y()){v(!0);try{let $=t;if(m){const z=await ee();z&&($=z)}const L={category:o.category,subcategory:o.subcategory||null,amount:parseFloat(o.amount),expense_date:o.date,payment_mode:o.paymentMode,paid_by:o.paidBy,vendor_id:o.vendorId||null,bill_url:$,purpose:o.purpose||null},{error:V}=await C.from("expenses").update(L).eq("id",x);if(V)throw V;const T=_s.find(z=>z.value===o.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense_updated",description:`${s?.name} updated expense: â‚¹${parseFloat(o.amount).toLocaleString("en-IN")} for ${T?.label||o.category}`}),g(!0),setTimeout(()=>{n("/expenses")},2e3)}catch($){console.error("Error updating expense:",$),l({submit:"Failed to update expense. Please try again."})}finally{v(!1)}}};return p?w?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})}):e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>n("/expenses"),className:"flex items-center gap-2 text-primary hover:text-primary/80 font-medium mb-4 transition-colors",children:[e.jsx(ze,{className:"w-4 h-4"}),"Back to Expenses"]}),e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Edit Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Update expense details"})]}),k&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx($t,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense updated successfully!"})]}),h.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:h.submit})]}),e.jsx("form",{onSubmit:te,className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:o.category,onChange:S=>r({...o,category:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${h.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),_s.map(S=>e.jsxs("option",{value:S.value,children:[S.icon," ",S.label]},S.value))]}),h.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:o.subcategory,onChange:S=>r({...o,subcategory:S.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:o.amount,onChange:S=>r({...o,amount:S.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${h.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),h.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:o.date,onChange:S=>r({...o,date:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${h.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),h.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:o.paidBy,onChange:S=>r({...o,paidBy:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${h.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),y.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]}),h.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:kr.map(S=>e.jsxs("button",{type:"button",onClick:()=>r({...o,paymentMode:S.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${o.paymentMode===S.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:S.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:S.label})]},S.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:o.vendorId,onChange:S=>r({...o,vendorId:S.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),a.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload"}),t&&!m&&e.jsx("div",{className:"mb-4 p-4 bg-sage/5 border-2 border-sage/20 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:"ðŸ“„"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"Current Bill"}),e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline",children:"View existing bill"})]})]}),e.jsx("button",{type:"button",onClick:()=>c(""),className:"text-xs text-soft-red hover:underline",children:"Remove"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:O,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:m?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[b&&e.jsx("img",{src:b,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:m.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(m.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:S=>{S.preventDefault(),d(null),u("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(oe,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:t?"Upload new bill to replace existing":"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),h.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:h.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[D,"/500"]})]}),e.jsx("textarea",{value:o.purpose,onChange:S=>{S.target.value.length<=500&&(r({...o,purpose:S.target.value}),P(S.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"submit",disabled:_,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-5 h-5 animate-spin"}),"Updating..."]}):"Update Expense"}),e.jsx("button",{type:"button",onClick:()=>n("/expenses"),disabled:_,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]}):null}const Cr=["Duplicate entry","Insufficient proof","Incorrect amount","Wrong category","Not a business expense","Missing receipt","Other (specify below)"];function sa({isOpen:s,onClose:n,onConfirm:x,type:p,expense:o,loading:r=!1}){const[m,d]=i.useState(""),[b,u]=i.useState(""),[t,c]=i.useState("");if(!s)return null;const a=()=>{if(p==="reject"){const y=b==="Other (specify below)"?t:b;if(!y.trim()){alert("Please provide a reason for rejection");return}x(void 0,y)}else x(m)},N=y=>y.split("_").map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:`p-6 border-b-2 ${p==="approve"?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p==="approve"?e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-green-600"})}):e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Me,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-gray-900",children:p==="approve"?"Approve Expense":"Reject Expense"}),e.jsx("p",{className:"text-sm text-gray-600",children:p==="approve"?"Confirm approval of this expense":"Please provide a reason"})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-5 h-5 text-gray-600"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"Expense Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[N(o.category),o.subcategory&&` - ${o.subcategory}`]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-orange-600 text-xl",children:["â‚¹",o.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Date(o.expense_date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment:"}),e.jsx("span",{className:"font-semibold text-gray-900 uppercase",children:o.payment_mode.replace("_"," ")})]})]})]}),p==="reject"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Reason for Rejection ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:b,onChange:y=>u(y.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select a reason"}),Cr.map(y=>e.jsx("option",{value:y,children:y},y))]})]}),b==="Other (specify below)"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Specify Reason"}),e.jsx("textarea",{value:t,onChange:y=>c(y.target.value),placeholder:"Please provide detailed reason...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(fe,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:"The submitter will be notified of this rejection and the reason provided."})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Comments (Optional)"}),e.jsx("textarea",{value:m,onChange:y=>d(y.target.value),placeholder:"Add any comments or notes...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:n,disabled:r,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 font-bold rounded-xl hover:bg-gray-50 transition-all duration-300 disabled:opacity-50 shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:r,className:`flex-1 px-6 py-3 font-bold rounded-xl shadow-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${p==="approve"?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white":"bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white"}`,children:r?"Processing...":p==="approve"?"Confirm Approval":"Confirm Rejection"})]})]})]})]})}function Sr({isOpen:s,onClose:n,billUrl:x,expenseDetails:p}){const[o,r]=i.useState(100),[m,d]=i.useState(0);if(!s)return null;const b=x.toLowerCase().endsWith(".pdf"),u=()=>{window.open(x,"_blank")},t=()=>{r(y=>Math.min(y+25,200))},c=()=>{r(y=>Math.max(y-25,50))},a=()=>{d(y=>(y+90)%360)},N=y=>y.split("_").map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-dark-brown/90 backdrop-blur-md",children:[e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between",children:[e.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-xl px-4 py-3 shadow-soft",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:N(p.category)})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"font-bold text-secondary",children:["â‚¹",p.amount.toLocaleString("en-IN")]})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:new Date(p.date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!b&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,disabled:o<=50,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(rr,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"px-4 py-3 bg-white/90 backdrop-blur-sm rounded-lg shadow-soft",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[o,"%"]})}),e.jsx("button",{onClick:t,disabled:o>=200,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(ar,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("button",{onClick:a,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 shadow-soft",children:e.jsx(Wa,{className:"w-5 h-5 text-dark-brown"})})]}),e.jsx("button",{onClick:u,className:"p-3 bg-primary/90 backdrop-blur-sm rounded-lg hover:bg-primary transition-all duration-300 shadow-soft",children:e.jsx(ke,{className:"w-5 h-5 text-cream"})}),e.jsx("button",{onClick:n,className:"p-3 bg-soft-red/90 backdrop-blur-sm rounded-lg hover:bg-soft-red transition-all duration-300 shadow-soft",children:e.jsx(oe,{className:"w-5 h-5 text-white"})})]})]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-24 overflow-auto",children:b?e.jsx("iframe",{src:x,className:"w-full h-full bg-white rounded-xl shadow-soft-lg",title:"Bill PDF"}):e.jsx("img",{src:x,alt:"Bill",className:"max-w-full max-h-full object-contain rounded-xl shadow-soft-lg transition-transform duration-300",style:{transform:`scale(${o/100}) rotate(${m}deg)`}})})]})}const it=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20 text-sage"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-accent/20 text-accent"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-dark-brown/20 text-dark-brown"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš",color:"bg-primary/20 text-primary"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢",color:"bg-secondary/20 text-secondary"},{value:"lab_testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-sage/30 text-sage"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ",color:"bg-accent/30 text-accent"},{value:"utilities",label:"Utilities",icon:"âš¡",color:"bg-primary/30 text-primary"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢",color:"bg-dark-brown/30 text-dark-brown"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥",color:"bg-secondary/30 text-secondary"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§",color:"bg-sage/40 text-sage"},{value:"other",label:"Other",icon:"ðŸ“±",color:"bg-dark-brown/40 text-dark-brown"}];function Dr(){const{user:s}=H(),n=ce(),[x,p]=i.useState([]),[o,r]=i.useState(!0),[m,d]=i.useState(""),[b,u]=i.useState("all"),[t,c]=i.useState(null),[a,N]=i.useState(!1),[y,f]=i.useState("approve"),[_,v]=i.useState(!1),[w,j]=i.useState(null),[h,l]=i.useState(1),[k,g]=i.useState(20),[D,P]=i.useState(null),[E,I]=i.useState(!1),[q,O]=i.useState(""),[Y,ee]=i.useState(""),[te,S]=i.useState([]),[$,L]=i.useState([]),[V,T]=i.useState("expense_date"),[z,ie]=i.useState("desc"),me=s?.role==="admin";i.useEffect(()=>{_e();const M=C.channel("expenses-changes").on("postgres_changes",{event:"*",schema:"public",table:"expenses"},()=>{_e()}).subscribe();return()=>{C.removeChannel(M)}},[]);const _e=async()=>{if(s)try{let M=C.from("expenses").select(`
          *,
          users_paid_by:users!expenses_paid_by_fkey(name),
          users_submitted_by:users!expenses_submitted_by_fkey(name),
          users_approved_by:users!expenses_approved_by_fkey(name),
          vendors(name)
        `);me||(M=M.eq("submitted_by",s.id));const{data:B,error:W}=await M.order(V,{ascending:z==="asc"});if(W)throw W;p(B||[])}catch(M){console.error("Error fetching expenses:",M)}finally{r(!1)}},jt=M=>{c(M),f("approve"),N(!0)},Ce=M=>{c(M),f("reject"),N(!0)},We=async(M,B)=>{if(!(!t||!s)){P(t.id);try{const W={status:y==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};y==="approve"&&M?W.approval_comments=M:y==="reject"&&B&&(W.rejection_reason=B);const{error:Nt}=await C.from("expenses").update(W).eq("id",t.id);if(Nt)throw Nt;const Ot=it.find(Qe=>Qe.value===t.category);await C.from("activity_log").insert({user_id:s.id,activity_type:y==="approve"?"expense_approved":"expense_rejected",description:`${s.name} ${y==="approve"?"approved":"rejected"} expense: â‚¹${t.amount.toLocaleString("en-IN")} for ${Ot?.label||t.category}`}),await _e(),N(!1),c(null)}catch(W){console.error("Error processing approval:",W),alert("Failed to process approval. Please try again.")}finally{P(null)}}},Xe=async M=>{if(confirm("Are you sure you want to delete this expense? This action cannot be undone."))try{const{error:B}=await C.from("expenses").delete().eq("id",M);if(B)throw B;await _e()}catch(B){console.error("Error deleting expense:",B),alert("Failed to delete expense. Please try again.")}},yt=M=>{M.bill_url&&(c(M),v(!0),C.from("expenses").update({viewed_bill:!0}).eq("id",M.id).then())},et=M=>{switch(M){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},Pe=M=>it.find(B=>B.value===M)||it[it.length-1],Ee=x.filter(M=>{if(b==="pending"&&M.status!=="pending"||b==="approved"&&M.status!=="approved"||b==="rejected"&&M.status!=="rejected"||b==="my_expenses"&&M.submitted_by!==s?.id)return!1;if(m){const B=m.toLowerCase();if(!M.category.toLowerCase().includes(B)&&!M.subcategory?.toLowerCase().includes(B)&&!M.purpose?.toLowerCase().includes(B)&&!M.vendors?.name.toLowerCase().includes(B))return!1}return!(q&&M.expense_date<q||Y&&M.expense_date>Y||te.length>0&&!te.includes(M.category)||$.length>0&&!$.includes(M.payment_mode))}),wt=Ee.slice((h-1)*k,h*k),Ae=Math.ceil(Ee.length/k),Rt=M=>M==="all"?x.length:M==="pending"?x.filter(B=>B.status==="pending").length:M==="approved"?x.filter(B=>B.status==="approved").length:M==="rejected"?x.filter(B=>B.status==="rejected").length:M==="my_expenses"?x.filter(B=>B.submitted_by===s?.id).length:0,Ut=x.filter(M=>{const B=new Date(M.expense_date),W=new Date;return B.getMonth()===W.getMonth()&&B.getFullYear()===W.getFullYear()}).reduce((M,B)=>M+B.amount,0),zt=M=>{S(B=>B.includes(M)?B.filter(W=>W!==M):[...B,M])},Bt=M=>{L(B=>B.includes(M)?B.filter(W=>W!==M):[...B,M])},tt=()=>{d(""),O(""),ee(""),S([]),L([]),u("all")},Ge=M=>{V===M?ie(B=>B==="asc"?"desc":"asc"):(T(M),ie("desc"))};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Expense Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Manage and approve all expenses"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",Ut.toLocaleString("en-IN")]})]}),e.jsxs("button",{onClick:()=>n("/expenses/add"),className:"flex items-center gap-2 px-6 py-3 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Expense"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 mb-6",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 mt-2 overflow-x-auto pb-6 pt-2 scrollbar-thin",children:["all","pending","approved","rejected","my_expenses"].map(M=>e.jsxs("button",{onClick:()=>u(M),className:`px-4 py-2 rounded-lg font-medium whitespace-nowrap transition-all duration-300 flex items-center gap-2 ${b===M?"bg-primary text-cream shadow-soft":"bg-cream/50 text-dark-brown hover:bg-primary/10"}`,children:[M==="all"&&"All",M==="pending"&&"â³ Pending",M==="approved"&&"âœ… Approved",M==="rejected"&&"âŒ Rejected",M==="my_expenses"&&"My Expenses",e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${b===M?"bg-cream/20 text-cream":"bg-dark-brown/10 text-dark-brown"}`,children:Rt(M)})]},M))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search by category, vendor, or purpose...",value:m,onChange:M=>d(M.target.value),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsxs("button",{onClick:()=>I(!E),className:`flex items-center gap-2 px-6 py-3 border-2 font-semibold rounded-xl transition-all duration-300 ${E||te.length>0||$.length>0||q||Y?"border-primary bg-primary text-cream":"border-primary text-primary hover:bg-primary hover:text-cream"}`,children:[e.jsx(Bs,{className:"w-5 h-5"}),"Filters",te.length+$.length+(q?1:0)+(Y?1:0)>0&&e.jsx("span",{className:"px-2 py-0.5 bg-cream/20 rounded-full text-xs font-bold",children:te.length+$.length+(q?1:0)+(Y?1:0)})]}),e.jsxs("button",{onClick:()=>alert("Export feature coming soon"),className:"flex items-center gap-2 px-6 py-3 border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export"]})]}),E&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:q,onChange:M=>O(M.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:Y,onChange:M=>ee(M.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:it.map(M=>e.jsxs("button",{onClick:()=>zt(M.value),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${te.includes(M.value)?M.color:"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:[M.icon," ",M.label]},M.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Mode"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["cash","upi","bank_transfer","card"].map(M=>e.jsx("button",{onClick:()=>Bt(M),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${$.includes(M)?"bg-primary text-cream":"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:M.toUpperCase().replace("_"," ")},M))})]}),e.jsx("button",{onClick:tt,className:"w-full py-2 text-soft-red font-semibold hover:bg-soft-red/10 rounded-lg transition-all",children:"Reset All Filters"})]})]})]}),o?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading expenses..."})}):Ee.length===0?e.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No expenses found"}),e.jsxs("button",{onClick:()=>n("/expenses/add"),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-white font-semibold rounded-xl hover:scale-105 transition-all duration-300",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Your First Expense"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-primary/10",children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>Ge("expense_date"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Date ",V==="expense_date"&&(z==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsxs("th",{onClick:()=>Ge("amount"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Amount ",V==="amount"&&(z==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Payment"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Bill"}),e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:wt.map((M,B)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{onClick:()=>j(w===M.id?null:M.id),className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors cursor-pointer ${B%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:R(new Date(M.expense_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Pe(M.category).color}`,children:[Pe(M.category).icon," ",Pe(M.category).label]})}),M.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1",children:M.subcategory})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",M.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:M.users_paid_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-xs font-semibold text-dark-brown uppercase",children:M.payment_mode.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-4",children:et(M.status)}),e.jsx("td",{className:"px-4 py-4",children:M.bill_url?e.jsx("button",{onClick:W=>{W.stopPropagation(),yt(M)},className:"p-2 hover:bg-primary/10 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No bill"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[me&&M.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:W=>{W.stopPropagation(),jt(M)},disabled:D===M.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(Q,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:W=>{W.stopPropagation(),Ce(M)},disabled:D===M.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Me,{className:"w-4 h-4 text-soft-red"})})]}),me&&e.jsx("button",{onClick:W=>{W.stopPropagation(),n(`/expenses/edit/${M.id}`)},className:"p-2 hover:bg-accent/10 rounded-lg transition-colors",title:"Edit",children:e.jsx(js,{className:"w-4 h-4 text-accent"})}),me&&e.jsx("button",{onClick:W=>{W.stopPropagation(),Xe(M.id)},className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(le,{className:"w-4 h-4 text-soft-red"})})]})})]},M.id),w===M.id&&e.jsx("tr",{className:"bg-primary/5",children:e.jsx("td",{colSpan:8,className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-3",children:[M.purpose&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Purpose/Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.purpose})]}),M.vendors&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Vendor"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.vendors.name})]}),M.approval_comments&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-sage mb-1",children:"Approval Comments"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.approval_comments})]}),M.rejection_reason&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-soft-red mb-1",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.rejection_reason})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-dark-brown/50",children:[e.jsxs("span",{children:["Submitted by: ",M.users_submitted_by?.name]}),M.users_approved_by&&e.jsxs("span",{children:["Approved by: ",M.users_approved_by.name]})]})]})})})]}))})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:wt.map(M=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 hover:shadow-soft-lg transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Pe(M.category).color}`,children:[Pe(M.category).icon," ",Pe(M.category).label]}),et(M.status)]}),M.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mb-2",children:M.subcategory})]}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",M.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Date:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:R(new Date(M.expense_date),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Paid by:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:M.users_paid_by?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Payment:"}),e.jsx("span",{className:"font-medium text-dark-brown uppercase",children:M.payment_mode.replace("_"," ")})]})]}),M.purpose&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Purpose"}),e.jsx("p",{className:"text-sm text-dark-brown",children:M.purpose})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4 pt-3 border-t border-dark-brown/10",children:[M.bill_url&&e.jsxs("button",{onClick:()=>yt(M),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-primary/10 text-primary font-semibold rounded-lg hover:bg-primary/20 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"View Bill"]}),me&&M.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>jt(M),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-sage/10 text-sage font-semibold rounded-lg hover:bg-sage/20 transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>Ce(M),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red font-semibold rounded-lg hover:bg-soft-red/20 transition-colors",children:[e.jsx(Me,{className:"w-4 h-4"}),"Reject"]})]}),me&&e.jsxs("button",{onClick:()=>n(`/expenses/edit/${M.id}`),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-accent/10 text-accent font-semibold rounded-lg hover:bg-accent/20 transition-colors",children:[e.jsx(js,{className:"w-4 h-4"}),"Edit"]})]})]},M.id))}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 mt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Items per page:"}),e.jsxs("select",{value:k,onChange:M=>{g(Number(M.target.value)),l(1)},className:"px-3 py-1 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsxs("span",{className:"text-sm text-dark-brown/70",children:["Showing ",(h-1)*k+1," - ",Math.min(h*k,Ee.length)," of ",Ee.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(M=>Math.max(1,M-1)),disabled:h===1,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ea,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,Ae)},(M,B)=>{let W;return Ae<=5||h<=3?W=B+1:h>=Ae-2?W=Ae-4+B:W=h-2+B,e.jsx("button",{onClick:()=>l(W),className:`w-10 h-10 rounded-lg font-semibold transition-all ${h===W?"bg-primary text-cream":"border-2 border-dark-brown/10 text-dark-brown hover:bg-primary/10"}`,children:W},W)})}),e.jsx("button",{onClick:()=>l(M=>Math.min(Ae,M+1)),disabled:h===Ae,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Us,{className:"w-5 h-5 text-dark-brown"})})]})]})})]})]})}),a&&t&&e.jsx(sa,{isOpen:a,onClose:()=>{N(!1),c(null)},onConfirm:We,type:y,expense:t,loading:D===t.id}),_&&t&&t.bill_url&&e.jsx(Sr,{isOpen:_,onClose:()=>{v(!1),c(null)},billUrl:t.bill_url,expenseDetails:{category:t.category,amount:t.amount,date:t.expense_date}})]})}function Mr({expenses:s,investments:n,vendors:x}){const p=s.filter(k=>k.status==="approved"),o=n.filter(k=>k.status==="approved"),r=p.reduce((k,g)=>k+g.amount,0),m=o.reduce((k,g)=>k+g.amount,0),d=m-r,b=m>0?d/m*100:0,u={};for(let k=11;k>=0;k--){const g=xt(new Date,k),D=R(g,"yyyy-MM"),P=R(g,"MMM yyyy");u[D]={month:P,investments:0,expenses:0,net:0}}o.forEach(k=>{const g=R(new Date(k.investment_date),"yyyy-MM");u[g]&&(u[g].investments+=k.amount)}),p.forEach(k=>{const g=R(new Date(k.expense_date),"yyyy-MM");u[g]&&(u[g].expenses+=k.amount)});const t=Object.values(u).map(k=>({...k,net:k.investments-k.expenses})),c=p.length>0?r/Object.keys(u).length:0,a=p.reduce((k,g)=>(k[g.category]||(k[g.category]=0),k[g.category]+=g.amount,k),{}),N=Object.entries(a).sort((k,g)=>g[1]-k[1])[0],y=p.reduce((k,g)=>{const D=g.paid_by||g.user_id;return k[D]||(k[D]={name:g.users_paid_by?.name||g.users?.name||"Unknown",total:0}),k[D].total+=g.amount,k},{}),f=Object.values(y).sort((k,g)=>g.total-k.total)[0],_=p.length>0?r/p.length:0,v=s.filter(k=>k.status==="pending").length,w=p.reduce((k,g)=>{const D=g.payment_mode||"unknown";return k[D]=(k[D]||0)+1,k},{}),j=Object.entries(w).sort((k,g)=>g[1]-k[1])[0],h=t.reduce((k,g)=>g.expenses>k.expenses?g:k,t[0]||{month:"N/A",expenses:0}),l=k=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[k]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/30 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Investments"})]}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-1",children:["â‚¹",m.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/20 to-secondary/10 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/30 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Expenses"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",r.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Spent"})]}),e.jsxs("div",{className:`bg-gradient-to-br rounded-xl p-6 border-2 shadow-soft ${d>=0?"from-accent/20 to-accent/10 border-accent/30":"from-soft-red/20 to-soft-red/10 border-soft-red/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${d>=0?"bg-accent/30":"bg-soft-red/30"}`,children:d>=0?e.jsx(se,{className:"w-6 h-6 text-accent"}):e.jsx(we,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:`text-xs font-semibold uppercase tracking-wide ${d>=0?"text-accent":"text-soft-red"}`,children:"Net Balance"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${d>=0?"text-accent":"text-soft-red"}`,children:["â‚¹",Math.abs(d).toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[b.toFixed(1),"% margin"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/30 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Burn Rate"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary mb-1",children:["â‚¹",c.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Month Avg"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-3xl",children:N?l(N[0]):"ðŸ“Š"}),e.jsx(is,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Category"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1",children:N?N[0]:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",N?N[1].toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:f?f.name.charAt(0):"?"}),e.jsx(je,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Spender"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1 truncate",children:f?f.name:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",f?f.total.toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(pt,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Avg Expense"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",_.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending Approvals"}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:v})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment vs Expense Trend (12 Months)"}),e.jsx(be,{width:"100%",height:400,children:e.jsxs(ba,{data:t,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Le,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ye,{formatter:k=>`â‚¹${k.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ft,{}),e.jsx(ua,{type:"monotone",dataKey:"net",fill:"#B8860B",fillOpacity:.1,stroke:"none",name:"Net Balance"}),e.jsx($e,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,name:"Investments",dot:{fill:"#2D5016",r:5}}),e.jsx($e,{type:"monotone",dataKey:"expenses",stroke:"#C17817",strokeWidth:3,name:"Expenses",dot:{fill:"#C17817",r:5}})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-accent/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent",children:"Quick Insight"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Highest spending month:"})}),e.jsx("p",{className:"text-lg font-bold text-secondary",children:h.month}),e.jsxs("p",{className:"text-xl font-bold text-accent",children:["â‚¹",h.expenses.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-sage/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(pt,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage",children:"Payment Mode"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Most used:"})}),e.jsx("p",{className:"text-xl font-bold text-secondary uppercase",children:j?j[0]:"N/A"}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[j?j[1]:0," transactions"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-primary/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-sm font-semibold text-primary",children:"Efficiency"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Approval rate:"})}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[s.length>0?(p.length/s.length*100).toFixed(0):0,"%"]})]})]})]})}const Ct=["#C17817","#2D5016","#B8860B","#8B4513","#D4AF37","#CD853F","#DAA520","#A0522D"];function Pr({expenses:s}){const[n,x]=i.useState(null),[p,o]=i.useState("all"),r=s.filter(v=>v.status==="approved"),b=(v=>{if(p==="all")return v;const w=parseInt(p),j=xt(new Date,w);return v.filter(h=>new Date(h.expense_date)>=j)})(r).reduce((v,w)=>{const j=w.category;return v[j]||(v[j]={category:j,total:0,count:0,expenses:[]}),v[j].total+=w.amount,v[j].count+=1,v[j].expenses.push(w),v},{}),u=Object.values(b).sort((v,w)=>w.total-v.total),t=u.reduce((v,w)=>v+w.total,0),c=u.map(v=>({name:v.category,value:v.total})),a=u.map(v=>({category:v.category,amount:v.total})),N=v=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[v]||"ðŸ’°",y=v=>{const w={};for(let h=5;h>=0;h--){const l=xt(new Date,h),k=R(l,"MMM");w[k]=0}return r.filter(h=>h.category===v).forEach(h=>{const l=R(new Date(h.expense_date),"MMM");w[l]!==void 0&&(w[l]+=h.amount)}),Object.entries(w).map(([h,l])=>({month:h,value:l}))},f=v=>{const w=new Date().getMonth(),j=new Date(new Date().setMonth(w-1)).getMonth(),h=r.filter(g=>g.category===v&&new Date(g.expense_date).getMonth()===w).reduce((g,D)=>g+D.amount,0),l=r.filter(g=>g.category===v&&new Date(g.expense_date).getMonth()===j).reduce((g,D)=>g+D.amount,0);if(l===0)return{direction:"neutral",percent:0};const k=(h-l)/l*100;return{direction:k>0?"up":k<0?"down":"neutral",percent:Math.abs(k)}},_=n?b[n]:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4 items-center mb-6",children:e.jsxs("select",{value:p,onChange:v=>o(v.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"1",children:"Last Month"}),e.jsx("option",{value:"3",children:"Last 3 Months"}),e.jsx("option",{value:"6",children:"Last 6 Months"}),e.jsx("option",{value:"12",children:"Last Year"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map((v,w)=>{const j=t>0?v.total/t*100:0,h=v.count>0?v.total/v.count:0,l=f(v.category),k=y(v.category);return e.jsxs("div",{onClick:()=>x(v.category),className:`bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 shadow-soft cursor-pointer transition-all duration-300 hover:shadow-soft-lg hover:scale-[1.02] ${n===v.category?"border-accent ring-2 ring-accent/20":"border-dark-brown/10"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:N(v.category)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary",children:v.category}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[v.count," transactions"]})]})]}),e.jsxs("div",{className:"text-right",children:[l.direction==="up"&&e.jsxs("div",{className:"flex items-center gap-1 text-soft-red text-xs",children:[e.jsx(se,{className:"w-3 h-3"}),l.percent.toFixed(0),"%"]}),l.direction==="down"&&e.jsxs("div",{className:"flex items-center gap-1 text-sage text-xs",children:[e.jsx(we,{className:"w-3 h-3"}),l.percent.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",v.total.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[j.toFixed(1),"% of total expenses"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Average per transaction"}),e.jsxs("p",{className:"text-lg font-semibold text-accent",children:["â‚¹",h.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsx("div",{className:"h-16",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsx(Et,{data:k,children:e.jsx($e,{type:"monotone",dataKey:"value",stroke:Ct[w%Ct.length],strokeWidth:2,dot:!1})})})})]},v.category)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Distribution"}),c.length>0?e.jsx(be,{width:"100%",height:350,children:e.jsxs(At,{children:[e.jsx(It,{data:c,cx:"50%",cy:"50%",labelLine:!1,label:({name:v,percent:w})=>`${v} (${(w*100).toFixed(0)}%)`,outerRadius:120,fill:"#8884d8",dataKey:"value",onClick:v=>x(v.name),children:c.map((v,w)=>e.jsx(Ft,{fill:Ct[w%Ct.length],className:"cursor-pointer hover:opacity-80 transition-opacity"},`cell-${w}`))}),e.jsx(ye,{formatter:v=>`â‚¹${v.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Comparison"}),a.length>0?e.jsx(be,{width:"100%",height:350,children:e.jsxs(Tt,{data:a,layout:"vertical",children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Le,{dataKey:"category",type:"category",width:120,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(ye,{formatter:v=>`â‚¹${v.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(mt,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0],onClick:v=>x(v.category),className:"cursor-pointer"})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]})]}),_&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-heading text-2xl font-bold text-primary flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:N(_.category)}),_.category," Details"]}),e.jsx("button",{onClick:()=>x(null),className:"px-4 py-2 text-sm font-semibold text-dark-brown hover:bg-dark-brown/5 rounded-lg transition-colors",children:"Clear Selection"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Subcategory"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"})]})}),e.jsx("tbody",{children:_.expenses.sort((v,w)=>new Date(w.expense_date).getTime()-new Date(v.expense_date).getTime()).map((v,w)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${w%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:R(new Date(v.expense_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:v.subcategory||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-lg font-bold text-secondary",children:["â‚¹",v.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:v.users_paid_by?.name||v.users?.name||"Unknown"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:v.vendors?.name||"-"})]},v.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Subtotal:"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-2xl font-bold text-accent",children:["â‚¹",_.total.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:2})]})})]})})]})]})}function Er({expenses:s,investments:n,allUsers:x}){const p=s.filter(f=>f.status==="approved"),o=n.filter(f=>f.status==="approved"),r={};x.forEach(f=>{r[f.id]={id:f.id,name:f.name,totalExpenses:0,totalInvestments:0,expenseCount:0,approvedCount:0,submittedCount:0,paymentModes:{},categories:{}}}),p.forEach(f=>{const _=f.paid_by||f.user_id;if(r[_]){r[_].totalExpenses+=f.amount,r[_].expenseCount+=1,f.status==="approved"&&(r[_].approvedCount+=1);const v=f.payment_mode||"unknown";r[_].paymentModes[v]=(r[_].paymentModes[v]||0)+1;const w=f.category;r[_].categories[w]=(r[_].categories[w]||0)+f.amount}}),s.forEach(f=>{const _=f.submitted_by;_&&r[_]&&(r[_].submittedCount+=1)}),o.forEach(f=>{const _=f.partner_id;r[_]&&(r[_].totalInvestments+=f.amount)});const m=Object.values(r).sort((f,_)=>_.totalInvestments-f.totalInvestments),d=m.map(f=>({name:f.name,Investment:f.totalInvestments,Expense:f.totalExpenses})),b=[...m].filter(f=>f.totalInvestments>0).sort((f,_)=>_.totalInvestments-f.totalInvestments).slice(0,5),u=[...m].filter(f=>f.totalExpenses>0).sort((f,_)=>_.totalExpenses-f.totalExpenses).slice(0,5),t=[...m].filter(f=>f.submittedCount>0).sort((f,_)=>_.approvedCount/_.submittedCount-f.approvedCount/f.submittedCount).slice(0,5),c=f=>f.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),a=f=>{const _=Object.entries(f);return _.length===0?"N/A":_.sort((v,w)=>w[1]-v[1])[0][0].toUpperCase()},N=f=>{const _=Object.entries(f);return _.length===0?"N/A":_.sort((v,w)=>w[1]-v[1])[0][0]},y=f=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[f]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(f=>{const _=f.totalInvestments-f.totalExpenses,v=f.submittedCount>0?f.approvedCount/f.submittedCount*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-lg",children:c(f.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:f.name}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[f.expenseCount," expenses â€¢ ",f.submittedCount," submitted"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-sage/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",f.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",f.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]}),e.jsxs("div",{className:`rounded-lg p-3 mb-4 ${_>=0?"bg-accent/10":"bg-soft-red/10"}`,children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Net Contribution"}),e.jsxs("p",{className:`text-xl font-bold ${_>=0?"text-accent":"text-soft-red"}`,children:[_>=0?"+":"","â‚¹",_.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Approval Rate"]}),e.jsxs("span",{className:"font-semibold text-sage",children:[v.toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4"}),"Payment Mode"]}),e.jsx("span",{className:"font-semibold text-primary",children:a(f.paymentModes)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"Top Category"]}),e.jsxs("span",{className:"font-semibold text-accent",children:[y(N(f.categories))," ",N(f.categories)]})]})]})]},f.id)})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Investment vs Expense Comparison"}),d.length>0?e.jsx(be,{width:"100%",height:400,children:e.jsxs(Tt,{data:d,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx(Le,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ye,{formatter:f=>`â‚¹${f.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ft,{}),e.jsx(mt,{dataKey:"Investment",fill:"#2D5016",radius:[8,8,0,0]}),e.jsx(mt,{dataKey:"Expense",fill:"#C17817",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[400px] flex items-center justify-center text-dark-brown/50",children:"No data available"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Ye,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Top Investors"})]}),e.jsx("div",{className:"space-y-3",children:b.length>0?b.map((f,_)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-accent/40",children:["#",_+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:c(f.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:f.name}),e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",f.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},f.id)):e.jsx("div",{className:"text-center py-8 text-dark-brown/50",children:e.jsx("p",{className:"text-sm",children:"No investments recorded yet"})})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Active Spenders"})]}),e.jsx("div",{className:"space-y-3",children:u.length>0?u.map((f,_)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-secondary/40",children:["#",_+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-secondary to-accent rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:c(f.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:f.name}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",f.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},f.id)):e.jsx("div",{className:"text-center py-8 text-dark-brown/50",children:e.jsx("p",{className:"text-sm",children:"No expenses recorded yet"})})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Best Approval Rate"})]}),e.jsx("div",{className:"space-y-3",children:t.length>0?t.map((f,_)=>{const v=f.approvedCount/f.submittedCount*100;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-sage/40",children:["#",_+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-sage to-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:c(f.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:f.name}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:[v.toFixed(0),"%"]})]})]},f.id)}):e.jsx("div",{className:"text-center py-8 text-dark-brown/50",children:e.jsx("p",{className:"text-sm",children:"No submissions recorded yet"})})})]})]})]})}function Ar({expenses:s,investments:n}){const[x,p]=i.useState(R(new Date,"yyyy-MM")),[o,r]=i.useState(!0),m=new Date(x+"-01"),d=us(m),b=fs(m),u=xt(m,1),t=us(u),c=fs(u),a=s.filter(S=>{const $=new Date(S.expense_date);return $>=d&&$<=b&&S.status==="approved"}),N=n.filter(S=>{const $=new Date(S.investment_date);return $>=d&&$<=b&&S.status==="approved"}),y=s.filter(S=>{const $=new Date(S.expense_date);return $>=t&&$<=c&&S.status==="approved"}),f=n.filter(S=>{const $=new Date(S.investment_date);return $>=t&&$<=c&&S.status==="approved"}),_=a.reduce((S,$)=>S+$.amount,0),v=N.reduce((S,$)=>S+$.amount,0),w=v-_,j=y.reduce((S,$)=>S+$.amount,0),h=f.reduce((S,$)=>S+$.amount,0),l=h-j,k=j>0?(_-j)/j*100:0,g=h>0?(v-h)/h*100:0,D=l!==0?(w-l)/Math.abs(l)*100:0,P=a.reduce((S,$)=>(S[$.category]||(S[$.category]={thisMonth:0,lastMonth:0}),S[$.category].thisMonth+=$.amount,S),{});y.forEach(S=>{P[S.category]||(P[S.category]={thisMonth:0,lastMonth:0}),P[S.category].lastMonth+=S.amount});const E=Object.entries(P).map(([S,$])=>{const L=$.lastMonth>0?($.thisMonth-$.lastMonth)/$.lastMonth*100:0;return{category:S,thisMonth:$.thisMonth,lastMonth:$.lastMonth,change:L,changeAmount:$.thisMonth-$.lastMonth}}).sort((S,$)=>$.thisMonth-S.thisMonth),q=pa({start:d,end:b}).map(S=>{const $=a.filter(z=>Jt(new Date(z.expense_date),S)),L=N.filter(z=>Jt(new Date(z.investment_date),S)),V=$.reduce((z,ie)=>z+ie.amount,0),T=L.reduce((z,ie)=>z+ie.amount,0);return{date:S,expenses:$,investments:L,expenseTotal:V,investmentTotal:T}}),O=[];for(let S=0;S<12;S++){const $=xt(new Date,S);O.push({value:R($,"yyyy-MM"),label:R($,"MMMM yyyy")})}const Y=()=>{alert("PDF generation feature coming soon!")},ee=()=>{alert("Excel export feature coming soon!")},te=()=>{alert("Email report feature coming soon!")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("select",{value:x,onChange:S=>p(S.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 font-semibold",children:O.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))}),e.jsx("button",{onClick:()=>p(R(new Date,"yyyy-MM")),className:"px-4 py-2 bg-primary/10 text-primary font-semibold rounded-xl hover:bg-primary/20 transition-colors",children:"Current Month"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:S=>r(S.target.checked),className:"w-4 h-4 rounded border-2 border-accent text-accent focus:ring-accent"}),e.jsx("span",{className:"text-sm font-medium text-dark-brown",children:"Compare with last month"})]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-2xl shadow-soft-lg p-8 border-2 border-accent/30",children:[e.jsx("h3",{className:"font-heading text-4xl font-bold text-primary mb-6",children:R(m,"MMMM yyyy")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Investments"}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-2",children:["â‚¹",v.toLocaleString("en-IN")]}),o&&e.jsxs("div",{className:`flex items-center gap-2 ${g>=0?"text-sage":"text-soft-red"}`,children:[g>=0?e.jsx(se,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[g>=0?"+":"",g.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",_.toLocaleString("en-IN")]}),o&&e.jsxs("div",{className:`flex items-center gap-2 ${k<=0?"text-sage":"text-soft-red"}`,children:[k>=0?e.jsx(se,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[k>=0?"+":"",k.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-xl p-6 ${w>=0?"ring-2 ring-accent":"ring-2 ring-soft-red"}`,children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Net Change"}),e.jsxs("p",{className:`text-3xl font-bold mb-2 ${w>=0?"text-accent":"text-soft-red"}`,children:[w>=0?"+":"","â‚¹",w.toLocaleString("en-IN")]}),o&&e.jsxs("div",{className:`flex items-center gap-2 ${D>=0?"text-sage":"text-soft-red"}`,children:[D>=0?e.jsx(se,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[D>=0?"+":"",D.toFixed(1),"% vs last month"]})]})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"This Month"}),o&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Last Month"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Change"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-dark-brown",children:"Trend"})]})]})}),e.jsx("tbody",{children:E.map((S,$)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${$%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:S.category}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-secondary",children:["â‚¹",S.thisMonth.toLocaleString("en-IN")]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right text-dark-brown",children:["â‚¹",S.lastMonth.toLocaleString("en-IN")]}),e.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${S.changeAmount>=0?"text-soft-red":"text-sage"}`,children:[S.changeAmount>=0?"+":"","â‚¹",S.changeAmount.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${S.change>0?"bg-soft-red/20 text-soft-red":S.change<0?"bg-sage/20 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:[S.change>0&&e.jsx(se,{className:"w-3 h-3"}),S.change<0&&e.jsx(we,{className:"w-3 h-3"}),S.change.toFixed(0),"%"]})})]})]},S.category))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-bold text-dark-brown",children:"Total"}),e.jsxs("td",{className:"px-4 py-3 text-right text-xl font-bold text-accent",children:["â‚¹",_.toLocaleString("en-IN")]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-dark-brown",children:["â‚¹",j.toLocaleString("en-IN")]}),e.jsx("td",{colSpan:2})]})]})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Detailed Daily Breakdown"}),e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Investments"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Expenses"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Net"})]})}),e.jsx("tbody",{children:q.map((S,$)=>{const L=S.investmentTotal-S.expenseTotal;return S.expenses.length>0||S.investments.length>0?e.jsxs("tr",{className:`border-b border-dark-brown/5 ${$%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:R(S.date,"EEE, MMM d")}),e.jsx("td",{className:"px-4 py-3 text-right text-sage font-semibold",children:S.investmentTotal>0?`â‚¹${S.investmentTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-secondary font-semibold",children:S.expenseTotal>0?`â‚¹${S.expenseTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:`px-4 py-3 text-right font-bold ${L>0?"text-accent":L<0?"text-soft-red":"text-dark-brown"}`,children:L!==0?`${L>0?"+":""}â‚¹${L.toLocaleString("en-IN")}`:"-"})]},S.date.toString()):null})})]})})]}),e.jsxs("div",{className:"bg-cream/50 rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Export Options"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(ae,{className:"w-5 h-5"}),"Download PDF Report"]}),e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export to Excel"]}),e.jsxs("button",{onClick:te,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-primary text-primary font-semibold rounded-xl hover:bg-primary hover:text-white transition-all duration-300",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Email Report"]})]})]})]})}function Ir({expenses:s,vendors:n}){const p=s.filter(c=>c.status==="approved"&&c.vendor_id).reduce((c,a)=>{const N=a.vendor_id,y=a.vendors;if(!y)return c;c[N]||(c[N]={id:N,name:y.name,category:y.category,totalSpent:0,transactionCount:0,lastTransactionDate:a.expense_date,transactions:[],categories:{}}),c[N].totalSpent+=a.amount,c[N].transactionCount+=1,c[N].transactions.push(a),new Date(a.expense_date)>new Date(c[N].lastTransactionDate)&&(c[N].lastTransactionDate=a.expense_date);const f=a.category;return c[N].categories[f]=(c[N].categories[f]||0)+a.amount,c},{}),o=Object.values(p).sort((c,a)=>a.totalSpent-c.totalSpent),m=o.slice(0,10).map(c=>({name:c.name,amount:c.totalSpent})),d=c=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[c]||"ðŸ’°",b=c=>c&&{supplier:"ðŸ­",service:"ðŸ”§",contractor:"ðŸ‘·",transport:"ðŸšš",retail:"ðŸª"}[c.toLowerCase()]||"ðŸª",u=c=>X(new Date,new Date(c)),t=o.reduce((c,a)=>c+a.totalSpent,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(c=>{const a=c.transactionCount>0?c.totalSpent/c.transactionCount:0,N=u(c.lastTransactionDate),y=t>0?c.totalSpent/t*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary to-sage rounded-lg flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-3xl",children:b(c.category)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:c.name}),e.jsx("p",{className:"text-xs text-dark-brown/60 capitalize",children:c.category||"General Vendor"})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",c.totalSpent.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[y.toFixed(1),"% of all vendor spending"]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:c.transactionCount})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Avg Transaction"}),e.jsxs("span",{className:"font-bold text-accent",children:["â‚¹",a.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"Last Transaction"]}),e.jsxs("span",{className:`font-semibold ${N>60?"text-soft-red":"text-sage"}`,children:[N," days ago"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-2",children:"Primary Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(c.categories).sort((f,_)=>_[1]-f[1]).slice(0,3).map(([f,_])=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-accent/10 rounded-full text-xs font-semibold text-dark-brown",children:[d(f)," ",f]},f))})]})]},c.id)})}),m.length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Top 10 Vendors by Spending"}),e.jsx(be,{width:"100%",height:400,children:e.jsxs(Tt,{data:m,layout:"vertical",children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Le,{dataKey:"name",type:"category",width:150,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(ye,{formatter:c=>`â‚¹${c.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(mt,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Js,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Vendors"})]}),e.jsx("p",{className:"text-5xl font-bold text-accent mb-2",children:o.length}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Active vendors with transactions"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Spent"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-2",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Across all vendors"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Avg Transaction"})]}),e.jsxs("p",{className:"text-4xl font-bold text-sage mb-2",children:["â‚¹",o.length>0?(t/o.reduce((c,a)=>c+a.transactionCount,0)).toLocaleString("en-IN",{maximumFractionDigits:0}):"0"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per vendor transaction"})]})]}),o.filter(c=>u(c.lastTransactionDate)>90).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-2xl shadow-soft p-6 border-2 border-soft-red/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-soft-red/20 rounded-lg flex items-center justify-center",children:e.jsx(he,{className:"w-6 h-6 text-soft-red"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Inactive Vendors"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-4",children:"The following vendors haven't been used in over 90 days. Consider reviewing your vendor relationships."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:o.filter(c=>u(c.lastTransactionDate)>90).map(c=>{const a=u(c.lastTransactionDate);return e.jsxs("div",{className:"bg-white/60 rounded-lg p-4 border border-soft-red/20",children:[e.jsx("p",{className:"font-semibold text-primary mb-1",children:c.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Last used: ",R(new Date(c.lastTransactionDate),"MMM d, yyyy")]}),e.jsxs("p",{className:"text-xs text-soft-red font-semibold mt-1",children:[a," days ago"]})]},c.id)})})]})]})}function Fr(){const[s,n]=i.useState("overview"),[x,p]=i.useState([]),[o,r]=i.useState([]),[m,d]=i.useState([]),[b,u]=i.useState([]),[t,c]=i.useState(!0);i.useEffect(()=>{a()},[]);const a=async()=>{try{const[y,f,_,v]=await Promise.all([C.from("expenses").select(`
            *,
            users:user_id(name, email),
            users_paid_by:users!expenses_paid_by_fkey(name, email),
            users_submitted_by:users!expenses_submitted_by_fkey(name),
            users_approved_by:users!expenses_approved_by_fkey(name),
            vendors(id, name, category)
          `).order("expense_date",{ascending:!1}),C.from("investments").select(`
            *,
            users:partner_id(name, email),
            users_submitted_by:users!investments_submitted_by_fkey(name)
          `).order("investment_date",{ascending:!1}),C.from("vendors").select("*").order("name"),C.from("users").select("id, name, email").order("name")]);if(y.error)throw y.error;if(f.error)throw f.error;if(_.error)throw _.error;if(v.error)throw v.error;p(y.data||[]),r(f.data||[]),d(_.data||[]),u(v.data||[])}catch(y){console.error("Error fetching data:",y)}finally{c(!1)}},N=[{id:"overview",name:"Overview",icon:se},{id:"category",name:"Category Analysis",icon:za},{id:"partner",name:"Partner Analysis",icon:je},{id:"monthly",name:"Monthly Reports",icon:De},{id:"vendor",name:"Vendor Analysis",icon:Js}];return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Financial Reports"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Comprehensive analysis of investments, expenses, and financial trends"})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-8 inline-flex gap-2 flex-wrap",children:N.map(y=>{const f=y.icon;return e.jsxs("button",{onClick:()=>n(y.id),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${s===y.id?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(f,{className:"w-5 h-5"}),y.name]},y.id)})}),t?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading reports..."})}):e.jsxs(e.Fragment,{children:[s==="overview"&&e.jsx(Mr,{expenses:x,investments:o,vendors:m}),s==="category"&&e.jsx(Pr,{expenses:x}),s==="partner"&&e.jsx(Er,{expenses:x,investments:o,allUsers:b}),s==="monthly"&&e.jsx(Ar,{expenses:x,investments:o}),s==="vendor"&&e.jsx(Ir,{expenses:x,vendors:m})]})]})})]})}const Tr=["Initial Capital","Product Development","Raw Material Purchase","Equipment Purchase","Marketing Budget","Working Capital","Infrastructure","Other"];function Lr({isOpen:s,onClose:n,onSuccess:x,preselectedPartnerId:p}){const{user:o}=H(),[r,m]=i.useState(!1),[d,b]=i.useState([]),[u,t]=i.useState(""),[c,a]=i.useState(!1),[N,y]=i.useState({partnerId:p||"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null}),f=o?.role==="admin";i.useEffect(()=>{s&&_()},[s]),i.useEffect(()=>{p&&y(g=>({...g,partnerId:p}))},[p]);const _=async()=>{try{const{data:g,error:D}=await C.from("users").select("id, name, email").order("name");if(D)throw D;b(g||[])}catch(g){console.error("Error fetching partners:",g)}},v=g=>{const D=g.target.files?.[0];if(D){if(D.size>10*1024*1024){alert("File size must be less than 10MB");return}y({...N,paymentProofFile:D})}},w=async g=>{try{const D=g.name.split(".").pop(),E=`payment-proofs/${`${Math.random()}.${D}`}`,{error:I}=await C.storage.from("investment-docs").upload(E,g);if(I)throw I;const{data:q}=C.storage.from("investment-docs").getPublicUrl(E);return q.publicUrl}catch(D){return console.error("Error uploading file:",D),null}},j=async g=>{if(g.preventDefault(),!N.partnerId||!N.amount||!N.purpose){alert("Please fill in all required fields");return}const D=parseFloat(N.amount);if(isNaN(D)||D<=0){alert("Please enter a valid positive amount");return}m(!0);try{let P=null;N.paymentProofFile&&(P=await w(N.paymentProofFile));const E={partner_id:N.partnerId,amount:D,investment_date:N.investmentDate,purpose:N.purpose,notes:N.notes||null,payment_proof_url:P,status:"pending",submitted_by:o?.id},{error:I}=await C.from("investments").insert([E]);if(I)throw I;const q=d.find(O=>O.id===N.partnerId);await C.from("activity_log").insert({user_id:o?.id,activity_type:"investment_added",description:`${o?.name} recorded investment of â‚¹${D.toLocaleString("en-IN")} for ${q?.name}`}),x(),n(),h()}catch(P){console.error("Error adding investment:",P),alert("Failed to add investment. Please try again.")}finally{m(!1)}},h=()=>{y({partnerId:"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null}),t("")},l=d.filter(g=>g.name.toLowerCase().includes(u.toLowerCase())||g.email.toLowerCase().includes(u.toLowerCase())),k=d.find(g=>g.id===N.partnerId);return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-3xl font-bold text-white",children:"Record Investment"}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Add a new partner investment to the records"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-6 h-6 text-white"})})]})}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Partner ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:k?k.name:u,onChange:g=>{t(g.target.value),a(!0),y({...N,partnerId:""})},onFocus:()=>a(!0),placeholder:"Search for a partner...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),c&&!k&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border-2 border-dark-brown/10 rounded-xl shadow-soft-lg max-h-60 overflow-y-auto",children:l.length>0?l.map(g=>e.jsxs("button",{type:"button",onClick:()=>{y({...N,partnerId:g.id}),t(""),a(!1)},className:"w-full px-4 py-3 text-left hover:bg-accent/10 transition-colors border-b border-dark-brown/5 last:border-0",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:g.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:g.email})]},g.id)):e.jsx("p",{className:"px-4 py-3 text-dark-brown/50",children:"No partners found"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"number",value:N.amount,onChange:g=>y({...N,amount:g.target.value}),placeholder:"0",step:"0.01",min:"0",required:!0,className:"w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-dark-brown/40 text-sm",children:"INR"})]}),N.amount&&!isNaN(parseFloat(N.amount))&&e.jsxs("p",{className:"mt-2 text-sm text-dark-brown/60",children:["â‚¹",parseFloat(N.amount).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"date",value:N.investmentDate,onChange:g=>y({...N,investmentDate:g.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purpose / Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsxs("select",{value:N.purpose,onChange:g=>y({...N,purpose:g.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 appearance-none",children:[e.jsx("option",{value:"",children:"Select a purpose"}),Tr.map(g=>e.jsx("option",{value:g,children:g},g))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Proof (Optional)"}),e.jsxs("div",{className:"border-2 border-dashed border-dark-brown/20 rounded-xl p-6 hover:border-accent transition-colors",children:[e.jsx("input",{type:"file",id:"payment-proof",accept:"image/*,.pdf",onChange:v,className:"hidden"}),e.jsxs("label",{htmlFor:"payment-proof",className:"flex flex-col items-center cursor-pointer",children:[e.jsx(Be,{className:"w-12 h-12 text-accent mb-3"}),N.paymentProofFile?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-sage",children:N.paymentProofFile.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(N.paymentProofFile.size/1024/1024).toFixed(2)," MB"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Upload Receipt or Bank Statement"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"PNG, JPG or PDF (max 10MB)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-4 top-4 w-5 h-5 text-accent"}),e.jsx("textarea",{value:N.notes,onChange:g=>y({...N,notes:g.target.value}),placeholder:"Add any additional details...",maxLength:500,rows:3,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 resize-none"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[N.notes.length,"/500 characters"]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-xl border border-blue-200",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-5 h-5 text-blue-600"})}),e.jsx("p",{className:"text-sm text-dark-brown",children:f?"This investment will require your approval before being recorded.":"This investment will be submitted for admin approval."})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-dark-brown/10",children:[e.jsx("button",{type:"button",onClick:n,disabled:r,className:"flex-1 px-6 py-3 border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:r,className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:r?"Recording...":e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-5 h-5"}),"Record Investment"]})})]})]})]})]}):null}function $r({partner:s,investments:n,totalInvestment:x,percentageOfTotal:p,isTopInvestor:o,onViewAll:r,onAddInvestment:m}){const d=t=>t.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2),b=n.sort((t,c)=>new Date(c.investment_date).getTime()-new Date(t.investment_date).getTime()).slice(0,3),u=t=>({"Initial Capital":"ðŸ’°","Product Development":"ðŸ§ª","Raw Material Purchase":"ðŸŒ¿","Equipment Purchase":"ðŸ”§","Marketing Budget":"ðŸ“¢","Working Capital":"ðŸ’¼",Infrastructure:"ðŸ¢",Other:"ðŸ“Š"})[t]||"ðŸ’°";return e.jsxs("div",{className:`relative bg-gradient-to-br from-cream via-white to-sage/10 rounded-2xl shadow-soft hover:shadow-soft-lg transition-all duration-300 overflow-hidden ${o?"border-4 border-accent":"border-2 border-dark-brown/10"}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),o&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsxs("div",{className:"bg-accent text-white px-3 py-1.5 rounded-full flex items-center gap-2 shadow-soft",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold",children:"Top Investor"})]})}),e.jsxs("div",{className:"relative p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-xl",children:d(s.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary truncate",children:s.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 truncate",children:s.email})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-2",children:["â‚¹",x.toLocaleString("en-IN")]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-brown/70",children:[n.length," ",n.length===1?"investment":"investments"]}),e.jsxs("span",{className:"font-semibold text-secondary",children:[p.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-accent/10 to-secondary/10 rounded-xl p-1",children:e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary h-3 rounded-lg transition-all duration-500 shadow-soft",style:{width:`${Math.min(p,100)}%`}})}),b.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 uppercase tracking-wide",children:"Recent Investments"}),b.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 backdrop-blur-sm rounded-lg border border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsx("span",{className:"text-2xl",children:u(t.purpose)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown truncate",children:t.purpose}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:R(new Date(t.investment_date),"MMM d, yyyy")})]}),e.jsxs("p",{className:"text-sm font-bold text-secondary",children:["â‚¹",t.amount.toLocaleString("en-IN")]})]},t.id))]}):e.jsxs("div",{className:"text-center py-6 bg-white/60 backdrop-blur-sm rounded-lg border border-dashed border-dark-brown/20",children:[e.jsx("p",{className:"text-sm text-dark-brown/50",children:"No investments yet"}),e.jsx("p",{className:"text-xs text-dark-brown/40 mt-1",children:"Click + to add first investment"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs("button",{onClick:r,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300",children:[e.jsx(Re,{className:"w-4 h-4"}),"View All"]}),e.jsx("button",{onClick:m,className:"flex items-center justify-center px-4 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:e.jsx(G,{className:"w-5 h-5"})})]})]})]})}function qr({isOpen:s,onClose:n,partner:x,investments:p}){if(!s)return null;const o=p.reduce((d,b)=>d+b.amount,0),r=d=>{switch(d){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},m=()=>{alert("PDF generation feature coming soon!")};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"font-heading text-3xl font-bold text-white",children:[x.name,"'s Investment History"]}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Complete record of all investments"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"p-6 bg-cream/50 border-b border-dark-brown/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-4xl font-bold text-accent",children:["â‚¹",o.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 mt-1",children:["Across ",p.length," ",p.length===1?"investment":"investments"]})]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300 shadow-soft",children:[e.jsx(ke,{className:"w-5 h-5"}),"Download Statement"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:p.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-dark-brown/50",children:"No investments recorded yet"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),e.jsx("th",{className:"px-4 py-4 text-center text-sm font-semibold text-dark-brown",children:"Proof"})]})}),e.jsx("tbody",{children:p.sort((d,b)=>new Date(b.investment_date).getTime()-new Date(d.investment_date).getTime()).map((d,b)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${b%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:R(new Date(d.investment_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:d.purpose}),d.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1 line-clamp-2",children:d.notes})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",d.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:r(d.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm text-dark-brown",children:d.users_submitted_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:d.payment_proof_url?e.jsx("a",{href:d.payment_proof_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex p-2 hover:bg-primary/10 rounded-lg transition-colors",title:"View proof",children:e.jsx(Re,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No proof"})})]},d.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-4 text-right font-bold text-dark-brown",children:"Total:"}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",o.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:3})]})})]})})}),e.jsx("div",{className:"p-4 bg-cream/50 border-t border-dark-brown/10 flex justify-end",children:e.jsx("button",{onClick:n,className:"px-6 py-3 bg-white border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300",children:"Close"})})]})]})}const Cs=["#B8860B","#2D5016","#C17817","#8B4513","#D4AF37","#CD853F","#DAA520"];function Rr({investments:s}){const n=s.filter(l=>l.status==="approved"),x=n.reduce((l,k)=>{const g=k.users?.name||"Unknown";return l[g]||(l[g]=0),l[g]+=k.amount,l},{}),p=Object.entries(x).map(([l,k])=>({name:l,value:Number(k)})),o=n.reduce((l,k)=>(l[k.purpose]||(l[k.purpose]=0),l[k.purpose]+=k.amount,l),{}),r=Object.entries(o).map(([l,k])=>({name:l,value:Number(k)})).sort((l,k)=>k.value-l.value),m=n.reduce((l,k)=>{const g=new Date(k.investment_date),D=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}`;return l[D]||(l[D]=0),l[D]+=k.amount,l},{}),d=Object.keys(m).sort();let b=0;const u=d.map(l=>{b+=m[l];const[k,g]=l.split("-");return{month:new Date(parseInt(k),parseInt(g)-1).toLocaleDateString("en-US",{month:"short",year:"2-digit"}),monthly:m[l],cumulative:b}}),t=n.reduce((l,k)=>l+k.amount,0),c=new Set(n.map(l=>l.partner_id)).size,a=c>0?t/c:0,N=new Date().getMonth(),y=new Date().getFullYear(),f=new Date(y,N-1),_=n.filter(l=>{const k=new Date(l.investment_date);return k.getMonth()===N&&k.getFullYear()===y}),v=n.filter(l=>{const k=new Date(l.investment_date);return k.getMonth()===f.getMonth()&&k.getFullYear()===f.getFullYear()}),w=_.reduce((l,k)=>l+k.amount,0),j=v.reduce((l,k)=>l+k.amount,0),h=j>0?(w-j)/j*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-xs font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-1",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Investment"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-3xl font-bold text-sage mb-1",children:c}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Partners Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(Za,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",a.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-6 border-2 border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Growth"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${h>=0?"text-sage":"text-soft-red"}`,children:[h>=0?"+":"",h.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"This Month"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Contributions"}),p.length>0?e.jsx(be,{width:"100%",height:300,children:e.jsxs(At,{children:[e.jsx(It,{data:p,cx:"50%",cy:"50%",labelLine:!1,label:({name:l,percent:k})=>`${l} (${(k*100).toFixed(0)}%)`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:p.map((l,k)=>e.jsx(Ft,{fill:Cs[k%Cs.length]},`cell-${k}`))}),e.jsx(ye,{formatter:l=>`â‚¹${l.toLocaleString("en-IN")}`})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment by Purpose"}),r.length>0?e.jsx(be,{width:"100%",height:300,children:e.jsxs(Tt,{data:r,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx(Le,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ye,{formatter:l=>`â‚¹${l.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(mt,{dataKey:"value",fill:"#B8860B",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment Timeline"}),u.length>0?e.jsx(be,{width:"100%",height:350,children:e.jsxs(Et,{data:u,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Te,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Le,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ye,{formatter:l=>`â‚¹${l.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(ft,{}),e.jsx($e,{type:"monotone",dataKey:"monthly",stroke:"#C17817",strokeWidth:2,name:"Monthly Investment",dot:{fill:"#C17817",r:4}}),e.jsx($e,{type:"monotone",dataKey:"cumulative",stroke:"#2D5016",strokeWidth:3,name:"Cumulative Investment",dot:{fill:"#2D5016",r:5}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),t>=1e5&&e.jsxs("div",{className:"bg-gradient-to-r from-accent to-secondary rounded-2xl shadow-soft-lg p-8 text-center",children:[e.jsx("p",{className:"text-5xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"font-heading text-3xl font-bold text-white mb-2",children:"Milestone Achieved!"}),e.jsxs("p",{className:"text-white/90 text-lg",children:["Total investments have crossed â‚¹",(Math.floor(t/1e5)*1e5/1e3).toFixed(0),"K! Amazing progress toward building Organitto together."]})]})]})}function Ur(){const{user:s}=H(),[n,x]=i.useState([]),[p,o]=i.useState([]),[r,m]=i.useState(!0),[d,b]=i.useState("by_partner"),[u,t]=i.useState(!1),[c,a]=i.useState(),[N,y]=i.useState(!1),[f,_]=i.useState(null),[v,w]=i.useState(!1),[j,h]=i.useState("approve"),[l,k]=i.useState(null),[g,D]=i.useState(null),P=s?.role==="admin";i.useEffect(()=>{I(),E();const T=C.channel("investments-changes").on("postgres_changes",{event:"*",schema:"public",table:"investments"},()=>{I()}).subscribe();return()=>{C.removeChannel(T)}},[]);const E=async()=>{try{const{data:T,error:z}=await C.from("users").select("id, name, email").order("name");if(z)throw z;o(T||[])}catch(T){console.error("Error fetching users:",T)}},I=async()=>{try{const{data:T,error:z}=await C.from("investments").select(`
          *,
          users:partner_id(name, email),
          users_submitted_by:users!investments_submitted_by_fkey(name),
          users_approved_by:users!investments_approved_by_fkey(name)
        `).order("investment_date",{ascending:!1});if(z)throw z;x(T||[])}catch(T){console.error("Error fetching investments:",T)}finally{m(!1)}},q=T=>{k(T),h("approve"),w(!0)},O=T=>{k(T),h("reject"),w(!0)},Y=async(T,z)=>{if(!(!l||!s)){D(l.id);try{const ie={status:j==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};j==="reject"&&z&&(ie.rejection_reason=z);const{error:me}=await C.from("investments").update(ie).eq("id",l.id);if(me)throw me;await C.from("activity_log").insert({user_id:s.id,activity_type:j==="approve"?"investment_approved":"investment_rejected",description:`${s.name} ${j==="approve"?"approved":"rejected"} investment: â‚¹${l.amount.toLocaleString("en-IN")} from ${l.users?.name}`}),await I(),w(!1),k(null)}catch(ie){console.error("Error processing approval:",ie),alert("Failed to process approval. Please try again.")}finally{D(null)}}},ee=async T=>{if(confirm("Are you sure you want to delete this investment? This action cannot be undone."))try{const{error:z}=await C.from("investments").delete().eq("id",T);if(z)throw z;await I()}catch(z){console.error("Error deleting investment:",z),alert("Failed to delete investment. Please try again.")}},te=p.map(T=>{const z=n.filter(me=>me.partner_id===T.id),ie=z.reduce((me,_e)=>me+_e.amount,0);return{partner:{id:T.id,name:T.name,email:T.email},investments:z,total:ie}});te.sort((T,z)=>z.total-T.total);const S=n.filter(T=>T.status==="approved").reduce((T,z)=>T+z.amount,0);te.filter(T=>T.investments.some(z=>z.status==="approved")).length;const $=p.length>0?S/p.length:0,L=te.length>0?te[0].partner.id:null,V=T=>{switch(T){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Investment Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track partner investments and grow together"})]}),e.jsxs("button",{onClick:()=>{a(void 0),t(!0)},className:"flex items-center gap-2 px-6 py-4 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Investment"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-4xl font-bold text-accent mb-1",children:["â‚¹",S.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Amount Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage mb-1",children:p.length}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Partners"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(ht,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-sm font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-1",children:["â‚¹",$.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-6 inline-flex gap-2",children:[e.jsxs("button",{onClick:()=>b("by_partner"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${d==="by_partner"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(je,{className:"w-5 h-5"}),"By Partner"]}),e.jsxs("button",{onClick:()=>b("all_investments"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${d==="all_investments"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"All Investments"]}),e.jsxs("button",{onClick:()=>b("statistics"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${d==="statistics"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(ht,{className:"w-5 h-5"}),"Statistics"]})]}),r?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading investments..."})}):d==="by_partner"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.length===0?e.jsx("div",{className:"col-span-full text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No partners found"})}):te.map(T=>e.jsx($r,{partner:T.partner,investments:T.investments,totalInvestment:T.total,percentageOfTotal:S>0?T.total/S*100:0,isTopInvestor:T.partner.id===L&&T.total>0,onViewAll:()=>{_(T),y(!0)},onAddInvestment:()=>{a(T.partner.id),t(!0)}},T.partner.id))}):d==="all_investments"?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Partner"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),P&&e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((T,z)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${z%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:R(new Date(T.investment_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:T.users?.name}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:T.users?.email})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",T.amount.toLocaleString("en-IN")]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:T.purpose}),T.notes&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1 line-clamp-1",children:T.notes})]}),e.jsx("td",{className:"px-4 py-4",children:V(T.status)}),e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:T.users_submitted_by?.name||"Unknown"}),P&&e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[T.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>q(T),disabled:g===T.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(Q,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:()=>O(T),disabled:g===T.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Me,{className:"w-4 h-4 text-soft-red"})})]}),e.jsx("button",{onClick:()=>ee(T.id),className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(le,{className:"w-4 h-4 text-soft-red"})})]})})]},T.id))})]})})}):e.jsx(Rr,{investments:n})]})}),u&&e.jsx(Lr,{isOpen:u,onClose:()=>{t(!1),a(void 0)},onSuccess:I,preselectedPartnerId:c}),N&&f&&e.jsx(qr,{isOpen:N,onClose:()=>{y(!1),_(null)},partner:f.partner,investments:f.investments}),v&&l&&e.jsx(sa,{isOpen:v,onClose:()=>{w(!1),k(null)},onConfirm:Y,type:j,expense:{category:l.purpose,subcategory:l.notes,amount:l.amount,expense_date:l.investment_date,payment_mode:"Investment"},loading:g===l.id})]})}function zr({product:s,users:n,onDragStart:x,onEdit:p,onMoveNext:o}){const r=ce(),m=X(new Date,new Date(s.stage_entered_at)),d=()=>{const a={high:{color:"bg-soft-red",dot:"ðŸ”´"},medium:{color:"bg-accent",dot:"ðŸŸ¡"},low:{color:"bg-sage",dot:"ðŸŸ¢"}};return a[s.priority]||a.medium},b=a=>({Skincare:"âœ¨","Hair Care":"ðŸ’†","Wellness & Supplements":"ðŸŒ¿","Oral Care":"ðŸ¦·","Personal Care":"ðŸ§´","Home Care":"ðŸ ",Other:"ðŸ“¦"})[a]||"ðŸ“¦",u=n.filter(a=>s.assigned_partners.includes(a.id)),t=a=>a.split(" ").map(N=>N[0]).join("").toUpperCase().slice(0,2),c=d();return e.jsxs("div",{draggable:!0,onDragStart:()=>x(s),className:"bg-white rounded-xl shadow-soft p-4 mb-3 cursor-move hover:shadow-soft-lg transition-all duration-300 border-2 border-transparent hover:border-accent/30 relative group",children:[e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${c.color} text-white`,children:[c.dot," ",s.priority.toUpperCase()]})}),s.image_url?e.jsx("div",{className:"w-full h-32 bg-cream/50 rounded-lg mb-3 overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-32 bg-gradient-to-br from-sage/20 to-accent/20 rounded-lg mb-3 flex items-center justify-center",children:e.jsx("span",{className:"text-5xl",children:b(s.category)})}),e.jsx("h4",{className:"font-heading text-lg font-bold text-primary mb-2 pr-16",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:s.category}),s.product_type&&e.jsx("span",{className:"text-xs px-2 py-1 bg-secondary/10 text-secondary rounded-full",children:s.product_type})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-dark-brown/60 font-semibold",children:"Stage Progress"}),e.jsxs("span",{className:"text-xs font-bold text-accent",children:[s.progress,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60 mb-3",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsxs("span",{className:m>30?"text-soft-red font-semibold":"",children:[m," days in stage",m>30&&" âš ï¸"]})]}),u.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-3",children:[u.slice(0,3).map((a,N)=>e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent to-secondary flex items-center justify-center text-white text-xs font-bold border-2 border-white shadow-sm",style:{marginLeft:N>0?"-8px":"0",zIndex:3-N},title:a.name,children:t(a.name)},a.id)),u.length>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-dark-brown/20 flex items-center justify-center text-xs font-bold text-dark-brown ml-1",children:["+",u.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-dark-brown/60 mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3"}),"0/0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qt,{className:"w-3 h-3"}),"0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(os,{className:"w-3 h-3"}),"0"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>r(`/products/${s.id}`),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(Re,{className:"w-4 h-4"}),"View"]}),e.jsxs("button",{onClick:()=>p(s),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),e.jsx("button",{onClick:()=>o(s),className:"flex items-center justify-center gap-1 px-3 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg transition-colors text-xs font-semibold",children:e.jsx(ss,{className:"w-4 h-4"})})]})]})}const Br=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],Or=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Vr=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function Hr({isOpen:s,onClose:n,onSubmit:x,users:p}){const[o,r]=i.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),[m,d]=i.useState(!1);if(!s)return null;const b=async t=>{t.preventDefault(),d(!0);try{await x(o),r({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),n()}catch(c){console.error("Error creating product:",c)}finally{d(!1)}},u=t=>{r(c=>({...c,assigned_partners:c.assigned_partners.includes(t)?c.assigned_partners.filter(a=>a!==t):[...c.assigned_partners,t]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Add New Product"}),e.jsx("button",{onClick:n,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(oe,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:o.name,onChange:t=>r({...o,name:t.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:o.category,onChange:t=>r({...o,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),Br.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:o.product_type,onChange:t=>r({...o,product_type:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Or.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Initial Stage"}),e.jsx("select",{value:o.current_stage,onChange:t=>r({...o,current_stage:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Vr.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:o.target_launch_date,onChange:t=>r({...o,target_launch_date:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",bgColor:"bg-red-500",hoverColor:"hover:bg-red-600",borderColor:"border-red-500"},{value:"medium",label:"Medium",bgColor:"bg-orange-500",hoverColor:"hover:bg-orange-600",borderColor:"border-orange-500"},{value:"low",label:"Low",bgColor:"bg-green-500",hoverColor:"hover:bg-green-600",borderColor:"border-green-500"}].map(t=>e.jsxs("label",{className:`flex-1 cursor-pointer px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 border-2 ${o.priority===t.value?`${t.bgColor} ${t.borderColor} text-white shadow-md`:`bg-white ${t.borderColor} border-opacity-30 text-dark-brown hover:border-opacity-100 hover:shadow-sm`}`,children:[e.jsx("input",{type:"radio",name:"priority",value:t.value,checked:o.priority===t.value,onChange:c=>r({...o,priority:c.target.value}),className:"sr-only"}),t.label]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:t=>r({...o,description:t.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:p.map(t=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${o.assigned_partners.includes(t.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:o.assigned_partners.includes(t.id),onChange:()=>u(t.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:t.name})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:o.image_url,onChange:t=>r({...o,image_url:t.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Be,{className:"w-5 h-5"}),"Upload"]})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Or enter a direct image URL"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition-colors border-2 border-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m,className:"flex-1 px-6 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold rounded-xl hover:from-emerald-700 hover:to-teal-700 shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-lg",children:m?"Creating...":"Create Product"})]})]})]})})}const Wr=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],Gr=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Qr=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function aa({isOpen:s,onClose:n,onSubmit:x,product:p,users:o}){const[r,m]=i.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:"",progress:0}),[d,b]=i.useState(!1);if(i.useEffect(()=>{p&&m({name:p.name||"",category:p.category||"",product_type:p.product_type||"",current_stage:p.current_stage||"idea",priority:p.priority||"medium",target_launch_date:p.target_launch_date||"",description:p.description||"",assigned_partners:p.assigned_partners||[],image_url:p.image_url||"",progress:p.progress||0})},[p]),!s)return null;const u=async c=>{c.preventDefault(),b(!0);try{await x(p.id,r),n()}catch(a){console.error("Error updating product:",a)}finally{b(!1)}},t=c=>{m(a=>({...a,assigned_partners:a.assigned_partners.includes(c)?a.assigned_partners.filter(N=>N!==c):[...a.assigned_partners,c]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Edit Product"}),e.jsx("button",{onClick:n,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(oe,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:c=>m({...r,name:c.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:r.category,onChange:c=>m({...r,category:c.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),Wr.map(c=>e.jsx("option",{value:c,children:c},c))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:r.product_type,onChange:c=>m({...r,product_type:c.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Gr.map(c=>e.jsx("option",{value:c,children:c},c))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Stage"}),e.jsx("select",{value:r.current_stage,onChange:c=>m({...r,current_stage:c.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Qr.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:r.target_launch_date,onChange:c=>m({...r,target_launch_date:c.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Progress"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:r.progress,onChange:c=>m({...r,progress:parseInt(c.target.value)}),className:"flex-1"}),e.jsxs("span",{className:"text-2xl font-bold text-accent min-w-[60px]",children:[r.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${r.progress}%`}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",color:"bg-soft-red"},{value:"medium",label:"Medium",color:"bg-accent"},{value:"low",label:"Low",color:"bg-sage"}].map(c=>e.jsxs("label",{className:`flex-1 cursor-pointer ${r.priority===c.value?`${c.color} text-white`:"bg-dark-brown/5 text-dark-brown"} px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 hover:scale-105`,children:[e.jsx("input",{type:"radio",name:"priority",value:c.value,checked:r.priority===c.value,onChange:a=>m({...r,priority:a.target.value}),className:"sr-only"}),c.label]},c.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:c=>m({...r,description:c.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:o.map(c=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${r.assigned_partners.includes(c.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:r.assigned_partners.includes(c.id),onChange:()=>t(c.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:c.name})]},c.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:r.image_url,onChange:c=>m({...r,image_url:c.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Be,{className:"w-5 h-5"}),"Upload"]})]}),r.image_url&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:r.image_url,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg border-2 border-dark-brown/10"})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Updating...":"Update Product"})]})]})]})})}const dt=[{id:"idea",name:"Idea",icon:"ðŸŒ±",gradient:"from-sage/30 to-sage/10"},{id:"research",name:"Research",icon:"ðŸ”",gradient:"from-sage/25 to-sage/10"},{id:"formula",name:"Formula Creation",icon:"âš—ï¸",gradient:"from-sage/20 to-accent/10"},{id:"testing",name:"Testing",icon:"ðŸ§ª",gradient:"from-accent/30 to-accent/10"},{id:"packaging",name:"Packaging Design",icon:"ðŸ“¦",gradient:"from-accent/25 to-accent/10"},{id:"printing",name:"Printing",icon:"ðŸ–¨ï¸",gradient:"from-accent/20 to-secondary/10"},{id:"production",name:"Production",icon:"ðŸ­",gradient:"from-secondary/30 to-secondary/10"},{id:"ready",name:"Ready to Launch",icon:"ðŸš€",gradient:"from-secondary/25 to-secondary/10"},{id:"launched",name:"Launched",icon:"âœ…",gradient:"from-primary/40 to-primary/20"}];function Yr(){const{user:s}=H(),n=ce(),[x,p]=i.useState("board"),[o,r]=i.useState(!1),[m,d]=i.useState(!1),[b,u]=i.useState(null),[t,c]=i.useState([]),[a,N]=i.useState([]),[y,f]=i.useState(!0),[_,v]=i.useState(null),[w,j]=i.useState("all"),[h,l]=i.useState("");i.useEffect(()=>{k()},[]);const k=async()=>{try{const[L,V]=await Promise.all([C.from("products").select("*").order("created_at",{ascending:!1}),C.from("users").select("id, name, email").order("name")]);if(L.error)throw L.error;if(V.error)throw V.error;c(L.data||[]),N(V.data||[])}catch(L){console.error("Error fetching data:",L)}finally{f(!1)}},g=async L=>{try{const{data:V,error:T}=await C.from("products").insert([{...L,created_by:s?.id,stage_entered_at:new Date().toISOString()}]).select().single();if(T)throw T;await C.from("product_stage_history").insert([{product_id:V.id,stage:L.current_stage,moved_by:s?.id,notes:"Product created"}]),await k()}catch(V){throw console.error("Error creating product:",V),V}},D=L=>{v(L)},P=L=>{L.preventDefault()},E=async(L,V)=>{if(L.preventDefault(),!_||_.current_stage===V){v(null);return}if(V==="launched"&&!window.confirm(`Are you sure you want to launch "${_.name}"? This marks it as complete.`)){v(null);return}try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",_.id).is("exited_at",null),await C.from("products").update({current_stage:V,stage_entered_at:new Date().toISOString(),progress:V==="launched"?100:_.progress}).eq("id",_.id),await C.from("product_stage_history").insert([{product_id:_.id,stage:V,moved_by:s?.id}]),await k()}catch(T){console.error("Error moving product:",T)}finally{v(null)}},I=async L=>{const V=dt.findIndex(z=>z.id===L.current_stage);if(V===-1||V===dt.length-1)return;const T=dt[V+1].id;await E({preventDefault:()=>{}},T)},q=L=>{u(L),d(!0)},O=async(L,V)=>{try{const{error:T}=await C.from("products").update({...V,updated_at:new Date().toISOString()}).eq("id",L);if(T)throw T;await C.from("activity_log").insert({user_id:s?.id,activity_type:"product_updated",description:`${s?.name} updated product: ${V.name}`}),await k()}catch(T){throw console.error("Error updating product:",T),T}},Y=t.filter(L=>!(w!=="all"&&L.priority!==w||h&&!L.name.toLowerCase().includes(h.toLowerCase()))),ee=t.length,te=t.filter(L=>L.current_stage!=="launched").length,S=t.filter(L=>L.current_stage==="launched").length,$=t.filter(L=>L.priority==="high").length;return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("button",{onClick:()=>r(!0),className:"fixed bottom-8 right-8 w-16 h-16 bg-gradient-to-r from-secondary to-accent text-white rounded-full shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-110 flex items-center justify-center z-40 group",children:e.jsx(G,{className:"w-8 h-8 group-hover:rotate-90 transition-transform duration-300"})}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Product Development Pipeline"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track your Ayurvedic products from concept to launch"})]}),e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-3 px-6 py-4 bg-accent text-white rounded-xl font-bold text-lg shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-105 hover:bg-accent/90",children:[e.jsx(G,{className:"w-6 h-6"}),"Add New Product"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ne,{className:"w-6 h-6 text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Products"})]}),e.jsx("p",{className:"text-4xl font-bold text-primary",children:ee})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(he,{className:"w-6 h-6 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"In Development"})]}),e.jsx("p",{className:"text-4xl font-bold text-accent",children:te})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ha,{className:"w-6 h-6 text-sage"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Launched"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage",children:S})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/20 to-soft-red/10 rounded-xl p-6 border-2 border-soft-red/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Q,{className:"w-6 h-6 text-soft-red"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"High Priority"})]}),e.jsx("p",{className:"text-4xl font-bold text-soft-red",children:$})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-4 mb-8 flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>p("board"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${x==="board"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(Ra,{className:"w-5 h-5"}),"Board View"]}),e.jsxs("button",{onClick:()=>p("list"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${x==="list"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"List View"]})]}),e.jsxs("div",{className:"flex gap-3 flex-1 max-w-md",children:[e.jsx("input",{type:"text",placeholder:"Search products...",value:h,onChange:L=>l(L.target.value),className:"flex-1 px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("select",{value:w,onChange:L=>j(L.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"low",children:"Low Priority"})]})]})]}),y?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading products..."})}):x==="board"?e.jsx("div",{className:"overflow-x-auto pb-4",children:e.jsx("div",{className:"flex gap-4 min-w-max",children:dt.map(L=>{const V=Y.filter(T=>T.current_stage===L.id);return e.jsxs("div",{onDragOver:P,onDrop:T=>E(T,L.id),className:`w-80 flex-shrink-0 bg-gradient-to-b ${L.gradient} rounded-2xl p-4 border-2 border-dark-brown/10 shadow-soft`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-heading text-lg font-bold text-primary flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:L.icon}),L.name]}),e.jsx("span",{className:"bg-white px-3 py-1 rounded-full text-sm font-bold text-primary shadow-sm",children:V.length})]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-400px)] overflow-y-auto pr-2",children:V.length===0?e.jsx("div",{className:"text-center py-8 text-dark-brown/40 text-sm",children:"No products in this stage"}):V.map(T=>e.jsx(zr,{product:T,users:a,onDragStart:D,onEdit:q,onMoveNext:I},T.id))})]},L.id)})})}):e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Priority"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Progress"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Days in Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Target Launch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:Y.map((L,V)=>{const T=dt.find(ie=>ie.id===L.current_stage),z=Math.floor((new Date().getTime()-new Date(L.stage_entered_at).getTime())/(1e3*60*60*24));return e.jsxs("tr",{className:`border-b border-dark-brown/5 ${V%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center text-2xl",children:T?.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-primary",children:L.name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:L.product_type})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:L.category})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-sm px-3 py-1 bg-gradient-to-r ${T?.gradient} rounded-full font-semibold text-dark-brown`,children:T?.name})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold text-white ${L.priority==="high"?"bg-soft-red":L.priority==="medium"?"bg-accent":"bg-sage"}`,children:L.priority.toUpperCase()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent",style:{width:`${L.progress}%`}})}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[L.progress,"%"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-sm ${z>30?"text-soft-red font-semibold":"text-dark-brown/70"}`,children:[z," days"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:L.target_launch_date||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(`/products/${L.id}`),className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",title:"View Details",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(L),className:"p-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors",title:"Edit Product",children:e.jsx(ge,{className:"w-4 h-4"})})]})})]},L.id)})})]})})}),Y.length===0&&!y&&e.jsxs("div",{className:"text-center py-16 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ±"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"No products yet!"}),e.jsx("p",{className:"text-dark-brown/60 mb-6",children:"Create your first Ayurvedic product to get started"}),e.jsx("button",{onClick:()=>r(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300",children:"Create Product"})]})]})}),e.jsx(Hr,{isOpen:o,onClose:()=>r(!1),onSubmit:g,users:a}),b&&e.jsx(aa,{isOpen:m,onClose:()=>{d(!1),u(null)},onSubmit:O,product:b,users:a})]})}function Kr({product:s,onRefresh:n}){H();const[x,p]=i.useState([]),[o,r]=i.useState([]),[m,d]=i.useState(null),[b,u]=i.useState(!1),[t,c]=i.useState(s.description||"");i.useEffect(()=>{a()},[s.id]);const a=async()=>{try{const[j,h]=await Promise.all([C.from("product_stage_history").select("*, moved_by").eq("product_id",s.id).order("entered_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(j.error)throw j.error;if(h.error)throw h.error;if(p(j.data||[]),r(h.data||[]),s.created_by){const l=h.data?.find(k=>k.id===s.created_by);d(l)}}catch(j){console.error("Error fetching data:",j)}},N=async()=>{try{const{error:j}=await C.from("products").update({description:t}).eq("id",s.id);if(j)throw j;u(!1),n()}catch(j){console.error("Error updating description:",j)}},y=o.filter(j=>s.assigned_partners?.includes(j.id)),f=X(new Date,new Date(s.created_at)),_=j=>j.split(" ").map(h=>h[0]).join("").toUpperCase().slice(0,2),v=j=>o.find(l=>l.id===j)?.name||"Unknown",w={idea:"ðŸŒ± Idea",research:"ðŸ” Research",formula:"âš—ï¸ Formula Creation",testing:"ðŸ§ª Testing",packaging:"ðŸ“¦ Packaging Design",printing:"ðŸ–¨ï¸ Printing",production:"ðŸ­ Production",ready:"ðŸš€ Ready to Launch",launched:"âœ… Launched"};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Product Information"}),!b&&e.jsx("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"Edit Description"})]}),s.image_url&&e.jsx("div",{className:"mb-4 rounded-xl overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-64 object-cover"})}),b?e.jsxs("div",{children:[e.jsx("textarea",{value:t,onChange:j=>c(j.target.value),placeholder:"Enter product description...",rows:6,className:"w-full px-4 py-3 border-2 border-accent/30 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none mb-3"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-lg font-semibold hover:shadow-soft transition-all",children:"Save"}),e.jsx("button",{onClick:()=>{c(s.description||""),u(!1)},className:"px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:"Cancel"})]})]}):e.jsx("p",{className:"text-dark-brown/70 leading-relaxed",children:s.description||"No description provided yet."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Category"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Product Type"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.product_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created Date"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:R(new Date(s.created_at),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created By"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:m?.name||"Unknown"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Stage History"}),e.jsx("div",{className:"space-y-3",children:x.map((j,h)=>{const l=j.exited_at?X(new Date(j.exited_at),new Date(j.entered_at)):X(new Date,new Date(j.entered_at));return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white rounded-lg border-2 border-dark-brown/5",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-2xl ${h===0?"bg-accent/20":"bg-dark-brown/5"}`,children:w[j.stage]?.split(" ")[0]||"ðŸ“¦"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:w[j.stage]||j.stage}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Entered ",R(new Date(j.entered_at),"MMM dd, yyyy")," by ",v(j.moved_by)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-accent",children:[l," days"]}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:j.exited_at?"Completed":"Current"})]})]},j.id)})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-white rounded-xl p-6 border-2 border-accent/20",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Total Development"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[f," days"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Progress"}),e.jsxs("p",{className:"text-xl font-bold text-sage",children:[s.progress,"%"]})]})]}),s.target_launch_date&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center",children:e.jsx(De,{className:"w-6 h-6 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Target Launch"}),e.jsx("p",{className:"text-xl font-bold text-secondary",children:R(new Date(s.target_launch_date),"MMM dd, yyyy")})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Assigned Team"}),y.length>0?e.jsx("div",{className:"space-y-3",children:y.map(j=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:_(j.name)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:j.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 capitalize",children:j.role})]})]},j.id))}):e.jsx("p",{className:"text-dark-brown/50 text-sm",children:"No team members assigned yet."}),e.jsx("button",{className:"w-full mt-4 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"+ Add Team Member"})]})]})]})})}const Zr=["Herb","Oil","Powder","Extract","Base","Preservative","Fragrance","Active","Other"],Jr=["g","ml","kg","L","%","drops"],Xr=["Cooling","Heating","Vata-balancing","Pitta-balancing","Kapha-balancing","Anti-inflammatory","Antimicrobial","Moisturizing","Detoxifying","Rejuvenating"];function en({productId:s}){H();const[n,x]=i.useState([]),[p,o]=i.useState([]),[r,m]=i.useState(null),[d,b]=i.useState(!1),[u,t]=i.useState(null),[c,a]=i.useState({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""});i.useEffect(()=>{N()},[s]);const N=async()=>{try{const[h,l]=await Promise.all([C.from("product_ingredients").select("*").eq("product_id",s).order("created_at",{ascending:!0}),C.from("formula_versions").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(h.error)throw h.error;if(l.error)throw l.error;x(h.data||[]),o(l.data||[]);const k=l.data?.find(g=>g.is_current);m(k)}catch(h){console.error("Error fetching data:",h)}},y=async h=>{h.preventDefault();try{if(u){const{error:l}=await C.from("product_ingredients").update({...c,quantity:parseFloat(c.quantity)||0,cost_per_unit:parseFloat(c.cost_per_unit)||0}).eq("id",u);if(l)throw l}else{const{error:l}=await C.from("product_ingredients").insert([{product_id:s,...c,quantity:parseFloat(c.quantity)||0,cost_per_unit:parseFloat(c.cost_per_unit)||0}]);if(l)throw l}v(),N()}catch(l){console.error("Error saving ingredient:",l)}},f=h=>{a({ingredient_name:h.ingredient_name,botanical_name:h.botanical_name||"",type:h.type||"",quantity:h.quantity?.toString()||"",unit:h.unit||"g",vendor:h.vendor||"",cost_per_unit:h.cost_per_unit?.toString()||"",ayurvedic_properties:h.ayurvedic_properties||[],notes:h.notes||""}),t(h.id),b(!0)},_=async h=>{if(confirm("Are you sure you want to delete this ingredient?"))try{const{error:l}=await C.from("product_ingredients").delete().eq("id",h);if(l)throw l;N()}catch(l){console.error("Error deleting ingredient:",l)}},v=()=>{a({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""}),t(null),b(!1)},w=h=>{a(l=>({...l,ayurvedic_properties:l.ayurvedic_properties.includes(h)?l.ayurvedic_properties.filter(k=>k!==h):[...l.ayurvedic_properties,h]}))},j=n.reduce((h,l)=>h+(l.quantity||0)*(l.cost_per_unit||0),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Ingredients List"}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Ingredient"]})]}),e.jsx("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Cost/Unit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Properties"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((h,l)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${l%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:h.ingredient_name}),h.botanical_name&&e.jsx("p",{className:"text-sm text-dark-brown/60 italic",children:h.botanical_name})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:h.type||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[h.quantity||0," ",h.unit]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:h.vendor||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-dark-brown",children:["â‚¹",h.cost_per_unit?.toFixed(2)||"0.00"]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-bold text-accent",children:["â‚¹",((h.quantity||0)*(h.cost_per_unit||0)).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(h.ayurvedic_properties||[]).slice(0,2).map(k=>e.jsx("span",{className:"px-2 py-0.5 bg-sage/10 text-sage rounded text-xs font-semibold",children:k},k)),(h.ayurvedic_properties||[]).length>2&&e.jsxs("span",{className:"text-xs text-dark-brown/60",children:["+",(h.ayurvedic_properties||[]).length-2]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(h),className:"p-2 text-accent hover:bg-accent/10 rounded-lg transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(h.id),className:"p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]})})]},h.id))}),e.jsx("tfoot",{className:"bg-accent/5 border-t-2 border-accent/20",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Total Raw Material Cost:"}),e.jsxs("td",{className:"px-4 py-3 font-bold text-xl text-accent",children:["â‚¹",j.toFixed(2)]}),e.jsx("td",{colSpan:2})]})})]})})}),n.length===0&&e.jsxs("div",{className:"text-center py-12 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ¿"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No ingredients added yet"}),e.jsx("button",{onClick:()=>b(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Add Your First Ingredient"})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:u?"Edit Ingredient":"Add New Ingredient"}),e.jsx("button",{onClick:v,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(oe,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Ingredient Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:c.ingredient_name,onChange:h=>a({...c,ingredient_name:h.target.value}),placeholder:"e.g., Neem Extract",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical Name"}),e.jsx("input",{type:"text",value:c.botanical_name,onChange:h=>a({...c,botanical_name:h.target.value}),placeholder:"e.g., Azadirachta indica",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Type"}),e.jsxs("select",{value:c.type,onChange:h=>a({...c,type:h.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Zr.map(h=>e.jsx("option",{value:h,children:h},h))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",value:c.quantity,onChange:h=>a({...c,quantity:h.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("select",{value:c.unit,onChange:h=>a({...c,unit:h.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Jr.map(h=>e.jsx("option",{value:h,children:h},h))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor/Source"}),e.jsx("input",{type:"text",value:c.vendor,onChange:h=>a({...c,vendor:h.target.value}),placeholder:"Supplier name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:c.cost_per_unit,onChange:h=>a({...c,cost_per_unit:h.target.value}),placeholder:"0.00",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Ayurvedic Properties"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Xr.map(h=>e.jsxs("label",{className:`cursor-pointer px-3 py-2 rounded-lg border-2 transition-all ${c.ayurvedic_properties.includes(h)?"border-sage bg-sage/10 text-sage font-semibold":"border-dark-brown/10 hover:border-sage/50 text-dark-brown"}`,children:[e.jsx("input",{type:"checkbox",checked:c.ayurvedic_properties.includes(h),onChange:()=>w(h),className:"sr-only"}),e.jsx("span",{className:"text-sm",children:h})]},h))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:c.notes,onChange:h=>a({...c,notes:h.target.value}),placeholder:"Additional notes about this ingredient...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:v,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:u?"Update Ingredient":"Add Ingredient"})]})]})]})})]})}const Ss={stability:["pH Test","Viscosity Test","Color Consistency","Fragrance Stability","Separation Test"],safety:["Patch Test Results","Microbial Testing","Heavy Metals Testing","Allergen Testing"],performance:["Efficacy Test","Shelf Life Study","Consumer Testing"]};function tn({productId:s}){const{user:n}=H(),[x,p]=i.useState([]),[o,r]=i.useState([]),[m,d]=i.useState(!1),[b,u]=i.useState(!1),[t,c]=i.useState({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),[a,N]=i.useState({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5});i.useEffect(()=>{y()},[s]);const y=async()=>{try{const[w,j]=await Promise.all([C.from("product_tests").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("sample_batches").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(w.error)throw w.error;if(j.error)throw j.error;p(w.data||[]),r(j.data||[])}catch(w){console.error("Error fetching data:",w)}},f=async w=>{w.preventDefault();try{const{error:j}=await C.from("product_tests").insert([{product_id:s,...t,tested_by:n?.id}]);if(j)throw j;c({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),d(!1),y()}catch(j){console.error("Error adding test:",j)}},_=async w=>{w.preventDefault();try{const{error:j}=await C.from("sample_batches").insert([{product_id:s,...a,quantity:parseFloat(a.quantity)||0,rating:parseInt(a.rating.toString())||5,created_by:n?.id}]);if(j)throw j;N({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5}),u(!1),y()}catch(j){console.error("Error adding batch:",j)}},v=w=>{const j={pass:{icon:e.jsx(Q,{className:"w-4 h-4"}),color:"bg-sage text-white"},fail:{icon:e.jsx(Me,{className:"w-4 h-4"}),color:"bg-soft-red text-white"},pending:{icon:e.jsx(de,{className:"w-4 h-4"}),color:"bg-accent text-white"}};return j[w]||j.pending};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Testing & Quality Control"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Test"]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Sample Batch"]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(Ss).map(([w,j])=>{const h=x.filter(l=>l.test_category===w);return e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-xl font-bold text-primary mb-4 capitalize",children:[w," Testing"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.map(l=>{const k=h.find(D=>D.test_type===l),g=k?v(k.result):null;return e.jsxs("div",{className:`p-4 rounded-xl border-2 ${k?k.result==="pass"?"border-sage/30 bg-sage/5":k.result==="fail"?"border-soft-red/30 bg-soft-red/5":"border-accent/30 bg-accent/5":"border-dark-brown/10 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!k,readOnly:!0,className:"w-5 h-5 rounded border-2 border-dark-brown/20"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:l})]}),g&&e.jsxs("span",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${g.color}`,children:[g.icon,k.result.toUpperCase()]})]}),k&&e.jsxs("div",{className:"ml-7 space-y-1 text-sm",children:[k.target_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Target:"})," ",k.target_value]}),k.actual_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Actual:"})," ",k.actual_value]}),e.jsxs("p",{className:"text-dark-brown/60",children:["Tested on ",R(new Date(k.test_date),"MMM dd, yyyy")]}),k.notes&&e.jsx("p",{className:"text-dark-brown/70 italic",children:k.notes})]})]},l)})})]},w)})}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h4",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Sample Batches"}),o.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(w=>e.jsxs("div",{className:"p-4 bg-white rounded-xl border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-dark-brown text-lg",children:w.batch_number}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[w.quantity," ",w.unit," â€¢ ",w.purpose]})]}),w.rating&&e.jsx("div",{className:"flex gap-0.5",children:[...Array(5)].map((j,h)=>e.jsx("span",{className:h<w.rating?"text-accent":"text-dark-brown/20",children:"â˜…"},h))})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Date:"})," ",R(new Date(w.batch_date),"MMM dd, yyyy")]}),w.given_to&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Given to:"})," ",w.given_to]}),w.feedback&&e.jsxs("p",{className:"text-dark-brown/70 italic",children:['"',w.feedback,'"']})]})]},w.id))}):e.jsx("p",{className:"text-center py-8 text-dark-brown/50",children:"No sample batches recorded yet"})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Test Result"})}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Category"}),e.jsxs("select",{required:!0,value:t.test_category,onChange:w=>c({...t,test_category:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"stability",children:"Stability Testing"}),e.jsx("option",{value:"safety",children:"Safety Testing"}),e.jsx("option",{value:"performance",children:"Performance Testing"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Test Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:t.test_type,onChange:w=>c({...t,test_type:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select test type"}),Ss[t.test_category]?.map(w=>e.jsx("option",{value:w,children:w},w))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Value"}),e.jsx("input",{type:"text",value:t.target_value,onChange:w=>c({...t,target_value:w.target.value}),placeholder:"e.g., pH 5.5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Actual Value"}),e.jsx("input",{type:"text",value:t.actual_value,onChange:w=>c({...t,actual_value:w.target.value}),placeholder:"e.g., pH 5.6",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Result"}),e.jsxs("select",{value:t.result,onChange:w=>c({...t,result:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"pass",children:"Pass"}),e.jsx("option",{value:"fail",children:"Fail"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Date"}),e.jsx("input",{type:"date",value:t.test_date,onChange:w=>c({...t,test_date:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:t.notes,onChange:w=>c({...t,notes:w.target.value}),rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Test"})]})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Sample Batch"})}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:a.batch_number,onChange:w=>N({...a,batch_number:w.target.value}),placeholder:"e.g., BATCH-001",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Date"}),e.jsx("input",{type:"date",value:a.batch_date,onChange:w=>N({...a,batch_date:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:a.quantity,onChange:w=>N({...a,quantity:w.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("input",{type:"text",value:a.unit,onChange:w=>N({...a,unit:w.target.value}),placeholder:"units/ml/g",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Purpose"}),e.jsxs("select",{value:a.purpose,onChange:w=>N({...a,purpose:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"testing",children:"Testing"}),e.jsx("option",{value:"sampling",children:"Sampling"}),e.jsx("option",{value:"gifting",children:"Gifting"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Given To"}),e.jsx("input",{type:"text",value:a.given_to,onChange:w=>N({...a,given_to:w.target.value}),placeholder:"Names of recipients",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Feedback"}),e.jsx("textarea",{value:a.feedback,onChange:w=>N({...a,feedback:w.target.value}),placeholder:"User feedback...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(w=>e.jsx("button",{type:"button",onClick:()=>N({...a,rating:w}),className:`text-3xl ${w<=a.rating?"text-accent":"text-dark-brown/20"}`,children:"â˜…"},w))})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Batch"})]})]})]})})]})}function sn({productId:s}){const{user:n}=H(),[x,p]=i.useState([]),[o,r]=i.useState(!1),[m,d]=i.useState({version_name:"",image_url:"",specifications:{}});i.useEffect(()=>{b()},[s]);const b=async()=>{try{const{data:a,error:N}=await C.from("packaging_designs").select("*").eq("product_id",s).order("created_at",{ascending:!1});if(N)throw N;p(a||[])}catch(a){console.error("Error fetching designs:",a)}},u=async a=>{a.preventDefault();try{const{error:N}=await C.from("packaging_designs").insert([{product_id:s,...m,uploaded_by:n?.id}]);if(N)throw N;d({version_name:"",image_url:"",specifications:{}}),r(!1),b()}catch(N){console.error("Error adding design:",N)}},t=async a=>{const N=x.find(v=>v.id===a);if(!N)return;const y=N.votes||[],_=y.includes(n?.id)?y.filter(v=>v!==n?.id):[...y,n?.id];try{const{error:v}=await C.from("packaging_designs").update({votes:_}).eq("id",a);if(v)throw v;b()}catch(v){console.error("Error voting:",v)}},c=a=>{const N={under_review:{color:"bg-accent",text:"Under Review"},approved:{color:"bg-sage",text:"Approved"},rejected:{color:"bg-soft-red",text:"Rejected"}};return N[a]||N.under_review};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Packaging Designs"}),e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Upload Design"]})]}),x.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(a=>{const N=c(a.status),y=a.votes||[];return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all",children:[a.image_url?e.jsx("div",{className:"aspect-square bg-cream/30",children:e.jsx("img",{src:a.image_url,alt:a.version_name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-cream/50 to-accent/10 flex items-center justify-center",children:e.jsx("span",{className:"text-6xl",children:"ðŸ“¦"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-bold text-dark-brown",children:a.version_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold text-white ${N.color}`,children:N.text})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>t(a.id),className:`flex items-center gap-1 px-3 py-2 rounded-lg font-semibold transition-all ${y.includes(n?.id)?"bg-accent text-white":"bg-accent/10 text-accent hover:bg-accent/20"}`,children:[e.jsx(Ja,{className:"w-4 h-4"}),y.length]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"View"]}),e.jsx("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]})]})]},a.id)})}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“¦"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No packaging designs uploaded yet"}),e.jsx("button",{onClick:()=>r(!0),className:"px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload First Design"})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-secondary to-accent p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload Design"})}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Design Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:m.version_name,onChange:a=>d({...m,version_name:a.target.value}),placeholder:"e.g., Design A",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Image URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:m.image_url,onChange:a=>d({...m,image_url:a.target.value}),placeholder:"https://example.com/design.jpg",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload Design"})]})]})]})})]})}const Wt=["Research","Formula","Packaging","Production","Marketing","Other"],an=["high","medium","low"],rn=["todo","in_progress","completed","blocked"];function nn({productId:s}){const{user:n}=H(),[x,p]=i.useState([]),[o,r]=i.useState([]),[m,d]=i.useState(!1),[b,u]=i.useState({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"});i.useEffect(()=>{t()},[s]);const t=async()=>{try{const[w,j]=await Promise.all([C.from("product_tasks").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(w.error)throw w.error;if(j.error)throw j.error;p(w.data||[]),r(j.data||[])}catch(w){console.error("Error fetching data:",w)}},c=async w=>{w.preventDefault();try{const{error:j}=await C.from("product_tasks").insert([{product_id:s,...b,created_by:n?.id}]);if(j)throw j;u({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"}),d(!1),t()}catch(j){console.error("Error adding task:",j)}},a=async(w,j)=>{try{const h={status:j};j==="completed"&&(h.completed_at=new Date().toISOString());const{error:l}=await C.from("product_tasks").update(h).eq("id",w);if(l)throw l;t()}catch(h){console.error("Error updating task:",h)}},N=w=>{const j={todo:{color:"bg-dark-brown/20 text-dark-brown",text:"To Do"},in_progress:{color:"bg-accent text-white",text:"In Progress"},completed:{color:"bg-sage text-white",text:"Completed"},blocked:{color:"bg-soft-red text-white",text:"Blocked"}};return j[w]||j.todo},y=w=>{const j={high:"border-l-soft-red",medium:"border-l-accent",low:"border-l-sage"};return j[w]||j.medium},f=w=>o.find(h=>h.id===w)?.name||"Unassigned",_=Wt.reduce((w,j)=>(w[j]=x.filter(h=>h.category===j),w),{}),v={total:x.length,completed:x.filter(w=>w.status==="completed").length,inProgress:x.filter(w=>w.status==="in_progress").length,overdue:x.filter(w=>w.due_date&&new Date(w.due_date)<new Date&&w.status!=="completed").length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Tasks & Checklist"}),e.jsxs("p",{className:"text-dark-brown/60 text-sm mt-1",children:[v.completed,"/",v.total," tasks completed"]})]}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Task"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-4 border-2 border-primary/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Total Tasks"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:v.total})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:v.inProgress})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-4 border-2 border-sage/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:v.completed})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-xl p-4 border-2 border-soft-red/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Overdue"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:v.overdue})]})]}),e.jsx("div",{className:"space-y-6",children:Wt.map(w=>{const j=_[w]||[];return j.length===0?null:e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary mb-4 flex items-center gap-2",children:[w," Tasks",e.jsx("span",{className:"px-2 py-1 bg-primary/10 rounded-full text-sm",children:j.length})]}),e.jsx("div",{className:"space-y-3",children:j.map(h=>{const l=N(h.status),k=y(h.priority),g=h.due_date&&new Date(h.due_date)<new Date&&h.status!=="completed";return e.jsx("div",{className:`bg-white p-4 rounded-xl border-l-4 ${k} shadow-sm hover:shadow-soft transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("input",{type:"checkbox",checked:h.status==="completed",onChange:()=>a(h.id,h.status==="completed"?"todo":"completed"),className:"w-5 h-5 mt-0.5 rounded border-2 border-dark-brown/20 cursor-pointer"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:`font-semibold text-dark-brown mb-1 ${h.status==="completed"?"line-through opacity-60":""}`,children:h.title}),h.description&&e.jsx("p",{className:"text-sm text-dark-brown/70 mb-2",children:h.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-dark-brown/60",children:[h.assigned_to&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-3 h-3"}),f(h.assigned_to)]}),h.due_date&&e.jsxs("span",{className:`flex items-center gap-1 ${g?"text-soft-red font-semibold":""}`,children:[e.jsx(De,{className:"w-3 h-3"}),R(new Date(h.due_date),"MMM dd"),g&&" (Overdue)"]})]})]})]}),e.jsx("select",{value:h.status,onChange:D=>a(h.id,D.target.value),className:`px-3 py-1 rounded-full text-xs font-semibold ${l.color} cursor-pointer`,children:rn.map(D=>e.jsx("option",{value:D,children:N(D).text},D))})]})},h.id)})})]},w)})}),x.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"âœ…"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No tasks created yet"}),e.jsx("button",{onClick:()=>d(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Create First Task"})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-sage p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add New Task"})}),e.jsxs("form",{onSubmit:c,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Task Title ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:b.title,onChange:w=>u({...b,title:w.target.value}),placeholder:"e.g., Complete pH testing",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:b.description,onChange:w=>u({...b,description:w.target.value}),placeholder:"Task description...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:b.category,onChange:w=>u({...b,category:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Wt.map(w=>e.jsx("option",{value:w,children:w},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("select",{value:b.priority,onChange:w=>u({...b,priority:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:an.map(w=>e.jsx("option",{value:w,children:w.charAt(0).toUpperCase()+w.slice(1)},w))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign To"}),e.jsxs("select",{value:b.assigned_to,onChange:w=>u({...b,assigned_to:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Unassigned"}),o.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:b.due_date,onChange:w=>u({...b,due_date:w.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Task"})]})]})]})})]})}function ln({productId:s}){const{user:n}=H(),[x,p]=i.useState([]),[o,r]=i.useState([]),[m,d]=i.useState("");i.useEffect(()=>{b();const f=u();return()=>{f.unsubscribe()}},[s]);const b=async()=>{try{const[f,_]=await Promise.all([C.from("product_comments").select("*").eq("product_id",s).is("parent_comment_id",null).order("created_at",{ascending:!0}),C.from("users").select("*")]);if(f.error)throw f.error;if(_.error)throw _.error;p(f.data||[]),r(_.data||[])}catch(f){console.error("Error fetching data:",f)}},u=()=>C.channel(`product_comments:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"product_comments",filter:`product_id=eq.${s}`},()=>{b()}).subscribe(),t=async f=>{if(f.preventDefault(),!!m.trim())try{const{error:_}=await C.from("product_comments").insert([{product_id:s,user_id:n?.id,text:m}]);if(_)throw _;d("")}catch(_){console.error("Error adding comment:",_)}},c=async(f,_)=>{const v=x.find(l=>l.id===f);if(!v)return;const w=v.reactions||[],j=w.find(l=>l.userId===n?.id&&l.emoji===_);let h;j?h=w.filter(l=>!(l.userId===n?.id&&l.emoji===_)):h=[...w,{userId:n?.id,emoji:_}];try{const{error:l}=await C.from("product_comments").update({reactions:h}).eq("id",f);if(l)throw l}catch(l){console.error("Error updating reaction:",l)}},a=f=>o.find(_=>_.id===f),N=f=>f.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),y=f=>{const _={};return f.forEach(v=>{_[v.emoji]||(_[v.emoji]=[]),_[v.emoji].push(v.userId)}),_};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Team Discussion"}),e.jsx("form",{onSubmit:t,className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:n?.name?N(n.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:m,onChange:f=>d(f.target.value),placeholder:"Share your thoughts, ask questions, or provide updates...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Add emoji",children:e.jsx(Zs,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Attach file",children:e.jsx(os,{className:"w-5 h-5"})})]}),e.jsxs("button",{type:"submit",disabled:!m.trim(),className:"flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ys,{className:"w-5 h-5"}),"Send"]})]})]})]})}),e.jsx("div",{className:"space-y-4",children:x.map(f=>{const _=a(f.user_id),v=y(f.reactions||[]);return e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-dark-brown/5 hover:border-accent/20 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:_?N(_.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:_?.name||"Unknown"}),e.jsx("span",{className:"text-sm text-dark-brown/50",children:R(new Date(f.created_at),"MMM dd, yyyy HH:mm")})]}),e.jsx("p",{className:"text-dark-brown/80 leading-relaxed mb-3",children:f.text}),Object.keys(v).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(v).map(([w,j])=>e.jsxs("button",{onClick:()=>c(f.id,w),className:`flex items-center gap-1 px-3 py-1 rounded-full text-sm transition-all ${j.includes(n?.id||"")?"bg-accent/20 border-2 border-accent":"bg-dark-brown/5 border-2 border-transparent hover:border-accent/30"}`,children:[e.jsx("span",{children:w}),e.jsx("span",{className:"font-semibold text-dark-brown",children:j.length})]},w))}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("button",{className:"hover:text-accent transition-colors",children:[e.jsx(Va,{className:"w-4 h-4 inline mr-1"}),"Reply"]}),e.jsx("button",{onClick:()=>c(f.id,"ðŸ‘"),className:"hover:text-accent transition-colors",children:"ðŸ‘ Like"}),e.jsx("button",{onClick:()=>c(f.id,"â¤ï¸"),className:"hover:text-accent transition-colors",children:"â¤ï¸ Love"}),e.jsx("button",{onClick:()=>c(f.id,"ðŸŽ‰"),className:"hover:text-accent transition-colors",children:"ðŸŽ‰ Celebrate"})]})]})]})},f.id)})}),x.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ’¬"}),e.jsx("p",{className:"text-dark-brown/60",children:"No comments yet. Start the discussion!"})]})]})}const Gt=[{name:"Formulas",icon:"âš—ï¸"},{name:"Test Reports",icon:"ðŸ§ª"},{name:"Packaging Designs",icon:"ðŸ“¦"},{name:"Certificates",icon:"ðŸ†"},{name:"Marketing Materials",icon:"ðŸ“¢"},{name:"Legal Documents",icon:"ðŸ“‹"},{name:"Research Papers",icon:"ðŸ“š"},{name:"Photos",icon:"ðŸ“¸"}];function on({productId:s}){const{user:n}=H(),[x,p]=i.useState([]),[o,r]=i.useState([]),[m,d]=i.useState(null),[b,u]=i.useState(!1),[t,c]=i.useState({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"});i.useEffect(()=>{a()},[s]);const a=async()=>{try{const[h,l]=await Promise.all([C.from("product_files").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*")]);if(h.error)throw h.error;if(l.error)throw l.error;p(h.data||[]),r(l.data||[])}catch(h){console.error("Error fetching data:",h)}},N=async h=>{h.preventDefault();try{const{error:l}=await C.from("product_files").insert([{product_id:s,...t,file_size:0,uploaded_by:n?.id}]);if(l)throw l;c({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"}),u(!1),a()}catch(l){console.error("Error uploading file:",l)}},y=async h=>{if(confirm("Are you sure you want to delete this file?"))try{const{error:l}=await C.from("product_files").delete().eq("id",h);if(l)throw l;a()}catch(l){console.error("Error deleting file:",l)}},f=h=>o.find(k=>k.id===h)?.name||"Unknown",_=h=>h.startsWith("image/")?e.jsx(ns,{className:"w-6 h-6"}):h==="application/pdf"?e.jsx(ae,{className:"w-6 h-6"}):e.jsx(zs,{className:"w-6 h-6"}),v=m?x.filter(h=>h.category===m):x,w=Gt.reduce((h,l)=>(h[l.name]=x.filter(k=>k.category===l.name).length,h),{}),j=h=>{if(h===0)return"0 KB";const l=1024,k=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(h)/Math.log(l));return Math.round(h/Math.pow(l,g)*100)/100+" "+k[g]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Files & Documents"}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Be,{className:"w-5 h-5"}),"Upload File"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Gt.map(h=>e.jsxs("button",{onClick:()=>d(m===h.name?null:h.name),className:`p-4 rounded-xl border-2 transition-all ${m===h.name?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:h.icon}),e.jsx("span",{className:"font-semibold text-dark-brown text-sm",children:h.name})]}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:w[h.name]||0})]},h.name))}),m&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Os,{className:"w-4 h-4 text-accent"}),e.jsxs("span",{className:"text-dark-brown",children:["Showing files in: ",e.jsx("strong",{children:m})]}),e.jsx("button",{onClick:()=>d(null),className:"text-accent hover:underline",children:"Clear filter"})]}),v.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(h=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border-2 border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center text-accent flex-shrink-0",children:_(h.file_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",title:h.file_name,children:h.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:h.category})]})]}),e.jsxs("div",{className:"text-xs text-dark-brown/60 space-y-1 mb-3",children:[e.jsxs("p",{children:["Uploaded by ",f(h.uploaded_by)]}),e.jsx("p",{children:R(new Date(h.created_at),"MMM dd, yyyy")}),h.file_size>0&&e.jsx("p",{children:j(h.file_size)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:h.file_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{onClick:()=>y(h.id),className:"px-3 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]})]},h.id))}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:m?`No files in ${m} yet`:"No files uploaded yet"}),e.jsx("button",{onClick:()=>u(!0),className:"px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload Your First File"})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload File"})}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{required:!0,value:t.category,onChange:h=>c({...t,category:h.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Gt.map(h=>e.jsxs("option",{value:h.name,children:[h.icon," ",h.name]},h.name))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:t.file_name,onChange:h=>c({...t,file_name:h.target.value}),placeholder:"e.g., Formula v1.0.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:t.file_url,onChange:h=>c({...t,file_url:h.target.value}),placeholder:"https://example.com/file.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Enter the direct URL to your file"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"File Type"}),e.jsxs("select",{value:t.file_type,onChange:h=>c({...t,file_type:h.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"application/pdf",children:"PDF Document"}),e.jsx("option",{value:"image/jpeg",children:"JPEG Image"}),e.jsx("option",{value:"image/png",children:"PNG Image"}),e.jsx("option",{value:"application/msword",children:"Word Document"}),e.jsx("option",{value:"application/vnd.ms-excel",children:"Excel Spreadsheet"}),e.jsx("option",{value:"text/plain",children:"Text File"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload File"})]})]})]})})]})}const dn=[{id:"overview",name:"Overview",icon:ae},{id:"ingredients",name:"Ingredients & Formula",icon:He},{id:"testing",name:"Testing & Quality",icon:Xs},{id:"packaging",name:"Packaging",icon:ne},{id:"tasks",name:"Tasks & Checklist",icon:rs},{id:"discussion",name:"Team Discussion",icon:qt},{id:"files",name:"Files & Documents",icon:Os}],St=[{id:"idea",name:"Idea",color:"bg-sage"},{id:"research",name:"Research",color:"bg-sage"},{id:"formula",name:"Formula Creation",color:"bg-accent"},{id:"testing",name:"Testing",color:"bg-accent"},{id:"packaging",name:"Packaging Design",color:"bg-secondary"},{id:"printing",name:"Printing",color:"bg-secondary"},{id:"production",name:"Production",color:"bg-secondary"},{id:"ready",name:"Ready to Launch",color:"bg-primary"},{id:"launched",name:"Launched",color:"bg-primary"}];function cn(){const{id:s}=Je(),n=ce(),{user:x}=H(),[p,o]=i.useState("overview"),[r,m]=i.useState(null),[d,b]=i.useState([]),[u,t]=i.useState(!0),[c,a]=i.useState(!1);i.useEffect(()=>{s&&N()},[s]);const N=async()=>{try{const[h,l]=await Promise.all([C.from("products").select("*").eq("id",s).single(),C.from("users").select("id, name, email").order("name")]);if(h.error)throw h.error;if(l.error)throw l.error;m(h.data),b(l.data||[])}catch(h){console.error("Error fetching data:",h)}finally{t(!1)}},y=N,f=async()=>{if(!r)return;const h=St.findIndex(k=>k.id===r.current_stage);if(h===-1||h===St.length-1)return;const l=St[h+1];if(!(l.id==="launched"&&!window.confirm(`Are you sure you want to launch "${r.name}"? This marks it as complete.`)))try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",r.id).is("exited_at",null),await C.from("products").update({current_stage:l.id,stage_entered_at:new Date().toISOString(),progress:l.id==="launched"?100:r.progress}).eq("id",r.id),await C.from("product_stage_history").insert([{product_id:r.id,stage:l.id,moved_by:x?.id}]),await y()}catch(k){console.error("Error moving product:",k)}},_=async(h,l)=>{try{const{error:k}=await C.from("products").update({...l,updated_at:new Date().toISOString()}).eq("id",h);if(k)throw k;await C.from("activity_log").insert({user_id:x?.id,activity_type:"product_updated",description:`${x?.name} updated product: ${l.name}`}),await y()}catch(k){throw console.error("Error updating product:",k),k}},v=h=>{const l={high:{color:"bg-soft-red",text:"HIGH"},medium:{color:"bg-accent",text:"MEDIUM"},low:{color:"bg-sage",text:"LOW"}};return l[h]||l.medium};if(u)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Loading product..."})})});if(!r)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Product not found"})})});const w=St.find(h=>h.id===r.current_stage),j=v(r.priority);return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/products"),className:"flex items-center gap-2 text-dark-brown/70 hover:text-primary mb-6 transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Pipeline"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-3",children:r.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-semibold",children:r.category}),e.jsx("span",{className:`px-3 py-1 ${j.color} text-white rounded-full text-sm font-semibold`,children:j.text}),w&&e.jsx("span",{className:`px-4 py-1 ${w.color} text-white rounded-full text-sm font-semibold`,children:w.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Stage Progress"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[r.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${r.progress}%`}})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(ge,{className:"w-5 h-5"}),"Edit"]}),e.jsxs("button",{onClick:f,disabled:r.current_stage==="launched",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ss,{className:"w-5 h-5"}),"Move to Next Stage"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(Ga,{className:"w-5 h-5"}),"Share"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-xl font-semibold transition-colors",children:[e.jsx(Ma,{className:"w-5 h-5"}),"Archive"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex min-w-max",children:dn.map(h=>{const l=h.icon;return e.jsxs("button",{onClick:()=>o(h.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all duration-300 border-b-4 ${p===h.id?"border-accent text-accent bg-accent/5":"border-transparent text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(l,{className:"w-5 h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:h.name})]},h.id)})})})}),e.jsxs("div",{className:"p-6",children:[p==="overview"&&e.jsx(Kr,{product:r,onRefresh:y}),p==="ingredients"&&e.jsx(en,{productId:r.id}),p==="testing"&&e.jsx(tn,{productId:r.id}),p==="packaging"&&e.jsx(sn,{productId:r.id}),p==="tasks"&&e.jsx(nn,{productId:r.id}),p==="discussion"&&e.jsx(ln,{productId:r.id}),p==="files"&&e.jsx(on,{productId:r.id})]})]})]}),r&&e.jsx(aa,{isOpen:c,onClose:()=>a(!1),onSubmit:_,product:r,users:d})]})}function xn(){const{user:s}=H(),[n,x]=i.useState([]),[p,o]=i.useState(""),[r,m]=i.useState(""),[d,b]=i.useState(100),[u,t]=i.useState([]),[c,a]=i.useState([{id:"1",name:"Primary Container (Bottle/Jar)",quantity:1,costPerPiece:0,total:0},{id:"2",name:"Label/Sticker",quantity:1,costPerPiece:0,total:0},{id:"3",name:"Secondary Packaging (Box)",quantity:1,costPerPiece:0,total:0}]),[N,y]=i.useState([]),[f,_]=i.useState(0),[v,w]=i.useState(0),[j,h]=i.useState(0),[l,k]=i.useState(0),[g,D]=i.useState(0),[P,E]=i.useState(0),[I,q]=i.useState(0),[O,Y]=i.useState(0),[ee,te]=i.useState(10),[S,$]=i.useState(1),[L,V]=i.useState(0),[T,z]=i.useState(10),[ie,me]=i.useState(0),[_e,jt]=i.useState(12),[Ce,We]=i.useState([]),[Xe,yt]=i.useState(0),[et,Pe]=i.useState(0),[Ee,wt]=i.useState(0),[Ae,Rt]=i.useState(0),[Ut,zt]=i.useState([]),[Bt,tt]=i.useState(!1),[Ge,M]=i.useState("");i.useEffect(()=>{B(),W()},[]),i.useEffect(()=>{p&&Nt()},[p]);const B=async()=>{try{const{data:A,error:U}=await C.from("products").select("*").order("name");if(U)throw U;x(A||[])}catch(A){console.error("Error fetching products:",A)}},W=async()=>{try{const{data:A,error:U}=await C.from("product_cost_calculations").select("*").eq("is_draft",!1).order("created_at",{ascending:!1});if(U)throw U;zt(A||[])}catch(A){console.error("Error fetching calculations:",A)}},Nt=async()=>{const A=n.find(U=>U.id===p);if(A){m(A.name);try{const{data:U}=await C.from("product_ingredients").select("*").eq("product_id",p);if(U&&U.length>0){const Z=U.map(re=>({id:re.id,name:re.ingredient_name,quantity:re.quantity||0,unit:re.unit||"g",costPerUnit:re.cost_per_unit||0,total:(re.quantity||0)*(re.cost_per_unit||0)}));t(Z)}}catch(U){console.error("Error loading product data:",U)}}},Ot=()=>{t([...u,{id:Date.now().toString(),name:"",quantity:0,unit:"g",costPerUnit:0,total:0}])},Qe=(A,U,Z)=>{t(u.map(re=>{if(re.id===A){const pe={...re,[U]:Z};return pe.total=pe.quantity*pe.costPerUnit,pe}return re}))},ra=A=>{t(u.filter(U=>U.id!==A))},ds=(A,U,Z)=>{a(c.map(re=>{if(re.id===A){const pe={...re,[U]:Z};return pe.total=pe.quantity*pe.costPerPiece,pe}return re}))},na=()=>{y([...N,{id:Date.now().toString(),description:"",amount:0}])},la=()=>{We([...Ce,{id:Date.now().toString(),description:"",amount:0}])},st=u.reduce((A,U)=>A+U.total,0),at=[...c.map(A=>A.total),...N.map(A=>A.amount)].reduce((A,U)=>A+U,0),Vt=f*v,cs=j+l+g+P,rt=Vt+cs+I,Ht=S>0?O*ee/100/S:0,xs=S>0?L*T/100/S:0,ms=_e>0?ie/_e:0,oa=Ce.reduce((A,U)=>A+U.amount,0),nt=Ht+xs+ms+oa,hs=et+Ee,lt=(Xe+hs)*d,vt=st+at+rt+nt+lt,ot=d>0?vt/d:0,kt=[{name:"Raw Materials",value:st,color:"#8B4513"},{name:"Packaging",value:at,color:"#D2691E"},{name:"Manufacturing",value:rt,color:"#CD853F"},{name:"Overheads",value:nt,color:"#DEB887"},{name:"Marketing",value:lt,color:"#F4A460"}].filter(A=>A.value>0),ps=A=>{const U=ot/(1-A/100),Z=U*.18,re=U+Z,pe=U-ot;return{sellingPrice:U,gst:Z,mrp:re,profit:pe,marginPercent:A}},bs=[30,40,50,60].map(A=>ps(A)),ia=async()=>{if(!Ge.trim()){alert("Please enter a calculation name");return}try{const A={product_id:p||null,calculation_name:Ge,batch_size:d,raw_material_costs:{ingredients:u,subtotal:st},packaging_costs:{components:c,other:N,subtotal:at},manufacturing_costs:{labour:Vt,utilities:cs,qc:I,subtotal:rt},overhead_costs:{rent:Ht,salaries:xs,compliance:ms,other:Ce,subtotal:nt},marketing_costs:{marketing:Xe*d,fulfillment:hs*d,subtotal:lt},total_cost:vt,cost_per_unit:ot,margin_scenarios:bs,saved_by:s?.id,is_draft:!1},{error:U}=await C.from("product_cost_calculations").insert([A]);if(U)throw U;tt(!1),M(""),W(),alert("Calculation saved successfully!")}catch(A){console.error("Error saving calculation:",A),alert("Error saving calculation")}};return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Product Cost Calculator"}),e.jsx("p",{className:"text-dark-brown/70",children:"Calculate unit economics and pricing strategy"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>tt(!0),className:"flex items-center gap-2 px-6 py-3 bg-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all hover:bg-accent/90",children:[e.jsx(Qs,{className:"w-5 h-5"}),"Save Calculation"]}),e.jsxs("button",{className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(ke,{className:"w-5 h-5"}),"Export PDF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Select Product (Optional)"}),e.jsxs("select",{value:p,onChange:A=>o(A.target.value),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Calculate for new product"}),n.map(A=>e.jsx("option",{value:A.id,children:A.name},A.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Load Saved Calculation"}),e.jsxs("select",{className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select saved calculation..."}),Ut.map(A=>e.jsxs("option",{value:A.id,children:[A.calculation_name," - ",new Date(A.created_at).toLocaleDateString()]},A.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Batch Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Name"}),e.jsx("input",{type:"text",value:r,onChange:A=>m(A.target.value),placeholder:"Enter product name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Size (Units)"}),e.jsx("input",{type:"number",value:d,onChange:A=>b(parseInt(A.target.value)||0),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Raw Materials"}),e.jsxs("button",{onClick:Ot,className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Ingredient"]})]}),e.jsx("div",{className:"space-y-3",children:u.map(A=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:A.name,onChange:U=>Qe(A.id,"name",U.target.value),placeholder:"Ingredient name",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:A.quantity,onChange:U=>Qe(A.id,"quantity",parseFloat(U.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:A.unit,onChange:U=>Qe(A.id,"unit",U.target.value),className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"ml",children:"ml"}),e.jsx("option",{value:"L",children:"L"})]}),e.jsx("input",{type:"number",value:A.costPerUnit,onChange:U=>Qe(A.id,"costPerUnit",parseFloat(U.target.value)||0),placeholder:"â‚¹/unit",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-2 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",A.total.toFixed(2)]}),e.jsx("button",{onClick:()=>ra(A.id),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]},A.id))}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Raw Material Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",st.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(st/d).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Packaging Costs"}),e.jsx("div",{className:"space-y-3 mb-4",children:c.map(A=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("span",{className:"col-span-4 text-sm font-semibold text-dark-brown",children:A.name}),e.jsx("input",{type:"number",value:A.quantity,onChange:U=>ds(A.id,"quantity",parseFloat(U.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:A.costPerPiece,onChange:U=>ds(A.id,"costPerPiece",parseFloat(U.target.value)||0),placeholder:"â‚¹/piece",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-3 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",(A.total*d).toFixed(2)]})]},A.id))}),e.jsx("button",{onClick:na,className:"text-sm text-accent hover:underline mb-3",children:"+ Add other packaging material"}),N.map(A=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center mb-2",children:[e.jsx("input",{type:"text",value:A.description,onChange:U=>y(N.map(Z=>Z.id===A.id?{...Z,description:U.target.value}:Z)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:A.amount,onChange:U=>y(N.map(Z=>Z.id===A.id?{...Z,amount:parseFloat(U.target.value)||0}:Z)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>y(N.filter(U=>U.id!==A.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]},A.id)),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Packaging Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",at.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(at/d).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Manufacturing Costs"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Labour Hours"}),e.jsx("input",{type:"number",value:f,onChange:A=>_(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Hour (â‚¹)"}),e.jsx("input",{type:"number",value:v,onChange:A=>w(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Labour: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",Vt.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Electricity (â‚¹)"}),e.jsx("input",{type:"number",value:j,onChange:A=>h(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Water (â‚¹)"}),e.jsx("input",{type:"number",value:l,onChange:A=>k(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Equipment Depreciation (â‚¹)"}),e.jsx("input",{type:"number",value:g,onChange:A=>D(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Other Utilities (â‚¹)"}),e.jsx("input",{type:"number",value:P,onChange:A=>E(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC/Testing Cost (â‚¹)"}),e.jsx("input",{type:"number",value:I,onChange:A=>q(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Manufacturing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",rt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(rt/d).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Overhead Allocation"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Rent (â‚¹)"}),e.jsx("input",{type:"number",value:O,onChange:A=>Y(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation to this product: ",ee,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:ee,onChange:A=>te(parseInt(A.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batches per Month"}),e.jsx("input",{type:"number",value:S,onChange:A=>$(parseInt(A.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Rent per batch: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",Ht.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Salaries (â‚¹)"}),e.jsx("input",{type:"number",value:L,onChange:A=>V(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation: ",T,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:T,onChange:A=>z(parseInt(A.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Compliance (â‚¹)"}),e.jsx("input",{type:"number",value:ie,onChange:A=>me(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Batches"}),e.jsx("input",{type:"number",value:_e,onChange:A=>jt(parseInt(A.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsx("button",{onClick:la,className:"text-sm text-accent hover:underline",children:"+ Add other overhead"}),Ce.map(A=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:A.description,onChange:U=>We(Ce.map(Z=>Z.id===A.id?{...Z,description:U.target.value}:Z)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:A.amount,onChange:U=>We(Ce.map(Z=>Z.id===A.id?{...Z,amount:parseFloat(U.target.value)||0}:Z)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>We(Ce.filter(U=>U.id!==A.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]},A.id))]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Overhead Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",nt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(nt/d).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Marketing & Distribution"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Marketing per Unit (â‚¹)"}),e.jsx("input",{type:"number",value:Xe,onChange:A=>yt(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Ads, samples, packaging inserts, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Shipping Material (â‚¹)"}),e.jsx("input",{type:"number",value:et,onChange:A=>Pe(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Courier Charges (â‚¹)"}),e.jsx("input",{type:"number",value:Ee,onChange:A=>wt(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Platform Fees (%)"}),e.jsx("input",{type:"number",value:Ae,onChange:A=>Rt(parseFloat(A.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Marketing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",lt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(lt/d).toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-2xl shadow-soft-lg p-6 text-white sticky top-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(qs,{className:"w-8 h-8"}),e.jsx("h3",{className:"font-heading text-2xl font-bold",children:"Cost Summary"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Total Batch Cost"}),e.jsxs("p",{className:"text-4xl font-bold",children:["â‚¹",vt.toFixed(2)]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-white/20 rounded-xl backdrop-blur-sm",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Cost Per Unit"}),e.jsxs("p",{className:"text-5xl font-bold",children:["â‚¹",ot.toFixed(2)]})]}),kt.length>0&&e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 backdrop-blur-sm",children:[e.jsx("p",{className:"text-sm font-semibold mb-3",children:"Cost Breakdown"}),e.jsx(be,{width:"100%",height:200,children:e.jsxs(At,{children:[e.jsx(It,{data:kt,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:kt.map((A,U)=>e.jsx(Ft,{fill:A.color},`cell-${U}`))}),e.jsx(ye,{formatter:A=>`â‚¹${A.toFixed(2)}`,contentStyle:{background:"#fff",border:"none",borderRadius:"8px"}})]})}),e.jsx("div",{className:"space-y-2 mt-3",children:kt.map((A,U)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:A.color}}),e.jsx("span",{children:A.name})]}),e.jsxs("span",{className:"font-semibold",children:[(A.value/vt*100).toFixed(1),"%"]})]},U))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Pricing Strategy"}),e.jsx("div",{className:"space-y-4",children:bs.map((A,U)=>e.jsxs("div",{className:"p-4 bg-gradient-to-br from-cream/50 to-white rounded-xl border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-bold text-lg text-primary",children:[A.marginPercent,"% Margin"]}),e.jsxs("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-sm font-semibold",children:["Profit: â‚¹",A.profit.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Selling Price (ex-GST):"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",A.sellingPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"GST @ 18%:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",A.gst.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"font-bold text-dark-brown",children:"MRP (incl. GST):"}),e.jsxs("span",{className:"font-bold text-xl text-sage",children:["â‚¹",A.mrp.toFixed(2)]})]})]})]},U))})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Profitability Scenarios"}),e.jsx("div",{className:"space-y-3",children:[100,500,1e3,5e3].map(A=>{const U=A*ps(40).mrp,Z=A*ot,re=U-Z,pe=Z>0?re/U*100:0;return e.jsxs("div",{className:"p-3 bg-cream/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-dark-brown",children:[A," units"]}),e.jsxs("span",{className:`text-sm font-bold ${re>0?"text-sage":"text-soft-red"}`,children:[re>0?"+":"","â‚¹",re.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60",children:[e.jsxs("span",{children:["Revenue: â‚¹",U.toFixed(0)]}),e.jsxs("span",{children:["Margin: ",pe.toFixed(1),"%"]})]})]},A)})})]})]})]})]}),Bt&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Save Calculation"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Calculation Name"}),e.jsx("input",{type:"text",value:Ge,onChange:A=>M(A.target.value),placeholder:"e.g., Neem Face Wash v1.0 - 100 unit batch",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>tt(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:ia,className:"flex-1 px-6 py-3 bg-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all hover:bg-accent/90",children:"Save"})]})]})})]})}const mn=["Raw Materials","Packaging","Printing","Logistics","Lab Testing","Equipment","Other"],hn=["Immediate","7 days","15 days","30 days","45 days","60 days","Custom"];function pn({onClose:s,onSuccess:n}){const{user:x}=H(),[p,o]=i.useState(!1),[r,m]=i.useState({name:"",category:"Raw Materials",products:"",contactPerson:"",phone:"",email:"",alternatePhone:"",address:"",gstNumber:"",website:"",paymentTerms:"30 days",bankName:"",accountNumber:"",ifscCode:"",initialRating:3,notes:""}),[d,b]=i.useState({iso:!1,organic:!1,fssai:!1,gmp:!1,other:""}),u=async t=>{if(t.preventDefault(),!r.name||!r.phone){alert("Please fill in required fields (Name and Phone)");return}o(!0);try{const c=r.bankName?{bankName:r.bankName,accountNumber:r.accountNumber,ifscCode:r.ifscCode}:{},a=[];d.iso&&a.push("ISO Certified"),d.organic&&a.push("Organic Certified"),d.fssai&&a.push("FSSAI Approved"),d.gmp&&a.push("GMP Certified"),d.other&&a.push(d.other);const{error:N}=await C.from("vendors").insert([{name:r.name,category:r.category,products:r.products,contact_person:r.contactPerson,phone:r.phone,email:r.email,alternate_phone:r.alternatePhone,address:r.address,gst_number:r.gstNumber,website:r.website,payment_terms:r.paymentTerms,bank_details:c,certifications:a,initial_rating:r.initialRating,current_rating:r.initialRating,notes:r.notes,created_by:x?.id}]);if(N)throw N;n()}catch(c){console.error("Error adding vendor:",c),alert("Error adding vendor. Please try again.")}finally{o(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add New Vendor"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:r.name,onChange:t=>m({...r,name:t.target.value}),placeholder:"e.g., Green Valley Herbs",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:r.category,onChange:t=>m({...r,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:mn.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:r.contactPerson,onChange:t=>m({...r,contactPerson:t.target.value}),placeholder:"Contact person name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Products/Services"}),e.jsx("textarea",{value:r.products,onChange:t=>m({...r,products:t.target.value}),placeholder:"What does this vendor supply? e.g., Organic herbs, essential oils",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Contact Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Phone Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"tel",value:r.phone,onChange:t=>m({...r,phone:t.target.value}),placeholder:"+91-XXXXXXXXXX",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email"}),e.jsx("input",{type:"email",value:r.email,onChange:t=>m({...r,email:t.target.value}),placeholder:"vendor@example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Alternative Phone"}),e.jsx("input",{type:"tel",value:r.alternatePhone,onChange:t=>m({...r,alternatePhone:t.target.value}),placeholder:"Optional second number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Website"}),e.jsx("input",{type:"url",value:r.website,onChange:t=>m({...r,website:t.target.value}),placeholder:"https://example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Address"}),e.jsx("textarea",{value:r.address,onChange:t=>m({...r,address:t.target.value}),placeholder:"Street, city, state, pincode",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Business Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"GST Number"}),e.jsx("input",{type:"text",value:r.gstNumber,onChange:t=>m({...r,gstNumber:t.target.value}),placeholder:"22AAAAA0000A1Z5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Terms"}),e.jsx("select",{value:r.paymentTerms,onChange:t=>m({...r,paymentTerms:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:hn.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bank Name"}),e.jsx("input",{type:"text",value:r.bankName,onChange:t=>m({...r,bankName:t.target.value}),placeholder:"e.g., HDFC Bank",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:r.accountNumber,onChange:t=>m({...r,accountNumber:t.target.value}),placeholder:"Account number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"IFSC Code"}),e.jsx("input",{type:"text",value:r.ifscCode,onChange:t=>m({...r,ifscCode:t.target.value}),placeholder:"e.g., HDFC0001234",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality & Rating"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Initial Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>m({...r,initialRating:t}),className:"focus:outline-none",children:e.jsx(Ze,{className:`w-8 h-8 transition-colors ${t<=r.initialRating?"fill-amber-400 text-amber-400":"text-dark-brown/20 hover:text-amber-400"}`})},t)),e.jsxs("span",{className:"ml-2 text-sm font-semibold text-dark-brown",children:[r.initialRating," / 5"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Quality Certifications"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.iso,onChange:t=>b({...d,iso:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"ISO Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.organic,onChange:t=>b({...d,organic:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Organic Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.fssai,onChange:t=>b({...d,fssai:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"FSSAI Approved"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.gmp,onChange:t=>b({...d,gmp:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"GMP Certified"})]}),e.jsx("input",{type:"text",value:d.other,onChange:t=>b({...d,other:t.target.value}),placeholder:"Other certifications (comma separated)",className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Internal Notes"}),e.jsx("textarea",{value:r.notes,onChange:t=>m({...r,notes:t.target.value}),placeholder:"Any internal notes about this vendor (not visible to vendor)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:p,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:p?"Adding...":"Add Vendor"})]})]})})}const Qt=[{id:"all",label:"All Vendors",icon:"ðŸ¢",color:"bg-dark-brown/10"},{id:"Raw Materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20"},{id:"Packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-secondary/20"},{id:"Printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-blue-500/20"},{id:"Logistics",label:"Logistics",icon:"ðŸšš",color:"bg-accent/20"},{id:"Lab Testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-purple-500/20"},{id:"Other",label:"Other",icon:"ðŸ”§",color:"bg-dark-brown/20"}];function bn(){const[s,n]=i.useState([]),[x,p]=i.useState([]),[o,r]=i.useState("grid"),[m,d]=i.useState("all"),[b,u]=i.useState(""),[t,c]=i.useState(!1),[a,N]=i.useState({total:0,active:0,pendingPayments:0,avgRating:0});i.useEffect(()=>{y()},[]),i.useEffect(()=>{f()},[s,m,b]);const y=async()=>{try{const{data:j,error:h}=await C.from("vendors").select("*").order("name");if(h)throw h;const{data:l}=await C.from("vendor_transactions").select("vendor_id, amount, status"),k=(j||[]).map(I=>{const q=l?.filter(ee=>ee.vendor_id===I.id)||[],O=q.reduce((ee,te)=>ee+(parseFloat(te.amount)||0),0),Y=q.filter(ee=>ee.status==="pending").reduce((ee,te)=>ee+(parseFloat(te.amount)||0),0);return{...I,totalSpent:O,pendingAmount:Y}});n(k);const g=k.length,D=k.filter(I=>I.totalSpent>0).length,P=k.reduce((I,q)=>I+q.pendingAmount,0),E=k.reduce((I,q)=>I+(q.current_rating||0),0)/(g||1);N({total:g,active:D,pendingPayments:P,avgRating:E})}catch(j){console.error("Error fetching vendors:",j)}},f=()=>{let j=s;if(m!=="all"&&(j=j.filter(h=>h.category===m)),b){const h=b.toLowerCase();j=j.filter(l=>l.name?.toLowerCase().includes(h)||l.contact_person?.toLowerCase().includes(h)||l.email?.toLowerCase().includes(h)||l.phone?.includes(h))}p(j)},_=j=>Qt.find(l=>l.id===j)?.color||"bg-dark-brown/10",v=j=>Qt.find(l=>l.id===j)?.icon||"ðŸ¢",w=j=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(h=>e.jsx(Ze,{className:`w-4 h-4 ${h<=j?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},h))});return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Vendor & Supplier Directory"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your business relationships"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(je,{className:"w-8 h-8 text-primary"}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:a.total})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(se,{className:"w-8 h-8 text-sage"}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:a.active})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Active Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fe,{className:"w-8 h-8 text-soft-red"}),e.jsxs("span",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",a.pendingPayments.toFixed(0)]})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ye,{className:"w-8 h-8 text-amber-500"}),e.jsx("span",{className:"text-3xl font-bold text-amber-500",children:a.avgRating.toFixed(1)})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Average Rating"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-soft p-4 my-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto w-full lg:w-auto",children:Qt.map(j=>{const h=j.id==="all"?s.length:s.filter(l=>l.category===j.id).length;return e.jsxs("button",{onClick:()=>d(j.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${m===j.id?"bg-primary text-white shadow-soft":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:j.icon}),e.jsx("span",{children:j.label}),e.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded-full text-xs",children:h})]},j.id)})}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",value:b,onChange:j=>u(j.target.value),placeholder:"Search vendors...",className:"w-full pl-10 pr-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex items-center gap-1 p-1 bg-dark-brown/5 rounded-lg",children:[e.jsx("button",{onClick:()=>r("grid"),className:`p-2 rounded-lg transition-all ${o==="grid"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(Vs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>r("list"),className:`p-2 rounded-lg transition-all ${o==="list"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})})]})]})]})}),o==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(j=>e.jsxs(Ne,{to:`/vendors/${j.id}`,className:"bg-white rounded-xl shadow-soft hover:shadow-soft-lg transition-all overflow-hidden border-l-4 border-transparent hover:border-primary group",children:[e.jsx("div",{className:`h-2 ${_(j.category)}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary group-hover:text-accent transition-colors mb-1",children:j.name}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(j.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:v(j.category)}),j.category]})]})}),e.jsxs("div",{className:"flex items-center gap-1 mb-4",children:[w(j.current_rating||3),e.jsxs("span",{className:"text-sm text-dark-brown/60 ml-2",children:["(",j.current_rating?.toFixed(1)||"3.0",")"]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[j.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{children:j.phone})]}),j.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:j.email})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Total Spent"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",j.totalSpent?.toFixed(0)||"0"]})]}),j.pendingAmount>0&&e.jsxs("div",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",j.pendingAmount.toFixed(0)," due"]})]})]})]},j.id))}):e.jsx("div",{className:"bg-white rounded-xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Vendor Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Contact"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Rating"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Total Spent"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Pending"})]})}),e.jsx("tbody",{children:x.map((j,h)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${h%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx(Ne,{to:`/vendors/${j.id}`,className:"font-semibold text-primary hover:text-accent transition-colors",children:j.name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(j.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:v(j.category)}),j.category]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[j.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(bt,{className:"w-3 h-3"}),j.phone]}),j.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(Ve,{className:"w-3 h-3"}),j.email]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w(j.current_rating||3),e.jsx("span",{className:"text-sm text-dark-brown/60",children:j.current_rating?.toFixed(1)||"3.0"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",j.totalSpent?.toFixed(0)||"0"]})}),e.jsx("td",{className:"px-6 py-4",children:j.pendingAmount>0?e.jsxs("span",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",j.pendingAmount.toFixed(0)]}):e.jsx("span",{className:"text-sm text-dark-brown/40",children:"-"})})]},j.id))})]})})}),x.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:b?"Try adjusting your search":"Add your first vendor to get started"}),!b&&e.jsx("button",{onClick:()=>c(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Vendor"})]})]}),t&&e.jsx(pn,{onClose:()=>c(!1),onSuccess:()=>{c(!1),y()}})]})}function un({vendor:s}){const[n,x]=i.useState({totalSpent:0,thisMonth:0,thisYear:0,avgTransaction:0,pendingPayment:0,totalTransactions:0}),[p,o]=i.useState([]);i.useEffect(()=>{r(),m()},[s.id]);const r=async()=>{try{const{data:d}=await C.from("vendor_transactions").select("*").eq("vendor_id",s.id);if(!d)return;const b=new Date,u=d.filter(f=>{const _=new Date(f.date);return _.getMonth()===b.getMonth()&&_.getFullYear()===b.getFullYear()}),t=d.filter(f=>new Date(f.date).getFullYear()===b.getFullYear()),c=d.reduce((f,_)=>f+parseFloat(_.amount),0),a=u.reduce((f,_)=>f+parseFloat(_.amount),0),N=t.reduce((f,_)=>f+parseFloat(_.amount),0),y=d.filter(f=>f.status==="pending").reduce((f,_)=>f+parseFloat(_.amount),0);x({totalSpent:c,thisMonth:a,thisYear:N,avgTransaction:d.length>0?c/d.length:0,pendingPayment:y,totalTransactions:d.length})}catch(d){console.error("Error fetching stats:",d)}},m=async()=>{try{const{data:d}=await C.from("vendor_transactions").select("date, amount").eq("vendor_id",s.id).order("date");if(!d)return;const b={};d.forEach(t=>{const c=new Date(t.date),a=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;b[a]||(b[a]=0),b[a]+=parseFloat(t.amount)});const u=Object.entries(b).map(([t,c])=>({month:t,amount:c}));o(u.slice(-12))}catch(d){console.error("Error fetching spending trend:",d)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Vendor Information"}),e.jsxs("div",{className:"space-y-3",children:[s.contact_person&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Contact Person"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.contact_person})]})]}),s.phone&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(bt,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Phone"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.phone}),s.alternate_phone&&e.jsx("p",{className:"text-sm text-dark-brown/60",children:s.alternate_phone})]})]}),s.email&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ve,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Email"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.email})]})]}),s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ws,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Address"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.address})]})]}),s.website&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(La,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Website"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-accent hover:underline",children:s.website})]})]}),s.gst_number&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(pt,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"GST Number"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.gst_number})]})]}),s.payment_terms&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ’³"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Payment Terms"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.payment_terms})]})]}),s.certifications&&Array.isArray(s.certifications)&&s.certifications.length>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ye,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Certifications"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:s.certifications.map((d,b)=>e.jsx("span",{className:"px-2 py-1 bg-sage/20 text-sage text-xs font-semibold rounded-full",children:d},b))})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.totalSpent.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.thisMonth.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Year"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.thisYear.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Avg Transaction"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.avgTransaction.toFixed(0)]})]})]}),n.pendingPayment>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Pending Payment"}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",n.pendingPayment.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Total Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:n.totalTransactions})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Category"}),e.jsx("span",{className:"font-bold text-primary",children:s.category})]}),s.products&&e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Products/Services"}),e.jsx("span",{className:"font-semibold text-primary text-right",children:s.products})]})]})]})]})]}),p.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(se,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Spending Trend (Last 12 Months)"})]}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(Et,{data:p,children:[e.jsx(Fe,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Te,{dataKey:"month",stroke:"#6B5A4C",style:{fontSize:"12px"}}),e.jsx(Le,{stroke:"#6B5A4C",style:{fontSize:"12px"},tickFormatter:d=>`â‚¹${d}`}),e.jsx(ye,{contentStyle:{backgroundColor:"#fff",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},formatter:d=>[`â‚¹${d.toFixed(0)}`,"Spending"]}),e.jsx($e,{type:"monotone",dataKey:"amount",stroke:"#8B9A7E",strokeWidth:3,dot:{fill:"#8B9A7E",r:4},activeDot:{r:6}})]})})]})]})}function fn({vendorId:s}){const[n,x]=i.useState([]),[p,o]=i.useState([]),[r,m]=i.useState("all");i.useEffect(()=>{d()},[s]),i.useEffect(()=>{b()},[n,r]);const d=async()=>{try{const{data:a,error:N}=await C.from("vendor_transactions").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(N)throw N;x(a||[])}catch(a){console.error("Error fetching transactions:",a)}},b=()=>{o(r==="all"?n:n.filter(a=>a.status===r))},u=p.reduce((a,N)=>a+parseFloat(N.amount),0),t=p.filter(a=>a.status==="paid").reduce((a,N)=>a+parseFloat(N.amount),0),c=p.filter(a=>a.status==="pending").reduce((a,N)=>a+parseFloat(N.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Bs,{className:"w-5 h-5 text-dark-brown/60"}),e.jsxs("select",{value:r,onChange:a=>m(a.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Transactions"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Transaction"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Transactions"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",u.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[p.length," transactions"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",t.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[p.filter(a=>a.status==="paid").length," transactions"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",c.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[p.filter(a=>a.status==="pending").length," transactions"]})]})]}),e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:p.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Payment Mode"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Invoice #"})]})}),e.jsx("tbody",{children:p.map((a,N)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${N%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:new Date(a.date).toLocaleDateString()})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${a.transaction_type==="expense"?"bg-accent/10 text-accent":"bg-sage/10 text-sage"}`,children:a.transaction_type})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:a.description||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4 text-sage"}),e.jsxs("span",{className:"text-sm font-bold text-sage",children:["â‚¹",parseFloat(a.amount).toFixed(2)]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:a.payment_mode||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${a.status==="paid"?"bg-sage/10 text-sage":"bg-soft-red/10 text-soft-red"}`,children:a.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:a.invoice_number||"-"})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(qe,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No transactions found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Start by adding your first transaction"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Transaction"})]})})]})}function gn({vendorId:s}){const[n,x]=i.useState([]);i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:t,error:c}=await C.from("vendor_invoices").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(c)throw c;x(t||[])}catch(t){console.error("Error fetching invoices:",t)}},o=t=>{switch(t){case"paid":return e.jsx(Q,{className:"w-5 h-5 text-sage"});case"overdue":return e.jsx(fe,{className:"w-5 h-5 text-soft-red"});default:return e.jsx(de,{className:"w-5 h-5 text-accent"})}},r=t=>{switch(t){case"paid":return"bg-sage/10 text-sage";case"overdue":return"bg-soft-red/10 text-soft-red";default:return"bg-accent/10 text-accent"}},m=n.reduce((t,c)=>t+parseFloat(c.amount),0),d=n.filter(t=>t.status==="paid").reduce((t,c)=>t+parseFloat(c.amount),0),b=n.filter(t=>t.status==="pending").reduce((t,c)=>t+parseFloat(c.amount),0),u=n.filter(t=>t.status==="overdue").reduce((t,c)=>t+parseFloat(c.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Invoice Management"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Upload Invoice"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Invoices"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",m.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.length," invoices"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",d.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.filter(t=>t.status==="paid").length," invoices"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",b.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.filter(t=>t.status==="pending").length," invoices"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Overdue"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",u.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.filter(t=>t.status==="overdue").length," invoices"]})]})]}),e.jsx("div",{className:"space-y-4",children:n.length>0?n.map(t=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ae,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary",children:["Invoice #",t.invoice_number]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Date: ",new Date(t.date).toLocaleDateString()," | Due: ",new Date(t.due_date).toLocaleDateString()]})]})]}),t.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2",children:t.notes})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",parseFloat(t.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o(t.status),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${r(t.status)}`,children:t.status})]}),t.status!=="paid"&&e.jsx("button",{className:"px-4 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg font-semibold transition-colors",children:"Mark as Paid"})]})]}),t.paid_date&&e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Paid on: ",new Date(t.paid_date).toLocaleDateString()," | Amount: â‚¹",parseFloat(t.paid_amount).toFixed(2)]})})]},t.id)):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No invoices found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Upload your first invoice to get started"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Invoice"})]})})]})}function jn({vendorId:s}){const[n,x]=i.useState([]);i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:o,error:r}=await C.from("vendor_prices").select("*").eq("vendor_id",s).order("product_name");if(r)throw r;x(o||[])}catch(o){console.error("Error fetching prices:",o)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Price List"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Price Item"]})]}),n.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Product/Service"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Unit"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Price"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"MOQ"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Lead Time"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Last Updated"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((o,r)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${r%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:o.product_name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-semibold",children:o.category||"General"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:o.unit})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-lg font-bold text-sage",children:["â‚¹",parseFloat(o.price).toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:o.moq||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:o.lead_time?`${o.lead_time} days`:"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/60",children:new Date(o.updated_at).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-primary/10 text-primary rounded-lg transition-colors",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-accent/10 text-accent rounded-lg transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]})})]},o.id))})]})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ne,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No price items found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add price items to track vendor pricing"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Price Item"})]})]})}const Ds=[{id:"contracts",label:"Contracts & Agreements",icon:"ðŸ“„"},{id:"gst",label:"GST Certificate",icon:"ðŸ“œ"},{id:"certifications",label:"Quality Certifications",icon:"ðŸ†"},{id:"catalogs",label:"Product Catalogs",icon:"ðŸ“‹"},{id:"reports",label:"Test Reports",icon:"ðŸ“Š"},{id:"other",label:"Other Documents",icon:"ðŸ’¼"}];function yn({vendorId:s}){const[n,x]=i.useState([]),[p,o]=i.useState("all");i.useEffect(()=>{r()},[s]);const r=async()=>{try{const{data:u,error:t}=await C.from("vendor_documents").select("*").eq("vendor_id",s).order("uploaded_at",{ascending:!1});if(t)throw t;x(u||[])}catch(u){console.error("Error fetching documents:",u)}},m=p==="all"?n:n.filter(u=>u.category===p),d=u=>Ds.find(t=>t.id===u)||{icon:"ðŸ“„",label:u},b=u=>u<1024?u+" B":u<1024*1024?(u/1024).toFixed(1)+" KB":(u/(1024*1024)).toFixed(1)+" MB";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Documents"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-5 h-5"}),"Upload Document"]})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>o("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${p==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",n.length,")"]}),Ds.map(u=>{const t=n.filter(c=>c.category===u.id).length;return e.jsxs("button",{onClick:()=>o(u.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${p===u.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:u.icon}),u.label," (",t,")"]},u.id)})]}),m.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(u=>{const t=d(u.category);return e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl flex-shrink-0",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:u.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:t.label})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60 mb-3",children:[e.jsx("span",{children:b(u.file_size||0)}),e.jsx("span",{children:new Date(u.uploaded_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]})]},u.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:p==="all"?"Upload documents to keep vendor information organized":`No ${d(p).label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Document"})]})]})}const Dt=[{id:"quality",label:"Product Quality"},{id:"delivery",label:"Delivery Time"},{id:"pricing",label:"Pricing"},{id:"service",label:"Customer Service"},{id:"reliability",label:"Reliability"}];function wn({vendorId:s,vendorRating:n}){const{user:x}=H(),[p,o]=i.useState([]),[r,m]=i.useState([]),[d,b]=i.useState(""),[u,t]=i.useState(!1),[c,a]=i.useState(null),[N,y]=i.useState({category:"quality",rating:5,text:""});i.useEffect(()=>{f(),_()},[s]);const f=async()=>{try{const{data:P,error:E}=await C.from("vendor_notes").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(E)throw E;o(P||[])}catch(P){console.error("Error fetching notes:",P)}},_=async()=>{try{const{data:P,error:E}=await C.from("vendor_reviews").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(E)throw E;m(P||[])}catch(P){console.error("Error fetching reviews:",P)}},v=async()=>{if(d.trim())try{const{error:P}=await C.from("vendor_notes").insert([{vendor_id:s,note_text:d,written_by:x?.id}]);if(P)throw P;b(""),f()}catch(P){console.error("Error adding note:",P),alert("Error adding note")}},w=async()=>{if(!N.text.trim()){alert("Please write a review");return}try{const{error:P}=await C.from("vendor_reviews").insert([{vendor_id:s,category:N.category,rating:N.rating,review_text:N.text,reviewed_by:x?.id}]);if(P)throw P;y({category:"quality",rating:5,text:""}),t(!1),_()}catch(P){console.error("Error adding review:",P),alert("Error adding review")}},j=async()=>{if(!c||!c.review_text.trim()){alert("Please write a review");return}try{const{error:P}=await C.from("vendor_reviews").update({category:c.category,rating:c.rating,review_text:c.review_text}).eq("id",c.id);if(P)throw P;a(null),_()}catch(P){console.error("Error updating review:",P),alert("Error updating review")}},h=async P=>{if(confirm("Are you sure you want to delete this review?"))try{const{error:E}=await C.from("vendor_reviews").delete().eq("id",P);if(E)throw E;_()}catch(E){console.error("Error deleting review:",E),alert("Error deleting review")}},l=P=>{a({...P}),t(!1)},k=()=>{a(null)},g=(P,E=!1,I)=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(q=>e.jsx("button",{type:"button",onClick:()=>E&&I&&I(q),disabled:!E,className:E?"cursor-pointer":"",children:e.jsx(Ze,{className:`w-5 h-5 ${q<=P?"fill-amber-400 text-amber-400":"text-dark-brown/20"} ${E?"hover:fill-amber-400 hover:text-amber-400":""}`})},q))}),D=P=>{const E=r.filter(I=>I.category===P);return E.length===0?0:E.reduce((I,q)=>I+q.rating,0)/E.length};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Internal Notes"})}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:[e.jsx("textarea",{value:d,onChange:P=>b(P.target.value),placeholder:"Add a note about this vendor...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none mb-3"}),e.jsxs("button",{onClick:v,disabled:!d.trim(),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all disabled:opacity-50",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Note"]})]}),e.jsx("div",{className:"space-y-3",children:p.length>0?p.map(P=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Oe,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"User"}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[new Date(P.created_at).toLocaleDateString()," at"," ",new Date(P.created_at).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1 hover:bg-primary/10 text-primary rounded transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:P.note_text})]},P.id)):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(qt,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No notes yet"})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Ratings & Reviews"}),e.jsxs("button",{onClick:()=>{t(!u),a(null)},className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Review"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-amber-600/10 rounded-xl p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-5xl font-bold text-amber-600 mb-2",children:n?.toFixed(1)||"0.0"}),g(n||0),e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-2",children:["Based on ",r.length," reviews"]})]}),e.jsx("div",{className:"space-y-2",children:Dt.map(P=>{const E=D(P.id);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:P.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[g(E),e.jsx("span",{className:"text-sm text-dark-brown/60 w-8",children:E>0?E.toFixed(1):"-"})]})]},P.id)})})]}),u&&e.jsx("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:N.category,onChange:P=>y({...N,category:P.target.value}),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:Dt.map(P=>e.jsx("option",{value:P.id,children:P.label},P.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),g(N.rating,!0,P=>y({...N,rating:P}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Review"}),e.jsx("textarea",{value:N.text,onChange:P=>y({...N,text:P.target.value}),placeholder:"Write your review...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(!1),className:"flex-1 px-4 py-2 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:w,className:"flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-amber-600 text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Submit Review"})]})]})}),e.jsx("div",{className:"space-y-3",children:r.length>0?r.map(P=>{const E=Dt.find(q=>q.id===P.category);return c?.id===P.id?e.jsx("div",{className:"bg-cream/50 rounded-xl p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:c.category,onChange:q=>a({...c,category:q.target.value}),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:Dt.map(q=>e.jsx("option",{value:q.id,children:q.label},q.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),g(c.rating,!0,q=>a({...c,rating:q}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Review"}),e.jsx("textarea",{value:c.review_text,onChange:q=>a({...c,review_text:q.target.value}),placeholder:"Write your review...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k,className:"flex-1 px-4 py-2 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:j,className:"flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-amber-600 text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Update Review"})]})]})},P.id):e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:E?.label})}),g(P.rating)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(P.created_at).toLocaleDateString()}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>l(P),className:"p-1 hover:bg-primary/10 text-primary rounded transition-colors",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>h(P.id),className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]})]})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:P.review_text})]},P.id)}):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Ze,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No reviews yet"})]})})]})]})})}const Nn=["Raw Materials","Packaging","Printing","Logistics","Lab Testing","Equipment","Other"],vn=["Immediate","7 days","15 days","30 days","45 days","60 days","Custom"];function kn({vendor:s,onClose:n,onSuccess:x}){H();const[p,o]=i.useState(!1),[r,m]=i.useState({name:s.name||"",category:s.category||"Raw Materials",products:s.products||"",contactPerson:s.contact_person||"",phone:s.phone||"",email:s.email||"",alternatePhone:s.alternate_phone||"",address:s.address||"",gstNumber:s.gst_number||"",website:s.website||"",paymentTerms:s.payment_terms||"30 days",bankName:s.bank_details?.bankName||"",accountNumber:s.bank_details?.accountNumber||"",ifscCode:s.bank_details?.ifscCode||"",currentRating:s.current_rating||3,notes:s.notes||""}),[d,b]=i.useState({iso:s.certifications?.includes("ISO Certified")||!1,organic:s.certifications?.includes("Organic Certified")||!1,fssai:s.certifications?.includes("FSSAI Approved")||!1,gmp:s.certifications?.includes("GMP Certified")||!1,other:s.certifications?.filter(t=>!["ISO Certified","Organic Certified","FSSAI Approved","GMP Certified"].includes(t)).join(", ")||""}),u=async t=>{if(t.preventDefault(),!r.name||!r.phone){alert("Please fill in required fields (Name and Phone)");return}o(!0);try{const c=r.bankName?{bankName:r.bankName,accountNumber:r.accountNumber,ifscCode:r.ifscCode}:{},a=[];d.iso&&a.push("ISO Certified"),d.organic&&a.push("Organic Certified"),d.fssai&&a.push("FSSAI Approved"),d.gmp&&a.push("GMP Certified"),d.other&&a.push(d.other);const{error:N}=await C.from("vendors").update({name:r.name,category:r.category,products:r.products,contact_person:r.contactPerson,phone:r.phone,email:r.email,alternate_phone:r.alternatePhone,address:r.address,gst_number:r.gstNumber,website:r.website,payment_terms:r.paymentTerms,bank_details:c,certifications:a,current_rating:r.currentRating,notes:r.notes}).eq("id",s.id);if(N)throw N;x()}catch(c){console.error("Error updating vendor:",c),alert("Error updating vendor. Please try again.")}finally{o(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Edit Vendor"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:r.name,onChange:t=>m({...r,name:t.target.value}),placeholder:"e.g., Green Valley Herbs",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:r.category,onChange:t=>m({...r,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Nn.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:r.contactPerson,onChange:t=>m({...r,contactPerson:t.target.value}),placeholder:"Contact person name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Products/Services"}),e.jsx("textarea",{value:r.products,onChange:t=>m({...r,products:t.target.value}),placeholder:"What does this vendor supply? e.g., Organic herbs, essential oils",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Contact Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Phone Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"tel",value:r.phone,onChange:t=>m({...r,phone:t.target.value}),placeholder:"+91-XXXXXXXXXX",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email"}),e.jsx("input",{type:"email",value:r.email,onChange:t=>m({...r,email:t.target.value}),placeholder:"vendor@example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Alternative Phone"}),e.jsx("input",{type:"tel",value:r.alternatePhone,onChange:t=>m({...r,alternatePhone:t.target.value}),placeholder:"Optional second number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Website"}),e.jsx("input",{type:"url",value:r.website,onChange:t=>m({...r,website:t.target.value}),placeholder:"https://example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Address"}),e.jsx("textarea",{value:r.address,onChange:t=>m({...r,address:t.target.value}),placeholder:"Street, city, state, pincode",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Business Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"GST Number"}),e.jsx("input",{type:"text",value:r.gstNumber,onChange:t=>m({...r,gstNumber:t.target.value}),placeholder:"22AAAAA0000A1Z5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Terms"}),e.jsx("select",{value:r.paymentTerms,onChange:t=>m({...r,paymentTerms:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:vn.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bank Name"}),e.jsx("input",{type:"text",value:r.bankName,onChange:t=>m({...r,bankName:t.target.value}),placeholder:"e.g., HDFC Bank",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:r.accountNumber,onChange:t=>m({...r,accountNumber:t.target.value}),placeholder:"Account number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"IFSC Code"}),e.jsx("input",{type:"text",value:r.ifscCode,onChange:t=>m({...r,ifscCode:t.target.value}),placeholder:"e.g., HDFC0001234",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality & Rating"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Current Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>m({...r,currentRating:t}),className:"focus:outline-none",children:e.jsx(Ze,{className:`w-8 h-8 transition-colors ${t<=r.currentRating?"fill-amber-400 text-amber-400":"text-dark-brown/20 hover:text-amber-400"}`})},t)),e.jsxs("span",{className:"ml-2 text-sm font-semibold text-dark-brown",children:[r.currentRating," / 5"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Quality Certifications"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.iso,onChange:t=>b({...d,iso:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"ISO Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.organic,onChange:t=>b({...d,organic:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Organic Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.fssai,onChange:t=>b({...d,fssai:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"FSSAI Approved"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.gmp,onChange:t=>b({...d,gmp:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"GMP Certified"})]}),e.jsx("input",{type:"text",value:d.other,onChange:t=>b({...d,other:t.target.value}),placeholder:"Other certifications (comma separated)",className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Internal Notes"}),e.jsx("textarea",{value:r.notes,onChange:t=>m({...r,notes:t.target.value}),placeholder:"Any internal notes about this vendor (not visible to vendor)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:p,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:p?"Updating...":"Update Vendor"})]})]})})}const _n=[{id:"overview",label:"Overview",icon:ht},{id:"transactions",label:"Transactions",icon:pt},{id:"invoices",label:"Invoices",icon:Pt},{id:"prices",label:"Price List",icon:gt},{id:"documents",label:"Documents",icon:ae},{id:"notes",label:"Notes & Reviews",icon:qt}],Cn=s=>({"Raw Materials":"bg-sage/20",Packaging:"bg-secondary/20",Printing:"bg-blue-500/20",Logistics:"bg-accent/20","Lab Testing":"bg-purple-500/20",Other:"bg-dark-brown/20"})[s]||"bg-dark-brown/10";function Sn(){const{id:s}=Je(),n=ce(),{user:x}=H(),[p,o]=i.useState(null),[r,m]=i.useState("overview"),[d,b]=i.useState(!0),[u,t]=i.useState(!1);i.useEffect(()=>{s&&c()},[s]);const c=async()=>{try{const{data:y,error:f}=await C.from("vendors").select("*").eq("id",s).maybeSingle();if(f)throw f;o(y)}catch(y){console.error("Error fetching vendor:",y)}finally{b(!1)}},a=async()=>{if(confirm("Are you sure you want to delete this vendor? This action cannot be undone."))try{const{error:y}=await C.from("vendors").delete().eq("id",s);if(y)throw y;n("/vendors")}catch(y){console.error("Error deleting vendor:",y),alert("Error deleting vendor")}},N=y=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(f=>e.jsx(Ze,{className:`w-5 h-5 ${f<=y?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},f))});return d?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading vendor details..."})]})})}):p?e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/vendors"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Vendors"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start gap-4 mb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-2",children:p.name}),e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${Cn(p.category)} rounded-full text-sm font-semibold`,children:p.category})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[N(p.current_rating||3),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown/60",children:[p.current_rating?.toFixed(1)||"3.0"," / 5.0"]})]})]}),x?.role==="admin"&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(le,{className:"w-4 h-4"}),"Delete"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:_n.map(y=>{const f=y.icon;return e.jsxs("button",{onClick:()=>m(y.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${r===y.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(f,{className:"w-5 h-5"}),y.label]},y.id)})})}),e.jsxs("div",{className:"p-6",children:[r==="overview"&&e.jsx(un,{vendor:p,onUpdate:c}),r==="transactions"&&e.jsx(fn,{vendorId:p.id}),r==="invoices"&&e.jsx(gn,{vendorId:p.id}),r==="prices"&&e.jsx(jn,{vendorId:p.id}),r==="documents"&&e.jsx(yn,{vendorId:p.id}),r==="notes"&&e.jsx(wn,{vendorId:p.id,vendorRating:p.current_rating})]})]})]}),u&&p&&e.jsx(kn,{vendor:p,onClose:()=>t(!1),onSuccess:()=>{t(!1),c()}})]}):e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Vendor not found"}),e.jsx("button",{onClick:()=>n("/vendors"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Vendors"})]})})})}function Dn({products:s,onClose:n,onSuccess:x}){const{user:p}=H(),[o,r]=i.useState(!1),[m,d]=i.useState(null),[b,u]=i.useState({batchNumber:"",manufacturingDate:R(new Date,"yyyy-MM-dd"),batchSize:"",expiryDate:"",storageLocation:"",qcNotes:""}),[t,c]=i.useState([]),[a,N]=i.useState({ingredientsVerified:!1,formulaFollowed:!1,phTestPassed:!1,visualInspectionPassed:!1,packagingChecked:!1,labelsApplied:!1,batchApproved:!1});i.useEffect(()=>{m&&(y(),f(),_())},[m]);const y=()=>{const l=R(new Date,"yyyyMMdd"),k=m?.name?.substring(0,3).toUpperCase()||"PRD",g="001";u(D=>({...D,batchNumber:`BT-${k}-${l}-${g}`}))},f=()=>{const l=m?.shelf_life||24,k=Es(new Date(b.manufacturingDate),l);u(g=>({...g,expiryDate:R(k,"yyyy-MM-dd")}))},_=async()=>{if(m?.id)try{const{data:l,error:k}=await C.from("product_ingredients").select("*").eq("product_id",m.id);if(k)throw k;l&&l.length>0?c(l.map(g=>({name:g.ingredient_name,lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:g.quantity||"",unit:g.unit||"kg"}))):c([])}catch(l){console.error("Error loading ingredients:",l)}},v=()=>{c([...t,{name:"",lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:"",unit:"kg"}])},w=l=>{c(t.filter((k,g)=>g!==l))},j=(l,k,g)=>{const D=[...t];D[l]={...D[l],[k]:g},c(D)},h=async l=>{if(l.preventDefault(),!m||!b.batchNumber||!b.batchSize){alert("Please fill in all required fields");return}r(!0);try{const{data:k,error:g}=await C.from("batches").insert([{batch_number:b.batchNumber,product_id:m.id,manufacturing_date:b.manufacturingDate,expiry_date:b.expiryDate,batch_size:parseInt(b.batchSize),units_in_stock:parseInt(b.batchSize),storage_location:b.storageLocation,qc_checklist:a,qc_notes:b.qcNotes,qc_approved:a.batchApproved,status:"active",created_by:p?.id}]).select().single();if(g)throw g;if(t.length>0&&k){const D=t.filter(P=>P.name).map(P=>({batch_id:k.id,ingredient_name:P.name,lot_number:P.lotNumber,supplier_batch_number:P.supplierBatchNumber,vendor_id:P.vendorId,ingredient_expiry_date:P.ingredientExpiryDate||null,quantity_used:P.quantityUsed?parseFloat(P.quantityUsed):null,unit:P.unit}));if(D.length>0){const{error:P}=await C.from("batch_ingredients").insert(D);if(P)throw P}}x()}catch(k){console.error("Error creating batch:",k),alert("Error creating batch. Please try again.")}finally{r(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Create New Batch"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:m?.id||"",onChange:l=>{const k=s.find(g=>g.id===l.target.value);d(k)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select a product"}),s.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:b.batchNumber,onChange:l=>u({...b,batchNumber:l.target.value}),placeholder:"BT-PRD-20241215-001",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Size (units) ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"number",value:b.batchSize,onChange:l=>u({...b,batchSize:l.target.value}),placeholder:"500",required:!0,min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Manufacturing Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:b.manufacturingDate,onChange:l=>{u({...b,manufacturingDate:l.target.value}),m&&f()},max:R(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:b.expiryDate,onChange:l=>u({...b,expiryDate:l.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:b.storageLocation,onChange:l=>u({...b,storageLocation:l.target.value}),placeholder:"e.g., Section A, Shelf 3",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Ingredients Used (Lot Tracking)"}),e.jsxs("button",{type:"button",onClick:v,className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Ingredient"]})]}),t.length>0?e.jsx("div",{className:"space-y-4",children:t.map((l,k)=>e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Ingredient #",k+1]}),e.jsx("button",{type:"button",onClick:()=>w(k),className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Name"}),e.jsx("input",{type:"text",value:l.name,onChange:g=>j(k,"name",g.target.value),placeholder:"e.g., Ashwagandha Powder",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Lot Number"}),e.jsx("input",{type:"text",value:l.lotNumber,onChange:g=>j(k,"lotNumber",g.target.value),placeholder:"Internal lot number",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Supplier Batch Number"}),e.jsx("input",{type:"text",value:l.supplierBatchNumber,onChange:g=>j(k,"supplierBatchNumber",g.target.value),placeholder:"Supplier's batch",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Quantity Used"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:l.quantityUsed,onChange:g=>j(k,"quantityUsed",g.target.value),placeholder:"Amount",step:"0.01",className:"flex-1 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:l.unit,onChange:g=>j(k,"unit",g.target.value),className:"px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"l",children:"l"}),e.jsx("option",{value:"ml",children:"ml"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Expiry Date"}),e.jsx("input",{type:"date",value:l.ingredientExpiryDate,onChange:g=>j(k,"ingredientExpiryDate",g.target.value),className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]},k))}):e.jsx("p",{className:"text-sm text-dark-brown/60 text-center py-4",children:"No ingredients added yet. Add ingredients to enable full traceability."})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality Control"}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.ingredientsVerified,onChange:l=>N({...a,ingredientsVerified:l.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"All ingredients verified"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.formulaFollowed,onChange:l=>N({...a,formulaFollowed:l.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Formula followed correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.phTestPassed,onChange:l=>N({...a,phTestPassed:l.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"pH test passed (if applicable)"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.visualInspectionPassed,onChange:l=>N({...a,visualInspectionPassed:l.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Visual inspection passed"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.packagingChecked,onChange:l=>N({...a,packagingChecked:l.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Packaging quality checked"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.labelsApplied,onChange:l=>N({...a,labelsApplied:l.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Labels applied correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.batchApproved,onChange:l=>N({...a,batchApproved:l.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Batch approved for distribution"})]}),e.jsxs("div",{className:"pt-3 border-t border-dark-brown/10",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC Notes"}),e.jsx("textarea",{value:b.qcNotes,onChange:l=>u({...b,qcNotes:l.target.value}),placeholder:"Any additional quality control notes...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:o,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:o?"Creating...":"Create Batch"})]})]})})}function Mn(){const[s,n]=i.useState([]),[x,p]=i.useState([]),[o,r]=i.useState([]),[m,d]=i.useState(""),[b,u]=i.useState("all"),[t,c]=i.useState(!1),[a,N]=i.useState({activeBatches:0,totalUnits:0,expiringSoon:0,productsWithBatches:0});i.useEffect(()=>{y(),f()},[]),i.useEffect(()=>{_(),v()},[s,m,b]);const y=async()=>{try{const{data:l,error:k}=await C.from("batches").select("*, products(name, images)").order("created_at",{ascending:!1});if(k)throw k;n(l||[])}catch(l){console.error("Error fetching batches:",l)}},f=async()=>{try{const{data:l,error:k}=await C.from("products").select("id, name, images").order("name");if(k)throw k;r(l||[])}catch(l){console.error("Error fetching products:",l)}},_=()=>{let l=s;if(b!=="all"&&(l=l.filter(k=>k.status===b)),m){const k=m.toLowerCase();l=l.filter(g=>g.batch_number?.toLowerCase().includes(k)||g.products?.name?.toLowerCase().includes(k))}p(l)},v=()=>{const l=new Date,k=s.filter(E=>E.status==="active").length,g=s.reduce((E,I)=>E+(I.units_in_stock||0),0),D=s.filter(E=>{const I=X(new Date(E.expiry_date),l);return I<=30&&I>=0}).length,P=new Set(s.map(E=>E.product_id)).size;N({activeBatches:k,totalUnits:g,expiringSoon:D,productsWithBatches:P})},w=l=>{const k=X(new Date(l),new Date);return k<0||k<=15?"text-soft-red":k<=30?"text-accent":k<=60?"text-amber-500":"text-sage"},j=l=>{const k=X(new Date(l.expiry_date),new Date);return l.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:k<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:l.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:k<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:l.units_in_stock<l.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:l.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}},h=l=>l.units_in_stock/l.batch_size*100;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(J,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Batch & Lot Tracking"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Complete traceability for manufacturing"})]}),e.jsxs(ue,{onClick:()=>c(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"New Batch"]})]})]}),e.jsxs(ue,{onClick:()=>c(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"New Batch"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(Q,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:a.activeBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active Batches"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(ne,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:a.totalUnits})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Units in Stock"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(he,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:`text-3xl font-bold ${a.expiringSoon>0?"text-accent":"text-primary/40"}`,children:a.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring Soon (30d)"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-blue-500/20 rounded-button",children:e.jsx(de,{className:"w-6 h-6 text-blue-500"})}),e.jsx("span",{className:"text-3xl font-bold text-blue-500",children:a.productsWithBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Products with Batches"})]})]}),e.jsx(J,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:()=>u("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${b==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All Batches (",s.length,")"]}),e.jsxs("button",{onClick:()=>u("active"),className:`px-4 py-2 rounded-button font-bold transition-all ${b==="active"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Active (",s.filter(l=>l.status==="active").length,")"]}),e.jsxs("button",{onClick:()=>u("sold_out"),className:`px-4 py-2 rounded-button font-bold transition-all ${b==="sold_out"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Sold Out (",s.filter(l=>l.status==="sold_out").length,")"]})]}),e.jsxs("div",{className:"relative w-full lg:w-64",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:m,onChange:l=>d(l.target.value),placeholder:"Search batches...",className:"input-float w-full pl-12"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(l=>{const k=j(l),g=h(l),D=X(new Date(l.expiry_date),new Date);return e.jsx(Ne,{to:`/batches/${l.id}`,className:"block",children:e.jsx(J,{className:"hover:shadow-glow transition-all duration-300 group h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${k.color}`,children:[e.jsx("span",{className:"mr-1",children:k.icon}),k.label]})}),e.jsx("h3",{className:"font-mono text-lg font-bold text-primary group-hover:text-accent transition-colors mb-1",children:l.batch_number}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:l.products?.name||"Unknown Product"})]}),e.jsx(Gs,{className:"w-8 h-8 text-dark-brown/20 group-hover:text-primary transition-colors"})]}),l.products?.images&&l.products.images[0]&&e.jsx("div",{className:"w-full h-32 mb-4 rounded-lg overflow-hidden bg-cream",children:e.jsx("img",{src:l.products.images[0],alt:l.products.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Manufacturing"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(new Date(l.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Expiry"}),e.jsxs("span",{className:`font-semibold ${w(l.expiry_date)}`,children:[R(new Date(l.expiry_date),"MMM dd, yyyy"),e.jsxs("span",{className:"text-xs ml-1",children:["(",D>=0?`${D}d left`:"Expired",")"]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Stock Status"}),e.jsxs("span",{className:"font-bold text-primary",children:[l.units_in_stock," / ",l.batch_size," units"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${g>50?"bg-sage":g>20?"bg-amber-500":"bg-soft-red"}`,style:{width:`${g}%`}})})]}),l.qc_approved&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-sage",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold",children:"QC Approved"})]})]})})},l.id)})}),x.length===0&&e.jsxs(J,{className:"text-center py-16",children:[e.jsx(ne,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No batches found"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:m?"Try adjusting your search":"Create your first batch to start tracking"}),!m&&e.jsx(ue,{onClick:()=>c(!0),variant:"primary",size:"lg",children:"Create Batch"})]})]}),t&&e.jsx(Dn,{products:o,onClose:()=>c(!1),onSuccess:()=>{c(!1),y()}})]})}function Pn({batch:s}){const[n,x]=i.useState([]);i.useEffect(()=>{p()},[s.id]);const p=async()=>{try{const{data:m,error:d}=await C.from("batch_ingredients").select("*, vendors(name)").eq("batch_id",s.id);if(d)throw d;x(m||[])}catch(m){console.error("Error fetching ingredients:",m)}},o=X(new Date(s.expiry_date),new Date),r=s.units_in_stock/s.batch_size*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ne,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Batch Number"}),e.jsx("p",{className:"font-mono font-bold text-dark-brown",children:s.batch_number})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ“…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(s.manufacturing_date),"MMMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"â°"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(s.expiry_date),"MMMM dd, yyyy")}),e.jsx("p",{className:`text-xs mt-1 font-semibold ${o<0?"text-soft-red":o<=30?"text-accent":o<=60?"text-amber-500":"text-sage"}`,children:o>=0?`${o} days remaining`:"Expired"})]})]}),s.storage_location&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ws,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Storage Location"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.storage_location})]})]}),s.qc_approved&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-sage/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"w-5 h-5 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Quality Control"}),e.jsx("p",{className:"font-semibold text-sage",children:"Approved"}),s.qc_approved_date&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["on ",R(new Date(s.qc_approved_date),"MMM dd, yyyy")]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Produced"}),e.jsx("p",{className:"text-3xl font-bold",children:s.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_in_stock})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Sold"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_sold||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_damaged||0})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Remaining"}),e.jsxs("span",{className:"font-bold",children:[r.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all",style:{width:`${r}%`}})})]})]}),s.products&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Product Details"}),e.jsxs("div",{className:"flex items-start gap-4",children:[s.products.images&&s.products.images[0]&&e.jsx("img",{src:s.products.images[0],alt:s.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:s.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",s.batch_number]})]})]})]})]})]}),n.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Ingredient Traceability"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"Complete ingredient lot tracking for full traceability"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Supplier Batch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity Used"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry"})]})}),e.jsx("tbody",{children:n.map((m,d)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${d%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:m.ingredient_name}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:m.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:m.supplier_batch_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:m.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:m.quantity_used?`${m.quantity_used} ${m.unit}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:m.ingredient_expiry_date?R(new Date(m.ingredient_expiry_date),"MMM dd, yyyy"):"-"})]},m.id))})]})})]})]})}function En({batchId:s,batch:n}){const[x,p]=i.useState([]);i.useEffect(()=>{o()},[s]);const o=async()=>{try{const{data:d,error:b}=await C.from("batch_tests").select("*").eq("batch_id",s).order("test_date",{ascending:!1});if(b)throw b;p(d||[])}catch(d){console.error("Error fetching tests:",d)}},r=n.qc_checklist||{},m=[{key:"ingredientsVerified",label:"All ingredients verified"},{key:"formulaFollowed",label:"Formula followed correctly"},{key:"phTestPassed",label:"pH test passed"},{key:"visualInspectionPassed",label:"Visual inspection passed"},{key:"packagingChecked",label:"Packaging quality checked"},{key:"labelsApplied",label:"Labels applied correctly"},{key:"batchApproved",label:"Batch approved for distribution"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"QC Checklist"}),n.qc_approved&&e.jsxs("span",{className:"flex items-center gap-2 px-3 py-1 bg-sage/10 text-sage rounded-full text-sm font-bold",children:[e.jsx(Q,{className:"w-4 h-4"}),"Approved"]})]}),e.jsx("div",{className:"space-y-3",children:m.map(d=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[r[d.key]?e.jsx(Q,{className:"w-5 h-5 text-sage flex-shrink-0"}):e.jsx(Me,{className:"w-5 h-5 text-dark-brown/20 flex-shrink-0"}),e.jsx("span",{className:`text-sm font-semibold ${r[d.key]?"text-dark-brown":"text-dark-brown/40"}`,children:d.label})]},d.key))}),n.qc_notes&&e.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-2",children:"QC Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:n.qc_notes})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Test Results"}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Test"]})]}),x.length>0?e.jsx("div",{className:"space-y-3",children:x.map(d=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:d.test_type}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${d.result.toLowerCase().includes("pass")?"bg-sage/10 text-sage":d.result.toLowerCase().includes("fail")?"bg-soft-red/10 text-soft-red":"bg-accent/10 text-accent"}`,children:d.result})]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Tested on: ",new Date(d.test_date).toLocaleDateString()]}),d.notes&&e.jsx("p",{className:"text-sm text-dark-brown mt-2",children:d.notes})]},d.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No test results recorded"})]})]})})]})})}function An({batchId:s,batch:n,onUpdate:x}){const[p,o]=i.useState([]),[r,m]=i.useState([]);i.useEffect(()=>{d(),b()},[s]);const d=async()=>{try{const{data:u,error:t}=await C.from("batch_dispatches").select("*").eq("batch_id",s).order("dispatch_date",{ascending:!1});if(t)throw t;o(u||[])}catch(u){console.error("Error fetching dispatches:",u)}},b=async()=>{try{const{data:u,error:t}=await C.from("batch_stock_adjustments").select("*").eq("batch_id",s).order("adjustment_date",{ascending:!1});if(t)throw t;m(u||[])}catch(u){console.error("Error fetching adjustments:",u)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Units"}),e.jsx("p",{className:"text-3xl font-bold",children:n.batch_size})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:n.units_in_stock})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Sold/Dispatched"}),e.jsx("p",{className:"text-3xl font-bold text-blue-500",children:n.units_sold||0})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:n.units_damaged||0})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Dispatch History"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-4 h-4"}),"Record Dispatch"]})]}),p.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Dispatch To"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Invoice #"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"})]})}),e.jsx("tbody",{children:p.map((u,t)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${t%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:R(new Date(u.dispatch_date),"MMM dd, yyyy")})]})}),e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:u.dispatch_to}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[u.quantity," units"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70 font-mono",children:u.invoice_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:u.dispatch_method||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${u.status==="delivered"?"bg-sage/10 text-sage":"bg-accent/10 text-accent"}`,children:u.status})})]},u.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"No dispatches recorded"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Record First Dispatch"})]})]}),r.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Adjustments"}),e.jsx("div",{className:"space-y-3",children:r.map(u=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-soft-red/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(we,{className:"w-5 h-5 text-soft-red"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown capitalize",children:u.adjustment_type}),e.jsxs("span",{className:"font-bold text-soft-red",children:["-",u.quantity," units"]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-1",children:u.reason}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:R(new Date(u.adjustment_date),"MMM dd, yyyy")}),u.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2 italic",children:u.notes})]})]},u.id))})]})]})}const Yt=[{id:"product",label:"Product Photos",icon:"ðŸ“¦"},{id:"packaging",label:"Packaging Photos",icon:"ðŸ“¦"},{id:"label",label:"Label Photos",icon:"ðŸ·ï¸"},{id:"qc",label:"QC Photos",icon:"âœ…"},{id:"process",label:"Process Photos",icon:"âš™ï¸"}];function In({batchId:s}){const[n,x]=i.useState([]),[p,o]=i.useState("all");i.useEffect(()=>{r()},[s]);const r=async()=>{try{const{data:d,error:b}=await C.from("batch_photos").select("*").eq("batch_id",s).order("uploaded_at",{ascending:!1});if(b)throw b;x(d||[])}catch(d){console.error("Error fetching photos:",d)}},m=p==="all"?n:n.filter(d=>d.category===p);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>o("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${p==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Photos (",n.length,")"]}),Yt.map(d=>{const b=n.filter(u=>u.category===d.id).length;return e.jsxs("button",{onClick:()=>o(d.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${p===d.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:d.icon}),d.label," (",b,")"]},d.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-4 h-4"}),"Upload Photos"]})]}),m.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:m.map(d=>{const b=Yt.find(u=>u.id===d.category);return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all group",children:[e.jsxs("div",{className:"aspect-square bg-cream relative",children:[e.jsx("img",{src:d.photo_url,alt:b?.label||"Batch photo",className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}),e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 bg-white/90 backdrop-blur-sm rounded-lg text-xs font-semibold",children:[b?.icon," ",b?.label]})]}),e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(d.uploaded_at).toLocaleDateString()})})]},d.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ns,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No photos uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:p==="all"?"Upload photos to document this batch":`No ${Yt.find(d=>d.id===p)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Photo"})]})]})}const Fn={batch_created:"ðŸŽ‰",status_changed:"ðŸ”„",dispatch:"ðŸ“¤",stock_adjustment:"ðŸ“Š",qc_approved:"âœ…",test_added:"ðŸ§ª",photo_uploaded:"ðŸ“¸",ingredient_added:"ðŸŒ¿"},Tn={batch_created:"bg-sage/10 text-sage",status_changed:"bg-blue-500/10 text-blue-500",dispatch:"bg-accent/10 text-accent",stock_adjustment:"bg-soft-red/10 text-soft-red",qc_approved:"bg-sage/10 text-sage",test_added:"bg-purple-500/10 text-purple-500",photo_uploaded:"bg-blue-500/10 text-blue-500",ingredient_added:"bg-primary/10 text-primary"};function Ln({batchId:s}){const[n,x]=i.useState([]),[p,o]=i.useState(!0);i.useEffect(()=>{r()},[s]);const r=async()=>{try{const{data:m,error:d}=await C.from("batch_activity_log").select("*").eq("batch_id",s).order("created_at",{ascending:!1});if(d)throw d;x(m||[])}catch(m){console.error("Error fetching activities:",m)}finally{o(!1)}};return p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading activity log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-sage/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Xt,{className:"w-6 h-6 text-primary"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Complete Traceability Log"})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"Full audit trail of all activities and changes for this batch. Every action is logged for compliance and quality assurance."})]}),n.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-dark-brown/10"}),e.jsx("div",{className:"space-y-6",children:n.map((m,d)=>{const b=Fn[m.activity_type]||"ðŸ“",u=Tn[m.activity_type]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:`absolute left-4 w-8 h-8 rounded-full ${u} flex items-center justify-center text-lg z-10`,children:b}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-1",children:m.activity_description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsxs("span",{children:[R(new Date(m.created_at),"MMM dd, yyyy")," at"," ",R(new Date(m.created_at),"HH:mm")]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${u}`,children:m.activity_type.replace("_"," ")})]}),m.details&&Object.keys(m.details).length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/5",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(m.details).map(([t,c])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1 capitalize",children:t.replace(/_/g," ")}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:typeof c=="object"?JSON.stringify(c):String(c)})]},t))})})]})]},m.id)})})]}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Xt,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity will be logged automatically as actions are performed on this batch"})]})]})}const $n=[{id:"overview",label:"Overview",icon:ht},{id:"quality",label:"Quality & Testing",icon:Xs},{id:"inventory",label:"Inventory & Distribution",icon:ne},{id:"photos",label:"Photos & Documents",icon:Ia},{id:"traceability",label:"Traceability Log",icon:Xt}];function qn(){const{id:s}=Je(),n=ce(),[x,p]=i.useState(null),[o,r]=i.useState("overview"),[m,d]=i.useState(!0);i.useEffect(()=>{s&&b()},[s]);const b=async()=>{try{const{data:a,error:N}=await C.from("batches").select("*, products(name, images)").eq("id",s).maybeSingle();if(N)throw N;p(a)}catch(a){console.error("Error fetching batch:",a)}finally{d(!1)}},u=async()=>{if(confirm("Are you sure you want to delete this batch? This action cannot be undone."))try{const{error:a}=await C.from("batches").delete().eq("id",s);if(a)throw a;n("/batches")}catch(a){console.error("Error deleting batch:",a),alert("Error deleting batch")}},t=()=>{if(!x)return null;const a=X(new Date(x.expiry_date),new Date);return x.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:a<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:x.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:a<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:x.units_in_stock<x.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:x.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}};if(m)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading batch details..."})]})})});if(!x)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Batch not found"}),e.jsx("button",{onClick:()=>n("/batches"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Batches"})]})})});const c=t();return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/batches"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Batches"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[x.products?.images&&x.products.images[0]&&e.jsx("img",{src:x.products.images[0],alt:x.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-mono text-3xl font-bold text-primary mb-2",children:x.batch_number}),e.jsx("p",{className:"text-lg font-semibold text-dark-brown",children:x.products?.name||"Unknown Product"}),c&&e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 mt-2 ${c.color} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:c.icon}),c.label]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Gs,{className:"w-4 h-4"}),"QR Code"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Oa,{className:"w-4 h-4"}),"Print Labels"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),x.status!=="recalled"&&e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(Da,{className:"w-4 h-4"}),"Recall"]}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(le,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(x.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(x.expiry_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Units"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:x.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"In Stock"}),e.jsx("p",{className:"font-semibold text-sage",children:x.units_in_stock})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:$n.map(a=>{const N=a.icon;return e.jsxs("button",{onClick:()=>r(a.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${o===a.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(N,{className:"w-5 h-5"}),a.label]},a.id)})})}),e.jsxs("div",{className:"p-6",children:[o==="overview"&&e.jsx(Pn,{batch:x,onUpdate:b}),o==="quality"&&e.jsx(En,{batchId:x.id,batch:x}),o==="inventory"&&e.jsx(An,{batchId:x.id,batch:x,onUpdate:b}),o==="photos"&&e.jsx(In,{batchId:x.id}),o==="traceability"&&e.jsx(Ln,{batchId:x.id})]})]})]})})}function Rn({vendors:s,onClose:n,onSuccess:x}){const{user:p}=H(),[o,r]=i.useState(!1),[m,d]=i.useState([]),[b,u]=i.useState(!1),[t,c]=i.useState(null),[a,N]=i.useState({ingredientId:"",purchaseDate:R(new Date,"yyyy-MM-dd"),quantity:"",expiryDate:"",lotNumber:"",vendorId:"",costPerUnit:"",invoiceNumber:"",storageLocation:"",notes:""}),[y,f]=i.useState({commonName:"",botanicalName:"",type:"herb",category:"raw_material",defaultUnit:"kg",typicalShelfLifeMonths:"24",reorderLevel:"",preferredVendorId:"",storageConditions:""});i.useEffect(()=>{_()},[]),i.useEffect(()=>{if(t){const j=t.typical_shelf_life_months||24,h=Es(new Date(a.purchaseDate),j);N(l=>({...l,expiryDate:R(h,"yyyy-MM-dd")}))}},[t,a.purchaseDate]);const _=async()=>{try{const{data:j,error:h}=await C.from("ingredients").select("*").order("common_name");if(h)throw h;d(j||[])}catch(j){console.error("Error fetching ingredients:",j)}},v=async()=>{if(!y.commonName)return alert("Please enter ingredient name"),null;try{const{data:j,error:h}=await C.from("ingredients").insert([{common_name:y.commonName,botanical_name:y.botanicalName,type:y.type,category:y.category,default_unit:y.defaultUnit,typical_shelf_life_months:parseInt(y.typicalShelfLifeMonths),reorder_level:y.reorderLevel?parseFloat(y.reorderLevel):0,preferred_vendor_id:y.preferredVendorId||null,storage_conditions:y.storageConditions}]).select().single();if(h)throw h;return j}catch(j){return console.error("Error creating ingredient:",j),alert("Error creating ingredient"),null}},w=async j=>{j.preventDefault();let h=a.ingredientId;if(b){const l=await v();if(!l)return;h=l.id}if(!h||!a.quantity||!a.purchaseDate||!a.expiryDate){alert("Please fill in all required fields");return}r(!0);try{const l=parseFloat(a.quantity),k=t?.default_unit||y.defaultUnit,{error:g}=await C.from("ingredient_stock").insert([{ingredient_id:h,purchase_date:a.purchaseDate,expiry_date:a.expiryDate,quantity:l,original_quantity:l,unit:k,lot_number:a.lotNumber,vendor_id:a.vendorId||null,cost_per_unit:a.costPerUnit?parseFloat(a.costPerUnit):null,invoice_number:a.invoiceNumber,storage_location:a.storageLocation,status:"active",notes:a.notes,purchased_by:p?.id}]);if(g)throw g;x()}catch(l){console.error("Error adding stock:",l),alert("Error adding stock. Please try again.")}finally{r(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:b?"Add New Ingredient & Stock":"Add Ingredient Stock"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:w,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[b?e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"New Ingredient Details"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"text-sm text-dark-brown/60 hover:text-dark-brown",children:"Cancel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Common Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:y.commonName,onChange:j=>f({...y,commonName:j.target.value}),placeholder:"e.g., Ashwagandha Powder",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical/Scientific Name"}),e.jsx("input",{type:"text",value:y.botanicalName,onChange:j=>f({...y,botanicalName:j.target.value}),placeholder:"e.g., Withania somnifera",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:y.type,onChange:j=>f({...y,type:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"herb",children:"Herb"}),e.jsx("option",{value:"oil",children:"Oil"}),e.jsx("option",{value:"powder",children:"Powder"}),e.jsx("option",{value:"extract",children:"Extract"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"fragrance",children:"Fragrance"}),e.jsx("option",{value:"active",children:"Active Ingredient"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:y.category,onChange:j=>f({...y,category:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"raw_material",children:"Raw Material"}),e.jsx("option",{value:"active_ingredient",children:"Active Ingredient"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"packaging",children:"Packaging"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Default Unit ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:y.defaultUnit,onChange:j=>f({...y,defaultUnit:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"kg",children:"kg (Kilograms)"}),e.jsx("option",{value:"g",children:"g (Grams)"}),e.jsx("option",{value:"L",children:"L (Liters)"}),e.jsx("option",{value:"ml",children:"ml (Milliliters)"}),e.jsx("option",{value:"pieces",children:"Pieces"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Typical Shelf Life (months)"}),e.jsx("input",{type:"number",value:y.typicalShelfLifeMonths,onChange:j=>f({...y,typicalShelfLifeMonths:j.target.value}),min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Reorder Level"}),e.jsx("input",{type:"number",value:y.reorderLevel,onChange:j=>f({...y,reorderLevel:j.target.value}),placeholder:"Minimum stock threshold",step:"0.01",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Preferred Vendor"}),e.jsxs("select",{value:y.preferredVendorId,onChange:j=>f({...y,preferredVendorId:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("textarea",{value:y.storageConditions,onChange:j=>f({...y,storageConditions:j.target.value}),placeholder:"e.g., Store in cool, dry place away from direct sunlight",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Select Ingredient ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("button",{type:"button",onClick:()=>u(!0),className:"text-sm text-primary font-semibold hover:underline",children:"+ Or add new ingredient"})]}),e.jsxs("select",{value:a.ingredientId,onChange:j=>{N({...a,ingredientId:j.target.value});const h=m.find(l=>l.id===j.target.value);c(h)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select an ingredient"}),m.map(j=>e.jsxs("option",{value:j.id,children:[j.common_name," ",j.botanical_name&&`(${j.botanical_name})`]},j.id))]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Purchase Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purchase Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.purchaseDate,onChange:j=>N({...a,purchaseDate:j.target.value}),max:R(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Quantity Purchased ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:a.quantity,onChange:j=>N({...a,quantity:j.target.value}),placeholder:"Amount",step:"0.01",min:"0",required:!0,className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("div",{className:"px-4 py-3 bg-dark-brown/5 rounded-xl font-semibold text-dark-brown flex items-center",children:t?.default_unit||y.defaultUnit})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.expiryDate,onChange:j=>N({...a,expiryDate:j.target.value}),min:a.purchaseDate,required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Lot/Batch Number"}),e.jsx("input",{type:"text",value:a.lotNumber,onChange:j=>N({...a,lotNumber:j.target.value}),placeholder:"Supplier's lot number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:a.vendorId,onChange:j=>N({...a,vendorId:j.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit"}),e.jsx("input",{type:"number",value:a.costPerUnit,onChange:j=>N({...a,costPerUnit:j.target.value}),placeholder:"â‚¹ per unit",step:"0.01",min:"0",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Invoice Number"}),e.jsx("input",{type:"text",value:a.invoiceNumber,onChange:j=>N({...a,invoiceNumber:j.target.value}),placeholder:"Purchase invoice number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:a.storageLocation,onChange:j=>N({...a,storageLocation:j.target.value}),placeholder:"e.g., Section B, Shelf 5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:j=>N({...a,notes:j.target.value}),placeholder:"Quality observations, storage instructions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:o,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:o?"Adding...":"Add to Inventory"})]})]})})}function Un(){const[s,n]=i.useState([]),[x,p]=i.useState([]),[o,r]=i.useState([]),[m,d]=i.useState(""),[b,u]=i.useState("list"),[t,c]=i.useState("all"),[a,N]=i.useState(!1),[y,f]=i.useState({expired:0,expiring15d:0,expiring30d:0,lowStock:0,reorderNeeded:0});i.useEffect(()=>{_(),v()},[]),i.useEffect(()=>{w(),j()},[s,m,t]);const _=async()=>{try{const{data:g,error:D}=await C.from("ingredient_inventory_summary").select("*").order("common_name");if(D)throw D;n(g||[])}catch(g){console.error("Error fetching ingredients:",g)}},v=async()=>{try{const{data:g,error:D}=await C.from("vendors").select("id, name").order("name");if(D)throw D;r(g||[])}catch(g){console.error("Error fetching vendors:",g)}},w=()=>{let g=s;if(t!=="all"&&(g=g.filter(D=>D.inventory_status===t)),m){const D=m.toLowerCase();g=g.filter(P=>P.common_name?.toLowerCase().includes(D)||P.botanical_name?.toLowerCase().includes(D)||P.type?.toLowerCase().includes(D))}p(g)},j=()=>{const g=new Date,D=s.filter(O=>O.earliest_expiry?X(new Date(O.earliest_expiry),g)<0:!1).length,P=s.filter(O=>{if(!O.earliest_expiry)return!1;const Y=X(new Date(O.earliest_expiry),g);return Y>=0&&Y<15}).length,E=s.filter(O=>{if(!O.earliest_expiry)return!1;const Y=X(new Date(O.earliest_expiry),g);return Y>=15&&Y<30}).length,I=s.filter(O=>O.inventory_status==="low_stock").length,q=s.filter(O=>O.total_stock<O.reorder_level&&O.reorder_level>0).length;f({expired:D,expiring15d:P,expiring30d:E,lowStock:I,reorderNeeded:q})},h=g=>{if(!g)return"text-dark-brown/40";const D=X(new Date(g),new Date);return D<0||D<=15?"text-soft-red":D<=30?"text-accent":D<=60?"text-amber-500":"text-sage"},l=g=>{const D={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return D[g]||D.good_stock},k=g=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[g.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(J,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Ingredient Inventory"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Track stock levels, expiry dates, and reorder alerts"})]}),e.jsxs(ue,{onClick:()=>N(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Stock"]})]})]}),e.jsxs(ue,{onClick:()=>N(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Add Ingredient Stock"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx("button",{onClick:()=>c("expired"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="expired"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”´"}),e.jsx("span",{className:`text-3xl font-bold ${y.expired>0?"text-soft-red":"text-primary/20"}`,children:y.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})}),e.jsx("button",{onClick:()=>c("expiring_soon"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_soon"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ "}),e.jsx("span",{className:`text-3xl font-bold ${y.expiring15d>0?"text-soft-red":"text-primary/20"}`,children:y.expiring15d})]}),e.jsxs("p",{className:"text-sm font-bold text-primary/70",children:["Expiring ","<","15 days"]})]})}),e.jsx("button",{onClick:()=>c("expiring_30d"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_30d"?"ring-2 ring-amber-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¡"}),e.jsx("span",{className:`text-3xl font-bold ${y.expiring30d>0?"text-amber-500":"text-primary/20"}`,children:y.expiring30d})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring 15-30 days"})]})}),e.jsx("button",{onClick:()=>c("low_stock"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${t==="low_stock"?"ring-2 ring-blue-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”µ"}),e.jsx("span",{className:`text-3xl font-bold ${y.lowStock>0?"text-blue-500":"text-primary/20"}`,children:y.lowStock})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Low Stock"})]})}),e.jsx("button",{onClick:()=>c(y.reorderNeeded>0?"low_stock":"all"),className:"text-left",children:e.jsxs(J,{className:`hover:shadow-glow transition-all duration-300 ${y.reorderNeeded>0?"ring-2 ring-sage shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¢"}),e.jsx("span",{className:`text-3xl font-bold ${y.reorderNeeded>0?"text-sage":"text-primary/20"}`,children:y.reorderNeeded})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Reorder Needed"})]})})]}),e.jsx(J,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All (",s.length,")"]}),e.jsx("button",{onClick:()=>c("good_stock"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="good_stock"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:"Good Stock"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:m,onChange:g=>d(g.target.value),placeholder:"Search ingredients...",className:"input-float w-full pl-12"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-primary/5 rounded-button p-1",children:[e.jsx("button",{onClick:()=>u("list"),className:`p-2 rounded-button transition-all ${b==="list"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>u("grid"),className:`p-2 rounded-button transition-all ${b==="grid"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(Vs,{className:"w-5 h-5"})})]})]})]})}),b==="list"?e.jsxs(J,{className:"overflow-hidden p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Current Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Reorder Level"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Days Left"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:x.map((g,D)=>{const P=l(g.inventory_status),E=g.earliest_expiry?X(new Date(g.earliest_expiry),new Date):null;return e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${g.inventory_status==="expired"?"bg-soft-red/5":g.inventory_status==="expiring_soon"?"bg-accent/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[g.image_url?e.jsx("img",{src:g.image_url,alt:g.common_name,className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:g.common_name}),g.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:g.botanical_name})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${k(g.type)}`,children:g.type})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg text-primary",children:[g.total_stock||0," ",g.default_unit]}),g.active_lots>0&&e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[g.active_lots," active lots"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[g.reorder_level||0," ",g.default_unit]})}),e.jsx("td",{className:"px-4 py-3",children:g.earliest_expiry?e.jsx("p",{className:`font-semibold ${h(g.earliest_expiry)}`,children:R(new Date(g.earliest_expiry),"MMM dd, yyyy")}):e.jsx("p",{className:"text-dark-brown/40",children:"No stock"})}),e.jsx("td",{className:"px-4 py-3",children:E!==null?e.jsx("span",{className:`font-bold ${h(g.earliest_expiry)}`,children:E>=0?`${E}d`:"Expired"}):e.jsx("span",{className:"text-dark-brown/40",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${P.color}`,children:[e.jsx("span",{className:"mr-1",children:P.icon}),P.label]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(Ne,{to:`/ingredients/${g.ingredient_id}`,className:"px-4 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:"View Details"})})]},g.ingredient_id)})})]})}),x.length===0&&e.jsxs("div",{className:"text-center py-12 px-6",children:[e.jsx(ne,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No ingredients found"}),e.jsx("p",{className:"text-primary/60 mb-4 text-lg font-medium",children:m?"Try adjusting your search":"Add your first ingredient to start tracking"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(g=>{const D=l(g.inventory_status),P=g.earliest_expiry?X(new Date(g.earliest_expiry),new Date):null;return e.jsx(Ne,{to:`/ingredients/${g.ingredient_id}`,className:"block",children:e.jsx(J,{className:"hover:shadow-glow transition-all duration-300 h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[g.image_url?e.jsx("img",{src:g.image_url,alt:g.common_name,className:"w-16 h-16 rounded-lg object-cover"}):e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:g.common_name}),g.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:g.botanical_name})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Stock"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[g.total_stock||0," ",g.default_unit]})]}),g.earliest_expiry&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry"}),e.jsxs("p",{className:`font-semibold ${h(g.earliest_expiry)}`,children:[R(new Date(g.earliest_expiry),"MMM dd, yyyy"),P!==null&&e.jsxs("span",{className:"text-xs ml-2",children:["(",P>=0?`${P}d left`:"Expired",")"]})]})]}),e.jsx("div",{children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${D.color}`,children:[e.jsx("span",{className:"mr-1",children:D.icon}),D.label]})})]})]})})},g.ingredient_id)})})]}),a&&e.jsx(Rn,{vendors:o,onClose:()=>N(!1),onSuccess:()=>{N(!1),_()}})]})}function zn({ingredientId:s,ingredient:n,summary:x}){const[p,o]=i.useState([]);i.useEffect(()=>{r()},[s]);const r=async()=>{try{const{data:b,error:u}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).eq("status","active").order("expiry_date",{ascending:!0});if(u)throw u;o(b||[])}catch(b){console.error("Error fetching lots:",b)}},m=b=>{const u=X(new Date(b),new Date);return u<0||u<=15?"text-soft-red":u<=30?"text-accent":u<=60?"text-amber-500":"text-sage"},d=n.reorder_level>0?(x?.total_stock||0)/n.reorder_level*100:100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white/80 text-sm mb-2",children:"Total Quantity"}),e.jsx("p",{className:"text-5xl font-bold mb-1",children:x?.total_stock||0}),e.jsx("p",{className:"text-xl text-white/90",children:n.default_unit})]}),n.reorder_level>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Level"}),e.jsx("span",{className:"font-bold",children:d>=100?"Good":d>=50?"Low":"Critical"})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${d>=100?"bg-white":d>=50?"bg-amber-300":"bg-red-300"}`,style:{width:`${Math.min(d,100)}%`}})}),e.jsxs("p",{className:"text-white/70 text-xs mt-2",children:["Reorder level: ",n.reorder_level," ",n.default_unit]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Ingredient Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Type"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:n.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:n.category?.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Default Unit"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:n.default_unit})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Shelf Life"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[n.typical_shelf_life_months," months"]})]}),n.preferred_vendor_id&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Preferred Vendor"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:n.vendors?.name})]})]})]}),n.storage_conditions&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:n.storage_conditions})]})]})]}),x?.earliest_expiry&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Expiry Alert"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["Earliest lot expires on ",R(new Date(x.earliest_expiry),"MMMM dd, yyyy")," ","(",X(new Date(x.earliest_expiry),new Date)," days remaining)"]})]})]})}),p.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock by Lot/Batch"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Purchase Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Storage"})]})}),e.jsx("tbody",{children:p.map((b,u)=>{const t=X(new Date(b.expiry_date),new Date);return e.jsxs("tr",{className:`border-t border-dark-brown/5 ${u%2===0?"bg-white":"bg-cream/20"} ${t<15?"bg-soft-red/5":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown",children:b.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:R(new Date(b.purchase_date),"MMM dd, yyyy")}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:`font-semibold ${m(b.expiry_date)}`,children:R(new Date(b.expiry_date),"MMM dd, yyyy")}),e.jsx("p",{className:`text-xs ${m(b.expiry_date)}`,children:t>=0?`${t}d left`:"Expired"})]}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[b.quantity," ",b.unit]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:b.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:b.storage_location||"-"})]},b.id)})})]})})]})]})}function Bn({ingredientId:s,ingredient:n}){const[x,p]=i.useState([]),[o,r]=i.useState({totalPurchases:0,totalQuantity:0,totalSpent:0,avgCostPerUnit:0});i.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:b,error:u}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).order("purchase_date",{ascending:!1});if(u)throw u;p(b||[]);const t=b.length,c=b.reduce((y,f)=>y+(f.original_quantity||0),0),a=b.reduce((y,f)=>y+(f.cost_per_unit||0)*(f.original_quantity||0),0),N=a/(c||1);r({totalPurchases:t,totalQuantity:c,totalSpent:a,avgCostPerUnit:N})}catch(b){console.error("Error fetching purchases:",b)}},d=b=>({active:"bg-sage/10 text-sage",used:"bg-dark-brown/10 text-dark-brown",expired:"bg-soft-red/10 text-soft-red"})[b]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Purchases"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:o.totalPurchases})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Quantity"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[o.totalQuantity.toFixed(2)," ",n.default_unit]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",o.totalSpent.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Avg Cost/Unit"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",o.avgCostPerUnit.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Purchase Timeline"}),x.length>0?e.jsx("div",{className:"space-y-4",children:x.map(b=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(De,{className:"w-5 h-5 text-primary"}),e.jsx("h4",{className:"font-semibold text-dark-brown",children:R(new Date(b.purchase_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:b.vendors?.name||"Unknown Vendor"}),b.invoice_number&&e.jsxs("span",{className:"ml-2 text-dark-brown/60",children:["â€¢ Invoice: ",b.invoice_number]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${d(b.status)}`,children:b.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Quantity"}),e.jsxs("p",{className:"font-bold text-primary",children:[b.original_quantity," ",b.unit]}),b.status==="active"&&b.quantity<b.original_quantity&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[b.quantity," ",b.unit," remaining"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Cost/Unit"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:b.cost_per_unit?`â‚¹${b.cost_per_unit}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Cost"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:b.cost_per_unit?`â‚¹${(b.cost_per_unit*b.original_quantity).toFixed(2)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"text-sm text-dark-brown",children:R(new Date(b.expiry_date),"MMM dd, yyyy")})]})]}),b.lot_number&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-xs text-dark-brown/60",children:["Lot: ",e.jsx("span",{className:"font-mono text-dark-brown",children:b.lot_number})]})}),b.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:b.notes})})]},b.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ne,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No purchase history recorded"})]})]})]})}function On({ingredientId:s,ingredient:n}){const[x,p]=i.useState([]),[o,r]=i.useState([]),[m,d]=i.useState(0);i.useEffect(()=>{b(),u()},[s]);const b=async()=>{try{const{data:t,error:c}=await C.from("ingredient_usage").select("*, batches(batch_number), products(name)").eq("ingredient_id",s).order("usage_date",{ascending:!1});if(c)throw c;p(t||[]);const a=t.reduce((N,y)=>N+(y.quantity||0),0);d(a)}catch(t){console.error("Error fetching usage:",t)}},u=async()=>{try{const{data:t,error:c}=await C.from("product_ingredients").select("*, products(id, name, images)").eq("ingredient_name",n.common_name);if(c)throw c;r(t||[])}catch(t){console.error("Error fetching products:",t)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Used (Lifetime)"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[m.toFixed(2)," ",n.default_unit]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Usage Instances"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:x.length})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Used in Products"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:o.length})]})]}),o.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Products Using This Ingredient"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(t=>e.jsx(Ne,{to:`/products/${t.products.id}`,className:"p-4 bg-cream/50 rounded-lg hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.products.images&&t.products.images[0]?e.jsx("img",{src:t.products.images[0],alt:t.products.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(as,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:t.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[t.quantity," ",t.unit," per batch"]})]})]})},t.id))})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage History"}),x.length>0?e.jsx("div",{className:"space-y-3",children:x.map(t=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(De,{className:"w-4 h-4 text-dark-brown/60"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(new Date(t.usage_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 capitalize",children:["Used for: ",t.used_for?.replace("_"," ")]})]}),e.jsxs("span",{className:"font-bold text-primary text-lg",children:[t.quantity," ",n.default_unit]})]}),t.batches&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",e.jsx(Ne,{to:`/batches/${t.batch_id}`,className:"font-mono text-primary hover:underline",children:t.batches.batch_number})]})}),t.products&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Product: ",e.jsx("span",{className:"font-semibold text-dark-brown",children:t.products.name})]})}),t.notes&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70 italic",children:t.notes})})]},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ne,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No usage recorded yet"})]})]})]})}function Vn({ingredientId:s,ingredient:n}){const[x,p]=i.useState({turnoverRate:0,wasteQuantity:0,wasteCost:0,minPrice:0,maxPrice:0,avgPrice:0,currentPrice:0,totalUsed:0,totalPurchased:0});i.useEffect(()=>{o()},[s]);const o=async()=>{try{const[d,b]=await Promise.all([C.from("ingredient_stock").select("*").eq("ingredient_id",s),C.from("ingredient_usage").select("quantity").eq("ingredient_id",s)]);if(d.error)throw d.error;if(b.error)throw b.error;const u=d.data||[],t=b.data||[],c=u.filter(k=>k.status==="expired"),a=c.reduce((k,g)=>k+(g.quantity||0),0),N=c.reduce((k,g)=>k+(g.cost_per_unit||0)*(g.quantity||0),0),y=u.map(k=>k.cost_per_unit).filter(k=>k>0),f=y.length>0?Math.min(...y):0,_=y.length>0?Math.max(...y):0,v=y.length>0?y.reduce((k,g)=>k+g,0)/y.length:0,w=u.filter(k=>k.cost_per_unit>0).sort((k,g)=>new Date(g.purchase_date).getTime()-new Date(k.purchase_date).getTime()),j=w.length>0?w[0].cost_per_unit:0,h=t.reduce((k,g)=>k+(g.quantity||0),0),l=u.reduce((k,g)=>k+(g.original_quantity||0),0);p({turnoverRate:l>0?h/l*100:0,wasteQuantity:a,wasteCost:N,minPrice:f,maxPrice:_,avgPrice:v,currentPrice:j,totalUsed:h,totalPurchased:l})}catch(d){console.error("Error fetching analytics:",d)}},r=x.totalPurchased>0?x.wasteQuantity/x.totalPurchased*100:0,m=x.avgPrice>0?(x.currentPrice-x.avgPrice)/x.avgPrice*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Turnover Rate"}),e.jsx(se,{className:"w-5 h-5 text-primary"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[x.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Usage efficiency"})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Quantity"}),e.jsx(fe,{className:"w-5 h-5 text-soft-red"})]}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:[x.wasteQuantity.toFixed(2)," ",n.default_unit]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[r.toFixed(1),"% of total purchased"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Cost"}),e.jsx(qe,{className:"w-5 h-5 text-accent"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",x.wasteCost.toFixed(0)]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Lost value from expiry"})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Minimum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",x.minPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Maximum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",x.maxPrice.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Average Price"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",x.avgPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Price vs Average"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-2xl font-bold ${m>0?"text-soft-red":"text-sage"}`,children:[m>0?"+":"",m.toFixed(1),"%"]}),m>0?e.jsx(se,{className:"w-5 h-5 text-soft-red"}):e.jsx(we,{className:"w-5 h-5 text-sage"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["â‚¹",x.currentPrice.toFixed(2)," per unit"]})]})]})]})]}),r>10&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Waste Reduction Recommendations"}),e.jsxs("ul",{className:"space-y-2 text-sm text-dark-brown/70",children:[e.jsx("li",{children:"â€¢ Consider reducing purchase quantities to match usage rate"}),e.jsx("li",{children:"â€¢ Implement FIFO (First In, First Out) more strictly"}),e.jsx("li",{children:"â€¢ Review storage conditions to extend shelf life"}),e.jsxs("li",{children:["â€¢ Adjust reorder level to: ",(x.totalUsed/6).toFixed(2)," ",n.default_unit," (based on 6-month usage)"]})]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Purchased"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:x.totalPurchased.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:n.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Used"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:x.totalUsed.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:n.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Utilization Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:[x.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:"Used vs Purchased"})]})]})]})]})}const ct=[{id:"coa",label:"Quality Certificates (COA)",icon:Ye},{id:"organic_cert",label:"Organic Certifications",icon:Ye},{id:"test_report",label:"Test Reports",icon:as},{id:"msds",label:"MSDS (Safety Data Sheets)",icon:he},{id:"specification",label:"Vendor Specifications",icon:ae},{id:"photo",label:"Ingredient Photos",icon:zs}];function Hn({ingredientId:s}){const[n,x]=i.useState([]),[p,o]=i.useState("all");i.useEffect(()=>{r()},[s]);const r=async()=>{try{const{data:t,error:c}=await C.from("ingredient_documents").select("*").eq("ingredient_id",s).order("uploaded_at",{ascending:!1});if(c)throw c;x(t||[])}catch(t){console.error("Error fetching documents:",t)}},m=p==="all"?n:n.filter(t=>t.category===p),d=t=>{const c=ct.find(a=>a.id===t);return c?c.icon:ae},b=t=>t?X(new Date(t),new Date)<=30:!1,u=t=>t?X(new Date(t),new Date)<0:!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>o("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${p==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",n.length,")"]}),ct.map(t=>{const c=n.filter(a=>a.category===t.id).length;return e.jsxs("button",{onClick:()=>o(t.id),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${p===t.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[t.label.split(" ")[0]," (",c,")"]},t.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(G,{className:"w-4 h-4"}),"Upload Document"]})]}),m.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:m.map(t=>{const c=d(t.category),a=ct.find(N=>N.id===t.category);return e.jsx("div",{className:`bg-white border-2 rounded-xl p-4 hover:shadow-soft transition-all ${u(t.expiry_date)?"border-soft-red/20 bg-soft-red/5":b(t.expiry_date)?"border-accent/20 bg-accent/5":"border-dark-brown/5"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(c,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:t.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:a?.label})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(ke,{className:"w-4 h-4"}),"Download"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("span",{children:["Uploaded: ",R(new Date(t.uploaded_at),"MMM dd, yyyy")]}),t.expiry_date&&e.jsx("span",{className:`font-semibold ${u(t.expiry_date)?"text-soft-red":b(t.expiry_date)?"text-accent":"text-dark-brown"}`,children:u(t.expiry_date)?e.jsxs(e.Fragment,{children:["Expired: ",R(new Date(t.expiry_date),"MMM dd, yyyy")]}):e.jsxs(e.Fragment,{children:["Expires: ",R(new Date(t.expiry_date),"MMM dd, yyyy")]})})]}),(u(t.expiry_date)||b(t.expiry_date))&&e.jsxs("div",{className:`mt-2 flex items-center gap-2 text-sm font-semibold ${u(t.expiry_date)?"text-soft-red":"text-accent"}`,children:[e.jsx(he,{className:"w-4 h-4"}),u(t.expiry_date)?e.jsx("span",{children:"Certificate expired - renewal required"}):e.jsxs("span",{children:["Expiring in ",X(new Date(t.expiry_date),new Date)," days"]})]})]})]})},t.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:p==="all"?"Upload quality certificates, test reports, and other documents":`No ${ct.find(t=>t.id===p)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),n.some(t=>u(t.expiry_date)||b(t.expiry_date))&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Certificate Expiry Alerts"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-3",children:"Some certificates are expired or expiring soon. Ensure you have updated certifications."}),e.jsx("ul",{className:"space-y-1 text-sm text-dark-brown/70",children:n.filter(t=>u(t.expiry_date)||b(t.expiry_date)).map(t=>e.jsxs("li",{children:["â€¢ ",t.file_name," - ",u(t.expiry_date)?"Expired":"Expiring soon"]},t.id))})]})]})}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:ct.map(t=>{const c=t.icon,a=n.filter(N=>N.category===t.id).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(c,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:t.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[a," document",a!==1?"s":""]})]})]},t.id)})})]})]})}const Wn=[{id:"overview",label:"Overview & Stock",icon:ht},{id:"purchase",label:"Purchase History",icon:ne},{id:"usage",label:"Usage in Products",icon:as},{id:"analytics",label:"Analytics",icon:se},{id:"documents",label:"Documents",icon:ae}];function Gn(){const{id:s}=Je(),n=ce(),[x,p]=i.useState(null),[o,r]=i.useState(null),[m,d]=i.useState("overview"),[b,u]=i.useState(!0);i.useEffect(()=>{s&&(t(),c())},[s]);const t=async()=>{try{const{data:v,error:w}=await C.from("ingredients").select("*, vendors(name)").eq("id",s).maybeSingle();if(w)throw w;p(v)}catch(v){console.error("Error fetching ingredient:",v)}finally{u(!1)}},c=async()=>{try{const{data:v,error:w}=await C.from("ingredient_inventory_summary").select("*").eq("ingredient_id",s).maybeSingle();if(w)throw w;r(v)}catch(v){console.error("Error fetching summary:",v)}},a=async()=>{if(confirm("Are you sure you want to delete this ingredient? This action cannot be undone."))try{const{error:v}=await C.from("ingredients").delete().eq("id",s);if(v)throw v;n("/ingredients")}catch(v){console.error("Error deleting ingredient:",v),alert("Error deleting ingredient")}},N=()=>{if(!o)return null;const v={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return v[o.inventory_status]||v.good_stock},y=v=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[v?.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";if(b)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading ingredient details..."})]})})});if(!x)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Ingredient not found"}),e.jsx("button",{onClick:()=>n("/ingredients"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Ingredients"})]})})});const f=N(),_=o?.earliest_expiry?X(new Date(o.earliest_expiry),new Date):null;return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/ingredients"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Ingredients"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[x.image_url?e.jsx("img",{src:x.image_url,alt:x.common_name,className:"w-20 h-20 rounded-lg object-cover"}):e.jsx("div",{className:"w-20 h-20 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-10 h-10 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:x.common_name}),x.botanical_name&&e.jsx("p",{className:"text-lg italic text-dark-brown/70 mb-2",children:x.botanical_name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${y(x.type)}`,children:x.type}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-dark-brown/5 text-dark-brown capitalize",children:x.category?.replace("_"," ")}),f&&e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f.color}`,children:[e.jsx("span",{className:"mr-1",children:f.icon}),f.label]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Stock"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(le,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Stock"}),e.jsxs("p",{className:"font-bold text-2xl text-sage",children:[o?.total_stock||0," ",x.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Reorder Level"}),e.jsxs("p",{className:"font-semibold text-dark-brown",children:[x.reorder_level||0," ",x.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Active Lots"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:o?.active_lots||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold ${_===null?"text-dark-brown/40":_<0||_<=15?"text-soft-red":_<=30?"text-accent":"text-sage"}`,children:_!==null?_>=0?`${_} days`:"Expired":"No stock"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:Wn.map(v=>{const w=v.icon;return e.jsxs("button",{onClick:()=>d(v.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${m===v.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(w,{className:"w-5 h-5"}),v.label]},v.id)})})}),e.jsxs("div",{className:"p-6",children:[m==="overview"&&e.jsx(zn,{ingredientId:s,ingredient:x,summary:o,onUpdate:()=>{t(),c()}}),m==="purchase"&&e.jsx(Bn,{ingredientId:s,ingredient:x}),m==="usage"&&e.jsx(On,{ingredientId:s,ingredient:x}),m==="analytics"&&e.jsx(Vn,{ingredientId:s,ingredient:x}),m==="documents"&&e.jsx(Hn,{ingredientId:s})]})]})]})})}const Qn=[{value:"fssai",label:"FSSAI License"},{value:"ayush",label:"Ayush License"},{value:"gmp",label:"GMP Certification"},{value:"trade",label:"Trade License"},{value:"gst",label:"GST Registration"},{value:"organic",label:"Organic Certification"},{value:"pollution",label:"Pollution Control"},{value:"fire",label:"Fire Safety Certificate"},{value:"drug",label:"Drug License"},{value:"other",label:"Other"}];function Yn({onClose:s,onSuccess:n}){const{user:x}=H(),[p,o]=i.useState(!1),[r,m]=i.useState(!1),[d,b]=i.useState({licenseType:"fssai",licenseNumber:"",issuedTo:"",issuingAuthority:"",issueDate:"",expiryDate:"",renewalReminderDays:"30",scope:"",status:"active",notes:"",reminderEmail:!0,reminderPush:!0}),u=async t=>{if(t.preventDefault(),!d.licenseNumber||!d.issuedTo||!d.issuingAuthority||!d.issueDate){alert("Please fill in all required fields");return}if(!r&&!d.expiryDate){alert('Please provide an expiry date or check "No Expiry"');return}o(!0);try{const{error:c}=await C.from("licenses").insert([{license_type:d.licenseType,license_number:d.licenseNumber,issued_to:d.issuedTo,issuing_authority:d.issuingAuthority,issue_date:d.issueDate,expiry_date:r?null:d.expiryDate,renewal_reminder_days:parseInt(d.renewalReminderDays),scope:d.scope,status:d.status,notes:d.notes,reminder_email:d.reminderEmail,reminder_push:d.reminderPush,created_by:x?.id}]);if(c)throw c;n()}catch(c){console.error("Error adding license:",c),alert("Error adding license. Please try again.")}finally{o(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add License/Certificate"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:u,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:d.licenseType,onChange:t=>b({...d,licenseType:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Qn.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License/Certificate Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:d.licenseNumber,onChange:t=>b({...d,licenseNumber:t.target.value}),placeholder:"e.g., 12345678901234",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issued To ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:d.issuedTo,onChange:t=>b({...d,issuedTo:t.target.value}),placeholder:"Business name",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issuing Authority ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:d.issuingAuthority,onChange:t=>b({...d,issuingAuthority:t.target.value}),placeholder:"e.g., FSSAI, State Ayush Department",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issue Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:d.issueDate,onChange:t=>b({...d,issueDate:t.target.value}),max:R(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Expiry Date ",!r&&e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:t=>{m(t.target.checked),t.target.checked&&b({...d,expiryDate:""})},className:"w-4 h-4 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-xs text-dark-brown/70",children:"No Expiry"})]})]}),e.jsx("input",{type:"date",value:d.expiryDate,onChange:t=>b({...d,expiryDate:t.target.value}),min:d.issueDate,required:!r,disabled:r,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none disabled:bg-dark-brown/5 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Renewal Reminder (days before expiry)"}),e.jsx("input",{type:"number",value:d.renewalReminderDays,onChange:t=>b({...d,renewalReminderDays:t.target.value}),min:"1",max:"365",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Status ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:d.status,onChange:t=>b({...d,status:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending Application"}),e.jsx("option",{value:"renewal_in_process",children:"Renewal In Process"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Scope/Coverage"}),e.jsx("textarea",{value:d.scope,onChange:t=>b({...d,scope:t.target.value}),placeholder:"What this license covers (e.g., Manufacturing of Ayurvedic products)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:d.notes,onChange:t=>b({...d,notes:t.target.value}),placeholder:"Important information, conditions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2 bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.reminderEmail,onChange:t=>b({...d,reminderEmail:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email reminder"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.reminderPush,onChange:t=>b({...d,reminderPush:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push notification"})]})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:p,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:p?"Adding...":"Add License"})]})]})})}const Ms={fssai:{label:"FSSAI License",icon:"ðŸ´",color:"from-blue-500 to-blue-600"},ayush:{label:"Ayush License",icon:"ðŸŒ¿",color:"from-sage to-primary"},gmp:{label:"GMP Certification",icon:"âœ“",color:"from-primary to-accent"},trade:{label:"Trade License",icon:"ðŸª",color:"from-amber-500 to-amber-600"},gst:{label:"GST Registration",icon:"ðŸ’¼",color:"from-purple-500 to-purple-600"},organic:{label:"Organic Certification",icon:"ðŸŒ±",color:"from-green-500 to-green-600"},pollution:{label:"Pollution Control",icon:"ðŸ­",color:"from-teal-500 to-teal-600"},fire:{label:"Fire Safety",icon:"ðŸ”¥",color:"from-red-500 to-red-600"},drug:{label:"Drug License",icon:"ðŸ’Š",color:"from-pink-500 to-pink-600"},other:{label:"Other License",icon:"ðŸ“„",color:"from-dark-brown to-primary"}};function Kn(){const[s,n]=i.useState([]),[x,p]=i.useState(!1),[o,r]=i.useState({total:0,active:0,expiringSoon:0,expired:0,complianceScore:100});i.useEffect(()=>{m()},[]),i.useEffect(()=>{d()},[s]);const m=async()=>{try{const{data:a,error:N}=await C.from("license_summary").select("*").order("expiry_date",{ascending:!0,nullsFirst:!1});if(N)throw N;n(a||[])}catch(a){console.error("Error fetching licenses:",a)}},d=()=>{const a=s.length,N=s.filter(v=>v.expiry_status==="active"||v.expiry_status==="no_expiry").length,y=s.filter(v=>v.expiry_status==="expiring_soon"||v.expiry_status==="renewal_due"||v.expiry_status==="critical").length,f=s.filter(v=>v.expiry_status==="expired").length,_=a>0?Math.round((N+y)/a*100):100;r({total:a,active:N,expiringSoon:y,expired:f,complianceScore:_})},b=(a,N)=>{const y={active:{label:"Active",color:"bg-sage/10 text-sage",icon:Q},renewal_due:{label:"Renewal Due",color:"bg-amber-500/10 text-amber-500",icon:de},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:he},critical:{label:"Critical",color:"bg-soft-red/10 text-soft-red",icon:he},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:he},no_expiry:{label:"No Expiry",color:"bg-blue-500/10 text-blue-500",icon:Q}};return y[a]||y.active},u=()=>o.complianceScore===100?"text-sage":o.complianceScore>=80?"text-amber-500":"text-soft-red",t=()=>o.complianceScore===100?{label:"All Compliant",icon:"ðŸŸ¢"}:o.complianceScore>=80?{label:"Needs Attention",icon:"ðŸŸ¡"}:{label:"Critical Issues",icon:"ðŸ”´"},c=a=>Ms[a]||Ms.other;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(J,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Compliance & Certifications"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 md:gap-4",children:[e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Manage licenses and certifications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-primary/60 font-medium",children:"Status:"}),e.jsxs("span",{className:`font-bold text-lg ${u()}`,children:[t().icon," ",t().label," (",o.complianceScore,"%)"]})]})]})]}),e.jsxs(ue,{onClick:()=>p(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Add License"]})]})]}),e.jsxs(ue,{onClick:()=>p(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Add License/Certificate"]}),o.expiringSoon>0&&e.jsx(J,{className:"bg-accent/10 border-2 border-accent/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-accent flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-primary",children:[o.expiringSoon," license",o.expiringSoon!==1?"s":""," expiring in next 90 days - Review required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Initiate renewal process to maintain compliance"})]})]})}),o.expired>0&&e.jsx(J,{className:"bg-soft-red/10 border-2 border-soft-red/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-soft-red flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-soft-red",children:[o.expired," license",o.expired!==1?"s have":" has"," expired - Immediate action required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Operating without valid licenses may result in penalties and business disruption"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(ut,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:o.total})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Licenses"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(Q,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:o.active})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active & Valid"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(de,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-3xl font-bold text-accent",children:o.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Renewal Due Soon"})]}),e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-soft-red/20 rounded-button",children:e.jsx(he,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:"text-3xl font-bold text-soft-red",children:o.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})]}),s.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(a=>{const N=c(a.license_type),y=b(a.expiry_status,a.days_until_expiry),f=y.icon,_=a.total_checklist_items>0?Math.round(a.completed_checklist_items/a.total_checklist_items*100):100;return e.jsx(Ne,{to:`/compliance/${a.id}`,className:"block",children:e.jsxs(J,{className:"hover:shadow-glow transition-all duration-300 overflow-hidden p-0",children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${N.color}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-4xl",children:N.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:N.label}),e.jsx("p",{className:"text-xs text-dark-brown/60 font-mono",children:a.license_number})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Issued by:"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:a.issuing_authority})]}),a.expiry_date&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Expiry:"}),e.jsx("span",{className:`text-sm font-semibold ${a.expiry_status==="expired"||a.expiry_status==="critical"?"text-soft-red":a.expiry_status==="expiring_soon"?"text-accent":a.expiry_status==="renewal_due"?"text-amber-500":"text-sage"}`,children:R(new Date(a.expiry_date),"MMM dd, yyyy")})]}),a.days_until_expiry!==null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Days remaining:"}),e.jsx("span",{className:`text-lg font-bold ${a.days_until_expiry<0||a.days_until_expiry<=7?"text-soft-red":a.days_until_expiry<=30?"text-accent":a.days_until_expiry<=90?"text-amber-500":"text-sage"}`,children:a.days_until_expiry>=0?a.days_until_expiry:"Expired"})]})]}),a.total_checklist_items>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Compliance:"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[_,"%"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${_===100?"bg-sage":_>=80?"bg-amber-500":"bg-soft-red"}`,style:{width:`${_}%`}})})]})]}),e.jsx("div",{className:"pt-3 border-t border-dark-brown/10",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${y.color}`,children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-bold",children:y.label})]})})]})]})},a.id)})}):e.jsxs(J,{className:"p-16 text-center",children:[e.jsx(ae,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No licenses recorded yet"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:"Add your business licenses and certifications to track compliance"}),e.jsx(ue,{onClick:()=>p(!0),variant:"primary",size:"lg",children:"Add First License"})]})]}),x&&e.jsx(Yn,{onClose:()=>p(!1),onSuccess:()=>{p(!1),m()}})]})}function Zn({license:s}){const n=s.expiry_date?X(new Date(s.expiry_date),new Date):null,x=s.expiry_date?new Date(new Date(s.expiry_date).getTime()-s.renewal_reminder_days*24*60*60*1e3):null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"License Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issued To"}),e.jsx("p",{className:"font-semibold text-lg",children:s.issued_to})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"License Number"}),e.jsx("p",{className:"font-semibold text-lg font-mono",children:s.license_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold",children:s.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold",children:R(new Date(s.issue_date),"MMMM dd, yyyy")})]})]})]}),s.expiry_date&&e.jsx("div",{className:`rounded-xl p-6 ${n&&n<0?"bg-soft-red/10 border-2 border-soft-red/20":n&&n<=30?"bg-accent/10 border-2 border-accent/20":n&&n<=90?"bg-amber-500/10 border-2 border-amber-500/20":"bg-sage/10 border-2 border-sage/20"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${n&&n<0?"bg-soft-red/20":n&&n<=30?"bg-accent/20":n&&n<=90?"bg-amber-500/20":"bg-sage/20"}`,children:e.jsx(De,{className:`w-8 h-8 ${n&&n<0?"text-soft-red":n&&n<=30?"text-accent":n&&n<=90?"text-amber-500":"text-sage"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:n&&n<0?"License Expired":n&&n<=7?"License Expiring This Week":n&&n<=30?"License Expiring This Month":"License Renewal Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Expiry Date:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(new Date(s.expiry_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Days Until Expiry:"}),e.jsx("span",{className:`font-bold text-2xl ${n&&n<0?"text-soft-red":n&&n<=30?"text-accent":n&&n<=90?"text-amber-500":"text-sage"}`,children:n&&n>=0?n:"Expired"})]}),x&&n&&n>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Renewal Due By:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(x,"MMMM dd, yyyy")})]})]})]})]})}),s.scope&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Scope & Coverage"}),e.jsx("p",{className:"text-dark-brown/70",children:s.scope})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-4",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email Reminders"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_email?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_email?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push Notifications"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_push?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_push?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Reminder Period"})]}),e.jsxs("span",{className:"font-semibold text-dark-brown",children:[s.renewal_reminder_days," days before expiry"]})]})]})]}),s.notes&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("p",{className:"text-dark-brown/70 whitespace-pre-wrap",children:s.notes})]})]})}),s.last_inspection_date&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Inspection Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Last Inspection:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:R(new Date(s.last_inspection_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Inspections:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:s.inspection_count})]})]})]})]})}const Kt=[{value:"original",label:"Original License/Certificate"},{value:"renewal",label:"Renewal Documents"},{value:"application",label:"Application Forms"},{value:"receipt",label:"Payment Receipts"},{value:"correspondence",label:"Correspondence"},{value:"inspection",label:"Inspection Reports"},{value:"compliance",label:"Compliance Certificates"}];function Jn({licenseId:s}){const[n,x]=i.useState([]),[p,o]=i.useState("all");i.useEffect(()=>{r()},[s]);const r=async()=>{try{const{data:u,error:t}=await C.from("license_documents").select("*").eq("license_id",s).order("uploaded_at",{ascending:!1});if(t)throw t;x(u||[])}catch(u){console.error("Error fetching documents:",u)}},m=p==="all"?n:n.filter(u=>u.category===p),d=u=>{const t=Kt.find(c=>c.value===u);return t?t.label:u},b=u=>e.jsx(ae,{className:"w-6 h-6 text-primary"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>o("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${p==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All (",n.length,")"]}),Kt.map(u=>{const t=n.filter(c=>c.category===u.value).length;return t===0?null:e.jsxs("button",{onClick:()=>o(u.value),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${p===u.value?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[u.label.split(" ")[0]," (",t,")"]},u.value)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(G,{className:"w-4 h-4"}),"Upload Document"]})]}),m.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:m.map(u=>e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:b(u.category)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:u.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:d(u.category)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:e.jsxs("span",{children:["Uploaded: ",R(new Date(u.uploaded_at),"MMM dd, yyyy")]})})]})]})},u.id))}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:p==="all"?"Upload license documents, receipts, and correspondence":`No ${d(p).toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Kt.map(u=>{const t=n.filter(c=>c.category===u.value).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(ae,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:u.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[t," document",t!==1?"s":""]})]})]},u.value)})})]})]})}const Xn={fssai:["Display license at prominent location","Maintain hygiene standards","Source ingredients from licensed suppliers","Label products correctly (FSSAI logo, license number)","Maintain manufacturing records","Annual returns filed"],ayush:["Follow GMP guidelines","Use only approved ingredients","Maintain batch records","Quality control testing","Proper labeling (Ayush logo)"],gmp:["Maintain clean facility","Follow SOP (Standard Operating Procedures)","Staff training records","Equipment calibration","Documented processes"]};function el({licenseId:s,license:n,onUpdate:x}){const{user:p}=H(),[o,r]=i.useState([]),[m,d]=i.useState(!1),[b,u]=i.useState("");i.useEffect(()=>{t()},[s]);const t=async()=>{try{const{data:v,error:w}=await C.from("compliance_checklist").select("*").eq("license_id",s).order("created_at",{ascending:!0});if(w)throw w;if(!v||v.length===0){const j=Xn[n.license_type]||[];j.length>0&&await c(j)}else r(v)}catch(v){console.error("Error fetching checklist:",v)}},c=async v=>{try{const w=v.map(l=>({license_id:s,checklist_item:l,completed:!1})),{data:j,error:h}=await C.from("compliance_checklist").insert(w).select();if(h)throw h;r(j||[])}catch(w){console.error("Error initializing checklist:",w)}},a=async(v,w)=>{try{const{error:j}=await C.from("compliance_checklist").update({completed:!w,last_verified_date:w?null:new Date().toISOString().split("T")[0],verified_by:w?null:p?.id}).eq("id",v);if(j)throw j;await t(),x()}catch(j){console.error("Error updating checklist:",j)}},N=async()=>{if(b.trim())try{const{error:v}=await C.from("compliance_checklist").insert([{license_id:s,checklist_item:b,completed:!1}]);if(v)throw v;u(""),d(!1),await t(),x()}catch(v){console.error("Error adding checklist item:",v)}},y=o.filter(v=>v.completed).length,f=o.length,_=f>0?Math.round(y/f*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Compliance Score"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-5xl font-bold mb-2",children:[_,"%"]}),e.jsxs("p",{className:"text-white/80",children:[y," of ",f," items completed"]})]}),e.jsxs("div",{className:"w-32 h-32 relative",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"rgba(255,255,255,0.2)",strokeWidth:"12",fill:"none"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"white",strokeWidth:"12",fill:"none",strokeDasharray:`${_/100*351.86} 351.86`,strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(Q,{className:"w-12 h-12 text-white"})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Compliance Requirements"}),e.jsxs("button",{onClick:()=>d(!m),className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-lg font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Item"]})]}),m&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("input",{type:"text",value:b,onChange:v=>u(v.target.value),placeholder:"Enter new compliance requirement...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none mb-3",onKeyDown:v=>{v.key==="Enter"&&N()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 bg-primary text-white rounded-lg font-semibold hover:bg-primary/90 transition-colors",children:"Add"}),e.jsx("button",{onClick:()=>{d(!1),u("")},className:"px-4 py-2 bg-dark-brown/10 text-dark-brown rounded-lg font-semibold hover:bg-dark-brown/20 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-3",children:o.map(v=>e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${v.completed?"bg-sage/5 border-sage/20":"bg-white border-dark-brown/10"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>a(v.id,v.completed),className:"flex-shrink-0 mt-1",children:v.completed?e.jsx(Q,{className:"w-6 h-6 text-sage"}):e.jsx(Aa,{className:"w-6 h-6 text-dark-brown/30 hover:text-primary transition-colors"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold ${v.completed?"text-sage line-through":"text-dark-brown"}`,children:v.checklist_item}),v.completed&&v.last_verified_date&&e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-1",children:["Verified on ",R(new Date(v.last_verified_date),"MMM dd, yyyy")]}),v.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2 italic",children:v.notes}),v.proof_url&&e.jsxs("button",{className:"flex items-center gap-2 mt-2 text-sm text-primary hover:underline",children:[e.jsx(Be,{className:"w-4 h-4"}),"View proof"]})]})]})},v.id))}),o.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Q,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No compliance requirements added"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add compliance requirements specific to this license"}),e.jsx("button",{onClick:()=>d(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add First Requirement"})]}),_<100&&o.length>0&&e.jsxs("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Pending Items"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[f-y," compliance requirement",f-y!==1?"s":""," still need",f-y===1?"s":""," to be completed to achieve 100% compliance."]})]}),_===100&&o.length>0&&e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"w-8 h-8 text-sage"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sage text-lg",children:"100% Compliant"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"All compliance requirements have been met"})]})]})})]})}function tl({licenseId:s}){const[n,x]=i.useState([]),[p,o]=i.useState({totalRenewals:0,totalCost:0,avgCost:0,lastRenewalCost:0});i.useEffect(()=>{r()},[s]);const r=async()=>{try{const{data:m,error:d}=await C.from("license_renewals").select("*").eq("license_id",s).order("renewal_date",{ascending:!1});if(d)throw d;if(x(m||[]),m&&m.length>0){const b=m.length,u=m.reduce((a,N)=>a+(N.cost||0),0),t=u/b,c=m[0].cost||0;o({totalRenewals:b,totalCost:u,avgCost:t,lastRenewalCost:c})}}catch(m){console.error("Error fetching renewals:",m)}};return e.jsxs("div",{className:"space-y-6",children:[n.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Renewals"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:p.totalRenewals})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:["â‚¹",p.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Average Cost"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",p.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Last Renewal"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",p.lastRenewalCost.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Renewal Timeline"}),n.length>0?e.jsx("div",{className:"space-y-4",children:n.map((m,d)=>e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:"absolute -left-2 top-0 w-4 h-4 rounded-full bg-primary border-4 border-white"}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(de,{className:"w-5 h-5 text-primary"}),e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Renewal ",n.length-d]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:R(new Date(m.renewal_date),"MMMM dd, yyyy")})]}),m.cost&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",m.cost]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Previous Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:R(new Date(m.previous_expiry),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"New Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-sage",children:R(new Date(m.new_expiry),"MMM dd, yyyy")})]})]}),m.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:m.notes})}),m.certificate_url&&e.jsxs("button",{className:"mt-3 flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(ae,{className:"w-4 h-4"}),"View renewed certificate"]})]})]},m.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h4",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No renewal history"}),e.jsx("p",{className:"text-dark-brown/40",children:"Renewal records will appear here when the license is renewed"})]})]}),n.length>1&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Total Spent on Renewals"})]}),e.jsxs("span",{className:"font-bold text-lg text-primary",children:["â‚¹",p.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-sage"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Average Renewal Cost"})]}),e.jsxs("span",{className:"font-bold text-lg text-sage",children:["â‚¹",p.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Last Renewal Cost"})]}),e.jsxs("span",{className:`font-bold text-lg ${p.lastRenewalCost>p.avgCost?"text-soft-red":"text-sage"}`,children:["â‚¹",p.lastRenewalCost.toFixed(0),p.lastRenewalCost>p.avgCost&&e.jsxs("span",{className:"text-xs ml-2",children:["(+",((p.lastRenewalCost-p.avgCost)/p.avgCost*100).toFixed(0),"%)"]})]})]})]})]})]})}function sl({licenseId:s}){const[n,x]=i.useState([]),[p,o]=i.useState(!0);i.useEffect(()=>{r()},[s]);const r=async()=>{try{const m=[],[d,b,u,t,c]=await Promise.all([C.from("licenses").select("created_at, updated_at").eq("id",s).maybeSingle(),C.from("license_documents").select("file_name, uploaded_at, category").eq("license_id",s),C.from("license_renewals").select("renewal_date, new_expiry").eq("license_id",s),C.from("compliance_checklist").select("checklist_item, completed, last_verified_date").eq("license_id",s),C.from("inspections").select("inspection_date, compliance_status, authority").eq("license_id",s)]);d.data&&(m.push({type:"license_added",timestamp:d.data.created_at,description:"License added to system",icon:ae,color:"text-primary"}),d.data.updated_at!==d.data.created_at&&m.push({type:"license_updated",timestamp:d.data.updated_at,description:"License details updated",icon:ge,color:"text-blue-500"})),b.data&&b.data.forEach(a=>{m.push({type:"document_uploaded",timestamp:a.uploaded_at,description:`Document uploaded: ${a.file_name}`,details:`Category: ${a.category}`,icon:Be,color:"text-sage"})}),u.data&&u.data.forEach(a=>{m.push({type:"renewal_processed",timestamp:a.renewal_date,description:"License renewed",details:`New expiry: ${R(new Date(a.new_expiry),"MMM dd, yyyy")}`,icon:de,color:"text-accent"})}),t.data&&t.data.filter(a=>a.completed&&a.last_verified_date).forEach(a=>{m.push({type:"compliance_verified",timestamp:a.last_verified_date,description:"Compliance item verified",details:a.checklist_item,icon:Q,color:"text-sage"})}),c.data&&c.data.forEach(a=>{m.push({type:"inspection",timestamp:a.inspection_date,description:`Inspection by ${a.authority}`,details:`Result: ${a.compliance_status}`,icon:Re,color:a.compliance_status==="pass"?"text-sage":"text-accent"})}),m.sort((a,N)=>new Date(N.timestamp).getTime()-new Date(a.timestamp).getTime()),x(m)}catch(m){console.error("Error fetching audit log:",m)}finally{o(!1)}};return p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading audit log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-2",children:"Activity History"}),e.jsx("p",{className:"text-dark-brown/70",children:"Complete audit trail of all activities related to this license"})]}),n.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:e.jsx("div",{className:"space-y-4",children:n.map((m,d)=>{const b=m.icon;return e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:`absolute -left-3 top-0 w-6 h-6 rounded-full bg-white border-2 border-dark-brown/10 flex items-center justify-center ${m.color}`,children:e.jsx(b,{className:"w-3 h-3"})}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:m.description}),e.jsx("span",{className:"text-sm text-dark-brown/60",children:R(new Date(m.timestamp),"MMM dd, yyyy")})]}),m.details&&e.jsx("p",{className:"text-sm text-dark-brown/70",children:m.details}),e.jsx("p",{className:"text-xs text-dark-brown/50 mt-2",children:R(new Date(m.timestamp),"h:mm a")})]})]},d)})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ae,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity history will appear here as actions are performed"})]}),e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-6 h-6 text-sage flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Full Transparency"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"This audit log provides a complete history of all activities related to this license. All actions are timestamped and recorded for compliance and regulatory purposes."})]})]})})]})}const al=[{id:"details",label:"Details",icon:ae},{id:"documents",label:"Documents",icon:Fa},{id:"compliance",label:"Compliance Checklist",icon:rs},{id:"renewal",label:"Renewal History",icon:de},{id:"audit",label:"Audit Log",icon:ae}],Ps={fssai:{label:"FSSAI License",icon:"ðŸ´"},ayush:{label:"Ayush License",icon:"ðŸŒ¿"},gmp:{label:"GMP Certification",icon:"âœ“"},trade:{label:"Trade License",icon:"ðŸª"},gst:{label:"GST Registration",icon:"ðŸ’¼"},organic:{label:"Organic Certification",icon:"ðŸŒ±"},pollution:{label:"Pollution Control",icon:"ðŸ­"},fire:{label:"Fire Safety",icon:"ðŸ”¥"},drug:{label:"Drug License",icon:"ðŸ’Š"},other:{label:"Other License",icon:"ðŸ“„"}};function rl(){const{id:s}=Je(),n=ce(),[x,p]=i.useState(null),[o,r]=i.useState("details"),[m,d]=i.useState(!0);i.useEffect(()=>{s&&b()},[s]);const b=async()=>{try{const{data:f,error:_}=await C.from("license_summary").select("*").eq("id",s).maybeSingle();if(_)throw _;p(f)}catch(f){console.error("Error fetching license:",f)}finally{d(!1)}},u=async()=>{if(confirm("Are you sure you want to delete this license? This action cannot be undone."))try{const{error:f}=await C.from("licenses").delete().eq("id",s);if(f)throw f;n("/compliance")}catch(f){console.error("Error deleting license:",f),alert("Error deleting license")}},t=()=>{if(!x)return null;const f={active:{label:"Active",color:"bg-sage/10 text-sage"},pending:{label:"Pending Application",color:"bg-amber-500/10 text-amber-500"},renewal_in_process:{label:"Renewal In Process",color:"bg-blue-500/10 text-blue-500"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red"}};return f[x.status]||f.active},c=()=>{if(!x||!x.expiry_date)return"text-dark-brown";const f=X(new Date(x.expiry_date),new Date);return f<0||f<=7?"text-soft-red":f<=30?"text-accent":f<=90?"text-amber-500":"text-sage"};if(m)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading license details..."})]})})});if(!x)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"License not found"}),e.jsx("button",{onClick:()=>n("/compliance"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Compliance"})]})})});const a=Ps[x.license_type]||Ps.other,N=t(),y=x.expiry_date?X(new Date(x.expiry_date),new Date):null;return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/compliance"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(ze,{className:"w-5 h-5"}),"Back to Compliance"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsx("div",{className:"text-5xl",children:a.icon}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:a.label}),e.jsx("p",{className:"text-lg font-mono text-dark-brown/70 mb-2",children:x.license_number}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:N&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${N.color}`,children:N.label})})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(le,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:x.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:R(new Date(x.issue_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:`font-semibold ${c()}`,children:x.expiry_date?R(new Date(x.expiry_date),"MMM dd, yyyy"):"No Expiry"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold text-xl ${c()}`,children:y!==null?y>=0?`${y} days`:"Expired":"N/A"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:al.map(f=>{const _=f.icon;return e.jsxs("button",{onClick:()=>r(f.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${o===f.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(_,{className:"w-5 h-5"}),f.label]},f.id)})})}),e.jsxs("div",{className:"p-6",children:[o==="details"&&e.jsx(Zn,{licenseId:s,license:x,onUpdate:b}),o==="documents"&&e.jsx(Jn,{licenseId:s}),o==="compliance"&&e.jsx(el,{licenseId:s,license:x,onUpdate:b}),o==="renewal"&&e.jsx(tl,{licenseId:s,license:x}),o==="audit"&&e.jsx(sl,{licenseId:s})]})]})]})})}const nl=["ðŸ˜Š","ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥","âœ…","ðŸ‘","ðŸ’¡","ðŸŒŸ","ðŸ™","ðŸ’¯"];function ll({roomId:s,onMessageSent:n}){const{user:x}=H(),[p,o]=i.useState(""),[r,m]=i.useState(!1),[d,b]=i.useState(!1),u=i.useRef(null),t=i.useRef();i.useEffect(()=>{c()},[p]),i.useEffect(()=>()=>{t.current&&clearTimeout(t.current),a(!1)},[s]);const c=()=>{if(u.current){u.current.style.height="auto";const w=Math.min(u.current.scrollHeight,200);u.current.style.height=`${w}px`}},a=async w=>{if(x)try{w?await C.from("chat_typing_status").upsert({room_id:s,user_id:x.id,is_typing:!0,last_typing_time:new Date().toISOString()},{onConflict:"room_id,user_id"}):await C.from("chat_typing_status").delete().eq("room_id",s).eq("user_id",x.id)}catch(j){console.error("Error updating typing status:",j)}},N=w=>{o(w.target.value),t.current&&clearTimeout(t.current),w.target.value.trim()?(a(!0),t.current=setTimeout(()=>{a(!1)},3e3)):a(!1)},y=async w=>{if(w?.preventDefault(),!p.trim()||!x||r)return;const j=p.trim();o(""),m(!0),a(!1),t.current&&clearTimeout(t.current);try{const h=f(j),{error:l}=await C.from("chat_messages").insert([{room_id:s,sender_id:x.id,message_text:j,message_type:"text",mentions:h}]);if(l)throw l;n()}catch(h){console.error("Error sending message:",h),o(j)}finally{m(!1)}},f=w=>{const j=/@(\w+)/g,h=[];let l;for(;(l=j.exec(w))!==null;)h.push(l[1]);return h},_=w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),y())},v=w=>{const j=u.current;if(!j)return;const h=j.selectionStart,l=j.selectionEnd,k=p.substring(0,h)+w+p.substring(l);o(k),setTimeout(()=>{j.focus();const g=h+w.length;j.setSelectionRange(g,g)},0),b(!1)};return e.jsx("div",{className:"border-t-2 border-white/40 bg-gradient-to-br from-white/70 to-cream/50 p-6 backdrop-blur-sm",children:e.jsxs("form",{onSubmit:y,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex-1 bg-white/80 border-2 border-white/60 rounded-2xl focus-within:border-primary/40 focus-within:shadow-xl transition-all shadow-lg backdrop-blur-sm",children:[e.jsx("textarea",{ref:u,value:p,onChange:N,onKeyDown:_,placeholder:"Type your message... (Shift+Enter for new line)",rows:1,className:"w-full px-5 py-4 bg-transparent resize-none focus:outline-none text-dark-brown placeholder:text-dark-brown/40 font-medium",style:{maxHeight:"200px"}}),e.jsxs("div",{className:"flex items-center gap-2 px-5 pb-4",children:[e.jsx("button",{type:"button",className:"p-2.5 hover:bg-primary/10 rounded-xl transition-all text-dark-brown/60 hover:text-primary hover:scale-110 active:scale-95",title:"Attach file",children:e.jsx(os,{className:"w-5 h-5",strokeWidth:2})}),e.jsx("button",{type:"button",className:"p-2.5 hover:bg-primary/10 rounded-xl transition-all text-dark-brown/60 hover:text-primary hover:scale-110 active:scale-95",title:"Attach image",children:e.jsx(ns,{className:"w-5 h-5",strokeWidth:2})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>b(!d),className:"p-2.5 hover:bg-primary/10 rounded-xl transition-all text-dark-brown/60 hover:text-primary hover:scale-110 active:scale-95",title:"Add emoji",children:e.jsx(Zs,{className:"w-5 h-5",strokeWidth:2})}),d&&e.jsx("div",{className:"absolute bottom-full left-0 mb-3 bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border-2 border-white/60 p-4 grid grid-cols-6 gap-2",children:nl.map(w=>e.jsx("button",{type:"button",onClick:()=>v(w),className:"text-2xl hover:bg-primary/10 rounded-xl p-2 transition-all hover:scale-125 active:scale-95",children:w},w))})]}),e.jsx("div",{className:"flex-1"}),p.length>0&&e.jsxs("span",{className:"text-xs text-dark-brown/50 font-semibold bg-dark-brown/5 px-3 py-1.5 rounded-lg",children:[p.length," chars"]})]})]}),e.jsx("button",{type:"submit",disabled:!p.trim()||r,className:"p-5 bg-gradient-to-br from-primary via-sage to-secondary text-white rounded-2xl font-bold hover:shadow-2xl hover:scale-105 active:scale-95 transition-all disabled:opacity-40 disabled:cursor-not-allowed flex-shrink-0 border-2 border-white/30 shadow-xl",title:"Send message",children:e.jsx(Ys,{className:"w-6 h-6",strokeWidth:2.5})})]}),e.jsx("div",{className:"flex items-center gap-2 px-2",children:e.jsxs("div",{className:"flex-1 flex flex-wrap gap-2 text-xs text-dark-brown/50",children:[e.jsxs("span",{className:"bg-white/60 px-3 py-1.5 rounded-lg font-medium border border-white/40",children:[e.jsx("span",{className:"font-mono text-primary font-semibold",children:"@username"})," to mention"]}),e.jsxs("span",{className:"bg-white/60 px-3 py-1.5 rounded-lg font-medium border border-white/40",children:[e.jsx("span",{className:"font-mono text-primary font-semibold",children:"**text**"})," for bold"]})]})})]})})}const ol=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥"];function il({message:s,isOwnMessage:n,onDelete:x,onEdit:p}){const{user:o}=H(),[r,m]=i.useState(!1),[d,b]=i.useState(!1),[u,t]=i.useState(s.message_text),c=async()=>{if(confirm("Delete this message?"))try{const{error:v}=await C.from("chat_messages").update({is_deleted:!0,deleted_at:new Date().toISOString()}).eq("id",s.id);if(v)throw v;x()}catch(v){console.error("Error deleting message:",v)}},a=async()=>{if(u.trim())try{const{error:v}=await C.from("chat_messages").update({message_text:u.trim(),is_edited:!0,edited_at:new Date().toISOString()}).eq("id",s.id);if(v)throw v;b(!1),p()}catch(v){console.error("Error editing message:",v)}},N=async v=>{if(o)try{const w=s.reactions||{},j=w[v]||[],h={...w};j.includes(o.id)?(h[v]=j.filter(k=>k!==o.id),h[v].length===0&&delete h[v]):h[v]=[...j,o.id];const{error:l}=await C.from("chat_messages").update({reactions:h}).eq("id",s.id);if(l)throw l}catch(w){console.error("Error adding reaction:",w)}},y=v=>{let w=v;return w=w.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),w=w.replace(/\*(.*?)\*/g,"<em>$1</em>"),w=w.replace(/`(.*?)`/g,'<code class="bg-dark-brown/10 px-1 rounded">$1</code>'),w=w.replace(/@(\w+)/g,'<span class="bg-accent/20 text-accent font-semibold px-1 rounded">@$1</span>'),w},f=s.reactions||{},_=Object.entries(f).filter(([v,w])=>w.length>0);return e.jsx("div",{className:`group relative ${n?"flex justify-end":"flex justify-start"}`,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:e.jsxs("div",{className:`flex-1 max-w-2xl ${n?"items-end":"items-start"} flex flex-col`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${n?"flex-row-reverse":"flex-row"}`,children:[e.jsx("span",{className:"text-xs text-dark-brown/50 font-semibold",children:R(new Date(s.created_at),"h:mm a")}),s.is_edited&&e.jsx("span",{className:"text-xs text-dark-brown/40 italic bg-dark-brown/5 px-2 py-0.5 rounded-full",children:"edited"})]}),e.jsx("div",{className:"relative",children:d?e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm border-2 border-primary/30 rounded-2xl p-5 shadow-xl",children:[e.jsx("textarea",{value:u,onChange:v=>t(v.target.value),className:"w-full p-3 bg-cream/30 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary resize-none font-medium text-dark-brown",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsx("button",{onClick:a,className:"px-5 py-2 bg-gradient-to-br from-primary to-sage text-white rounded-xl text-sm font-bold hover:shadow-xl transition-all hover:scale-105 active:scale-95",children:"Save"}),e.jsx("button",{onClick:()=>{b(!1),t(s.message_text)},className:"px-5 py-2 bg-white border-2 border-dark-brown/20 text-dark-brown rounded-xl text-sm font-bold hover:bg-dark-brown/5 transition-all hover:scale-105 active:scale-95",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`rounded-2xl px-5 py-4 shadow-lg transition-all ${n?"bg-gradient-to-br from-primary via-sage to-secondary text-white border-2 border-white/30":"bg-white/90 backdrop-blur-sm border-2 border-white/60 text-dark-brown"}`,children:e.jsx("div",{className:`text-base leading-relaxed break-words font-medium ${n?"text-white":"text-dark-brown"}`,dangerouslySetInnerHTML:{__html:y(s.message_text)}})}),r&&n&&e.jsxs("div",{className:"absolute -top-4 right-0 bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl border-2 border-white/60 flex gap-2 p-2",children:[e.jsx("button",{onClick:()=>b(!0),className:"p-2 hover:bg-primary/10 rounded-lg transition-all hover:scale-110 active:scale-95",title:"Edit",children:e.jsx(ge,{className:"w-5 h-5 text-primary",strokeWidth:2})}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-red-50 rounded-lg transition-all hover:scale-110 active:scale-95",title:"Delete",children:e.jsx(le,{className:"w-5 h-5 text-red-500",strokeWidth:2})})]})]})}),_.length>0&&e.jsx("div",{className:`flex flex-wrap gap-2 mt-3 ${n?"justify-end":"justify-start"}`,children:_.map(([v,w])=>e.jsxs("button",{onClick:()=>N(v),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-sm font-bold transition-all hover:scale-110 active:scale-95 shadow-md ${w.includes(o?.id)?"bg-gradient-to-br from-amber-100 to-amber-200 border-2 border-amber-400":"bg-white/90 backdrop-blur-sm border-2 border-white/60 hover:border-primary/40"}`,children:[e.jsx("span",{className:"text-lg",children:v}),e.jsx("span",{className:"text-dark-brown",children:w.length})]},v))}),e.jsx("div",{className:`flex gap-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity ${n?"justify-end":"justify-start"}`,children:ol.map(v=>e.jsx("button",{onClick:()=>N(v),className:"text-xl hover:scale-125 active:scale-95 transition-all p-1.5 hover:bg-white/60 rounded-xl backdrop-blur-sm",title:`React with ${v}`,children:v},v))})]})})}function dl({room:s,teamMembers:n}){const{user:x}=H(),[p,o]=i.useState([]),[r,m]=i.useState(!0),[d,b]=i.useState([]),u=i.useRef(null),t=i.useRef(null),[c,a]=i.useState(!1);i.useEffect(()=>{s&&(N(),y(),f(),_())},[s?.id]),i.useEffect(()=>{v()},[p]);const N=async()=>{try{m(!0);const{data:g,error:D}=await C.from("chat_messages").select("*").eq("room_id",s.id).eq("is_deleted",!1).order("created_at",{ascending:!0}).limit(100);if(D)throw D;o(g||[])}catch(g){console.error("Error fetching messages:",g)}finally{m(!1)}},y=()=>{const g=C.channel(`room_${s.id}_messages`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},D=>{o(P=>[...P,D.new]),_()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},D=>{o(P=>P.map(E=>E.id===D.new.id?D.new:E))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},D=>{o(P=>P.filter(E=>E.id!==D.old.id))}).subscribe();return()=>{g.unsubscribe()}},f=()=>{const g=C.channel(`room_${s.id}_typing`).on("postgres_changes",{event:"*",schema:"public",table:"chat_typing_status",filter:`room_id=eq.${s.id}`},async()=>{const{data:D}=await C.from("chat_typing_status").select("*").eq("room_id",s.id).eq("is_typing",!0).neq("user_id",x?.id||"");b(D||[])}).subscribe();return()=>{g.unsubscribe()}},_=async()=>{if(x)try{const{error:g}=await C.from("chat_room_members").update({last_read_at:new Date().toISOString()}).eq("room_id",s.id).eq("user_id",x.id);if(g)throw g}catch(g){console.error("Error marking room as read:",g)}},v=()=>{u.current?.scrollIntoView({behavior:"smooth"})},w=()=>{if(!t.current)return;const{scrollTop:g,scrollHeight:D,clientHeight:P}=t.current,E=D-g-P<100;a(!E)},j=g=>{const D=new Date(g);return As(D)?"Today":Is(D)?"Yesterday":R(D,"MMMM dd, yyyy")},h=(g,D)=>D?!Jt(new Date(g.created_at),new Date(D.created_at)):!0,l=g=>{const D=n.find(P=>P.id===g);return g===x?.id?"You":D?.full_name||D?.email?.split("@")[0]||"Unknown"},k=()=>d.map(g=>{const D=n.find(P=>P.id===g.user_id);return D?.full_name||D?.email?.split("@")[0]||"Someone"}).join(", ");return e.jsxs("div",{className:"flex-1 flex flex-col h-full",children:[e.jsx("div",{className:"border-b-2 border-white/40 p-6 bg-gradient-to-r from-white/60 to-cream/40 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary/20 to-sage/10 rounded-2xl flex items-center justify-center text-3xl shadow-lg border-2 border-white/50",children:s.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary truncate drop-shadow-sm",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-dark-brown/70 truncate font-medium",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/60 rounded-xl border border-white/50 shadow-md backdrop-blur-sm",children:[e.jsx(je,{className:"w-5 h-5 text-primary",strokeWidth:2.5}),e.jsxs("span",{className:"text-sm text-primary font-bold",children:[n.length," partner",n.length!==1?"s":""]})]})]})}),e.jsxs("div",{ref:t,onScroll:w,className:"flex-1 overflow-y-auto p-6 bg-gradient-to-br from-cream/40 to-white/30",children:[r?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):p.length>0?e.jsxs("div",{className:"space-y-5",children:[p.map((g,D)=>e.jsxs("div",{children:[h(g,p[D-1])&&e.jsxs("div",{className:"flex items-center gap-4 my-8",children:[e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-dark-brown/20 to-transparent"}),e.jsx("span",{className:"text-xs font-bold text-dark-brown/50 px-4 py-2 bg-white/60 backdrop-blur-sm rounded-full shadow-sm border border-white/50",children:j(g.created_at)}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-dark-brown/20 to-transparent"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[g.sender_id!==x?.id&&e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-base flex-shrink-0 shadow-lg border-2 border-white/30",children:l(g.sender_id)[0]?.toUpperCase()}),e.jsxs("div",{className:`flex-1 ${g.sender_id===x?.id?"ml-auto":""}`,children:[g.sender_id!==x?.id&&e.jsx("div",{className:"text-sm font-bold text-primary mb-2 ml-1",children:l(g.sender_id)}),e.jsx(il,{message:g,isOwnMessage:g.sender_id===x?.id,onDelete:()=>N(),onEdit:()=>N()})]}),g.sender_id===x?.id&&e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-base flex-shrink-0 shadow-lg border-2 border-white/30",children:l(g.sender_id)[0]?.toUpperCase()})]})]},g.id)),e.jsx("div",{ref:u})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-primary/10 to-sage/10 rounded-full flex items-center justify-center mx-auto mb-6 text-6xl shadow-xl border-2 border-white/50",children:s.icon}),e.jsx("h4",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No messages yet"}),e.jsx("p",{className:"text-dark-brown/60 font-medium text-lg",children:"Start the conversation with your team!"})]})}),d.length>0&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg mt-6 border-2 border-white/50",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("span",{className:"w-2.5 h-2.5 bg-primary rounded-full animate-bounce shadow-sm",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2.5 h-2.5 bg-primary rounded-full animate-bounce shadow-sm",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2.5 h-2.5 bg-primary rounded-full animate-bounce shadow-sm",style:{animationDelay:"300ms"}})]}),e.jsxs("span",{className:"text-sm text-dark-brown/70 font-medium",children:[k()," ",d.length===1?"is":"are"," typing..."]})]})]}),c&&e.jsx("button",{onClick:v,className:"absolute bottom-28 right-8 p-4 bg-gradient-to-br from-primary to-sage text-white rounded-2xl shadow-2xl hover:shadow-[0_8px_30px_rgba(139,69,19,0.4)] transition-all z-10 hover:scale-110 active:scale-95 border-2 border-white/30",children:e.jsx(Rs,{className:"w-6 h-6",strokeWidth:2.5})}),e.jsx(ll,{roomId:s.id,onMessageSent:N})]})}function cl({onSelectRoom:s,selectedRoomId:n,onNewChat:x,onNewGroup:p}){const{user:o}=H(),[r,m]=i.useState([]),[d,b]=i.useState(!0),[u,t]=i.useState(""),[c,a]=i.useState([]),[N,y]=i.useState(!1);i.useEffect(()=>{o&&(f(),_(),v())},[o]);const f=async()=>{if(o)try{const{data:g,error:D}=await C.from("chat_user_rooms").select("*").eq("user_id",o.id).order("last_message_at",{ascending:!1,nullsFirst:!1});if(D)throw D;const P=await Promise.all((g||[]).map(async E=>{if(E.is_direct&&E.participant_ids?.length===2){const I=E.participant_ids.find(O=>O!==o.id),{data:q}=await C.from("users").select("id, name, email, role").eq("id",I).maybeSingle();return{...E,display_name:q?.name||q?.email?.split("@")[0]||"User",display_icon:"ðŸ‘¤",other_user:q}}return{...E,display_name:E.name,display_icon:E.icon}}));m(P)}catch(g){console.error("Error fetching rooms:",g)}finally{b(!1)}},_=async()=>{try{const{data:g,error:D}=await C.from("users").select("id, name, email, role").eq("approval_status","approved").neq("id",o?.id||"");if(D)throw D;a(g||[])}catch(g){console.error("Error fetching users:",g)}},v=()=>{const g=C.channel("user_rooms").on("postgres_changes",{event:"*",schema:"public",table:"chat_messages"},()=>{f()}).subscribe();return()=>{g.unsubscribe()}},w=g=>{if(!g)return"";const D=new Date(g);return As(D)?R(D,"h:mm a"):Is(D)?"Yesterday":R(D,"MMM d")},j=g=>g.type==="direct"?"ðŸ‘¤":g.type==="group"?"ðŸ‘¥":g.type==="team"?"ðŸ¢":g.display_icon||"ðŸ’¬",h=r.filter(g=>g.display_name?.toLowerCase().includes(u.toLowerCase())),l=c.filter(g=>g.name?.toLowerCase().includes(u.toLowerCase())||g.email?.toLowerCase().includes(u.toLowerCase())),k=async g=>{try{const{data:D,error:P}=await C.rpc("get_or_create_direct_chat",{user1_id:o?.id,user2_id:g});if(P)throw P;const{data:E}=await C.from("chat_user_rooms").select("*").eq("room_id",D).eq("user_id",o?.id||"").maybeSingle();if(E){const I=E.participant_ids.find(Y=>Y!==o?.id),{data:q}=await C.from("users").select("id, name, email, role").eq("id",I).maybeSingle(),O={...E,display_name:q?.name||q?.email?.split("@")[0]||"User",display_icon:"ðŸ‘¤",other_user:q};s(O),y(!1)}}catch(D){console.error("Error creating/opening chat:",D)}};return e.jsxs("div",{className:"flex flex-col h-full bg-gradient-to-b from-white/50 to-cream/30",children:[e.jsxs("div",{className:"p-4 border-b border-white/40",children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:u,onChange:g=>t(g.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-sm font-medium placeholder:text-dark-brown/40"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y(!N),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-xl font-semibold text-sm hover:shadow-lg transition-all hover:scale-105 active:scale-95 ${N?"bg-gradient-to-br from-primary to-sage text-white":"bg-white/80 border-2 border-primary/20 text-primary"}`,children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"Users"})]}),e.jsx("button",{onClick:p,className:"flex items-center justify-center gap-2 px-3 py-2 bg-white/80 border-2 border-primary/20 text-primary rounded-xl font-semibold text-sm hover:shadow-lg transition-all hover:scale-105 active:scale-95",children:e.jsx(G,{className:"w-4 h-4"})})]})]}),N&&e.jsx("div",{className:"border-b-2 border-white/40 bg-white/30 p-3",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-xs font-bold text-dark-brown/70 uppercase tracking-wider",children:["All Users (",c.length,")"]}),e.jsx("button",{onClick:()=>y(!1),className:"text-xs text-primary font-semibold hover:underline",children:"Show Chats"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):N?e.jsx("div",{className:"p-2",children:l.length>0?l.map(g=>e.jsx("button",{onClick:()=>k(g.id),className:"w-full p-3 rounded-xl mb-2 transition-all text-left bg-white/60 border-2 border-white/40 hover:border-primary/20 hover:shadow-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-lg border-2 border-white/50",children:(g.name||g.email)?.[0]?.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-primary truncate text-sm",children:g.name||g.email?.split("@")[0]||"User"}),g.role==="admin"&&e.jsx(Mt,{className:"w-3 h-3 text-amber-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:g.email})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ue,{className:"w-5 h-5 text-primary/60"})})]})},g.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(je,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center",children:"No users found"})]})}):h.length>0?e.jsx("div",{className:"p-2",children:h.map(g=>e.jsx("button",{onClick:()=>s(g),className:`w-full p-3 rounded-xl mb-2 transition-all text-left ${n===g.room_id?"bg-gradient-to-br from-primary/20 to-sage/10 border-2 border-primary/30 shadow-lg":"bg-white/60 border-2 border-white/40 hover:border-primary/20 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary/20 to-sage/10 flex items-center justify-center text-2xl border-2 border-white/50",children:j(g)}),g.unread_count>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center text-white text-xs font-bold border-2 border-white",children:g.unread_count>9?"9+":g.unread_count})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-primary truncate text-sm",children:g.display_name}),g.other_user?.role==="admin"&&e.jsx(Mt,{className:"w-3 h-3 text-amber-500 flex-shrink-0"})]}),e.jsx("span",{className:"text-xs text-dark-brown/50 font-medium flex-shrink-0 ml-2",children:w(g.last_message_at)})]}),g.last_message_text&&e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:g.last_message_text}),!g.last_message_text&&g.type==="direct"&&e.jsx("p",{className:"text-xs text-dark-brown/40 italic",children:"Start a conversation"})]})]})},g.room_id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(Ue,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center mb-4",children:u?"No conversations found":"No conversations yet"}),e.jsx("button",{onClick:x,className:"px-4 py-2 bg-gradient-to-br from-primary to-sage text-white rounded-xl font-semibold text-sm hover:shadow-lg transition-all",children:"Start a conversation"})]})})]})}function xl({onClose:s,onChatCreated:n}){const{user:x}=H(),[p,o]=i.useState([]),[r,m]=i.useState([]),[d,b]=i.useState(""),[u,t]=i.useState(!0),[c,a]=i.useState(!1);i.useEffect(()=>{N()},[x]),i.useEffect(()=>{m(d?p.filter(f=>f.name?.toLowerCase().includes(d.toLowerCase())||f.email?.toLowerCase().includes(d.toLowerCase())):p)},[d,p]);const N=async()=>{try{const{data:f,error:_}=await C.from("users").select("id, name, email, role").eq("approval_status","approved").neq("id",x?.id||"").order("name",{ascending:!0});if(_)throw _;o(f||[]),m(f||[])}catch(f){console.error("Error fetching users:",f)}finally{t(!1)}},y=async f=>{if(!(!x||c)){a(!0);try{const{data:_,error:v}=await C.rpc("get_or_create_direct_chat",{user1_id:x.id,user2_id:f});if(v)throw v;n(_),s()}catch(_){console.error("Error creating direct chat:",_),alert("Failed to start chat. Please try again.")}finally{a(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-dark-brown/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col border-2 border-white/50",children:[e.jsxs("div",{className:"p-6 border-b-2 border-white/40 bg-gradient-to-r from-primary/10 to-sage/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-2xl flex items-center justify-center text-white shadow-lg",children:e.jsx(Ue,{className:"w-6 h-6",strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-heading font-bold text-primary",children:"New Chat"}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium",children:"Start a conversation"})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/60 rounded-xl transition-all hover:scale-110 active:scale-95",children:e.jsx(oe,{className:"w-5 h-5 text-dark-brown/60"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:d,onChange:f=>b(f.target.value),className:"w-full pl-11 pr-4 py-3 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-sm font-medium placeholder:text-dark-brown/40",autoFocus:!0})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):r.length>0?e.jsx("div",{className:"space-y-2",children:r.map(f=>e.jsx("button",{onClick:()=>y(f.id),disabled:c,className:"w-full p-4 rounded-2xl bg-white/60 border-2 border-white/60 hover:border-primary/30 hover:shadow-lg transition-all text-left group disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-lg shadow-lg",children:(f.name||f.email)?.[0]?.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-primary text-base truncate",children:f.name||f.email?.split("@")[0]||"User"}),f.role==="admin"&&e.jsx(Mt,{className:"w-4 h-4 text-amber-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:f.email})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ue,{className:"w-5 h-5 text-primary",strokeWidth:2})})]})},f.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(ve,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center",children:d?"No users found":"No users available"})]})})]})})}function ml({onClose:s,onGroupCreated:n}){const{user:x}=H(),[p,o]=i.useState([]),[r,m]=i.useState([]),[d,b]=i.useState(""),[u,t]=i.useState(new Set),[c,a]=i.useState(""),[N,y]=i.useState(!0),[f,_]=i.useState(!1);i.useEffect(()=>{v()},[x]),i.useEffect(()=>{m(d?p.filter(l=>l.name?.toLowerCase().includes(d.toLowerCase())||l.email?.toLowerCase().includes(d.toLowerCase())):p)},[d,p]);const v=async()=>{try{const{data:l,error:k}=await C.from("users").select("id, name, email, role").eq("approval_status","approved").neq("id",x?.id||"").order("name",{ascending:!0});if(k)throw k;o(l||[]),m(l||[])}catch(l){console.error("Error fetching users:",l)}finally{y(!1)}},w=l=>{const k=new Set(u);k.has(l)?k.delete(l):k.add(l),t(k)},j=async()=>{if(!(!x||f||!c.trim()||u.size===0)){_(!0);try{const{data:l,error:k}=await C.from("chat_rooms").insert([{name:c.trim(),type:"group",is_direct:!1,created_by:x.id,icon:"ðŸ‘¥"}]).select().single();if(k)throw k;const g=[{room_id:l.id,user_id:x.id,role:"admin"},...Array.from(u).map(P=>({room_id:l.id,user_id:P,role:"member"}))],{error:D}=await C.from("chat_room_members").insert(g);if(D)throw D;n(l.id),s()}catch(l){console.error("Error creating group:",l),alert("Failed to create group. Please try again.")}finally{_(!1)}}},h=c.trim().length>0&&u.size>0;return e.jsx("div",{className:"fixed inset-0 bg-dark-brown/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-lg max-h-[85vh] flex flex-col border-2 border-white/50",children:[e.jsxs("div",{className:"p-6 border-b-2 border-white/40 bg-gradient-to-r from-primary/10 to-sage/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-2xl flex items-center justify-center text-white shadow-lg",children:e.jsx(je,{className:"w-6 h-6",strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-heading font-bold text-primary",children:"Create Group"}),e.jsxs("p",{className:"text-sm text-dark-brown/60 font-medium",children:[u.size," member",u.size!==1?"s":""," selected"]})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/60 rounded-xl transition-all hover:scale-110 active:scale-95",children:e.jsx(oe,{className:"w-5 h-5 text-dark-brown/60"})})]}),e.jsx("input",{type:"text",placeholder:"Group name...",value:c,onChange:l=>a(l.target.value),className:"w-full px-4 py-3 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-base font-semibold placeholder:text-dark-brown/40 mb-3",maxLength:50}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search members...",value:d,onChange:l=>b(l.target.value),className:"w-full pl-11 pr-4 py-3 bg-white/80 border-2 border-white/60 rounded-xl focus:outline-none focus:border-primary/40 text-sm font-medium placeholder:text-dark-brown/40"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:N?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):r.length>0?e.jsx("div",{className:"space-y-2",children:r.map(l=>{const k=u.has(l.id);return e.jsx("button",{onClick:()=>w(l.id),className:`w-full p-4 rounded-2xl border-2 transition-all text-left ${k?"bg-gradient-to-br from-primary/20 to-sage/10 border-primary/40 shadow-lg":"bg-white/60 border-white/60 hover:border-primary/20 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary via-sage to-secondary flex items-center justify-center text-white font-bold text-lg shadow-lg",children:(l.name||l.email)?.[0]?.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-primary text-base truncate",children:l.name||l.email?.split("@")[0]||"User"}),l.role==="admin"&&e.jsx(Mt,{className:"w-4 h-4 text-amber-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 truncate font-medium",children:l.email})]}),e.jsx("div",{className:`w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all ${k?"bg-primary border-primary":"border-dark-brown/30"}`,children:k&&e.jsx($t,{className:"w-4 h-4 text-white",strokeWidth:3})})]})},l.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-sage/10 flex items-center justify-center mb-4",children:e.jsx(ve,{className:"w-10 h-10 text-primary/40"})}),e.jsx("p",{className:"text-sm text-dark-brown/60 font-medium text-center",children:d?"No users found":"No users available"})]})}),e.jsx("div",{className:"p-6 border-t-2 border-white/40 bg-gradient-to-r from-white/60 to-cream/40",children:e.jsx("button",{onClick:j,disabled:!h||f,className:"w-full py-3 bg-gradient-to-br from-primary via-sage to-secondary text-white rounded-2xl font-bold text-base hover:shadow-2xl transition-all disabled:opacity-40 disabled:cursor-not-allowed hover:scale-105 active:scale-95",children:f?"Creating...":"Create Group"})})]})})}function hl(){const{user:s}=H(),[n,x]=i.useState(null),[p,o]=i.useState([]);i.useState(!1);const[r,m]=i.useState(!1),[d,b]=i.useState(!1),u=async a=>{x(a),await t(a.room_id)},t=async a=>{try{const{data:N,error:y}=await C.from("chat_room_members").select(`
          user_id,
          role,
          joined_at
        `).eq("room_id",a);if(y)throw y;const f=await Promise.all((N||[]).map(async _=>{const{data:v}=await C.from("users").select("id, name, email, role").eq("id",_.user_id).maybeSingle();return{..._,...v}}));o(f)}catch(N){console.error("Error fetching room members:",N)}},c=async a=>{const{data:N,error:y}=await C.from("chat_user_rooms").select("*").eq("room_id",a).eq("user_id",s?.id||"").maybeSingle();N&&!y&&await u(N)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(Se,{}),e.jsxs("div",{className:"relative z-10 h-screen flex p-6 gap-4",children:[e.jsxs("div",{className:"w-96 glass-card rounded-3xl border-2 border-white/50 shadow-2xl flex flex-col overflow-hidden backdrop-blur-xl",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary via-sage to-secondary p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"}),e.jsx("div",{className:"absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border-2 border-white/30 shadow-xl",children:e.jsx(Ue,{className:"w-6 h-6 text-white",strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-white drop-shadow-lg",children:"Messages"}),e.jsx("p",{className:"text-xs text-white/90 font-medium",children:"Your conversations"})]})]})})]}),e.jsx(cl,{onSelectRoom:u,selectedRoomId:n?.room_id||null,onNewChat:()=>m(!0),onNewGroup:()=>b(!0)})]}),e.jsx("div",{className:"flex-1 flex flex-col glass-card rounded-3xl border-2 border-white/50 shadow-2xl overflow-hidden backdrop-blur-xl",children:n?e.jsx(dl,{room:{id:n.room_id,name:n.display_name,icon:n.display_icon,description:n.description,type:n.type,is_direct:n.is_direct},teamMembers:p}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gradient-to-br from-white/50 to-cream/30",children:e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"w-32 h-32 bg-gradient-to-br from-primary/20 to-sage/10 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl",children:e.jsx(Ue,{className:"w-16 h-16 text-primary",strokeWidth:1.5})}),e.jsx("h3",{className:"font-heading text-4xl font-bold text-primary mb-4",children:"Select a conversation"}),e.jsx("p",{className:"text-dark-brown/60 text-lg font-medium max-w-md mb-6",children:"Choose a conversation from the list or start a new chat with your team."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-br from-primary to-sage text-white rounded-xl font-bold hover:shadow-2xl transition-all hover:scale-105 active:scale-95",children:"New Chat"}),e.jsx("button",{onClick:()=>b(!0),className:"px-6 py-3 bg-white border-2 border-primary/20 text-primary rounded-xl font-bold hover:shadow-xl transition-all hover:scale-105 active:scale-95",children:"New Group"})]})]})})})]}),r&&e.jsx(xl,{onClose:()=>m(!1),onChatCreated:c}),d&&e.jsx(ml,{onClose:()=>b(!1),onGroupCreated:c})]})}function pl(){const s=ce(),{user:n}=H(),[x,p]=i.useState("profile"),[o,r]=i.useState({name:n?.name||"",email:n?.email||"",phone:n?.phone||""}),[m,d]=i.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[b,u]=i.useState(null),[t,c]=i.useState(null),[a,N]=i.useState(!1),[y,f]=i.useState(!1),_=async w=>{w.preventDefault(),N(!0),u(null);try{const j=localStorage.getItem("users"),h=j?JSON.parse(j):[],l=h.findIndex(k=>k.id===n?.id);if(l!==-1){h[l]={...h[l],name:o.name,email:o.email,phone:o.phone},localStorage.setItem("users",JSON.stringify(h));const k={id:h[l].id,name:h[l].name,email:h[l].email,phone:h[l].phone,role:h[l].role};localStorage.setItem("currentUser",JSON.stringify(k)),u({type:"success",text:"Profile updated successfully"}),setTimeout(()=>{window.location.reload()},1500)}}catch{u({type:"error",text:"Failed to update profile"})}finally{N(!1)}},v=async w=>{if(w.preventDefault(),f(!0),c(null),m.newPassword.length<8){c({type:"error",text:"New password must be at least 8 characters long"}),f(!1);return}if(m.newPassword!==m.confirmPassword){c({type:"error",text:"New passwords do not match"}),f(!1);return}try{const j=localStorage.getItem("users"),h=j?JSON.parse(j):[],l=h.findIndex(k=>k.id===n?.id&&k.password===m.currentPassword);l!==-1?(h[l].password=m.newPassword,localStorage.setItem("users",JSON.stringify(h)),c({type:"success",text:"Password changed successfully"}),d({currentPassword:"",newPassword:"",confirmPassword:""})):c({type:"error",text:"Current password is incorrect"})}catch{c({type:"error",text:"Failed to change password"})}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Settings"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your account settings and preferences"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-primary/10",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>p("profile"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${x==="profile"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile"})]})}),e.jsx("button",{onClick:()=>p("security"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${x==="security"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),e.jsx("span",{children:"Security"})]})})]})}),e.jsxs("div",{className:"p-6 md:p-8",children:[x==="profile"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-6 p-4 bg-cream/50 rounded-xl border border-primary/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-full flex items-center justify-center",children:e.jsx(Oe,{className:"w-6 h-6 text-cream"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:n?.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:n?.email})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-accent/20 rounded-full",children:[e.jsx(ut,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:n?.role})]})]})}),b&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${b.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[b.type==="success"?e.jsx(Q,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${b.type==="success"?"text-sage":"text-soft-red"}`,children:b.text})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"name",type:"text",value:o.name,onChange:w=>r({...o,name:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"email",type:"email",value:o.email,onChange:w=>r({...o,email:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"phone",type:"tel",value:o.phone,onChange:w=>r({...o,phone:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",disabled:a})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:a,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(Qs,{className:"w-5 h-5"}),a?"Saving...":"Save Changes"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]}),x==="security"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"Change Password"}),e.jsx("p",{className:"text-dark-brown/70",children:"Update your password to keep your account secure"})]}),t&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${t.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[t.type==="success"?e.jsx(Q,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(fe,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${t.type==="success"?"text-sage":"text-soft-red"}`,children:t.text})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"currentPassword",type:"password",value:m.currentPassword,onChange:w=>d({...m,currentPassword:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:y})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"newPassword",type:"password",value:m.newPassword,onChange:w=>d({...m,newPassword:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:y,minLength:8})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"confirmPassword",type:"password",value:m.confirmPassword,onChange:w=>d({...m,confirmPassword:w.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:y})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:y,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(Ie,{className:"w-5 h-5"}),y?"Changing...":"Change Password"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]})]})]})]})})})}function bl(){const{user:s}=H(),[n,x]=i.useState([]),[p,o]=i.useState(!0),[r,m]=i.useState("all");i.useEffect(()=>{d()},[s?.id]);const d=async()=>{if(s?.id)try{const{data:y,error:f}=await C.from("notifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(f)throw f;x(y||[])}catch(y){console.error("Error fetching notifications:",y)}finally{o(!1)}},b=async y=>{try{const{error:f}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",y);if(f)throw f;x(_=>_.map(v=>v.id===y?{...v,is_read:!0,read_at:new Date().toISOString()}:v))}catch(f){console.error("Error marking notification as read:",f)}},u=async()=>{try{const y=n.filter(_=>!_.is_read).map(_=>_.id),{error:f}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).in("id",y);if(f)throw f;x(_=>_.map(v=>({...v,is_read:!0,read_at:v.read_at||new Date().toISOString()})))}catch(y){console.error("Error marking all as read:",y)}},t=async y=>{try{const{error:f}=await C.from("notifications").delete().eq("id",y);if(f)throw f;x(_=>_.filter(v=>v.id!==y))}catch(f){console.error("Error deleting notification:",f)}},c=r==="unread"?n.filter(y=>!y.is_read):n,a=n.filter(y=>!y.is_read).length,N=y=>{switch(y){case"expense":return"text-blue-600 bg-blue-50";case"batch":return"text-green-600 bg-green-50";case"license":return"text-orange-600 bg-orange-50";case"vendor":return"text-purple-600 bg-purple-50";case"product":return"text-pink-600 bg-pink-50";default:return"text-gray-600 bg-gray-50"}};return p?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsx("div",{className:"min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-primary mb-2",children:"Notifications"}),e.jsx("p",{className:"text-gray-600",children:a>0?`You have ${a} unread notification${a>1?"s":""}`:"All caught up!"})]}),a>0&&e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary-dark transition-colors",children:[e.jsx(Pa,{className:"w-4 h-4"}),"Mark All Read"]})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>m("all"),className:`px-4 py-2 rounded-button font-semibold transition-all ${r==="all"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["All (",n.length,")"]}),e.jsxs("button",{onClick:()=>m("unread"),className:`px-4 py-2 rounded-button font-semibold transition-all ${r==="unread"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["Unread (",a,")"]})]})]}),c.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(Ke,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:r==="unread"?"No unread notifications":"No notifications yet"}),e.jsx("p",{className:"text-gray-500",children:r==="unread"?"All notifications have been read":"You'll see notifications here when there's activity"})]}):e.jsx("div",{className:"space-y-3",children:c.map(y=>e.jsx("div",{className:`glass-card p-4 transition-all hover:shadow-lg ${y.is_read?"":"border-l-4 border-gold"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${N(y.type)}`,children:e.jsx(Ke,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsx("h3",{className:"font-semibold text-primary",children:y.title}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:ts(new Date(y.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:y.message}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${N(y.type)}`,children:y.type}),!y.is_read&&e.jsxs("button",{onClick:()=>b(y.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-primary hover:bg-primary/5 rounded-button transition-colors",children:[e.jsx($t,{className:"w-3 h-3"}),"Mark as read"]}),e.jsxs("button",{onClick:()=>t(y.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-red-600 hover:bg-red-50 rounded-button transition-colors ml-auto",children:[e.jsx(le,{className:"w-3 h-3"}),"Delete"]})]})]})]})},y.id))})]})})}function ul(){const{user:s}=H(),[n,x]=i.useState("pending"),[p,o]=i.useState([]),[r,m]=i.useState([]),[d,b]=i.useState([]),[u,t]=i.useState(!0),[c,a]=i.useState(""),[N,y]=i.useState(null),[f,_]=i.useState(!1),[v,w]=i.useState(null),[j,h]=i.useState("");i.useEffect(()=>{l()},[]);const l=async()=>{t(!0);try{const{data:I}=await C.from("users").select("*").eq("approval_status","pending").order("created_at",{ascending:!1}),{data:q}=await C.from("users").select("*").eq("approval_status","approved").order("approved_at",{ascending:!1}),{data:O}=await C.from("users").select("*").eq("approval_status","rejected").order("created_at",{ascending:!1});if(q&&q.length>0){const Y=q.map(S=>S.approved_by).filter(S=>S!==null),{data:ee}=await C.from("users").select("id, name").in("id",Y),te=new Map(ee?.map(S=>[S.id,S.name])||[]);m(q.map(S=>({...S,approver_name:S.approved_by&&te.get(S.approved_by)||"Self-registered"})))}else m([]);o(I||[]),b(O||[])}catch(I){console.error("Error fetching users:",I)}finally{t(!1)}},k=async I=>{y(I);try{const{error:q}=await C.from("users").update({approval_status:"approved",approved_by:s?.id,approved_at:new Date().toISOString()}).eq("id",I);if(q)throw q;await C.from("notifications").insert({user_id:I,type:"account_approved",title:"Account Approved",message:"Your Organitto account has been approved! You can now login.",read:!1}),await l()}catch(q){console.error("Error approving user:",q),alert("Failed to approve user")}finally{y(null)}},g=I=>{w(I),_(!0),h("")},D=async()=>{if(!v||!j.trim()){alert("Please provide a reason for rejection");return}y(v.id);try{const{error:I}=await C.from("users").update({approval_status:"rejected",rejection_reason:j}).eq("id",v.id);if(I)throw I;await C.from("notifications").insert({user_id:v.id,type:"account_rejected",title:"Registration Not Approved",message:`Your registration was not approved. Reason: ${j}`,read:!1}),_(!1),w(null),h(""),await l()}catch(I){console.error("Error rejecting user:",I),alert("Failed to reject user")}finally{y(null)}},P=I=>{if(!c.trim())return I;const q=c.toLowerCase();return I.filter(O=>O.name.toLowerCase().includes(q)||O.email.toLowerCase().includes(q))},E=I=>new Date(I).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});return u?e.jsx("div",{className:"min-h-screen bg-gradient-mesh",children:e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-mesh",children:[e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx(je,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"User Approval Management"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Review and manage user registrations"})]})]})}),e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x("pending"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${n==="pending"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(de,{className:"w-4 h-4 inline mr-2"}),"Pending (",p.length,")"]}),e.jsxs("button",{onClick:()=>x("approved"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${n==="approved"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(Q,{className:"w-4 h-4 inline mr-2"}),"Approved (",r.length,")"]}),e.jsxs("button",{onClick:()=>x("rejected"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${n==="rejected"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-2"}),"Rejected (",d.length,")"]})]}),e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:c,onChange:I=>a(I.target.value),className:"input-float w-full pl-12"})]})]}),n==="pending"&&e.jsx("div",{className:"space-y-4",children:P(p).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No pending approvals"})]}):P(p).map(I=>e.jsx("div",{className:"glass-card p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:I.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:I.name}),e.jsx("p",{className:"text-sm text-primary/60",children:I.role.charAt(0).toUpperCase()+I.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",I.email]}),I.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",I.phone]}),e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Registered:"})," ",E(I.created_at)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ue,{onClick:()=>k(I.id),disabled:N===I.id,variant:"primary",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>g(I),disabled:N===I.id,className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Reject"]})]})]})},I.id))}),n==="approved"&&e.jsx("div",{className:"space-y-4",children:P(r).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No approved users"})]}):P(r).map(I=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:I.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:I.name}),e.jsx("p",{className:"text-sm text-primary/60",children:I.role.charAt(0).toUpperCase()+I.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",I.email]}),I.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",I.phone]}),e.jsxs("p",{className:"text-sm text-green-600 font-semibold",children:["Approved by ",I.approver_name," on ",I.approved_at?E(I.approved_at):"N/A"]})]})]},I.id))}),n==="rejected"&&e.jsx("div",{className:"space-y-4",children:P(d).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No rejected users"})]}):P(d).map(I=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:I.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:I.name}),e.jsx("p",{className:"text-sm text-primary/60",children:I.role.charAt(0).toUpperCase()+I.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",I.email]}),I.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",I.phone]}),I.rejection_reason&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50/50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-sm font-semibold text-red-800 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700",children:I.rejection_reason})]})]})]},I.id))})]})]}),f&&v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"glass-card p-8 max-w-md w-full animate-scale-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary mb-4",children:"Reject Registration"}),e.jsxs("p",{className:"text-primary/70 mb-6",children:["Are you sure you want to reject ",e.jsx("span",{className:"font-bold",children:v.name}),"'s registration?"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-primary mb-3",children:"Rejection Reason (Required)"}),e.jsx("textarea",{value:j,onChange:I=>h(I.target.value),className:"input-float w-full h-32 resize-none",placeholder:"Explain why this registration is being rejected...",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{_(!1),w(null),h("")},className:"flex-1 px-6 py-3 glass-card text-primary font-bold rounded-button hover:shadow-md",children:"Cancel"}),e.jsx("button",{onClick:D,disabled:!j.trim()||N===v.id,className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50",children:"Confirm Reject"})]})]})})]})}function fl(){const s=es(),{user:n}=H(),p=["/","/login","/register"].includes(s.pathname),o=n&&!p;return e.jsxs(e.Fragment,{children:[!p&&e.jsx(Se,{}),e.jsxs(ma,{children:[e.jsx(K,{path:"/",element:e.jsx(br,{})}),e.jsx(K,{path:"/login",element:e.jsx(ur,{})}),e.jsx(K,{path:"/register",element:e.jsx(fr,{})}),e.jsxs(K,{element:e.jsx(ws,{children:e.jsx(Ns,{})}),children:[e.jsx(K,{path:"/dashboard",element:e.jsx(yr,{})}),e.jsx(K,{path:"/finance",element:e.jsx(wr,{})}),e.jsx(K,{path:"/expenses/add",element:e.jsx(vr,{})}),e.jsx(K,{path:"/expenses/edit/:id",element:e.jsx(_r,{})}),e.jsx(K,{path:"/expenses",element:e.jsx(Dr,{})}),e.jsx(K,{path:"/expenses/reports",element:e.jsx(Fr,{})}),e.jsx(K,{path:"/investments",element:e.jsx(Ur,{})}),e.jsx(K,{path:"/products",element:e.jsx(Yr,{})}),e.jsx(K,{path:"/products/:id",element:e.jsx(cn,{})}),e.jsx(K,{path:"/calculator",element:e.jsx(xn,{})}),e.jsx(K,{path:"/vendors",element:e.jsx(bn,{})}),e.jsx(K,{path:"/vendors/:id",element:e.jsx(Sn,{})}),e.jsx(K,{path:"/batches",element:e.jsx(Mn,{})}),e.jsx(K,{path:"/batches/:id",element:e.jsx(qn,{})}),e.jsx(K,{path:"/ingredients",element:e.jsx(Un,{})}),e.jsx(K,{path:"/ingredients/:id",element:e.jsx(Gn,{})}),e.jsx(K,{path:"/compliance",element:e.jsx(Kn,{})}),e.jsx(K,{path:"/compliance/:id",element:e.jsx(rl,{})}),e.jsx(K,{path:"/chat",element:e.jsx(hl,{})}),e.jsx(K,{path:"/settings",element:e.jsx(pl,{})}),e.jsx(K,{path:"/notifications",element:e.jsx(bl,{})})]}),e.jsx(K,{path:"/admin/user-approvals",element:e.jsx(ws,{adminOnly:!0,children:e.jsx(Ns,{})}),children:e.jsx(K,{index:!0,element:e.jsx(ul,{})})}),e.jsx(K,{path:"*",element:e.jsx(Zt,{to:"/",replace:!0})})]}),o&&e.jsx(pr,{})]})}function gl(){return e.jsx(xa,{children:e.jsxs(_a,{children:[e.jsx(xr,{}),e.jsx(cr,{}),e.jsx(mr,{}),e.jsx(fl,{})]})})}Ls(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(gl,{})}));
