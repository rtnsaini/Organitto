import{r as d,b as na,N as Ds,u as ie,d as Kt,O as la,L as ye,e as Ye,B as oa,f as ia,h as K}from"./react-vendor-B1UGq2v7.js";import{c as da}from"./supabase-vendor-DKRvmUUb.js";import{f as Jt,a as $,s as dt,b as hs,e as ps,c as ca,i as Gt,d as X,g as Ms,h as xa,j as ma}from"./date-vendor-Y3GY3t4o.js";import{R as pe,L as Dt,C as Ie,X as Fe,Y as Te,T as ge,a as ut,b as Le,P as Mt,c as Pt,d as Et,e as ha,A as pa,B as At,f as ct}from"./chart-vendor-DZhzrXBW.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const u of h.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&g(u)}).observe(document,{childList:!0,subtree:!0});function c(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function g(r){if(r.ep)return;r.ep=!0;const h=c(r);fetch(r.href,h)}})();var Ps={exports:{}},It={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ba=d,ua=Symbol.for("react.element"),ga=Symbol.for("react.fragment"),fa=Object.prototype.hasOwnProperty,ja=ba.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ya={key:!0,ref:!0,__self:!0,__source:!0};function Es(s,n,c){var g,r={},h=null,u=null;c!==void 0&&(h=""+c),n.key!==void 0&&(h=""+n.key),n.ref!==void 0&&(u=n.ref);for(g in n)fa.call(n,g)&&!ya.hasOwnProperty(g)&&(r[g]=n[g]);if(s&&s.defaultProps)for(g in n=s.defaultProps,n)r[g]===void 0&&(r[g]=n[g]);return{$$typeof:ua,type:s,key:h,ref:u,props:r,_owner:ja.current}}It.Fragment=ga;It.jsx=Es;It.jsxs=Es;Ps.exports=It;var e=Ps.exports,As,bs=na;As=bs.createRoot,bs.hydrateRoot;const wa="https://zvrkldiptatwsnflmvbp.supabase.co",Na="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2cmtsZGlwdGF0d3NuZmxtdmJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTU4MDMsImV4cCI6MjA4MTI3MTgwM30.cPJdSpxdkQxD6TfgJ4qsnNRTJWPwQvjTlhZPVcHR17A",C=da(wa,Na),Is=d.createContext(void 0);function va({children:s}){const[n,c]=d.useState(null),[g,r]=d.useState(null),[h,u]=d.useState(!0);d.useEffect(()=>{C.auth.getSession().then(({data:{session:w}})=>{r(w),w?.user?m(w.user.id):u(!1)});const{data:{subscription:a}}=C.auth.onAuthStateChange((w,b)=>{r(b),b?.user?m(b.user.id):(c(null),u(!1))});return()=>a.unsubscribe()},[]);const m=async a=>{try{const{data:w,error:b}=await C.from("users").select("*").eq("id",a).maybeSingle();if(b)throw b;w&&c(w)}catch(w){console.error("Error loading user profile:",w)}finally{u(!1)}},l={session:g,user:n,loading:h,signIn:async(a,w)=>{if(!a||!w)return{error:new Error("Please enter email and password")};try{const{data:b,error:k}=await C.auth.signInWithPassword({email:a,password:w});if(k)throw k;if(b.user){const{data:_,error:y}=await C.from("users").select("approval_status, rejection_reason").eq("id",b.user.id).maybeSingle();if(y)throw y;if(_?.approval_status==="pending")return await C.auth.signOut(),{error:new Error("Your account is pending approval. Please wait for admin to approve your registration.")};if(_?.approval_status==="rejected"){await C.auth.signOut();const j=_.rejection_reason?`
Reason: ${_.rejection_reason}`:"";return{error:new Error(`Your registration was not approved.${j}

Please contact admin for more information.`)}}await m(b.user.id)}return{error:null}}catch(b){return{error:new Error(b.message||"Invalid login credentials")}}},signUp:async(a,w,b,k,_="partner")=>{if(!a||!w||!b)return{error:new Error("Please fill all required fields")};try{const{data:y,error:j}=await C.auth.signUp({email:a,password:w});if(j)throw j;if(!y.user)throw new Error("Failed to create user");const x=_==="admin"?"approved":"pending",o=_==="admin"?new Date().toISOString():null,{error:i}=await C.from("users").insert({id:y.user.id,email:a,name:b,phone:k||null,role:_,approval_status:x,approved_at:o});if(i)throw i;return _==="admin"?await m(y.user.id):await C.auth.signOut(),{error:null}}catch(y){return{error:new Error(y.message||"Failed to create account")}}},signOut:async()=>{await C.auth.signOut(),c(null),r(null)}};return e.jsx(Is.Provider,{value:l,children:s})}function H(){const s=d.useContext(Is);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ka={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),F=(s,n)=>{const c=d.forwardRef(({color:g="currentColor",size:r=24,strokeWidth:h=2,absoluteStrokeWidth:u,className:m="",children:p,...f},t)=>d.createElement("svg",{ref:t,...ka,width:r,height:r,stroke:g,strokeWidth:u?Number(h)*24/Number(r):h,className:["lucide",`lucide-${_a(s)}`,m].join(" "),...f},[...n.map(([l,a])=>d.createElement(l,a)),...Array.isArray(p)?p:[p]]));return c.displayName=`${s}`,c};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=F("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=F("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=F("AlertOctagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=F("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=F("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=F("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=F("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=F("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=F("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=F("Beaker",[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=F("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=F("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=F("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=F("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=F("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=F("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=F("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=F("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=F("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=F("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=F("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=F("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=F("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=F("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=F("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=F("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=F("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=F("FileSearch",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"1vg67v"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=F("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=F("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=F("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=F("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=F("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=F("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=F("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=F("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=F("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=F("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=F("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=F("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=F("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=F("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=F("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=F("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=F("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=F("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=F("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=F("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=F("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=F("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=F("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=F("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=F("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=F("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=F("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=F("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=F("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=F("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=F("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=F("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=F("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=F("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=F("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=F("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=F("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=F("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=F("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=F("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=F("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=F("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=F("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=F("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=F("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=F("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=F("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=F("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=F("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=F("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=F("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=F("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=F("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=F("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=F("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=F("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=F("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=F("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=F("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=F("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=F("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=F("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=F("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=F("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=F("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=F("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function fs({children:s,adminOnly:n=!1}){const{user:c,loading:g}=H();return g?e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(as,{className:"w-12 h-12 text-primary animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading..."})]})}):c?n&&c.role!=="admin"?e.jsx("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card p-10 text-center max-w-md",children:[e.jsx(Qa,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-primary mb-3",children:"Access Denied"}),e.jsx("p",{className:"text-primary/70 mb-6",children:"You don't have permission to access this page. This area is restricted to administrators only."}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-6 py-3 bg-gradient-primary text-white font-bold rounded-button hover:shadow-lg",children:"Go Back"})]})}):e.jsx(e.Fragment,{children:s}):e.jsx(Ds,{to:"/login",replace:!0})}function rr({onMenuClick:s}){const{user:n,signOut:c}=H(),g=ie(),[r,h]=d.useState(!1),[u,m]=d.useState(!1),[p,f]=d.useState([]),[t,l]=d.useState(0),[a,w]=d.useState(""),[b]=d.useState(3),k=p.filter(o=>!o.is_read).length;d.useEffect(()=>{if(n?.id){_(),n.role==="admin"&&y();const o=C.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${n.id}`},()=>{_()}).subscribe();return()=>{C.removeChannel(o)}}},[n?.id,n?.role]);const _=async()=>{if(n?.id)try{const{data:o,error:i}=await C.from("notifications").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}).limit(5);if(i)throw i;f(o||[])}catch(o){console.error("Error fetching notifications:",o)}},y=async()=>{try{const{count:o,error:i}=await C.from("users").select("*",{count:"exact",head:!0}).eq("approval_status","pending");if(i)throw i;l(o||0)}catch(o){console.error("Error fetching pending users count:",o)}},j=async()=>{await c(),g("/")},x=o=>{o.key==="Enter"&&a.trim()&&console.log("Search for:",a)};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("button",{className:"mobile-menu-btn",onClick:s,children:e.jsx(qa,{size:20})}),e.jsxs("div",{className:"logo desktop-only",children:[e.jsx("span",{className:"logo-icon",children:"ðŸŒ¿"}),e.jsx("span",{className:"logo-text",children:"Organitto"})]}),e.jsxs("div",{className:"search-bar desktop-only",children:[e.jsx(Ke,{size:16}),e.jsx("input",{type:"text",placeholder:"Search...",className:"search-input",value:a,onChange:o=>w(o.target.value),onKeyDown:x}),e.jsx("kbd",{className:"search-kbd",children:"âŒ˜ K"})]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("button",{className:"header-icon-btn",onClick:()=>g("/chat"),title:"Chat",children:[e.jsx(Ra,{size:18}),b>0&&e.jsx("span",{className:"header-badge",children:b})]}),e.jsxs("div",{className:"header-dropdown-container",children:[e.jsxs("button",{className:"header-icon-btn",onClick:()=>h(!r),title:"Notifications",children:[e.jsx(Ge,{size:18}),k>0&&e.jsx("span",{className:"header-badge",children:k})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-dropdown-overlay",onClick:()=>h(!1)}),e.jsxs("div",{className:"header-dropdown notifications-dropdown",children:[e.jsxs("div",{className:"dropdown-header",children:[e.jsx("h3",{children:"Notifications"}),k>0&&e.jsxs("span",{className:"dropdown-badge",children:[k," new"]})]}),e.jsx("div",{className:"dropdown-body",children:p.length>0?p.map(o=>e.jsxs("div",{className:`notification-item ${o.is_read?"":"unread"}`,children:[e.jsx("div",{className:`notification-dot ${o.is_read?"":"active"}`}),e.jsxs("div",{className:"notification-content",children:[e.jsx("p",{className:"notification-title",children:o.title}),e.jsx("p",{className:"notification-message",children:o.message}),e.jsx("p",{className:"notification-time",children:Jt(new Date(o.created_at),{addSuffix:!0})})]})]},o.id)):e.jsxs("div",{className:"dropdown-empty",children:[e.jsx(Ge,{size:32}),e.jsx("p",{children:"No notifications"})]})}),e.jsx("div",{className:"dropdown-footer",children:e.jsx("button",{onClick:()=>{h(!1),g("/notifications")},children:"View All Notifications"})})]})]})]}),e.jsxs("div",{className:"header-dropdown-container",children:[e.jsxs("button",{className:"user-menu",onClick:()=>m(!u),children:[e.jsx("div",{className:"user-avatar",children:n?.name?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{className:"user-name desktop-only",children:n?.name}),e.jsx(Ts,{size:16,className:"desktop-only"})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-dropdown-overlay",onClick:()=>m(!1)}),e.jsxs("div",{className:"header-dropdown user-dropdown",children:[e.jsxs("div",{className:"dropdown-header user-header",children:[e.jsx("div",{className:"user-avatar large",children:n?.name?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-info-name",children:n?.name}),e.jsx("div",{className:"user-info-email",children:n?.email}),n?.role&&e.jsxs("div",{className:"user-info-role",children:[e.jsx(pt,{size:12}),e.jsx("span",{children:n.role})]})]})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("div",{className:"dropdown-body",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>{m(!1),g("/settings")},children:[e.jsx(ze,{size:18}),e.jsx("span",{children:"Profile"})]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>{m(!1),g("/settings")},children:[e.jsx(Ws,{size:18}),e.jsx("span",{children:"Settings"})]}),n?.role==="admin"&&e.jsxs("button",{className:"dropdown-item",onClick:()=>{m(!1),g("/admin/user-approvals")},children:[e.jsx(pt,{size:18}),e.jsx("span",{children:"User Approvals"}),t>0&&e.jsx("span",{className:"dropdown-badge",children:t})]})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsx("div",{className:"dropdown-body",children:e.jsxs("button",{className:"dropdown-item danger",onClick:j,children:[e.jsx(zs,{size:18}),e.jsx("span",{children:"Logout"})]})})]})]})]})]})]})}const ce=({icon:s,label:n,path:c,active:g,badge:r,hasDropdown:h,isOpen:u,onClick:m,isSubItem:p})=>{const f=ie(),t=()=>{m?m():c&&f(c)};return e.jsxs("button",{className:`nav-item ${g?"active":""} ${p?"sub-item":""}`,onClick:t,children:[s&&e.jsx("span",{className:"nav-icon",children:s}),e.jsx("span",{className:"nav-label",children:n}),r&&r>0&&e.jsx("span",{className:"nav-badge",children:r}),h&&e.jsx(Ls,{className:`nav-chevron ${u?"open":""}`})]})};function nr({isOpen:s,onClose:n}){const{user:c,signOut:g}=H(),r=Kt(),h=ie(),[u,m]=d.useState(!1),[p,f]=d.useState(0),t=w=>r.pathname===w,l=()=>r.pathname.startsWith("/expenses")||r.pathname.startsWith("/investments")||r.pathname==="/finance",a=async()=>{await g(),h("/")};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`sidebar ${s?"open":""}`,children:[e.jsxs("div",{className:"sidebar-logo mobile-only",children:[e.jsx("span",{className:"logo-icon",children:"ðŸŒ¿"}),e.jsx("span",{className:"logo-text",children:"Organitto"})]}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:"nav-section",children:[e.jsx(ce,{icon:e.jsx(La,{size:18}),label:"Dashboard",path:"/dashboard",active:t("/dashboard")}),e.jsx(ce,{icon:e.jsx(Xa,{size:18}),label:"Finance",hasDropdown:!0,isOpen:u,onClick:()=>m(!u),active:l()}),u&&e.jsxs("div",{className:"nav-dropdown",children:[e.jsx(ce,{label:"Add Expense",path:"/expenses/add",isSubItem:!0,active:t("/expenses/add")}),e.jsx(ce,{label:"Expense List",path:"/expenses",isSubItem:!0,active:t("/expenses")}),e.jsx(ce,{label:"Reports",path:"/expenses/reports",isSubItem:!0,active:t("/expenses/reports")}),e.jsx(ce,{label:"Investments",path:"/investments",isSubItem:!0,active:t("/investments")})]}),e.jsx(ce,{icon:e.jsx(Ia,{size:18}),label:"Products",path:"/products",active:t("/products")}),e.jsx(ce,{icon:e.jsx(Fs,{size:18}),label:"Cost Calculator",path:"/calculator",active:t("/calculator")}),e.jsx(ce,{icon:e.jsx(we,{size:18}),label:"Vendors",path:"/vendors",active:t("/vendors")}),e.jsx(ce,{icon:e.jsx(ne,{size:18}),label:"Batches",path:"/batches",active:t("/batches")}),e.jsx(ce,{icon:e.jsx(Oe,{size:18}),label:"Ingredients",path:"/ingredients",active:t("/ingredients")}),e.jsx(ce,{icon:e.jsx(Ga,{size:18}),label:"Compliance",path:"/compliance",active:t("/compliance")}),c?.role==="admin"&&e.jsx(ce,{icon:e.jsx(Za,{size:18}),label:"User Approvals",path:"/admin/user-approvals",active:t("/admin/user-approvals"),badge:p})]}),e.jsxs("div",{className:"nav-section nav-section-bottom",children:[e.jsx(ce,{icon:e.jsx(Ws,{size:18}),label:"Settings",path:"/settings",active:t("/settings")}),e.jsx(ce,{icon:e.jsx(zs,{size:18}),label:"Logout",onClick:a})]})]})]}),s&&e.jsx("div",{className:"sidebar-overlay",onClick:n})]})}function js(){const[s,n]=d.useState(!1),c=Kt(),g=()=>{n(!s)},r=()=>{n(!1)};return d.useEffect(()=>{window.innerWidth<768&&r()},[c.pathname]),d.useEffect(()=>{const h=()=>{window.innerWidth>=768&&n(!1)};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]),d.useEffect(()=>{const h=u=>{u.key==="Escape"&&s&&r()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[s]),e.jsxs("div",{className:"app-layout",children:[e.jsx(rr,{onMenuClick:g}),e.jsxs("div",{className:"app-body",children:[e.jsx(nr,{isOpen:s,onClose:r}),e.jsx("main",{className:"main-content",children:e.jsx(la,{})})]})]})}function lr(){const[s,n]=d.useState(!1),[c,g]=d.useState(!1),[r,h]=d.useState(null);return d.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&g(!0);const m=f=>{f.preventDefault(),h(f),n(!0)},p=()=>{g(!0),n(!1),h(null)};return window.addEventListener("beforeinstallprompt",m),window.addEventListener("appinstalled",p),()=>{window.removeEventListener("beforeinstallprompt",m),window.removeEventListener("appinstalled",p)}},[]),{isInstallable:s,isInstalled:c,installApp:async()=>{if(!r)return!1;try{await r.prompt();const{outcome:m}=await r.userChoice;return m==="accepted"?(h(null),n(!1),!0):!1}catch(m){return console.error("Error installing app:",m),!1}}}}function or(){const[s,n]=d.useState(navigator.onLine);return d.useEffect(()=>{const c=()=>n(!0),g=()=>n(!1);return window.addEventListener("online",c),window.addEventListener("offline",g),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",g)}},[]),s}function ir(){const[s,n]=d.useState(!1),[c,g]=d.useState(null);return d.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(h=>{g(h),h.addEventListener("updatefound",()=>{const u=h.installing;u&&u.addEventListener("statechange",()=>{u.state==="installed"&&navigator.serviceWorker.controller&&n(!0)})})})},[]),{isUpdateAvailable:s,updateServiceWorker:()=>{c?.waiting&&(c.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())}}}function dr(){const{isInstallable:s,installApp:n}=lr(),[c,g]=d.useState(!1),[r,h]=d.useState(!1);d.useEffect(()=>{localStorage.getItem("pwa-install-dismissed")&&h(!0)},[]),d.useEffect(()=>{if(s&&!r){const p=setTimeout(()=>{g(!0)},3e3);return()=>clearTimeout(p)}},[s,r]);const u=async()=>{await n()&&g(!1)},m=()=>{g(!1),h(!0),localStorage.setItem("pwa-install-dismissed","true")};return!c||!s?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-primary/10 p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:"ðŸŒ¿"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Install Organitto"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"Install our app for quick access, offline support, and a native experience!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:u,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Install"]}),e.jsx("button",{onClick:m,className:"px-4 py-2.5 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Not Now"})]})]}),e.jsx("button",{onClick:m,className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(de,{className:"w-5 h-5 text-dark-brown/40"})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"âš¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Fast"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“±"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Native"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“¡"}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Offline"})]})]})})]})})}function cr(){const s=or(),[n,c]=d.useState(!1),[g,r]=d.useState(!1);return d.useEffect(()=>{s?n&&s&&(r(!0),setTimeout(()=>{c(!1),r(!1)},3e3)):(c(!0),r(!1))},[s,n]),n?e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${g?"bg-gradient-to-r from-sage to-primary":"bg-gradient-to-r from-accent to-soft-red"}`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-center gap-3 text-white",children:g?e.jsxs(e.Fragment,{children:[e.jsx(tr,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"Back online! Data syncing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(er,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"You're offline"}),e.jsx("span",{className:"hidden sm:inline text-sm opacity-90",children:"- Changes will sync when you reconnect"})]})})})}):null}function xr(){const{isUpdateAvailable:s,updateServiceWorker:n}=ir(),[c,g]=d.useState(!1);return!s||c?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 animate-slide-up",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-soft-lg border-2 border-accent/20 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(gs,{className:"w-6 h-6 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-1",children:"Update Available"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-4",children:"A new version of Organitto is ready. Update now to get the latest features!"}),e.jsxs("button",{onClick:n,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:[e.jsx(gs,{className:"w-4 h-4"}),"Update Now"]})]}),e.jsx("button",{onClick:()=>g(!0),className:"p-1 hover:bg-dark-brown/5 rounded-lg transition-colors flex-shrink-0",children:e.jsx(de,{className:"w-5 h-5 text-dark-brown/40"})})]})})})}const mr=[{icon:St,label:"Add Expense",path:"/expenses/new",color:"from-secondary to-accent"},{icon:ne,label:"Add Product",path:"/products",color:"from-primary to-sage"},{icon:Ta,label:"Add Batch",path:"/batches",color:"from-sage to-primary"},{icon:$e,label:"Record Sale",path:"/expenses/new",color:"from-accent to-secondary"},{icon:se,label:"Quick Note",path:"/chat",color:"from-primary to-accent"}];function hr(){const[s,n]=d.useState(!1),c=ie(),g=r=>{n(!1),c(r)};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-dark-brown/20 backdrop-blur-sm",onClick:()=>n(!1)}),e.jsx("div",{className:"relative z-10 flex flex-col-reverse gap-4 mb-4",children:mr.map((r,h)=>{const u=r.icon;return e.jsxs("button",{onClick:()=>g(r.path),className:"group flex items-center gap-4 animate-scale-in",style:{animationDelay:`${h*50}ms`},children:[e.jsx("span",{className:"glass-card px-4 py-2 font-bold text-primary opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap shadow-glow hidden md:block",children:r.label}),e.jsx("div",{className:`w-14 h-14 md:w-12 md:h-12 bg-gradient-to-br ${r.color} rounded-full flex items-center justify-center shadow-glow hover:shadow-glow-lg transition-all duration-300 hover:scale-110 cursor-pointer`,children:e.jsx(u,{className:"w-6 h-6 md:w-5 md:h-5 text-white",strokeWidth:2.5})})]},r.label)})})]}),e.jsxs("button",{onClick:()=>n(!s),className:`relative z-10 w-16 h-16 md:w-14 md:h-14 bg-gradient-primary rounded-full flex items-center justify-center shadow-glow hover:shadow-glow-lg transition-all duration-300 hover:scale-110 active:scale-95 ${s?"rotate-45":"rotate-0"}`,"aria-label":s?"Close quick actions":"Open quick actions",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold opacity-0 hover:opacity-20 rounded-full transition-opacity duration-300"}),s?e.jsx(de,{className:"w-7 h-7 md:w-6 md:h-6 text-white relative z-10",strokeWidth:3}):e.jsx(Q,{className:"w-7 h-7 md:w-6 md:h-6 text-white relative z-10",strokeWidth:3})]}),!s&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-accent rounded-full animate-pulse"})]})}const ke=()=>e.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0",children:[...Array(6)].map((s,n)=>e.jsx("div",{className:"leaf absolute",style:{left:`${10+n*16}%`,animationDelay:`${n*2}s`},children:e.jsx(Oe,{className:"text-[#2D5016]",size:24+Math.random()*12,style:{transform:`rotate(${Math.random()*360}deg)`,opacity:.06}})},n))}),Z=({children:s,className:n="",hover:c=!0,tilt:g=!1,onClick:r})=>{const h="glass-card p-6",u=c?"hover:shadow-xl":"",m=g?"card-3d":"",p=r?"cursor-pointer":"";return e.jsx("div",{className:`${h} ${u} ${m} ${p} ${n}`,onClick:r,children:s})},be=({children:s,variant:n="primary",size:c="md",className:g="",onClick:r,disabled:h=!1,type:u="button",icon:m})=>{const p="inline-flex items-center justify-center gap-2 font-semibold transition-all duration-300",f={primary:"btn-premium",gold:"btn-gold",neu:"btn-neu text-primary",outline:"border-2 border-primary text-primary hover:bg-primary hover:text-white bg-transparent"},t={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg"},l=h?"opacity-50 cursor-not-allowed":"";return e.jsxs("button",{type:u,onClick:r,disabled:h,className:`${p} ${f[n]} ${t[c]} ${l} ${g}`,children:[m&&e.jsx("span",{children:m}),s]})};function pr(){const s=ie();return e.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(ke,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-20",children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:e.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-12 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-30 group-hover:opacity-50 transition-opacity duration-700"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-32 md:h-40 w-auto object-contain relative z-10 drop-shadow-2xl transform group-hover:scale-110 transition-transform duration-500"})]})}),e.jsxs("div",{className:"mb-6 inline-flex items-center gap-2 px-4 py-2 glass-card",children:[e.jsx(Ya,{className:"w-4 h-4 text-gold"}),e.jsx("span",{className:"text-sm font-bold text-gradient",children:"Premium Ayurvedic Management"})]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-heading font-bold text-primary mb-6 leading-tight animate-fade-in",children:["Elevate Your"," ",e.jsx("span",{className:"text-gradient-gold",children:"Ayurvedic"}),e.jsx("br",{}),"Business"]}),e.jsx("p",{className:"text-xl md:text-2xl text-primary/70 mb-12 max-w-2xl mx-auto leading-relaxed font-medium",children:"The most sophisticated platform for managing your Ayurvedic practice with elegance and precision"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center items-center mb-20",children:[e.jsx(be,{variant:"primary",size:"lg",onClick:()=>s("/register"),className:"min-w-[220px] text-lg shadow-colored",children:"Start Your Journey"}),e.jsx(be,{variant:"gold",size:"lg",onClick:()=>s("/login"),className:"min-w-[220px] text-lg",children:"Sign In"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mt-24",children:[e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(Oe,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Natural Flow"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Manage your practice with intuitive tools that respect the natural rhythm of Ayurvedic care"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float-delayed",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-gold rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-glow transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(te,{className:"w-8 h-8 text-primary-dark"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Premium Analytics"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Gain comprehensive insights into your business health with sophisticated reporting tools"})]}),e.jsxs("div",{className:"glass-card p-8 card-3d group animate-float",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-primary rounded-2xl flex items-center justify-center mb-6 mx-auto shadow-colored transform group-hover:rotate-12 transition-transform duration-300",children:e.jsx(pt,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"Secure & Reliable"}),e.jsx("p",{className:"text-primary/70 leading-relaxed text-lg",children:"Enterprise-grade security ensuring your data is protected with the highest standards"})]})]})]})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-48 bg-gradient-to-t from-primary/10 via-gold/5 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 text-center z-20",children:e.jsx("p",{className:"text-sm text-primary/50 font-medium",children:"Trusted by leading Ayurvedic practitioners worldwide"})})]})}function br(){const s=ie(),{signIn:n,user:c,loading:g}=H(),[r,h]=d.useState(""),[u,m]=d.useState(""),[p,f]=d.useState(""),[t,l]=d.useState(!1);d.useEffect(()=>{c&&!g&&s("/dashboard")},[c,g,s]);const a=async w=>{w.preventDefault(),f(""),l(!0);try{const{error:b}=await n(r,u);b&&(f(b.message||"Failed to sign in. Please check your credentials."),l(!1))}catch{f("An unexpected error occurred. Please try again."),l(!1)}};return e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(ke,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(Re,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-md",children:[e.jsxs("div",{className:"glass-card p-8 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-300"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto",className:"h-16 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-200"})]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Welcome back"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Sign in to your account"})]}),p&&e.jsxs("div",{className:"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2 animate-slide-down",children:[e.jsx(ue,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:p})]}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Email address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),e.jsx("input",{id:"email",type:"email",value:r,onChange:w=>h(w.target.value),className:"w-full h-10 pl-10 pr-4 text-sm border border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 transition-all duration-150 focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10",placeholder:"you@example.com",required:!0,disabled:t})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 z-10"}),e.jsx("input",{id:"password",type:"password",value:u,onChange:w=>m(w.target.value),className:"w-full h-10 pl-10 pr-4 text-sm border border-gray-200 rounded-lg bg-white text-gray-900 placeholder-gray-400 transition-all duration-150 focus:outline-none focus:border-primary focus:ring-3 focus:ring-primary/10",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:t})]})]}),e.jsx("button",{type:"submit",disabled:t,className:"w-full h-10 mt-6 bg-primary hover:bg-primary-dark text-white text-sm font-medium rounded-lg transition-all duration-150 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:t?"Signing in...":"Sign in"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx(ye,{to:"/register",className:"text-primary font-semibold hover:text-primary-dark transition-colors",children:"Sign up"})]})})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center justify-center gap-1.5",children:[e.jsx(Oe,{className:"w-3.5 h-3.5"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function ur(){const s=ie(),{signUp:n,user:c,loading:g}=H(),[r,h]=d.useState({name:"",email:"",phone:"",password:"",confirmPassword:""}),[u,m]=d.useState(""),[p,f]=d.useState(!1),[t,l]=d.useState(!1),[a,w]=d.useState(!1);d.useEffect(()=>{if(c&&!g){p&&f(!1);const _=setTimeout(()=>{s("/dashboard")},t?2e3:0);return()=>clearTimeout(_)}},[c,g,p,t,s]);const b=async _=>{if(_.preventDefault(),m(""),r.password.length<8){m("Password must be at least 8 characters long");return}if(r.password!==r.confirmPassword){m("Passwords do not match");return}f(!0);try{const{count:y,error:j}=await C.from("users").select("*",{count:"exact",head:!0});if(j)throw new Error("Failed to check existing users");const x=y===0,o=x?"admin":"partner";x&&l(!0);const{error:i}=await n(r.email,r.password,r.name,r.phone,o);i?(m(i.message||"Failed to create account. Please try again."),f(!1),l(!1)):x||(w(!0),f(!1))}catch(y){m(y.message||"An unexpected error occurred. Please try again."),f(!1),l(!1)}},k=_=>{h({...r,[_.target.name]:_.target.value})};return t?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(ke,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-sage to-primary p-6 rounded-full shadow-glow",children:e.jsx(G,{className:"w-12 h-12 text-cream",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Welcome, Founder!"}),e.jsx("p",{className:"text-primary/70 mb-4 text-lg font-medium",children:"Your account has been created successfully. You have full access to all features."}),e.jsx("p",{className:"text-primary/50 text-sm font-medium animate-pulse",children:"Redirecting to dashboard..."})]})})]}):a?e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(ke,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"glass-card p-10 text-center animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-8 animate-float",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 blur-2xl opacity-40 rounded-full"}),e.jsx("div",{className:"relative bg-gradient-to-br from-blue-500 to-cyan-600 p-6 rounded-full shadow-glow",children:e.jsx(G,{className:"w-12 h-12 text-white",strokeWidth:2})})]})}),e.jsx("h1",{className:"font-heading text-4xl font-bold text-gradient mb-4",children:"Registration Successful!"}),e.jsx("p",{className:"text-primary/70 mb-6 text-lg font-medium",children:"Your account has been created and is pending admin approval."}),e.jsx("div",{className:"glass-card bg-blue-50/50 p-4 mb-6",children:e.jsx("p",{className:"text-primary/60 text-sm font-medium",children:"You will receive a notification once your account is approved. Please check back later or wait for an email confirmation."})}),e.jsx(ye,{to:"/login",children:e.jsx(be,{variant:"primary",size:"lg",className:"w-full",children:"Go to Login"})})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden flex items-center justify-center p-4",style:{background:"radial-gradient(circle at 20% 50%, rgba(27, 77, 62, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%), #F5F1E8"},children:[e.jsx(ke,{}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-primary opacity-5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-gold opacity-5 blur-3xl"}),e.jsxs("button",{onClick:()=>s("/"),className:"absolute top-8 left-8 px-4 py-2 glass-card hover:shadow-md transition-all duration-300 font-semibold flex items-center gap-2 text-primary group",children:[e.jsx(Re,{className:"w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-lg",children:[e.jsxs("div",{className:"glass-card p-10 md:p-12 animate-scale-in",children:[e.jsx("div",{className:"flex items-center justify-center mb-10 animate-float",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-gold blur-xl opacity-30 group-hover:opacity-50 transition-opacity duration-500"}),e.jsx("img",{src:"/whatsapp_image_2025-10-29_at_11.28.27-removebg-preview.png",alt:"Organitto - The Organic Choice",className:"h-20 w-auto object-contain relative z-10 transform group-hover:scale-105 transition-transform duration-300"})]})}),e.jsx("h1",{className:"font-heading text-5xl font-bold text-gradient text-center mb-3",children:"Create Account"}),e.jsx("p",{className:"text-primary/60 text-center mb-10 text-lg font-medium",children:"Join Organitto and start managing your business"}),u&&e.jsxs("div",{className:"mb-8 p-5 bg-gradient-to-r from-red-50/90 to-red-100/90 backdrop-blur-sm border border-red-200 rounded-button flex items-start gap-3 animate-slide-down",children:[e.jsx(ue,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-700 font-medium",children:u})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"name",name:"name",type:"text",value:r.name,onChange:k,className:"input-float w-full pl-12",placeholder:"John Doe",required:!0,disabled:p})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"email",name:"email",type:"email",value:r.email,onChange:k,className:"input-float w-full pl-12",placeholder:"you@example.com",required:!0,disabled:p})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"phone",name:"phone",type:"tel",value:r.phone,onChange:k,className:"input-float w-full pl-12",placeholder:"+1 (555) 000-0000",required:!0,disabled:p})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"password",name:"password",type:"password",value:r.password,onChange:k,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:p,minLength:8})]}),e.jsx("p",{className:"text-xs text-primary/50 mt-2 ml-1 font-medium",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-bold text-primary mb-3 ml-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",value:r.confirmPassword,onChange:k,className:"input-float w-full pl-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:p})]})]}),e.jsx(be,{type:"submit",variant:"primary",size:"lg",disabled:p,className:"w-full text-lg mt-8",children:p?"Creating Account...":"Create Account"})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-primary/70 font-medium",children:["Already have an account?"," ",e.jsx(ye,{to:"/login",className:"text-gradient-gold font-bold hover:underline transition-all",children:"Sign in here"})]})})]}),e.jsx("div",{className:"text-center mt-8 glass-card inline-block px-6 py-3 mx-auto",children:e.jsxs("p",{className:"text-primary/50 text-sm font-medium flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Organitto - Premium Ayurvedic Management"]})})]})]})}function Ks({data:s}){const n=({active:c,payload:g,label:r})=>c&&g&&g.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-2",children:r}),g.map((h,u)=>e.jsxs("p",{className:"text-sm",style:{color:h.color},children:[h.name,": â‚¹",h.value.toLocaleString("en-IN")]},u))]}):null;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Investment vs Expense Trend"}),e.jsx(pe,{width:"100%",height:300,children:e.jsxs(Dt,{data:s,children:[e.jsx(Ie,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Fe,{dataKey:"month",stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"}}),e.jsx(Te,{stroke:"#3E2723",style:{fontSize:"12px",fontFamily:"Nunito"},tickFormatter:c=>`â‚¹${(c/1e3).toFixed(0)}k`}),e.jsx(ge,{content:e.jsx(n,{})}),e.jsx(ut,{wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}}),e.jsx(Le,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,dot:{fill:"#2D5016",r:5},activeDot:{r:7},name:"Investments"}),e.jsx(Le,{type:"monotone",dataKey:"expenses",stroke:"#C85A3E",strokeWidth:3,dot:{fill:"#C85A3E",r:5},activeDot:{r:7},name:"Expenses"})]})})]})}const ys=["#2D5016","#C85A3E","#D4AF37","#87A96B","#3E2723","#D84315"];function Js({data:s}){const n=({active:g,payload:r})=>g&&r&&r.length?e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-soft-lg border-2 border-primary/10",children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:r[0].name}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["â‚¹",r[0].value.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[(r[0].value/s.reduce((h,u)=>h+u.value,0)*100).toFixed(1),"% of total"]})]}):null,c=g=>`${g.name}`;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-6",children:"Category-wise Expenses"}),e.jsx(pe,{width:"100%",height:300,children:e.jsxs(Mt,{children:[e.jsx(Pt,{data:s,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",label:c,children:s.map((g,r)=>e.jsx(Et,{fill:ys[r%ys.length]},`cell-${r}`))}),e.jsx(ge,{content:e.jsx(n,{})}),e.jsx(ut,{verticalAlign:"bottom",height:36,wrapperStyle:{paddingTop:"20px",fontFamily:"Nunito",fontSize:"14px"}})]})})]})}const gr=s=>{switch(s){case"expense":return{icon:je,color:"text-secondary",bg:"bg-secondary/20"};case"investment":return{icon:te,color:"text-primary",bg:"bg-primary/20"};case"product":return{icon:ne,color:"text-accent",bg:"bg-accent/20"};default:return{icon:se,color:"text-dark-brown",bg:"bg-dark-brown/20"}}};function fr({activities:s}){return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Recent Activity"}),e.jsxs("button",{className:"text-sm font-semibold text-primary hover:text-sage transition-colors duration-300 flex items-center gap-1",children:["View All",e.jsx(Zt,{className:"w-4 h-4"})]})]}),s.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-dark-brown/50",children:"No recent activity"})}):e.jsx("div",{className:"space-y-4",children:s.map(n=>{const{icon:c,color:g,bg:r}=gr(n.activity_type),h=Jt(new Date(n.created_at),{addSuffix:!0});return e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-cream/30 rounded-xl hover:bg-cream/50 transition-all duration-300",children:[e.jsx("div",{className:`w-10 h-10 ${r} rounded-full flex items-center justify-center flex-shrink-0`,children:e.jsx(c,{className:`w-5 h-5 ${g}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-dark-brown leading-relaxed mb-1",children:n.description}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:h})]})]},n.id)})})]})}function jr(){const{user:s}=H(),[n,c]=d.useState({totalInvestments:0,totalExpenses:0,activeProducts:0}),[g,r]=d.useState([]),[h,u]=d.useState(!0),m=$(new Date,"EEEE, MMMM d, yyyy"),p=[{month:"Jul",investments:85e3,expenses:52e3},{month:"Aug",investments:92e3,expenses:61e3},{month:"Sep",investments:78e3,expenses:48e3},{month:"Oct",investments:105e3,expenses:72e3},{month:"Nov",investments:118e3,expenses:68e3},{month:"Dec",investments:125e3,expenses:75e3}],f=[{name:"Raw Materials",value:125e3},{name:"Labor",value:85e3},{name:"Marketing",value:42e3},{name:"Packaging",value:38e3},{name:"Utilities",value:28e3},{name:"Other",value:22e3}];d.useEffect(()=>{t()},[s]);const t=async()=>{if(s)try{const[a,w,b,k]=await Promise.all([C.from("investments").select("amount").eq("user_id",s.id),C.from("expenses").select("amount").eq("user_id",s.id),C.from("products").select("id, status").eq("user_id",s.id).in("status",["planning","testing","production"]),C.from("activity_log").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(10)]),_=a.data?.reduce((j,x)=>j+parseFloat(x.amount.toString()),0)||0,y=w.data?.reduce((j,x)=>j+parseFloat(x.amount.toString()),0)||0;c({totalInvestments:_,totalExpenses:y,activeProducts:b.data?.length||0}),r(k.data||[])}catch(a){console.error("Error fetching dashboard data:",a)}finally{u(!1)}},l=n.totalInvestments-n.totalExpenses;return e.jsx("div",{className:"page-transition",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"dashboard-hero",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"greeting",children:["Namaste, ",e.jsx("span",{className:"greeting-accent",children:s?.name||"User"})]}),e.jsx("p",{className:"date-time mt-1",children:m}),s?.role==="admin"&&e.jsxs("div",{className:"role-badge",children:[e.jsx(Oe,{className:"w-3 h-3"}),e.jsx("span",{children:"Admin"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[#6B7280] text-[0.6875rem] uppercase tracking-wider font-medium mb-1",children:"Net Balance"}),e.jsxs("p",{className:`text-2xl md:text-[1.875rem] font-semibold ${l>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",l.toLocaleString("en-IN")]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-6 stagger-container",children:[e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Investments"}),e.jsxs("div",{className:"number",children:["â‚¹",(n.totalInvestments/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend positive mt-2",children:[e.jsx("span",{children:"â†‘"}),e.jsx("span",{children:"12%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"this month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Total Expenses"}),e.jsxs("div",{className:"number",children:["â‚¹",(n.totalExpenses/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:"trend negative mt-2",children:[e.jsx("span",{children:"â†“"}),e.jsx("span",{children:"8%"}),e.jsx("span",{className:"text-[#757575] text-xs ml-1",children:"vs last month"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Net Balance"}),e.jsxs("div",{className:`number ${l>=0?"text-[#10B981]":"text-[#EF4444]"}`,children:["â‚¹",(Math.abs(l)/1e5).toFixed(2),"L"]}),e.jsxs("div",{className:`trend mt-2 ${l>=0?"positive":"negative"}`,children:[e.jsx("span",{children:l>=0?"â†‘":"â†“"}),e.jsx("span",{children:l>=0?"Positive":"Negative"})]})]}),e.jsxs("div",{className:"stat-card hover-lift",children:[e.jsx("div",{className:"label",children:"Active Products"}),e.jsx("div",{className:"number",children:n.activeProducts}),e.jsxs("div",{className:"trend mt-2 text-[#2D5016]",children:[e.jsx("span",{children:"â—"}),e.jsx("span",{children:"In Pipeline"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(Ks,{data:p}),e.jsx(Js,{data:f})]}),e.jsx(fr,{activities:g})]})})}function kt({title:s,value:n,trend:c,icon:g,iconBgColor:r,iconColor:h,valueColor:u="text-dark-brown"}){const m=c&&c.value>=0;return e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 hover:scale-[1.02] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-0 group-hover:opacity-5 transition-opacity duration-300"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 ${r} rounded-full flex items-center justify-center`,children:e.jsx(g,{className:`w-6 h-6 ${h}`})}),c&&e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full ${m?"bg-sage/20":"bg-soft-red/20"}`,children:[m?e.jsx(te,{className:"w-3 h-3 text-sage"}):e.jsx(je,{className:"w-3 h-3 text-soft-red"}),e.jsxs("span",{className:`text-xs font-semibold ${m?"text-sage":"text-soft-red"}`,children:[Math.abs(c.value),"%"]})]})]}),e.jsx("h3",{className:"text-sm font-medium text-dark-brown/60 mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold ${u} mb-1`,children:n}),c&&e.jsx("p",{className:"text-xs text-dark-brown/50",children:c.label})]})]})}function yr(){const{user:s}=H(),[n,c]=d.useState({total:0,thisMonth:0,lastMonth:0,byCategory:[]}),[g,r]=d.useState({total:0,thisMonth:0,count:0}),[h,u]=d.useState(!0);d.useEffect(()=>{m()},[s?.id]);const m=async()=>{if(s?.id)try{const f=new Date,t=new Date(f.getFullYear(),f.getMonth(),1),l=new Date(f.getFullYear(),f.getMonth()-1,1),a=new Date(f.getFullYear(),f.getMonth(),0),{data:w,error:b}=await C.from("expenses").select("*").eq("user_id",s.id).eq("status","approved").order("expense_date",{ascending:!1});if(b)throw b;const k=w?.filter(i=>new Date(i.expense_date)>=t)||[],_=w?.filter(i=>new Date(i.expense_date)>=l&&new Date(i.expense_date)<=a)||[],y=w?.reduce((i,v)=>(i[v.category]=(i[v.category]||0)+parseFloat(v.amount),i),{})||{};c({total:w?.reduce((i,v)=>i+parseFloat(v.amount),0)||0,thisMonth:k.reduce((i,v)=>i+parseFloat(v.amount),0),lastMonth:_.reduce((i,v)=>i+parseFloat(v.amount),0),byCategory:Object.entries(y).map(([i,v])=>({category:i,total:v}))});const{data:j,error:x}=await C.from("investments").select("*").order("investment_date",{ascending:!1});x&&console.error("Error fetching investments:",x);const o=j?.filter(i=>new Date(i.investment_date)>=t)||[];r({total:j?.reduce((i,v)=>i+parseFloat(v.amount),0)||0,thisMonth:o.reduce((i,v)=>i+parseFloat(v.amount),0),count:j?.length||0})}catch(f){console.error("Error fetching financial data:",f)}finally{u(!1)}},p=n.lastMonth>0?(n.thisMonth-n.lastMonth)/n.lastMonth*100:0;return h?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 page-transition",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx($e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"Finance Overview"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Expense and investment analytics"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(kt,{title:"Total Expenses",value:`â‚¹${n.total.toLocaleString()}`,icon:St,trend:p>0?"up":p<0?"down":void 0,trendValue:p!==0?`${Math.abs(p).toFixed(1)}% vs last month`:void 0,iconColor:"bg-gradient-to-br from-red-500 to-pink-600"}),e.jsx(kt,{title:"This Month",value:`â‚¹${n.thisMonth.toLocaleString()}`,icon:_e,iconColor:"bg-gradient-to-br from-blue-500 to-cyan-600"}),e.jsx(kt,{title:"Investments",value:`â‚¹${g.total.toLocaleString()}`,icon:za,trendValue:g.count>0?`${g.count} total`:void 0,iconColor:"bg-gradient-to-br from-green-500 to-emerald-600"}),e.jsx(kt,{title:"Net Balance",value:`â‚¹${(g.total-n.total).toLocaleString()}`,icon:te,trend:g.total>n.total?"up":"down",iconColor:"bg-gradient-gold"})]}),n.byCategory.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(St,{className:"w-5 h-5"}),"Expense by Category"]}),e.jsx(Js,{data:n.byCategory.map(f=>({name:f.category,value:f.total}))})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-primary mb-4 flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Expenses vs Investments"]}),e.jsx(Ks,{data:[{month:"Last Month",investments:g.total-g.thisMonth,expenses:n.lastMonth},{month:"This Month",investments:g.thisMonth,expenses:n.thisMonth}]})]})]})]})}const ws=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],wr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function Nr(){const{user:s}=H(),n=ie(),[c,g]=d.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[r,h]=d.useState(null),[u,m]=d.useState(""),[p,f]=d.useState([]),[t,l]=d.useState([]),[a,w]=d.useState(!1),[b,k]=d.useState({}),[_,y]=d.useState(!1),[j,x]=d.useState(0);d.useEffect(()=>{o(),i()},[]);const o=async()=>{try{const{data:I,error:A}=await C.from("vendors").select("id, name").order("name");if(A)throw A;f(I||[])}catch(I){console.error("Error fetching vendors:",I)}},i=async()=>{try{const{data:I,error:A}=await C.from("users").select("id, name").order("name");if(A)throw A;l(I||[])}catch(I){console.error("Error fetching partners:",I)}},v=I=>{const A=I.target.files?.[0];if(A){if(A.size>5*1024*1024){k({...b,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes(A.type)){k({...b,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(h(A),k({...b,bill:""}),A.type.startsWith("image/")){const U=new FileReader;U.onloadend=()=>{m(U.result)},U.readAsDataURL(A)}else m("")}},N=()=>{const I={};return c.category||(I.category="Category is required"),(!c.amount||parseFloat(c.amount)<=0)&&(I.amount="Amount must be greater than 0"),c.date||(I.date="Date is required"),c.paymentMode||(I.paymentMode="Payment mode is required"),c.paidBy||(I.paidBy="Please select who paid"),k(I),Object.keys(I).length===0},P=async()=>{if(!r||!s)return null;try{const I=r.name.split(".").pop(),A=`${s.id}/${Date.now()}.${I}`,{error:U}=await C.storage.from("expense-bills").upload(A,r);if(U)throw U;const{data:B}=C.storage.from("expense-bills").getPublicUrl(A);return B.publicUrl}catch(I){return console.error("Error uploading bill:",I),null}},L=async(I="pending")=>{if(!(I==="pending"&&!N())){w(!0);try{let A=null;r&&(A=await P());const U={user_id:s?.id,category:c.category,subcategory:c.subcategory||null,amount:parseFloat(c.amount),expense_date:c.date,payment_mode:c.paymentMode,paid_by:c.paidBy,vendor_id:c.vendorId||null,bill_url:A,purpose:c.purpose||null,status:I==="draft"?"draft":"pending",submitted_by:s?.id,submitted_at:new Date().toISOString()},{error:B}=await C.from("expenses").insert(U);if(B)throw B;if(I!=="draft"){const W=ws.find(ee=>ee.value===c.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense",description:`${s?.name} added expense: â‚¹${parseFloat(c.amount).toLocaleString("en-IN")} for ${W?.label||c.category}`})}y(!0),setTimeout(()=>{n("/expenses")},2e3)}catch(A){console.error("Error submitting expense:",A),k({submit:"Failed to submit expense. Please try again."})}finally{w(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Add New Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Submit an expense for approval"})]}),_&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx(ts,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense submitted for approval!"})]}),b.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:b.submit})]}),e.jsx("form",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:c.category,onChange:I=>g({...c,category:I.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${b.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),ws.map(I=>e.jsxs("option",{value:I.value,children:[I.icon," ",I.label]},I.value))]}),b.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:b.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:c.subcategory,onChange:I=>g({...c,subcategory:I.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:c.amount,onChange:I=>g({...c,amount:I.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${b.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),b.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:b.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:c.date,onChange:I=>g({...c,date:I.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${b.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),b.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:b.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:c.paidBy,onChange:I=>g({...c,paidBy:I.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${b.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),t.map(I=>e.jsx("option",{value:I.id,children:I.name},I.id))]}),b.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:b.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:wr.map(I=>e.jsxs("button",{type:"button",onClick:()=>g({...c,paymentMode:I.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${c.paymentMode===I.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:I.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:I.label})]},I.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:c.vendorId,onChange:I=>g({...c,vendorId:I.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),p.map(I=>e.jsx("option",{value:I.id,children:I.name},I.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:v,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:r?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[u&&e.jsx("img",{src:u,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:r.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(r.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:I=>{I.preventDefault(),h(null),m("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(de,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),b.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:b.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[j,"/500"]})]}),e.jsx("textarea",{value:c.purpose,onChange:I=>{I.target.value.length<=500&&(g({...c,purpose:I.target.value}),x(I.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>L("pending"),disabled:a,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-5 h-5 animate-spin"}),"Submitting..."]}):"Submit for Approval"}),e.jsx("button",{type:"button",onClick:()=>L("draft"),disabled:a,className:"px-8 py-4 bg-transparent text-primary font-semibold rounded-xl border-2 border-primary hover:bg-primary hover:text-cream transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save as Draft"}),e.jsx("button",{type:"button",onClick:()=>n("/expenses"),disabled:a,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]})}const Ns=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢"},{value:"lab_testing",label:"Lab Testing & Quality Control",icon:"ðŸ”¬"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ"},{value:"utilities",label:"Utilities (Electricity, Water)",icon:"âš¡"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§"},{value:"other",label:"Other",icon:"ðŸ“±"}],vr=[{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"upi",label:"UPI",icon:"ðŸ“±"},{value:"bank_transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"card",label:"Credit/Debit Card",icon:"ðŸ’³"}];function kr(){const{user:s}=H(),n=ie(),{id:c}=Ye(),g=s?.role==="admin",[r,h]=d.useState({category:"",subcategory:"",amount:"",date:new Date().toISOString().split("T")[0],paymentMode:"cash",paidBy:s?.id||"",vendorId:"",purpose:""}),[u,m]=d.useState(null),[p,f]=d.useState(""),[t,l]=d.useState(""),[a,w]=d.useState([]),[b,k]=d.useState([]),[_,y]=d.useState(!1),[j,x]=d.useState(!0),[o,i]=d.useState({}),[v,N]=d.useState(!1),[P,L]=d.useState(0);d.useEffect(()=>{if(!g){n("/expenses");return}I(),A(),U()},[c,g]);const I=async()=>{if(c)try{const{data:S,error:T}=await C.from("expenses").select("*").eq("id",c).maybeSingle();if(T)throw T;S&&(h({category:S.category,subcategory:S.subcategory||"",amount:S.amount.toString(),date:S.expense_date,paymentMode:S.payment_mode,paidBy:S.paid_by,vendorId:S.vendor_id||"",purpose:S.purpose||""}),L(S.purpose?.length||0),l(S.bill_url||""))}catch(S){console.error("Error fetching expense:",S),alert("Failed to load expense. Redirecting to expense list."),n("/expenses")}finally{x(!1)}},A=async()=>{try{const{data:S,error:T}=await C.from("vendors").select("id, name").order("name");if(T)throw T;w(S||[])}catch(S){console.error("Error fetching vendors:",S)}},U=async()=>{try{const{data:S,error:T}=await C.from("users").select("id, name").order("name");if(T)throw T;k(S||[])}catch(S){console.error("Error fetching partners:",S)}},B=S=>{const T=S.target.files?.[0];if(T){if(T.size>5*1024*1024){i({...o,bill:"File size must be less than 5MB"});return}if(!["image/jpeg","image/png","application/pdf"].includes(T.type)){i({...o,bill:"Only JPG, PNG, and PDF files are allowed"});return}if(m(T),i({...o,bill:""}),T.type.startsWith("image/")){const E=new FileReader;E.onloadend=()=>{f(E.result)},E.readAsDataURL(T)}else f("")}},W=()=>{const S={};return r.category||(S.category="Category is required"),(!r.amount||parseFloat(r.amount)<=0)&&(S.amount="Amount must be greater than 0"),r.date||(S.date="Date is required"),r.paymentMode||(S.paymentMode="Payment mode is required"),r.paidBy||(S.paidBy="Please select who paid"),i(S),Object.keys(S).length===0},ee=async()=>{if(!u||!s)return null;try{const S=u.name.split(".").pop(),T=`${s.id}/${Date.now()}.${S}`,{error:E}=await C.storage.from("expense-bills").upload(T,u);if(E)throw E;const{data:q}=C.storage.from("expense-bills").getPublicUrl(T);return q.publicUrl}catch(S){return console.error("Error uploading bill:",S),null}},re=async S=>{if(S.preventDefault(),!!W()){y(!0);try{let T=t;if(u){const Y=await ee();Y&&(T=Y)}const E={category:r.category,subcategory:r.subcategory||null,amount:parseFloat(r.amount),expense_date:r.date,payment_mode:r.paymentMode,paid_by:r.paidBy,vendor_id:r.vendorId||null,bill_url:T,purpose:r.purpose||null},{error:q}=await C.from("expenses").update(E).eq("id",c);if(q)throw q;const O=Ns.find(Y=>Y.value===r.category);await C.from("activity_log").insert({user_id:s?.id,activity_type:"expense_updated",description:`${s?.name} updated expense: â‚¹${parseFloat(r.amount).toLocaleString("en-IN")} for ${O?.label||r.category}`}),N(!0),setTimeout(()=>{n("/expenses")},2e3)}catch(T){console.error("Error updating expense:",T),i({submit:"Failed to update expense. Please try again."})}finally{y(!1)}}};return g?j?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})}):e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>n("/expenses"),className:"flex items-center gap-2 text-primary hover:text-primary/80 font-medium mb-4 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"Back to Expenses"]}),e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Edit Expense"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Update expense details"})]}),v&&e.jsxs("div",{className:"mb-6 p-4 bg-sage/20 border-2 border-sage rounded-xl flex items-center gap-3",children:[e.jsx(ts,{className:"w-5 h-5 text-sage"}),e.jsx("p",{className:"text-sage font-medium",children:"Expense updated successfully!"})]}),o.submit&&e.jsxs("div",{className:"mb-6 p-4 bg-soft-red/10 border border-soft-red/30 rounded-xl flex items-start gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-soft-red text-sm",children:o.submit})]}),e.jsx("form",{onSubmit:re,className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 md:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expense Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:r.category,onChange:S=>h({...r,category:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${o.category?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select a category"}),Ns.map(S=>e.jsxs("option",{value:S.value,children:[S.icon," ",S.label]},S.value))]}),o.category&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:o.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Subcategory (Optional)"}),e.jsx("input",{type:"text",value:r.subcategory,onChange:S=>h({...r,subcategory:S.target.value}),placeholder:"e.g., Neem powder, Cardboard boxes",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-accent",children:"â‚¹"}),e.jsx("input",{type:"number",value:r.amount,onChange:S=>h({...r,amount:S.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:`w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${o.amount?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`})]}),o.amount&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:o.amount})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:r.date,onChange:S=>h({...r,date:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${o.date?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`}),o.date&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:o.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Paid By ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:r.paidBy,onChange:S=>h({...r,paidBy:S.target.value}),className:`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 ${o.paidBy?"border-soft-red":"border-dark-brown/10 focus:border-primary"}`,children:[e.jsx("option",{value:"",children:"Select partner"}),b.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]}),o.paidBy&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:o.paidBy})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:["Payment Mode ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:vr.map(S=>e.jsxs("button",{type:"button",onClick:()=>h({...r,paymentMode:S.value}),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 ${r.paymentMode===S.value?"border-primary bg-primary/10":"border-dark-brown/10 hover:border-primary/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:S.icon}),e.jsx("div",{className:"text-sm font-medium text-dark-brown",children:S.label})]},S.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor (Optional)"}),e.jsxs("select",{value:r.vendorId,onChange:S=>h({...r,vendorId:S.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select vendor"}),a.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent my-6"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bill/Receipt Upload"}),t&&!u&&e.jsx("div",{className:"mb-4 p-4 bg-sage/5 border-2 border-sage/20 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:"ðŸ“„"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"Current Bill"}),e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline",children:"View existing bill"})]})]}),e.jsx("button",{type:"button",onClick:()=>l(""),className:"text-xs text-soft-red hover:underline",children:"Remove"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:B,className:"hidden",id:"bill-upload"}),e.jsx("label",{htmlFor:"bill-upload",className:"block w-full p-8 border-2 border-dashed border-dark-brown/20 rounded-xl hover:border-primary cursor-pointer transition-all duration-300 text-center",children:u?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[p&&e.jsx("img",{src:p,alt:"Preview",className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-dark-brown",children:u.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(u.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:S=>{S.preventDefault(),m(null),f("")},className:"p-1 hover:bg-soft-red/10 rounded-full transition-colors",children:e.jsx(de,{className:"w-5 h-5 text-soft-red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-8 h-8 text-dark-brown/40 mx-auto mb-2"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mb-1",children:t?"Upload new bill to replace existing":"Drop receipt here or click to upload"}),e.jsx("p",{className:"text-sm text-dark-brown/50",children:"JPG, PNG or PDF (Max 5MB)"})]})})]}),o.bill&&e.jsx("p",{className:"mt-1 text-sm text-soft-red",children:o.bill})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown",children:"Purpose/Notes (Optional)"}),e.jsxs("span",{className:"text-xs text-dark-brown/50",children:[P,"/500"]})]}),e.jsx("textarea",{value:r.purpose,onChange:S=>{S.target.value.length<=500&&(h({...r,purpose:S.target.value}),L(S.target.value.length))},placeholder:"Additional details about this expense...",rows:4,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"submit",disabled:_,className:"flex-1 py-4 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-5 h-5 animate-spin"}),"Updating..."]}):"Update Expense"}),e.jsx("button",{type:"button",onClick:()=>n("/expenses"),disabled:_,className:"px-8 py-4 text-dark-brown/70 hover:text-dark-brown font-semibold transition-colors",children:"Cancel"})]})]})})]})})]}):null}const _r=["Duplicate entry","Insufficient proof","Incorrect amount","Wrong category","Not a business expense","Missing receipt","Other (specify below)"];function Zs({isOpen:s,onClose:n,onConfirm:c,type:g,expense:r,loading:h=!1}){const[u,m]=d.useState(""),[p,f]=d.useState(""),[t,l]=d.useState("");if(!s)return null;const a=()=>{if(g==="reject"){const b=p==="Other (specify below)"?t:p;if(!b.trim()){alert("Please provide a reason for rejection");return}c(void 0,b)}else c(u)},w=b=>b.split("_").map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:`p-6 border-b-2 ${g==="approve"?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g==="approve"?e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-6 h-6 text-green-600"})}):e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Ce,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-gray-900",children:g==="approve"?"Approve Expense":"Reject Expense"}),e.jsx("p",{className:"text-sm text-gray-600",children:g==="approve"?"Confirm approval of this expense":"Please provide a reason"})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(de,{className:"w-5 h-5 text-gray-600"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"Expense Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[w(r.category),r.subcategory&&` - ${r.subcategory}`]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-orange-600 text-xl",children:["â‚¹",r.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Date(r.expense_date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment:"}),e.jsx("span",{className:"font-semibold text-gray-900 uppercase",children:r.payment_mode.replace("_"," ")})]})]})]}),g==="reject"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Reason for Rejection ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:p,onChange:b=>f(b.target.value),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select a reason"}),_r.map(b=>e.jsx("option",{value:b,children:b},b))]})]}),p==="Other (specify below)"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Specify Reason"}),e.jsx("textarea",{value:t,onChange:b=>l(b.target.value),placeholder:"Please provide detailed reason...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(ue,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:"The submitter will be notified of this rejection and the reason provided."})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Comments (Optional)"}),e.jsx("textarea",{value:u,onChange:b=>m(b.target.value),placeholder:"Add any comments or notes...",rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-200 transition-all duration-300 resize-none"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:n,disabled:h,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 font-bold rounded-xl hover:bg-gray-50 transition-all duration-300 disabled:opacity-50 shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:h,className:`flex-1 px-6 py-3 font-bold rounded-xl shadow-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${g==="approve"?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white":"bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white"}`,children:h?"Processing...":g==="approve"?"Confirm Approval":"Confirm Rejection"})]})]})]})]})}function Cr({isOpen:s,onClose:n,billUrl:c,expenseDetails:g}){const[r,h]=d.useState(100),[u,m]=d.useState(0);if(!s)return null;const p=c.toLowerCase().endsWith(".pdf"),f=()=>{window.open(c,"_blank")},t=()=>{h(b=>Math.min(b+25,200))},l=()=>{h(b=>Math.max(b-25,50))},a=()=>{m(b=>(b+90)%360)},w=b=>b.split("_").map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(" ");return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-dark-brown/90 backdrop-blur-md",children:[e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between",children:[e.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-xl px-4 py-3 shadow-soft",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:w(g.category)})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"font-bold text-secondary",children:["â‚¹",g.amount.toLocaleString("en-IN")]})]}),e.jsx("div",{className:"h-8 w-px bg-dark-brown/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:new Date(g.date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l,disabled:r<=50,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(ar,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"px-4 py-3 bg-white/90 backdrop-blur-sm rounded-lg shadow-soft",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[r,"%"]})}),e.jsx("button",{onClick:t,disabled:r>=200,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 disabled:opacity-50 shadow-soft",children:e.jsx(sr,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("button",{onClick:a,className:"p-3 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-white transition-all duration-300 shadow-soft",children:e.jsx(Ha,{className:"w-5 h-5 text-dark-brown"})})]}),e.jsx("button",{onClick:f,className:"p-3 bg-primary/90 backdrop-blur-sm rounded-lg hover:bg-primary transition-all duration-300 shadow-soft",children:e.jsx(Ne,{className:"w-5 h-5 text-cream"})}),e.jsx("button",{onClick:n,className:"p-3 bg-soft-red/90 backdrop-blur-sm rounded-lg hover:bg-soft-red transition-all duration-300 shadow-soft",children:e.jsx(de,{className:"w-5 h-5 text-white"})})]})]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-24 overflow-auto",children:p?e.jsx("iframe",{src:c,className:"w-full h-full bg-white rounded-xl shadow-soft-lg",title:"Bill PDF"}):e.jsx("img",{src:c,alt:"Bill",className:"max-w-full max-h-full object-contain rounded-xl shadow-soft-lg transition-transform duration-300",style:{transform:`scale(${r/100}) rotate(${u}deg)`}})})]})}const lt=[{value:"raw_materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20 text-sage"},{value:"packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-accent/20 text-accent"},{value:"printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-dark-brown/20 text-dark-brown"},{value:"shipping",label:"Shipping & Logistics",icon:"ðŸšš",color:"bg-primary/20 text-primary"},{value:"marketing",label:"Marketing & Advertising",icon:"ðŸ“¢",color:"bg-secondary/20 text-secondary"},{value:"lab_testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-sage/30 text-sage"},{value:"licenses",label:"Licenses & Compliance",icon:"ðŸ“œ",color:"bg-accent/30 text-accent"},{value:"utilities",label:"Utilities",icon:"âš¡",color:"bg-primary/30 text-primary"},{value:"rent",label:"Rent & Infrastructure",icon:"ðŸ¢",color:"bg-dark-brown/30 text-dark-brown"},{value:"salaries",label:"Salaries & Wages",icon:"ðŸ‘¥",color:"bg-secondary/30 text-secondary"},{value:"equipment",label:"Equipment & Machinery",icon:"ðŸ”§",color:"bg-sage/40 text-sage"},{value:"other",label:"Other",icon:"ðŸ“±",color:"bg-dark-brown/40 text-dark-brown"}];function Sr(){const{user:s}=H(),n=ie(),[c,g]=d.useState([]),[r,h]=d.useState(!0),[u,m]=d.useState(""),[p,f]=d.useState("all"),[t,l]=d.useState(null),[a,w]=d.useState(!1),[b,k]=d.useState("approve"),[_,y]=d.useState(!1),[j,x]=d.useState(null),[o,i]=d.useState(1),[v,N]=d.useState(20),[P,L]=d.useState(null),[I,A]=d.useState(!1),[U,B]=d.useState(""),[W,ee]=d.useState(""),[re,S]=d.useState([]),[T,E]=d.useState([]),[q,O]=d.useState("expense_date"),[Y,me]=d.useState("desc"),Se=s?.role==="admin";d.useEffect(()=>{De();const D=C.channel("expenses-changes").on("postgres_changes",{event:"*",schema:"public",table:"expenses"},()=>{De()}).subscribe();return()=>{C.removeChannel(D)}},[]);const De=async()=>{if(s)try{let D=C.from("expenses").select(`
          *,
          users_paid_by:users!expenses_paid_by_fkey(name),
          users_submitted_by:users!expenses_submitted_by_fkey(name),
          users_approved_by:users!expenses_approved_by_fkey(name),
          vendors(name)
        `);Se||(D=D.eq("submitted_by",s.id));const{data:z,error:V}=await D.order(q,{ascending:Y==="asc"});if(V)throw V;g(z||[])}catch(D){console.error("Error fetching expenses:",D)}finally{h(!1)}},ft=D=>{l(D),k("approve"),w(!0)},ve=D=>{l(D),k("reject"),w(!0)},Ve=async(D,z)=>{if(!(!t||!s)){L(t.id);try{const V={status:b==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};b==="approve"&&D?V.approval_comments=D:b==="reject"&&z&&(V.rejection_reason=z);const{error:wt}=await C.from("expenses").update(V).eq("id",t.id);if(wt)throw wt;const Rt=lt.find(We=>We.value===t.category);await C.from("activity_log").insert({user_id:s.id,activity_type:b==="approve"?"expense_approved":"expense_rejected",description:`${s.name} ${b==="approve"?"approved":"rejected"} expense: â‚¹${t.amount.toLocaleString("en-IN")} for ${Rt?.label||t.category}`}),await De(),w(!1),l(null)}catch(V){console.error("Error processing approval:",V),alert("Failed to process approval. Please try again.")}finally{L(null)}}},Je=async D=>{if(confirm("Are you sure you want to delete this expense? This action cannot be undone."))try{const{error:z}=await C.from("expenses").delete().eq("id",D);if(z)throw z;await De()}catch(z){console.error("Error deleting expense:",z),alert("Failed to delete expense. Please try again.")}},jt=D=>{D.bill_url&&(l(D),y(!0),C.from("expenses").update({viewed_bill:!0}).eq("id",D.id).then())},Ze=D=>{switch(D){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},Me=D=>lt.find(z=>z.value===D)||lt[lt.length-1],Pe=c.filter(D=>{if(p==="pending"&&D.status!=="pending"||p==="approved"&&D.status!=="approved"||p==="rejected"&&D.status!=="rejected"||p==="my_expenses"&&D.submitted_by!==s?.id)return!1;if(u){const z=u.toLowerCase();if(!D.category.toLowerCase().includes(z)&&!D.subcategory?.toLowerCase().includes(z)&&!D.purpose?.toLowerCase().includes(z)&&!D.vendors?.name.toLowerCase().includes(z))return!1}return!(U&&D.expense_date<U||W&&D.expense_date>W||re.length>0&&!re.includes(D.category)||T.length>0&&!T.includes(D.payment_mode))}),yt=Pe.slice((o-1)*v,o*v),Ee=Math.ceil(Pe.length/v),Tt=D=>D==="all"?c.length:D==="pending"?c.filter(z=>z.status==="pending").length:D==="approved"?c.filter(z=>z.status==="approved").length:D==="rejected"?c.filter(z=>z.status==="rejected").length:D==="my_expenses"?c.filter(z=>z.submitted_by===s?.id).length:0,Lt=c.filter(D=>{const z=new Date(D.expense_date),V=new Date;return z.getMonth()===V.getMonth()&&z.getFullYear()===V.getFullYear()}).reduce((D,z)=>D+z.amount,0),$t=D=>{S(z=>z.includes(D)?z.filter(V=>V!==D):[...z,D])},qt=D=>{E(z=>z.includes(D)?z.filter(V=>V!==D):[...z,D])},Xe=()=>{m(""),B(""),ee(""),S([]),E([]),f("all")},He=D=>{q===D?me(z=>z==="asc"?"desc":"asc"):(O(D),me("desc"))};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Expense Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Manage and approve all expenses"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",Lt.toLocaleString("en-IN")]})]}),e.jsxs("button",{onClick:()=>n("/expenses/add"),className:"flex items-center gap-2 px-6 py-3 bg-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Expense"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6 mb-6",children:[e.jsx("div",{className:"flex items-center gap-2 mb-4 overflow-x-auto pb-2",children:["all","pending","approved","rejected","my_expenses"].map(D=>e.jsxs("button",{onClick:()=>f(D),className:`px-4 py-2 rounded-lg font-medium whitespace-nowrap transition-all duration-300 flex items-center gap-2 ${p===D?"bg-primary text-cream shadow-soft":"bg-cream/50 text-dark-brown hover:bg-primary/10"}`,children:[D==="all"&&"All",D==="pending"&&"â³ Pending",D==="approved"&&"âœ… Approved",D==="rejected"&&"âŒ Rejected",D==="my_expenses"&&"My Expenses",e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${p===D?"bg-cream/20 text-cream":"bg-dark-brown/10 text-dark-brown"}`,children:Tt(D)})]},D))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ke,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",placeholder:"Search by category, vendor, or purpose...",value:u,onChange:D=>m(D.target.value),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300"})]}),e.jsxs("button",{onClick:()=>A(!I),className:`flex items-center gap-2 px-6 py-3 border-2 font-semibold rounded-xl transition-all duration-300 ${I||re.length>0||T.length>0||U||W?"border-primary bg-primary text-cream":"border-primary text-primary hover:bg-primary hover:text-cream"}`,children:[e.jsx(qs,{className:"w-5 h-5"}),"Filters",re.length+T.length+(U?1:0)+(W?1:0)>0&&e.jsx("span",{className:"px-2 py-0.5 bg-cream/20 rounded-full text-xs font-bold",children:re.length+T.length+(U?1:0)+(W?1:0)})]}),e.jsxs("button",{onClick:()=>alert("Export feature coming soon"),className:"flex items-center gap-2 px-6 py-3 border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Export"]})]}),I&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:U,onChange:D=>B(D.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:W,onChange:D=>ee(D.target.value),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:lt.map(D=>e.jsxs("button",{onClick:()=>$t(D.value),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${re.includes(D.value)?D.color:"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:[D.icon," ",D.label]},D.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Mode"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["cash","upi","bank_transfer","card"].map(D=>e.jsx("button",{onClick:()=>qt(D),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${T.includes(D)?"bg-primary text-cream":"bg-white border-2 border-dark-brown/10 text-dark-brown hover:border-primary"}`,children:D.toUpperCase().replace("_"," ")},D))})]}),e.jsx("button",{onClick:Xe,className:"w-full py-2 text-soft-red font-semibold hover:bg-soft-red/10 rounded-lg transition-all",children:"Reset All Filters"})]})]})]}),r?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading expenses..."})}):Pe.length===0?e.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No expenses found"}),e.jsxs("button",{onClick:()=>n("/expenses/add"),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-white font-semibold rounded-xl hover:scale-105 transition-all duration-300",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Your First Expense"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-primary/10",children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>He("expense_date"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Date ",q==="expense_date"&&(Y==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsxs("th",{onClick:()=>He("amount"),className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown cursor-pointer hover:bg-primary/5 transition-colors",children:["Amount ",q==="amount"&&(Y==="asc"?"â†‘":"â†“")]}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Payment"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Bill"}),e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:yt.map((D,z)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{onClick:()=>x(j===D.id?null:D.id),className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors cursor-pointer ${z%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:$(new Date(D.expense_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Me(D.category).color}`,children:[Me(D.category).icon," ",Me(D.category).label]})}),D.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1",children:D.subcategory})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",D.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:D.users_paid_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-xs font-semibold text-dark-brown uppercase",children:D.payment_mode.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-4",children:Ze(D.status)}),e.jsx("td",{className:"px-4 py-4",children:D.bill_url?e.jsx("button",{onClick:V=>{V.stopPropagation(),jt(D)},className:"p-2 hover:bg-primary/10 rounded-lg transition-colors",children:e.jsx(qe,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No bill"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[Se&&D.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:V=>{V.stopPropagation(),ft(D)},disabled:P===D.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(G,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:V=>{V.stopPropagation(),ve(D)},disabled:P===D.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Ce,{className:"w-4 h-4 text-soft-red"})})]}),Se&&e.jsx("button",{onClick:V=>{V.stopPropagation(),n(`/expenses/edit/${D.id}`)},className:"p-2 hover:bg-accent/10 rounded-lg transition-colors",title:"Edit",children:e.jsx(us,{className:"w-4 h-4 text-accent"})}),Se&&e.jsx("button",{onClick:V=>{V.stopPropagation(),Je(D.id)},className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(oe,{className:"w-4 h-4 text-soft-red"})})]})})]},D.id),j===D.id&&e.jsx("tr",{className:"bg-primary/5",children:e.jsx("td",{colSpan:8,className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-3",children:[D.purpose&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Purpose/Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:D.purpose})]}),D.vendors&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 mb-1",children:"Vendor"}),e.jsx("p",{className:"text-sm text-dark-brown",children:D.vendors.name})]}),D.approval_comments&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-sage mb-1",children:"Approval Comments"}),e.jsx("p",{className:"text-sm text-dark-brown",children:D.approval_comments})]}),D.rejection_reason&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-soft-red mb-1",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-dark-brown",children:D.rejection_reason})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-dark-brown/50",children:[e.jsxs("span",{children:["Submitted by: ",D.users_submitted_by?.name]}),D.users_approved_by&&e.jsxs("span",{children:["Approved by: ",D.users_approved_by.name]})]})]})})})]}))})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:yt.map(D=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 hover:shadow-soft-lg transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${Me(D.category).color}`,children:[Me(D.category).icon," ",Me(D.category).label]}),Ze(D.status)]}),D.subcategory&&e.jsx("p",{className:"text-xs text-dark-brown/50 mb-2",children:D.subcategory})]}),e.jsxs("p",{className:"text-2xl font-bold text-secondary",children:["â‚¹",D.amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Date:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:$(new Date(D.expense_date),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Paid by:"}),e.jsx("span",{className:"font-medium text-dark-brown",children:D.users_paid_by?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Payment:"}),e.jsx("span",{className:"font-medium text-dark-brown uppercase",children:D.payment_mode.replace("_"," ")})]})]}),D.purpose&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Purpose"}),e.jsx("p",{className:"text-sm text-dark-brown",children:D.purpose})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4 pt-3 border-t border-dark-brown/10",children:[D.bill_url&&e.jsxs("button",{onClick:()=>jt(D),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-primary/10 text-primary font-semibold rounded-lg hover:bg-primary/20 transition-colors",children:[e.jsx(qe,{className:"w-4 h-4"}),"View Bill"]}),Se&&D.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>ft(D),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-sage/10 text-sage font-semibold rounded-lg hover:bg-sage/20 transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>ve(D),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red font-semibold rounded-lg hover:bg-soft-red/20 transition-colors",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Reject"]})]}),Se&&e.jsxs("button",{onClick:()=>n(`/expenses/edit/${D.id}`),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-accent/10 text-accent font-semibold rounded-lg hover:bg-accent/20 transition-colors",children:[e.jsx(us,{className:"w-4 h-4"}),"Edit"]})]})]},D.id))}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 mt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Items per page:"}),e.jsxs("select",{value:v,onChange:D=>{N(Number(D.target.value)),i(1)},className:"px-3 py-1 border-2 border-dark-brown/10 rounded-lg focus:border-primary focus:outline-none",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsxs("span",{className:"text-sm text-dark-brown/70",children:["Showing ",(o-1)*v+1," - ",Math.min(o*v,Pe.length)," of ",Pe.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(D=>Math.max(1,D-1)),disabled:o===1,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ma,{className:"w-5 h-5 text-dark-brown"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,Ee)},(D,z)=>{let V;return Ee<=5||o<=3?V=z+1:o>=Ee-2?V=Ee-4+z:V=o-2+z,e.jsx("button",{onClick:()=>i(V),className:`w-10 h-10 rounded-lg font-semibold transition-all ${o===V?"bg-primary text-cream":"border-2 border-dark-brown/10 text-dark-brown hover:bg-primary/10"}`,children:V},V)})}),e.jsx("button",{onClick:()=>i(D=>Math.min(Ee,D+1)),disabled:o===Ee,className:"p-2 border-2 border-dark-brown/10 rounded-lg hover:bg-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ls,{className:"w-5 h-5 text-dark-brown"})})]})]})})]})]})}),a&&t&&e.jsx(Zs,{isOpen:a,onClose:()=>{w(!1),l(null)},onConfirm:Ve,type:b,expense:t,loading:P===t.id}),_&&t&&t.bill_url&&e.jsx(Cr,{isOpen:_,onClose:()=>{y(!1),l(null)},billUrl:t.bill_url,expenseDetails:{category:t.category,amount:t.amount,date:t.expense_date}})]})}function Dr({expenses:s,investments:n,vendors:c}){const g=s.filter(v=>v.status==="approved"),r=n.filter(v=>v.status==="approved"),h=g.reduce((v,N)=>v+N.amount,0),u=r.reduce((v,N)=>v+N.amount,0),m=u-h,p=u>0?m/u*100:0,f={};for(let v=11;v>=0;v--){const N=dt(new Date,v),P=$(N,"yyyy-MM"),L=$(N,"MMM yyyy");f[P]={month:L,investments:0,expenses:0,net:0}}r.forEach(v=>{const N=$(new Date(v.investment_date),"yyyy-MM");f[N]&&(f[N].investments+=v.amount)}),g.forEach(v=>{const N=$(new Date(v.expense_date),"yyyy-MM");f[N]&&(f[N].expenses+=v.amount)});const t=Object.values(f).map(v=>({...v,net:v.investments-v.expenses})),l=g.length>0?h/Object.keys(f).length:0,a=g.reduce((v,N)=>(v[N.category]||(v[N.category]=0),v[N.category]+=N.amount,v),{}),w=Object.entries(a).sort((v,N)=>N[1]-v[1])[0],b=g.reduce((v,N)=>{const P=N.paid_by||N.user_id;return v[P]||(v[P]={name:N.users_paid_by?.name||N.users?.name||"Unknown",total:0}),v[P].total+=N.amount,v},{}),k=Object.values(b).sort((v,N)=>N.total-v.total)[0],_=g.length>0?h/g.length:0,y=s.filter(v=>v.status==="pending").length,j=g.reduce((v,N)=>{const P=N.payment_mode||"unknown";return v[P]=(v[P]||0)+1,v},{}),x=Object.entries(j).sort((v,N)=>N[1]-v[1])[0],o=t.reduce((v,N)=>N.expenses>v.expenses?N:v,t[0]||{month:"N/A",expenses:0}),i=v=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[v]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/30 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Investments"})]}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-1",children:["â‚¹",u.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/20 to-secondary/10 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/30 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Expenses"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",h.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Spent"})]}),e.jsxs("div",{className:`bg-gradient-to-br rounded-xl p-6 border-2 shadow-soft ${m>=0?"from-accent/20 to-accent/10 border-accent/30":"from-soft-red/20 to-soft-red/10 border-soft-red/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${m>=0?"bg-accent/30":"bg-soft-red/30"}`,children:m>=0?e.jsx(te,{className:"w-6 h-6 text-accent"}):e.jsx(je,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:`text-xs font-semibold uppercase tracking-wide ${m>=0?"text-accent":"text-soft-red"}`,children:"Net Balance"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${m>=0?"text-accent":"text-soft-red"}`,children:["â‚¹",Math.abs(m).toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[p.toFixed(1),"% margin"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/30 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Burn Rate"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary mb-1",children:["â‚¹",l.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Month Avg"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-3xl",children:w?i(w[0]):"ðŸ“Š"}),e.jsx(ns,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Category"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1",children:w?w[0]:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",w?w[1].toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:k?k.name.charAt(0):"?"}),e.jsx(we,{className:"w-5 h-5 text-accent"})]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Top Spender"}),e.jsx("p",{className:"text-xl font-bold text-primary mb-1 truncate",children:k?k.name:"N/A"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary",children:["â‚¹",k?k.total.toLocaleString("en-IN"):"0"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(mt,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Avg Expense"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",_.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-5 h-5 text-accent"})})}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending Approvals"}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:y})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment vs Expense Trend (12 Months)"}),e.jsx(pe,{width:"100%",height:400,children:e.jsxs(ha,{data:t,children:[e.jsx(Ie,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Fe,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Te,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ge,{formatter:v=>`â‚¹${v.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ut,{}),e.jsx(pa,{type:"monotone",dataKey:"net",fill:"#B8860B",fillOpacity:.1,stroke:"none",name:"Net Balance"}),e.jsx(Le,{type:"monotone",dataKey:"investments",stroke:"#2D5016",strokeWidth:3,name:"Investments",dot:{fill:"#2D5016",r:5}}),e.jsx(Le,{type:"monotone",dataKey:"expenses",stroke:"#C17817",strokeWidth:3,name:"Expenses",dot:{fill:"#C17817",r:5}})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-accent/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent",children:"Quick Insight"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Highest spending month:"})}),e.jsx("p",{className:"text-lg font-bold text-secondary",children:o.month}),e.jsxs("p",{className:"text-xl font-bold text-accent",children:["â‚¹",o.expenses.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-sage/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(mt,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage",children:"Payment Mode"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Most used:"})}),e.jsx("p",{className:"text-xl font-bold text-secondary uppercase",children:x?x[0]:"N/A"}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[x?x[1]:0," transactions"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream to-white rounded-xl p-6 border-2 border-primary/20 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(G,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-sm font-semibold text-primary",children:"Efficiency"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-2",children:e.jsx("span",{className:"font-semibold text-primary",children:"Approval rate:"})}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[s.length>0?(g.length/s.length*100).toFixed(0):0,"%"]})]})]})]})}const _t=["#C17817","#2D5016","#B8860B","#8B4513","#D4AF37","#CD853F","#DAA520","#A0522D"];function Mr({expenses:s}){const[n,c]=d.useState(null),[g,r]=d.useState("all"),h=s.filter(y=>y.status==="approved"),p=(y=>{if(g==="all")return y;const j=parseInt(g),x=dt(new Date,j);return y.filter(o=>new Date(o.expense_date)>=x)})(h).reduce((y,j)=>{const x=j.category;return y[x]||(y[x]={category:x,total:0,count:0,expenses:[]}),y[x].total+=j.amount,y[x].count+=1,y[x].expenses.push(j),y},{}),f=Object.values(p).sort((y,j)=>j.total-y.total),t=f.reduce((y,j)=>y+j.total,0),l=f.map(y=>({name:y.category,value:y.total})),a=f.map(y=>({category:y.category,amount:y.total})),w=y=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[y]||"ðŸ’°",b=y=>{const j={};for(let o=5;o>=0;o--){const i=dt(new Date,o),v=$(i,"MMM");j[v]=0}return h.filter(o=>o.category===y).forEach(o=>{const i=$(new Date(o.expense_date),"MMM");j[i]!==void 0&&(j[i]+=o.amount)}),Object.entries(j).map(([o,i])=>({month:o,value:i}))},k=y=>{const j=new Date().getMonth(),x=new Date(new Date().setMonth(j-1)).getMonth(),o=h.filter(N=>N.category===y&&new Date(N.expense_date).getMonth()===j).reduce((N,P)=>N+P.amount,0),i=h.filter(N=>N.category===y&&new Date(N.expense_date).getMonth()===x).reduce((N,P)=>N+P.amount,0);if(i===0)return{direction:"neutral",percent:0};const v=(o-i)/i*100;return{direction:v>0?"up":v<0?"down":"neutral",percent:Math.abs(v)}},_=n?p[n]:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4 items-center mb-6",children:e.jsxs("select",{value:g,onChange:y=>r(y.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"1",children:"Last Month"}),e.jsx("option",{value:"3",children:"Last 3 Months"}),e.jsx("option",{value:"6",children:"Last 6 Months"}),e.jsx("option",{value:"12",children:"Last Year"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map((y,j)=>{const x=t>0?y.total/t*100:0,o=y.count>0?y.total/y.count:0,i=k(y.category),v=b(y.category);return e.jsxs("div",{onClick:()=>c(y.category),className:`bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 shadow-soft cursor-pointer transition-all duration-300 hover:shadow-soft-lg hover:scale-[1.02] ${n===y.category?"border-accent ring-2 ring-accent/20":"border-dark-brown/10"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:w(y.category)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary",children:y.category}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[y.count," transactions"]})]})]}),e.jsxs("div",{className:"text-right",children:[i.direction==="up"&&e.jsxs("div",{className:"flex items-center gap-1 text-soft-red text-xs",children:[e.jsx(te,{className:"w-3 h-3"}),i.percent.toFixed(0),"%"]}),i.direction==="down"&&e.jsxs("div",{className:"flex items-center gap-1 text-sage text-xs",children:[e.jsx(je,{className:"w-3 h-3"}),i.percent.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",y.total.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[x.toFixed(1),"% of total expenses"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Average per transaction"}),e.jsxs("p",{className:"text-lg font-semibold text-accent",children:["â‚¹",o.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsx("div",{className:"h-16",children:e.jsx(pe,{width:"100%",height:"100%",children:e.jsx(Dt,{data:v,children:e.jsx(Le,{type:"monotone",dataKey:"value",stroke:_t[j%_t.length],strokeWidth:2,dot:!1})})})})]},y.category)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Distribution"}),l.length>0?e.jsx(pe,{width:"100%",height:350,children:e.jsxs(Mt,{children:[e.jsx(Pt,{data:l,cx:"50%",cy:"50%",labelLine:!1,label:({name:y,percent:j})=>`${y} (${(j*100).toFixed(0)}%)`,outerRadius:120,fill:"#8884d8",dataKey:"value",onClick:y=>c(y.name),children:l.map((y,j)=>e.jsx(Et,{fill:_t[j%_t.length],className:"cursor-pointer hover:opacity-80 transition-opacity"},`cell-${j}`))}),e.jsx(ge,{formatter:y=>`â‚¹${y.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Comparison"}),a.length>0?e.jsx(pe,{width:"100%",height:350,children:e.jsxs(At,{data:a,layout:"vertical",children:[e.jsx(Ie,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Fe,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Te,{dataKey:"category",type:"category",width:120,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(ge,{formatter:y=>`â‚¹${y.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ct,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0],onClick:y=>c(y.category),className:"cursor-pointer"})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No expense data available"})]})]}),_&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-heading text-2xl font-bold text-primary flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:w(_.category)}),_.category," Details"]}),e.jsx("button",{onClick:()=>c(null),className:"px-4 py-2 text-sm font-semibold text-dark-brown hover:bg-dark-brown/5 rounded-lg transition-colors",children:"Clear Selection"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Subcategory"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Paid By"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"})]})}),e.jsx("tbody",{children:_.expenses.sort((y,j)=>new Date(j.expense_date).getTime()-new Date(y.expense_date).getTime()).map((y,j)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${j%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:$(new Date(y.expense_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:y.subcategory||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-lg font-bold text-secondary",children:["â‚¹",y.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:y.users_paid_by?.name||y.users?.name||"Unknown"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:y.vendors?.name||"-"})]},y.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Subtotal:"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-2xl font-bold text-accent",children:["â‚¹",_.total.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:2})]})})]})})]})]})}function Pr({expenses:s,investments:n}){const c=s.filter(b=>b.status==="approved"),g=n.filter(b=>b.status==="approved"),r=c.reduce((b,k)=>{const _=k.paid_by||k.user_id,y=k.users_paid_by?.name||k.users?.name||"Unknown";b[_]||(b[_]={id:_,name:y,totalExpenses:0,totalInvestments:0,expenseCount:0,approvedCount:0,submittedCount:0,paymentModes:{},categories:{}}),b[_].totalExpenses+=k.amount,b[_].expenseCount+=1,k.status==="approved"&&(b[_].approvedCount+=1);const j=k.payment_mode||"unknown";b[_].paymentModes[j]=(b[_].paymentModes[j]||0)+1;const x=k.category;return b[_].categories[x]=(b[_].categories[x]||0)+k.amount,b},{});s.forEach(b=>{const k=b.submitted_by,_=b.users_submitted_by?.name;k&&_&&(r[k]||(r[k]={id:k,name:_,totalExpenses:0,totalInvestments:0,expenseCount:0,approvedCount:0,submittedCount:0,paymentModes:{},categories:{}}),r[k].submittedCount+=1)}),g.forEach(b=>{const k=b.partner_id,_=b.users?.name;r[k]||(r[k]={id:k,name:_||"Unknown",totalExpenses:0,totalInvestments:0,expenseCount:0,approvedCount:0,submittedCount:0,paymentModes:{},categories:{}}),r[k].totalInvestments+=b.amount});const h=Object.values(r).sort((b,k)=>k.totalInvestments-b.totalInvestments),u=h.map(b=>({name:b.name,Investment:b.totalInvestments,Expense:b.totalExpenses})),m=[...h].sort((b,k)=>k.totalInvestments-b.totalInvestments).slice(0,5),p=[...h].sort((b,k)=>k.totalExpenses-b.totalExpenses).slice(0,5),f=[...h].filter(b=>b.submittedCount>0).sort((b,k)=>k.approvedCount/k.submittedCount-b.approvedCount/b.submittedCount).slice(0,5),t=b=>b.split(" ").map(k=>k[0]).join("").toUpperCase().slice(0,2),l=b=>{const k=Object.entries(b);return k.length===0?"N/A":k.sort((_,y)=>y[1]-_[1])[0][0].toUpperCase()},a=b=>{const k=Object.entries(b);return k.length===0?"N/A":k.sort((_,y)=>y[1]-_[1])[0][0]},w=b=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[b]||"ðŸ’°";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(b=>{const k=b.totalInvestments-b.totalExpenses,_=b.submittedCount>0?b.approvedCount/b.submittedCount*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-lg",children:t(b.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:b.name}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[b.expenseCount," expenses â€¢ ",b.submittedCount," submitted"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-sage/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",b.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",b.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]}),e.jsxs("div",{className:`rounded-lg p-3 mb-4 ${k>=0?"bg-accent/10":"bg-soft-red/10"}`,children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Net Contribution"}),e.jsxs("p",{className:`text-xl font-bold ${k>=0?"text-accent":"text-soft-red"}`,children:[k>=0?"+":"","â‚¹",k.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Approval Rate"]}),e.jsxs("span",{className:"font-semibold text-sage",children:[_.toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),"Payment Mode"]}),e.jsx("span",{className:"font-semibold text-primary",children:l(b.paymentModes)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Top Category"]}),e.jsxs("span",{className:"font-semibold text-accent",children:[w(a(b.categories))," ",a(b.categories)]})]})]})]},b.id)})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Investment vs Expense Comparison"}),u.length>0?e.jsx(pe,{width:"100%",height:400,children:e.jsxs(At,{data:u,children:[e.jsx(Ie,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Fe,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx(Te,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ge,{formatter:b=>`â‚¹${b.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ut,{}),e.jsx(ct,{dataKey:"Investment",fill:"#2D5016",radius:[8,8,0,0]}),e.jsx(ct,{dataKey:"Expense",fill:"#C17817",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[400px] flex items-center justify-center text-dark-brown/50",children:"No data available"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Qe,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Top Investors"})]}),e.jsx("div",{className:"space-y-3",children:m.map((b,k)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-accent/40",children:["#",k+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:t(b.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:b.name}),e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",b.totalInvestments.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},b.id))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Active Spenders"})]}),e.jsx("div",{className:"space-y-3",children:p.map((b,k)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-secondary/40",children:["#",k+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-secondary to-accent rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:t(b.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:b.name}),e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",b.totalExpenses.toLocaleString("en-IN",{maximumFractionDigits:0})]})]})]},b.id))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(G,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Best Approval Rate"})]}),e.jsx("div",{className:"space-y-3",children:f.map((b,k)=>{const _=b.approvedCount/b.submittedCount*100;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 rounded-lg",children:[e.jsxs("span",{className:"text-2xl font-bold text-sage/40",children:["#",k+1]}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-sage to-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:t(b.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-primary truncate",children:b.name}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:[_.toFixed(0),"%"]})]})]},b.id)})})]})]})]})}function Er({expenses:s,investments:n}){const[c,g]=d.useState($(new Date,"yyyy-MM")),[r,h]=d.useState(!0),u=new Date(c+"-01"),m=hs(u),p=ps(u),f=dt(u,1),t=hs(f),l=ps(f),a=s.filter(S=>{const T=new Date(S.expense_date);return T>=m&&T<=p&&S.status==="approved"}),w=n.filter(S=>{const T=new Date(S.investment_date);return T>=m&&T<=p&&S.status==="approved"}),b=s.filter(S=>{const T=new Date(S.expense_date);return T>=t&&T<=l&&S.status==="approved"}),k=n.filter(S=>{const T=new Date(S.investment_date);return T>=t&&T<=l&&S.status==="approved"}),_=a.reduce((S,T)=>S+T.amount,0),y=w.reduce((S,T)=>S+T.amount,0),j=y-_,x=b.reduce((S,T)=>S+T.amount,0),o=k.reduce((S,T)=>S+T.amount,0),i=o-x,v=x>0?(_-x)/x*100:0,N=o>0?(y-o)/o*100:0,P=i!==0?(j-i)/Math.abs(i)*100:0,L=a.reduce((S,T)=>(S[T.category]||(S[T.category]={thisMonth:0,lastMonth:0}),S[T.category].thisMonth+=T.amount,S),{});b.forEach(S=>{L[S.category]||(L[S.category]={thisMonth:0,lastMonth:0}),L[S.category].lastMonth+=S.amount});const I=Object.entries(L).map(([S,T])=>{const E=T.lastMonth>0?(T.thisMonth-T.lastMonth)/T.lastMonth*100:0;return{category:S,thisMonth:T.thisMonth,lastMonth:T.lastMonth,change:E,changeAmount:T.thisMonth-T.lastMonth}}).sort((S,T)=>T.thisMonth-S.thisMonth),U=ca({start:m,end:p}).map(S=>{const T=a.filter(Y=>Gt(new Date(Y.expense_date),S)),E=w.filter(Y=>Gt(new Date(Y.investment_date),S)),q=T.reduce((Y,me)=>Y+me.amount,0),O=E.reduce((Y,me)=>Y+me.amount,0);return{date:S,expenses:T,investments:E,expenseTotal:q,investmentTotal:O}}),B=[];for(let S=0;S<12;S++){const T=dt(new Date,S);B.push({value:$(T,"yyyy-MM"),label:$(T,"MMMM yyyy")})}const W=()=>{alert("PDF generation feature coming soon!")},ee=()=>{alert("Excel export feature coming soon!")},re=()=>{alert("Email report feature coming soon!")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("select",{value:c,onChange:S=>g(S.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 font-semibold",children:B.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))}),e.jsx("button",{onClick:()=>g($(new Date,"yyyy-MM")),className:"px-4 py-2 bg-primary/10 text-primary font-semibold rounded-xl hover:bg-primary/20 transition-colors",children:"Current Month"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:S=>h(S.target.checked),className:"w-4 h-4 rounded border-2 border-accent text-accent focus:ring-accent"}),e.jsx("span",{className:"text-sm font-medium text-dark-brown",children:"Compare with last month"})]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-2xl shadow-soft-lg p-8 border-2 border-accent/30",children:[e.jsx("h3",{className:"font-heading text-4xl font-bold text-primary mb-6",children:$(u,"MMMM yyyy")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Investments"}),e.jsxs("p",{className:"text-3xl font-bold text-sage mb-2",children:["â‚¹",y.toLocaleString("en-IN")]}),r&&e.jsxs("div",{className:`flex items-center gap-2 ${N>=0?"text-sage":"text-soft-red"}`,children:[N>=0?e.jsx(te,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[N>=0?"+":"",N.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",_.toLocaleString("en-IN")]}),r&&e.jsxs("div",{className:`flex items-center gap-2 ${v<=0?"text-sage":"text-soft-red"}`,children:[v>=0?e.jsx(te,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[v>=0?"+":"",v.toFixed(1),"% vs last month"]})]})]}),e.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-xl p-6 ${j>=0?"ring-2 ring-accent":"ring-2 ring-soft-red"}`,children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Net Change"}),e.jsxs("p",{className:`text-3xl font-bold mb-2 ${j>=0?"text-accent":"text-soft-red"}`,children:[j>=0?"+":"","â‚¹",j.toLocaleString("en-IN")]}),r&&e.jsxs("div",{className:`flex items-center gap-2 ${P>=0?"text-sage":"text-soft-red"}`,children:[P>=0?e.jsx(te,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-semibold",children:[P>=0?"+":"",P.toFixed(1),"% vs last month"]})]})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Category Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"This Month"}),r&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Last Month"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Change"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-dark-brown",children:"Trend"})]})]})}),e.jsx("tbody",{children:I.map((S,T)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${T%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:S.category}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-secondary",children:["â‚¹",S.thisMonth.toLocaleString("en-IN")]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right text-dark-brown",children:["â‚¹",S.lastMonth.toLocaleString("en-IN")]}),e.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${S.changeAmount>=0?"text-soft-red":"text-sage"}`,children:[S.changeAmount>=0?"+":"","â‚¹",S.changeAmount.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${S.change>0?"bg-soft-red/20 text-soft-red":S.change<0?"bg-sage/20 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:[S.change>0&&e.jsx(te,{className:"w-3 h-3"}),S.change<0&&e.jsx(je,{className:"w-3 h-3"}),S.change.toFixed(0),"%"]})})]})]},S.category))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-bold text-dark-brown",children:"Total"}),e.jsxs("td",{className:"px-4 py-3 text-right text-xl font-bold text-accent",children:["â‚¹",_.toLocaleString("en-IN")]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-dark-brown",children:["â‚¹",x.toLocaleString("en-IN")]}),e.jsx("td",{colSpan:2})]})]})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Detailed Daily Breakdown"}),e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Investments"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Expenses"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-dark-brown",children:"Net"})]})}),e.jsx("tbody",{children:U.map((S,T)=>{const E=S.investmentTotal-S.expenseTotal;return S.expenses.length>0||S.investments.length>0?e.jsxs("tr",{className:`border-b border-dark-brown/5 ${T%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-primary",children:$(S.date,"EEE, MMM d")}),e.jsx("td",{className:"px-4 py-3 text-right text-sage font-semibold",children:S.investmentTotal>0?`â‚¹${S.investmentTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-secondary font-semibold",children:S.expenseTotal>0?`â‚¹${S.expenseTotal.toLocaleString("en-IN")}`:"-"}),e.jsx("td",{className:`px-4 py-3 text-right font-bold ${E>0?"text-accent":E<0?"text-soft-red":"text-dark-brown"}`,children:E!==0?`${E>0?"+":""}â‚¹${E.toLocaleString("en-IN")}`:"-"})]},S.date.toString()):null})})]})})]}),e.jsxs("div",{className:"bg-cream/50 rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Export Options"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(se,{className:"w-5 h-5"}),"Download PDF Report"]}),e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-sage text-sage font-semibold rounded-xl hover:bg-sage hover:text-white transition-all duration-300",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Export to Excel"]}),e.jsxs("button",{onClick:re,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-primary text-primary font-semibold rounded-xl hover:bg-primary hover:text-white transition-all duration-300",children:[e.jsx(Be,{className:"w-5 h-5"}),"Email Report"]})]})]})]})}function Ar({expenses:s,vendors:n}){const g=s.filter(l=>l.status==="approved"&&l.vendor_id).reduce((l,a)=>{const w=a.vendor_id,b=a.vendors;if(!b)return l;l[w]||(l[w]={id:w,name:b.name,category:b.category,totalSpent:0,transactionCount:0,lastTransactionDate:a.expense_date,transactions:[],categories:{}}),l[w].totalSpent+=a.amount,l[w].transactionCount+=1,l[w].transactions.push(a),new Date(a.expense_date)>new Date(l[w].lastTransactionDate)&&(l[w].lastTransactionDate=a.expense_date);const k=a.category;return l[w].categories[k]=(l[w].categories[k]||0)+a.amount,l},{}),r=Object.values(g).sort((l,a)=>a.totalSpent-l.totalSpent),u=r.slice(0,10).map(l=>({name:l.name,amount:l.totalSpent})),m=l=>({"Raw Materials":"ðŸŒ¿",Packaging:"ðŸ“¦",Equipment:"ðŸ”§",Marketing:"ðŸ“¢",Operational:"âš™ï¸",Travel:"âœˆï¸",Utilities:"ðŸ’¡",Miscellaneous:"ðŸ“Š"})[l]||"ðŸ’°",p=l=>l&&{supplier:"ðŸ­",service:"ðŸ”§",contractor:"ðŸ‘·",transport:"ðŸšš",retail:"ðŸª"}[l.toLowerCase()]||"ðŸª",f=l=>X(new Date,new Date(l)),t=r.reduce((l,a)=>l+a.totalSpent,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(l=>{const a=l.transactionCount>0?l.totalSpent/l.transactionCount:0,w=f(l.lastTransactionDate),b=t>0?l.totalSpent/t*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-white to-cream rounded-xl p-6 border-2 border-dark-brown/10 shadow-soft hover:shadow-soft-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary to-sage rounded-lg flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-3xl",children:p(l.category)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary truncate",children:l.name}),e.jsx("p",{className:"text-xs text-dark-brown/60 capitalize",children:l.category||"General Vendor"})]})]}),e.jsxs("div",{className:"bg-secondary/10 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-2",children:["â‚¹",l.totalSpent.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[b.toFixed(1),"% of all vendor spending"]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:l.transactionCount})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Avg Transaction"}),e.jsxs("span",{className:"font-bold text-accent",children:["â‚¹",a.toLocaleString("en-IN",{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-dark-brown/60 flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3"}),"Last Transaction"]}),e.jsxs("span",{className:`font-semibold ${w>60?"text-soft-red":"text-sage"}`,children:[w," days ago"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-brown/10",children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-2",children:"Primary Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(l.categories).sort((k,_)=>_[1]-k[1]).slice(0,3).map(([k,_])=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-accent/10 rounded-full text-xs font-semibold text-dark-brown",children:[m(k)," ",k]},k))})]})]},l.id)})}),u.length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Top 10 Vendors by Spending"}),e.jsx(pe,{width:"100%",height:400,children:e.jsxs(At,{data:u,layout:"vertical",children:[e.jsx(Ie,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Fe,{type:"number",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Te,{dataKey:"name",type:"category",width:150,tick:{fontSize:11,fill:"#2D5016"}}),e.jsx(ge,{formatter:l=>`â‚¹${l.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #2D5016"}}),e.jsx(ct,{dataKey:"amount",fill:"#C17817",radius:[0,8,8,0]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-2xl shadow-soft p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(Gs,{className:"w-6 h-6 text-accent"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Vendors"})]}),e.jsx("p",{className:"text-5xl font-bold text-accent mb-2",children:r.length}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Active vendors with transactions"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-2xl shadow-soft p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-secondary"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Total Spent"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-2",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Across all vendors"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-2xl shadow-soft p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-sage"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Avg Transaction"})]}),e.jsxs("p",{className:"text-4xl font-bold text-sage mb-2",children:["â‚¹",r.length>0?(t/r.reduce((l,a)=>l+a.transactionCount,0)).toLocaleString("en-IN",{maximumFractionDigits:0}):"0"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per vendor transaction"})]})]}),r.filter(l=>f(l.lastTransactionDate)>90).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-2xl shadow-soft p-6 border-2 border-soft-red/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-soft-red/20 rounded-lg flex items-center justify-center",children:e.jsx(xe,{className:"w-6 h-6 text-soft-red"})}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Inactive Vendors"})]}),e.jsx("p",{className:"text-dark-brown/70 mb-4",children:"The following vendors haven't been used in over 90 days. Consider reviewing your vendor relationships."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:r.filter(l=>f(l.lastTransactionDate)>90).map(l=>{const a=f(l.lastTransactionDate);return e.jsxs("div",{className:"bg-white/60 rounded-lg p-4 border border-soft-red/20",children:[e.jsx("p",{className:"font-semibold text-primary mb-1",children:l.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Last used: ",$(new Date(l.lastTransactionDate),"MMM d, yyyy")]}),e.jsxs("p",{className:"text-xs text-soft-red font-semibold mt-1",children:[a," days ago"]})]},l.id)})})]})]})}function Ir(){const[s,n]=d.useState("overview"),[c,g]=d.useState([]),[r,h]=d.useState([]),[u,m]=d.useState([]),[p,f]=d.useState(!0);d.useEffect(()=>{t()},[]);const t=async()=>{try{const[a,w,b]=await Promise.all([C.from("expenses").select(`
            *,
            users:user_id(name, email),
            users_paid_by:users!expenses_paid_by_fkey(name, email),
            users_submitted_by:users!expenses_submitted_by_fkey(name),
            users_approved_by:users!expenses_approved_by_fkey(name),
            vendors(id, name, category)
          `).order("expense_date",{ascending:!1}),C.from("investments").select(`
            *,
            users:partner_id(name, email),
            users_submitted_by:users!investments_submitted_by_fkey(name)
          `).order("investment_date",{ascending:!1}),C.from("vendors").select("*").order("name")]);if(a.error)throw a.error;if(w.error)throw w.error;if(b.error)throw b.error;g(a.data||[]),h(w.data||[]),m(b.data||[])}catch(a){console.error("Error fetching data:",a)}finally{f(!1)}},l=[{id:"overview",name:"Overview",icon:te},{id:"category",name:"Category Analysis",icon:Ua},{id:"partner",name:"Partner Analysis",icon:we},{id:"monthly",name:"Monthly Reports",icon:_e},{id:"vendor",name:"Vendor Analysis",icon:Gs}];return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Financial Reports"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Comprehensive analysis of investments, expenses, and financial trends"})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-8 inline-flex gap-2 flex-wrap",children:l.map(a=>{const w=a.icon;return e.jsxs("button",{onClick:()=>n(a.id),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${s===a.id?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(w,{className:"w-5 h-5"}),a.name]},a.id)})}),p?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading reports..."})}):e.jsxs(e.Fragment,{children:[s==="overview"&&e.jsx(Dr,{expenses:c,investments:r,vendors:u}),s==="category"&&e.jsx(Mr,{expenses:c}),s==="partner"&&e.jsx(Pr,{expenses:c,investments:r}),s==="monthly"&&e.jsx(Er,{expenses:c,investments:r}),s==="vendor"&&e.jsx(Ar,{expenses:c,vendors:u})]})]})})]})}const Fr=["Initial Capital","Product Development","Raw Material Purchase","Equipment Purchase","Marketing Budget","Working Capital","Infrastructure","Other"];function Tr({isOpen:s,onClose:n,onSuccess:c,preselectedPartnerId:g}){const{user:r}=H(),[h,u]=d.useState(!1),[m,p]=d.useState([]),[f,t]=d.useState(""),[l,a]=d.useState(!1),[w,b]=d.useState({partnerId:g||"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null,requireApproval:!1}),k=r?.role==="admin";d.useEffect(()=>{s&&_()},[s]),d.useEffect(()=>{g&&b(N=>({...N,partnerId:g}))},[g]);const _=async()=>{try{const{data:N,error:P}=await C.from("users").select("id, name, email").order("name");if(P)throw P;p(N||[])}catch(N){console.error("Error fetching partners:",N)}},y=N=>{const P=N.target.files?.[0];if(P){if(P.size>10*1024*1024){alert("File size must be less than 10MB");return}b({...w,paymentProofFile:P})}},j=async N=>{try{const P=N.name.split(".").pop(),I=`payment-proofs/${`${Math.random()}.${P}`}`,{error:A}=await C.storage.from("investment-docs").upload(I,N);if(A)throw A;const{data:U}=C.storage.from("investment-docs").getPublicUrl(I);return U.publicUrl}catch(P){return console.error("Error uploading file:",P),null}},x=async N=>{if(N.preventDefault(),!w.partnerId||!w.amount||!w.purpose){alert("Please fill in all required fields");return}const P=parseFloat(w.amount);if(isNaN(P)||P<=0){alert("Please enter a valid positive amount");return}u(!0);try{let L=null;w.paymentProofFile&&(L=await j(w.paymentProofFile));const I=k&&!w.requireApproval?"approved":"pending",A={partner_id:w.partnerId,amount:P,investment_date:w.investmentDate,purpose:w.purpose,notes:w.notes||null,payment_proof_url:L,status:I,submitted_by:r?.id};I==="approved"&&(A.approved_by=r?.id,A.approved_at=new Date().toISOString());const{error:U}=await C.from("investments").insert([A]);if(U)throw U;const B=m.find(W=>W.id===w.partnerId);await C.from("activity_log").insert({user_id:r?.id,activity_type:"investment_added",description:`${r?.name} recorded investment of â‚¹${P.toLocaleString("en-IN")} for ${B?.name}`}),c(),n(),o()}catch(L){console.error("Error adding investment:",L),alert("Failed to add investment. Please try again.")}finally{u(!1)}},o=()=>{b({partnerId:"",amount:"",investmentDate:new Date().toISOString().split("T")[0],purpose:"",notes:"",paymentProofFile:null,requireApproval:!1}),t("")},i=m.filter(N=>N.name.toLowerCase().includes(f.toLowerCase())||N.email.toLowerCase().includes(f.toLowerCase())),v=m.find(N=>N.id===w.partnerId);return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-3xl font-bold text-white",children:"Record Investment"}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Add a new partner investment to the records"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(de,{className:"w-6 h-6 text-white"})})]})}),e.jsxs("form",{onSubmit:x,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Partner ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:v?v.name:f,onChange:N=>{t(N.target.value),a(!0),b({...w,partnerId:""})},onFocus:()=>a(!0),placeholder:"Search for a partner...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),l&&!v&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border-2 border-dark-brown/10 rounded-xl shadow-soft-lg max-h-60 overflow-y-auto",children:i.length>0?i.map(N=>e.jsxs("button",{type:"button",onClick:()=>{b({...w,partnerId:N.id}),t(""),a(!1)},className:"w-full px-4 py-3 text-left hover:bg-accent/10 transition-colors border-b border-dark-brown/5 last:border-0",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:N.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:N.email})]},N.id)):e.jsx("p",{className:"px-4 py-3 text-dark-brown/50",children:"No partners found"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Amount ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"number",value:w.amount,onChange:N=>b({...w,amount:N.target.value}),placeholder:"0",step:"0.01",min:"0",required:!0,className:"w-full pl-12 pr-4 py-4 text-2xl font-bold border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-dark-brown/40 text-sm",children:"INR"})]}),w.amount&&!isNaN(parseFloat(w.amount))&&e.jsxs("p",{className:"mt-2 text-sm text-dark-brown/60",children:["â‚¹",parseFloat(w.amount).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Investment Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsx("input",{type:"date",value:w.investmentDate,onChange:N=>b({...w,investmentDate:N.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purpose / Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-accent"}),e.jsxs("select",{value:w.purpose,onChange:N=>b({...w,purpose:N.target.value}),required:!0,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 appearance-none",children:[e.jsx("option",{value:"",children:"Select a purpose"}),Fr.map(N=>e.jsx("option",{value:N,children:N},N))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Proof (Optional)"}),e.jsxs("div",{className:"border-2 border-dashed border-dark-brown/20 rounded-xl p-6 hover:border-accent transition-colors",children:[e.jsx("input",{type:"file",id:"payment-proof",accept:"image/*,.pdf",onChange:y,className:"hidden"}),e.jsxs("label",{htmlFor:"payment-proof",className:"flex flex-col items-center cursor-pointer",children:[e.jsx(Ue,{className:"w-12 h-12 text-accent mb-3"}),w.paymentProofFile?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-sage",children:w.paymentProofFile.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[(w.paymentProofFile.size/1024/1024).toFixed(2)," MB"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Upload Receipt or Bank Statement"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"PNG, JPG or PDF (max 10MB)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-4 top-4 w-5 h-5 text-accent"}),e.jsx("textarea",{value:w.notes,onChange:N=>b({...w,notes:N.target.value}),placeholder:"Add any additional details...",maxLength:500,rows:3,className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-all duration-300 resize-none"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/50 mt-1",children:[w.notes.length,"/500 characters"]})]}),k&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-accent/5 rounded-xl",children:[e.jsx("input",{type:"checkbox",id:"require-approval",checked:w.requireApproval,onChange:N=>b({...w,requireApproval:N.target.checked}),className:"w-5 h-5 rounded border-2 border-accent text-accent focus:ring-accent"}),e.jsx("label",{htmlFor:"require-approval",className:"text-sm text-dark-brown cursor-pointer",children:"Require approval (otherwise auto-approve as admin)"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-dark-brown/10",children:[e.jsx("button",{type:"button",onClick:n,disabled:h,className:"flex-1 px-6 py-3 border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:h?"Recording...":e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5"}),"Record Investment"]})})]})]})]})]}):null}function Lr({partner:s,investments:n,totalInvestment:c,percentageOfTotal:g,isTopInvestor:r,onViewAll:h,onAddInvestment:u}){const m=t=>t.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2),p=n.sort((t,l)=>new Date(l.investment_date).getTime()-new Date(t.investment_date).getTime()).slice(0,3),f=t=>({"Initial Capital":"ðŸ’°","Product Development":"ðŸ§ª","Raw Material Purchase":"ðŸŒ¿","Equipment Purchase":"ðŸ”§","Marketing Budget":"ðŸ“¢","Working Capital":"ðŸ’¼",Infrastructure:"ðŸ¢",Other:"ðŸ“Š"})[t]||"ðŸ’°";return e.jsxs("div",{className:`relative bg-gradient-to-br from-cream via-white to-sage/10 rounded-2xl shadow-soft hover:shadow-soft-lg transition-all duration-300 overflow-hidden ${r?"border-4 border-accent":"border-2 border-dark-brown/10"}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),r&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsxs("div",{className:"bg-accent text-white px-3 py-1.5 rounded-full flex items-center gap-2 shadow-soft",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold",children:"Top Investor"})]})}),e.jsxs("div",{className:"relative p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-soft flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-xl",children:m(s.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary truncate",children:s.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 truncate",children:s.email})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-2",children:["â‚¹",c.toLocaleString("en-IN")]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-brown/70",children:[n.length," ",n.length===1?"investment":"investments"]}),e.jsxs("span",{className:"font-semibold text-secondary",children:[g.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-accent/10 to-secondary/10 rounded-xl p-1",children:e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary h-3 rounded-lg transition-all duration-500 shadow-soft",style:{width:`${Math.min(g,100)}%`}})}),p.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-dark-brown/60 uppercase tracking-wide",children:"Recent Investments"}),p.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/60 backdrop-blur-sm rounded-lg border border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsx("span",{className:"text-2xl",children:f(t.purpose)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown truncate",children:t.purpose}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:$(new Date(t.investment_date),"MMM d, yyyy")})]}),e.jsxs("p",{className:"text-sm font-bold text-secondary",children:["â‚¹",t.amount.toLocaleString("en-IN")]})]},t.id))]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs("button",{onClick:h,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300",children:[e.jsx(qe,{className:"w-4 h-4"}),"View All"]}),e.jsx("button",{onClick:u,className:"flex items-center justify-center px-4 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:e.jsx(Q,{className:"w-5 h-5"})})]})]})]})}function $r({isOpen:s,onClose:n,partner:c,investments:g}){if(!s)return null;const r=g.reduce((m,p)=>m+p.amount,0),h=m=>{switch(m){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}},u=()=>{alert("PDF generation feature coming soon!")};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-dark-brown/50 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 border-b-2 border-accent/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"font-heading text-3xl font-bold text-white",children:[c.name,"'s Investment History"]}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Complete record of all investments"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(de,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"p-6 bg-cream/50 border-b border-dark-brown/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Investment"}),e.jsxs("p",{className:"text-4xl font-bold text-accent",children:["â‚¹",r.toLocaleString("en-IN")]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 mt-1",children:["Across ",g.length," ",g.length===1?"investment":"investments"]})]}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-6 py-3 bg-white border-2 border-accent text-accent font-semibold rounded-xl hover:bg-accent hover:text-white transition-all duration-300 shadow-soft",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Download Statement"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:g.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-dark-brown/50",children:"No investments recorded yet"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),e.jsx("th",{className:"px-4 py-4 text-center text-sm font-semibold text-dark-brown",children:"Proof"})]})}),e.jsx("tbody",{children:g.sort((m,p)=>new Date(p.investment_date).getTime()-new Date(m.investment_date).getTime()).map((m,p)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${p%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:$(new Date(m.investment_date),"MMM d, yyyy")}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:m.purpose}),m.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1 line-clamp-2",children:m.notes})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-secondary",children:["â‚¹",m.amount.toLocaleString("en-IN")]})}),e.jsx("td",{className:"px-4 py-4",children:h(m.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-sm text-dark-brown",children:m.users_submitted_by?.name||"Unknown"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:m.payment_proof_url?e.jsx("a",{href:m.payment_proof_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex p-2 hover:bg-primary/10 rounded-lg transition-colors",title:"View proof",children:e.jsx(qe,{className:"w-4 h-4 text-primary"})}):e.jsx("span",{className:"text-xs text-dark-brown/30",children:"No proof"})})]},m.id))}),e.jsx("tfoot",{className:"bg-accent/10 border-t-2 border-accent/30",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-4 text-right font-bold text-dark-brown",children:"Total:"}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",r.toLocaleString("en-IN")]})}),e.jsx("td",{colSpan:3})]})})]})})}),e.jsx("div",{className:"p-4 bg-cream/50 border-t border-dark-brown/10 flex justify-end",children:e.jsx("button",{onClick:n,className:"px-6 py-3 bg-white border-2 border-dark-brown/20 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-all duration-300",children:"Close"})})]})]})}const vs=["#B8860B","#2D5016","#C17817","#8B4513","#D4AF37","#CD853F","#DAA520"];function qr({investments:s}){const n=s.filter(i=>i.status==="approved"),c=n.reduce((i,v)=>{const N=v.users?.name||"Unknown";return i[N]||(i[N]=0),i[N]+=v.amount,i},{}),g=Object.entries(c).map(([i,v])=>({name:i,value:Number(v)})),r=n.reduce((i,v)=>(i[v.purpose]||(i[v.purpose]=0),i[v.purpose]+=v.amount,i),{}),h=Object.entries(r).map(([i,v])=>({name:i,value:Number(v)})).sort((i,v)=>v.value-i.value),u=n.reduce((i,v)=>{const N=new Date(v.investment_date),P=`${N.getFullYear()}-${String(N.getMonth()+1).padStart(2,"0")}`;return i[P]||(i[P]=0),i[P]+=v.amount,i},{}),m=Object.keys(u).sort();let p=0;const f=m.map(i=>{p+=u[i];const[v,N]=i.split("-");return{month:new Date(parseInt(v),parseInt(N)-1).toLocaleDateString("en-US",{month:"short",year:"2-digit"}),monthly:u[i],cumulative:p}}),t=n.reduce((i,v)=>i+v.amount,0),l=new Set(n.map(i=>i.partner_id)).size,a=l>0?t/l:0,w=new Date().getMonth(),b=new Date().getFullYear(),k=new Date(b,w-1),_=n.filter(i=>{const v=new Date(i.investment_date);return v.getMonth()===w&&v.getFullYear()===b}),y=n.filter(i=>{const v=new Date(i.investment_date);return v.getMonth()===k.getMonth()&&v.getFullYear()===k.getFullYear()}),j=_.reduce((i,v)=>i+v.amount,0),x=y.reduce((i,v)=>i+v.amount,0),o=x>0?(j-x)/x*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx($e,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-xs font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent mb-1",children:["â‚¹",t.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Investment"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-xs font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-3xl font-bold text-sage mb-1",children:l}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Partners Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(Ka,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-xs font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-3xl font-bold text-secondary mb-1",children:["â‚¹",a.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-6 border-2 border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-primary uppercase tracking-wide",children:"Growth"})]}),e.jsxs("p",{className:`text-3xl font-bold mb-1 ${o>=0?"text-sage":"text-soft-red"}`,children:[o>=0?"+":"",o.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"This Month"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Partner Contributions"}),g.length>0?e.jsx(pe,{width:"100%",height:300,children:e.jsxs(Mt,{children:[e.jsx(Pt,{data:g,cx:"50%",cy:"50%",labelLine:!1,label:({name:i,percent:v})=>`${i} (${(v*100).toFixed(0)}%)`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:g.map((i,v)=>e.jsx(Et,{fill:vs[v%vs.length]},`cell-${v}`))}),e.jsx(ge,{formatter:i=>`â‚¹${i.toLocaleString("en-IN")}`})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment by Purpose"}),h.length>0?e.jsx(pe,{width:"100%",height:300,children:e.jsxs(At,{data:h,children:[e.jsx(Ie,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Fe,{dataKey:"name",tick:{fontSize:12,fill:"#2D5016"},angle:-45,textAnchor:"end",height:100}),e.jsx(Te,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ge,{formatter:i=>`â‚¹${i.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(ct,{dataKey:"value",fill:"#B8860B",radius:[8,8,0,0]})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Investment Timeline"}),f.length>0?e.jsx(pe,{width:"100%",height:350,children:e.jsxs(Dt,{data:f,children:[e.jsx(Ie,{strokeDasharray:"3 3",stroke:"#2D5016",opacity:.1}),e.jsx(Fe,{dataKey:"month",tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(Te,{tick:{fontSize:12,fill:"#2D5016"}}),e.jsx(ge,{formatter:i=>`â‚¹${i.toLocaleString("en-IN")}`,contentStyle:{backgroundColor:"#FFF8E7",border:"2px solid #B8860B"}}),e.jsx(ut,{}),e.jsx(Le,{type:"monotone",dataKey:"monthly",stroke:"#C17817",strokeWidth:2,name:"Monthly Investment",dot:{fill:"#C17817",r:4}}),e.jsx(Le,{type:"monotone",dataKey:"cumulative",stroke:"#2D5016",strokeWidth:3,name:"Cumulative Investment",dot:{fill:"#2D5016",r:5}})]})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-dark-brown/50",children:"No investment data available"})]}),t>=1e5&&e.jsxs("div",{className:"bg-gradient-to-r from-accent to-secondary rounded-2xl shadow-soft-lg p-8 text-center",children:[e.jsx("p",{className:"text-5xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"font-heading text-3xl font-bold text-white mb-2",children:"Milestone Achieved!"}),e.jsxs("p",{className:"text-white/90 text-lg",children:["Total investments have crossed â‚¹",(Math.floor(t/1e5)*1e5/1e3).toFixed(0),"K! Amazing progress toward building Organitto together."]})]})]})}function Rr(){const{user:s}=H(),[n,c]=d.useState([]),[g,r]=d.useState(!0),[h,u]=d.useState("by_partner"),[m,p]=d.useState(!1),[f,t]=d.useState(),[l,a]=d.useState(!1),[w,b]=d.useState(null),[k,_]=d.useState(!1),[y,j]=d.useState("approve"),[x,o]=d.useState(null),[i,v]=d.useState(null),N=s?.role==="admin";d.useEffect(()=>{P();const E=C.channel("investments-changes").on("postgres_changes",{event:"*",schema:"public",table:"investments"},()=>{P()}).subscribe();return()=>{C.removeChannel(E)}},[]);const P=async()=>{try{const{data:E,error:q}=await C.from("investments").select(`
          *,
          users:partner_id(name, email),
          users_submitted_by:users!investments_submitted_by_fkey(name),
          users_approved_by:users!investments_approved_by_fkey(name)
        `).order("investment_date",{ascending:!1});if(q)throw q;c(E||[])}catch(E){console.error("Error fetching investments:",E)}finally{r(!1)}},L=E=>{o(E),j("approve"),_(!0)},I=E=>{o(E),j("reject"),_(!0)},A=async(E,q)=>{if(!(!x||!s)){v(x.id);try{const O={status:y==="approve"?"approved":"rejected",approved_by:s.id,approved_at:new Date().toISOString()};y==="reject"&&q&&(O.rejection_reason=q);const{error:Y}=await C.from("investments").update(O).eq("id",x.id);if(Y)throw Y;await C.from("activity_log").insert({user_id:s.id,activity_type:y==="approve"?"investment_approved":"investment_rejected",description:`${s.name} ${y==="approve"?"approved":"rejected"} investment: â‚¹${x.amount.toLocaleString("en-IN")} from ${x.users?.name}`}),await P(),_(!1),o(null)}catch(O){console.error("Error processing approval:",O),alert("Failed to process approval. Please try again.")}finally{v(null)}}},U=async E=>{if(confirm("Are you sure you want to delete this investment? This action cannot be undone."))try{const{error:q}=await C.from("investments").delete().eq("id",E);if(q)throw q;await P()}catch(q){console.error("Error deleting investment:",q),alert("Failed to delete investment. Please try again.")}},B=n.reduce((E,q)=>{const O=q.partner_id,Y=E.find(me=>me.partner.id===O);return Y?(Y.investments.push(q),Y.total+=q.amount):q.users&&E.push({partner:{id:O,name:q.users.name,email:q.users.email},investments:[q],total:q.amount}),E},[]);B.sort((E,q)=>q.total-E.total);const W=n.filter(E=>E.status==="approved").reduce((E,q)=>E+q.amount,0),ee=new Set(n.filter(E=>E.status==="approved").map(E=>E.partner_id)).size,re=ee>0?W/ee:0,S=B.length>0?B[0].partner.id:null,T=E=>{switch(E){case"approved":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-sage/20 text-sage",children:"âœ… Approved"});case"pending":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-accent/20 text-accent",children:"â³ Pending"});case"rejected":return e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-soft-red/20 text-soft-red",children:"âŒ Rejected"});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Investment Tracker"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track partner investments and grow together"})]}),e.jsxs("button",{onClick:()=>{t(void 0),p(!0)},className:"flex items-center gap-2 px-6 py-4 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-105",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Investment"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-sm font-semibold text-accent uppercase tracking-wide",children:"Total"})]}),e.jsxs("p",{className:"text-4xl font-bold text-accent mb-1",children:["â‚¹",W.toLocaleString("en-IN")]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Total Amount Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-sm font-semibold text-sage uppercase tracking-wide",children:"Partners"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage mb-1",children:ee}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Partners Invested"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-6 border-2 border-secondary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(xt,{className:"w-6 h-6 text-secondary"})}),e.jsx("span",{className:"text-sm font-semibold text-secondary uppercase tracking-wide",children:"Average"})]}),e.jsxs("p",{className:"text-4xl font-bold text-secondary mb-1",children:["â‚¹",re.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Per Partner"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-2 mb-6 inline-flex gap-2",children:[e.jsxs("button",{onClick:()=>u("by_partner"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${h==="by_partner"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(we,{className:"w-5 h-5"}),"By Partner"]}),e.jsxs("button",{onClick:()=>u("all_investments"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${h==="all_investments"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"All Investments"]}),e.jsxs("button",{onClick:()=>u("statistics"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${h==="statistics"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(xt,{className:"w-5 h-5"}),"Statistics"]})]}),g?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading investments..."})}):h==="by_partner"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:B.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("p",{className:"text-dark-brown/50 mb-4",children:"No investments recorded yet"}),e.jsxs("button",{onClick:()=>p(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:scale-105 transition-all duration-300",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add First Investment"]})]}):B.map(E=>e.jsx(Lr,{partner:E.partner,investments:E.investments,totalInvestment:E.total,percentageOfTotal:E.total/W*100,isTopInvestor:E.partner.id===S,onViewAll:()=>{b(E),a(!0)},onAddInvestment:()=>{t(E.partner.id),p(!0)}},E.partner.id))}):h==="all_investments"?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Partner"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Purpose"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-dark-brown",children:"Added By"}),N&&e.jsx("th",{className:"px-4 py-4 text-right text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((E,q)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 hover:bg-cream/30 transition-colors ${q%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:$(new Date(E.investment_date),"MMM d, yyyy")}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:E.users?.name}),e.jsx("p",{className:"text-xs text-dark-brown/50",children:E.users?.email})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("p",{className:"text-lg font-bold text-accent",children:["â‚¹",E.amount.toLocaleString("en-IN")]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-medium text-dark-brown",children:E.purpose}),E.notes&&e.jsx("p",{className:"text-xs text-dark-brown/50 mt-1 line-clamp-1",children:E.notes})]}),e.jsx("td",{className:"px-4 py-4",children:T(E.status)}),e.jsx("td",{className:"px-4 py-4 text-sm text-dark-brown",children:E.users_submitted_by?.name||"Unknown"}),N&&e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[E.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>L(E),disabled:i===E.id,className:"p-2 hover:bg-sage/10 rounded-lg transition-colors disabled:opacity-50",title:"Approve",children:e.jsx(G,{className:"w-4 h-4 text-sage"})}),e.jsx("button",{onClick:()=>I(E),disabled:i===E.id,className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors disabled:opacity-50",title:"Reject",children:e.jsx(Ce,{className:"w-4 h-4 text-soft-red"})})]}),e.jsx("button",{onClick:()=>U(E.id),className:"p-2 hover:bg-soft-red/10 rounded-lg transition-colors",title:"Delete",children:e.jsx(oe,{className:"w-4 h-4 text-soft-red"})})]})})]},E.id))})]})})}):e.jsx(qr,{investments:n})]})}),m&&e.jsx(Tr,{isOpen:m,onClose:()=>{p(!1),t(void 0)},onSuccess:P,preselectedPartnerId:f}),l&&w&&e.jsx($r,{isOpen:l,onClose:()=>{a(!1),b(null)},partner:w.partner,investments:w.investments}),k&&x&&e.jsx(Zs,{isOpen:k,onClose:()=>{_(!1),o(null)},onConfirm:A,type:y,expense:{category:x.purpose,subcategory:x.notes,amount:x.amount,expense_date:x.investment_date,payment_mode:"Investment"},loading:i===x.id})]})}function Ur({product:s,users:n,onDragStart:c,onEdit:g,onMoveNext:r}){const h=ie(),u=X(new Date,new Date(s.stage_entered_at)),m=()=>{const a={high:{color:"bg-soft-red",dot:"ðŸ”´"},medium:{color:"bg-accent",dot:"ðŸŸ¡"},low:{color:"bg-sage",dot:"ðŸŸ¢"}};return a[s.priority]||a.medium},p=a=>({Skincare:"âœ¨","Hair Care":"ðŸ’†","Wellness & Supplements":"ðŸŒ¿","Oral Care":"ðŸ¦·","Personal Care":"ðŸ§´","Home Care":"ðŸ ",Other:"ðŸ“¦"})[a]||"ðŸ“¦",f=n.filter(a=>s.assigned_partners.includes(a.id)),t=a=>a.split(" ").map(w=>w[0]).join("").toUpperCase().slice(0,2),l=m();return e.jsxs("div",{draggable:!0,onDragStart:()=>c(s),className:"bg-white rounded-xl shadow-soft p-4 mb-3 cursor-move hover:shadow-soft-lg transition-all duration-300 border-2 border-transparent hover:border-accent/30 relative group",children:[e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${l.color} text-white`,children:[l.dot," ",s.priority.toUpperCase()]})}),s.image_url?e.jsx("div",{className:"w-full h-32 bg-cream/50 rounded-lg mb-3 overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-32 bg-gradient-to-br from-sage/20 to-accent/20 rounded-lg mb-3 flex items-center justify-center",children:e.jsx("span",{className:"text-5xl",children:p(s.category)})}),e.jsx("h4",{className:"font-heading text-lg font-bold text-primary mb-2 pr-16",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:s.category}),s.product_type&&e.jsx("span",{className:"text-xs px-2 py-1 bg-secondary/10 text-secondary rounded-full",children:s.product_type})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-dark-brown/60 font-semibold",children:"Stage Progress"}),e.jsxs("span",{className:"text-xs font-bold text-accent",children:[s.progress,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60 mb-3",children:[e.jsx(le,{className:"w-3 h-3"}),e.jsxs("span",{className:u>30?"text-soft-red font-semibold":"",children:[u," days in stage",u>30&&" âš ï¸"]})]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-3",children:[f.slice(0,3).map((a,w)=>e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent to-secondary flex items-center justify-center text-white text-xs font-bold border-2 border-white shadow-sm",style:{marginLeft:w>0?"-8px":"0",zIndex:3-w},title:a.name,children:t(a.name)},a.id)),f.length>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-dark-brown/20 flex items-center justify-center text-xs font-bold text-dark-brown ml-1",children:["+",f.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-dark-brown/60 mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(es,{className:"w-3 h-3"}),"0/0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ft,{className:"w-3 h-3"}),"0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3"}),"0"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>h(`/products/${s.id}`),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(qe,{className:"w-4 h-4"}),"View"]}),e.jsxs("button",{onClick:()=>g(s),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors text-xs font-semibold",children:[e.jsx(fe,{className:"w-4 h-4"}),"Edit"]}),e.jsx("button",{onClick:()=>r(s),className:"flex items-center justify-center gap-1 px-3 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg transition-colors text-xs font-semibold",children:e.jsx(Zt,{className:"w-4 h-4"})})]})]})}const zr=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],Br=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Or=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function Vr({isOpen:s,onClose:n,onSubmit:c,users:g}){const[r,h]=d.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),[u,m]=d.useState(!1);if(!s)return null;const p=async t=>{t.preventDefault(),m(!0);try{await c(r),h({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:""}),n()}catch(l){console.error("Error creating product:",l)}finally{m(!1)}},f=t=>{h(l=>({...l,assigned_partners:l.assigned_partners.includes(t)?l.assigned_partners.filter(a=>a!==t):[...l.assigned_partners,t]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Add New Product"}),e.jsx("button",{onClick:n,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(de,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:t=>h({...r,name:t.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:r.category,onChange:t=>h({...r,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),zr.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:r.product_type,onChange:t=>h({...r,product_type:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Br.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Initial Stage"}),e.jsx("select",{value:r.current_stage,onChange:t=>h({...r,current_stage:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Or.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:r.target_launch_date,onChange:t=>h({...r,target_launch_date:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",bgColor:"bg-red-500",hoverColor:"hover:bg-red-600",borderColor:"border-red-500"},{value:"medium",label:"Medium",bgColor:"bg-orange-500",hoverColor:"hover:bg-orange-600",borderColor:"border-orange-500"},{value:"low",label:"Low",bgColor:"bg-green-500",hoverColor:"hover:bg-green-600",borderColor:"border-green-500"}].map(t=>e.jsxs("label",{className:`flex-1 cursor-pointer px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 border-2 ${r.priority===t.value?`${t.bgColor} ${t.borderColor} text-white shadow-md`:`bg-white ${t.borderColor} border-opacity-30 text-dark-brown hover:border-opacity-100 hover:shadow-sm`}`,children:[e.jsx("input",{type:"radio",name:"priority",value:t.value,checked:r.priority===t.value,onChange:l=>h({...r,priority:l.target.value}),className:"sr-only"}),t.label]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:t=>h({...r,description:t.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:g.map(t=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${r.assigned_partners.includes(t.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:r.assigned_partners.includes(t.id),onChange:()=>f(t.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:t.name})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:r.image_url,onChange:t=>h({...r,image_url:t.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Upload"]})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Or enter a direct image URL"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition-colors border-2 border-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"flex-1 px-6 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold rounded-xl hover:from-emerald-700 hover:to-teal-700 shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-lg",children:u?"Creating...":"Create Product"})]})]})]})})}const Hr=["Skincare","Hair Care","Wellness & Supplements","Oral Care","Personal Care","Home Care","Other"],Wr=["Face Wash","Shampoo","Oil","Powder","Tablet","Capsule","Gel","Cream","Soap","Serum","Mask","Scrub","Lotion","Other"],Qr=[{value:"idea",label:"ðŸŒ± Idea"},{value:"research",label:"ðŸ” Research"},{value:"formula",label:"âš—ï¸ Formula Creation"},{value:"testing",label:"ðŸ§ª Testing"},{value:"packaging",label:"ðŸ“¦ Packaging Design"},{value:"printing",label:"ðŸ–¨ï¸ Printing"},{value:"production",label:"ðŸ­ Production"},{value:"ready",label:"ðŸš€ Ready to Launch"},{value:"launched",label:"âœ… Launched"}];function Xs({isOpen:s,onClose:n,onSubmit:c,product:g,users:r}){const[h,u]=d.useState({name:"",category:"",product_type:"",current_stage:"idea",priority:"medium",target_launch_date:"",description:"",assigned_partners:[],image_url:"",progress:0}),[m,p]=d.useState(!1);if(d.useEffect(()=>{g&&u({name:g.name||"",category:g.category||"",product_type:g.product_type||"",current_stage:g.current_stage||"idea",priority:g.priority||"medium",target_launch_date:g.target_launch_date||"",description:g.description||"",assigned_partners:g.assigned_partners||[],image_url:g.image_url||"",progress:g.progress||0})},[g]),!s)return null;const f=async l=>{l.preventDefault(),p(!0);try{await c(g.id,h),n()}catch(a){console.error("Error updating product:",a)}finally{p(!1)}},t=l=>{u(a=>({...a,assigned_partners:a.assigned_partners.includes(l)?a.assigned_partners.filter(w=>w!==l):[...a.assigned_partners,l]}))};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-3xl font-bold text-white",children:"Edit Product"}),e.jsx("button",{onClick:n,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(de,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:h.name,onChange:l=>u({...h,name:l.target.value}),placeholder:"e.g., Neem Face Wash",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:h.category,onChange:l=>u({...h,category:l.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select category"}),Hr.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Type"}),e.jsxs("select",{value:h.product_type,onChange:l=>u({...h,product_type:l.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Wr.map(l=>e.jsx("option",{value:l,children:l},l))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Stage"}),e.jsx("select",{value:h.current_stage,onChange:l=>u({...h,current_stage:l.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Qr.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Launch Date"}),e.jsx("input",{type:"date",value:h.target_launch_date,onChange:l=>u({...h,target_launch_date:l.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Progress"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:h.progress,onChange:l=>u({...h,progress:parseInt(l.target.value)}),className:"flex-1"}),e.jsxs("span",{className:"text-2xl font-bold text-accent min-w-[60px]",children:[h.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${h.progress}%`}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-4",children:[{value:"high",label:"High",color:"bg-soft-red"},{value:"medium",label:"Medium",color:"bg-accent"},{value:"low",label:"Low",color:"bg-sage"}].map(l=>e.jsxs("label",{className:`flex-1 cursor-pointer ${h.priority===l.value?`${l.color} text-white`:"bg-dark-brown/5 text-dark-brown"} px-4 py-3 rounded-xl font-semibold text-center transition-all duration-300 hover:scale-105`,children:[e.jsx("input",{type:"radio",name:"priority",value:l.value,checked:h.priority===l.value,onChange:a=>u({...h,priority:a.target.value}),className:"sr-only"}),l.label]},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:h.description,onChange:l=>u({...h,description:l.target.value}),placeholder:"Briefly describe the product concept...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign Team Members"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:r.map(l=>e.jsxs("label",{className:`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all duration-300 ${h.assigned_partners.includes(l.id)?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50"}`,children:[e.jsx("input",{type:"checkbox",checked:h.assigned_partners.includes(l.id),onChange:()=>t(l.id),className:"sr-only"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:l.name})]},l.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Image URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",value:h.image_url,onChange:l=>u({...h,image_url:l.target.value}),placeholder:"https://example.com/image.jpg",className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("button",{type:"button",className:"px-6 py-3 bg-cream border-2 border-dark-brown/10 rounded-xl hover:bg-dark-brown/5 transition-colors flex items-center gap-2 text-dark-brown font-semibold",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Upload"]})]}),h.image_url&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:h.image_url,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg border-2 border-dark-brown/10"})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Updating...":"Update Product"})]})]})]})})}const ot=[{id:"idea",name:"Idea",icon:"ðŸŒ±",gradient:"from-sage/30 to-sage/10"},{id:"research",name:"Research",icon:"ðŸ”",gradient:"from-sage/25 to-sage/10"},{id:"formula",name:"Formula Creation",icon:"âš—ï¸",gradient:"from-sage/20 to-accent/10"},{id:"testing",name:"Testing",icon:"ðŸ§ª",gradient:"from-accent/30 to-accent/10"},{id:"packaging",name:"Packaging Design",icon:"ðŸ“¦",gradient:"from-accent/25 to-accent/10"},{id:"printing",name:"Printing",icon:"ðŸ–¨ï¸",gradient:"from-accent/20 to-secondary/10"},{id:"production",name:"Production",icon:"ðŸ­",gradient:"from-secondary/30 to-secondary/10"},{id:"ready",name:"Ready to Launch",icon:"ðŸš€",gradient:"from-secondary/25 to-secondary/10"},{id:"launched",name:"Launched",icon:"âœ…",gradient:"from-primary/40 to-primary/20"}];function Gr(){const{user:s}=H(),n=ie(),[c,g]=d.useState("board"),[r,h]=d.useState(!1),[u,m]=d.useState(!1),[p,f]=d.useState(null),[t,l]=d.useState([]),[a,w]=d.useState([]),[b,k]=d.useState(!0),[_,y]=d.useState(null),[j,x]=d.useState("all"),[o,i]=d.useState("");d.useEffect(()=>{v()},[]);const v=async()=>{try{const[E,q]=await Promise.all([C.from("products").select("*").order("created_at",{ascending:!1}),C.from("users").select("id, name, email").order("name")]);if(E.error)throw E.error;if(q.error)throw q.error;l(E.data||[]),w(q.data||[])}catch(E){console.error("Error fetching data:",E)}finally{k(!1)}},N=async E=>{try{const{data:q,error:O}=await C.from("products").insert([{...E,created_by:s?.id,stage_entered_at:new Date().toISOString()}]).select().single();if(O)throw O;await C.from("product_stage_history").insert([{product_id:q.id,stage:E.current_stage,moved_by:s?.id,notes:"Product created"}]),await v()}catch(q){throw console.error("Error creating product:",q),q}},P=E=>{y(E)},L=E=>{E.preventDefault()},I=async(E,q)=>{if(E.preventDefault(),!_||_.current_stage===q){y(null);return}if(q==="launched"&&!window.confirm(`Are you sure you want to launch "${_.name}"? This marks it as complete.`)){y(null);return}try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",_.id).is("exited_at",null),await C.from("products").update({current_stage:q,stage_entered_at:new Date().toISOString(),progress:q==="launched"?100:_.progress}).eq("id",_.id),await C.from("product_stage_history").insert([{product_id:_.id,stage:q,moved_by:s?.id}]),await v()}catch(O){console.error("Error moving product:",O)}finally{y(null)}},A=async E=>{const q=ot.findIndex(Y=>Y.id===E.current_stage);if(q===-1||q===ot.length-1)return;const O=ot[q+1].id;await I({preventDefault:()=>{}},O)},U=E=>{f(E),m(!0)},B=async(E,q)=>{try{const{error:O}=await C.from("products").update({...q,updated_at:new Date().toISOString()}).eq("id",E);if(O)throw O;await C.from("activity_log").insert({user_id:s?.id,activity_type:"product_updated",description:`${s?.name} updated product: ${q.name}`}),await v()}catch(O){throw console.error("Error updating product:",O),O}},W=t.filter(E=>!(j!=="all"&&E.priority!==j||o&&!E.name.toLowerCase().includes(o.toLowerCase()))),ee=t.length,re=t.filter(E=>E.current_stage!=="launched").length,S=t.filter(E=>E.current_stage==="launched").length,T=t.filter(E=>E.priority==="high").length;return e.jsxs("div",{className:"min-h-screen bg-cream relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232D5016' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx("button",{onClick:()=>h(!0),className:"fixed bottom-8 right-8 w-16 h-16 bg-gradient-to-r from-secondary to-accent text-white rounded-full shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-110 flex items-center justify-center z-40 group",children:e.jsx(Q,{className:"w-8 h-8 group-hover:rotate-90 transition-transform duration-300"})}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-5xl font-bold text-primary mb-2",children:"Product Development Pipeline"}),e.jsx("p",{className:"text-dark-brown/70 text-lg",children:"Track your Ayurvedic products from concept to launch"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-3 px-6 py-4 bg-accent text-white rounded-xl font-bold text-lg shadow-soft-lg hover:shadow-2xl transition-all duration-300 hover:scale-105 hover:bg-accent/90",children:[e.jsx(Q,{className:"w-6 h-6"}),"Add New Product"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl p-6 border-2 border-primary/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ne,{className:"w-6 h-6 text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Products"})]}),e.jsx("p",{className:"text-4xl font-bold text-primary",children:ee})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 rounded-xl p-6 border-2 border-accent/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(xe,{className:"w-6 h-6 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"In Development"})]}),e.jsx("p",{className:"text-4xl font-bold text-accent",children:re})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/20 to-sage/10 rounded-xl p-6 border-2 border-sage/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Va,{className:"w-6 h-6 text-sage"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Launched"})]}),e.jsx("p",{className:"text-4xl font-bold text-sage",children:S})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/20 to-soft-red/10 rounded-xl p-6 border-2 border-soft-red/30 shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(G,{className:"w-6 h-6 text-soft-red"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"High Priority"})]}),e.jsx("p",{className:"text-4xl font-bold text-soft-red",children:T})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft p-4 mb-8 flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g("board"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${c==="board"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx($a,{className:"w-5 h-5"}),"Board View"]}),e.jsxs("button",{onClick:()=>g("list"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${c==="list"?"bg-gradient-to-r from-accent to-secondary text-white shadow-soft":"text-dark-brown hover:bg-accent/10"}`,children:[e.jsx(gt,{className:"w-5 h-5"}),"List View"]})]}),e.jsxs("div",{className:"flex gap-3 flex-1 max-w-md",children:[e.jsx("input",{type:"text",placeholder:"Search products...",value:o,onChange:E=>i(E.target.value),className:"flex-1 px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"}),e.jsxs("select",{value:j,onChange:E=>x(E.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"low",children:"Low Priority"})]})]})]}),b?e.jsx("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:e.jsx("p",{className:"text-dark-brown/50",children:"Loading products..."})}):c==="board"?e.jsx("div",{className:"overflow-x-auto pb-4",children:e.jsx("div",{className:"flex gap-4 min-w-max",children:ot.map(E=>{const q=W.filter(O=>O.current_stage===E.id);return e.jsxs("div",{onDragOver:L,onDrop:O=>I(O,E.id),className:`w-80 flex-shrink-0 bg-gradient-to-b ${E.gradient} rounded-2xl p-4 border-2 border-dark-brown/10 shadow-soft`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-heading text-lg font-bold text-primary flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:E.icon}),E.name]}),e.jsx("span",{className:"bg-white px-3 py-1 rounded-full text-sm font-bold text-primary shadow-sm",children:q.length})]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-400px)] overflow-y-auto pr-2",children:q.length===0?e.jsx("div",{className:"text-center py-8 text-dark-brown/40 text-sm",children:"No products in this stage"}):q.map(O=>e.jsx(Ur,{product:O,users:a,onDragStart:P,onEdit:U,onMoveNext:A},O.id))})]},E.id)})})}):e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-accent/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Priority"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Progress"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Days in Stage"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Target Launch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:W.map((E,q)=>{const O=ot.find(me=>me.id===E.current_stage),Y=Math.floor((new Date().getTime()-new Date(E.stage_entered_at).getTime())/(1e3*60*60*24));return e.jsxs("tr",{className:`border-b border-dark-brown/5 ${q%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/20 rounded-lg flex items-center justify-center text-2xl",children:O?.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-primary",children:E.name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:E.product_type})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm px-2 py-1 bg-primary/10 text-primary rounded-full font-semibold",children:E.category})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-sm px-3 py-1 bg-gradient-to-r ${O?.gradient} rounded-full font-semibold text-dark-brown`,children:O?.name})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold text-white ${E.priority==="high"?"bg-soft-red":E.priority==="medium"?"bg-accent":"bg-sage"}`,children:E.priority.toUpperCase()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent",style:{width:`${E.progress}%`}})}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[E.progress,"%"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-sm ${Y>30?"text-soft-red font-semibold":"text-dark-brown/70"}`,children:[Y," days"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:E.target_launch_date||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(`/products/${E.id}`),className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",title:"View Details",children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U(E),className:"p-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg transition-colors",title:"Edit Product",children:e.jsx(fe,{className:"w-4 h-4"})})]})})]},E.id)})})]})})}),W.length===0&&!b&&e.jsxs("div",{className:"text-center py-16 bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ±"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"No products yet!"}),e.jsx("p",{className:"text-dark-brown/60 mb-6",children:"Create your first Ayurvedic product to get started"}),e.jsx("button",{onClick:()=>h(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all duration-300",children:"Create Product"})]})]})}),e.jsx(Vr,{isOpen:r,onClose:()=>h(!1),onSubmit:N,users:a}),p&&e.jsx(Xs,{isOpen:u,onClose:()=>{m(!1),f(null)},onSubmit:B,product:p,users:a})]})}function Yr({product:s,onRefresh:n}){H();const[c,g]=d.useState([]),[r,h]=d.useState([]),[u,m]=d.useState(null),[p,f]=d.useState(!1),[t,l]=d.useState(s.description||"");d.useEffect(()=>{a()},[s.id]);const a=async()=>{try{const[x,o]=await Promise.all([C.from("product_stage_history").select("*, moved_by").eq("product_id",s.id).order("entered_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(x.error)throw x.error;if(o.error)throw o.error;if(g(x.data||[]),h(o.data||[]),s.created_by){const i=o.data?.find(v=>v.id===s.created_by);m(i)}}catch(x){console.error("Error fetching data:",x)}},w=async()=>{try{const{error:x}=await C.from("products").update({description:t}).eq("id",s.id);if(x)throw x;f(!1),n()}catch(x){console.error("Error updating description:",x)}},b=r.filter(x=>s.assigned_partners?.includes(x.id)),k=X(new Date,new Date(s.created_at)),_=x=>x.split(" ").map(o=>o[0]).join("").toUpperCase().slice(0,2),y=x=>r.find(i=>i.id===x)?.name||"Unknown",j={idea:"ðŸŒ± Idea",research:"ðŸ” Research",formula:"âš—ï¸ Formula Creation",testing:"ðŸ§ª Testing",packaging:"ðŸ“¦ Packaging Design",printing:"ðŸ–¨ï¸ Printing",production:"ðŸ­ Production",ready:"ðŸš€ Ready to Launch",launched:"âœ… Launched"};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Product Information"}),!p&&e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"Edit Description"})]}),s.image_url&&e.jsx("div",{className:"mb-4 rounded-xl overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-64 object-cover"})}),p?e.jsxs("div",{children:[e.jsx("textarea",{value:t,onChange:x=>l(x.target.value),placeholder:"Enter product description...",rows:6,className:"w-full px-4 py-3 border-2 border-accent/30 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none mb-3"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:w,className:"px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-lg font-semibold hover:shadow-soft transition-all",children:"Save"}),e.jsx("button",{onClick:()=>{l(s.description||""),f(!1)},className:"px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:"Cancel"})]})]}):e.jsx("p",{className:"text-dark-brown/70 leading-relaxed",children:s.description||"No description provided yet."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Category"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Product Type"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:s.product_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created Date"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:$(new Date(s.created_at),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-1",children:"Created By"}),e.jsx("p",{className:"text-dark-brown font-semibold",children:u?.name||"Unknown"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Stage History"}),e.jsx("div",{className:"space-y-3",children:c.map((x,o)=>{const i=x.exited_at?X(new Date(x.exited_at),new Date(x.entered_at)):X(new Date,new Date(x.entered_at));return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white rounded-lg border-2 border-dark-brown/5",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-2xl ${o===0?"bg-accent/20":"bg-dark-brown/5"}`,children:j[x.stage]?.split(" ")[0]||"ðŸ“¦"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:j[x.stage]||x.stage}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Entered ",$(new Date(x.entered_at),"MMM dd, yyyy")," by ",y(x.moved_by)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-accent",children:[i," days"]}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:x.exited_at?"Completed":"Current"})]})]},x.id)})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-white rounded-xl p-6 border-2 border-accent/20",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Total Development"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[k," days"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-sage/10 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Progress"}),e.jsxs("p",{className:"text-xl font-bold text-sage",children:[s.progress,"%"]})]})]}),s.target_launch_date&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center",children:e.jsx(_e,{className:"w-6 h-6 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 font-semibold",children:"Target Launch"}),e.jsx("p",{className:"text-xl font-bold text-secondary",children:$(new Date(s.target_launch_date),"MMM dd, yyyy")})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Assigned Team"}),b.length>0?e.jsx("div",{className:"space-y-3",children:b.map(x=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold",children:_(x.name)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:x.name}),e.jsx("p",{className:"text-sm text-dark-brown/60 capitalize",children:x.role})]})]},x.id))}):e.jsx("p",{className:"text-dark-brown/50 text-sm",children:"No team members assigned yet."}),e.jsx("button",{className:"w-full mt-4 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors",children:"+ Add Team Member"})]})]})]})})}const Kr=["Herb","Oil","Powder","Extract","Base","Preservative","Fragrance","Active","Other"],Jr=["g","ml","kg","L","%","drops"],Zr=["Cooling","Heating","Vata-balancing","Pitta-balancing","Kapha-balancing","Anti-inflammatory","Antimicrobial","Moisturizing","Detoxifying","Rejuvenating"];function Xr({productId:s}){H();const[n,c]=d.useState([]),[g,r]=d.useState([]),[h,u]=d.useState(null),[m,p]=d.useState(!1),[f,t]=d.useState(null),[l,a]=d.useState({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""});d.useEffect(()=>{w()},[s]);const w=async()=>{try{const[o,i]=await Promise.all([C.from("product_ingredients").select("*").eq("product_id",s).order("created_at",{ascending:!0}),C.from("formula_versions").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(o.error)throw o.error;if(i.error)throw i.error;c(o.data||[]),r(i.data||[]);const v=i.data?.find(N=>N.is_current);u(v)}catch(o){console.error("Error fetching data:",o)}},b=async o=>{o.preventDefault();try{if(f){const{error:i}=await C.from("product_ingredients").update({...l,quantity:parseFloat(l.quantity)||0,cost_per_unit:parseFloat(l.cost_per_unit)||0}).eq("id",f);if(i)throw i}else{const{error:i}=await C.from("product_ingredients").insert([{product_id:s,...l,quantity:parseFloat(l.quantity)||0,cost_per_unit:parseFloat(l.cost_per_unit)||0}]);if(i)throw i}y(),w()}catch(i){console.error("Error saving ingredient:",i)}},k=o=>{a({ingredient_name:o.ingredient_name,botanical_name:o.botanical_name||"",type:o.type||"",quantity:o.quantity?.toString()||"",unit:o.unit||"g",vendor:o.vendor||"",cost_per_unit:o.cost_per_unit?.toString()||"",ayurvedic_properties:o.ayurvedic_properties||[],notes:o.notes||""}),t(o.id),p(!0)},_=async o=>{if(confirm("Are you sure you want to delete this ingredient?"))try{const{error:i}=await C.from("product_ingredients").delete().eq("id",o);if(i)throw i;w()}catch(i){console.error("Error deleting ingredient:",i)}},y=()=>{a({ingredient_name:"",botanical_name:"",type:"",quantity:"",unit:"g",vendor:"",cost_per_unit:"",ayurvedic_properties:[],notes:""}),t(null),p(!1)},j=o=>{a(i=>({...i,ayurvedic_properties:i.ayurvedic_properties.includes(o)?i.ayurvedic_properties.filter(v=>v!==o):[...i.ayurvedic_properties,o]}))},x=n.reduce((o,i)=>o+(i.quantity||0)*(i.cost_per_unit||0),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Ingredients List"}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Ingredient"]})]}),e.jsx("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream/50 border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Cost/Unit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Properties"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((o,i)=>e.jsxs("tr",{className:`border-b border-dark-brown/5 ${i%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:o.ingredient_name}),o.botanical_name&&e.jsx("p",{className:"text-sm text-dark-brown/60 italic",children:o.botanical_name})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:o.type||"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"font-semibold text-dark-brown",children:[o.quantity||0," ",o.unit]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:o.vendor||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-dark-brown",children:["â‚¹",o.cost_per_unit?.toFixed(2)||"0.00"]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-bold text-accent",children:["â‚¹",((o.quantity||0)*(o.cost_per_unit||0)).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(o.ayurvedic_properties||[]).slice(0,2).map(v=>e.jsx("span",{className:"px-2 py-0.5 bg-sage/10 text-sage rounded text-xs font-semibold",children:v},v)),(o.ayurvedic_properties||[]).length>2&&e.jsxs("span",{className:"text-xs text-dark-brown/60",children:["+",(o.ayurvedic_properties||[]).length-2]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(o),className:"p-2 text-accent hover:bg-accent/10 rounded-lg transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(o.id),className:"p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})})]},o.id))}),e.jsx("tfoot",{className:"bg-accent/5 border-t-2 border-accent/20",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"px-4 py-3 text-right font-bold text-dark-brown",children:"Total Raw Material Cost:"}),e.jsxs("td",{className:"px-4 py-3 font-bold text-xl text-accent",children:["â‚¹",x.toFixed(2)]}),e.jsx("td",{colSpan:2})]})})]})})}),n.length===0&&e.jsxs("div",{className:"text-center py-12 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸŒ¿"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No ingredients added yet"}),e.jsx("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Add Your First Ingredient"})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:f?"Edit Ingredient":"Add New Ingredient"}),e.jsx("button",{onClick:y,className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors",children:e.jsx(de,{className:"w-6 h-6 text-white"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Ingredient Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:l.ingredient_name,onChange:o=>a({...l,ingredient_name:o.target.value}),placeholder:"e.g., Neem Extract",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical Name"}),e.jsx("input",{type:"text",value:l.botanical_name,onChange:o=>a({...l,botanical_name:o.target.value}),placeholder:"e.g., Azadirachta indica",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Type"}),e.jsxs("select",{value:l.type,onChange:o=>a({...l,type:o.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:[e.jsx("option",{value:"",children:"Select type"}),Kr.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",value:l.quantity,onChange:o=>a({...l,quantity:o.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("select",{value:l.unit,onChange:o=>a({...l,unit:o.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20",children:Jr.map(o=>e.jsx("option",{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Vendor/Source"}),e.jsx("input",{type:"text",value:l.vendor,onChange:o=>a({...l,vendor:o.target.value}),placeholder:"Supplier name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:l.cost_per_unit,onChange:o=>a({...l,cost_per_unit:o.target.value}),placeholder:"0.00",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Ayurvedic Properties"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Zr.map(o=>e.jsxs("label",{className:`cursor-pointer px-3 py-2 rounded-lg border-2 transition-all ${l.ayurvedic_properties.includes(o)?"border-sage bg-sage/10 text-sage font-semibold":"border-dark-brown/10 hover:border-sage/50 text-dark-brown"}`,children:[e.jsx("input",{type:"checkbox",checked:l.ayurvedic_properties.includes(o),onChange:()=>j(o),className:"sr-only"}),e.jsx("span",{className:"text-sm",children:o})]},o))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:l.notes,onChange:o=>a({...l,notes:o.target.value}),placeholder:"Additional notes about this ingredient...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:y,className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:f?"Update Ingredient":"Add Ingredient"})]})]})]})})]})}const ks={stability:["pH Test","Viscosity Test","Color Consistency","Fragrance Stability","Separation Test"],safety:["Patch Test Results","Microbial Testing","Heavy Metals Testing","Allergen Testing"],performance:["Efficacy Test","Shelf Life Study","Consumer Testing"]};function en({productId:s}){const{user:n}=H(),[c,g]=d.useState([]),[r,h]=d.useState([]),[u,m]=d.useState(!1),[p,f]=d.useState(!1),[t,l]=d.useState({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),[a,w]=d.useState({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5});d.useEffect(()=>{b()},[s]);const b=async()=>{try{const[j,x]=await Promise.all([C.from("product_tests").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("sample_batches").select("*").eq("product_id",s).order("created_at",{ascending:!1})]);if(j.error)throw j.error;if(x.error)throw x.error;g(j.data||[]),h(x.data||[])}catch(j){console.error("Error fetching data:",j)}},k=async j=>{j.preventDefault();try{const{error:x}=await C.from("product_tests").insert([{product_id:s,...t,tested_by:n?.id}]);if(x)throw x;l({test_type:"",test_category:"stability",target_value:"",actual_value:"",result:"pending",test_date:new Date().toISOString().split("T")[0],notes:""}),m(!1),b()}catch(x){console.error("Error adding test:",x)}},_=async j=>{j.preventDefault();try{const{error:x}=await C.from("sample_batches").insert([{product_id:s,...a,quantity:parseFloat(a.quantity)||0,rating:parseInt(a.rating.toString())||5,created_by:n?.id}]);if(x)throw x;w({batch_number:"",quantity:"",unit:"units",purpose:"testing",batch_date:new Date().toISOString().split("T")[0],given_to:"",feedback:"",rating:5}),f(!1),b()}catch(x){console.error("Error adding batch:",x)}},y=j=>{const x={pass:{icon:e.jsx(G,{className:"w-4 h-4"}),color:"bg-sage text-white"},fail:{icon:e.jsx(Ce,{className:"w-4 h-4"}),color:"bg-soft-red text-white"},pending:{icon:e.jsx(le,{className:"w-4 h-4"}),color:"bg-accent text-white"}};return x[j]||x.pending};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Testing & Quality Control"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Test"]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Sample Batch"]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(ks).map(([j,x])=>{const o=c.filter(i=>i.test_category===j);return e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-xl font-bold text-primary mb-4 capitalize",children:[j," Testing"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(i=>{const v=o.find(P=>P.test_type===i),N=v?y(v.result):null;return e.jsxs("div",{className:`p-4 rounded-xl border-2 ${v?v.result==="pass"?"border-sage/30 bg-sage/5":v.result==="fail"?"border-soft-red/30 bg-soft-red/5":"border-accent/30 bg-accent/5":"border-dark-brown/10 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!v,readOnly:!0,className:"w-5 h-5 rounded border-2 border-dark-brown/20"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:i})]}),N&&e.jsxs("span",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${N.color}`,children:[N.icon,v.result.toUpperCase()]})]}),v&&e.jsxs("div",{className:"ml-7 space-y-1 text-sm",children:[v.target_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Target:"})," ",v.target_value]}),v.actual_value&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Actual:"})," ",v.actual_value]}),e.jsxs("p",{className:"text-dark-brown/60",children:["Tested on ",$(new Date(v.test_date),"MMM dd, yyyy")]}),v.notes&&e.jsx("p",{className:"text-dark-brown/70 italic",children:v.notes})]})]},i)})})]},j)})}),e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsx("h4",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Sample Batches"}),r.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(j=>e.jsxs("div",{className:"p-4 bg-white rounded-xl border-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-dark-brown text-lg",children:j.batch_number}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[j.quantity," ",j.unit," â€¢ ",j.purpose]})]}),j.rating&&e.jsx("div",{className:"flex gap-0.5",children:[...Array(5)].map((x,o)=>e.jsx("span",{className:o<j.rating?"text-accent":"text-dark-brown/20",children:"â˜…"},o))})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Date:"})," ",$(new Date(j.batch_date),"MMM dd, yyyy")]}),j.given_to&&e.jsxs("p",{className:"text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:"Given to:"})," ",j.given_to]}),j.feedback&&e.jsxs("p",{className:"text-dark-brown/70 italic",children:['"',j.feedback,'"']})]})]},j.id))}):e.jsx("p",{className:"text-center py-8 text-dark-brown/50",children:"No sample batches recorded yet"})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Test Result"})}),e.jsxs("form",{onSubmit:k,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Category"}),e.jsxs("select",{required:!0,value:t.test_category,onChange:j=>l({...t,test_category:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"stability",children:"Stability Testing"}),e.jsx("option",{value:"safety",children:"Safety Testing"}),e.jsx("option",{value:"performance",children:"Performance Testing"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Test Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{required:!0,value:t.test_type,onChange:j=>l({...t,test_type:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select test type"}),ks[t.test_category]?.map(j=>e.jsx("option",{value:j,children:j},j))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Target Value"}),e.jsx("input",{type:"text",value:t.target_value,onChange:j=>l({...t,target_value:j.target.value}),placeholder:"e.g., pH 5.5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Actual Value"}),e.jsx("input",{type:"text",value:t.actual_value,onChange:j=>l({...t,actual_value:j.target.value}),placeholder:"e.g., pH 5.6",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Result"}),e.jsxs("select",{value:t.result,onChange:j=>l({...t,result:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"pass",children:"Pass"}),e.jsx("option",{value:"fail",children:"Fail"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Test Date"}),e.jsx("input",{type:"date",value:t.test_date,onChange:j=>l({...t,test_date:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:t.notes,onChange:j=>l({...t,notes:j.target.value}),rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Test"})]})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-sage to-primary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add Sample Batch"})}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:a.batch_number,onChange:j=>w({...a,batch_number:j.target.value}),placeholder:"e.g., BATCH-001",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Date"}),e.jsx("input",{type:"date",value:a.batch_date,onChange:j=>w({...a,batch_date:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:a.quantity,onChange:j=>w({...a,quantity:j.target.value}),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Unit"}),e.jsx("input",{type:"text",value:a.unit,onChange:j=>w({...a,unit:j.target.value}),placeholder:"units/ml/g",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Purpose"}),e.jsxs("select",{value:a.purpose,onChange:j=>w({...a,purpose:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"testing",children:"Testing"}),e.jsx("option",{value:"sampling",children:"Sampling"}),e.jsx("option",{value:"gifting",children:"Gifting"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Given To"}),e.jsx("input",{type:"text",value:a.given_to,onChange:j=>w({...a,given_to:j.target.value}),placeholder:"Names of recipients",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Feedback"}),e.jsx("textarea",{value:a.feedback,onChange:j=>w({...a,feedback:j.target.value}),placeholder:"User feedback...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(j=>e.jsx("button",{type:"button",onClick:()=>w({...a,rating:j}),className:`text-3xl ${j<=a.rating?"text-accent":"text-dark-brown/20"}`,children:"â˜…"},j))})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Batch"})]})]})]})})]})}function tn({productId:s}){const{user:n}=H(),[c,g]=d.useState([]),[r,h]=d.useState(!1),[u,m]=d.useState({version_name:"",image_url:"",specifications:{}});d.useEffect(()=>{p()},[s]);const p=async()=>{try{const{data:a,error:w}=await C.from("packaging_designs").select("*").eq("product_id",s).order("created_at",{ascending:!1});if(w)throw w;g(a||[])}catch(a){console.error("Error fetching designs:",a)}},f=async a=>{a.preventDefault();try{const{error:w}=await C.from("packaging_designs").insert([{product_id:s,...u,uploaded_by:n?.id}]);if(w)throw w;m({version_name:"",image_url:"",specifications:{}}),h(!1),p()}catch(w){console.error("Error adding design:",w)}},t=async a=>{const w=c.find(y=>y.id===a);if(!w)return;const b=w.votes||[],_=b.includes(n?.id)?b.filter(y=>y!==n?.id):[...b,n?.id];try{const{error:y}=await C.from("packaging_designs").update({votes:_}).eq("id",a);if(y)throw y;p()}catch(y){console.error("Error voting:",y)}},l=a=>{const w={under_review:{color:"bg-accent",text:"Under Review"},approved:{color:"bg-sage",text:"Approved"},rejected:{color:"bg-soft-red",text:"Rejected"}};return w[a]||w.under_review};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Packaging Designs"}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Upload Design"]})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(a=>{const w=l(a.status),b=a.votes||[];return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all",children:[a.image_url?e.jsx("div",{className:"aspect-square bg-cream/30",children:e.jsx("img",{src:a.image_url,alt:a.version_name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square bg-gradient-to-br from-cream/50 to-accent/10 flex items-center justify-center",children:e.jsx("span",{className:"text-6xl",children:"ðŸ“¦"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-bold text-dark-brown",children:a.version_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold text-white ${w.color}`,children:w.text})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>t(a.id),className:`flex items-center gap-1 px-3 py-2 rounded-lg font-semibold transition-all ${b.includes(n?.id)?"bg-accent text-white":"bg-accent/10 text-accent hover:bg-accent/20"}`,children:[e.jsx(Ja,{className:"w-4 h-4"}),b.length]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:[e.jsx(qe,{className:"w-4 h-4"}),"View"]}),e.jsx("button",{className:"flex items-center gap-1 px-3 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-lg font-semibold transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})})]})]})]},a.id)})}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“¦"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No packaging designs uploaded yet"}),e.jsx("button",{onClick:()=>h(!0),className:"px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload First Design"})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-secondary to-accent p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload Design"})}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Design Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:u.version_name,onChange:a=>m({...u,version_name:a.target.value}),placeholder:"e.g., Design A",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Image URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:u.image_url,onChange:a=>m({...u,image_url:a.target.value}),placeholder:"https://example.com/design.jpg",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload Design"})]})]})]})})]})}const Bt=["Research","Formula","Packaging","Production","Marketing","Other"],sn=["high","medium","low"],an=["todo","in_progress","completed","blocked"];function rn({productId:s}){const{user:n}=H(),[c,g]=d.useState([]),[r,h]=d.useState([]),[u,m]=d.useState(!1),[p,f]=d.useState({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"});d.useEffect(()=>{t()},[s]);const t=async()=>{try{const[j,x]=await Promise.all([C.from("product_tasks").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*").order("name")]);if(j.error)throw j.error;if(x.error)throw x.error;g(j.data||[]),h(x.data||[])}catch(j){console.error("Error fetching data:",j)}},l=async j=>{j.preventDefault();try{const{error:x}=await C.from("product_tasks").insert([{product_id:s,...p,created_by:n?.id}]);if(x)throw x;f({title:"",description:"",category:"Research",assigned_to:"",due_date:"",priority:"medium",status:"todo"}),m(!1),t()}catch(x){console.error("Error adding task:",x)}},a=async(j,x)=>{try{const o={status:x};x==="completed"&&(o.completed_at=new Date().toISOString());const{error:i}=await C.from("product_tasks").update(o).eq("id",j);if(i)throw i;t()}catch(o){console.error("Error updating task:",o)}},w=j=>{const x={todo:{color:"bg-dark-brown/20 text-dark-brown",text:"To Do"},in_progress:{color:"bg-accent text-white",text:"In Progress"},completed:{color:"bg-sage text-white",text:"Completed"},blocked:{color:"bg-soft-red text-white",text:"Blocked"}};return x[j]||x.todo},b=j=>{const x={high:"border-l-soft-red",medium:"border-l-accent",low:"border-l-sage"};return x[j]||x.medium},k=j=>r.find(o=>o.id===j)?.name||"Unassigned",_=Bt.reduce((j,x)=>(j[x]=c.filter(o=>o.category===x),j),{}),y={total:c.length,completed:c.filter(j=>j.status==="completed").length,inProgress:c.filter(j=>j.status==="in_progress").length,overdue:c.filter(j=>j.due_date&&new Date(j.due_date)<new Date&&j.status!=="completed").length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Tasks & Checklist"}),e.jsxs("p",{className:"text-dark-brown/60 text-sm mt-1",children:[y.completed,"/",y.total," tasks completed"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Task"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-4 border-2 border-primary/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Total Tasks"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:y.total})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-4 border-2 border-accent/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:y.inProgress})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sage/10 to-sage/5 rounded-xl p-4 border-2 border-sage/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:y.completed})]}),e.jsxs("div",{className:"bg-gradient-to-br from-soft-red/10 to-soft-red/5 rounded-xl p-4 border-2 border-soft-red/20",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70 mb-1",children:"Overdue"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:y.overdue})]})]}),e.jsx("div",{className:"space-y-6",children:Bt.map(j=>{const x=_[j]||[];return x.length===0?null:e.jsxs("div",{className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary mb-4 flex items-center gap-2",children:[j," Tasks",e.jsx("span",{className:"px-2 py-1 bg-primary/10 rounded-full text-sm",children:x.length})]}),e.jsx("div",{className:"space-y-3",children:x.map(o=>{const i=w(o.status),v=b(o.priority),N=o.due_date&&new Date(o.due_date)<new Date&&o.status!=="completed";return e.jsx("div",{className:`bg-white p-4 rounded-xl border-l-4 ${v} shadow-sm hover:shadow-soft transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("input",{type:"checkbox",checked:o.status==="completed",onChange:()=>a(o.id,o.status==="completed"?"todo":"completed"),className:"w-5 h-5 mt-0.5 rounded border-2 border-dark-brown/20 cursor-pointer"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:`font-semibold text-dark-brown mb-1 ${o.status==="completed"?"line-through opacity-60":""}`,children:o.title}),o.description&&e.jsx("p",{className:"text-sm text-dark-brown/70 mb-2",children:o.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-dark-brown/60",children:[o.assigned_to&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-3 h-3"}),k(o.assigned_to)]}),o.due_date&&e.jsxs("span",{className:`flex items-center gap-1 ${N?"text-soft-red font-semibold":""}`,children:[e.jsx(_e,{className:"w-3 h-3"}),$(new Date(o.due_date),"MMM dd"),N&&" (Overdue)"]})]})]})]}),e.jsx("select",{value:o.status,onChange:P=>a(o.id,P.target.value),className:`px-3 py-1 rounded-full text-xs font-semibold ${i.color} cursor-pointer`,children:an.map(P=>e.jsx("option",{value:P,children:w(P).text},P))})]})},o.id)})})]},j)})}),c.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"âœ…"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:"No tasks created yet"}),e.jsx("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Create First Task"})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-sage p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Add New Task"})}),e.jsxs("form",{onSubmit:l,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Task Title ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:p.title,onChange:j=>f({...p,title:j.target.value}),placeholder:"e.g., Complete pH testing",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Description"}),e.jsx("textarea",{value:p.description,onChange:j=>f({...p,description:j.target.value}),placeholder:"Task description...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:p.category,onChange:j=>f({...p,category:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Bt.map(j=>e.jsx("option",{value:j,children:j},j))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Priority"}),e.jsx("select",{value:p.priority,onChange:j=>f({...p,priority:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:sn.map(j=>e.jsx("option",{value:j,children:j.charAt(0).toUpperCase()+j.slice(1)},j))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Assign To"}),e.jsxs("select",{value:p.assigned_to,onChange:j=>f({...p,assigned_to:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Unassigned"}),r.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:p.due_date,onChange:j=>f({...p,due_date:j.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-primary to-sage text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Add Task"})]})]})]})})]})}function nn({productId:s}){const{user:n}=H(),[c,g]=d.useState([]),[r,h]=d.useState([]),[u,m]=d.useState("");d.useEffect(()=>{p();const k=f();return()=>{k.unsubscribe()}},[s]);const p=async()=>{try{const[k,_]=await Promise.all([C.from("product_comments").select("*").eq("product_id",s).is("parent_comment_id",null).order("created_at",{ascending:!0}),C.from("users").select("*")]);if(k.error)throw k.error;if(_.error)throw _.error;g(k.data||[]),h(_.data||[])}catch(k){console.error("Error fetching data:",k)}},f=()=>C.channel(`product_comments:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"product_comments",filter:`product_id=eq.${s}`},()=>{p()}).subscribe(),t=async k=>{if(k.preventDefault(),!!u.trim())try{const{error:_}=await C.from("product_comments").insert([{product_id:s,user_id:n?.id,text:u}]);if(_)throw _;m("")}catch(_){console.error("Error adding comment:",_)}},l=async(k,_)=>{const y=c.find(i=>i.id===k);if(!y)return;const j=y.reactions||[],x=j.find(i=>i.userId===n?.id&&i.emoji===_);let o;x?o=j.filter(i=>!(i.userId===n?.id&&i.emoji===_)):o=[...j,{userId:n?.id,emoji:_}];try{const{error:i}=await C.from("product_comments").update({reactions:o}).eq("id",k);if(i)throw i}catch(i){console.error("Error updating reaction:",i)}},a=k=>r.find(_=>_.id===k),w=k=>k.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),b=k=>{const _={};return k.forEach(y=>{_[y.emoji]||(_[y.emoji]=[]),_[y.emoji].push(y.userId)}),_};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Team Discussion"}),e.jsx("form",{onSubmit:t,className:"bg-gradient-to-br from-cream/50 to-white rounded-xl p-6 border-2 border-dark-brown/5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:n?.name?w(n.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:u,onChange:k=>m(k.target.value),placeholder:"Share your thoughts, ask questions, or provide updates...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 resize-none"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Add emoji",children:e.jsx(Qs,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",className:"p-2 text-dark-brown/60 hover:text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Attach file",children:e.jsx(rs,{className:"w-5 h-5"})})]}),e.jsxs("button",{type:"submit",disabled:!u.trim(),className:"flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Hs,{className:"w-5 h-5"}),"Send"]})]})]})]})}),e.jsx("div",{className:"space-y-4",children:c.map(k=>{const _=a(k.user_id),y=b(k.reactions||[]);return e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-dark-brown/5 hover:border-accent/20 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:_?w(_.name):"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:_?.name||"Unknown"}),e.jsx("span",{className:"text-sm text-dark-brown/50",children:$(new Date(k.created_at),"MMM dd, yyyy HH:mm")})]}),e.jsx("p",{className:"text-dark-brown/80 leading-relaxed mb-3",children:k.text}),Object.keys(y).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(y).map(([j,x])=>e.jsxs("button",{onClick:()=>l(k.id,j),className:`flex items-center gap-1 px-3 py-1 rounded-full text-sm transition-all ${x.includes(n?.id||"")?"bg-accent/20 border-2 border-accent":"bg-dark-brown/5 border-2 border-transparent hover:border-accent/30"}`,children:[e.jsx("span",{children:j}),e.jsx("span",{className:"font-semibold text-dark-brown",children:x.length})]},j))}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("button",{className:"hover:text-accent transition-colors",children:[e.jsx(Oa,{className:"w-4 h-4 inline mr-1"}),"Reply"]}),e.jsx("button",{onClick:()=>l(k.id,"ðŸ‘"),className:"hover:text-accent transition-colors",children:"ðŸ‘ Like"}),e.jsx("button",{onClick:()=>l(k.id,"â¤ï¸"),className:"hover:text-accent transition-colors",children:"â¤ï¸ Love"}),e.jsx("button",{onClick:()=>l(k.id,"ðŸŽ‰"),className:"hover:text-accent transition-colors",children:"ðŸŽ‰ Celebrate"})]})]})]})},k.id)})}),c.length===0&&e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ’¬"}),e.jsx("p",{className:"text-dark-brown/60",children:"No comments yet. Start the discussion!"})]})]})}const Ot=[{name:"Formulas",icon:"âš—ï¸"},{name:"Test Reports",icon:"ðŸ§ª"},{name:"Packaging Designs",icon:"ðŸ“¦"},{name:"Certificates",icon:"ðŸ†"},{name:"Marketing Materials",icon:"ðŸ“¢"},{name:"Legal Documents",icon:"ðŸ“‹"},{name:"Research Papers",icon:"ðŸ“š"},{name:"Photos",icon:"ðŸ“¸"}];function ln({productId:s}){const{user:n}=H(),[c,g]=d.useState([]),[r,h]=d.useState([]),[u,m]=d.useState(null),[p,f]=d.useState(!1),[t,l]=d.useState({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"});d.useEffect(()=>{a()},[s]);const a=async()=>{try{const[o,i]=await Promise.all([C.from("product_files").select("*").eq("product_id",s).order("created_at",{ascending:!1}),C.from("users").select("*")]);if(o.error)throw o.error;if(i.error)throw i.error;g(o.data||[]),h(i.data||[])}catch(o){console.error("Error fetching data:",o)}},w=async o=>{o.preventDefault();try{const{error:i}=await C.from("product_files").insert([{product_id:s,...t,file_size:0,uploaded_by:n?.id}]);if(i)throw i;l({file_name:"",file_url:"",file_type:"application/pdf",category:"Formulas"}),f(!1),a()}catch(i){console.error("Error uploading file:",i)}},b=async o=>{if(confirm("Are you sure you want to delete this file?"))try{const{error:i}=await C.from("product_files").delete().eq("id",o);if(i)throw i;a()}catch(i){console.error("Error deleting file:",i)}},k=o=>r.find(v=>v.id===o)?.name||"Unknown",_=o=>o.startsWith("image/")?e.jsx(ss,{className:"w-6 h-6"}):o==="application/pdf"?e.jsx(se,{className:"w-6 h-6"}):e.jsx($s,{className:"w-6 h-6"}),y=u?c.filter(o=>o.category===u):c,j=Ot.reduce((o,i)=>(o[i.name]=c.filter(v=>v.category===i.name).length,o),{}),x=o=>{if(o===0)return"0 KB";const i=1024,v=["Bytes","KB","MB","GB"],N=Math.floor(Math.log(o)/Math.log(i));return Math.round(o/Math.pow(i,N)*100)/100+" "+v[N]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary",children:"Files & Documents"}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent to-secondary text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Upload File"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Ot.map(o=>e.jsxs("button",{onClick:()=>m(u===o.name?null:o.name),className:`p-4 rounded-xl border-2 transition-all ${u===o.name?"border-accent bg-accent/10":"border-dark-brown/10 hover:border-accent/50 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:o.icon}),e.jsx("span",{className:"font-semibold text-dark-brown text-sm",children:o.name})]}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:j[o.name]||0})]},o.name))}),u&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Rs,{className:"w-4 h-4 text-accent"}),e.jsxs("span",{className:"text-dark-brown",children:["Showing files in: ",e.jsx("strong",{children:u})]}),e.jsx("button",{onClick:()=>m(null),className:"text-accent hover:underline",children:"Clear filter"})]}),y.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map(o=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border-2 border-dark-brown/5 hover:border-accent/30 transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center text-accent flex-shrink-0",children:_(o.file_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",title:o.file_name,children:o.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:o.category})]})]}),e.jsxs("div",{className:"text-xs text-dark-brown/60 space-y-1 mb-3",children:[e.jsxs("p",{children:["Uploaded by ",k(o.uploaded_by)]}),e.jsx("p",{children:$(new Date(o.created_at),"MMM dd, yyyy")}),o.file_size>0&&e.jsx("p",{children:x(o.file_size)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:o.file_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{onClick:()=>b(o.id),className:"px-3 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]},o.id))}):e.jsxs("div",{className:"text-center py-16 bg-cream/30 rounded-xl",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ“"}),e.jsx("p",{className:"text-dark-brown/60 mb-4",children:u?`No files in ${u} yet`:"No files uploaded yet"}),e.jsx("button",{onClick:()=>f(!0),className:"px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft transition-all",children:"Upload Your First File"})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-accent to-secondary p-6 rounded-t-2xl",children:e.jsx("h3",{className:"font-heading text-2xl font-bold text-white",children:"Upload File"})}),e.jsxs("form",{onSubmit:w,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{required:!0,value:t.category,onChange:o=>l({...t,category:o.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Ot.map(o=>e.jsxs("option",{value:o.name,children:[o.icon," ",o.name]},o.name))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:t.file_name,onChange:o=>l({...t,file_name:o.target.value}),placeholder:"e.g., Formula v1.0.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["File URL ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:t.file_url,onChange:o=>l({...t,file_url:o.target.value}),placeholder:"https://example.com/file.pdf",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2",children:"Enter the direct URL to your file"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"File Type"}),e.jsxs("select",{value:t.file_type,onChange:o=>l({...t,file_type:o.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"application/pdf",children:"PDF Document"}),e.jsx("option",{value:"image/jpeg",children:"JPEG Image"}),e.jsx("option",{value:"image/png",children:"PNG Image"}),e.jsx("option",{value:"application/msword",children:"Word Document"}),e.jsx("option",{value:"application/vnd.ms-excel",children:"Excel Spreadsheet"}),e.jsx("option",{value:"text/plain",children:"Text File"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-accent to-secondary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Upload File"})]})]})]})})]})}const on=[{id:"overview",name:"Overview",icon:se},{id:"ingredients",name:"Ingredients & Formula",icon:Oe},{id:"testing",name:"Testing & Quality",icon:Ys},{id:"packaging",name:"Packaging",icon:ne},{id:"tasks",name:"Tasks & Checklist",icon:es},{id:"discussion",name:"Team Discussion",icon:Ft},{id:"files",name:"Files & Documents",icon:Rs}],Ct=[{id:"idea",name:"Idea",color:"bg-sage"},{id:"research",name:"Research",color:"bg-sage"},{id:"formula",name:"Formula Creation",color:"bg-accent"},{id:"testing",name:"Testing",color:"bg-accent"},{id:"packaging",name:"Packaging Design",color:"bg-secondary"},{id:"printing",name:"Printing",color:"bg-secondary"},{id:"production",name:"Production",color:"bg-secondary"},{id:"ready",name:"Ready to Launch",color:"bg-primary"},{id:"launched",name:"Launched",color:"bg-primary"}];function dn(){const{id:s}=Ye(),n=ie(),{user:c}=H(),[g,r]=d.useState("overview"),[h,u]=d.useState(null),[m,p]=d.useState([]),[f,t]=d.useState(!0),[l,a]=d.useState(!1);d.useEffect(()=>{s&&w()},[s]);const w=async()=>{try{const[o,i]=await Promise.all([C.from("products").select("*").eq("id",s).single(),C.from("users").select("id, name, email").order("name")]);if(o.error)throw o.error;if(i.error)throw i.error;u(o.data),p(i.data||[])}catch(o){console.error("Error fetching data:",o)}finally{t(!1)}},b=w,k=async()=>{if(!h)return;const o=Ct.findIndex(v=>v.id===h.current_stage);if(o===-1||o===Ct.length-1)return;const i=Ct[o+1];if(!(i.id==="launched"&&!window.confirm(`Are you sure you want to launch "${h.name}"? This marks it as complete.`)))try{await C.from("product_stage_history").update({exited_at:new Date().toISOString()}).eq("product_id",h.id).is("exited_at",null),await C.from("products").update({current_stage:i.id,stage_entered_at:new Date().toISOString(),progress:i.id==="launched"?100:h.progress}).eq("id",h.id),await C.from("product_stage_history").insert([{product_id:h.id,stage:i.id,moved_by:c?.id}]),await b()}catch(v){console.error("Error moving product:",v)}},_=async(o,i)=>{try{const{error:v}=await C.from("products").update({...i,updated_at:new Date().toISOString()}).eq("id",o);if(v)throw v;await C.from("activity_log").insert({user_id:c?.id,activity_type:"product_updated",description:`${c?.name} updated product: ${i.name}`}),await b()}catch(v){throw console.error("Error updating product:",v),v}},y=o=>{const i={high:{color:"bg-soft-red",text:"HIGH"},medium:{color:"bg-accent",text:"MEDIUM"},low:{color:"bg-sage",text:"LOW"}};return i[o]||i.medium};if(f)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Loading product..."})})});if(!h)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{className:"text-center text-dark-brown/50",children:"Product not found"})})});const j=Ct.find(o=>o.id===h.current_stage),x=y(h.priority);return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/products"),className:"flex items-center gap-2 text-dark-brown/70 hover:text-primary mb-6 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),"Back to Pipeline"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-3",children:h.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-semibold",children:h.category}),e.jsx("span",{className:`px-3 py-1 ${x.color} text-white rounded-full text-sm font-semibold`,children:x.text}),j&&e.jsx("span",{className:`px-4 py-1 ${j.color} text-white rounded-full text-sm font-semibold`,children:j.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown/70",children:"Stage Progress"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:[h.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-brown/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sage to-accent transition-all duration-300",style:{width:`${h.progress}%`}})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(fe,{className:"w-5 h-5"}),"Edit"]}),e.jsxs("button",{onClick:k,disabled:h.current_stage==="launched",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-sage to-primary text-white rounded-xl font-semibold hover:shadow-soft transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Zt,{className:"w-5 h-5"}),"Move to Next Stage"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-dark-brown/5 hover:bg-dark-brown/10 text-dark-brown rounded-xl font-semibold transition-colors",children:[e.jsx(Wa,{className:"w-5 h-5"}),"Share"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-xl font-semibold transition-colors",children:[e.jsx(Sa,{className:"w-5 h-5"}),"Archive"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex min-w-max",children:on.map(o=>{const i=o.icon;return e.jsxs("button",{onClick:()=>r(o.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all duration-300 border-b-4 ${g===o.id?"border-accent text-accent bg-accent/5":"border-transparent text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(i,{className:"w-5 h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:o.name})]},o.id)})})})}),e.jsxs("div",{className:"p-6",children:[g==="overview"&&e.jsx(Yr,{product:h,onRefresh:b}),g==="ingredients"&&e.jsx(Xr,{productId:h.id}),g==="testing"&&e.jsx(en,{productId:h.id}),g==="packaging"&&e.jsx(tn,{productId:h.id}),g==="tasks"&&e.jsx(rn,{productId:h.id}),g==="discussion"&&e.jsx(nn,{productId:h.id}),g==="files"&&e.jsx(ln,{productId:h.id})]})]})]}),h&&e.jsx(Xs,{isOpen:l,onClose:()=>a(!1),onSubmit:_,product:h,users:m})]})}function cn(){const{user:s}=H(),[n,c]=d.useState([]),[g,r]=d.useState(""),[h,u]=d.useState(""),[m,p]=d.useState(100),[f,t]=d.useState([]),[l,a]=d.useState([{id:"1",name:"Primary Container (Bottle/Jar)",quantity:1,costPerPiece:0,total:0},{id:"2",name:"Label/Sticker",quantity:1,costPerPiece:0,total:0},{id:"3",name:"Secondary Packaging (Box)",quantity:1,costPerPiece:0,total:0}]),[w,b]=d.useState([]),[k,_]=d.useState(0),[y,j]=d.useState(0),[x,o]=d.useState(0),[i,v]=d.useState(0),[N,P]=d.useState(0),[L,I]=d.useState(0),[A,U]=d.useState(0),[B,W]=d.useState(0),[ee,re]=d.useState(10),[S,T]=d.useState(1),[E,q]=d.useState(0),[O,Y]=d.useState(10),[me,Se]=d.useState(0),[De,ft]=d.useState(12),[ve,Ve]=d.useState([]),[Je,jt]=d.useState(0),[Ze,Me]=d.useState(0),[Pe,yt]=d.useState(0),[Ee,Tt]=d.useState(0),[Lt,$t]=d.useState([]),[qt,Xe]=d.useState(!1),[He,D]=d.useState("");d.useEffect(()=>{z(),V()},[]),d.useEffect(()=>{g&&wt()},[g]);const z=async()=>{try{const{data:M,error:R}=await C.from("products").select("*").order("name");if(R)throw R;c(M||[])}catch(M){console.error("Error fetching products:",M)}},V=async()=>{try{const{data:M,error:R}=await C.from("product_cost_calculations").select("*").eq("is_draft",!1).order("created_at",{ascending:!1});if(R)throw R;$t(M||[])}catch(M){console.error("Error fetching calculations:",M)}},wt=async()=>{const M=n.find(R=>R.id===g);if(M){u(M.name);try{const{data:R}=await C.from("product_ingredients").select("*").eq("product_id",g);if(R&&R.length>0){const J=R.map(ae=>({id:ae.id,name:ae.ingredient_name,quantity:ae.quantity||0,unit:ae.unit||"g",costPerUnit:ae.cost_per_unit||0,total:(ae.quantity||0)*(ae.cost_per_unit||0)}));t(J)}}catch(R){console.error("Error loading product data:",R)}}},Rt=()=>{t([...f,{id:Date.now().toString(),name:"",quantity:0,unit:"g",costPerUnit:0,total:0}])},We=(M,R,J)=>{t(f.map(ae=>{if(ae.id===M){const he={...ae,[R]:J};return he.total=he.quantity*he.costPerUnit,he}return ae}))},ea=M=>{t(f.filter(R=>R.id!==M))},ls=(M,R,J)=>{a(l.map(ae=>{if(ae.id===M){const he={...ae,[R]:J};return he.total=he.quantity*he.costPerPiece,he}return ae}))},ta=()=>{b([...w,{id:Date.now().toString(),description:"",amount:0}])},sa=()=>{Ve([...ve,{id:Date.now().toString(),description:"",amount:0}])},et=f.reduce((M,R)=>M+R.total,0),tt=[...l.map(M=>M.total),...w.map(M=>M.amount)].reduce((M,R)=>M+R,0),Ut=k*y,os=x+i+N+L,st=Ut+os+A,zt=S>0?B*ee/100/S:0,is=S>0?E*O/100/S:0,ds=De>0?me/De:0,aa=ve.reduce((M,R)=>M+R.amount,0),at=zt+is+ds+aa,cs=Ze+Pe,rt=(Je+cs)*m,Nt=et+tt+st+at+rt,nt=m>0?Nt/m:0,vt=[{name:"Raw Materials",value:et,color:"#8B4513"},{name:"Packaging",value:tt,color:"#D2691E"},{name:"Manufacturing",value:st,color:"#CD853F"},{name:"Overheads",value:at,color:"#DEB887"},{name:"Marketing",value:rt,color:"#F4A460"}].filter(M=>M.value>0),xs=M=>{const R=nt/(1-M/100),J=R*.18,ae=R+J,he=R-nt;return{sellingPrice:R,gst:J,mrp:ae,profit:he,marginPercent:M}},ms=[30,40,50,60].map(M=>xs(M)),ra=async()=>{if(!He.trim()){alert("Please enter a calculation name");return}try{const M={product_id:g||null,calculation_name:He,batch_size:m,raw_material_costs:{ingredients:f,subtotal:et},packaging_costs:{components:l,other:w,subtotal:tt},manufacturing_costs:{labour:Ut,utilities:os,qc:A,subtotal:st},overhead_costs:{rent:zt,salaries:is,compliance:ds,other:ve,subtotal:at},marketing_costs:{marketing:Je*m,fulfillment:cs*m,subtotal:rt},total_cost:Nt,cost_per_unit:nt,margin_scenarios:ms,saved_by:s?.id,is_draft:!1},{error:R}=await C.from("product_cost_calculations").insert([M]);if(R)throw R;Xe(!1),D(""),V(),alert("Calculation saved successfully!")}catch(M){console.error("Error saving calculation:",M),alert("Error saving calculation")}};return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Product Cost Calculator"}),e.jsx("p",{className:"text-dark-brown/70",children:"Calculate unit economics and pricing strategy"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>Xe(!0),className:"flex items-center gap-2 px-6 py-3 bg-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all hover:bg-accent/90",children:[e.jsx(Vs,{className:"w-5 h-5"}),"Save Calculation"]}),e.jsxs("button",{className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft transition-all",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Export PDF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Select Product (Optional)"}),e.jsxs("select",{value:g,onChange:M=>r(M.target.value),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Calculate for new product"}),n.map(M=>e.jsx("option",{value:M.id,children:M.name},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Load Saved Calculation"}),e.jsxs("select",{className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select saved calculation..."}),Lt.map(M=>e.jsxs("option",{value:M.id,children:[M.calculation_name," - ",new Date(M.created_at).toLocaleDateString()]},M.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Batch Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Product Name"}),e.jsx("input",{type:"text",value:h,onChange:M=>u(M.target.value),placeholder:"Enter product name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batch Size (Units)"}),e.jsx("input",{type:"number",value:m,onChange:M=>p(parseInt(M.target.value)||0),placeholder:"100",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Raw Materials"}),e.jsxs("button",{onClick:Rt,className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Ingredient"]})]}),e.jsx("div",{className:"space-y-3",children:f.map(M=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:M.name,onChange:R=>We(M.id,"name",R.target.value),placeholder:"Ingredient name",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:M.quantity,onChange:R=>We(M.id,"quantity",parseFloat(R.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:M.unit,onChange:R=>We(M.id,"unit",R.target.value),className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"ml",children:"ml"}),e.jsx("option",{value:"L",children:"L"})]}),e.jsx("input",{type:"number",value:M.costPerUnit,onChange:R=>We(M.id,"costPerUnit",parseFloat(R.target.value)||0),placeholder:"â‚¹/unit",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-2 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",M.total.toFixed(2)]}),e.jsx("button",{onClick:()=>ea(M.id),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]},M.id))}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Raw Material Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",et.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(et/m).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Packaging Costs"}),e.jsx("div",{className:"space-y-3 mb-4",children:l.map(M=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("span",{className:"col-span-4 text-sm font-semibold text-dark-brown",children:M.name}),e.jsx("input",{type:"number",value:M.quantity,onChange:R=>ls(M.id,"quantity",parseFloat(R.target.value)||0),placeholder:"Qty",className:"col-span-2 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:M.costPerPiece,onChange:R=>ls(M.id,"costPerPiece",parseFloat(R.target.value)||0),placeholder:"â‚¹/piece",className:"col-span-3 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("div",{className:"col-span-3 px-3 py-2 bg-sage/10 rounded-lg text-sm font-bold text-sage",children:["â‚¹",(M.total*m).toFixed(2)]})]},M.id))}),e.jsx("button",{onClick:ta,className:"text-sm text-accent hover:underline mb-3",children:"+ Add other packaging material"}),w.map(M=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center mb-2",children:[e.jsx("input",{type:"text",value:M.description,onChange:R=>b(w.map(J=>J.id===M.id?{...J,description:R.target.value}:J)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:M.amount,onChange:R=>b(w.map(J=>J.id===M.id?{...J,amount:parseFloat(R.target.value)||0}:J)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>b(w.filter(R=>R.id!==M.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]},M.id)),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Packaging Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",tt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(tt/m).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Manufacturing Costs"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Labour Hours"}),e.jsx("input",{type:"number",value:k,onChange:M=>_(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Hour (â‚¹)"}),e.jsx("input",{type:"number",value:y,onChange:M=>j(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Labour: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",Ut.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Electricity (â‚¹)"}),e.jsx("input",{type:"number",value:x,onChange:M=>o(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Water (â‚¹)"}),e.jsx("input",{type:"number",value:i,onChange:M=>v(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Equipment Depreciation (â‚¹)"}),e.jsx("input",{type:"number",value:N,onChange:M=>P(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Other Utilities (â‚¹)"}),e.jsx("input",{type:"number",value:L,onChange:M=>I(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC/Testing Cost (â‚¹)"}),e.jsx("input",{type:"number",value:A,onChange:M=>U(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Manufacturing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",st.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(st/m).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Overhead Allocation"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Rent (â‚¹)"}),e.jsx("input",{type:"number",value:B,onChange:M=>W(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation to this product: ",ee,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:ee,onChange:M=>re(parseInt(M.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Batches per Month"}),e.jsx("input",{type:"number",value:S,onChange:M=>T(parseInt(M.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"p-3 bg-sage/10 rounded-lg",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Rent per batch: "}),e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",zt.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Monthly Salaries (â‚¹)"}),e.jsx("input",{type:"number",value:E,onChange:M=>q(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Allocation: ",O,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:O,onChange:M=>Y(parseInt(M.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Compliance (â‚¹)"}),e.jsx("input",{type:"number",value:me,onChange:M=>Se(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Annual Batches"}),e.jsx("input",{type:"number",value:De,onChange:M=>ft(parseInt(M.target.value)||1),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsx("button",{onClick:sa,className:"text-sm text-accent hover:underline",children:"+ Add other overhead"}),ve.map(M=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("input",{type:"text",value:M.description,onChange:R=>Ve(ve.map(J=>J.id===M.id?{...J,description:R.target.value}:J)),placeholder:"Description",className:"col-span-6 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("input",{type:"number",value:M.amount,onChange:R=>Ve(ve.map(J=>J.id===M.id?{...J,amount:parseFloat(R.target.value)||0}:J)),placeholder:"â‚¹",className:"col-span-5 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsx("button",{onClick:()=>Ve(ve.filter(R=>R.id!==M.id)),className:"col-span-1 p-2 text-soft-red hover:bg-soft-red/10 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]},M.id))]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Overhead Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",at.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(at/m).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Marketing & Distribution"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Marketing per Unit (â‚¹)"}),e.jsx("input",{type:"number",value:Je,onChange:M=>jt(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Ads, samples, packaging inserts, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Shipping Material (â‚¹)"}),e.jsx("input",{type:"number",value:Ze,onChange:M=>Me(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Courier Charges (â‚¹)"}),e.jsx("input",{type:"number",value:Pe,onChange:M=>yt(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Platform Fees (%)"}),e.jsx("input",{type:"number",value:Ee,onChange:M=>Tt(parseFloat(M.target.value)||0),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-dark-brown",children:"Marketing Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["â‚¹",rt.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Per unit cost:"}),e.jsxs("span",{className:"text-sm font-bold text-accent",children:["â‚¹",(rt/m).toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-2xl shadow-soft-lg p-6 text-white sticky top-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Fs,{className:"w-8 h-8"}),e.jsx("h3",{className:"font-heading text-2xl font-bold",children:"Cost Summary"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Total Batch Cost"}),e.jsxs("p",{className:"text-4xl font-bold",children:["â‚¹",Nt.toFixed(2)]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-white/20 rounded-xl backdrop-blur-sm",children:[e.jsx("p",{className:"text-white/80 mb-2",children:"Cost Per Unit"}),e.jsxs("p",{className:"text-5xl font-bold",children:["â‚¹",nt.toFixed(2)]})]}),vt.length>0&&e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 backdrop-blur-sm",children:[e.jsx("p",{className:"text-sm font-semibold mb-3",children:"Cost Breakdown"}),e.jsx(pe,{width:"100%",height:200,children:e.jsxs(Mt,{children:[e.jsx(Pt,{data:vt,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:vt.map((M,R)=>e.jsx(Et,{fill:M.color},`cell-${R}`))}),e.jsx(ge,{formatter:M=>`â‚¹${M.toFixed(2)}`,contentStyle:{background:"#fff",border:"none",borderRadius:"8px"}})]})}),e.jsx("div",{className:"space-y-2 mt-3",children:vt.map((M,R)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:M.color}}),e.jsx("span",{children:M.name})]}),e.jsxs("span",{className:"font-semibold",children:[(M.value/Nt*100).toFixed(1),"%"]})]},R))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Pricing Strategy"}),e.jsx("div",{className:"space-y-4",children:ms.map((M,R)=>e.jsxs("div",{className:"p-4 bg-gradient-to-br from-cream/50 to-white rounded-xl border-2 border-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-bold text-lg text-primary",children:[M.marginPercent,"% Margin"]}),e.jsxs("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-sm font-semibold",children:["Profit: â‚¹",M.profit.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Selling Price (ex-GST):"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",M.sellingPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"GST @ 18%:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",M.gst.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"font-bold text-dark-brown",children:"MRP (incl. GST):"}),e.jsxs("span",{className:"font-bold text-xl text-sage",children:["â‚¹",M.mrp.toFixed(2)]})]})]})]},R))})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary mb-4",children:"Profitability Scenarios"}),e.jsx("div",{className:"space-y-3",children:[100,500,1e3,5e3].map(M=>{const R=M*xs(40).mrp,J=M*nt,ae=R-J,he=J>0?ae/R*100:0;return e.jsxs("div",{className:"p-3 bg-cream/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-dark-brown",children:[M," units"]}),e.jsxs("span",{className:`text-sm font-bold ${ae>0?"text-sage":"text-soft-red"}`,children:[ae>0?"+":"","â‚¹",ae.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60",children:[e.jsxs("span",{children:["Revenue: â‚¹",R.toFixed(0)]}),e.jsxs("span",{children:["Margin: ",he.toFixed(1),"%"]})]})]},M)})})]})]})]})]}),qt&&e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-4",children:"Save Calculation"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Calculation Name"}),e.jsx("input",{type:"text",value:He,onChange:M=>D(M.target.value),placeholder:"e.g., Neem Face Wash v1.0 - 100 unit batch",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Xe(!1),className:"flex-1 px-6 py-3 bg-dark-brown/5 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/10 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:ra,className:"flex-1 px-6 py-3 bg-accent text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all hover:bg-accent/90",children:"Save"})]})]})})]})}const xn=["Raw Materials","Packaging","Printing","Logistics","Lab Testing","Equipment","Other"],mn=["Immediate","7 days","15 days","30 days","45 days","60 days","Custom"];function hn({onClose:s,onSuccess:n}){const{user:c}=H(),[g,r]=d.useState(!1),[h,u]=d.useState({name:"",category:"Raw Materials",products:"",contactPerson:"",phone:"",email:"",alternatePhone:"",address:"",gstNumber:"",website:"",paymentTerms:"30 days",bankName:"",accountNumber:"",ifscCode:"",initialRating:3,notes:""}),[m,p]=d.useState({iso:!1,organic:!1,fssai:!1,gmp:!1,other:""}),f=async t=>{if(t.preventDefault(),!h.name||!h.phone){alert("Please fill in required fields (Name and Phone)");return}r(!0);try{const l=h.bankName?{bankName:h.bankName,accountNumber:h.accountNumber,ifscCode:h.ifscCode}:{},a=[];m.iso&&a.push("ISO Certified"),m.organic&&a.push("Organic Certified"),m.fssai&&a.push("FSSAI Approved"),m.gmp&&a.push("GMP Certified"),m.other&&a.push(m.other);const{error:w}=await C.from("vendors").insert([{name:h.name,category:h.category,products:h.products,contact_person:h.contactPerson,phone:h.phone,email:h.email,alternate_phone:h.alternatePhone,address:h.address,gst_number:h.gstNumber,website:h.website,payment_terms:h.paymentTerms,bank_details:l,certifications:a,initial_rating:h.initialRating,current_rating:h.initialRating,notes:h.notes,created_by:c?.id}]);if(w)throw w;n()}catch(l){console.error("Error adding vendor:",l),alert("Error adding vendor. Please try again.")}finally{r(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add New Vendor"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(de,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:h.name,onChange:t=>u({...h,name:t.target.value}),placeholder:"e.g., Green Valley Herbs",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:h.category,onChange:t=>u({...h,category:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:xn.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:h.contactPerson,onChange:t=>u({...h,contactPerson:t.target.value}),placeholder:"Contact person name",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Products/Services"}),e.jsx("textarea",{value:h.products,onChange:t=>u({...h,products:t.target.value}),placeholder:"What does this vendor supply? e.g., Organic herbs, essential oils",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Contact Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Phone Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"tel",value:h.phone,onChange:t=>u({...h,phone:t.target.value}),placeholder:"+91-XXXXXXXXXX",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email"}),e.jsx("input",{type:"email",value:h.email,onChange:t=>u({...h,email:t.target.value}),placeholder:"vendor@example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Alternative Phone"}),e.jsx("input",{type:"tel",value:h.alternatePhone,onChange:t=>u({...h,alternatePhone:t.target.value}),placeholder:"Optional second number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Website"}),e.jsx("input",{type:"url",value:h.website,onChange:t=>u({...h,website:t.target.value}),placeholder:"https://example.com",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Address"}),e.jsx("textarea",{value:h.address,onChange:t=>u({...h,address:t.target.value}),placeholder:"Street, city, state, pincode",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Business Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"GST Number"}),e.jsx("input",{type:"text",value:h.gstNumber,onChange:t=>u({...h,gstNumber:t.target.value}),placeholder:"22AAAAA0000A1Z5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Payment Terms"}),e.jsx("select",{value:h.paymentTerms,onChange:t=>u({...h,paymentTerms:t.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:mn.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Bank Name"}),e.jsx("input",{type:"text",value:h.bankName,onChange:t=>u({...h,bankName:t.target.value}),placeholder:"e.g., HDFC Bank",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:h.accountNumber,onChange:t=>u({...h,accountNumber:t.target.value}),placeholder:"Account number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"IFSC Code"}),e.jsx("input",{type:"text",value:h.ifscCode,onChange:t=>u({...h,ifscCode:t.target.value}),placeholder:"e.g., HDFC0001234",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality & Rating"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Initial Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>u({...h,initialRating:t}),className:"focus:outline-none",children:e.jsx(bt,{className:`w-8 h-8 transition-colors ${t<=h.initialRating?"fill-amber-400 text-amber-400":"text-dark-brown/20 hover:text-amber-400"}`})},t)),e.jsxs("span",{className:"ml-2 text-sm font-semibold text-dark-brown",children:[h.initialRating," / 5"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-3",children:"Quality Certifications"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.iso,onChange:t=>p({...m,iso:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"ISO Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.organic,onChange:t=>p({...m,organic:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Organic Certified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.fssai,onChange:t=>p({...m,fssai:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"FSSAI Approved"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.gmp,onChange:t=>p({...m,gmp:t.target.checked}),className:"w-4 h-4 text-accent focus:ring-accent rounded"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"GMP Certified"})]}),e.jsx("input",{type:"text",value:m.other,onChange:t=>p({...m,other:t.target.value}),placeholder:"Other certifications (comma separated)",className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Internal Notes"}),e.jsx("textarea",{value:h.notes,onChange:t=>u({...h,notes:t.target.value}),placeholder:"Any internal notes about this vendor (not visible to vendor)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:g,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:g?"Adding...":"Add Vendor"})]})]})})}const Vt=[{id:"all",label:"All Vendors",icon:"ðŸ¢",color:"bg-dark-brown/10"},{id:"Raw Materials",label:"Raw Materials",icon:"ðŸŒ¿",color:"bg-sage/20"},{id:"Packaging",label:"Packaging",icon:"ðŸ“¦",color:"bg-secondary/20"},{id:"Printing",label:"Printing",icon:"ðŸ–¨ï¸",color:"bg-blue-500/20"},{id:"Logistics",label:"Logistics",icon:"ðŸšš",color:"bg-accent/20"},{id:"Lab Testing",label:"Lab Testing",icon:"ðŸ”¬",color:"bg-purple-500/20"},{id:"Other",label:"Other",icon:"ðŸ”§",color:"bg-dark-brown/20"}];function pn(){const[s,n]=d.useState([]),[c,g]=d.useState([]),[r,h]=d.useState("grid"),[u,m]=d.useState("all"),[p,f]=d.useState(""),[t,l]=d.useState(!1),[a,w]=d.useState({total:0,active:0,pendingPayments:0,avgRating:0});d.useEffect(()=>{b()},[]),d.useEffect(()=>{k()},[s,u,p]);const b=async()=>{try{const{data:x,error:o}=await C.from("vendors").select("*").order("name");if(o)throw o;const{data:i}=await C.from("vendor_transactions").select("vendor_id, amount, status"),v=(x||[]).map(A=>{const U=i?.filter(ee=>ee.vendor_id===A.id)||[],B=U.reduce((ee,re)=>ee+(parseFloat(re.amount)||0),0),W=U.filter(ee=>ee.status==="pending").reduce((ee,re)=>ee+(parseFloat(re.amount)||0),0);return{...A,totalSpent:B,pendingAmount:W}});n(v);const N=v.length,P=v.filter(A=>A.totalSpent>0).length,L=v.reduce((A,U)=>A+U.pendingAmount,0),I=v.reduce((A,U)=>A+(U.current_rating||0),0)/(N||1);w({total:N,active:P,pendingPayments:L,avgRating:I})}catch(x){console.error("Error fetching vendors:",x)}},k=()=>{let x=s;if(u!=="all"&&(x=x.filter(o=>o.category===u)),p){const o=p.toLowerCase();x=x.filter(i=>i.name?.toLowerCase().includes(o)||i.contact_person?.toLowerCase().includes(o)||i.email?.toLowerCase().includes(o)||i.phone?.includes(o))}g(x)},_=x=>Vt.find(i=>i.id===x)?.color||"bg-dark-brown/10",y=x=>Vt.find(i=>i.id===x)?.icon||"ðŸ¢",j=x=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(o=>e.jsx(bt,{className:`w-4 h-4 ${o<=x?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},o))});return e.jsxs("div",{className:"min-h-screen bg-cream",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Vendor & Supplier Directory"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your business relationships"})]}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-secondary to-accent text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{className:"w-8 h-8 text-primary"}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:a.total})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Total Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(te,{className:"w-8 h-8 text-sage"}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:a.active})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Active Vendors"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ue,{className:"w-8 h-8 text-soft-red"}),e.jsxs("span",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",a.pendingPayments.toFixed(0)]})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Qe,{className:"w-8 h-8 text-amber-500"}),e.jsx("span",{className:"text-3xl font-bold text-amber-500",children:a.avgRating.toFixed(1)})]}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown/70",children:"Average Rating"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-soft p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto w-full lg:w-auto",children:Vt.map(x=>{const o=x.id==="all"?s.length:s.filter(i=>i.category===x.id).length;return e.jsxs("button",{onClick:()=>m(x.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${u===x.id?"bg-primary text-white shadow-soft":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:x.icon}),e.jsx("span",{children:x.label}),e.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded-full text-xs",children:o})]},x.id)})}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{type:"text",value:p,onChange:x=>f(x.target.value),placeholder:"Search vendors...",className:"w-full pl-10 pr-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex items-center gap-1 p-1 bg-dark-brown/5 rounded-lg",children:[e.jsx("button",{onClick:()=>h("grid"),className:`p-2 rounded-lg transition-all ${r==="grid"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(Us,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>h("list"),className:`p-2 rounded-lg transition-all ${r==="list"?"bg-white shadow-soft text-primary":"text-dark-brown/60 hover:text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})})]})]})]})}),r==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(x=>e.jsxs(ye,{to:`/vendors/${x.id}`,className:"bg-white rounded-xl shadow-soft hover:shadow-soft-lg transition-all overflow-hidden border-l-4 border-transparent hover:border-primary group",children:[e.jsx("div",{className:`h-2 ${_(x.category)}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary group-hover:text-accent transition-colors mb-1",children:x.name}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(x.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:y(x.category)}),x.category]})]})}),e.jsxs("div",{className:"flex items-center gap-1 mb-4",children:[j(x.current_rating||3),e.jsxs("span",{className:"text-sm text-dark-brown/60 ml-2",children:["(",x.current_rating?.toFixed(1)||"3.0",")"]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[x.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsx("span",{children:x.phone})]}),x.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:x.email})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60",children:"Total Spent"}),e.jsxs("p",{className:"text-lg font-bold text-sage",children:["â‚¹",x.totalSpent?.toFixed(0)||"0"]})]}),x.pendingAmount>0&&e.jsxs("div",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",x.pendingAmount.toFixed(0)," due"]})]})]})]},x.id))}):e.jsx("div",{className:"bg-white rounded-xl shadow-soft overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Vendor Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Contact"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Rating"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Total Spent"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Pending"})]})}),e.jsx("tbody",{children:c.map((x,o)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${o%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx(ye,{to:`/vendors/${x.id}`,className:"font-semibold text-primary hover:text-accent transition-colors",children:x.name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${_(x.category)} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:y(x.category)}),x.category]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[x.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(ht,{className:"w-3 h-3"}),x.phone]}),x.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-dark-brown/70",children:[e.jsx(Be,{className:"w-3 h-3"}),x.email]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[j(x.current_rating||3),e.jsx("span",{className:"text-sm text-dark-brown/60",children:x.current_rating?.toFixed(1)||"3.0"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"font-bold text-sage",children:["â‚¹",x.totalSpent?.toFixed(0)||"0"]})}),e.jsx("td",{className:"px-6 py-4",children:x.pendingAmount>0?e.jsxs("span",{className:"px-3 py-1 bg-soft-red/10 text-soft-red rounded-full text-sm font-bold",children:["â‚¹",x.pendingAmount.toFixed(0)]}):e.jsx("span",{className:"text-sm text-dark-brown/40",children:"-"})})]},x.id))})]})})}),c.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(we,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:p?"Try adjusting your search":"Add your first vendor to get started"}),!p&&e.jsx("button",{onClick:()=>l(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Vendor"})]})]}),t&&e.jsx(hn,{onClose:()=>l(!1),onSuccess:()=>{l(!1),b()}})]})}function bn({vendor:s}){const[n,c]=d.useState({totalSpent:0,thisMonth:0,thisYear:0,avgTransaction:0,pendingPayment:0,totalTransactions:0}),[g,r]=d.useState([]);d.useEffect(()=>{h(),u()},[s.id]);const h=async()=>{try{const{data:m}=await C.from("vendor_transactions").select("*").eq("vendor_id",s.id);if(!m)return;const p=new Date,f=m.filter(k=>{const _=new Date(k.date);return _.getMonth()===p.getMonth()&&_.getFullYear()===p.getFullYear()}),t=m.filter(k=>new Date(k.date).getFullYear()===p.getFullYear()),l=m.reduce((k,_)=>k+parseFloat(_.amount),0),a=f.reduce((k,_)=>k+parseFloat(_.amount),0),w=t.reduce((k,_)=>k+parseFloat(_.amount),0),b=m.filter(k=>k.status==="pending").reduce((k,_)=>k+parseFloat(_.amount),0);c({totalSpent:l,thisMonth:a,thisYear:w,avgTransaction:m.length>0?l/m.length:0,pendingPayment:b,totalTransactions:m.length})}catch(m){console.error("Error fetching stats:",m)}},u=async()=>{try{const{data:m}=await C.from("vendor_transactions").select("date, amount").eq("vendor_id",s.id).order("date");if(!m)return;const p={};m.forEach(t=>{const l=new Date(t.date),a=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`;p[a]||(p[a]=0),p[a]+=parseFloat(t.amount)});const f=Object.entries(p).map(([t,l])=>({month:t,amount:l}));r(f.slice(-12))}catch(m){console.error("Error fetching spending trend:",m)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Vendor Information"}),e.jsxs("div",{className:"space-y-3",children:[s.contact_person&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Contact Person"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.contact_person})]})]}),s.phone&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ht,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Phone"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.phone}),s.alternate_phone&&e.jsx("p",{className:"text-sm text-dark-brown/60",children:s.alternate_phone})]})]}),s.email&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Be,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Email"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.email})]})]}),s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Bs,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Address"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.address})]})]}),s.website&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Fa,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Website"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-accent hover:underline",children:s.website})]})]}),s.gst_number&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(mt,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"GST Number"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.gst_number})]})]}),s.payment_terms&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ’³"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Payment Terms"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.payment_terms})]})]}),s.certifications&&Array.isArray(s.certifications)&&s.certifications.length>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Qe,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Certifications"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:s.certifications.map((m,p)=>e.jsx("span",{className:"px-2 py-1 bg-sage/20 text-sage text-xs font-semibold rounded-full",children:m},p))})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.totalSpent.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.thisMonth.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"This Year"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.thisYear.toFixed(0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Avg Transaction"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¹",n.avgTransaction.toFixed(0)]})]})]}),n.pendingPayment>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Pending Payment"}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:["â‚¹",n.pendingPayment.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Total Transactions"}),e.jsx("span",{className:"font-bold text-primary",children:n.totalTransactions})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Category"}),e.jsx("span",{className:"font-bold text-primary",children:s.category})]}),s.products&&e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-dark-brown/70",children:"Products/Services"}),e.jsx("span",{className:"font-semibold text-primary text-right",children:s.products})]})]})]})]})]}),g.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(te,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Spending Trend (Last 12 Months)"})]}),e.jsx(pe,{width:"100%",height:300,children:e.jsxs(Dt,{data:g,children:[e.jsx(Ie,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Fe,{dataKey:"month",stroke:"#6B5A4C",style:{fontSize:"12px"}}),e.jsx(Te,{stroke:"#6B5A4C",style:{fontSize:"12px"},tickFormatter:m=>`â‚¹${m}`}),e.jsx(ge,{contentStyle:{backgroundColor:"#fff",border:"none",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},formatter:m=>[`â‚¹${m.toFixed(0)}`,"Spending"]}),e.jsx(Le,{type:"monotone",dataKey:"amount",stroke:"#8B9A7E",strokeWidth:3,dot:{fill:"#8B9A7E",r:4},activeDot:{r:6}})]})})]})]})}function un({vendorId:s}){const[n,c]=d.useState([]),[g,r]=d.useState([]),[h,u]=d.useState("all");d.useEffect(()=>{m()},[s]),d.useEffect(()=>{p()},[n,h]);const m=async()=>{try{const{data:a,error:w}=await C.from("vendor_transactions").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(w)throw w;c(a||[])}catch(a){console.error("Error fetching transactions:",a)}},p=()=>{r(h==="all"?n:n.filter(a=>a.status===h))},f=g.reduce((a,w)=>a+parseFloat(w.amount),0),t=g.filter(a=>a.status==="paid").reduce((a,w)=>a+parseFloat(w.amount),0),l=g.filter(a=>a.status==="pending").reduce((a,w)=>a+parseFloat(w.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qs,{className:"w-5 h-5 text-dark-brown/60"}),e.jsxs("select",{value:h,onChange:a=>u(a.target.value),className:"px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Transactions"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Transaction"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Transactions"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",f.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[g.length," transactions"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",t.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[g.filter(a=>a.status==="paid").length," transactions"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",l.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[g.filter(a=>a.status==="pending").length," transactions"]})]})]}),e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:g.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Payment Mode"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Invoice #"})]})}),e.jsx("tbody",{children:g.map((a,w)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${w%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:new Date(a.date).toLocaleDateString()})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${a.transaction_type==="expense"?"bg-accent/10 text-accent":"bg-sage/10 text-sage"}`,children:a.transaction_type})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:a.description||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"w-4 h-4 text-sage"}),e.jsxs("span",{className:"text-sm font-bold text-sage",children:["â‚¹",parseFloat(a.amount).toFixed(2)]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:a.payment_mode||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${a.status==="paid"?"bg-sage/10 text-sage":"bg-soft-red/10 text-soft-red"}`,children:a.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:a.invoice_number||"-"})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx($e,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No transactions found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Start by adding your first transaction"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Transaction"})]})})]})}function gn({vendorId:s}){const[n,c]=d.useState([]);d.useEffect(()=>{g()},[s]);const g=async()=>{try{const{data:t,error:l}=await C.from("vendor_invoices").select("*").eq("vendor_id",s).order("date",{ascending:!1});if(l)throw l;c(t||[])}catch(t){console.error("Error fetching invoices:",t)}},r=t=>{switch(t){case"paid":return e.jsx(G,{className:"w-5 h-5 text-sage"});case"overdue":return e.jsx(ue,{className:"w-5 h-5 text-soft-red"});default:return e.jsx(le,{className:"w-5 h-5 text-accent"})}},h=t=>{switch(t){case"paid":return"bg-sage/10 text-sage";case"overdue":return"bg-soft-red/10 text-soft-red";default:return"bg-accent/10 text-accent"}},u=n.reduce((t,l)=>t+parseFloat(l.amount),0),m=n.filter(t=>t.status==="paid").reduce((t,l)=>t+parseFloat(l.amount),0),p=n.filter(t=>t.status==="pending").reduce((t,l)=>t+parseFloat(l.amount),0),f=n.filter(t=>t.status==="overdue").reduce((t,l)=>t+parseFloat(l.amount),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Invoice Management"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Upload Invoice"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Invoices"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",u.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.length," invoices"]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",m.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.filter(t=>t.status==="paid").length," invoices"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Pending"}),e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["â‚¹",p.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.filter(t=>t.status==="pending").length," invoices"]})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Overdue"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",f.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[n.filter(t=>t.status==="overdue").length," invoices"]})]})]}),e.jsx("div",{className:"space-y-4",children:n.length>0?n.map(t=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(se,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-heading text-lg font-bold text-primary",children:["Invoice #",t.invoice_number]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Date: ",new Date(t.date).toLocaleDateString()," | Due: ",new Date(t.due_date).toLocaleDateString()]})]})]}),t.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2",children:t.notes})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",parseFloat(t.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r(t.status),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${h(t.status)}`,children:t.status})]}),t.status!=="paid"&&e.jsx("button",{className:"px-4 py-2 bg-sage/10 hover:bg-sage/20 text-sage rounded-lg font-semibold transition-colors",children:"Mark as Paid"})]})]}),t.paid_date&&e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-brown/5",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Paid on: ",new Date(t.paid_date).toLocaleDateString()," | Amount: â‚¹",parseFloat(t.paid_amount).toFixed(2)]})})]},t.id)):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(se,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No invoices found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Upload your first invoice to get started"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Invoice"})]})})]})}function fn({vendorId:s}){const[n,c]=d.useState([]);d.useEffect(()=>{g()},[s]);const g=async()=>{try{const{data:r,error:h}=await C.from("vendor_prices").select("*").eq("vendor_id",s).order("product_name");if(h)throw h;c(r||[])}catch(r){console.error("Error fetching prices:",r)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Price List"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Price Item"]})]}),n.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Product/Service"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Unit"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Price"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"MOQ"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Lead Time"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-dark-brown",children:"Last Updated"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((r,h)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${h%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:r.product_name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-semibold",children:r.category||"General"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/70",children:r.unit})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-lg font-bold text-sage",children:["â‚¹",parseFloat(r.price).toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:r.moq||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown",children:r.lead_time?`${r.lead_time} days`:"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-dark-brown/60",children:new Date(r.updated_at).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-primary/10 text-primary rounded-lg transition-colors",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-accent/10 text-accent rounded-lg transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})})]},r.id))})]})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ne,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No price items found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add price items to track vendor pricing"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add Price Item"})]})]})}const _s=[{id:"contracts",label:"Contracts & Agreements",icon:"ðŸ“„"},{id:"gst",label:"GST Certificate",icon:"ðŸ“œ"},{id:"certifications",label:"Quality Certifications",icon:"ðŸ†"},{id:"catalogs",label:"Product Catalogs",icon:"ðŸ“‹"},{id:"reports",label:"Test Reports",icon:"ðŸ“Š"},{id:"other",label:"Other Documents",icon:"ðŸ’¼"}];function jn({vendorId:s}){const[n,c]=d.useState([]),[g,r]=d.useState("all");d.useEffect(()=>{h()},[s]);const h=async()=>{try{const{data:f,error:t}=await C.from("vendor_documents").select("*").eq("vendor_id",s).order("uploaded_at",{ascending:!1});if(t)throw t;c(f||[])}catch(f){console.error("Error fetching documents:",f)}},u=g==="all"?n:n.filter(f=>f.category===g),m=f=>_s.find(t=>t.id===f)||{icon:"ðŸ“„",label:f},p=f=>f<1024?f+" B":f<1024*1024?(f/1024).toFixed(1)+" KB":(f/(1024*1024)).toFixed(1)+" MB";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Documents"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-5 h-5"}),"Upload Document"]})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>r("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",n.length,")"]}),_s.map(f=>{const t=n.filter(l=>l.category===f.id).length;return e.jsxs("button",{onClick:()=>r(f.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g===f.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:f.icon}),f.label," (",t,")"]},f.id)})]}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(f=>{const t=m(f.category);return e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl flex-shrink-0",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:f.file_name}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:t.label})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-brown/60 mb-3",children:[e.jsx("span",{children:p(f.file_size||0)}),e.jsx("span",{children:new Date(f.uploaded_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{className:"p-2 hover:bg-soft-red/10 text-soft-red rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]},f.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(se,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents found"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:g==="all"?"Upload documents to keep vendor information organized":`No ${m(g).label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload Document"})]})]})}const Ht=[{id:"quality",label:"Product Quality"},{id:"delivery",label:"Delivery Time"},{id:"pricing",label:"Pricing"},{id:"service",label:"Customer Service"},{id:"reliability",label:"Reliability"}];function yn({vendorId:s,vendorRating:n}){const{user:c}=H(),[g,r]=d.useState([]),[h,u]=d.useState([]),[m,p]=d.useState(""),[f,t]=d.useState(!1),[l,a]=d.useState({category:"quality",rating:5,text:""});d.useEffect(()=>{w(),b()},[s]);const w=async()=>{try{const{data:x,error:o}=await C.from("vendor_notes").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(o)throw o;r(x||[])}catch(x){console.error("Error fetching notes:",x)}},b=async()=>{try{const{data:x,error:o}=await C.from("vendor_reviews").select("*").eq("vendor_id",s).order("created_at",{ascending:!1});if(o)throw o;u(x||[])}catch(x){console.error("Error fetching reviews:",x)}},k=async()=>{if(m.trim())try{const{error:x}=await C.from("vendor_notes").insert([{vendor_id:s,note_text:m,written_by:c?.id}]);if(x)throw x;p(""),w()}catch(x){console.error("Error adding note:",x),alert("Error adding note")}},_=async()=>{if(!l.text.trim()){alert("Please write a review");return}try{const{error:x}=await C.from("vendor_reviews").insert([{vendor_id:s,category:l.category,rating:l.rating,review_text:l.text,reviewed_by:c?.id}]);if(x)throw x;a({category:"quality",rating:5,text:""}),t(!1),b()}catch(x){console.error("Error adding review:",x),alert("Error adding review")}},y=(x,o=!1,i)=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(v=>e.jsx("button",{type:"button",onClick:()=>o&&i&&i(v),disabled:!o,className:o?"cursor-pointer":"",children:e.jsx(bt,{className:`w-5 h-5 ${v<=x?"fill-amber-400 text-amber-400":"text-dark-brown/20"} ${o?"hover:fill-amber-400 hover:text-amber-400":""}`})},v))}),j=x=>{const o=h.filter(i=>i.category===x);return o.length===0?0:o.reduce((i,v)=>i+v.rating,0)/o.length};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Internal Notes"})}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:[e.jsx("textarea",{value:m,onChange:x=>p(x.target.value),placeholder:"Add a note about this vendor...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none mb-3"}),e.jsxs("button",{onClick:k,disabled:!m.trim(),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all disabled:opacity-50",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Note"]})]}),e.jsx("div",{className:"space-y-3",children:g.length>0?g.map(x=>e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ze,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:"User"}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[new Date(x.created_at).toLocaleDateString()," at"," ",new Date(x.created_at).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1 hover:bg-primary/10 text-primary rounded transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:x.note_text})]},x.id)):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Ft,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No notes yet"})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Ratings & Reviews"}),e.jsxs("button",{onClick:()=>t(!f),className:"flex items-center gap-2 px-4 py-2 bg-accent/10 hover:bg-accent/20 text-accent rounded-xl font-semibold transition-colors",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Review"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-amber-600/10 rounded-xl p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-5xl font-bold text-amber-600 mb-2",children:n?.toFixed(1)||"0.0"}),y(n||0),e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-2",children:["Based on ",h.length," reviews"]})]}),e.jsx("div",{className:"space-y-2",children:Ht.map(x=>{const o=j(x.id);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:x.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[y(o),e.jsx("span",{className:"text-sm text-dark-brown/60 w-8",children:o>0?o.toFixed(1):"-"})]})]},x.id)})})]}),f&&e.jsx("div",{className:"bg-cream/50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Category"}),e.jsx("select",{value:l.category,onChange:x=>a({...l,category:x.target.value}),className:"w-full px-4 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none",children:Ht.map(x=>e.jsx("option",{value:x.id,children:x.label},x.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Rating"}),y(l.rating,!0,x=>a({...l,rating:x}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Review"}),e.jsx("textarea",{value:l.text,onChange:x=>a({...l,text:x.target.value}),placeholder:"Write your review...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(!1),className:"flex-1 px-4 py-2 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:_,className:"flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-amber-600 text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all",children:"Submit Review"})]})]})}),e.jsx("div",{className:"space-y-3",children:h.length>0?h.map(x=>{const o=Ht.find(i=>i.id===x.category);return e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"px-3 py-1 bg-accent/10 text-accent rounded-full text-xs font-semibold",children:o?.label}),y(x.rating)]}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(x.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm text-dark-brown",children:x.review_text})]},x.id)}):e.jsxs("div",{className:"text-center py-8 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(bt,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No reviews yet"})]})})]})]})})}const wn=[{id:"overview",label:"Overview",icon:xt},{id:"transactions",label:"Transactions",icon:mt},{id:"invoices",label:"Invoices",icon:St},{id:"prices",label:"Price List",icon:gt},{id:"documents",label:"Documents",icon:se},{id:"notes",label:"Notes & Reviews",icon:Ft}],Nn=s=>({"Raw Materials":"bg-sage/20",Packaging:"bg-secondary/20",Printing:"bg-blue-500/20",Logistics:"bg-accent/20","Lab Testing":"bg-purple-500/20",Other:"bg-dark-brown/20"})[s]||"bg-dark-brown/10";function vn(){const{id:s}=Ye(),n=ie(),[c,g]=d.useState(null),[r,h]=d.useState("overview"),[u,m]=d.useState(!0);d.useEffect(()=>{s&&p()},[s]);const p=async()=>{try{const{data:l,error:a}=await C.from("vendors").select("*").eq("id",s).maybeSingle();if(a)throw a;g(l)}catch(l){console.error("Error fetching vendor:",l)}finally{m(!1)}},f=async()=>{if(confirm("Are you sure you want to delete this vendor? This action cannot be undone."))try{const{error:l}=await C.from("vendors").delete().eq("id",s);if(l)throw l;n("/vendors")}catch(l){console.error("Error deleting vendor:",l),alert("Error deleting vendor")}},t=l=>e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(a=>e.jsx(bt,{className:`w-5 h-5 ${a<=l?"fill-amber-400 text-amber-400":"text-dark-brown/20"}`},a))});return u?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading vendor details..."})]})})}):c?e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/vendors"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),"Back to Vendors"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start gap-4 mb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-2",children:c.name}),e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 ${Nn(c.category)} rounded-full text-sm font-semibold`,children:c.category})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[t(c.current_rating||3),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown/60",children:[c.current_rating?.toFixed(1)||"3.0"," / 5.0"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{},className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Delete"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:wn.map(l=>{const a=l.icon;return e.jsxs("button",{onClick:()=>h(l.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${r===l.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(a,{className:"w-5 h-5"}),l.label]},l.id)})})}),e.jsxs("div",{className:"p-6",children:[r==="overview"&&e.jsx(bn,{vendor:c,onUpdate:p}),r==="transactions"&&e.jsx(un,{vendorId:c.id}),r==="invoices"&&e.jsx(gn,{vendorId:c.id}),r==="prices"&&e.jsx(fn,{vendorId:c.id}),r==="documents"&&e.jsx(jn,{vendorId:c.id}),r==="notes"&&e.jsx(yn,{vendorId:c.id,vendorRating:c.current_rating})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Vendor not found"}),e.jsx("button",{onClick:()=>n("/vendors"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Vendors"})]})})})}function kn({products:s,onClose:n,onSuccess:c}){const{user:g}=H(),[r,h]=d.useState(!1),[u,m]=d.useState(null),[p,f]=d.useState({batchNumber:"",manufacturingDate:$(new Date,"yyyy-MM-dd"),batchSize:"",expiryDate:"",storageLocation:"",qcNotes:""}),[t,l]=d.useState([]),[a,w]=d.useState({ingredientsVerified:!1,formulaFollowed:!1,phTestPassed:!1,visualInspectionPassed:!1,packagingChecked:!1,labelsApplied:!1,batchApproved:!1});d.useEffect(()=>{u&&(b(),k(),_())},[u]);const b=()=>{const i=$(new Date,"yyyyMMdd"),v=u?.name?.substring(0,3).toUpperCase()||"PRD",N="001";f(P=>({...P,batchNumber:`BT-${v}-${i}-${N}`}))},k=()=>{const i=u?.shelf_life||24,v=Ms(new Date(p.manufacturingDate),i);f(N=>({...N,expiryDate:$(v,"yyyy-MM-dd")}))},_=async()=>{if(u?.id)try{const{data:i,error:v}=await C.from("product_ingredients").select("*").eq("product_id",u.id);if(v)throw v;i&&i.length>0?l(i.map(N=>({name:N.ingredient_name,lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:N.quantity||"",unit:N.unit||"kg"}))):l([])}catch(i){console.error("Error loading ingredients:",i)}},y=()=>{l([...t,{name:"",lotNumber:"",supplierBatchNumber:"",vendorId:null,ingredientExpiryDate:"",quantityUsed:"",unit:"kg"}])},j=i=>{l(t.filter((v,N)=>N!==i))},x=(i,v,N)=>{const P=[...t];P[i]={...P[i],[v]:N},l(P)},o=async i=>{if(i.preventDefault(),!u||!p.batchNumber||!p.batchSize){alert("Please fill in all required fields");return}h(!0);try{const{data:v,error:N}=await C.from("batches").insert([{batch_number:p.batchNumber,product_id:u.id,manufacturing_date:p.manufacturingDate,expiry_date:p.expiryDate,batch_size:parseInt(p.batchSize),units_in_stock:parseInt(p.batchSize),storage_location:p.storageLocation,qc_checklist:a,qc_notes:p.qcNotes,qc_approved:a.batchApproved,status:"active",created_by:g?.id}]).select().single();if(N)throw N;if(t.length>0&&v){const P=t.filter(L=>L.name).map(L=>({batch_id:v.id,ingredient_name:L.name,lot_number:L.lotNumber,supplier_batch_number:L.supplierBatchNumber,vendor_id:L.vendorId,ingredient_expiry_date:L.ingredientExpiryDate||null,quantity_used:L.quantityUsed?parseFloat(L.quantityUsed):null,unit:L.unit}));if(P.length>0){const{error:L}=await C.from("batch_ingredients").insert(P);if(L)throw L}}c()}catch(v){console.error("Error creating batch:",v),alert("Error creating batch. Please try again.")}finally{h(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-5xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Create New Batch"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(de,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Product ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:u?.id||"",onChange:i=>{const v=s.find(N=>N.id===i.target.value);m(v)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select a product"}),s.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:p.batchNumber,onChange:i=>f({...p,batchNumber:i.target.value}),placeholder:"BT-PRD-20241215-001",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Batch Size (units) ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"number",value:p.batchSize,onChange:i=>f({...p,batchSize:i.target.value}),placeholder:"500",required:!0,min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Manufacturing Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:p.manufacturingDate,onChange:i=>{f({...p,manufacturingDate:i.target.value}),u&&k()},max:$(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:p.expiryDate,onChange:i=>f({...p,expiryDate:i.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:p.storageLocation,onChange:i=>f({...p,storageLocation:i.target.value}),placeholder:"e.g., Section A, Shelf 3",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]})]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Ingredients Used (Lot Tracking)"}),e.jsxs("button",{type:"button",onClick:y,className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Ingredient"]})]}),t.length>0?e.jsx("div",{className:"space-y-4",children:t.map((i,v)=>e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Ingredient #",v+1]}),e.jsx("button",{type:"button",onClick:()=>j(v),className:"p-1 hover:bg-soft-red/10 text-soft-red rounded transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Name"}),e.jsx("input",{type:"text",value:i.name,onChange:N=>x(v,"name",N.target.value),placeholder:"e.g., Ashwagandha Powder",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Lot Number"}),e.jsx("input",{type:"text",value:i.lotNumber,onChange:N=>x(v,"lotNumber",N.target.value),placeholder:"Internal lot number",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Supplier Batch Number"}),e.jsx("input",{type:"text",value:i.supplierBatchNumber,onChange:N=>x(v,"supplierBatchNumber",N.target.value),placeholder:"Supplier's batch",className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Quantity Used"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:i.quantityUsed,onChange:N=>x(v,"quantityUsed",N.target.value),placeholder:"Amount",step:"0.01",className:"flex-1 px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"}),e.jsxs("select",{value:i.unit,onChange:N=>x(v,"unit",N.target.value),className:"px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm",children:[e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"l",children:"l"}),e.jsx("option",{value:"ml",children:"ml"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-dark-brown mb-1",children:"Ingredient Expiry Date"}),e.jsx("input",{type:"date",value:i.ingredientExpiryDate,onChange:N=>x(v,"ingredientExpiryDate",N.target.value),className:"w-full px-3 py-2 border-2 border-dark-brown/10 rounded-lg focus:border-accent focus:outline-none text-sm"})]})]})]},v))}):e.jsx("p",{className:"text-sm text-dark-brown/60 text-center py-4",children:"No ingredients added yet. Add ingredients to enable full traceability."})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Quality Control"}),e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.ingredientsVerified,onChange:i=>w({...a,ingredientsVerified:i.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"All ingredients verified"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.formulaFollowed,onChange:i=>w({...a,formulaFollowed:i.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Formula followed correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.phTestPassed,onChange:i=>w({...a,phTestPassed:i.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"pH test passed (if applicable)"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.visualInspectionPassed,onChange:i=>w({...a,visualInspectionPassed:i.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Visual inspection passed"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.packagingChecked,onChange:i=>w({...a,packagingChecked:i.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Packaging quality checked"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.labelsApplied,onChange:i=>w({...a,labelsApplied:i.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Labels applied correctly"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.batchApproved,onChange:i=>w({...a,batchApproved:i.target.checked}),className:"w-5 h-5 text-sage focus:ring-sage rounded"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:"Batch approved for distribution"})]}),e.jsxs("div",{className:"pt-3 border-t border-dark-brown/10",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"QC Notes"}),e.jsx("textarea",{value:p.qcNotes,onChange:i=>f({...p,qcNotes:i.target.value}),placeholder:"Any additional quality control notes...",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:o,disabled:r,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:r?"Creating...":"Create Batch"})]})]})})}function _n(){const[s,n]=d.useState([]),[c,g]=d.useState([]),[r,h]=d.useState([]),[u,m]=d.useState(""),[p,f]=d.useState("all"),[t,l]=d.useState(!1),[a,w]=d.useState({activeBatches:0,totalUnits:0,expiringSoon:0,productsWithBatches:0});d.useEffect(()=>{b(),k()},[]),d.useEffect(()=>{_(),y()},[s,u,p]);const b=async()=>{try{const{data:i,error:v}=await C.from("batches").select("*, products(name, images)").order("created_at",{ascending:!1});if(v)throw v;n(i||[])}catch(i){console.error("Error fetching batches:",i)}},k=async()=>{try{const{data:i,error:v}=await C.from("products").select("id, name, images").order("name");if(v)throw v;h(i||[])}catch(i){console.error("Error fetching products:",i)}},_=()=>{let i=s;if(p!=="all"&&(i=i.filter(v=>v.status===p)),u){const v=u.toLowerCase();i=i.filter(N=>N.batch_number?.toLowerCase().includes(v)||N.products?.name?.toLowerCase().includes(v))}g(i)},y=()=>{const i=new Date,v=s.filter(I=>I.status==="active").length,N=s.reduce((I,A)=>I+(A.units_in_stock||0),0),P=s.filter(I=>{const A=X(new Date(I.expiry_date),i);return A<=30&&A>=0}).length,L=new Set(s.map(I=>I.product_id)).size;w({activeBatches:v,totalUnits:N,expiringSoon:P,productsWithBatches:L})},j=i=>{const v=X(new Date(i),new Date);return v<0||v<=15?"text-soft-red":v<=30?"text-accent":v<=60?"text-amber-500":"text-sage"},x=i=>{const v=X(new Date(i.expiry_date),new Date);return i.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:v<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:i.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:v<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:i.units_in_stock<i.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:i.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}},o=i=>i.units_in_stock/i.batch_size*100;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(ke,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(Z,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Batch & Lot Tracking"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Complete traceability for manufacturing"})]}),e.jsxs(be,{onClick:()=>l(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"New Batch"]})]})]}),e.jsxs(be,{onClick:()=>l(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"New Batch"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(G,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:a.activeBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active Batches"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(ne,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:a.totalUnits})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Units in Stock"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(xe,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:`text-3xl font-bold ${a.expiringSoon>0?"text-accent":"text-primary/40"}`,children:a.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring Soon (30d)"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-blue-500/20 rounded-button",children:e.jsx(le,{className:"w-6 h-6 text-blue-500"})}),e.jsx("span",{className:"text-3xl font-bold text-blue-500",children:a.productsWithBatches})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Products with Batches"})]})]}),e.jsx(Z,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:()=>f("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${p==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All Batches (",s.length,")"]}),e.jsxs("button",{onClick:()=>f("active"),className:`px-4 py-2 rounded-button font-bold transition-all ${p==="active"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Active (",s.filter(i=>i.status==="active").length,")"]}),e.jsxs("button",{onClick:()=>f("sold_out"),className:`px-4 py-2 rounded-button font-bold transition-all ${p==="sold_out"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["Sold Out (",s.filter(i=>i.status==="sold_out").length,")"]})]}),e.jsxs("div",{className:"relative w-full lg:w-64",children:[e.jsx(Ke,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:u,onChange:i=>m(i.target.value),placeholder:"Search batches...",className:"input-float w-full pl-12"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(i=>{const v=x(i),N=o(i),P=X(new Date(i.expiry_date),new Date);return e.jsx(ye,{to:`/batches/${i.id}`,className:"block",children:e.jsx(Z,{className:"hover:shadow-glow transition-all duration-300 group h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${v.color}`,children:[e.jsx("span",{className:"mr-1",children:v.icon}),v.label]})}),e.jsx("h3",{className:"font-mono text-lg font-bold text-primary group-hover:text-accent transition-colors mb-1",children:i.batch_number}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:i.products?.name||"Unknown Product"})]}),e.jsx(Os,{className:"w-8 h-8 text-dark-brown/20 group-hover:text-primary transition-colors"})]}),i.products?.images&&i.products.images[0]&&e.jsx("div",{className:"w-full h-32 mb-4 rounded-lg overflow-hidden bg-cream",children:e.jsx("img",{src:i.products.images[0],alt:i.products.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Manufacturing"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(new Date(i.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Expiry"}),e.jsxs("span",{className:`font-semibold ${j(i.expiry_date)}`,children:[$(new Date(i.expiry_date),"MMM dd, yyyy"),e.jsxs("span",{className:"text-xs ml-1",children:["(",P>=0?`${P}d left`:"Expired",")"]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-dark-brown/60",children:"Stock Status"}),e.jsxs("span",{className:"font-bold text-primary",children:[i.units_in_stock," / ",i.batch_size," units"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${N>50?"bg-sage":N>20?"bg-amber-500":"bg-soft-red"}`,style:{width:`${N}%`}})})]}),i.qc_approved&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-sage",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold",children:"QC Approved"})]})]})})},i.id)})}),c.length===0&&e.jsxs(Z,{className:"text-center py-16",children:[e.jsx(ne,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No batches found"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:u?"Try adjusting your search":"Create your first batch to start tracking"}),!u&&e.jsx(be,{onClick:()=>l(!0),variant:"primary",size:"lg",children:"Create Batch"})]})]}),t&&e.jsx(kn,{products:r,onClose:()=>l(!1),onSuccess:()=>{l(!1),b()}})]})}function Cn({batch:s}){const[n,c]=d.useState([]);d.useEffect(()=>{g()},[s.id]);const g=async()=>{try{const{data:u,error:m}=await C.from("batch_ingredients").select("*, vendors(name)").eq("batch_id",s.id);if(m)throw m;c(u||[])}catch(u){console.error("Error fetching ingredients:",u)}},r=X(new Date(s.expiry_date),new Date),h=s.units_in_stock/s.batch_size*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Batch Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ne,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Batch Number"}),e.jsx("p",{className:"font-mono font-bold text-dark-brown",children:s.batch_number})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"ðŸ“…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(s.manufacturing_date),"MMMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:"â°"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(s.expiry_date),"MMMM dd, yyyy")}),e.jsx("p",{className:`text-xs mt-1 font-semibold ${r<0?"text-soft-red":r<=30?"text-accent":r<=60?"text-amber-500":"text-sage"}`,children:r>=0?`${r} days remaining`:"Expired"})]})]}),s.storage_location&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Bs,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Storage Location"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:s.storage_location})]})]}),s.qc_approved&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-sage/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(G,{className:"w-5 h-5 text-sage"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Quality Control"}),e.jsx("p",{className:"font-semibold text-sage",children:"Approved"}),s.qc_approved_date&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["on ",$(new Date(s.qc_approved_date),"MMM dd, yyyy")]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Produced"}),e.jsx("p",{className:"text-3xl font-bold",children:s.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_in_stock})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Sold"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_sold||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold",children:s.units_damaged||0})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Remaining"}),e.jsxs("span",{className:"font-bold",children:[h.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all",style:{width:`${h}%`}})})]})]}),s.products&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Product Details"}),e.jsxs("div",{className:"flex items-start gap-4",children:[s.products.images&&s.products.images[0]&&e.jsx("img",{src:s.products.images[0],alt:s.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown mb-1",children:s.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",s.batch_number]})]})]})]})]})]}),n.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Ingredient Traceability"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"Complete ingredient lot tracking for full traceability"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Supplier Batch"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity Used"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry"})]})}),e.jsx("tbody",{children:n.map((u,m)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${m%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:u.ingredient_name}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:u.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown/70",children:u.supplier_batch_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:u.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown",children:u.quantity_used?`${u.quantity_used} ${u.unit}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:u.ingredient_expiry_date?$(new Date(u.ingredient_expiry_date),"MMM dd, yyyy"):"-"})]},u.id))})]})})]})]})}function Sn({batchId:s,batch:n}){const[c,g]=d.useState([]);d.useEffect(()=>{r()},[s]);const r=async()=>{try{const{data:m,error:p}=await C.from("batch_tests").select("*").eq("batch_id",s).order("test_date",{ascending:!1});if(p)throw p;g(m||[])}catch(m){console.error("Error fetching tests:",m)}},h=n.qc_checklist||{},u=[{key:"ingredientsVerified",label:"All ingredients verified"},{key:"formulaFollowed",label:"Formula followed correctly"},{key:"phTestPassed",label:"pH test passed"},{key:"visualInspectionPassed",label:"Visual inspection passed"},{key:"packagingChecked",label:"Packaging quality checked"},{key:"labelsApplied",label:"Labels applied correctly"},{key:"batchApproved",label:"Batch approved for distribution"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"QC Checklist"}),n.qc_approved&&e.jsxs("span",{className:"flex items-center gap-2 px-3 py-1 bg-sage/10 text-sage rounded-full text-sm font-bold",children:[e.jsx(G,{className:"w-4 h-4"}),"Approved"]})]}),e.jsx("div",{className:"space-y-3",children:u.map(m=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[h[m.key]?e.jsx(G,{className:"w-5 h-5 text-sage flex-shrink-0"}):e.jsx(Ce,{className:"w-5 h-5 text-dark-brown/20 flex-shrink-0"}),e.jsx("span",{className:`text-sm font-semibold ${h[m.key]?"text-dark-brown":"text-dark-brown/40"}`,children:m.label})]},m.key))}),n.qc_notes&&e.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown/60 mb-2",children:"QC Notes"}),e.jsx("p",{className:"text-sm text-dark-brown",children:n.qc_notes})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Test Results"}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Test"]})]}),c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(m=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:m.test_type}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${m.result.toLowerCase().includes("pass")?"bg-sage/10 text-sage":m.result.toLowerCase().includes("fail")?"bg-soft-red/10 text-soft-red":"bg-accent/10 text-accent"}`,children:m.result})]}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Tested on: ",new Date(m.test_date).toLocaleDateString()]}),m.notes&&e.jsx("p",{className:"text-sm text-dark-brown mt-2",children:m.notes})]},m.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"No test results recorded"})]})]})})]})})}function Dn({batchId:s,batch:n,onUpdate:c}){const[g,r]=d.useState([]),[h,u]=d.useState([]);d.useEffect(()=>{m(),p()},[s]);const m=async()=>{try{const{data:f,error:t}=await C.from("batch_dispatches").select("*").eq("batch_id",s).order("dispatch_date",{ascending:!1});if(t)throw t;r(f||[])}catch(f){console.error("Error fetching dispatches:",f)}},p=async()=>{try{const{data:f,error:t}=await C.from("batch_stock_adjustments").select("*").eq("batch_id",s).order("adjustment_date",{ascending:!1});if(t)throw t;u(f||[])}catch(f){console.error("Error fetching adjustments:",f)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Units"}),e.jsx("p",{className:"text-3xl font-bold",children:n.batch_size})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"In Stock"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:n.units_in_stock})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Sold/Dispatched"}),e.jsx("p",{className:"text-3xl font-bold text-blue-500",children:n.units_sold||0})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Damaged"}),e.jsx("p",{className:"text-3xl font-bold text-soft-red",children:n.units_damaged||0})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Dispatch History"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-4 h-4"}),"Record Dispatch"]})]}),g.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Dispatch To"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Invoice #"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"})]})}),e.jsx("tbody",{children:g.map((f,t)=>e.jsxs("tr",{className:`border-t border-dark-brown/5 ${t%2===0?"bg-white":"bg-cream/20"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-dark-brown/40"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:$(new Date(f.dispatch_date),"MMM dd, yyyy")})]})}),e.jsx("td",{className:"px-4 py-3 font-semibold text-dark-brown",children:f.dispatch_to}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[f.quantity," units"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70 font-mono",children:f.invoice_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:f.dispatch_method||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f.status==="delivered"?"bg-sage/10 text-sage":"bg-accent/10 text-accent"}`,children:f.status})})]},f.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-brown/60 mb-4",children:"No dispatches recorded"}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Record First Dispatch"})]})]}),h.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Adjustments"}),e.jsx("div",{className:"space-y-3",children:h.map(f=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-soft-red/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(je,{className:"w-5 h-5 text-soft-red"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown capitalize",children:f.adjustment_type}),e.jsxs("span",{className:"font-bold text-soft-red",children:["-",f.quantity," units"]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-1",children:f.reason}),e.jsx("p",{className:"text-xs text-dark-brown/60",children:$(new Date(f.adjustment_date),"MMM dd, yyyy")}),f.notes&&e.jsx("p",{className:"text-xs text-dark-brown/60 mt-2 italic",children:f.notes})]})]},f.id))})]})]})}const Wt=[{id:"product",label:"Product Photos",icon:"ðŸ“¦"},{id:"packaging",label:"Packaging Photos",icon:"ðŸ“¦"},{id:"label",label:"Label Photos",icon:"ðŸ·ï¸"},{id:"qc",label:"QC Photos",icon:"âœ…"},{id:"process",label:"Process Photos",icon:"âš™ï¸"}];function Mn({batchId:s}){const[n,c]=d.useState([]),[g,r]=d.useState("all");d.useEffect(()=>{h()},[s]);const h=async()=>{try{const{data:m,error:p}=await C.from("batch_photos").select("*").eq("batch_id",s).order("uploaded_at",{ascending:!1});if(p)throw p;c(m||[])}catch(m){console.error("Error fetching photos:",m)}},u=g==="all"?n:n.filter(m=>m.category===g);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>r("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Photos (",n.length,")"]}),Wt.map(m=>{const p=n.filter(f=>f.category===m.id).length;return e.jsxs("button",{onClick:()=>r(m.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g===m.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[e.jsx("span",{children:m.icon}),m.label," (",p,")"]},m.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-4 h-4"}),"Upload Photos"]})]}),u.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:u.map(m=>{const p=Wt.find(f=>f.id===m.category);return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dark-brown/5 overflow-hidden hover:shadow-soft transition-all group",children:[e.jsxs("div",{className:"aspect-square bg-cream relative",children:[e.jsx("img",{src:m.photo_url,alt:p?.label||"Batch photo",className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}),e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 bg-white/90 backdrop-blur-sm rounded-lg text-xs font-semibold",children:[p?.icon," ",p?.label]})]}),e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"text-xs text-dark-brown/60",children:new Date(m.uploaded_at).toLocaleDateString()})})]},m.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(ss,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No photos uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:g==="all"?"Upload photos to document this batch":`No ${Wt.find(m=>m.id===g)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Photo"})]})]})}const Pn={batch_created:"ðŸŽ‰",status_changed:"ðŸ”„",dispatch:"ðŸ“¤",stock_adjustment:"ðŸ“Š",qc_approved:"âœ…",test_added:"ðŸ§ª",photo_uploaded:"ðŸ“¸",ingredient_added:"ðŸŒ¿"},En={batch_created:"bg-sage/10 text-sage",status_changed:"bg-blue-500/10 text-blue-500",dispatch:"bg-accent/10 text-accent",stock_adjustment:"bg-soft-red/10 text-soft-red",qc_approved:"bg-sage/10 text-sage",test_added:"bg-purple-500/10 text-purple-500",photo_uploaded:"bg-blue-500/10 text-blue-500",ingredient_added:"bg-primary/10 text-primary"};function An({batchId:s}){const[n,c]=d.useState([]),[g,r]=d.useState(!0);d.useEffect(()=>{h()},[s]);const h=async()=>{try{const{data:u,error:m}=await C.from("batch_activity_log").select("*").eq("batch_id",s).order("created_at",{ascending:!1});if(m)throw m;c(u||[])}catch(u){console.error("Error fetching activities:",u)}finally{r(!1)}};return g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading activity log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-sage/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Yt,{className:"w-6 h-6 text-primary"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Complete Traceability Log"})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"Full audit trail of all activities and changes for this batch. Every action is logged for compliance and quality assurance."})]}),n.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-dark-brown/10"}),e.jsx("div",{className:"space-y-6",children:n.map((u,m)=>{const p=Pn[u.activity_type]||"ðŸ“",f=En[u.activity_type]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:`absolute left-4 w-8 h-8 rounded-full ${f} flex items-center justify-center text-lg z-10`,children:p}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-1",children:u.activity_description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-brown/60",children:[e.jsx(le,{className:"w-3 h-3"}),e.jsxs("span",{children:[$(new Date(u.created_at),"MMM dd, yyyy")," at"," ",$(new Date(u.created_at),"HH:mm")]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f}`,children:u.activity_type.replace("_"," ")})]}),u.details&&Object.keys(u.details).length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/5",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(u.details).map(([t,l])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1 capitalize",children:t.replace(/_/g," ")}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:typeof l=="object"?JSON.stringify(l):String(l)})]},t))})})]})]},u.id)})})]}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(Yt,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity will be logged automatically as actions are performed on this batch"})]})]})}const In=[{id:"overview",label:"Overview",icon:xt},{id:"quality",label:"Quality & Testing",icon:Ys},{id:"inventory",label:"Inventory & Distribution",icon:ne},{id:"photos",label:"Photos & Documents",icon:Ea},{id:"traceability",label:"Traceability Log",icon:Yt}];function Fn(){const{id:s}=Ye(),n=ie(),[c,g]=d.useState(null),[r,h]=d.useState("overview"),[u,m]=d.useState(!0);d.useEffect(()=>{s&&p()},[s]);const p=async()=>{try{const{data:a,error:w}=await C.from("batches").select("*, products(name, images)").eq("id",s).maybeSingle();if(w)throw w;g(a)}catch(a){console.error("Error fetching batch:",a)}finally{m(!1)}},f=async()=>{if(confirm("Are you sure you want to delete this batch? This action cannot be undone."))try{const{error:a}=await C.from("batches").delete().eq("id",s);if(a)throw a;n("/batches")}catch(a){console.error("Error deleting batch:",a),alert("Error deleting batch")}},t=()=>{if(!c)return null;const a=X(new Date(c.expiry_date),new Date);return c.status==="recalled"?{label:"Recalled",color:"bg-soft-red text-white",icon:"ðŸ›‘"}:a<0?{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"}:c.units_in_stock===0?{label:"Sold Out",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}:a<=30?{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "}:c.units_in_stock<c.batch_size*.2?{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"}:c.units_in_stock>0?{label:"In Stock",color:"bg-blue-500/10 text-blue-500",icon:"ðŸ”µ"}:{label:"Active",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"}};if(u)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading batch details..."})]})})});if(!c)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Batch not found"}),e.jsx("button",{onClick:()=>n("/batches"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Batches"})]})})});const l=t();return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/batches"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),"Back to Batches"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[c.products?.images&&c.products.images[0]&&e.jsx("img",{src:c.products.images[0],alt:c.products.name,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-mono text-3xl font-bold text-primary mb-2",children:c.batch_number}),e.jsx("p",{className:"text-lg font-semibold text-dark-brown",children:c.products?.name||"Unknown Product"}),l&&e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 mt-2 ${l.color} rounded-full text-sm font-semibold`,children:[e.jsx("span",{children:l.icon}),l.label]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Os,{className:"w-4 h-4"}),"QR Code"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Ba,{className:"w-4 h-4"}),"Print Labels"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),"Edit"]}),c.status!=="recalled"&&e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(Ca,{className:"w-4 h-4"}),"Recall"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Manufacturing Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(c.manufacturing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(c.expiry_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Units"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:c.batch_size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"In Stock"}),e.jsx("p",{className:"font-semibold text-sage",children:c.units_in_stock})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:In.map(a=>{const w=a.icon;return e.jsxs("button",{onClick:()=>h(a.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${r===a.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(w,{className:"w-5 h-5"}),a.label]},a.id)})})}),e.jsxs("div",{className:"p-6",children:[r==="overview"&&e.jsx(Cn,{batch:c,onUpdate:p}),r==="quality"&&e.jsx(Sn,{batchId:c.id,batch:c}),r==="inventory"&&e.jsx(Dn,{batchId:c.id,batch:c,onUpdate:p}),r==="photos"&&e.jsx(Mn,{batchId:c.id}),r==="traceability"&&e.jsx(An,{batchId:c.id})]})]})]})})}function Tn({vendors:s,onClose:n,onSuccess:c}){const{user:g}=H(),[r,h]=d.useState(!1),[u,m]=d.useState([]),[p,f]=d.useState(!1),[t,l]=d.useState(null),[a,w]=d.useState({ingredientId:"",purchaseDate:$(new Date,"yyyy-MM-dd"),quantity:"",expiryDate:"",lotNumber:"",vendorId:"",costPerUnit:"",invoiceNumber:"",storageLocation:"",notes:""}),[b,k]=d.useState({commonName:"",botanicalName:"",type:"herb",category:"raw_material",defaultUnit:"kg",typicalShelfLifeMonths:"24",reorderLevel:"",preferredVendorId:"",storageConditions:""});d.useEffect(()=>{_()},[]),d.useEffect(()=>{if(t){const x=t.typical_shelf_life_months||24,o=Ms(new Date(a.purchaseDate),x);w(i=>({...i,expiryDate:$(o,"yyyy-MM-dd")}))}},[t,a.purchaseDate]);const _=async()=>{try{const{data:x,error:o}=await C.from("ingredients").select("*").order("common_name");if(o)throw o;m(x||[])}catch(x){console.error("Error fetching ingredients:",x)}},y=async()=>{if(!b.commonName)return alert("Please enter ingredient name"),null;try{const{data:x,error:o}=await C.from("ingredients").insert([{common_name:b.commonName,botanical_name:b.botanicalName,type:b.type,category:b.category,default_unit:b.defaultUnit,typical_shelf_life_months:parseInt(b.typicalShelfLifeMonths),reorder_level:b.reorderLevel?parseFloat(b.reorderLevel):0,preferred_vendor_id:b.preferredVendorId||null,storage_conditions:b.storageConditions}]).select().single();if(o)throw o;return x}catch(x){return console.error("Error creating ingredient:",x),alert("Error creating ingredient"),null}},j=async x=>{x.preventDefault();let o=a.ingredientId;if(p){const i=await y();if(!i)return;o=i.id}if(!o||!a.quantity||!a.purchaseDate||!a.expiryDate){alert("Please fill in all required fields");return}h(!0);try{const i=parseFloat(a.quantity),v=t?.default_unit||b.defaultUnit,{error:N}=await C.from("ingredient_stock").insert([{ingredient_id:o,purchase_date:a.purchaseDate,expiry_date:a.expiryDate,quantity:i,original_quantity:i,unit:v,lot_number:a.lotNumber,vendor_id:a.vendorId||null,cost_per_unit:a.costPerUnit?parseFloat(a.costPerUnit):null,invoice_number:a.invoiceNumber,storage_location:a.storageLocation,status:"active",notes:a.notes,purchased_by:g?.id}]);if(N)throw N;c()}catch(i){console.error("Error adding stock:",i),alert("Error adding stock. Please try again.")}finally{h(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:p?"Add New Ingredient & Stock":"Add Ingredient Stock"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(de,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[p?e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"New Ingredient Details"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"text-sm text-dark-brown/60 hover:text-dark-brown",children:"Cancel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Common Name ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:b.commonName,onChange:x=>k({...b,commonName:x.target.value}),placeholder:"e.g., Ashwagandha Powder",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Botanical/Scientific Name"}),e.jsx("input",{type:"text",value:b.botanicalName,onChange:x=>k({...b,botanicalName:x.target.value}),placeholder:"e.g., Withania somnifera",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:b.type,onChange:x=>k({...b,type:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"herb",children:"Herb"}),e.jsx("option",{value:"oil",children:"Oil"}),e.jsx("option",{value:"powder",children:"Powder"}),e.jsx("option",{value:"extract",children:"Extract"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"fragrance",children:"Fragrance"}),e.jsx("option",{value:"active",children:"Active Ingredient"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Category ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:b.category,onChange:x=>k({...b,category:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"raw_material",children:"Raw Material"}),e.jsx("option",{value:"active_ingredient",children:"Active Ingredient"}),e.jsx("option",{value:"base",children:"Base"}),e.jsx("option",{value:"preservative",children:"Preservative"}),e.jsx("option",{value:"packaging",children:"Packaging"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Default Unit ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:b.defaultUnit,onChange:x=>k({...b,defaultUnit:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"kg",children:"kg (Kilograms)"}),e.jsx("option",{value:"g",children:"g (Grams)"}),e.jsx("option",{value:"L",children:"L (Liters)"}),e.jsx("option",{value:"ml",children:"ml (Milliliters)"}),e.jsx("option",{value:"pieces",children:"Pieces"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Typical Shelf Life (months)"}),e.jsx("input",{type:"number",value:b.typicalShelfLifeMonths,onChange:x=>k({...b,typicalShelfLifeMonths:x.target.value}),min:"1",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Reorder Level"}),e.jsx("input",{type:"number",value:b.reorderLevel,onChange:x=>k({...b,reorderLevel:x.target.value}),placeholder:"Minimum stock threshold",step:"0.01",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Preferred Vendor"}),e.jsxs("select",{value:b.preferredVendorId,onChange:x=>k({...b,preferredVendorId:x.target.value}),className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("textarea",{value:b.storageConditions,onChange:x=>k({...b,storageConditions:x.target.value}),placeholder:"e.g., Store in cool, dry place away from direct sunlight",rows:2,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Select Ingredient ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("button",{type:"button",onClick:()=>f(!0),className:"text-sm text-primary font-semibold hover:underline",children:"+ Or add new ingredient"})]}),e.jsxs("select",{value:a.ingredientId,onChange:x=>{w({...a,ingredientId:x.target.value});const o=u.find(i=>i.id===x.target.value);l(o)},required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select an ingredient"}),u.map(x=>e.jsxs("option",{value:x.id,children:[x.common_name," ",x.botanical_name&&`(${x.botanical_name})`]},x.id))]})]}),e.jsxs("div",{className:"border-t-2 border-dark-brown/5 pt-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock Purchase Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Purchase Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.purchaseDate,onChange:x=>w({...a,purchaseDate:x.target.value}),max:$(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Quantity Purchased ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:a.quantity,onChange:x=>w({...a,quantity:x.target.value}),placeholder:"Amount",step:"0.01",min:"0",required:!0,className:"flex-1 px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"}),e.jsx("div",{className:"px-4 py-3 bg-dark-brown/5 rounded-xl font-semibold text-dark-brown flex items-center",children:t?.default_unit||b.defaultUnit})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:a.expiryDate,onChange:x=>w({...a,expiryDate:x.target.value}),min:a.purchaseDate,required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Lot/Batch Number"}),e.jsx("input",{type:"text",value:a.lotNumber,onChange:x=>w({...a,lotNumber:x.target.value}),placeholder:"Supplier's lot number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Vendor ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:a.vendorId,onChange:x=>w({...a,vendorId:x.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"",children:"Select vendor"}),s.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Cost per Unit"}),e.jsx("input",{type:"number",value:a.costPerUnit,onChange:x=>w({...a,costPerUnit:x.target.value}),placeholder:"â‚¹ per unit",step:"0.01",min:"0",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Invoice Number"}),e.jsx("input",{type:"text",value:a.invoiceNumber,onChange:x=>w({...a,invoiceNumber:x.target.value}),placeholder:"Purchase invoice number",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Storage Location"}),e.jsx("input",{type:"text",value:a.storageLocation,onChange:x=>w({...a,storageLocation:x.target.value}),placeholder:"e.g., Section B, Shelf 5",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:x=>w({...a,notes:x.target.value}),placeholder:"Quality observations, storage instructions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:j,disabled:r,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:r?"Adding...":"Add to Inventory"})]})]})})}function Ln(){const[s,n]=d.useState([]),[c,g]=d.useState([]),[r,h]=d.useState([]),[u,m]=d.useState(""),[p,f]=d.useState("list"),[t,l]=d.useState("all"),[a,w]=d.useState(!1),[b,k]=d.useState({expired:0,expiring15d:0,expiring30d:0,lowStock:0,reorderNeeded:0});d.useEffect(()=>{_(),y()},[]),d.useEffect(()=>{j(),x()},[s,u,t]);const _=async()=>{try{const{data:N,error:P}=await C.from("ingredient_inventory_summary").select("*").order("common_name");if(P)throw P;n(N||[])}catch(N){console.error("Error fetching ingredients:",N)}},y=async()=>{try{const{data:N,error:P}=await C.from("vendors").select("id, name").order("name");if(P)throw P;h(N||[])}catch(N){console.error("Error fetching vendors:",N)}},j=()=>{let N=s;if(t!=="all"&&(N=N.filter(P=>P.inventory_status===t)),u){const P=u.toLowerCase();N=N.filter(L=>L.common_name?.toLowerCase().includes(P)||L.botanical_name?.toLowerCase().includes(P)||L.type?.toLowerCase().includes(P))}g(N)},x=()=>{const N=new Date,P=s.filter(B=>B.earliest_expiry?X(new Date(B.earliest_expiry),N)<0:!1).length,L=s.filter(B=>{if(!B.earliest_expiry)return!1;const W=X(new Date(B.earliest_expiry),N);return W>=0&&W<15}).length,I=s.filter(B=>{if(!B.earliest_expiry)return!1;const W=X(new Date(B.earliest_expiry),N);return W>=15&&W<30}).length,A=s.filter(B=>B.inventory_status==="low_stock").length,U=s.filter(B=>B.total_stock<B.reorder_level&&B.reorder_level>0).length;k({expired:P,expiring15d:L,expiring30d:I,lowStock:A,reorderNeeded:U})},o=N=>{if(!N)return"text-dark-brown/40";const P=X(new Date(N),new Date);return P<0||P<=15?"text-soft-red":P<=30?"text-accent":P<=60?"text-amber-500":"text-sage"},i=N=>{const P={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return P[N]||P.good_stock},v=N=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[N.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(ke,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(Z,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Ingredient Inventory"}),e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Track stock levels, expiry dates, and reorder alerts"})]}),e.jsxs(be,{onClick:()=>w(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Stock"]})]})]}),e.jsxs(be,{onClick:()=>w(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add Ingredient Stock"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx("button",{onClick:()=>l("expired"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${t==="expired"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”´"}),e.jsx("span",{className:`text-3xl font-bold ${b.expired>0?"text-soft-red":"text-primary/20"}`,children:b.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})}),e.jsx("button",{onClick:()=>l("expiring_soon"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_soon"?"ring-2 ring-soft-red shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ "}),e.jsx("span",{className:`text-3xl font-bold ${b.expiring15d>0?"text-soft-red":"text-primary/20"}`,children:b.expiring15d})]}),e.jsxs("p",{className:"text-sm font-bold text-primary/70",children:["Expiring ","<","15 days"]})]})}),e.jsx("button",{onClick:()=>l("expiring_30d"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${t==="expiring_30d"?"ring-2 ring-amber-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¡"}),e.jsx("span",{className:`text-3xl font-bold ${b.expiring30d>0?"text-amber-500":"text-primary/20"}`,children:b.expiring30d})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expiring 15-30 days"})]})}),e.jsx("button",{onClick:()=>l("low_stock"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${t==="low_stock"?"ring-2 ring-blue-500 shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”µ"}),e.jsx("span",{className:`text-3xl font-bold ${b.lowStock>0?"text-blue-500":"text-primary/20"}`,children:b.lowStock})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Low Stock"})]})}),e.jsx("button",{onClick:()=>l(b.reorderNeeded>0?"low_stock":"all"),className:"text-left",children:e.jsxs(Z,{className:`hover:shadow-glow transition-all duration-300 ${b.reorderNeeded>0?"ring-2 ring-sage shadow-glow":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŸ¢"}),e.jsx("span",{className:`text-3xl font-bold ${b.reorderNeeded>0?"text-sage":"text-primary/20"}`,children:b.reorderNeeded})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Reorder Needed"})]})})]}),e.jsx(Z,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>l("all"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="all"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:["All (",s.length,")"]}),e.jsx("button",{onClick:()=>l("good_stock"),className:`px-4 py-2 rounded-button font-bold transition-all ${t==="good_stock"?"bg-gradient-primary text-white shadow-glow":"bg-primary/5 text-primary hover:bg-primary/10"}`,children:"Good Stock"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 lg:w-64",children:[e.jsx(Ke,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40 z-10"}),e.jsx("input",{type:"text",value:u,onChange:N=>m(N.target.value),placeholder:"Search ingredients...",className:"input-float w-full pl-12"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-primary/5 rounded-button p-1",children:[e.jsx("button",{onClick:()=>f("list"),className:`p-2 rounded-button transition-all ${p==="list"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(gt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>f("grid"),className:`p-2 rounded-button transition-all ${p==="grid"?"bg-gradient-primary text-white shadow-glow":"text-primary"}`,children:e.jsx(Us,{className:"w-5 h-5"})})]})]})]})}),p==="list"?e.jsxs(Z,{className:"overflow-hidden p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream border-b-2 border-dark-brown/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Ingredient"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Current Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Reorder Level"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Days Left"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Actions"})]})}),e.jsx("tbody",{children:c.map((N,P)=>{const L=i(N.inventory_status),I=N.earliest_expiry?X(new Date(N.earliest_expiry),new Date):null;return e.jsxs("tr",{className:`border-t border-dark-brown/5 hover:bg-cream/50 transition-colors ${N.inventory_status==="expired"?"bg-soft-red/5":N.inventory_status==="expiring_soon"?"bg-accent/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[N.image_url?e.jsx("img",{src:N.image_url,alt:N.common_name,className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:N.common_name}),N.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:N.botanical_name})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${v(N.type)}`,children:N.type})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg text-primary",children:[N.total_stock||0," ",N.default_unit]}),N.active_lots>0&&e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[N.active_lots," active lots"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[N.reorder_level||0," ",N.default_unit]})}),e.jsx("td",{className:"px-4 py-3",children:N.earliest_expiry?e.jsx("p",{className:`font-semibold ${o(N.earliest_expiry)}`,children:$(new Date(N.earliest_expiry),"MMM dd, yyyy")}):e.jsx("p",{className:"text-dark-brown/40",children:"No stock"})}),e.jsx("td",{className:"px-4 py-3",children:I!==null?e.jsx("span",{className:`font-bold ${o(N.earliest_expiry)}`,children:I>=0?`${I}d`:"Expired"}):e.jsx("span",{className:"text-dark-brown/40",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${L.color}`,children:[e.jsx("span",{className:"mr-1",children:L.icon}),L.label]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(ye,{to:`/ingredients/${N.ingredient_id}`,className:"px-4 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:"View Details"})})]},N.ingredient_id)})})]})}),c.length===0&&e.jsxs("div",{className:"text-center py-12 px-6",children:[e.jsx(ne,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No ingredients found"}),e.jsx("p",{className:"text-primary/60 mb-4 text-lg font-medium",children:u?"Try adjusting your search":"Add your first ingredient to start tracking"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(N=>{const P=i(N.inventory_status),L=N.earliest_expiry?X(new Date(N.earliest_expiry),new Date):null;return e.jsx(ye,{to:`/ingredients/${N.ingredient_id}`,className:"block",children:e.jsx(Z,{className:"hover:shadow-glow transition-all duration-300 h-full",children:e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[N.image_url?e.jsx("img",{src:N.image_url,alt:N.common_name,className:"w-16 h-16 rounded-lg object-cover"}):e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:N.common_name}),N.botanical_name&&e.jsx("p",{className:"text-xs text-dark-brown/60 italic",children:N.botanical_name})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Stock"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[N.total_stock||0," ",N.default_unit]})]}),N.earliest_expiry&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry"}),e.jsxs("p",{className:`font-semibold ${o(N.earliest_expiry)}`,children:[$(new Date(N.earliest_expiry),"MMM dd, yyyy"),L!==null&&e.jsxs("span",{className:"text-xs ml-2",children:["(",L>=0?`${L}d left`:"Expired",")"]})]})]}),e.jsx("div",{children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${P.color}`,children:[e.jsx("span",{className:"mr-1",children:P.icon}),P.label]})})]})]})})},N.ingredient_id)})})]}),a&&e.jsx(Tn,{vendors:r,onClose:()=>w(!1),onSuccess:()=>{w(!1),_()}})]})}function $n({ingredientId:s,ingredient:n,summary:c}){const[g,r]=d.useState([]);d.useEffect(()=>{h()},[s]);const h=async()=>{try{const{data:p,error:f}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).eq("status","active").order("expiry_date",{ascending:!0});if(f)throw f;r(p||[])}catch(p){console.error("Error fetching lots:",p)}},u=p=>{const f=X(new Date(p),new Date);return f<0||f<=15?"text-soft-red":f<=30?"text-accent":f<=60?"text-amber-500":"text-sage"},m=n.reorder_level>0?(c?.total_stock||0)/n.reorder_level*100:100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Current Stock Status"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white/80 text-sm mb-2",children:"Total Quantity"}),e.jsx("p",{className:"text-5xl font-bold mb-1",children:c?.total_stock||0}),e.jsx("p",{className:"text-xl text-white/90",children:n.default_unit})]}),n.reorder_level>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/80 text-sm",children:"Stock Level"}),e.jsx("span",{className:"font-bold",children:m>=100?"Good":m>=50?"Low":"Critical"})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${m>=100?"bg-white":m>=50?"bg-amber-300":"bg-red-300"}`,style:{width:`${Math.min(m,100)}%`}})}),e.jsxs("p",{className:"text-white/70 text-xs mt-2",children:["Reorder level: ",n.reorder_level," ",n.default_unit]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Ingredient Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Type"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:n.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Category"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:n.category?.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Default Unit"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:n.default_unit})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Shelf Life"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[n.typical_shelf_life_months," months"]})]}),n.preferred_vendor_id&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Preferred Vendor"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:n.vendors?.name})]})]})]}),n.storage_conditions&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Storage Conditions"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:n.storage_conditions})]})]})]}),c?.earliest_expiry&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-6 h-6 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:"Expiry Alert"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:["Earliest lot expires on ",$(new Date(c.earliest_expiry),"MMMM dd, yyyy")," ","(",X(new Date(c.earliest_expiry),new Date)," days remaining)"]})]})]})}),g.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Stock by Lot/Batch"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-cream",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Lot Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Purchase Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Expiry Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold text-dark-brown",children:"Storage"})]})}),e.jsx("tbody",{children:g.map((p,f)=>{const t=X(new Date(p.expiry_date),new Date);return e.jsxs("tr",{className:`border-t border-dark-brown/5 ${f%2===0?"bg-white":"bg-cream/20"} ${t<15?"bg-soft-red/5":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-dark-brown",children:p.lot_number||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:$(new Date(p.purchase_date),"MMM dd, yyyy")}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:`font-semibold ${u(p.expiry_date)}`,children:$(new Date(p.expiry_date),"MMM dd, yyyy")}),e.jsx("p",{className:`text-xs ${u(p.expiry_date)}`,children:t>=0?`${t}d left`:"Expired"})]}),e.jsxs("td",{className:"px-4 py-3 font-bold text-primary",children:[p.quantity," ",p.unit]}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:p.vendors?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-dark-brown/70",children:p.storage_location||"-"})]},p.id)})})]})})]})]})}function qn({ingredientId:s,ingredient:n}){const[c,g]=d.useState([]),[r,h]=d.useState({totalPurchases:0,totalQuantity:0,totalSpent:0,avgCostPerUnit:0});d.useEffect(()=>{u()},[s]);const u=async()=>{try{const{data:p,error:f}=await C.from("ingredient_stock").select("*, vendors(name)").eq("ingredient_id",s).order("purchase_date",{ascending:!1});if(f)throw f;g(p||[]);const t=p.length,l=p.reduce((b,k)=>b+(k.original_quantity||0),0),a=p.reduce((b,k)=>b+(k.cost_per_unit||0)*(k.original_quantity||0),0),w=a/(l||1);h({totalPurchases:t,totalQuantity:l,totalSpent:a,avgCostPerUnit:w})}catch(p){console.error("Error fetching purchases:",p)}},m=p=>({active:"bg-sage/10 text-sage",used:"bg-dark-brown/10 text-dark-brown",expired:"bg-soft-red/10 text-soft-red"})[p]||"bg-dark-brown/10 text-dark-brown";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Purchases"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:r.totalPurchases})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Quantity"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:[r.totalQuantity.toFixed(2)," ",n.default_unit]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",r.totalSpent.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Avg Cost/Unit"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",r.avgCostPerUnit.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Purchase Timeline"}),c.length>0?e.jsx("div",{className:"space-y-4",children:c.map(p=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(_e,{className:"w-5 h-5 text-primary"}),e.jsx("h4",{className:"font-semibold text-dark-brown",children:$(new Date(p.purchase_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[e.jsx("span",{className:"font-semibold",children:p.vendors?.name||"Unknown Vendor"}),p.invoice_number&&e.jsxs("span",{className:"ml-2 text-dark-brown/60",children:["â€¢ Invoice: ",p.invoice_number]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${m(p.status)}`,children:p.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Quantity"}),e.jsxs("p",{className:"font-bold text-primary",children:[p.original_quantity," ",p.unit]}),p.status==="active"&&p.quantity<p.original_quantity&&e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[p.quantity," ",p.unit," remaining"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Cost/Unit"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:p.cost_per_unit?`â‚¹${p.cost_per_unit}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Total Cost"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:p.cost_per_unit?`â‚¹${(p.cost_per_unit*p.original_quantity).toFixed(2)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"text-sm text-dark-brown",children:$(new Date(p.expiry_date),"MMM dd, yyyy")})]})]}),p.lot_number&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-xs text-dark-brown/60",children:["Lot: ",e.jsx("span",{className:"font-mono text-dark-brown",children:p.lot_number})]})}),p.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:p.notes})})]},p.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ne,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No purchase history recorded"})]})]})]})}function Rn({ingredientId:s,ingredient:n}){const[c,g]=d.useState([]),[r,h]=d.useState([]),[u,m]=d.useState(0);d.useEffect(()=>{p(),f()},[s]);const p=async()=>{try{const{data:t,error:l}=await C.from("ingredient_usage").select("*, batches(batch_number), products(name)").eq("ingredient_id",s).order("usage_date",{ascending:!1});if(l)throw l;g(t||[]);const a=t.reduce((w,b)=>w+(b.quantity||0),0);m(a)}catch(t){console.error("Error fetching usage:",t)}},f=async()=>{try{const{data:t,error:l}=await C.from("product_ingredients").select("*, products(id, name, images)").eq("ingredient_name",n.common_name);if(l)throw l;h(t||[])}catch(t){console.error("Error fetching products:",t)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Used (Lifetime)"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[u.toFixed(2)," ",n.default_unit]})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Usage Instances"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:c.length})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Used in Products"}),e.jsx("p",{className:"text-3xl font-bold text-accent",children:r.length})]})]}),r.length>0&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Products Using This Ingredient"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(t=>e.jsx(ye,{to:`/products/${t.products.id}`,className:"p-4 bg-cream/50 rounded-lg hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.products.images&&t.products.images[0]?e.jsx("img",{src:t.products.images[0],alt:t.products.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(Xt,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-dark-brown",children:t.products.name}),e.jsxs("p",{className:"text-sm text-dark-brown/60",children:[t.quantity," ",t.unit," per batch"]})]})]})},t.id))})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage History"}),c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_e,{className:"w-4 h-4 text-dark-brown/60"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(new Date(t.usage_date),"MMMM dd, yyyy")})]}),e.jsxs("p",{className:"text-sm text-dark-brown/70 capitalize",children:["Used for: ",t.used_for?.replace("_"," ")]})]}),e.jsxs("span",{className:"font-bold text-primary text-lg",children:[t.quantity," ",n.default_unit]})]}),t.batches&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Batch: ",e.jsx(ye,{to:`/batches/${t.batch_id}`,className:"font-mono text-primary hover:underline",children:t.batches.batch_number})]})}),t.products&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsxs("p",{className:"text-sm text-dark-brown/60",children:["Product: ",e.jsx("span",{className:"font-semibold text-dark-brown",children:t.products.name})]})}),t.notes&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70 italic",children:t.notes})})]},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ne,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"No usage recorded yet"})]})]})]})}function Un({ingredientId:s,ingredient:n}){const[c,g]=d.useState({turnoverRate:0,wasteQuantity:0,wasteCost:0,minPrice:0,maxPrice:0,avgPrice:0,currentPrice:0,totalUsed:0,totalPurchased:0});d.useEffect(()=>{r()},[s]);const r=async()=>{try{const[m,p]=await Promise.all([C.from("ingredient_stock").select("*").eq("ingredient_id",s),C.from("ingredient_usage").select("quantity").eq("ingredient_id",s)]);if(m.error)throw m.error;if(p.error)throw p.error;const f=m.data||[],t=p.data||[],l=f.filter(v=>v.status==="expired"),a=l.reduce((v,N)=>v+(N.quantity||0),0),w=l.reduce((v,N)=>v+(N.cost_per_unit||0)*(N.quantity||0),0),b=f.map(v=>v.cost_per_unit).filter(v=>v>0),k=b.length>0?Math.min(...b):0,_=b.length>0?Math.max(...b):0,y=b.length>0?b.reduce((v,N)=>v+N,0)/b.length:0,j=f.filter(v=>v.cost_per_unit>0).sort((v,N)=>new Date(N.purchase_date).getTime()-new Date(v.purchase_date).getTime()),x=j.length>0?j[0].cost_per_unit:0,o=t.reduce((v,N)=>v+(N.quantity||0),0),i=f.reduce((v,N)=>v+(N.original_quantity||0),0);g({turnoverRate:i>0?o/i*100:0,wasteQuantity:a,wasteCost:w,minPrice:k,maxPrice:_,avgPrice:y,currentPrice:x,totalUsed:o,totalPurchased:i})}catch(m){console.error("Error fetching analytics:",m)}},h=c.totalPurchased>0?c.wasteQuantity/c.totalPurchased*100:0,u=c.avgPrice>0?(c.currentPrice-c.avgPrice)/c.avgPrice*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Turnover Rate"}),e.jsx(te,{className:"w-5 h-5 text-primary"})]}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[c.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Usage efficiency"})]}),e.jsxs("div",{className:"bg-soft-red/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Quantity"}),e.jsx(ue,{className:"w-5 h-5 text-soft-red"})]}),e.jsxs("p",{className:"text-3xl font-bold text-soft-red",children:[c.wasteQuantity.toFixed(2)," ",n.default_unit]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:[h.toFixed(1),"% of total purchased"]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm",children:"Waste Cost"}),e.jsx($e,{className:"w-5 h-5 text-accent"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",c.wasteCost.toFixed(0)]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Lost value from expiry"})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Minimum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-sage",children:["â‚¹",c.minPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Maximum Price Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-soft-red",children:["â‚¹",c.maxPrice.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Average Price"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",c.avgPrice.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Current Price vs Average"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-2xl font-bold ${u>0?"text-soft-red":"text-sage"}`,children:[u>0?"+":"",u.toFixed(1),"%"]}),u>0?e.jsx(te,{className:"w-5 h-5 text-soft-red"}):e.jsx(je,{className:"w-5 h-5 text-sage"})]}),e.jsxs("p",{className:"text-xs text-dark-brown/60 mt-1",children:["â‚¹",c.currentPrice.toFixed(2)," per unit"]})]})]})]})]}),h>10&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Waste Reduction Recommendations"}),e.jsxs("ul",{className:"space-y-2 text-sm text-dark-brown/70",children:[e.jsx("li",{children:"â€¢ Consider reducing purchase quantities to match usage rate"}),e.jsx("li",{children:"â€¢ Implement FIFO (First In, First Out) more strictly"}),e.jsx("li",{children:"â€¢ Review storage conditions to extend shelf life"}),e.jsxs("li",{children:["â€¢ Adjust reorder level to: ",(c.totalUsed/6).toFixed(2)," ",n.default_unit," (based on 6-month usage)"]})]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Usage Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Purchased"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:c.totalPurchased.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:n.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Total Used"}),e.jsx("p",{className:"text-3xl font-bold text-sage",children:c.totalUsed.toFixed(2)}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:n.default_unit})]}),e.jsxs("div",{className:"p-4 bg-cream/50 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-2",children:"Utilization Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:[c.turnoverRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-dark-brown/60 mt-1",children:"Used vs Purchased"})]})]})]})]})}const it=[{id:"coa",label:"Quality Certificates (COA)",icon:Qe},{id:"organic_cert",label:"Organic Certifications",icon:Qe},{id:"test_report",label:"Test Reports",icon:Xt},{id:"msds",label:"MSDS (Safety Data Sheets)",icon:xe},{id:"specification",label:"Vendor Specifications",icon:se},{id:"photo",label:"Ingredient Photos",icon:$s}];function zn({ingredientId:s}){const[n,c]=d.useState([]),[g,r]=d.useState("all");d.useEffect(()=>{h()},[s]);const h=async()=>{try{const{data:t,error:l}=await C.from("ingredient_documents").select("*").eq("ingredient_id",s).order("uploaded_at",{ascending:!1});if(l)throw l;c(t||[])}catch(t){console.error("Error fetching documents:",t)}},u=g==="all"?n:n.filter(t=>t.category===g),m=t=>{const l=it.find(a=>a.id===t);return l?l.icon:se},p=t=>t?X(new Date(t),new Date)<=30:!1,f=t=>t?X(new Date(t),new Date)<0:!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>r("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All Documents (",n.length,")"]}),it.map(t=>{const l=n.filter(a=>a.category===t.id).length;return e.jsxs("button",{onClick:()=>r(t.id),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g===t.id?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[t.label.split(" ")[0]," (",l,")"]},t.id)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(Q,{className:"w-4 h-4"}),"Upload Document"]})]}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:u.map(t=>{const l=m(t.category),a=it.find(w=>w.id===t.category);return e.jsx("div",{className:`bg-white border-2 rounded-xl p-4 hover:shadow-soft transition-all ${f(t.expiry_date)?"border-soft-red/20 bg-soft-red/5":p(t.expiry_date)?"border-accent/20 bg-accent/5":"border-dark-brown/5"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(l,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:t.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:a?.label})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg font-semibold transition-colors text-sm",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Download"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:[e.jsxs("span",{children:["Uploaded: ",$(new Date(t.uploaded_at),"MMM dd, yyyy")]}),t.expiry_date&&e.jsx("span",{className:`font-semibold ${f(t.expiry_date)?"text-soft-red":p(t.expiry_date)?"text-accent":"text-dark-brown"}`,children:f(t.expiry_date)?e.jsxs(e.Fragment,{children:["Expired: ",$(new Date(t.expiry_date),"MMM dd, yyyy")]}):e.jsxs(e.Fragment,{children:["Expires: ",$(new Date(t.expiry_date),"MMM dd, yyyy")]})})]}),(f(t.expiry_date)||p(t.expiry_date))&&e.jsxs("div",{className:`mt-2 flex items-center gap-2 text-sm font-semibold ${f(t.expiry_date)?"text-soft-red":"text-accent"}`,children:[e.jsx(xe,{className:"w-4 h-4"}),f(t.expiry_date)?e.jsx("span",{children:"Certificate expired - renewal required"}):e.jsxs("span",{children:["Expiring in ",X(new Date(t.expiry_date),new Date)," days"]})]})]})]})},t.id)})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(se,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:g==="all"?"Upload quality certificates, test reports, and other documents":`No ${it.find(t=>t.id===g)?.label.toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),n.some(t=>f(t.expiry_date)||p(t.expiry_date))&&e.jsx("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(xe,{className:"w-6 h-6 text-accent flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Certificate Expiry Alerts"}),e.jsx("p",{className:"text-sm text-dark-brown/70 mb-3",children:"Some certificates are expired or expiring soon. Ensure you have updated certifications."}),e.jsx("ul",{className:"space-y-1 text-sm text-dark-brown/70",children:n.filter(t=>f(t.expiry_date)||p(t.expiry_date)).map(t=>e.jsxs("li",{children:["â€¢ ",t.file_name," - ",f(t.expiry_date)?"Expired":"Expiring soon"]},t.id))})]})]})}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:it.map(t=>{const l=t.icon,a=n.filter(w=>w.category===t.id).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(l,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:t.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[a," document",a!==1?"s":""]})]})]},t.id)})})]})]})}const Bn=[{id:"overview",label:"Overview & Stock",icon:xt},{id:"purchase",label:"Purchase History",icon:ne},{id:"usage",label:"Usage in Products",icon:Xt},{id:"analytics",label:"Analytics",icon:te},{id:"documents",label:"Documents",icon:se}];function On(){const{id:s}=Ye(),n=ie(),[c,g]=d.useState(null),[r,h]=d.useState(null),[u,m]=d.useState("overview"),[p,f]=d.useState(!0);d.useEffect(()=>{s&&(t(),l())},[s]);const t=async()=>{try{const{data:y,error:j}=await C.from("ingredients").select("*, vendors(name)").eq("id",s).maybeSingle();if(j)throw j;g(y)}catch(y){console.error("Error fetching ingredient:",y)}finally{f(!1)}},l=async()=>{try{const{data:y,error:j}=await C.from("ingredient_inventory_summary").select("*").eq("ingredient_id",s).maybeSingle();if(j)throw j;h(y)}catch(y){console.error("Error fetching summary:",y)}},a=async()=>{if(confirm("Are you sure you want to delete this ingredient? This action cannot be undone."))try{const{error:y}=await C.from("ingredients").delete().eq("id",s);if(y)throw y;n("/ingredients")}catch(y){console.error("Error deleting ingredient:",y),alert("Error deleting ingredient")}},w=()=>{if(!r)return null;const y={good_stock:{label:"Good Stock",color:"bg-sage/10 text-sage",icon:"ðŸŸ¢"},low_stock:{label:"Low Stock",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:"ðŸŸ "},expiring_30d:{label:"Expiring <30d",color:"bg-amber-500/10 text-amber-500",icon:"ðŸŸ¡"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:"ðŸ”´"},out_of_stock:{label:"Out of Stock",color:"bg-dark-brown/10 text-dark-brown",icon:"âš«"}};return y[r.inventory_status]||y.good_stock},b=y=>({herb:"bg-sage/10 text-sage",oil:"bg-amber-500/10 text-amber-500",powder:"bg-primary/10 text-primary",extract:"bg-accent/10 text-accent",base:"bg-blue-500/10 text-blue-500",preservative:"bg-purple-500/10 text-purple-500",fragrance:"bg-pink-500/10 text-pink-500",active:"bg-primary/10 text-primary"})[y?.toLowerCase()]||"bg-dark-brown/10 text-dark-brown";if(p)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading ingredient details..."})]})})});if(!c)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"Ingredient not found"}),e.jsx("button",{onClick:()=>n("/ingredients"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Ingredients"})]})})});const k=w(),_=r?.earliest_expiry?X(new Date(r.earliest_expiry),new Date):null;return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/ingredients"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),"Back to Ingredients"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[c.image_url?e.jsx("img",{src:c.image_url,alt:c.common_name,className:"w-20 h-20 rounded-lg object-cover"}):e.jsx("div",{className:"w-20 h-20 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-10 h-10 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:c.common_name}),c.botanical_name&&e.jsx("p",{className:"text-lg italic text-dark-brown/70 mb-2",children:c.botanical_name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold capitalize ${b(c.type)}`,children:c.type}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-dark-brown/5 text-dark-brown capitalize",children:c.category?.replace("_"," ")}),k&&e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${k.color}`,children:[e.jsx("span",{className:"mr-1",children:k.icon}),k.label]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Stock"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Total Stock"}),e.jsxs("p",{className:"font-bold text-2xl text-sage",children:[r?.total_stock||0," ",c.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Reorder Level"}),e.jsxs("p",{className:"font-semibold text-dark-brown",children:[c.reorder_level||0," ",c.default_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Active Lots"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:r?.active_lots||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold ${_===null?"text-dark-brown/40":_<0||_<=15?"text-soft-red":_<=30?"text-accent":"text-sage"}`,children:_!==null?_>=0?`${_} days`:"Expired":"No stock"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:Bn.map(y=>{const j=y.icon;return e.jsxs("button",{onClick:()=>m(y.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${u===y.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(j,{className:"w-5 h-5"}),y.label]},y.id)})})}),e.jsxs("div",{className:"p-6",children:[u==="overview"&&e.jsx($n,{ingredientId:s,ingredient:c,summary:r,onUpdate:()=>{t(),l()}}),u==="purchase"&&e.jsx(qn,{ingredientId:s,ingredient:c}),u==="usage"&&e.jsx(Rn,{ingredientId:s,ingredient:c}),u==="analytics"&&e.jsx(Un,{ingredientId:s,ingredient:c}),u==="documents"&&e.jsx(zn,{ingredientId:s})]})]})]})})}const Vn=[{value:"fssai",label:"FSSAI License"},{value:"ayush",label:"Ayush License"},{value:"gmp",label:"GMP Certification"},{value:"trade",label:"Trade License"},{value:"gst",label:"GST Registration"},{value:"organic",label:"Organic Certification"},{value:"pollution",label:"Pollution Control"},{value:"fire",label:"Fire Safety Certificate"},{value:"drug",label:"Drug License"},{value:"other",label:"Other"}];function Hn({onClose:s,onSuccess:n}){const{user:c}=H(),[g,r]=d.useState(!1),[h,u]=d.useState(!1),[m,p]=d.useState({licenseType:"fssai",licenseNumber:"",issuedTo:"",issuingAuthority:"",issueDate:"",expiryDate:"",renewalReminderDays:"30",scope:"",status:"active",notes:"",reminderEmail:!0,reminderPush:!0}),f=async t=>{if(t.preventDefault(),!m.licenseNumber||!m.issuedTo||!m.issuingAuthority||!m.issueDate){alert("Please fill in all required fields");return}if(!h&&!m.expiryDate){alert('Please provide an expiry date or check "No Expiry"');return}r(!0);try{const{error:l}=await C.from("licenses").insert([{license_type:m.licenseType,license_number:m.licenseNumber,issued_to:m.issuedTo,issuing_authority:m.issuingAuthority,issue_date:m.issueDate,expiry_date:h?null:m.expiryDate,renewal_reminder_days:parseInt(m.renewalReminderDays),scope:m.scope,status:m.status,notes:m.notes,reminder_email:m.reminderEmail,reminder_push:m.reminderPush,created_by:c?.id}]);if(l)throw l;n()}catch(l){console.error("Error adding license:",l),alert("Error adding license. Please try again.")}finally{r(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-primary/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-3xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b-2 border-dark-brown/5 px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-primary",children:"Add License/Certificate"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors",children:e.jsx(de,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:f,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License Type ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("select",{value:m.licenseType,onChange:t=>p({...m,licenseType:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:Vn.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["License/Certificate Number ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:m.licenseNumber,onChange:t=>p({...m,licenseNumber:t.target.value}),placeholder:"e.g., 12345678901234",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none font-mono"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issued To ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:m.issuedTo,onChange:t=>p({...m,issuedTo:t.target.value}),placeholder:"Business name",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issuing Authority ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"text",value:m.issuingAuthority,onChange:t=>p({...m,issuingAuthority:t.target.value}),placeholder:"e.g., FSSAI, State Ayush Department",required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Issue Date ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsx("input",{type:"date",value:m.issueDate,onChange:t=>p({...m,issueDate:t.target.value}),max:$(new Date,"yyyy-MM-dd"),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown",children:["Expiry Date ",!h&&e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:t=>{u(t.target.checked),t.target.checked&&p({...m,expiryDate:""})},className:"w-4 h-4 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-xs text-dark-brown/70",children:"No Expiry"})]})]}),e.jsx("input",{type:"date",value:m.expiryDate,onChange:t=>p({...m,expiryDate:t.target.value}),min:m.issueDate,required:!h,disabled:h,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none disabled:bg-dark-brown/5 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Renewal Reminder (days before expiry)"}),e.jsx("input",{type:"number",value:m.renewalReminderDays,onChange:t=>p({...m,renewalReminderDays:t.target.value}),min:"1",max:"365",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:["Status ",e.jsx("span",{className:"text-soft-red",children:"*"})]}),e.jsxs("select",{value:m.status,onChange:t=>p({...m,status:t.target.value}),required:!0,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending Application"}),e.jsx("option",{value:"renewal_in_process",children:"Renewal In Process"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Scope/Coverage"}),e.jsx("textarea",{value:m.scope,onChange:t=>p({...m,scope:t.target.value}),placeholder:"What this license covers (e.g., Manufacturing of Ayurvedic products)",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("textarea",{value:m.notes,onChange:t=>p({...m,notes:t.target.value}),placeholder:"Important information, conditions, etc.",rows:3,className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none resize-none"})]}),e.jsxs("div",{className:"md:col-span-2 bg-cream/50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.reminderEmail,onChange:t=>p({...m,reminderEmail:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email reminder"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.reminderPush,onChange:t=>p({...m,reminderPush:t.target.checked}),className:"w-5 h-5 rounded border-dark-brown/20 text-primary focus:ring-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push notification"})]})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-cream/90 backdrop-blur-sm border-t-2 border-dark-brown/5 px-6 py-4 rounded-b-2xl flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 bg-white border-2 border-dark-brown/10 text-dark-brown font-semibold rounded-xl hover:bg-dark-brown/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:g,className:"flex-1 px-6 py-3 bg-gradient-to-r from-sage to-primary text-white font-semibold rounded-xl hover:shadow-soft-lg transition-all disabled:opacity-50",children:g?"Adding...":"Add License"})]})]})})}const Cs={fssai:{label:"FSSAI License",icon:"ðŸ´",color:"from-blue-500 to-blue-600"},ayush:{label:"Ayush License",icon:"ðŸŒ¿",color:"from-sage to-primary"},gmp:{label:"GMP Certification",icon:"âœ“",color:"from-primary to-accent"},trade:{label:"Trade License",icon:"ðŸª",color:"from-amber-500 to-amber-600"},gst:{label:"GST Registration",icon:"ðŸ’¼",color:"from-purple-500 to-purple-600"},organic:{label:"Organic Certification",icon:"ðŸŒ±",color:"from-green-500 to-green-600"},pollution:{label:"Pollution Control",icon:"ðŸ­",color:"from-teal-500 to-teal-600"},fire:{label:"Fire Safety",icon:"ðŸ”¥",color:"from-red-500 to-red-600"},drug:{label:"Drug License",icon:"ðŸ’Š",color:"from-pink-500 to-pink-600"},other:{label:"Other License",icon:"ðŸ“„",color:"from-dark-brown to-primary"}};function Wn(){const[s,n]=d.useState([]),[c,g]=d.useState(!1),[r,h]=d.useState({total:0,active:0,expiringSoon:0,expired:0,complianceScore:100});d.useEffect(()=>{u()},[]),d.useEffect(()=>{m()},[s]);const u=async()=>{try{const{data:a,error:w}=await C.from("license_summary").select("*").order("expiry_date",{ascending:!0,nullsFirst:!1});if(w)throw w;n(a||[])}catch(a){console.error("Error fetching licenses:",a)}},m=()=>{const a=s.length,w=s.filter(y=>y.expiry_status==="active"||y.expiry_status==="no_expiry").length,b=s.filter(y=>y.expiry_status==="expiring_soon"||y.expiry_status==="renewal_due"||y.expiry_status==="critical").length,k=s.filter(y=>y.expiry_status==="expired").length,_=a>0?Math.round((w+b)/a*100):100;h({total:a,active:w,expiringSoon:b,expired:k,complianceScore:_})},p=(a,w)=>{const b={active:{label:"Active",color:"bg-sage/10 text-sage",icon:G},renewal_due:{label:"Renewal Due",color:"bg-amber-500/10 text-amber-500",icon:le},expiring_soon:{label:"Expiring Soon",color:"bg-accent/10 text-accent",icon:xe},critical:{label:"Critical",color:"bg-soft-red/10 text-soft-red",icon:xe},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red",icon:xe},no_expiry:{label:"No Expiry",color:"bg-blue-500/10 text-blue-500",icon:G}};return b[a]||b.active},f=()=>r.complianceScore===100?"text-sage":r.complianceScore>=80?"text-amber-500":"text-soft-red",t=()=>r.complianceScore===100?{label:"All Compliant",icon:"ðŸŸ¢"}:r.complianceScore>=80?{label:"Needs Attention",icon:"ðŸŸ¡"}:{label:"Critical Issues",icon:"ðŸ”´"},l=a=>Cs[a]||Cs.other;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(ke,{}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[e.jsxs(Z,{className:"mb-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-5"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-4xl md:text-5xl font-bold text-gradient mb-2",children:"Compliance & Certifications"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 md:gap-4",children:[e.jsx("p",{className:"text-primary/70 text-lg font-medium",children:"Manage licenses and certifications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-primary/60 font-medium",children:"Status:"}),e.jsxs("span",{className:`font-bold text-lg ${f()}`,children:[t().icon," ",t().label," (",r.complianceScore,"%)"]})]})]})]}),e.jsxs(be,{onClick:()=>g(!0),variant:"primary",size:"lg",className:"hidden md:flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add License"]})]})]}),e.jsxs(be,{onClick:()=>g(!0),variant:"primary",size:"lg",className:"md:hidden w-full mb-6 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Add License/Certificate"]}),r.expiringSoon>0&&e.jsx(Z,{className:"bg-accent/10 border-2 border-accent/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-6 h-6 text-accent flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-primary",children:[r.expiringSoon," license",r.expiringSoon!==1?"s":""," expiring in next 90 days - Review required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Initiate renewal process to maintain compliance"})]})]})}),r.expired>0&&e.jsx(Z,{className:"bg-soft-red/10 border-2 border-soft-red/20 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-6 h-6 text-soft-red flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-soft-red",children:[r.expired," license",r.expired!==1?"s have":" has"," expired - Immediate action required"]}),e.jsx("p",{className:"text-sm text-primary/70 mt-1 font-medium",children:"Operating without valid licenses may result in penalties and business disruption"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-button",children:e.jsx(pt,{className:"w-6 h-6 text-primary"})}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:r.total})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Total Licenses"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-sage/20 rounded-button",children:e.jsx(G,{className:"w-6 h-6 text-sage"})}),e.jsx("span",{className:"text-3xl font-bold text-sage",children:r.active})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Active & Valid"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-button",children:e.jsx(le,{className:"w-6 h-6 text-accent"})}),e.jsx("span",{className:"text-3xl font-bold text-accent",children:r.expiringSoon})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Renewal Due Soon"})]}),e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-3 bg-soft-red/20 rounded-button",children:e.jsx(xe,{className:"w-6 h-6 text-soft-red"})}),e.jsx("span",{className:"text-3xl font-bold text-soft-red",children:r.expired})]}),e.jsx("p",{className:"text-sm font-bold text-primary/70",children:"Expired"})]})]}),s.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(a=>{const w=l(a.license_type),b=p(a.expiry_status,a.days_until_expiry),k=b.icon,_=a.total_checklist_items>0?Math.round(a.completed_checklist_items/a.total_checklist_items*100):100;return e.jsx(ye,{to:`/compliance/${a.id}`,className:"block",children:e.jsxs(Z,{className:"hover:shadow-glow transition-all duration-300 overflow-hidden p-0",children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${w.color}`}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-4xl",children:w.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:w.label}),e.jsx("p",{className:"text-xs text-dark-brown/60 font-mono",children:a.license_number})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Issued by:"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:a.issuing_authority})]}),a.expiry_date&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Expiry:"}),e.jsx("span",{className:`text-sm font-semibold ${a.expiry_status==="expired"||a.expiry_status==="critical"?"text-soft-red":a.expiry_status==="expiring_soon"?"text-accent":a.expiry_status==="renewal_due"?"text-amber-500":"text-sage"}`,children:$(new Date(a.expiry_date),"MMM dd, yyyy")})]}),a.days_until_expiry!==null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Days remaining:"}),e.jsx("span",{className:`text-lg font-bold ${a.days_until_expiry<0||a.days_until_expiry<=7?"text-soft-red":a.days_until_expiry<=30?"text-accent":a.days_until_expiry<=90?"text-amber-500":"text-sage"}`,children:a.days_until_expiry>=0?a.days_until_expiry:"Expired"})]})]}),a.total_checklist_items>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-dark-brown/60",children:"Compliance:"}),e.jsxs("span",{className:"text-sm font-semibold text-dark-brown",children:[_,"%"]})]}),e.jsx("div",{className:"w-full bg-dark-brown/10 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${_===100?"bg-sage":_>=80?"bg-amber-500":"bg-soft-red"}`,style:{width:`${_}%`}})})]})]}),e.jsx("div",{className:"pt-3 border-t border-dark-brown/10",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${b.color}`,children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-bold",children:b.label})]})})]})]})},a.id)})}):e.jsxs(Z,{className:"p-16 text-center",children:[e.jsx(se,{className:"w-20 h-20 text-primary/20 mx-auto mb-6"}),e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-3",children:"No licenses recorded yet"}),e.jsx("p",{className:"text-primary/60 mb-6 text-lg font-medium",children:"Add your business licenses and certifications to track compliance"}),e.jsx(be,{onClick:()=>g(!0),variant:"primary",size:"lg",children:"Add First License"})]})]}),c&&e.jsx(Hn,{onClose:()=>g(!1),onSuccess:()=>{g(!1),u()}})]})}function Qn({license:s}){const n=s.expiry_date?X(new Date(s.expiry_date),new Date):null,c=s.expiry_date?new Date(new Date(s.expiry_date).getTime()-s.renewal_reminder_days*24*60*60*1e3):null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"License Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issued To"}),e.jsx("p",{className:"font-semibold text-lg",children:s.issued_to})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"License Number"}),e.jsx("p",{className:"font-semibold text-lg font-mono",children:s.license_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold",children:s.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold",children:$(new Date(s.issue_date),"MMMM dd, yyyy")})]})]})]}),s.expiry_date&&e.jsx("div",{className:`rounded-xl p-6 ${n&&n<0?"bg-soft-red/10 border-2 border-soft-red/20":n&&n<=30?"bg-accent/10 border-2 border-accent/20":n&&n<=90?"bg-amber-500/10 border-2 border-amber-500/20":"bg-sage/10 border-2 border-sage/20"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${n&&n<0?"bg-soft-red/20":n&&n<=30?"bg-accent/20":n&&n<=90?"bg-amber-500/20":"bg-sage/20"}`,children:e.jsx(_e,{className:`w-8 h-8 ${n&&n<0?"text-soft-red":n&&n<=30?"text-accent":n&&n<=90?"text-amber-500":"text-sage"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:n&&n<0?"License Expired":n&&n<=7?"License Expiring This Week":n&&n<=30?"License Expiring This Month":"License Renewal Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Expiry Date:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(new Date(s.expiry_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Days Until Expiry:"}),e.jsx("span",{className:`font-bold text-2xl ${n&&n<0?"text-soft-red":n&&n<=30?"text-accent":n&&n<=90?"text-amber-500":"text-sage"}`,children:n&&n>=0?n:"Expired"})]}),c&&n&&n>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-dark-brown/10",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Renewal Due By:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(c,"MMMM dd, yyyy")})]})]})]})]})}),s.scope&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Scope & Coverage"}),e.jsx("p",{className:"text-dark-brown/70",children:s.scope})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-4",children:"Reminder Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Email Reminders"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_email?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_email?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Push Notifications"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.reminder_push?"bg-sage/10 text-sage":"bg-dark-brown/10 text-dark-brown"}`,children:s.reminder_push?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Reminder Period"})]}),e.jsxs("span",{className:"font-semibold text-dark-brown",children:[s.renewal_reminder_days," days before expiry"]})]})]})]}),s.notes&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Notes"}),e.jsx("p",{className:"text-dark-brown/70 whitespace-pre-wrap",children:s.notes})]})]})}),s.last_inspection_date&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Inspection Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Last Inspection:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:$(new Date(s.last_inspection_date),"MMMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-dark-brown/70",children:"Total Inspections:"}),e.jsx("span",{className:"font-semibold text-dark-brown",children:s.inspection_count})]})]})]})]})}const Qt=[{value:"original",label:"Original License/Certificate"},{value:"renewal",label:"Renewal Documents"},{value:"application",label:"Application Forms"},{value:"receipt",label:"Payment Receipts"},{value:"correspondence",label:"Correspondence"},{value:"inspection",label:"Inspection Reports"},{value:"compliance",label:"Compliance Certificates"}];function Gn({licenseId:s}){const[n,c]=d.useState([]),[g,r]=d.useState("all");d.useEffect(()=>{h()},[s]);const h=async()=>{try{const{data:f,error:t}=await C.from("license_documents").select("*").eq("license_id",s).order("uploaded_at",{ascending:!1});if(t)throw t;c(f||[])}catch(f){console.error("Error fetching documents:",f)}},u=g==="all"?n:n.filter(f=>f.category===g),m=f=>{const t=Qt.find(l=>l.value===f);return t?t.label:f},p=f=>e.jsx(se,{className:"w-6 h-6 text-primary"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>r("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g==="all"?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:["All (",n.length,")"]}),Qt.map(f=>{const t=n.filter(l=>l.category===f.value).length;return t===0?null:e.jsxs("button",{onClick:()=>r(f.value),className:`px-4 py-2 rounded-lg font-semibold transition-all whitespace-nowrap ${g===f.value?"bg-primary text-white":"bg-dark-brown/5 text-dark-brown hover:bg-dark-brown/10"}`,children:[f.label.split(" ")[0]," (",t,")"]},f.value)})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all whitespace-nowrap",children:[e.jsx(Q,{className:"w-4 h-4"}),"Upload Document"]})]}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:u.map(f=>e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-4 hover:shadow-soft transition-all",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:p(f.category)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-dark-brown truncate",children:f.file_name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:m(f.category)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 bg-soft-red/10 hover:bg-soft-red/20 text-soft-red rounded-lg transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-dark-brown/60",children:e.jsxs("span",{children:["Uploaded: ",$(new Date(f.uploaded_at),"MMM dd, yyyy")]})})]})]})},f.id))}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(se,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No documents uploaded"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:g==="all"?"Upload license documents, receipts, and correspondence":`No ${m(g).toLowerCase()} uploaded yet`}),e.jsx("button",{className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Upload First Document"})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-3",children:"Document Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Qt.map(f=>{const t=n.filter(l=>l.category===f.value).length;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg",children:[e.jsx(se,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:f.label}),e.jsxs("p",{className:"text-xs text-dark-brown/60",children:[t," document",t!==1?"s":""]})]})]},f.value)})})]})]})}const Yn={fssai:["Display license at prominent location","Maintain hygiene standards","Source ingredients from licensed suppliers","Label products correctly (FSSAI logo, license number)","Maintain manufacturing records","Annual returns filed"],ayush:["Follow GMP guidelines","Use only approved ingredients","Maintain batch records","Quality control testing","Proper labeling (Ayush logo)"],gmp:["Maintain clean facility","Follow SOP (Standard Operating Procedures)","Staff training records","Equipment calibration","Documented processes"]};function Kn({licenseId:s,license:n,onUpdate:c}){const{user:g}=H(),[r,h]=d.useState([]),[u,m]=d.useState(!1),[p,f]=d.useState("");d.useEffect(()=>{t()},[s]);const t=async()=>{try{const{data:y,error:j}=await C.from("compliance_checklist").select("*").eq("license_id",s).order("created_at",{ascending:!0});if(j)throw j;if(!y||y.length===0){const x=Yn[n.license_type]||[];x.length>0&&await l(x)}else h(y)}catch(y){console.error("Error fetching checklist:",y)}},l=async y=>{try{const j=y.map(i=>({license_id:s,checklist_item:i,completed:!1})),{data:x,error:o}=await C.from("compliance_checklist").insert(j).select();if(o)throw o;h(x||[])}catch(j){console.error("Error initializing checklist:",j)}},a=async(y,j)=>{try{const{error:x}=await C.from("compliance_checklist").update({completed:!j,last_verified_date:j?null:new Date().toISOString().split("T")[0],verified_by:j?null:g?.id}).eq("id",y);if(x)throw x;await t(),c()}catch(x){console.error("Error updating checklist:",x)}},w=async()=>{if(p.trim())try{const{error:y}=await C.from("compliance_checklist").insert([{license_id:s,checklist_item:p,completed:!1}]);if(y)throw y;f(""),m(!1),await t(),c()}catch(y){console.error("Error adding checklist item:",y)}},b=r.filter(y=>y.completed).length,k=r.length,_=k>0?Math.round(b/k*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-sage rounded-xl p-6 text-white",children:[e.jsx("h3",{className:"font-heading text-lg font-bold mb-4",children:"Compliance Score"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-5xl font-bold mb-2",children:[_,"%"]}),e.jsxs("p",{className:"text-white/80",children:[b," of ",k," items completed"]})]}),e.jsxs("div",{className:"w-32 h-32 relative",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"rgba(255,255,255,0.2)",strokeWidth:"12",fill:"none"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"white",strokeWidth:"12",fill:"none",strokeDasharray:`${_/100*351.86} 351.86`,strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(G,{className:"w-12 h-12 text-white"})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary",children:"Compliance Requirements"}),e.jsxs("button",{onClick:()=>m(!u),className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-lg font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Item"]})]}),u&&e.jsxs("div",{className:"bg-cream/50 rounded-xl p-4",children:[e.jsx("input",{type:"text",value:p,onChange:y=>f(y.target.value),placeholder:"Enter new compliance requirement...",className:"w-full px-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-accent focus:outline-none mb-3",onKeyDown:y=>{y.key==="Enter"&&w()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:w,className:"px-4 py-2 bg-primary text-white rounded-lg font-semibold hover:bg-primary/90 transition-colors",children:"Add"}),e.jsx("button",{onClick:()=>{m(!1),f("")},className:"px-4 py-2 bg-dark-brown/10 text-dark-brown rounded-lg font-semibold hover:bg-dark-brown/20 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-3",children:r.map(y=>e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${y.completed?"bg-sage/5 border-sage/20":"bg-white border-dark-brown/10"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>a(y.id,y.completed),className:"flex-shrink-0 mt-1",children:y.completed?e.jsx(G,{className:"w-6 h-6 text-sage"}):e.jsx(Pa,{className:"w-6 h-6 text-dark-brown/30 hover:text-primary transition-colors"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold ${y.completed?"text-sage line-through":"text-dark-brown"}`,children:y.checklist_item}),y.completed&&y.last_verified_date&&e.jsxs("p",{className:"text-sm text-dark-brown/60 mt-1",children:["Verified on ",$(new Date(y.last_verified_date),"MMM dd, yyyy")]}),y.notes&&e.jsx("p",{className:"text-sm text-dark-brown/70 mt-2 italic",children:y.notes}),y.proof_url&&e.jsxs("button",{className:"flex items-center gap-2 mt-2 text-sm text-primary hover:underline",children:[e.jsx(Ue,{className:"w-4 h-4"}),"View proof"]})]})]})},y.id))}),r.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(G,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No compliance requirements added"}),e.jsx("p",{className:"text-dark-brown/40 mb-4",children:"Add compliance requirements specific to this license"}),e.jsx("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all",children:"Add First Requirement"})]}),_<100&&r.length>0&&e.jsxs("div",{className:"bg-accent/10 border-2 border-accent/20 rounded-xl p-6",children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Pending Items"}),e.jsxs("p",{className:"text-sm text-dark-brown/70",children:[k-b," compliance requirement",k-b!==1?"s":""," still need",k-b===1?"s":""," to be completed to achieve 100% compliance."]})]}),_===100&&r.length>0&&e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"w-8 h-8 text-sage"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sage text-lg",children:"100% Compliant"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"All compliance requirements have been met"})]})]})})]})}function Jn({licenseId:s}){const[n,c]=d.useState([]),[g,r]=d.useState({totalRenewals:0,totalCost:0,avgCost:0,lastRenewalCost:0});d.useEffect(()=>{h()},[s]);const h=async()=>{try{const{data:u,error:m}=await C.from("license_renewals").select("*").eq("license_id",s).order("renewal_date",{ascending:!1});if(m)throw m;if(c(u||[]),u&&u.length>0){const p=u.length,f=u.reduce((a,w)=>a+(w.cost||0),0),t=f/p,l=u[0].cost||0;r({totalRenewals:p,totalCost:f,avgCost:t,lastRenewalCost:l})}}catch(u){console.error("Error fetching renewals:",u)}};return e.jsxs("div",{className:"space-y-6",children:[n.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Renewals"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:g.totalRenewals})]}),e.jsxs("div",{className:"bg-sage/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Total Spent"}),e.jsxs("p",{className:"text-3xl font-bold text-sage",children:["â‚¹",g.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-accent/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Average Cost"}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["â‚¹",g.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"bg-blue-500/10 rounded-xl p-6",children:[e.jsx("p",{className:"text-dark-brown/60 text-sm mb-1",children:"Last Renewal"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-500",children:["â‚¹",g.lastRenewalCost.toFixed(0)]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Renewal Timeline"}),n.length>0?e.jsx("div",{className:"space-y-4",children:n.map((u,m)=>e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:"absolute -left-2 top-0 w-4 h-4 rounded-full bg-primary border-4 border-white"}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(le,{className:"w-5 h-5 text-primary"}),e.jsxs("h4",{className:"font-semibold text-dark-brown",children:["Renewal ",n.length-m]})]}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:$(new Date(u.renewal_date),"MMMM dd, yyyy")})]}),u.cost&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["â‚¹",u.cost]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 pt-3 border-t border-dark-brown/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"Previous Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-dark-brown",children:$(new Date(u.previous_expiry),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-brown/60 mb-1",children:"New Expiry"}),e.jsx("p",{className:"text-sm font-semibold text-sage",children:$(new Date(u.new_expiry),"MMM dd, yyyy")})]})]}),u.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-brown/10",children:e.jsx("p",{className:"text-sm text-dark-brown/70",children:u.notes})}),u.certificate_url&&e.jsxs("button",{className:"mt-3 flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(se,{className:"w-4 h-4"}),"View renewed certificate"]})]})]},u.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h4",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No renewal history"}),e.jsx("p",{className:"text-dark-brown/40",children:"Renewal records will appear here when the license is renewed"})]})]}),n.length>1&&e.jsxs("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Cost Analysis"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($e,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Total Spent on Renewals"})]}),e.jsxs("span",{className:"font-bold text-lg text-primary",children:["â‚¹",g.totalCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-5 h-5 text-sage"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Average Renewal Cost"})]}),e.jsxs("span",{className:"font-bold text-lg text-sage",children:["â‚¹",g.avgCost.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-cream/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-dark-brown",children:"Last Renewal Cost"})]}),e.jsxs("span",{className:`font-bold text-lg ${g.lastRenewalCost>g.avgCost?"text-soft-red":"text-sage"}`,children:["â‚¹",g.lastRenewalCost.toFixed(0),g.lastRenewalCost>g.avgCost&&e.jsxs("span",{className:"text-xs ml-2",children:["(+",((g.lastRenewalCost-g.avgCost)/g.avgCost*100).toFixed(0),"%)"]})]})]})]})]})]})}function Zn({licenseId:s}){const[n,c]=d.useState([]),[g,r]=d.useState(!0);d.useEffect(()=>{h()},[s]);const h=async()=>{try{const u=[],[m,p,f,t,l]=await Promise.all([C.from("licenses").select("created_at, updated_at").eq("id",s).maybeSingle(),C.from("license_documents").select("file_name, uploaded_at, category").eq("license_id",s),C.from("license_renewals").select("renewal_date, new_expiry").eq("license_id",s),C.from("compliance_checklist").select("checklist_item, completed, last_verified_date").eq("license_id",s),C.from("inspections").select("inspection_date, compliance_status, authority").eq("license_id",s)]);m.data&&(u.push({type:"license_added",timestamp:m.data.created_at,description:"License added to system",icon:se,color:"text-primary"}),m.data.updated_at!==m.data.created_at&&u.push({type:"license_updated",timestamp:m.data.updated_at,description:"License details updated",icon:fe,color:"text-blue-500"})),p.data&&p.data.forEach(a=>{u.push({type:"document_uploaded",timestamp:a.uploaded_at,description:`Document uploaded: ${a.file_name}`,details:`Category: ${a.category}`,icon:Ue,color:"text-sage"})}),f.data&&f.data.forEach(a=>{u.push({type:"renewal_processed",timestamp:a.renewal_date,description:"License renewed",details:`New expiry: ${$(new Date(a.new_expiry),"MMM dd, yyyy")}`,icon:le,color:"text-accent"})}),t.data&&t.data.filter(a=>a.completed&&a.last_verified_date).forEach(a=>{u.push({type:"compliance_verified",timestamp:a.last_verified_date,description:"Compliance item verified",details:a.checklist_item,icon:G,color:"text-sage"})}),l.data&&l.data.forEach(a=>{u.push({type:"inspection",timestamp:a.inspection_date,description:`Inspection by ${a.authority}`,details:`Result: ${a.compliance_status}`,icon:qe,color:a.compliance_status==="pass"?"text-sage":"text-accent"})}),u.sort((a,w)=>new Date(w.timestamp).getTime()-new Date(a.timestamp).getTime()),c(u)}catch(u){console.error("Error fetching audit log:",u)}finally{r(!1)}};return g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading audit log..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx("h3",{className:"font-heading text-lg font-bold text-primary mb-2",children:"Activity History"}),e.jsx("p",{className:"text-dark-brown/70",children:"Complete audit trail of all activities related to this license"})]}),n.length>0?e.jsx("div",{className:"bg-white border-2 border-dark-brown/5 rounded-xl p-6",children:e.jsx("div",{className:"space-y-4",children:n.map((u,m)=>{const p=u.icon;return e.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-dark-brown/10 last:border-l-0 last:pb-0",children:[e.jsx("div",{className:`absolute -left-3 top-0 w-6 h-6 rounded-full bg-white border-2 border-dark-brown/10 flex items-center justify-center ${u.color}`,children:e.jsx(p,{className:"w-3 h-3"})}),e.jsxs("div",{className:"bg-cream/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-brown",children:u.description}),e.jsx("span",{className:"text-sm text-dark-brown/60",children:$(new Date(u.timestamp),"MMM dd, yyyy")})]}),u.details&&e.jsx("p",{className:"text-sm text-dark-brown/70",children:u.details}),e.jsx("p",{className:"text-xs text-dark-brown/50 mt-2",children:$(new Date(u.timestamp),"h:mm a")})]})]},m)})})}):e.jsxs("div",{className:"text-center py-12 bg-white border-2 border-dark-brown/5 rounded-xl",children:[e.jsx(se,{className:"w-16 h-16 text-dark-brown/20 mx-auto mb-4"}),e.jsx("h3",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No activity recorded"}),e.jsx("p",{className:"text-dark-brown/40",children:"Activity history will appear here as actions are performed"})]}),e.jsx("div",{className:"bg-sage/10 border-2 border-sage/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(G,{className:"w-6 h-6 text-sage flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-brown mb-2",children:"Full Transparency"}),e.jsx("p",{className:"text-sm text-dark-brown/70",children:"This audit log provides a complete history of all activities related to this license. All actions are timestamped and recorded for compliance and regulatory purposes."})]})]})})]})}const Xn=[{id:"details",label:"Details",icon:se},{id:"documents",label:"Documents",icon:Aa},{id:"compliance",label:"Compliance Checklist",icon:es},{id:"renewal",label:"Renewal History",icon:le},{id:"audit",label:"Audit Log",icon:se}],Ss={fssai:{label:"FSSAI License",icon:"ðŸ´"},ayush:{label:"Ayush License",icon:"ðŸŒ¿"},gmp:{label:"GMP Certification",icon:"âœ“"},trade:{label:"Trade License",icon:"ðŸª"},gst:{label:"GST Registration",icon:"ðŸ’¼"},organic:{label:"Organic Certification",icon:"ðŸŒ±"},pollution:{label:"Pollution Control",icon:"ðŸ­"},fire:{label:"Fire Safety",icon:"ðŸ”¥"},drug:{label:"Drug License",icon:"ðŸ’Š"},other:{label:"Other License",icon:"ðŸ“„"}};function el(){const{id:s}=Ye(),n=ie(),[c,g]=d.useState(null),[r,h]=d.useState("details"),[u,m]=d.useState(!0);d.useEffect(()=>{s&&p()},[s]);const p=async()=>{try{const{data:k,error:_}=await C.from("license_summary").select("*").eq("id",s).maybeSingle();if(_)throw _;g(k)}catch(k){console.error("Error fetching license:",k)}finally{m(!1)}},f=async()=>{if(confirm("Are you sure you want to delete this license? This action cannot be undone."))try{const{error:k}=await C.from("licenses").delete().eq("id",s);if(k)throw k;n("/compliance")}catch(k){console.error("Error deleting license:",k),alert("Error deleting license")}},t=()=>{if(!c)return null;const k={active:{label:"Active",color:"bg-sage/10 text-sage"},pending:{label:"Pending Application",color:"bg-amber-500/10 text-amber-500"},renewal_in_process:{label:"Renewal In Process",color:"bg-blue-500/10 text-blue-500"},expired:{label:"Expired",color:"bg-soft-red/10 text-soft-red"}};return k[c.status]||k.active},l=()=>{if(!c||!c.expiry_date)return"text-dark-brown";const k=X(new Date(c.expiry_date),new Date);return k<0||k<=7?"text-soft-red":k<=30?"text-accent":k<=90?"text-amber-500":"text-sage"};if(u)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-brown/60",children:"Loading license details..."})]})})});if(!c)return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-dark-brown/60",children:"License not found"}),e.jsx("button",{onClick:()=>n("/compliance"),className:"mt-4 px-6 py-3 bg-primary text-white rounded-xl font-semibold",children:"Back to Compliance"})]})})});const a=Ss[c.license_type]||Ss.other,w=t(),b=c.expiry_date?X(new Date(c.expiry_date),new Date):null;return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>n("/compliance"),className:"flex items-center gap-2 text-dark-brown hover:text-primary mb-6 font-semibold transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),"Back to Compliance"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsx("div",{className:"text-5xl",children:a.icon}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-3xl font-bold text-primary mb-1",children:a.label}),e.jsx("p",{className:"text-lg font-mono text-dark-brown/70 mb-2",children:c.license_number}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:w&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${w.color}`,children:w.label})})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-xl font-semibold hover:bg-primary/20 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-soft-red/10 text-soft-red rounded-xl font-semibold hover:bg-soft-red/20 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t-2 border-dark-brown/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issuing Authority"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:c.issuing_authority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Issue Date"}),e.jsx("p",{className:"font-semibold text-dark-brown",children:$(new Date(c.issue_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Expiry Date"}),e.jsx("p",{className:`font-semibold ${l()}`,children:c.expiry_date?$(new Date(c.expiry_date),"MMM dd, yyyy"):"No Expiry"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-brown/60 mb-1",children:"Days Until Expiry"}),e.jsx("p",{className:`font-semibold text-xl ${l()}`,children:b!==null?b>=0?`${b} days`:"Expired":"N/A"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 overflow-x-auto",children:e.jsx("div",{className:"flex",children:Xn.map(k=>{const _=k.icon;return e.jsxs("button",{onClick:()=>h(k.id),className:`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${r===k.id?"text-primary border-b-4 border-primary bg-primary/5":"text-dark-brown/60 hover:text-primary hover:bg-primary/5"}`,children:[e.jsx(_,{className:"w-5 h-5"}),k.label]},k.id)})})}),e.jsxs("div",{className:"p-6",children:[r==="details"&&e.jsx(Qn,{licenseId:s,license:c,onUpdate:p}),r==="documents"&&e.jsx(Gn,{licenseId:s}),r==="compliance"&&e.jsx(Kn,{licenseId:s,license:c,onUpdate:p}),r==="renewal"&&e.jsx(Jn,{licenseId:s,license:c}),r==="audit"&&e.jsx(Zn,{licenseId:s})]})]})]})})}const tl=["ðŸ˜Š","ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥","âœ…","ðŸ‘","ðŸ’¡","ðŸŒŸ","ðŸ™","ðŸ’¯"];function sl({roomId:s,onMessageSent:n}){const{user:c}=H(),[g,r]=d.useState(""),[h,u]=d.useState(!1),[m,p]=d.useState(!1),f=d.useRef(null),t=d.useRef();d.useEffect(()=>{l()},[g]),d.useEffect(()=>()=>{t.current&&clearTimeout(t.current),a(!1)},[s]);const l=()=>{if(f.current){f.current.style.height="auto";const j=Math.min(f.current.scrollHeight,200);f.current.style.height=`${j}px`}},a=async j=>{if(c)try{j?await C.from("chat_typing_status").upsert({room_id:s,user_id:c.id,is_typing:!0,last_typing_time:new Date().toISOString()},{onConflict:"room_id,user_id"}):await C.from("chat_typing_status").delete().eq("room_id",s).eq("user_id",c.id)}catch(x){console.error("Error updating typing status:",x)}},w=j=>{r(j.target.value),t.current&&clearTimeout(t.current),j.target.value.trim()?(a(!0),t.current=setTimeout(()=>{a(!1)},3e3)):a(!1)},b=async j=>{if(j?.preventDefault(),!g.trim()||!c||h)return;const x=g.trim();r(""),u(!0),a(!1),t.current&&clearTimeout(t.current);try{const o=k(x),{error:i}=await C.from("chat_messages").insert([{room_id:s,sender_id:c.id,message_text:x,message_type:"text",mentions:o}]);if(i)throw i;n()}catch(o){console.error("Error sending message:",o),r(x)}finally{u(!1)}},k=j=>{const x=/@(\w+)/g,o=[];let i;for(;(i=x.exec(j))!==null;)o.push(i[1]);return o},_=j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),b())},y=j=>{const x=f.current;if(!x)return;const o=x.selectionStart,i=x.selectionEnd,v=g.substring(0,o)+j+g.substring(i);r(v),setTimeout(()=>{x.focus();const N=o+j.length;x.setSelectionRange(N,N)},0),p(!1)};return e.jsx("div",{className:"border-t-2 border-dark-brown/5 bg-white p-4",children:e.jsxs("form",{onSubmit:b,className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1 bg-cream/50 border-2 border-dark-brown/10 rounded-xl focus-within:border-primary transition-colors",children:[e.jsx("textarea",{ref:f,value:g,onChange:w,onKeyDown:_,placeholder:"Type a message... (Shift+Enter for new line)",rows:1,className:"w-full px-4 py-3 bg-transparent resize-none focus:outline-none",style:{maxHeight:"200px"}}),e.jsxs("div",{className:"flex items-center gap-2 px-4 pb-3",children:[e.jsx("button",{type:"button",className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors text-dark-brown/60 hover:text-primary",title:"Attach file",children:e.jsx(rs,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors text-dark-brown/60 hover:text-primary",title:"Attach image",children:e.jsx(ss,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>p(!m),className:"p-2 hover:bg-dark-brown/5 rounded-lg transition-colors text-dark-brown/60 hover:text-primary",title:"Add emoji",children:e.jsx(Qs,{className:"w-5 h-5"})}),m&&e.jsx("div",{className:"absolute bottom-full left-0 mb-2 bg-white rounded-xl shadow-soft-lg border-2 border-dark-brown/5 p-3 grid grid-cols-6 gap-2",children:tl.map(j=>e.jsx("button",{type:"button",onClick:()=>y(j),className:"text-2xl hover:bg-cream/50 rounded-lg p-2 transition-colors",children:j},j))})]}),e.jsx("div",{className:"flex-1"}),e.jsx("span",{className:"text-xs text-dark-brown/40",children:g.length>0&&`${g.length} characters`})]})]}),e.jsx("button",{type:"submit",disabled:!g.trim()||h,className:"p-4 bg-gradient-to-r from-primary to-sage text-white rounded-xl font-semibold hover:shadow-soft-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:e.jsx(Hs,{className:"w-5 h-5"})})]}),e.jsxs("p",{className:"text-xs text-dark-brown/40 px-1",children:["Use ",e.jsx("span",{className:"font-mono bg-dark-brown/5 px-1 rounded",children:"@username"})," to mention someone â€¢"," ",e.jsx("span",{className:"font-mono bg-dark-brown/5 px-1 rounded",children:"**bold**"})," for bold text"]})]})})}const al=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸ”¥"];function rl({message:s,isOwnMessage:n,onDelete:c,onEdit:g}){const{user:r}=H(),[h,u]=d.useState(!1),[m,p]=d.useState(!1),[f,t]=d.useState(s.message_text),l=async()=>{if(confirm("Delete this message?"))try{const{error:y}=await C.from("chat_messages").update({is_deleted:!0,deleted_at:new Date().toISOString()}).eq("id",s.id);if(y)throw y;c()}catch(y){console.error("Error deleting message:",y)}},a=async()=>{if(f.trim())try{const{error:y}=await C.from("chat_messages").update({message_text:f.trim(),is_edited:!0,edited_at:new Date().toISOString()}).eq("id",s.id);if(y)throw y;p(!1),g()}catch(y){console.error("Error editing message:",y)}},w=async y=>{if(r)try{const j=s.reactions||{},x=j[y]||[],o={...j};x.includes(r.id)?(o[y]=x.filter(v=>v!==r.id),o[y].length===0&&delete o[y]):o[y]=[...x,r.id];const{error:i}=await C.from("chat_messages").update({reactions:o}).eq("id",s.id);if(i)throw i}catch(j){console.error("Error adding reaction:",j)}},b=y=>{let j=y;return j=j.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),j=j.replace(/\*(.*?)\*/g,"<em>$1</em>"),j=j.replace(/`(.*?)`/g,'<code class="bg-dark-brown/10 px-1 rounded">$1</code>'),j=j.replace(/@(\w+)/g,'<span class="bg-accent/20 text-accent font-semibold px-1 rounded">@$1</span>'),j},k=s.reactions||{},_=Object.entries(k).filter(([y,j])=>j.length>0);return e.jsxs("div",{className:`flex gap-3 ${n?"flex-row-reverse":"flex-row"}`,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-sage flex items-center justify-center text-white font-bold flex-shrink-0",children:s.sender_id?.substring(0,2).toUpperCase()||"U"}),e.jsxs("div",{className:`flex-1 max-w-2xl ${n?"items-end":"items-start"} flex flex-col`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-semibold text-dark-brown",children:n?"You":"Team Member"}),e.jsx("span",{className:"text-xs text-dark-brown/40",children:$(new Date(s.created_at),"h:mm a")}),s.is_edited&&e.jsx("span",{className:"text-xs text-dark-brown/40 italic",children:"(edited)"})]}),e.jsx("div",{className:"relative group",children:m?e.jsxs("div",{className:"bg-white border-2 border-primary rounded-xl p-3",children:[e.jsx("textarea",{value:f,onChange:y=>t(y.target.value),className:"w-full p-2 bg-cream/30 border border-dark-brown/10 rounded-lg focus:outline-none focus:border-primary resize-none",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:a,className:"px-3 py-1 bg-primary text-white rounded-lg text-sm font-semibold hover:bg-primary/90 transition-colors",children:"Save"}),e.jsx("button",{onClick:()=>{p(!1),t(s.message_text)},className:"px-3 py-1 bg-dark-brown/10 text-dark-brown rounded-lg text-sm font-semibold hover:bg-dark-brown/20 transition-colors",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`rounded-xl px-4 py-3 ${n?"bg-gradient-to-br from-primary to-sage text-white":"bg-white border-2 border-dark-brown/5 text-dark-brown"}`,children:e.jsx("div",{className:"text-sm leading-relaxed break-words",dangerouslySetInnerHTML:{__html:b(s.message_text)}})}),h&&n&&e.jsxs("div",{className:"absolute -top-3 right-0 bg-white rounded-lg shadow-soft border border-dark-brown/10 flex gap-1 p-1",children:[e.jsx("button",{onClick:()=>p(!0),className:"p-1.5 hover:bg-cream/50 rounded transition-colors",title:"Edit",children:e.jsx(fe,{className:"w-4 h-4 text-dark-brown/60"})}),e.jsx("button",{onClick:l,className:"p-1.5 hover:bg-soft-red/10 rounded transition-colors",title:"Delete",children:e.jsx(oe,{className:"w-4 h-4 text-soft-red"})})]})]})}),_.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:_.map(([y,j])=>e.jsxs("button",{onClick:()=>w(y),className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs transition-colors ${j.includes(r?.id)?"bg-accent/20 border-2 border-accent":"bg-white border-2 border-dark-brown/10 hover:border-accent"}`,children:[e.jsx("span",{children:y}),e.jsx("span",{className:"font-semibold",children:j.length})]},y))}),e.jsx("div",{className:"flex gap-1 mt-1",children:al.map(y=>e.jsx("button",{onClick:()=>w(y),className:"text-lg opacity-0 group-hover:opacity-100 hover:scale-125 transition-all",title:`React with ${y}`,children:y},y))})]})]})}function nl({room:s,teamMembers:n}){const{user:c}=H(),[g,r]=d.useState([]),[h,u]=d.useState(!0),[m,p]=d.useState([]),f=d.useRef(null),t=d.useRef(null),[l,a]=d.useState(!1);d.useEffect(()=>{s&&(w(),b(),k(),_())},[s?.id]),d.useEffect(()=>{y()},[g]);const w=async()=>{try{u(!0);const{data:N,error:P}=await C.from("chat_messages").select("*").eq("room_id",s.id).eq("is_deleted",!1).order("created_at",{ascending:!0}).limit(100);if(P)throw P;r(N||[])}catch(N){console.error("Error fetching messages:",N)}finally{u(!1)}},b=()=>{const N=C.channel(`room_${s.id}_messages`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},P=>{r(L=>[...L,P.new]),_()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},P=>{r(L=>L.map(I=>I.id===P.new.id?P.new:I))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chat_messages",filter:`room_id=eq.${s.id}`},P=>{r(L=>L.filter(I=>I.id!==P.old.id))}).subscribe();return()=>{N.unsubscribe()}},k=()=>{const N=C.channel(`room_${s.id}_typing`).on("postgres_changes",{event:"*",schema:"public",table:"chat_typing_status",filter:`room_id=eq.${s.id}`},async()=>{const{data:P}=await C.from("chat_typing_status").select("*").eq("room_id",s.id).eq("is_typing",!0).neq("user_id",c?.id||"");p(P||[])}).subscribe();return()=>{N.unsubscribe()}},_=async()=>{if(c)try{const{error:N}=await C.from("chat_room_members").update({last_read_at:new Date().toISOString()}).eq("room_id",s.id).eq("user_id",c.id);if(N)throw N}catch(N){console.error("Error marking room as read:",N)}},y=()=>{f.current?.scrollIntoView({behavior:"smooth"})},j=()=>{if(!t.current)return;const{scrollTop:N,scrollHeight:P,clientHeight:L}=t.current,I=P-N-L<100;a(!I)},x=N=>{const P=new Date(N);return xa(P)?"Today":ma(P)?"Yesterday":$(P,"MMMM dd, yyyy")},o=(N,P)=>P?!Gt(new Date(N.created_at),new Date(P.created_at)):!0,i=N=>{const P=n.find(L=>L.id===N);return N===c?.id?"You":P?.full_name||P?.email?.split("@")[0]||"Unknown"},v=()=>m.map(N=>{const P=n.find(L=>L.id===N.user_id);return P?.full_name||P?.email?.split("@")[0]||"Someone"}).join(", ");return e.jsxs("div",{className:"flex-1 flex flex-col h-full",children:[e.jsx("div",{className:"border-b-2 border-dark-brown/5 p-4 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"text-3xl",children:s.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary truncate",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-dark-brown/60 truncate",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-dark-brown/40"}),e.jsxs("span",{className:"text-sm text-dark-brown/60 font-medium",children:[n.length," partner",n.length!==1?"s":""]})]})]})}),e.jsxs("div",{ref:t,onScroll:j,className:"flex-1 overflow-y-auto p-4 bg-cream/30",children:[h?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):g.length>0?e.jsxs("div",{className:"space-y-4",children:[g.map((N,P)=>e.jsxs("div",{children:[o(N,g[P-1])&&e.jsxs("div",{className:"flex items-center gap-3 my-6",children:[e.jsx("div",{className:"flex-1 h-px bg-dark-brown/10"}),e.jsx("span",{className:"text-xs font-semibold text-dark-brown/40 px-3 py-1 bg-white rounded-full",children:x(N.created_at)}),e.jsx("div",{className:"flex-1 h-px bg-dark-brown/10"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[N.sender_id!==c?.id&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary to-sage flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:i(N.sender_id)[0]?.toUpperCase()}),e.jsxs("div",{className:`flex-1 ${N.sender_id===c?.id?"ml-auto":""}`,children:[N.sender_id!==c?.id&&e.jsx("div",{className:"text-sm font-semibold text-primary mb-1",children:i(N.sender_id)}),e.jsx(rl,{message:N,isOwnMessage:N.sender_id===c?.id,onDelete:()=>w(),onEdit:()=>w()})]}),N.sender_id===c?.id&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary to-sage flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:i(N.sender_id)[0]?.toUpperCase()})]})]},N.id)),e.jsx("div",{ref:f})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:s.icon}),e.jsx("h4",{className:"font-heading text-xl font-bold text-dark-brown/60 mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-dark-brown/40",children:"Start the conversation with your team!"})]})}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-soft mt-4",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsxs("span",{className:"text-sm text-dark-brown/60",children:[v()," ",m.length===1?"is":"are"," typing..."]})]})]}),l&&e.jsx("button",{onClick:y,className:"absolute bottom-24 right-8 p-3 bg-primary text-white rounded-full shadow-soft-lg hover:shadow-soft-xl transition-all z-10",children:e.jsx(Ts,{className:"w-5 h-5"})}),e.jsx(sl,{roomId:s.id,onMessageSent:w})]})}const ll="00000000-0000-0000-0000-000000000001";function ol(){const{user:s}=H(),[n,c]=d.useState(null),[g,r]=d.useState([]),[h,u]=d.useState(!0);d.useEffect(()=>{m()},[s]);const m=async()=>{if(s)try{const{data:p,error:f}=await C.from("chat_room_list").select("*").eq("id",ll).eq("user_id",s.id).maybeSingle();if(f)throw f;p&&c(p);const{data:t,error:l}=await C.from("team_chat_members").select("*");if(l)throw l;r(t||[])}catch(p){console.error("Error fetching room data:",p)}finally{u(!1)}};return h?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cream via-soft-beige to-cream relative overflow-hidden",children:[e.jsx(ke,{}),e.jsxs("div",{className:"relative z-10 h-screen flex",children:[e.jsxs("div",{className:"w-80 glass-card border-r-2 border-primary/10 flex flex-col",children:[e.jsx("div",{className:"p-6 border-b-2 border-primary/10",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ‘¥"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-gradient",children:"Team Chat"}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:"Common chat for all partners"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-dark-brown/60 uppercase tracking-wider mb-3 px-2",children:["Team Members (",g.length,")"]}),e.jsx("div",{className:"space-y-2",children:g.map(p=>e.jsx("div",{className:`p-3 rounded-xl transition-all ${p.id===s?.id?"bg-primary/10 border-2 border-primary/20":"bg-white border-2 border-transparent hover:border-primary/10"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-sage flex items-center justify-center text-white font-bold text-lg",children:(p.full_name||p.email)?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-semibold text-primary truncate",children:[p.full_name||p.email?.split("@")[0]||"Partner",p.id===s?.id&&e.jsx("span",{className:"ml-2 text-xs text-primary/60 font-normal",children:"(You)"})]}),e.jsx("div",{className:"text-xs text-dark-brown/60 truncate",children:p.role||p.email})]}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-emerald-500 ring-2 ring-white flex-shrink-0",title:"Online"})]})},p.id))}),g.length===0&&e.jsxs("div",{className:"text-center py-8 px-4",children:[e.jsx(we,{className:"w-12 h-12 text-dark-brown/20 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-dark-brown/40",children:"No team members found"})]})]}),e.jsx("div",{className:"p-4 border-t-2 border-primary/10 bg-white",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-dark-brown/40",children:"All partners can see and send messages"})})})]}),e.jsx("div",{className:"flex-1 flex flex-col glass-card",children:n?e.jsx(nl,{room:n,teamMembers:g}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ‘¥"}),e.jsx("h3",{className:"font-heading text-3xl font-bold text-primary mb-3",children:"Team Chat Unavailable"}),e.jsx("p",{className:"text-primary/60 text-lg font-medium",children:"Unable to load the team chat room"})]})})})]})]})}function il(){const s=ie(),{user:n}=H(),[c,g]=d.useState("profile"),[r,h]=d.useState({name:n?.name||"",email:n?.email||"",phone:n?.phone||""}),[u,m]=d.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[p,f]=d.useState(null),[t,l]=d.useState(null),[a,w]=d.useState(!1),[b,k]=d.useState(!1),_=async j=>{j.preventDefault(),w(!0),f(null);try{const x=localStorage.getItem("users"),o=x?JSON.parse(x):[],i=o.findIndex(v=>v.id===n?.id);if(i!==-1){o[i]={...o[i],name:r.name,email:r.email,phone:r.phone},localStorage.setItem("users",JSON.stringify(o));const v={id:o[i].id,name:o[i].name,email:o[i].email,phone:o[i].phone,role:o[i].role};localStorage.setItem("currentUser",JSON.stringify(v)),f({type:"success",text:"Profile updated successfully"}),setTimeout(()=>{window.location.reload()},1500)}}catch{f({type:"error",text:"Failed to update profile"})}finally{w(!1)}},y=async j=>{if(j.preventDefault(),k(!0),l(null),u.newPassword.length<8){l({type:"error",text:"New password must be at least 8 characters long"}),k(!1);return}if(u.newPassword!==u.confirmPassword){l({type:"error",text:"New passwords do not match"}),k(!1);return}try{const x=localStorage.getItem("users"),o=x?JSON.parse(x):[],i=o.findIndex(v=>v.id===n?.id&&v.password===u.currentPassword);i!==-1?(o[i].password=u.newPassword,localStorage.setItem("users",JSON.stringify(o)),l({type:"success",text:"Password changed successfully"}),m({currentPassword:"",newPassword:"",confirmPassword:""})):l({type:"error",text:"Current password is incorrect"})}catch{l({type:"error",text:"Failed to change password"})}finally{k(!1)}};return e.jsx("div",{className:"min-h-screen bg-cream",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-primary mb-2",children:"Settings"}),e.jsx("p",{className:"text-dark-brown/70",children:"Manage your account settings and preferences"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[e.jsx("div",{className:"border-b-2 border-primary/10",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>g("profile"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${c==="profile"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile"})]})}),e.jsx("button",{onClick:()=>g("security"),className:`flex-1 px-6 py-4 font-semibold transition-all duration-300 ${c==="security"?"bg-primary/10 text-primary border-b-2 border-primary":"text-dark-brown/60 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{children:"Security"})]})})]})}),e.jsxs("div",{className:"p-6 md:p-8",children:[c==="profile"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-6 p-4 bg-cream/50 rounded-xl border border-primary/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-sage rounded-full flex items-center justify-center",children:e.jsx(ze,{className:"w-6 h-6 text-cream"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-dark-brown",children:n?.name}),e.jsx("p",{className:"text-sm text-dark-brown/60",children:n?.email})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-accent/20 rounded-full",children:[e.jsx(pt,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm font-semibold text-dark-brown capitalize",children:n?.role})]})]})}),p&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${p.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[p.type==="success"?e.jsx(G,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(ue,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${p.type==="success"?"text-sage":"text-soft-red"}`,children:p.text})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"name",type:"text",value:r.name,onChange:j=>h({...r,name:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"email",type:"email",value:r.email,onChange:j=>h({...r,email:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",required:!0,disabled:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"phone",type:"tel",value:r.phone,onChange:j=>h({...r,phone:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",disabled:a})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:a,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(Vs,{className:"w-5 h-5"}),a?"Saving...":"Save Changes"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]}),c==="security"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-heading text-2xl font-bold text-primary mb-2",children:"Change Password"}),e.jsx("p",{className:"text-dark-brown/70",children:"Update your password to keep your account secure"})]}),t&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl flex items-start gap-3 ${t.type==="success"?"bg-sage/10 border border-sage/30":"bg-soft-red/10 border border-soft-red/30"}`,children:[t.type==="success"?e.jsx(G,{className:"w-5 h-5 text-sage flex-shrink-0 mt-0.5"}):e.jsx(ue,{className:"w-5 h-5 text-soft-red flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${t.type==="success"?"text-sage":"text-soft-red"}`,children:t.text})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"currentPassword",type:"password",value:u.currentPassword,onChange:j=>m({...u,currentPassword:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"newPassword",type:"password",value:u.newPassword,onChange:j=>m({...u,newPassword:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:b,minLength:8})]}),e.jsx("p",{className:"text-xs text-dark-brown/60 mt-1",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-semibold text-dark-brown mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-brown/40"}),e.jsx("input",{id:"confirmPassword",type:"password",value:u.confirmPassword,onChange:j=>m({...u,confirmPassword:j.target.value}),className:"w-full pl-12 pr-4 py-3 border-2 border-dark-brown/10 rounded-xl focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:b})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:b,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary text-cream font-semibold rounded-xl shadow-soft hover:shadow-soft-lg transition-all duration-300 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[e.jsx(Ae,{className:"w-5 h-5"}),b?"Changing...":"Change Password"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"px-6 py-3 border-2 border-primary/20 text-primary font-semibold rounded-xl hover:bg-primary/5 transition-all duration-300",children:"Cancel"})]})]})]})]})]})]})})})}function dl(){const{user:s}=H(),[n,c]=d.useState([]),[g,r]=d.useState(!0),[h,u]=d.useState("all");d.useEffect(()=>{m()},[s?.id]);const m=async()=>{if(s?.id)try{const{data:b,error:k}=await C.from("notifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(k)throw k;c(b||[])}catch(b){console.error("Error fetching notifications:",b)}finally{r(!1)}},p=async b=>{try{const{error:k}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",b);if(k)throw k;c(_=>_.map(y=>y.id===b?{...y,is_read:!0,read_at:new Date().toISOString()}:y))}catch(k){console.error("Error marking notification as read:",k)}},f=async()=>{try{const b=n.filter(_=>!_.is_read).map(_=>_.id),{error:k}=await C.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).in("id",b);if(k)throw k;c(_=>_.map(y=>({...y,is_read:!0,read_at:y.read_at||new Date().toISOString()})))}catch(b){console.error("Error marking all as read:",b)}},t=async b=>{try{const{error:k}=await C.from("notifications").delete().eq("id",b);if(k)throw k;c(_=>_.filter(y=>y.id!==b))}catch(k){console.error("Error deleting notification:",k)}},l=h==="unread"?n.filter(b=>!b.is_read):n,a=n.filter(b=>!b.is_read).length,w=b=>{switch(b){case"expense":return"text-blue-600 bg-blue-50";case"batch":return"text-green-600 bg-green-50";case"license":return"text-orange-600 bg-orange-50";case"vendor":return"text-purple-600 bg-purple-50";case"product":return"text-pink-600 bg-pink-50";default:return"text-gray-600 bg-gray-50"}};return g?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsx("div",{className:"min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-primary mb-2",children:"Notifications"}),e.jsx("p",{className:"text-gray-600",children:a>0?`You have ${a} unread notification${a>1?"s":""}`:"All caught up!"})]}),a>0&&e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary-dark transition-colors",children:[e.jsx(Da,{className:"w-4 h-4"}),"Mark All Read"]})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>u("all"),className:`px-4 py-2 rounded-button font-semibold transition-all ${h==="all"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["All (",n.length,")"]}),e.jsxs("button",{onClick:()=>u("unread"),className:`px-4 py-2 rounded-button font-semibold transition-all ${h==="unread"?"bg-primary text-white":"text-primary hover:bg-primary/5"}`,children:["Unread (",a,")"]})]})]}),l.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(Ge,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:h==="unread"?"No unread notifications":"No notifications yet"}),e.jsx("p",{className:"text-gray-500",children:h==="unread"?"All notifications have been read":"You'll see notifications here when there's activity"})]}):e.jsx("div",{className:"space-y-3",children:l.map(b=>e.jsx("div",{className:`glass-card p-4 transition-all hover:shadow-lg ${b.is_read?"":"border-l-4 border-gold"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${w(b.type)}`,children:e.jsx(Ge,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsx("h3",{className:"font-semibold text-primary",children:b.title}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:Jt(new Date(b.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:b.message}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${w(b.type)}`,children:b.type}),!b.is_read&&e.jsxs("button",{onClick:()=>p(b.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-primary hover:bg-primary/5 rounded-button transition-colors",children:[e.jsx(ts,{className:"w-3 h-3"}),"Mark as read"]}),e.jsxs("button",{onClick:()=>t(b.id),className:"text-xs flex items-center gap-1 px-2 py-1 text-red-600 hover:bg-red-50 rounded-button transition-colors ml-auto",children:[e.jsx(oe,{className:"w-3 h-3"}),"Delete"]})]})]})]})},b.id))})]})})}function cl(){const{user:s}=H(),[n,c]=d.useState("pending"),[g,r]=d.useState([]),[h,u]=d.useState([]),[m,p]=d.useState([]),[f,t]=d.useState(!0),[l,a]=d.useState(""),[w,b]=d.useState(null),[k,_]=d.useState(!1),[y,j]=d.useState(null),[x,o]=d.useState("");d.useEffect(()=>{i()},[]);const i=async()=>{t(!0);try{const{data:A}=await C.from("users").select("*").eq("approval_status","pending").order("created_at",{ascending:!1}),{data:U}=await C.from("users").select(`
          *,
          approver:approved_by(name)
        `).eq("approval_status","approved").order("approved_at",{ascending:!1}),{data:B}=await C.from("users").select("*").eq("approval_status","rejected").order("created_at",{ascending:!1});r(A||[]),u((U||[]).map(W=>({...W,approver_name:W.approver?.name||"Unknown"}))),p(B||[])}catch(A){console.error("Error fetching users:",A)}finally{t(!1)}},v=async A=>{b(A);try{const{error:U}=await C.from("users").update({approval_status:"approved",approved_by:s?.id,approved_at:new Date().toISOString()}).eq("id",A);if(U)throw U;await C.from("notifications").insert({user_id:A,type:"account_approved",title:"Account Approved",message:"Your Organitto account has been approved! You can now login.",read:!1}),await i()}catch(U){console.error("Error approving user:",U),alert("Failed to approve user")}finally{b(null)}},N=A=>{j(A),_(!0),o("")},P=async()=>{if(!y||!x.trim()){alert("Please provide a reason for rejection");return}b(y.id);try{const{error:A}=await C.from("users").update({approval_status:"rejected",rejection_reason:x}).eq("id",y.id);if(A)throw A;await C.from("notifications").insert({user_id:y.id,type:"account_rejected",title:"Registration Not Approved",message:`Your registration was not approved. Reason: ${x}`,read:!1}),_(!1),j(null),o(""),await i()}catch(A){console.error("Error rejecting user:",A),alert("Failed to reject user")}finally{b(null)}},L=A=>{if(!l.trim())return A;const U=l.toLowerCase();return A.filter(B=>B.name.toLowerCase().includes(U)||B.email.toLowerCase().includes(U))},I=A=>new Date(A).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});return f?e.jsx("div",{className:"min-h-screen bg-gradient-mesh",children:e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-mesh",children:[e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-colored",children:e.jsx(we,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary",children:"User Approval Management"}),e.jsx("p",{className:"text-dark-brown/70 font-medium mt-1",children:"Review and manage user registrations"})]})]})}),e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>c("pending"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${n==="pending"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(le,{className:"w-4 h-4 inline mr-2"}),"Pending (",g.length,")"]}),e.jsxs("button",{onClick:()=>c("approved"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${n==="approved"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(G,{className:"w-4 h-4 inline mr-2"}),"Approved (",h.length,")"]}),e.jsxs("button",{onClick:()=>c("rejected"),className:`px-6 py-3 rounded-button font-bold transition-all duration-300 ${n==="rejected"?"bg-gradient-primary text-white shadow-colored":"glass-card text-primary hover:shadow-md"}`,children:[e.jsx(Ce,{className:"w-4 h-4 inline mr-2"}),"Rejected (",m.length,")"]})]}),e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(Ke,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-primary/40"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:l,onChange:A=>a(A.target.value),className:"input-float w-full pl-12"})]})]}),n==="pending"&&e.jsx("div",{className:"space-y-4",children:L(g).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No pending approvals"})]}):L(g).map(A=>e.jsx("div",{className:"glass-card p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:A.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:A.name}),e.jsx("p",{className:"text-sm text-primary/60",children:A.role.charAt(0).toUpperCase()+A.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",A.email]}),A.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",A.phone]}),e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Registered:"})," ",I(A.created_at)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(be,{onClick:()=>v(A.id),disabled:w===A.id,variant:"primary",className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>N(A),disabled:w===A.id,className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Reject"]})]})]})},A.id))}),n==="approved"&&e.jsx("div",{className:"space-y-4",children:L(h).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No approved users"})]}):L(h).map(A=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:A.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:A.name}),e.jsx("p",{className:"text-sm text-primary/60",children:A.role.charAt(0).toUpperCase()+A.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",A.email]}),A.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",A.phone]}),e.jsxs("p",{className:"text-sm text-green-600 font-semibold",children:["Approved by ",A.approver_name," on ",A.approved_at?I(A.approved_at):"N/A"]})]})]},A.id))}),n==="rejected"&&e.jsx("div",{className:"space-y-4",children:L(m).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No rejected users"})]}):L(m).map(A=>e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:A.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-primary",children:A.name}),e.jsx("p",{className:"text-sm text-primary/60",children:A.role.charAt(0).toUpperCase()+A.role.slice(1)})]})]}),e.jsxs("div",{className:"ml-13 space-y-1",children:[e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",A.email]}),A.phone&&e.jsxs("p",{className:"text-sm text-primary/70",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",A.phone]}),A.rejection_reason&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50/50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-sm font-semibold text-red-800 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700",children:A.rejection_reason})]})]})]},A.id))})]})]}),k&&y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"glass-card p-8 max-w-md w-full animate-scale-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary mb-4",children:"Reject Registration"}),e.jsxs("p",{className:"text-primary/70 mb-6",children:["Are you sure you want to reject ",e.jsx("span",{className:"font-bold",children:y.name}),"'s registration?"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-primary mb-3",children:"Rejection Reason (Required)"}),e.jsx("textarea",{value:x,onChange:A=>o(A.target.value),className:"input-float w-full h-32 resize-none",placeholder:"Explain why this registration is being rejected...",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{_(!1),j(null),o("")},className:"flex-1 px-6 py-3 glass-card text-primary font-bold rounded-button hover:shadow-md",children:"Cancel"}),e.jsx("button",{onClick:P,disabled:!x.trim()||w===y.id,className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-button hover:shadow-lg disabled:opacity-50",children:"Confirm Reject"})]})]})})]})}function xl(){const s=Kt(),{user:n}=H(),g=["/","/login","/register"].includes(s.pathname),r=n&&!g;return e.jsxs(e.Fragment,{children:[!g&&e.jsx(ke,{}),e.jsxs(ia,{children:[e.jsx(K,{path:"/",element:e.jsx(pr,{})}),e.jsx(K,{path:"/login",element:e.jsx(br,{})}),e.jsx(K,{path:"/register",element:e.jsx(ur,{})}),e.jsxs(K,{element:e.jsx(fs,{children:e.jsx(js,{})}),children:[e.jsx(K,{path:"/dashboard",element:e.jsx(jr,{})}),e.jsx(K,{path:"/finance",element:e.jsx(yr,{})}),e.jsx(K,{path:"/expenses/add",element:e.jsx(Nr,{})}),e.jsx(K,{path:"/expenses/edit/:id",element:e.jsx(kr,{})}),e.jsx(K,{path:"/expenses",element:e.jsx(Sr,{})}),e.jsx(K,{path:"/expenses/reports",element:e.jsx(Ir,{})}),e.jsx(K,{path:"/investments",element:e.jsx(Rr,{})}),e.jsx(K,{path:"/products",element:e.jsx(Gr,{})}),e.jsx(K,{path:"/products/:id",element:e.jsx(dn,{})}),e.jsx(K,{path:"/calculator",element:e.jsx(cn,{})}),e.jsx(K,{path:"/vendors",element:e.jsx(pn,{})}),e.jsx(K,{path:"/vendors/:id",element:e.jsx(vn,{})}),e.jsx(K,{path:"/batches",element:e.jsx(_n,{})}),e.jsx(K,{path:"/batches/:id",element:e.jsx(Fn,{})}),e.jsx(K,{path:"/ingredients",element:e.jsx(Ln,{})}),e.jsx(K,{path:"/ingredients/:id",element:e.jsx(On,{})}),e.jsx(K,{path:"/compliance",element:e.jsx(Wn,{})}),e.jsx(K,{path:"/compliance/:id",element:e.jsx(el,{})}),e.jsx(K,{path:"/chat",element:e.jsx(ol,{})}),e.jsx(K,{path:"/settings",element:e.jsx(il,{})}),e.jsx(K,{path:"/notifications",element:e.jsx(dl,{})})]}),e.jsx(K,{path:"/admin/user-approvals",element:e.jsx(fs,{adminOnly:!0,children:e.jsx(js,{})}),children:e.jsx(K,{index:!0,element:e.jsx(cl,{})})}),e.jsx(K,{path:"*",element:e.jsx(Ds,{to:"/",replace:!0})})]}),r&&e.jsx(hr,{})]})}function ml(){return e.jsx(oa,{children:e.jsxs(va,{children:[e.jsx(cr,{}),e.jsx(dr,{}),e.jsx(xr,{}),e.jsx(xl,{})]})})}As(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(ml,{})}));
